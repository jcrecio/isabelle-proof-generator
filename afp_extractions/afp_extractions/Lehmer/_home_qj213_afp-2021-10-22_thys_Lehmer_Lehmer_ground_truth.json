{"file_name": "/home/qj213/afp-2021-10-22/thys/Lehmer/Lehmer.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Lehmer", "problem_names": ["lemma mod_1_coprime_nat:\n  \"coprime a b\" if \"0 < n\" \"[a ^ n = 1] (mod b)\" for a b :: nat", "lemma lehmers_weak_theorem:\n  assumes \"2 \\<le> p\"\n  assumes min_cong1: \"\\<And>x. 0 < x \\<Longrightarrow> x < p - 1 \\<Longrightarrow> [a ^ x \\<noteq> 1] (mod p)\"\n  assumes cong1: \"[a ^ (p - 1) = 1] (mod p)\"\n  shows \"prime p\"", "lemma prime_factors_elem:\n  fixes n :: nat assumes \"1 < n\" shows \"\\<exists>p. p \\<in> prime_factors n\"", "lemma cong_pow_1_nat:\n  \"[a ^ x = 1] (mod b)\" if \"[a = 1] (mod b)\" for a b :: nat", "lemma cong_gcd_eq_1_nat:\n  fixes a b :: nat\n  assumes \"0 < m\" and cong_props: \"[a ^ m = 1] (mod b)\" \"[a ^ n = 1] (mod b)\"\n  shows \"[a ^ gcd m n = 1] (mod b)\"", "lemma One_leq_div:\n  \"1 < b div a\" if \"a dvd b\" \"a < b\" for a b :: nat", "theorem lehmers_theorem:\n  assumes \"2 \\<le> p\"\n  assumes pf_notcong1: \"\\<And>x. x \\<in> prime_factors (p - 1) \\<Longrightarrow> [a ^ ((p - 1) div x) \\<noteq> 1] (mod p)\"\n  assumes cong1: \"[a ^ (p - 1) = 1] (mod p)\"\n  shows \"prime p\"", "lemma converse_lehmer_weak:\n assumes prime_p: \"prime p\"\n shows \"\\<exists> a. [a^(p - 1) = 1] (mod p) \\<and> (\\<forall> x . 0 < x \\<longrightarrow> x \\<le> p - 2 \\<longrightarrow> [a^x \\<noteq> 1] (mod p))\n             \\<and> a > 0 \\<and> a < p\"", "theorem converse_lehmer:\n assumes prime_p:\"prime(p)\"\n shows \"\\<exists> a . [a^(p - 1) = 1] (mod p) \\<and>\n              (\\<forall> q. q \\<in> prime_factors (p - 1) \\<longrightarrow> [a^((p - 1) div q) \\<noteq> 1] (mod p))\n              \\<and> a > 0 \\<and> a < p\""], "translations": [["", "lemma mod_1_coprime_nat:\n  \"coprime a b\" if \"0 < n\" \"[a ^ n = 1] (mod b)\" for a b :: nat"], ["proof (prove)\ngoal (1 subgoal):\n 1. coprime a b", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. coprime a b", "from that coprime_1_left"], ["proof (chain)\npicking this:\n  0 < n\n  [a ^ n = 1] (mod b)\n  coprime (1::?'a) ?a", "have \"coprime (a ^ n) b\""], ["proof (prove)\nusing this:\n  0 < n\n  [a ^ n = 1] (mod b)\n  coprime (1::?'a) ?a\n\ngoal (1 subgoal):\n 1. coprime (a ^ n) b", "using cong_imp_coprime cong_sym"], ["proof (prove)\nusing this:\n  0 < n\n  [a ^ n = 1] (mod b)\n  coprime (1::?'a) ?a\n  \\<lbrakk>[?a = ?b] (mod ?m); coprime ?a ?m\\<rbrakk>\n  \\<Longrightarrow> coprime ?b ?m\n  [?b = ?c] (mod ?a) \\<Longrightarrow> [?c = ?b] (mod ?a)\n\ngoal (1 subgoal):\n 1. coprime (a ^ n) b", "by blast"], ["proof (state)\nthis:\n  coprime (a ^ n) b\n\ngoal (1 subgoal):\n 1. coprime a b", "with \\<open>0 < n\\<close>"], ["proof (chain)\npicking this:\n  0 < n\n  coprime (a ^ n) b", "show ?thesis"], ["proof (prove)\nusing this:\n  0 < n\n  coprime (a ^ n) b\n\ngoal (1 subgoal):\n 1. coprime a b", "by simp"], ["proof (state)\nthis:\n  coprime a b\n\ngoal:\nNo subgoals!", "qed"], ["", "text \\<open>\n  This is a weak variant of Lehmer's theorem: All numbers less then @{term \"p - 1 :: nat\"}\n  must be considered.\n\\<close>"], ["", "lemma lehmers_weak_theorem:\n  assumes \"2 \\<le> p\"\n  assumes min_cong1: \"\\<And>x. 0 < x \\<Longrightarrow> x < p - 1 \\<Longrightarrow> [a ^ x \\<noteq> 1] (mod p)\"\n  assumes cong1: \"[a ^ (p - 1) = 1] (mod p)\"\n  shows \"prime p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. prime p", "proof (rule totient_imp_prime)"], ["proof (state)\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "from \\<open>2 \\<le> p\\<close> cong1"], ["proof (chain)\npicking this:\n  2 \\<le> p\n  [a ^ (p - 1) = 1] (mod p)", "have \"coprime a p\""], ["proof (prove)\nusing this:\n  2 \\<le> p\n  [a ^ (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. coprime a p", "by (intro mod_1_coprime_nat[of \"p - 1\"]) auto"], ["proof (state)\nthis:\n  coprime a p\n\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "then"], ["proof (chain)\npicking this:\n  coprime a p", "have \"[a ^ totient p = 1] (mod p)\""], ["proof (prove)\nusing this:\n  coprime a p\n\ngoal (1 subgoal):\n 1. [a ^ totient p = 1] (mod p)", "by (intro euler_theorem) auto"], ["proof (state)\nthis:\n  [a ^ totient p = 1] (mod p)\n\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "then"], ["proof (chain)\npicking this:\n  [a ^ totient p = 1] (mod p)", "have \"totient p \\<ge> p - 1 \\<or> totient p = 0\""], ["proof (prove)\nusing this:\n  [a ^ totient p = 1] (mod p)\n\ngoal (1 subgoal):\n 1. p - 1 \\<le> totient p \\<or> totient p = 0", "using min_cong1[of \"totient p\"]"], ["proof (prove)\nusing this:\n  [a ^ totient p = 1] (mod p)\n  \\<lbrakk>0 < totient p; totient p < p - 1\\<rbrakk>\n  \\<Longrightarrow> [a ^ totient p \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. p - 1 \\<le> totient p \\<or> totient p = 0", "by fastforce"], ["proof (state)\nthis:\n  p - 1 \\<le> totient p \\<or> totient p = 0\n\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "moreover"], ["proof (state)\nthis:\n  p - 1 \\<le> totient p \\<or> totient p = 0\n\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "have \"totient p > 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < totient p", "using \\<open>2 \\<le> p\\<close>"], ["proof (prove)\nusing this:\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. 0 < totient p", "by simp"], ["proof (state)\nthis:\n  0 < totient p\n\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "moreover"], ["proof (state)\nthis:\n  0 < totient p\n\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "from \\<open>p \\<ge> 2\\<close>"], ["proof (chain)\npicking this:\n  2 \\<le> p", "have \"totient p < p\""], ["proof (prove)\nusing this:\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. totient p < p", "by (intro totient_less) auto"], ["proof (state)\nthis:\n  totient p < p\n\ngoal (2 subgoals):\n 1. totient p = p - 1\n 2. 0 < p", "ultimately"], ["proof (chain)\npicking this:\n  p - 1 \\<le> totient p \\<or> totient p = 0\n  0 < totient p\n  totient p < p", "show \"totient p = p - 1\""], ["proof (prove)\nusing this:\n  p - 1 \\<le> totient p \\<or> totient p = 0\n  0 < totient p\n  totient p < p\n\ngoal (1 subgoal):\n 1. totient p = p - 1", "by presburger"], ["proof (state)\nthis:\n  totient p = p - 1\n\ngoal (1 subgoal):\n 1. 0 < p", "qed (insert \\<open>p \\<ge> 2\\<close>, auto)"], ["", "lemma prime_factors_elem:\n  fixes n :: nat assumes \"1 < n\" shows \"\\<exists>p. p \\<in> prime_factors n\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>p. p \\<in># prime_factorization n", "using assms"], ["proof (prove)\nusing this:\n  1 < n\n\ngoal (1 subgoal):\n 1. \\<exists>p. p \\<in># prime_factorization n", "by (cases \"prime n\") (auto simp: prime_factors_dvd prime_factor_nat)"], ["", "lemma cong_pow_1_nat:\n  \"[a ^ x = 1] (mod b)\" if \"[a = 1] (mod b)\" for a b :: nat"], ["proof (prove)\ngoal (1 subgoal):\n 1. [a ^ x = 1] (mod b)", "using cong_pow [of a 1 b x] that"], ["proof (prove)\nusing this:\n  [a = 1] (mod b) \\<Longrightarrow> [a ^ x = 1 ^ x] (mod b)\n  [a = 1] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ x = 1] (mod b)", "by simp"], ["", "lemma cong_gcd_eq_1_nat:\n  fixes a b :: nat\n  assumes \"0 < m\" and cong_props: \"[a ^ m = 1] (mod b)\" \"[a ^ n = 1] (mod b)\"\n  shows \"[a ^ gcd m n = 1] (mod b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "obtain c d where gcd: \"m * c = n * d + gcd m n\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>c d.\n        m * c = n * d + gcd m n \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using bezout_nat[of m n] \\<open>0 < m\\<close>"], ["proof (prove)\nusing this:\n  m \\<noteq> 0 \\<Longrightarrow> \\<exists>x y. m * x = n * y + gcd m n\n  0 < m\n\ngoal (1 subgoal):\n 1. (\\<And>c d.\n        m * c = n * d + gcd m n \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  m * c = n * d + gcd m n\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "have cong_m: \"[a ^ (m * c) = 1] (mod b)\" and cong_n: \"[a ^ (n * d) = 1] (mod b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [a ^ (m * c) = 1] (mod b) &&& [a ^ (n * d) = 1] (mod b)", "using cong_props"], ["proof (prove)\nusing this:\n  [a ^ m = 1] (mod b)\n  [a ^ n = 1] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ (m * c) = 1] (mod b) &&& [a ^ (n * d) = 1] (mod b)", "by (simp_all only: cong_pow_1_nat power_mult)"], ["proof (state)\nthis:\n  [a ^ (m * c) = 1] (mod b)\n  [a ^ (n * d) = 1] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "have \"[1 * a ^ gcd m n = a ^ (n * d) * a ^ gcd m n] (mod b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [1 * a ^ gcd m n = a ^ (n * d) * a ^ gcd m n] (mod b)", "by (rule cong_scalar_right, rule cong_sym) (fact cong_n)"], ["proof (state)\nthis:\n  [1 * a ^ gcd m n = a ^ (n * d) * a ^ gcd m n] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "also"], ["proof (state)\nthis:\n  [1 * a ^ gcd m n = a ^ (n * d) * a ^ gcd m n] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "have \"[a ^ (n * d) * a ^ gcd m n = a ^ (m * c)] (mod b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [a ^ (n * d) * a ^ gcd m n = a ^ (m * c)] (mod b)", "using gcd"], ["proof (prove)\nusing this:\n  m * c = n * d + gcd m n\n\ngoal (1 subgoal):\n 1. [a ^ (n * d) * a ^ gcd m n = a ^ (m * c)] (mod b)", "by (simp add: power_add)"], ["proof (state)\nthis:\n  [a ^ (n * d) * a ^ gcd m n = a ^ (m * c)] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "also"], ["proof (state)\nthis:\n  [a ^ (n * d) * a ^ gcd m n = a ^ (m * c)] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "have \"[a ^ (m * c) = 1] (mod b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [a ^ (m * c) = 1] (mod b)", "using cong_m"], ["proof (prove)\nusing this:\n  [a ^ (m * c) = 1] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ (m * c) = 1] (mod b)", "by simp"], ["proof (state)\nthis:\n  [a ^ (m * c) = 1] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "finally"], ["proof (chain)\npicking this:\n  [1 * a ^ gcd m n = 1] (mod b)", "show \"[a ^ gcd m n = 1] (mod b)\""], ["proof (prove)\nusing this:\n  [1 * a ^ gcd m n = 1] (mod b)\n\ngoal (1 subgoal):\n 1. [a ^ gcd m n = 1] (mod b)", "by simp"], ["proof (state)\nthis:\n  [a ^ gcd m n = 1] (mod b)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma One_leq_div:\n  \"1 < b div a\" if \"a dvd b\" \"a < b\" for a b :: nat"], ["proof (prove)\ngoal (1 subgoal):\n 1. 1 < b div a", "using that"], ["proof (prove)\nusing this:\n  a dvd b\n  a < b\n\ngoal (1 subgoal):\n 1. 1 < b div a", "by (metis dvd_div_mult_self mult.left_neutral mult_less_cancel2)"], ["", "theorem lehmers_theorem:\n  assumes \"2 \\<le> p\"\n  assumes pf_notcong1: \"\\<And>x. x \\<in> prime_factors (p - 1) \\<Longrightarrow> [a ^ ((p - 1) div x) \\<noteq> 1] (mod p)\"\n  assumes cong1: \"[a ^ (p - 1) = 1] (mod p)\"\n  shows \"prime p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. prime p", "proof cases"], ["proof (state)\ngoal (2 subgoals):\n 1. ?P \\<Longrightarrow> prime p\n 2. \\<not> ?P \\<Longrightarrow> prime p", "assume \"[a = 1] (mod p)\""], ["proof (state)\nthis:\n  [a = 1] (mod p)\n\ngoal (2 subgoals):\n 1. ?P \\<Longrightarrow> prime p\n 2. \\<not> ?P \\<Longrightarrow> prime p", "with \\<open>2 \\<le>p\\<close> pf_notcong1"], ["proof (chain)\npicking this:\n  2 \\<le> p\n  ?x \\<in># prime_factorization (p - 1) \\<Longrightarrow>\n  [a ^ ((p - 1) div ?x) \\<noteq> 1] (mod p)\n  [a = 1] (mod p)", "show ?thesis"], ["proof (prove)\nusing this:\n  2 \\<le> p\n  ?x \\<in># prime_factorization (p - 1) \\<Longrightarrow>\n  [a ^ ((p - 1) div ?x) \\<noteq> 1] (mod p)\n  [a = 1] (mod p)\n\ngoal (1 subgoal):\n 1. prime p", "by (metis cong_pow_1_nat less_diff_conv linorder_neqE_nat linorder_not_less\n      one_add_one prime_factors_elem two_is_prime_nat)"], ["proof (state)\nthis:\n  prime p\n\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "assume A_notcong_1: \"[a \\<noteq> 1] (mod p)\""], ["proof (state)\nthis:\n  [a \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "{"], ["proof (state)\nthis:\n  [a \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "assume \"0 < x\" \"x < p - 1\""], ["proof (state)\nthis:\n  0 < x\n  x < p - 1\n\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "have \"[a ^ x \\<noteq> 1] (mod p)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [a ^ x \\<noteq> 1] (mod p)", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. [a ^ x = 1] (mod p) \\<Longrightarrow> False", "assume \"[a ^ x = 1] (mod p)\""], ["proof (state)\nthis:\n  [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a ^ x = 1] (mod p) \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  [a ^ x = 1] (mod p)", "have gcd_cong_1: \"[a ^ gcd x (p - 1) = 1] (mod p)\""], ["proof (prove)\nusing this:\n  [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a ^ gcd x (p - 1) = 1] (mod p)", "by (rule cong_gcd_eq_1_nat[OF \\<open>0 < x\\<close> _ cong1])"], ["proof (state)\nthis:\n  [a ^ gcd x (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a ^ x = 1] (mod p) \\<Longrightarrow> False", "have \"gcd x (p - 1) = p - 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd x (p - 1) = p - 1", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "assume \"\\<not>?thesis\""], ["proof (state)\nthis:\n  gcd x (p - 1) \\<noteq> p - 1\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  gcd x (p - 1) \\<noteq> p - 1", "have gcd_p1: \"gcd x (p - 1) dvd (p - 1)\" \"gcd x (p - 1) < p - 1\""], ["proof (prove)\nusing this:\n  gcd x (p - 1) \\<noteq> p - 1\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) dvd p - 1 &&& gcd x (p - 1) < p - 1", "using gcd_le2_nat[of \"p - 1\" x] \\<open>2 \\<le> p\\<close>"], ["proof (prove)\nusing this:\n  gcd x (p - 1) \\<noteq> p - 1\n  p - 1 \\<noteq> 0 \\<Longrightarrow> gcd x (p - 1) \\<le> p - 1\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) dvd p - 1 &&& gcd x (p - 1) < p - 1", "by (simp, linarith)"], ["proof (state)\nthis:\n  gcd x (p - 1) dvd p - 1\n  gcd x (p - 1) < p - 1\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "define c where \"c = (p - 1) div (gcd x (p - 1))\""], ["proof (state)\nthis:\n  c = (p - 1) div gcd x (p - 1)\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  c = (p - 1) div gcd x (p - 1)", "have p_1_eq: \"p - 1 = gcd x (p - 1) * c\""], ["proof (prove)\nusing this:\n  c = (p - 1) div gcd x (p - 1)\n\ngoal (1 subgoal):\n 1. p - 1 = gcd x (p - 1) * c", "unfolding c_def"], ["proof (prove)\nusing this:\n  (p - 1) div gcd x (p - 1) = (p - 1) div gcd x (p - 1)\n\ngoal (1 subgoal):\n 1. p - 1 = gcd x (p - 1) * ((p - 1) div gcd x (p - 1))", "using gcd_p1"], ["proof (prove)\nusing this:\n  (p - 1) div gcd x (p - 1) = (p - 1) div gcd x (p - 1)\n  gcd x (p - 1) dvd p - 1\n  gcd x (p - 1) < p - 1\n\ngoal (1 subgoal):\n 1. p - 1 = gcd x (p - 1) * ((p - 1) div gcd x (p - 1))", "by (metis dvd_mult_div_cancel)"], ["proof (state)\nthis:\n  p - 1 = gcd x (p - 1) * c\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "from gcd_p1"], ["proof (chain)\npicking this:\n  gcd x (p - 1) dvd p - 1\n  gcd x (p - 1) < p - 1", "have \"1 < c\""], ["proof (prove)\nusing this:\n  gcd x (p - 1) dvd p - 1\n  gcd x (p - 1) < p - 1\n\ngoal (1 subgoal):\n 1. 1 < c", "unfolding c_def"], ["proof (prove)\nusing this:\n  gcd x (p - 1) dvd p - 1\n  gcd x (p - 1) < p - 1\n\ngoal (1 subgoal):\n 1. 1 < (p - 1) div gcd x (p - 1)", "by (rule One_leq_div)"], ["proof (state)\nthis:\n  1 < c\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  1 < c", "obtain q where q_pf: \"q \\<in> prime_factors c\""], ["proof (prove)\nusing this:\n  1 < c\n\ngoal (1 subgoal):\n 1. (\\<And>q.\n        q \\<in># prime_factorization c \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "using prime_factors_elem"], ["proof (prove)\nusing this:\n  1 < c\n  1 < ?n \\<Longrightarrow> \\<exists>p. p \\<in># prime_factorization ?n\n\ngoal (1 subgoal):\n 1. (\\<And>q.\n        q \\<in># prime_factorization c \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  q \\<in># prime_factorization c\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  q \\<in># prime_factorization c", "have \"q dvd c\""], ["proof (prove)\nusing this:\n  q \\<in># prime_factorization c\n\ngoal (1 subgoal):\n 1. q dvd c", "by auto"], ["proof (state)\nthis:\n  q dvd c\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "have \"q \\<in> prime_factors (p - 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. q \\<in># prime_factorization (p - 1)", "using q_pf \\<open>1 < c\\<close> \\<open>2 \\<le> p\\<close>"], ["proof (prove)\nusing this:\n  q \\<in># prime_factorization c\n  1 < c\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. q \\<in># prime_factorization (p - 1)", "by (subst p_1_eq) (simp add: prime_factors_product)"], ["proof (state)\nthis:\n  q \\<in># prime_factorization (p - 1)\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  q \\<in># prime_factorization (p - 1)\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "have \"[a ^ ((p - 1) div q) = 1] (mod p)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [a ^ ((p - 1) div q) = 1] (mod p)", "by (subst p_1_eq,subst dvd_div_mult_self[OF \\<open>q dvd c\\<close>,symmetric])\n             (simp del: One_nat_def add: power_mult gcd_cong_1 cong_pow_1_nat)"], ["proof (state)\nthis:\n  [a ^ ((p - 1) div q) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. gcd x (p - 1) \\<noteq> p - 1 \\<Longrightarrow> False", "ultimately"], ["proof (chain)\npicking this:\n  q \\<in># prime_factorization (p - 1)\n  [a ^ ((p - 1) div q) = 1] (mod p)", "show False"], ["proof (prove)\nusing this:\n  q \\<in># prime_factorization (p - 1)\n  [a ^ ((p - 1) div q) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. False", "using pf_notcong1"], ["proof (prove)\nusing this:\n  q \\<in># prime_factorization (p - 1)\n  [a ^ ((p - 1) div q) = 1] (mod p)\n  ?x \\<in># prime_factorization (p - 1) \\<Longrightarrow>\n  [a ^ ((p - 1) div ?x) \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. False", "by metis"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  gcd x (p - 1) = p - 1\n\ngoal (1 subgoal):\n 1. [a ^ x = 1] (mod p) \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  gcd x (p - 1) = p - 1", "show False"], ["proof (prove)\nusing this:\n  gcd x (p - 1) = p - 1\n\ngoal (1 subgoal):\n 1. False", "using \\<open>x < p - 1\\<close>"], ["proof (prove)\nusing this:\n  gcd x (p - 1) = p - 1\n  x < p - 1\n\ngoal (1 subgoal):\n 1. False", "by (metis \\<open>0 < x\\<close> gcd_le1_nat gr_implies_not0 linorder_not_less)"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  [a ^ x \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "}"], ["proof (state)\nthis:\n  \\<lbrakk>0 < ?x2; ?x2 < p - 1\\<rbrakk>\n  \\<Longrightarrow> [a ^ ?x2 \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a \\<noteq> 1] (mod p) \\<Longrightarrow> prime p", "with lehmers_weak_theorem[OF \\<open>2 \\<le> p\\<close> _ cong1]"], ["proof (chain)\npicking this:\n  (\\<And>x.\n      \\<lbrakk>0 < x; x < p - 1\\<rbrakk>\n      \\<Longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<Longrightarrow>\n  prime p\n  \\<lbrakk>0 < ?x2; ?x2 < p - 1\\<rbrakk>\n  \\<Longrightarrow> [a ^ ?x2 \\<noteq> 1] (mod p)", "show ?thesis"], ["proof (prove)\nusing this:\n  (\\<And>x.\n      \\<lbrakk>0 < x; x < p - 1\\<rbrakk>\n      \\<Longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<Longrightarrow>\n  prime p\n  \\<lbrakk>0 < ?x2; ?x2 < p - 1\\<rbrakk>\n  \\<Longrightarrow> [a ^ ?x2 \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. prime p", "by metis"], ["proof (state)\nthis:\n  prime p\n\ngoal:\nNo subgoals!", "qed"], ["", "text \\<open>\n  The converse of Lehmer's theorem is also true.\n\\<close>"], ["", "lemma converse_lehmer_weak:\n assumes prime_p: \"prime p\"\n shows \"\\<exists> a. [a^(p - 1) = 1] (mod p) \\<and> (\\<forall> x . 0 < x \\<longrightarrow> x \\<le> p - 2 \\<longrightarrow> [a^x \\<noteq> 1] (mod p))\n             \\<and> a > 0 \\<and> a < p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"p \\<ge> 2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<le> p", "by (rule prime_ge_2_nat[OF prime_p])"], ["proof (state)\nthis:\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "obtain a where a:\"a \\<in> {1 .. p - 1} \\<and> {1 .. p - 1} = {a^i mod p | i . i \\<in> UNIV}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>a.\n        a \\<in> {1..p - 1} \\<and>\n        {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV} \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "using residue_prime_mult_group_has_gen[OF prime_p]"], ["proof (prove)\nusing this:\n  \\<exists>a\\<in>{1..p - 1}. {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. (\\<And>a.\n        a \\<in> {1..p - 1} \\<and>\n        {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV} \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "{"], ["proof (state)\nthis:\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "{"], ["proof (state)\nthis:\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "fix x::nat"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "assume x:\"0 < x \\<and> x \\<le> p - 2 \\<and> [a^x = 1] (mod p)\""], ["proof (state)\nthis:\n  0 < x \\<and> x \\<le> p - 2 \\<and> [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"{a^i mod p| i. i \\<in> UNIV} = {a^i mod p | i. 0 < i \\<and> i \\<le> x}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV} =\n    {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n 2. {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n    \\<subseteq> {a ^ i mod p |i. i \\<in> UNIV}", "show \"{a ^ i mod p | i. 0 < i \\<and> i \\<le> x} \\<subseteq> {a ^ i mod p | i. i \\<in> UNIV}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n    \\<subseteq> {a ^ i mod p |i. i \\<in> UNIV}", "by blast"], ["proof (state)\nthis:\n  {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n  \\<subseteq> {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "{"], ["proof (state)\nthis:\n  {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n  \\<subseteq> {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "fix y"], ["proof (state)\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "assume y:\"y \\<in> {a^i mod p| i . i \\<in> UNIV}\""], ["proof (state)\nthis:\n  y \\<in> {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "then"], ["proof (chain)\npicking this:\n  y \\<in> {a ^ i mod p |i. i \\<in> UNIV}", "obtain i where i:\"y = a^i mod p\""], ["proof (prove)\nusing this:\n  y \\<in> {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. (\\<And>i. y = a ^ i mod p \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  y = a ^ i mod p\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "define q r where \"q = i div x\" and \"r = i mod x\""], ["proof (state)\nthis:\n  q = i div x\n  r = i mod x\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "have \"i = q*x + r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. i = q * x + r", "by (simp add: r_def q_def)"], ["proof (state)\nthis:\n  i = q * x + r\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "hence y_q_r:\"y = (((a ^ (q*x)) mod p) * ((a ^ r) mod p)) mod p\""], ["proof (prove)\nusing this:\n  i = q * x + r\n\ngoal (1 subgoal):\n 1. y = a ^ (q * x) mod p * (a ^ r mod p) mod p", "by (simp add: i power_add mod_mult_eq)"], ["proof (state)\nthis:\n  y = a ^ (q * x) mod p * (a ^ r mod p) mod p\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "have \"a ^ (q*x) mod p = (a ^ x mod p) ^ q mod p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. a ^ (q * x) mod p = (a ^ x mod p) ^ q mod p", "by (simp add: power_mod mult.commute power_mult[symmetric])"], ["proof (state)\nthis:\n  a ^ (q * x) mod p = (a ^ x mod p) ^ q mod p\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "then"], ["proof (chain)\npicking this:\n  a ^ (q * x) mod p = (a ^ x mod p) ^ q mod p", "have y_r:\"y = a ^ r mod p\""], ["proof (prove)\nusing this:\n  a ^ (q * x) mod p = (a ^ x mod p) ^ q mod p\n\ngoal (1 subgoal):\n 1. y = a ^ r mod p", "using \\<open>p\\<ge>2\\<close> x"], ["proof (prove)\nusing this:\n  a ^ (q * x) mod p = (a ^ x mod p) ^ q mod p\n  2 \\<le> p\n  0 < x \\<and> x \\<le> p - 2 \\<and> [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. y = a ^ r mod p", "by (simp add: cong_def y_q_r)"], ["proof (state)\nthis:\n  y = a ^ r mod p\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "have \"y \\<in> {a ^ i mod p | i. 0 < i \\<and> i \\<le> x}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "proof (cases)"], ["proof (state)\ngoal (2 subgoals):\n 1. ?P \\<Longrightarrow> y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n 2. \\<not> ?P \\<Longrightarrow>\n    y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "assume \"r = 0\""], ["proof (state)\nthis:\n  r = 0\n\ngoal (2 subgoals):\n 1. ?P \\<Longrightarrow> y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n 2. \\<not> ?P \\<Longrightarrow>\n    y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "then"], ["proof (chain)\npicking this:\n  r = 0", "have \"y = a^x mod p\""], ["proof (prove)\nusing this:\n  r = 0\n\ngoal (1 subgoal):\n 1. y = a ^ x mod p", "using \\<open>p\\<ge>2\\<close> x"], ["proof (prove)\nusing this:\n  r = 0\n  2 \\<le> p\n  0 < x \\<and> x \\<le> p - 2 \\<and> [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. y = a ^ x mod p", "by (simp add: cong_def y_r)"], ["proof (state)\nthis:\n  y = a ^ x mod p\n\ngoal (2 subgoals):\n 1. ?P \\<Longrightarrow> y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n 2. \\<not> ?P \\<Longrightarrow>\n    y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "thus ?thesis"], ["proof (prove)\nusing this:\n  y = a ^ x mod p\n\ngoal (1 subgoal):\n 1. y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "using x"], ["proof (prove)\nusing this:\n  y = a ^ x mod p\n  0 < x \\<and> x \\<le> p - 2 \\<and> [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "by blast"], ["proof (state)\nthis:\n  y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. r \\<noteq> 0 \\<Longrightarrow>\n    y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. r \\<noteq> 0 \\<Longrightarrow>\n    y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "assume \"r \\<noteq> 0\""], ["proof (state)\nthis:\n  r \\<noteq> 0\n\ngoal (1 subgoal):\n 1. r \\<noteq> 0 \\<Longrightarrow>\n    y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "thus ?thesis"], ["proof (prove)\nusing this:\n  r \\<noteq> 0\n\ngoal (1 subgoal):\n 1. y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "using x"], ["proof (prove)\nusing this:\n  r \\<noteq> 0\n  0 < x \\<and> x \\<le> p - 2 \\<and> [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "by (auto simp add: y_r r_def)"], ["proof (state)\nthis:\n  y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  y \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "}"], ["proof (state)\nthis:\n  ?y2 \\<in> {a ^ i mod p |i. i \\<in> UNIV} \\<Longrightarrow>\n  ?y2 \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "thus \" {a ^ i mod p|i. i \\<in> UNIV} \\<subseteq> {a ^ i mod p | i. 0 < i \\<and> i \\<le> x}\""], ["proof (prove)\nusing this:\n  ?y2 \\<in> {a ^ i mod p |i. i \\<in> UNIV} \\<Longrightarrow>\n  ?y2 \\<in> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. i \\<in> UNIV}\n    \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}", "by auto"], ["proof (state)\nthis:\n  {a ^ i mod p |i. i \\<in> UNIV}\n  \\<subseteq> {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  {a ^ i mod p |i. i \\<in> UNIV} = {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "note X = this"], ["proof (state)\nthis:\n  {a ^ i mod p |i. i \\<in> UNIV} = {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"p - 1 = card {1 .. p - 1}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p - 1 = card {1..p - 1}", "by auto"], ["proof (state)\nthis:\n  p - 1 = card {1..p - 1}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "also"], ["proof (state)\nthis:\n  p - 1 = card {1..p - 1}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"{1 .. p - 1} = {a^i mod p | i. 1 \\<le> i \\<and> i \\<le> x}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {1..p - 1} = {a ^ i mod p |i. 1 \\<le> i \\<and> i \\<le> x}", "using X a"], ["proof (prove)\nusing this:\n  {a ^ i mod p |i. i \\<in> UNIV} = {a ^ i mod p |i. 0 < i \\<and> i \\<le> x}\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. {1..p - 1} = {a ^ i mod p |i. 1 \\<le> i \\<and> i \\<le> x}", "by auto"], ["proof (state)\nthis:\n  {1..p - 1} = {a ^ i mod p |i. 1 \\<le> i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "also"], ["proof (state)\nthis:\n  {1..p - 1} = {a ^ i mod p |i. 1 \\<le> i \\<and> i \\<le> x}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"\\<dots> = (\\<lambda> i. a^i mod p) ` {1..x}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {a ^ i mod p |i. 1 \\<le> i \\<and> i \\<le> x} =\n    (\\<lambda>i. a ^ i mod p) ` {1..x}", "by auto"], ["proof (state)\nthis:\n  {a ^ i mod p |i. 1 \\<le> i \\<and> i \\<le> x} =\n  (\\<lambda>i. a ^ i mod p) ` {1..x}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "also"], ["proof (state)\nthis:\n  {a ^ i mod p |i. 1 \\<le> i \\<and> i \\<le> x} =\n  (\\<lambda>i. a ^ i mod p) ` {1..x}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"card \\<dots> \\<le> p - 2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. card ((\\<lambda>i. a ^ i mod p) ` {1..x}) \\<le> p - 2", "using Finite_Set.card_image_le[of \"{1..x}\" \"\\<lambda> i. a^i mod p\"] x"], ["proof (prove)\nusing this:\n  finite {1..x} \\<Longrightarrow>\n  card ((\\<lambda>i. a ^ i mod p) ` {1..x}) \\<le> card {1..x}\n  0 < x \\<and> x \\<le> p - 2 \\<and> [a ^ x = 1] (mod p)\n\ngoal (1 subgoal):\n 1. card ((\\<lambda>i. a ^ i mod p) ` {1..x}) \\<le> p - 2", "by auto"], ["proof (state)\nthis:\n  card ((\\<lambda>i. a ^ i mod p) ` {1..x}) \\<le> p - 2\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "finally"], ["proof (chain)\npicking this:\n  p - 1 \\<le> p - 2", "have False"], ["proof (prove)\nusing this:\n  p - 1 \\<le> p - 2\n\ngoal (1 subgoal):\n 1. False", "using \\<open>2 \\<le> p\\<close>"], ["proof (prove)\nusing this:\n  p - 1 \\<le> p - 2\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. False", "by arith"], ["proof (state)\nthis:\n  False\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "}"], ["proof (state)\nthis:\n  0 < ?x2 \\<and>\n  ?x2 \\<le> p - 2 \\<and> [a ^ ?x2 = 1] (mod p) \\<Longrightarrow>\n  False\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "hence \"\\<forall> x . 0 < x \\<longrightarrow> x \\<le> p - 2 \\<longrightarrow> [a^x \\<noteq> 1] (mod p)\""], ["proof (prove)\nusing this:\n  0 < ?x2 \\<and>\n  ?x2 \\<le> p - 2 \\<and> [a ^ ?x2 = 1] (mod p) \\<Longrightarrow>\n  False\n\ngoal (1 subgoal):\n 1. \\<forall>x>0. x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)", "by auto"], ["proof (state)\nthis:\n  \\<forall>x>0. x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "}"], ["proof (state)\nthis:\n  \\<forall>x>0. x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "note a_is_gen = this"], ["proof (state)\nthis:\n  \\<forall>x>0. x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "{"], ["proof (state)\nthis:\n  \\<forall>x>0. x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "assume \"a>1\""], ["proof (state)\nthis:\n  1 < a\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"\\<not> p dvd a \""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> p dvd a", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> \\<not> p dvd a \\<Longrightarrow> False", "assume \"\\<not> \\<not> p dvd a\""], ["proof (state)\nthis:\n  \\<not> \\<not> p dvd a\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> p dvd a \\<Longrightarrow> False", "hence \"p dvd a\""], ["proof (prove)\nusing this:\n  \\<not> \\<not> p dvd a\n\ngoal (1 subgoal):\n 1. p dvd a", "by auto"], ["proof (state)\nthis:\n  p dvd a\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> p dvd a \\<Longrightarrow> False", "have \"p \\<le> a\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p \\<le> a", "using dvd_nat_bounds[OF _ \\<open>p dvd a\\<close>] a"], ["proof (prove)\nusing this:\n  0 < a \\<Longrightarrow> 0 < p \\<and> p \\<le> a\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. p \\<le> a", "by simp"], ["proof (state)\nthis:\n  p \\<le> a\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> p dvd a \\<Longrightarrow> False", "thus False"], ["proof (prove)\nusing this:\n  p \\<le> a\n\ngoal (1 subgoal):\n 1. False", "using \\<open>a>1\\<close> a"], ["proof (prove)\nusing this:\n  p \\<le> a\n  1 < a\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. False", "by force"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<not> p dvd a\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "hence \"coprime a p\""], ["proof (prove)\nusing this:\n  \\<not> p dvd a\n\ngoal (1 subgoal):\n 1. coprime a p", "using prime_imp_coprime_nat [OF prime_p]"], ["proof (prove)\nusing this:\n  \\<not> p dvd a\n  \\<not> p dvd ?n \\<Longrightarrow> coprime p ?n\n\ngoal (1 subgoal):\n 1. coprime a p", "by (simp add: ac_simps)"], ["proof (state)\nthis:\n  coprime a p\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "then"], ["proof (chain)\npicking this:\n  coprime a p", "have \"[a ^ totient p = 1] (mod p)\""], ["proof (prove)\nusing this:\n  coprime a p\n\ngoal (1 subgoal):\n 1. [a ^ totient p = 1] (mod p)", "by (rule euler_theorem)"], ["proof (state)\nthis:\n  [a ^ totient p = 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "also"], ["proof (state)\nthis:\n  [a ^ totient p = 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "from prime_p"], ["proof (chain)\npicking this:\n  prime p", "have \"totient p = p - 1\""], ["proof (prove)\nusing this:\n  prime p\n\ngoal (1 subgoal):\n 1. totient p = p - 1", "by (rule totient_prime)"], ["proof (state)\nthis:\n  totient p = p - 1\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "finally"], ["proof (chain)\npicking this:\n  [a ^ (p - 1) = 1] (mod p)", "have \"[a ^ (p - 1) = 1] (mod p)\""], ["proof (prove)\nusing this:\n  [a ^ (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a ^ (p - 1) = 1] (mod p)", "."], ["proof (state)\nthis:\n  [a ^ (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "}"], ["proof (state)\nthis:\n  1 < a \\<Longrightarrow> [a ^ (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "hence \"[a^(p - 1) = 1] (mod p)\""], ["proof (prove)\nusing this:\n  1 < a \\<Longrightarrow> [a ^ (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. [a ^ (p - 1) = 1] (mod p)", "using a"], ["proof (prove)\nusing this:\n  1 < a \\<Longrightarrow> [a ^ (p - 1) = 1] (mod p)\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. [a ^ (p - 1) = 1] (mod p)", "by fastforce"], ["proof (state)\nthis:\n  [a ^ (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "thus ?thesis"], ["proof (prove)\nusing this:\n  [a ^ (p - 1) = 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "using a_is_gen a"], ["proof (prove)\nusing this:\n  [a ^ (p - 1) = 1] (mod p)\n  \\<forall>x>0. x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)\n  a \\<in> {1..p - 1} \\<and> {1..p - 1} = {a ^ i mod p |i. i \\<in> UNIV}\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>x>0.\n           x \\<le> p - 2 \\<longrightarrow>\n           [a ^ x \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "by auto"], ["proof (state)\nthis:\n  \\<exists>a.\n     [a ^ (p - 1) = 1] (mod p) \\<and>\n     (\\<forall>x>0.\n         x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<and>\n     0 < a \\<and> a < p\n\ngoal:\nNo subgoals!", "qed"], ["", "theorem converse_lehmer:\n assumes prime_p:\"prime(p)\"\n shows \"\\<exists> a . [a^(p - 1) = 1] (mod p) \\<and>\n              (\\<forall> q. q \\<in> prime_factors (p - 1) \\<longrightarrow> [a^((p - 1) div q) \\<noteq> 1] (mod p))\n              \\<and> a > 0 \\<and> a < p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"p \\<ge> 2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<le> p", "by (rule prime_ge_2_nat[OF prime_p])"], ["proof (state)\nthis:\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "obtain a where a:\"[a^(p - 1) = 1] (mod p) \\<and> (\\<forall> x . 0 < x \\<longrightarrow> x \\<le> p - 2 \\<longrightarrow> [a^x \\<noteq> 1] (mod p))\n                    \\<and> a > 0 \\<and> a < p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>a.\n        [a ^ (p - 1) = 1] (mod p) \\<and>\n        (\\<forall>x>0.\n            x \\<le> p - 2 \\<longrightarrow>\n            [a ^ x \\<noteq> 1] (mod p)) \\<and>\n        0 < a \\<and> a < p \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "using converse_lehmer_weak[OF prime_p]"], ["proof (prove)\nusing this:\n  \\<exists>a.\n     [a ^ (p - 1) = 1] (mod p) \\<and>\n     (\\<forall>x>0.\n         x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<and>\n     0 < a \\<and> a < p\n\ngoal (1 subgoal):\n 1. (\\<And>a.\n        [a ^ (p - 1) = 1] (mod p) \\<and>\n        (\\<forall>x>0.\n            x \\<le> p - 2 \\<longrightarrow>\n            [a ^ x \\<noteq> 1] (mod p)) \\<and>\n        0 < a \\<and> a < p \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  [a ^ (p - 1) = 1] (mod p) \\<and>\n  (\\<forall>x>0.\n      x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<and>\n  0 < a \\<and> a < p\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "{"], ["proof (state)\nthis:\n  [a ^ (p - 1) = 1] (mod p) \\<and>\n  (\\<forall>x>0.\n      x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<and>\n  0 < a \\<and> a < p\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "fix q"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "assume q:\"q \\<in> prime_factors (p - 1)\""], ["proof (state)\nthis:\n  q \\<in># prime_factorization (p - 1)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "hence \"0 < q \\<and> q \\<le> p - 1\""], ["proof (prove)\nusing this:\n  q \\<in># prime_factorization (p - 1)\n\ngoal (1 subgoal):\n 1. 0 < q \\<and> q \\<le> p - 1", "using \\<open>p\\<ge>2\\<close>"], ["proof (prove)\nusing this:\n  q \\<in># prime_factorization (p - 1)\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. 0 < q \\<and> q \\<le> p - 1", "by (auto simp add: dvd_nat_bounds prime_factors_gt_0_nat)"], ["proof (state)\nthis:\n  0 < q \\<and> q \\<le> p - 1\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "hence \"(p - 1) div q \\<ge> 1\""], ["proof (prove)\nusing this:\n  0 < q \\<and> q \\<le> p - 1\n\ngoal (1 subgoal):\n 1. 1 \\<le> (p - 1) div q", "using div_le_mono[of \"q\" \"p - 1\" q] div_self[of q]"], ["proof (prove)\nusing this:\n  0 < q \\<and> q \\<le> p - 1\n  q \\<le> p - 1 \\<Longrightarrow> q div q \\<le> (p - 1) div q\n  q \\<noteq> 0 \\<Longrightarrow> q div q = 1\n\ngoal (1 subgoal):\n 1. 1 \\<le> (p - 1) div q", "by simp"], ["proof (state)\nthis:\n  1 \\<le> (p - 1) div q\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "have \"q \\<ge> 2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<le> q", "using q"], ["proof (prove)\nusing this:\n  q \\<in># prime_factorization (p - 1)\n\ngoal (1 subgoal):\n 1. 2 \\<le> q", "by (auto intro: prime_ge_2_nat)"], ["proof (state)\nthis:\n  2 \\<le> q\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "hence \"(p - 1) div q < p - 1\""], ["proof (prove)\nusing this:\n  2 \\<le> q\n\ngoal (1 subgoal):\n 1. (p - 1) div q < p - 1", "using \\<open>p \\<ge> 2\\<close>"], ["proof (prove)\nusing this:\n  2 \\<le> q\n  2 \\<le> p\n\ngoal (1 subgoal):\n 1. (p - 1) div q < p - 1", "by simp"], ["proof (state)\nthis:\n  (p - 1) div q < p - 1\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "hence \"[a^((p - 1) div q) \\<noteq> 1] (mod p)\""], ["proof (prove)\nusing this:\n  (p - 1) div q < p - 1\n\ngoal (1 subgoal):\n 1. [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)", "using a \\<open>(p - 1) div q \\<ge> 1\\<close>"], ["proof (prove)\nusing this:\n  (p - 1) div q < p - 1\n  [a ^ (p - 1) = 1] (mod p) \\<and>\n  (\\<forall>x>0.\n      x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<and>\n  0 < a \\<and> a < p\n  1 \\<le> (p - 1) div q\n\ngoal (1 subgoal):\n 1. [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)", "by (auto simp add: Suc_diff_Suc less_eq_Suc_le)"], ["proof (state)\nthis:\n  [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "}"], ["proof (state)\nthis:\n  ?q2 \\<in># prime_factorization (p - 1) \\<Longrightarrow>\n  [a ^ ((p - 1) div ?q2) \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "thus ?thesis"], ["proof (prove)\nusing this:\n  ?q2 \\<in># prime_factorization (p - 1) \\<Longrightarrow>\n  [a ^ ((p - 1) div ?q2) \\<noteq> 1] (mod p)\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "using a"], ["proof (prove)\nusing this:\n  ?q2 \\<in># prime_factorization (p - 1) \\<Longrightarrow>\n  [a ^ ((p - 1) div ?q2) \\<noteq> 1] (mod p)\n  [a ^ (p - 1) = 1] (mod p) \\<and>\n  (\\<forall>x>0.\n      x \\<le> p - 2 \\<longrightarrow> [a ^ x \\<noteq> 1] (mod p)) \\<and>\n  0 < a \\<and> a < p\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       [a ^ (p - 1) = 1] (mod p) \\<and>\n       (\\<forall>q.\n           q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n           [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n       0 < a \\<and> a < p", "by auto"], ["proof (state)\nthis:\n  \\<exists>a.\n     [a ^ (p - 1) = 1] (mod p) \\<and>\n     (\\<forall>q.\n         q \\<in># prime_factorization (p - 1) \\<longrightarrow>\n         [a ^ ((p - 1) div q) \\<noteq> 1] (mod p)) \\<and>\n     0 < a \\<and> a < p\n\ngoal:\nNo subgoals!", "qed"], ["", "end"]]}