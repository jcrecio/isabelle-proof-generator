{"file_name": "/home/qj213/afp-2021-10-22/thys/Stateful_Protocol_Composition_and_Typing/More_Unification.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Stateful_Protocol_Composition_and_Typing", "problem_names": ["lemma subst_support_def: \"\\<theta> supports \\<tau> \\<longleftrightarrow> \\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>\"", "lemma subst_supportD: \"\\<theta> supports \\<delta> \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\"", "lemma rm_vars_empty[simp]: \"rm_vars {} s = s\" \"rm_vars (set []) s = s\"", "lemma rm_vars_singleton: \"rm_vars {v} s = rm_var v s\"", "lemma subst_apply_terms_empty: \"M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var = M\"", "lemma subst_agreement: \"(t \\<cdot> r = t \\<cdot> s) \\<longleftrightarrow> (\\<forall>v \\<in> fv t. Var v \\<cdot> r = Var v \\<cdot> s)\"", "lemma repl_invariance[dest?]: \"v \\<notin> fv t \\<Longrightarrow> t \\<cdot> s(v := u) = t \\<cdot> s\"", "lemma subst_idx_map:\n  assumes \"\\<forall>i \\<in> set I. i < length T\"\n  shows \"(map ((!) T) I) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> = map ((!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T)) I\"", "lemma subst_idx_map':\n  assumes \"\\<forall>i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K). i < length T\"\n  shows \"(K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> = K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t ((!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T))\" (is \"?A = ?B\")", "lemma subst_remove_var: \"v \\<notin> fv s \\<Longrightarrow> v \\<notin> fv (t \\<cdot> Var(v := s))\"", "lemma subst_set_map: \"x \\<in> set X \\<Longrightarrow> x \\<cdot> s \\<in> set (map (\\<lambda>x. x \\<cdot> s) X)\"", "lemma subst_set_idx_map:\n  assumes \"\\<forall>i \\<in> I. i < length T\"\n  shows \"(!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> = (!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T) ` I\" (is \"?A = ?B\")", "lemma subst_set_idx_map':\n  assumes \"\\<forall>i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t K. i < length T\"\n  shows \"K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> = K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T)\" (is \"?A = ?B\")", "lemma subst_term_list_obtain:\n  assumes \"\\<forall>i < length T. \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\"\n    and \"length T = length S\"\n  shows \"\\<exists>U. length T = length U \\<and> (\\<forall>i < length T. P (T ! i) (U ! i)) \\<and> S = map (\\<lambda>u. u \\<cdot> \\<delta>) U\"", "lemma subst_mono: \"t \\<sqsubseteq> u \\<Longrightarrow> t \\<cdot> s \\<sqsubseteq> u \\<cdot> s\"", "lemma subst_mono_fv: \"x \\<in> fv t \\<Longrightarrow> s x \\<sqsubseteq> t \\<cdot> s\"", "lemma subst_mono_neq:\n  assumes \"t \\<sqsubset> u\"\n  shows \"t \\<cdot> s \\<sqsubset> u \\<cdot> s\"", "lemma subst_no_occs[dest]: \"\\<not>Var v \\<sqsubseteq> t \\<Longrightarrow> t \\<cdot> Var(v := s) = t\"", "lemma var_comp[simp]: \"\\<sigma> \\<circ>\\<^sub>s Var = \\<sigma>\" \"Var \\<circ>\\<^sub>s \\<sigma> = \\<sigma>\"", "lemma subst_comp_all: \"M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> \\<circ>\\<^sub>s \\<theta>) = (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"", "lemma subst_all_mono: \"M \\<subseteq> M' \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s \\<subseteq> M' \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s\"", "lemma subst_comp_set_image: \"(\\<delta> \\<circ>\\<^sub>s \\<theta>) ` X = \\<delta> ` X \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"", "lemma subst_ground_ident[dest?]: \"fv t = {} \\<Longrightarrow> t \\<cdot> s = t\"", "lemma subst_ground_ident_compose:\n  \"fv (\\<sigma> x) = {} \\<Longrightarrow> (\\<sigma> \\<circ>\\<^sub>s \\<theta>) x = \\<sigma> x\"\n  \"fv (t \\<cdot> \\<sigma>) = {} \\<Longrightarrow> t \\<cdot> (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = t \\<cdot> \\<sigma>\"", "lemma subst_all_ground_ident[dest?]: \"ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M\"", "lemma subst_eqI[intro]: \"(\\<And>t. t \\<cdot> \\<sigma> = t \\<cdot> \\<theta>) \\<Longrightarrow> \\<sigma> = \\<theta>\"", "lemma subst_cong: \"\\<lbrakk>\\<sigma> = \\<sigma>'; \\<theta> = \\<theta>'\\<rbrakk> \\<Longrightarrow> (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = (\\<sigma>' \\<circ>\\<^sub>s \\<theta>')\"", "lemma subst_mgt_bot[simp]: \"Var \\<preceq>\\<^sub>\\<circ> \\<theta>\"", "lemma subst_mgt_refl[simp]: \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>\"", "lemma subst_mgt_trans: \"\\<lbrakk>\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>; \\<delta> \\<preceq>\\<^sub>\\<circ> \\<sigma>\\<rbrakk> \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<sigma>\"", "lemma subst_mgt_comp: \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<delta>\"", "lemma subst_mgt_comp': \"\\<theta> \\<circ>\\<^sub>s \\<delta> \\<preceq>\\<^sub>\\<circ> \\<sigma> \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<sigma>\"", "lemma var_self: \"(\\<lambda>w. if w = v then Var v else Var w) = Var\"", "lemma var_same[simp]: \"Var(v := t) = Var \\<longleftrightarrow> t = Var v\"", "lemma subst_eq_if_eq_vars: \"(\\<And>v. (Var v) \\<cdot> \\<theta> = (Var v) \\<cdot> \\<sigma>) \\<Longrightarrow> \\<theta> = \\<sigma>\"", "lemma subst_all_empty[simp]: \"{} \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = {}\"", "lemma subst_all_insert:\"(insert t M) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> = insert (t \\<cdot> \\<delta>) (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>)\"", "lemma subst_apply_fv_subset: \"fv t \\<subseteq> V \\<Longrightarrow> fv (t \\<cdot> \\<delta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V)\"", "lemma subst_apply_fv_empty:\n  assumes \"fv t = {}\"\n  shows \"fv (t \\<cdot> \\<sigma>) = {}\"", "lemma subst_compose_fv:\n  assumes \"fv (\\<theta> x) = {}\"\n  shows \"fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) x) = {}\"", "lemma subst_compose_fv':\n  fixes \\<theta> \\<sigma>::\"('a,'b) subst\"\n  assumes \"y \\<in> fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) x)\"\n  shows \"\\<exists>z. z \\<in> fv (\\<theta> x)\"", "lemma subst_apply_fv_unfold: \"fv (t \\<cdot> \\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)\"", "lemma subst_apply_fv_unfold': \"fv (t \\<cdot> \\<delta>) = (\\<Union>v \\<in> fv t. fv (\\<delta> v))\"", "lemma subst_apply_fv_union: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union> fv (t \\<cdot> \\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))\"", "lemma subst_elimI[intro]: \"(\\<And>t. v \\<notin> fv (t \\<cdot> \\<sigma>)) \\<Longrightarrow> subst_elim \\<sigma> v\"", "lemma subst_elimI'[intro]: \"(\\<And>w. v \\<notin> fv (Var w \\<cdot> \\<theta>)) \\<Longrightarrow> subst_elim \\<theta> v\"", "lemma subst_elimD[dest]: \"subst_elim \\<sigma> v \\<Longrightarrow> v \\<notin> fv (t \\<cdot> \\<sigma>)\"", "lemma subst_elimD'[dest]: \"subst_elim \\<sigma> v \\<Longrightarrow> \\<sigma> v \\<noteq> Var v\"", "lemma subst_elimD''[dest]: \"subst_elim \\<sigma> v \\<Longrightarrow> v \\<notin> fv (\\<sigma> w)\"", "lemma subst_elim_rm_vars_dest[dest]:\n  \"subst_elim (\\<sigma>::('a,'b) subst) v \\<Longrightarrow> v \\<notin> vs \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v\"", "lemma occs_subst_elim: \"\\<not>Var v \\<sqsubset> t \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> (Var(v := t)) = Var\"", "lemma occs_subst_elim': \"\\<not>Var v \\<sqsubseteq> t \\<Longrightarrow> subst_elim (Var(v := t)) v\"", "lemma subst_elim_comp: \"subst_elim \\<theta> v \\<Longrightarrow> subst_elim (\\<delta> \\<circ>\\<^sub>s \\<theta>) v\"", "lemma var_subst_idem: \"subst_idem Var\"", "lemma var_upd_subst_idem:\n  assumes \"\\<not>Var v \\<sqsubseteq> t\" shows \"subst_idem (Var(v := t))\"", "lemma range_vars_alt_def: \"range_vars s \\<equiv> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)\"", "lemma subst_dom_var_finite[simp]: \"finite (subst_domain Var)\"", "lemma subst_range_Var[simp]: \"subst_range Var = {}\"", "lemma range_vars_Var[simp]: \"range_vars Var = {}\"", "lemma finite_subst_img_if_finite_dom: \"finite (subst_domain \\<sigma>) \\<Longrightarrow> finite (range_vars \\<sigma>)\"", "lemma finite_subst_img_if_finite_dom': \"finite (subst_domain \\<sigma>) \\<Longrightarrow> finite (subst_range \\<sigma>)\"", "lemma subst_img_alt_def: \"subst_range s = {t. \\<exists>v. s v = t \\<and> t \\<noteq> Var v}\"", "lemma subst_fv_img_alt_def: \"range_vars s = (\\<Union>t \\<in> {t. \\<exists>v. s v = t \\<and> t \\<noteq> Var v}. fv t)\"", "lemma subst_domI[intro]: \"\\<sigma> v \\<noteq> Var v \\<Longrightarrow> v \\<in> subst_domain \\<sigma>\"", "lemma subst_imgI[intro]: \"\\<sigma> v \\<noteq> Var v \\<Longrightarrow> \\<sigma> v \\<in> subst_range \\<sigma>\"", "lemma subst_fv_imgI[intro]: \"\\<sigma> v \\<noteq> Var v \\<Longrightarrow> fv (\\<sigma> v) \\<subseteq> range_vars \\<sigma>\"", "lemma subst_domain_subst_Fun_single[simp]:\n  \"subst_domain (Var(x := Fun f T)) = {x}\" (is \"?A = ?B\")", "lemma subst_range_subst_Fun_single[simp]:\n  \"subst_range (Var(x := Fun f T)) = {Fun f T}\" (is \"?A = ?B\")", "lemma range_vars_subst_Fun_single[simp]:\n  \"range_vars (Var(x := Fun f T)) = fv (Fun f T)\"", "lemma var_renaming_is_Fun_iff:\n  assumes \"subst_range \\<delta> \\<subseteq> range Var\"\n  shows \"is_Fun t = is_Fun (t \\<cdot> \\<delta>)\"", "lemma subst_fv_dom_img_subset: \"fv t \\<subseteq> subst_domain \\<theta> \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> range_vars \\<theta>\"", "lemma subst_fv_dom_img_subset_set: \"fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<subseteq> subst_domain \\<theta> \\<Longrightarrow> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<subseteq> range_vars \\<theta>\"", "lemma subst_fv_dom_ground_if_ground_img:\n  assumes \"fv t \\<subseteq> subst_domain s\" \"ground (subst_range s)\"\n  shows \"fv (t \\<cdot> s) = {}\"", "lemma subst_fv_dom_ground_if_ground_img':\n  assumes \"fv t \\<subseteq> subst_domain s\" \"\\<And>x. x \\<in> subst_domain s \\<Longrightarrow> fv (s x) = {}\"\n  shows \"fv (t \\<cdot> s) = {}\"", "lemma subst_fv_unfold: \"fv (t \\<cdot> s) = (fv t - subst_domain s) \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv t \\<inter> subst_domain s))\"", "lemma subst_fv_unfold_ground_img: \"range_vars s = {} \\<Longrightarrow> fv (t \\<cdot> s) = fv t - subst_domain s\"", "lemma subst_img_update:\n  \"\\<lbrakk>\\<sigma> v = Var v; t \\<noteq> Var v\\<rbrakk> \\<Longrightarrow> range_vars (\\<sigma>(v := t)) = range_vars \\<sigma> \\<union> fv t\"", "lemma subst_dom_update1: \"v \\<notin> subst_domain \\<sigma> \\<Longrightarrow> subst_domain (\\<sigma>(v := Var v)) = subst_domain \\<sigma>\"", "lemma subst_dom_update2: \"t \\<noteq> Var v \\<Longrightarrow> subst_domain (\\<sigma>(v := t)) = insert v (subst_domain \\<sigma>)\"", "lemma subst_dom_update3: \"t = Var v \\<Longrightarrow> subst_domain (\\<sigma>(v := t)) = subst_domain \\<sigma> - {v}\"", "lemma var_not_in_subst_dom[elim]: \"v \\<notin> subst_domain s \\<Longrightarrow> s v = Var v\"", "lemma subst_dom_vars_in_subst[elim]: \"v \\<in> subst_domain s \\<Longrightarrow> s v \\<noteq> Var v\"", "lemma subst_not_dom_fixed: \"\\<lbrakk>v \\<in> fv t; v \\<notin> subst_domain s\\<rbrakk> \\<Longrightarrow> v \\<in> fv (t \\<cdot> s)\"", "lemma subst_not_img_fixed: \"\\<lbrakk>v \\<in> fv (t \\<cdot> s); v \\<notin> range_vars s\\<rbrakk> \\<Longrightarrow> v \\<in> fv t\"", "lemma ground_range_vars[intro]: \"ground (subst_range s) \\<Longrightarrow> range_vars s = {}\"", "lemma ground_subst_no_var[intro]: \"ground (subst_range s) \\<Longrightarrow> x \\<notin> range_vars s\"", "lemma ground_img_obtain_fun:\n  assumes \"ground (subst_range s)\" \"x \\<in> subst_domain s\"\n  obtains f T where \"s x = Fun f T\" \"Fun f T \\<in> subst_range s\" \"fv (Fun f T) = {}\"", "lemma ground_term_subst_domain_fv_subset:\n  \"fv (t \\<cdot> \\<delta>) = {} \\<Longrightarrow> fv t \\<subseteq> subst_domain \\<delta>\"", "lemma ground_subst_range_empty_fv:\n  \"ground (subst_range \\<theta>) \\<Longrightarrow> x \\<in> subst_domain \\<theta> \\<Longrightarrow> fv (\\<theta> x) = {}\"", "lemma subst_Var_notin_img: \"x \\<notin> range_vars s \\<Longrightarrow> t \\<cdot> s = Var x \\<Longrightarrow> t = Var x\"", "lemma fv_in_subst_img: \"\\<lbrakk>s v = t; t \\<noteq> Var v\\<rbrakk> \\<Longrightarrow> fv t \\<subseteq> range_vars s\"", "lemma empty_dom_iff_empty_subst: \"subst_domain \\<theta> = {} \\<longleftrightarrow> \\<theta> = Var\"", "lemma subst_dom_cong: \"(\\<And>v t. \\<theta> v = t \\<Longrightarrow> \\<delta> v = t) \\<Longrightarrow> subst_domain \\<theta> \\<subseteq> subst_domain \\<delta>\"", "lemma subst_img_cong: \"(\\<And>v t. \\<theta> v = t \\<Longrightarrow> \\<delta> v = t) \\<Longrightarrow> range_vars \\<theta> \\<subseteq> range_vars \\<delta>\"", "lemma subst_dom_elim: \"subst_domain s \\<inter> range_vars s = {} \\<Longrightarrow> fv (t \\<cdot> s) \\<inter> subst_domain s = {}\"", "lemma subst_dom_insert_finite: \"finite (subst_domain s) = finite (subst_domain (s(v := t)))\"", "lemma trm_subst_disj: \"t \\<cdot> \\<theta> = t \\<Longrightarrow> fv t \\<inter> subst_domain \\<theta> = {}\"", "lemma trm_subst_ident[intro]: \"fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> t \\<cdot> \\<theta> = t\"", "lemma trm_subst_ident'[intro]: \"v \\<notin> subst_domain \\<theta> \\<Longrightarrow> (Var v) \\<cdot> \\<theta> = Var v\"", "lemma trm_subst_ident''[intro]: \"(\\<And>x. x \\<in> fv t \\<Longrightarrow> \\<theta> x = Var x) \\<Longrightarrow> t \\<cdot> \\<theta> = t\"", "lemma set_subst_ident: \"fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M\"", "lemma trm_subst_ident_subterms[intro]:\n  \"fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = subterms t\"", "lemma trm_subst_ident_subterms'[intro]:\n  \"v \\<notin> fv t \\<Longrightarrow> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var(v := s) = subterms t\"", "lemma const_mem_subst_cases:\n  assumes \"Fun c [] \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"\n  shows \"Fun c [] \\<in> M \\<or> Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M\"", "lemma const_mem_subst_cases':\n  assumes \"Fun c [] \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"\n  shows \"Fun c [] \\<in> M \\<or> Fun c [] \\<in> subst_range \\<theta>\"", "lemma fv_subterms_substI[intro]: \"y \\<in> fv t \\<Longrightarrow> \\<theta> y \\<in> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"", "lemma fv_subterms_subst_eq[simp]: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms (t \\<cdot> \\<theta>)) = fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\"", "lemma fv_subterms_set_subst: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\"", "lemma fv_subterms_set_subst': \"fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\"", "lemma fv_subst_subset: \"x \\<in> fv t \\<Longrightarrow> fv (\\<theta> x) \\<subseteq> fv (t \\<cdot> \\<theta>)\"", "lemma fv_subst_subset': \"fv s \\<subseteq> fv t \\<Longrightarrow> fv (s \\<cdot> \\<theta>) \\<subseteq> fv (t \\<cdot> \\<theta>)\"", "lemma fv_subst_obtain_var:\n  fixes \\<delta>::\"('a,'b) subst\"\n  assumes \"x \\<in> fv (t \\<cdot> \\<delta>)\"\n  shows \"\\<exists>y \\<in> fv t. x \\<in> fv (\\<delta> y)\"", "lemma set_subst_all_ident: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<inter> subst_domain \\<delta> = {} \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> \\<circ>\\<^sub>s \\<delta>) = M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"", "lemma subterms_subst:\n  \"subterms (t \\<cdot> d) = (subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d) \\<union> subterms\\<^sub>s\\<^sub>e\\<^sub>t (d ` (fv t \\<inter> subst_domain d))\"", "lemma subterms_subst':\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"\\<forall>x \\<in> fv t. (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\"\n  shows \"subterms (t \\<cdot> \\<theta>) = subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"", "lemma subterms_subst'':\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"\\<forall>x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M. (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\"\n  shows \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) = subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"", "lemma subterms_subst_subterm:\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"\\<forall>x \\<in> fv a. (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\"\n    and \"b \\<in> subterms (a \\<cdot> \\<theta>)\"\n  shows \"\\<exists>c \\<in> subterms a. c \\<cdot> \\<theta> = b\"", "lemma subterms_subst_subset: \"subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma> \\<subseteq> subterms (t \\<cdot> \\<sigma>)\"", "lemma subterms_subst_subset': \"subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma> \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma>)\"", "lemma subterms\\<^sub>s\\<^sub>e\\<^sub>t_subst:\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\"\n  shows \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<or> (\\<exists>x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M. t \\<in> subterms (\\<theta> x))\"", "lemma rm_vars_dom: \"subst_domain (rm_vars V s) = subst_domain s - V\"", "lemma rm_vars_dom_subset: \"subst_domain (rm_vars V s) \\<subseteq> subst_domain s\"", "lemma rm_vars_dom_eq':\n  \"subst_domain (rm_vars (UNIV - V) s) = subst_domain s \\<inter> V\"", "lemma rm_vars_img: \"subst_range (rm_vars V s) = s ` subst_domain (rm_vars V s)\"", "lemma rm_vars_img_subset: \"subst_range (rm_vars V s) \\<subseteq> subst_range s\"", "lemma rm_vars_img_fv_subset: \"range_vars (rm_vars V s) \\<subseteq> range_vars s\"", "lemma rm_vars_fv_obtain:\n  assumes \"x \\<in> fv (t \\<cdot> rm_vars X \\<theta>) - X\"\n  shows \"\\<exists>y \\<in> fv t - X. x \\<in> fv (rm_vars X \\<theta> y)\"", "lemma rm_vars_apply: \"v \\<in> subst_domain (rm_vars V s) \\<Longrightarrow> (rm_vars V s) v = s v\"", "lemma rm_vars_apply': \"subst_domain \\<delta> \\<inter> vs = {} \\<Longrightarrow> rm_vars vs \\<delta> = \\<delta>\"", "lemma rm_vars_ident: \"fv t \\<inter> vs = {} \\<Longrightarrow> t \\<cdot> (rm_vars vs \\<theta>) = t \\<cdot> \\<theta>\"", "lemma rm_vars_fv_subset: \"fv (t \\<cdot> rm_vars X \\<theta>) \\<subseteq> fv t \\<union> fv (t \\<cdot> \\<theta>)\"", "lemma rm_vars_fv_disj:\n  assumes \"fv t \\<inter> X = {}\" \"fv (t \\<cdot> \\<theta>) \\<inter> X = {}\"\n  shows \"fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\"", "lemma rm_vars_ground_supports:\n  assumes \"ground (subst_range \\<theta>)\"\n  shows \"rm_vars X \\<theta> supports \\<theta>\"", "lemma rm_vars_split:\n  assumes \"ground (subst_range \\<theta>)\"\n  shows \"\\<theta> = rm_vars X \\<theta> \\<circ>\\<^sub>s rm_vars (subst_domain \\<theta> - X) \\<theta>\"", "lemma rm_vars_fv_img_disj:\n  assumes \"fv t \\<inter> X = {}\" \"X \\<inter> range_vars \\<theta> = {}\"\n  shows \"fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\"", "lemma subst_apply_dom_ident: \"t \\<cdot> \\<theta> = t \\<Longrightarrow> subst_domain \\<delta> \\<subseteq> subst_domain \\<theta> \\<Longrightarrow> t \\<cdot> \\<delta> = t\"", "lemma rm_vars_subst_apply_ident:\n  assumes \"t \\<cdot> \\<theta> = t\"\n  shows \"t \\<cdot> (rm_vars vs \\<theta>) = t\"", "lemma rm_vars_subst_eq:\n  \"t \\<cdot> \\<delta> = t \\<cdot> rm_vars (subst_domain \\<delta> - subst_domain \\<delta> \\<inter> fv t) \\<delta>\"", "lemma rm_vars_subst_eq':\n  \"t \\<cdot> \\<delta> = t \\<cdot> rm_vars (UNIV - fv t) \\<delta>\"", "lemma rm_vars_comp:\n  assumes \"range_vars \\<delta> \\<inter> vs = {}\"\n  shows \"t \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) = t \\<cdot> (rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>)\"", "lemma rm_vars_fv\\<^sub>s\\<^sub>e\\<^sub>t_subst:\n  assumes \"x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (rm_vars X \\<theta> ` Y)\"\n  shows \"x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` Y) \\<or> x \\<in> X\"", "lemma disj_dom_img_var_notin:\n  assumes \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\" \"\\<theta> v = t\" \"t \\<noteq> Var v\"\n  shows \"v \\<notin> fv t\" \"\\<forall>v \\<in> fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>\"", "lemma subst_sends_dom_to_img: \"v \\<in> subst_domain \\<theta> \\<Longrightarrow> fv (Var v \\<cdot> \\<theta>) \\<subseteq> range_vars \\<theta>\"", "lemma subst_sends_fv_to_img: \"fv (t \\<cdot> s) \\<subseteq> fv t \\<union> range_vars s\"", "lemma ident_comp_subst_trm_if_disj:\n  assumes \"subst_domain \\<sigma> \\<inter> range_vars \\<theta> = {}\" \"v \\<in> subst_domain \\<theta>\"\n  shows \"(\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v\"", "lemma ident_comp_subst_trm_if_disj': \"fv (\\<theta> v) \\<inter> subst_domain \\<sigma> = {} \\<Longrightarrow> (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v\"", "lemma subst_idemI[intro]: \"subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {} \\<Longrightarrow> subst_idem \\<sigma>\"", "lemma subst_idemI'[intro]: \"ground (subst_range \\<sigma>) \\<Longrightarrow> subst_idem \\<sigma>\"", "lemma subst_idemE: \"subst_idem \\<sigma> \\<Longrightarrow> subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\"", "lemma subst_idem_rm_vars: \"subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)\"", "lemma subst_fv_bounded_if_img_bounded: \"range_vars \\<theta> \\<subseteq> fv t \\<union> V \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> fv t \\<union> V\"", "lemma subst_fv_bound_singleton: \"fv (t \\<cdot> Var(v := t')) \\<subseteq> fv t \\<union> fv t'\"", "lemma subst_fv_bounded_if_img_bounded':\n  assumes \"range_vars \\<theta> \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\"\n  shows \"fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\"", "lemma ground_img_if_ground_subst: \"(\\<And>v t. s v = t \\<Longrightarrow> fv t = {}) \\<Longrightarrow> range_vars s = {}\"", "lemma ground_subst_fv_subset: \"ground (subst_range \\<theta>) \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> fv t\"", "lemma ground_subst_fv_subset': \"ground (subst_range \\<theta>) \\<Longrightarrow> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\"", "lemma subst_to_var_is_var[elim]: \"t \\<cdot> s = Var v \\<Longrightarrow> \\<exists>w. t = Var w\"", "lemma subst_dom_comp_inI:\n  assumes \"y \\<notin> subst_domain \\<sigma>\"\n    and \"y \\<in> subst_domain \\<delta>\"\n  shows \"y \\<in> subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<delta>)\"", "lemma subst_comp_notin_dom_eq:\n  \"x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\"", "lemma subst_dom_comp_eq:\n  assumes \"subst_domain \\<theta> \\<inter> range_vars \\<sigma> = {}\"\n  shows \"subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = subst_domain \\<theta> \\<union> subst_domain \\<sigma>\"", "lemma subst_img_comp_subset[simp]:\n  \"range_vars (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<subseteq> range_vars \\<theta>1 \\<union> range_vars \\<theta>2\"", "lemma subst_img_comp_subset':\n  assumes \"t \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\"\n  shows \"t \\<in> subst_range \\<theta>2 \\<or> (\\<exists>t' \\<in> subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\"", "lemma subst_img_comp_subset'':\n  \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) \\<subseteq>\n   subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union> ((subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1)) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\"", "lemma subst_img_comp_subset''':\n  \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) - range Var \\<subseteq>\n   subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) - range Var \\<union> ((subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) - range Var) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\"", "lemma subst_img_comp_subset_const:\n  assumes \"Fun c [] \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\"\n  shows \"Fun c [] \\<in> subst_range \\<theta>2 \\<or> Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n         (\\<exists>x. Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])\"", "lemma subst_img_comp_subset_const':\n  fixes \\<delta> \\<tau>::\"('f,'v) subst\"\n  assumes \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\"\n  shows \"\\<delta> x = Fun c [] \\<or> (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\"", "lemma subst_img_comp_subset_ground:\n  assumes \"ground (subst_range \\<theta>1)\"\n  shows \"subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<subseteq> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\"", "lemma subst_fv_dom_img_single:\n  assumes \"v \\<notin> fv t\" \"\\<sigma> v = t\" \"\\<And>w. v \\<noteq> w \\<Longrightarrow> \\<sigma> w = Var w\"\n  shows \"subst_domain \\<sigma> = {v}\" \"range_vars \\<sigma> = fv t\"", "lemma subst_comp_upd1:\n  \"\\<theta>(v := t) \\<circ>\\<^sub>s \\<sigma> = (\\<theta> \\<circ>\\<^sub>s \\<sigma>)(v := t \\<cdot> \\<sigma>)\"", "lemma subst_comp_upd2:\n  assumes \"v \\<notin> subst_domain s\" \"v \\<notin> range_vars s\"\n  shows \"s(v := t) = s \\<circ>\\<^sub>s (Var(v := t))\"", "lemma ground_subst_dom_iff_img:\n  \"ground (subst_range \\<sigma>) \\<Longrightarrow> x \\<in> subst_domain \\<sigma> \\<longleftrightarrow> \\<sigma> x \\<in> subst_range \\<sigma>\"", "lemma finite_dom_subst_exists:\n  \"finite S \\<Longrightarrow> \\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\"", "lemma subst_inj_is_bij_betw_dom_img_if_ground_img:\n  assumes \"ground (subst_range \\<sigma>)\"\n  shows \"inj \\<sigma> \\<longleftrightarrow> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\" (is \"?A \\<longleftrightarrow> ?B\")", "lemma bij_finite_ground_subst_exists:\n  assumes \"finite (S::'v set)\" \"infinite (U::('f,'v) term set)\" \"ground U\"\n  shows \"\\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\n                          \\<and> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n                          \\<and> subst_range \\<sigma> \\<subseteq> U\"", "lemma bij_finite_const_subst_exists:\n  assumes \"finite (S::'v set)\" \"finite (T::'f set)\" \"infinite (U::'f set)\"\n  shows \"\\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\n                          \\<and> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n                          \\<and> subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)\"", "lemma bij_finite_const_subst_exists':\n  assumes \"finite (S::'v set)\" \"finite (T::('f,'v) terms)\" \"infinite (U::'f set)\"\n  shows \"\\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\n                          \\<and> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n                          \\<and> subst_range \\<sigma> \\<subseteq> ((\\<lambda>c. Fun c []) ` U) - T\"", "lemma bij_betw_iteI:\n  assumes \"bij_betw f A B\" \"bij_betw g C D\" \"A \\<inter> C = {}\" \"B \\<inter> D = {}\"\n  shows \"bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C) (B \\<union> D)\"", "lemma subst_comp_split:\n  assumes \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\"\n  shows \"\\<theta> = (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<circ>\\<^sub>s (rm_vars V \\<theta>)\" (is ?P)\n    and \"\\<theta> = (rm_vars V \\<theta>) \\<circ>\\<^sub>s (rm_vars (subst_domain \\<theta> - V) \\<theta>)\" (is ?Q)", "lemma subst_comp_eq_if_disjoint_vars:\n  assumes \"(subst_domain \\<delta> \\<union> range_vars \\<delta>) \\<inter> (subst_domain \\<gamma> \\<union> range_vars \\<gamma>) = {}\"\n  shows \"\\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>\"", "lemma subst_eq_if_disjoint_vars_ground:\n  fixes \\<xi> \\<delta>::\"('f,'v) subst\"\n  assumes \"subst_domain \\<delta> \\<inter> subst_domain \\<xi> = {}\" \"ground (subst_range \\<xi>)\" \"ground (subst_range \\<delta>)\" \n  shows \"t \\<cdot> \\<delta> \\<cdot> \\<xi> = t \\<cdot> \\<xi> \\<cdot> \\<delta>\"", "lemma subst_img_bound: \"subst_domain \\<delta> \\<union> range_vars \\<delta> \\<subseteq> fv t \\<Longrightarrow> range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)\"", "lemma subst_all_fv_subset: \"fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\"", "lemma subst_support_if_mgt_subst_idem:\n  assumes \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\" \"subst_idem \\<theta>\"\n  shows \"\\<theta> supports \\<delta>\"", "lemma subst_support_iff_mgt_if_subst_idem:\n  assumes \"subst_idem \\<theta>\"\n  shows \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta> \\<longleftrightarrow> \\<theta> supports \\<delta>\"", "lemma subst_support_comp:\n  fixes \\<theta> \\<delta> \\<I>::\"('a,'b) subst\"\n  assumes \"\\<theta> supports \\<I>\" \"\\<delta> supports \\<I>\"\n  shows \"(\\<theta> \\<circ>\\<^sub>s \\<delta>) supports \\<I>\"", "lemma subst_support_comp':\n  fixes \\<theta> \\<delta> \\<sigma>::\"('a,'b) subst\"\n  assumes \"\\<theta> supports \\<delta>\"\n  shows \"\\<theta> supports (\\<delta> \\<circ>\\<^sub>s \\<sigma>)\" \"\\<sigma> supports \\<delta> \\<Longrightarrow> \\<theta> supports (\\<sigma> \\<circ>\\<^sub>s \\<delta>)\"", "lemma subst_support_comp_split:\n  fixes \\<theta> \\<delta> \\<I>::\"('a,'b) subst\"\n  assumes \"(\\<theta> \\<circ>\\<^sub>s \\<delta>) supports \\<I>\"\n  shows \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<Longrightarrow> \\<theta> supports \\<I>\"\n  and \"subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {} \\<Longrightarrow> \\<delta> supports \\<I>\"", "lemma subst_idem_support: \"subst_idem \\<theta> \\<Longrightarrow> \\<theta> supports \\<theta> \\<circ>\\<^sub>s \\<delta>\"", "lemma subst_idem_iff_self_support: \"subst_idem \\<theta> \\<longleftrightarrow> \\<theta> supports \\<theta>\"", "lemma subterm_subst_neq: \"t \\<sqsubset> t' \\<Longrightarrow> t \\<cdot> s \\<noteq> t' \\<cdot> s\"", "lemma fv_Fun_subst_neq: \"x \\<in> fv (Fun f T) \\<Longrightarrow> \\<sigma> x \\<noteq> Fun f T \\<cdot> \\<sigma>\"", "lemma subterm_subst_unfold:\n  assumes \"t \\<sqsubseteq> s \\<cdot> \\<theta>\"\n  shows \"(\\<exists>s'. s' \\<sqsubseteq> s \\<and> t = s' \\<cdot> \\<theta>) \\<or> (\\<exists>x \\<in> fv s. t \\<sqsubset> \\<theta> x)\"", "lemma subterm_subst_img_subterm:\n  assumes \"t \\<sqsubseteq> s \\<cdot> \\<theta>\" \"\\<And>s'. s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> s' \\<cdot> \\<theta>\"\n  shows \"\\<exists>w \\<in> fv s. t \\<sqsubset> \\<theta> w\"", "lemma subterm_subst_not_img_subterm:\n  assumes \"t \\<sqsubseteq> s \\<cdot> \\<I>\" \"\\<not>(\\<exists>w \\<in> fv s. t \\<sqsubseteq> \\<I> w)\"\n  shows \"\\<exists>f T. Fun f T \\<sqsubseteq> s \\<and> t = Fun f T \\<cdot> \\<I>\"", "lemma subst_apply_img_var:\n  assumes \"v \\<in> fv (t \\<cdot> \\<delta>)\" \"v \\<notin> fv t\"\n  obtains w where \"w \\<in> fv t\" \"v \\<in> fv (\\<delta> w)\"", "lemma subst_apply_img_var':\n  assumes \"x \\<in> fv (t \\<cdot> \\<delta>)\" \"x \\<notin> fv t\"\n  shows \"\\<exists>y \\<in> fv t. x \\<in> fv (\\<delta> y)\"", "lemma nth_map_subst:\n  fixes \\<theta>::\"('f,'v) subst\" and T::\"('f,'v) term list\" and i::nat\n  shows \"i < length T \\<Longrightarrow> (map (\\<lambda>t. t \\<cdot> \\<theta>) T) ! i = (T ! i) \\<cdot> \\<theta>\"", "lemma subst_subterm:\n  assumes \"Fun f T \\<sqsubseteq> t \\<cdot> \\<theta>\"\n  shows \"(\\<exists>S. Fun f S \\<sqsubseteq> t \\<and> Fun f S \\<cdot> \\<theta> = Fun f T) \\<or>\n         (\\<exists>s \\<in> subst_range \\<theta>. Fun f T \\<sqsubseteq> s)\"", "lemma subst_subterm':\n  assumes \"Fun f T \\<sqsubseteq> t \\<cdot> \\<theta>\"\n  shows \"\\<exists>S. length S = length T \\<and> (Fun f S \\<sqsubseteq> t \\<or> (\\<exists>s \\<in> subst_range \\<theta>. Fun f S \\<sqsubseteq> s))\"", "lemma subst_subterm'':\n  assumes \"s \\<in> subterms (t \\<cdot> \\<theta>)\"\n  shows \"(\\<exists>u \\<in> subterms t. s = u \\<cdot> \\<theta>) \\<or> s \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\"", "lemma funs_term_subst: \"funs_term (t \\<cdot> \\<theta>) = funs_term t \\<union> (\\<Union>x \\<in> fv t. funs_term (\\<theta> x))\"", "lemma fv\\<^sub>s\\<^sub>e\\<^sub>t_subst_img_eq:\n  assumes \"X \\<inter> (subst_domain \\<delta> \\<union> range_vars \\<delta>) = {}\"\n  shows \"fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (Y - X)) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` Y) - X\"", "lemma subst_Fun_index_eq:\n  assumes \"i < length T\" \"Fun f T \\<cdot> \\<delta> = Fun g T' \\<cdot> \\<delta>\"\n  shows \"T ! i \\<cdot> \\<delta> = T' ! i \\<cdot> \\<delta>\"", "lemma fv_exists_if_unifiable_and_neq:\n  fixes t t'::\"('a,'b) term\" and \\<delta> \\<theta>::\"('a,'b) subst\"\n  assumes \"t \\<noteq> t'\" \"t \\<cdot> \\<theta> = t' \\<cdot> \\<theta>\"\n  shows \"fv t \\<union> fv t' \\<noteq> {}\"", "lemma const_subterm_subst: \"Fun c [] \\<sqsubseteq> t \\<Longrightarrow> Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>\"", "lemma const_subterm_subst_var_obtain:\n  assumes \"Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>\" \"\\<not>Fun c [] \\<sqsubseteq> t\"\n  obtains x where \"x \\<in> fv t\" \"Fun c [] \\<sqsubseteq> \\<sigma> x\"", "lemma const_subterm_subst_cases:\n  assumes \"Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>\"\n  shows \"Fun c [] \\<sqsubseteq> t \\<or> (\\<exists>x \\<in> fv t. x \\<in> subst_domain \\<sigma> \\<and> Fun c [] \\<sqsubseteq> \\<sigma> x)\"", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst_fv_subset:\n  assumes \"x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\"\n  shows \"fv (\\<theta> x) \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\"", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_step_subst: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) = fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\"", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst_obtain_var:\n  fixes \\<delta>::\"('a,'b) subst\"\n  assumes \"x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\"\n  shows \"\\<exists>y \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F. x \\<in> fv (\\<delta> y)\"", "lemma pair_subst_ident[intro]: \"(fv t \\<union> fv t') \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> (t,t') \\<cdot>\\<^sub>p \\<theta> = (t,t')\"", "lemma pairs_substI[intro]:\n  assumes \"subst_domain \\<theta> \\<inter> (\\<Union>(s,t) \\<in> M. fv s \\<union> fv t) = {}\"\n  shows \"M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M\"", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst: \"fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` (fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F))\"", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst_subset:\n  assumes \"fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>) \\<subseteq> subst_domain \\<sigma>\"\n  shows  \"fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\"", "lemma pairs_subst_comp: \"F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> \\<circ>\\<^sub>s \\<theta> = ((F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>) \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\"", "lemma pairs_substI'[intro]:\n  \"subst_domain \\<theta> \\<inter> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F = {} \\<Longrightarrow> F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta> = F\"", "lemma subst_pair_compose[simp]: \"d \\<cdot>\\<^sub>p (\\<delta> \\<circ>\\<^sub>s \\<I>) = d \\<cdot>\\<^sub>p \\<delta> \\<cdot>\\<^sub>p \\<I>\"", "lemma subst_pairs_compose[simp]: \"D \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> \\<circ>\\<^sub>s \\<I>) = D \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<I>\"", "lemma subst_apply_pair_pair: \"(t, s) \\<cdot>\\<^sub>p \\<I> = (t \\<cdot> \\<I>, s \\<cdot> \\<I>)\"", "lemma subst_apply_pairs_nil[simp]: \"[] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> = []\"", "lemma subst_apply_pairs_singleton[simp]: \"[(t,s)] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> = [(t \\<cdot> \\<delta>,s \\<cdot> \\<delta>)]\"", "lemma subst_apply_pairs_Var[iff]: \"F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s Var = F\"", "lemma subst_apply_pairs_pset_subst: \"set (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) = set F \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"", "lemma finite_dom_iff_fsubst:\n  \"finite (subst_domain \\<theta>) \\<longleftrightarrow> \\<theta> \\<in> fsubst\"", "lemma fsubst_induct[case_names fvar FUpdate, induct set: finite]:\n  assumes \"finite (subst_domain \\<delta>)\" \"P Var\"\n  and \"\\<And>\\<theta> v t. \\<lbrakk>finite (subst_domain \\<theta>); v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v; P \\<theta>\\<rbrakk> \\<Longrightarrow> P (\\<theta>(v := t))\"\n  shows \"P \\<delta>\"", "lemma fun_upd_fsubst: \"s(v := t) \\<in> fsubst \\<longleftrightarrow> s \\<in> fsubst\"", "lemma finite_img_if_fsubst: \"s \\<in> fsubst \\<Longrightarrow> finite (subst_range s)\"", "lemma MGUI[intro]:\n  shows \"\\<lbrakk>t \\<cdot> \\<sigma> = u \\<cdot> \\<sigma>; \\<And>\\<theta>::('f,'v) subst. t \\<cdot> \\<theta> = u \\<cdot> \\<theta> \\<Longrightarrow> \\<sigma> \\<preceq>\\<^sub>\\<circ> \\<theta>\\<rbrakk> \\<Longrightarrow> MGU \\<sigma> t u\"", "lemma UnifierD[dest]:\n  fixes \\<sigma>::\"('f,'v) subst\" and f g::'f and X Y::\"('f,'v) term list\"\n  assumes \"Unifier \\<sigma> (Fun f X) (Fun g Y)\"\n  shows \"f = g\" \"length X = length Y\"", "lemma MGUD[dest]:\n  fixes \\<sigma>::\"('f,'v) subst\" and f g::'f and X Y::\"('f,'v) term list\"\n  assumes \"MGU \\<sigma> (Fun f X) (Fun g Y)\"\n  shows \"f = g\" \"length X = length Y\"", "lemma MGU_sym[sym]: \"MGU \\<sigma> s t \\<Longrightarrow> MGU \\<sigma> t s\"", "lemma Unifier_sym[sym]: \"Unifier \\<sigma> s t \\<Longrightarrow> Unifier \\<sigma> t s\"", "lemma MGU_nil: \"MGU Var s t \\<longleftrightarrow> s = t\"", "lemma Unifier_comp: \"Unifier (\\<theta> \\<circ>\\<^sub>s \\<delta>) t u \\<Longrightarrow> Unifier \\<delta> (t \\<cdot> \\<theta>) (u \\<cdot> \\<theta>)\"", "lemma Unifier_comp': \"Unifier \\<delta> (t \\<cdot> \\<theta>) (u \\<cdot> \\<theta>) \\<Longrightarrow> Unifier (\\<theta> \\<circ>\\<^sub>s \\<delta>) t u\"", "lemma Unifier_excludes_subterm:\n  assumes \\<theta>: \"Unifier \\<theta> t u\"\n  shows \"\\<not>t \\<sqsubset> u\"", "lemma MGU_is_Unifier: \"MGU \\<sigma> t u \\<Longrightarrow> Unifier \\<sigma> t u\"", "lemma MGU_Var1:\n  assumes \"\\<not>Var v \\<sqsubset> t\"\n  shows \"MGU (Var(v := t)) (Var v) t\"", "lemma MGU_Var2: \"v \\<notin> fv t \\<Longrightarrow> MGU (Var(v := t)) (Var v) t\"", "lemma MGU_Var3: \"MGU Var (Var v) (Var w) \\<longleftrightarrow> v = w\"", "lemma MGU_Const1: \"MGU Var (Fun c []) (Fun d []) \\<longleftrightarrow> c = d\"", "lemma MGU_Const2: \"MGU \\<theta> (Fun c []) (Fun d []) \\<Longrightarrow> c = d\"", "lemma MGU_Fun:\n  assumes \"MGU \\<theta> (Fun f X) (Fun g Y)\"\n  shows \"f = g\" \"length X = length Y\"", "lemma Unifier_Fun:\n  assumes \"Unifier \\<theta> (Fun f (x#X)) (Fun g (y#Y))\"\n  shows \"Unifier \\<theta> x y\" \"Unifier \\<theta> (Fun f X) (Fun g Y)\"", "lemma Unifier_subst_idem_subst: \n  \"subst_idem r \\<Longrightarrow> Unifier s (t \\<cdot> r) (u \\<cdot> r) \\<Longrightarrow> Unifier (r \\<circ>\\<^sub>s s) (t \\<cdot> r) (u \\<cdot> r)\"", "lemma subst_idem_comp:\n  \"subst_idem r \\<Longrightarrow> Unifier s (t \\<cdot> r) (u \\<cdot> r) \\<Longrightarrow> \n    (\\<And>q. Unifier q (t \\<cdot> r) (u \\<cdot> r) \\<Longrightarrow> s \\<circ>\\<^sub>s q = q) \\<Longrightarrow>\n    subst_idem (r \\<circ>\\<^sub>s s)\"", "lemma Unifier_mgt: \"\\<lbrakk>Unifier \\<delta> t u; \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta>\\<rbrakk> \\<Longrightarrow> Unifier \\<theta> t u\"", "lemma Unifier_support: \"\\<lbrakk>Unifier \\<delta> t u; \\<delta> supports \\<theta>\\<rbrakk> \\<Longrightarrow> Unifier \\<theta> t u\"", "lemma MGU_mgt: \"\\<lbrakk>MGU \\<sigma> t u; MGU \\<delta> t u\\<rbrakk> \\<Longrightarrow> \\<sigma> \\<preceq>\\<^sub>\\<circ> \\<delta>\"", "lemma Unifier_trm_fv_bound:\n  \"\\<lbrakk>Unifier s t u; v \\<in> fv t\\<rbrakk> \\<Longrightarrow> v \\<in> subst_domain s \\<union> range_vars s \\<union> fv u\"", "lemma Unifier_rm_var: \"\\<lbrakk>Unifier \\<theta> s t; v \\<notin> fv s \\<union> fv t\\<rbrakk> \\<Longrightarrow> Unifier (rm_var v \\<theta>) s t\"", "lemma Unifier_ground_rm_vars:\n  assumes \"ground (subst_range s)\" \"Unifier (rm_vars X s) t t'\"\n  shows \"Unifier s t t'\"", "lemma Unifier_dom_restrict:\n  assumes \"Unifier s t t'\" \"fv t \\<union> fv t' \\<subseteq> S\"\n  shows \"Unifier (rm_vars (UNIV - S) s) t t'\"", "lemma wf_subst_subst_idem: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> subst_idem \\<theta>\"", "lemma wf_subst_properties: \"\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set = wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\"", "lemma wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_induct[consumes 1, case_names Empty Insert]:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta>\" \"P Var\"\n  and \"\\<And>\\<theta> v t. \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>; P \\<theta>; v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n                fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n                \\<Longrightarrow> P (\\<theta>(v := t))\"\n  shows \"P \\<delta>\"", "lemma wf_subst_fsubst: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta> \\<Longrightarrow> \\<delta> \\<in> fsubst\"", "lemma wf_subst_nil: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t Var\"", "lemma wf_MGU_nil: \"MGU Var s t \\<Longrightarrow> wf\\<^sub>M\\<^sub>G\\<^sub>U Var s t\"", "lemma wf_MGU_dom_bound: \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow> subst_domain \\<theta> \\<subseteq> fv s \\<union> fv t\"", "lemma wf_subst_single:\n  assumes \"v \\<notin> fv t\" \"\\<sigma> v = t\" \"\\<And>w. v \\<noteq> w \\<Longrightarrow> \\<sigma> w = Var w\"\n  shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>\"", "lemma wf_subst_reduction:\n  \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)\"", "lemma wf_subst_compose:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>1\" \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\"\n    and \"subst_domain \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\"\n    and \"subst_domain \\<theta>1 \\<inter> range_vars \\<theta>2 = {}\"\n  shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\"", "lemma wf_subst_append:\n  fixes \\<theta>1 \\<theta>2::\"('f,'v) subst\"\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>1\" \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\"\n    and \"subst_domain \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\"\n    and \"subst_domain \\<theta>1 \\<inter> range_vars \\<theta>2 = {}\"\n    and \"range_vars \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\"\n  shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<lambda>v. if \\<theta>1 v = Var v then \\<theta>2 v else \\<theta>1 v)\"", "lemma wf_subst_elim_append:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\" \"subst_elim \\<theta> v\" \"v \\<notin> fv t\"\n  shows \"subst_elim (\\<theta>(w := t)) v\"", "lemma wf_subst_elim_dom:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\"\n  shows \"\\<forall>v \\<in> subst_domain \\<theta>. subst_elim \\<theta> v\"", "lemma wf_subst_support_iff_mgt: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> \\<theta> supports \\<delta> \\<longleftrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\"", "lemma interpretation_substI:\n  \"(\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow> interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\"", "lemma interpretation_grounds[simp]:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> fv (t \\<cdot> \\<theta>) = {}\"", "lemma interpretation_grounds_all:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> (\\<And>v. fv (\\<theta> v) = {})\"", "lemma interpretation_grounds_all':\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> ground (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\"", "lemma interpretation_comp:\n  assumes \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\" \n  shows \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\" \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\"", "lemma interpretation_subst_exists:\n  \"\\<exists>\\<I>::('f,'v) subst. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>\"", "lemma interpretation_subst_exists':\n  \"\\<exists>\\<theta>::('f,'v) subst. subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)\"", "lemma interpretation_subst_idem:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> subst_idem \\<theta>\"", "lemma subst_idem_comp_upd_eq:\n  assumes \"v \\<notin> subst_domain \\<I>\" \"subst_idem \\<theta>\"\n  shows \"\\<I> \\<circ>\\<^sub>s \\<theta> = \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>\"", "lemma interpretation_dom_img_disjoint:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I> \\<Longrightarrow> subst_domain \\<I> \\<inter> range_vars \\<I> = {}\"", "lemma MGU_is_mgu_singleton: \"MGU \\<theta> t u = is_mgu \\<theta> {(t,u)}\"", "lemma Unifier_in_unifiers_singleton: \"Unifier \\<theta> s t \\<longleftrightarrow> \\<theta> \\<in> unifiers {(s,t)}\"", "lemma subst_list_singleton_fv_subset:\n  \"(\\<Union>x \\<in> set (subst_list (subst v t) E). fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union> (\\<Union>x \\<in> set E. fv (fst x) \\<union> fv (snd x))\"", "lemma subst_of_dom_subset: \"subst_domain (subst_of L) \\<subseteq> set (map fst L)\"", "lemma wf_MGU_is_imgu_singleton: \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow> is_imgu \\<theta> {(s,t)}\"", "lemma mgu_subst_range_vars:\n  assumes \"mgu s t = Some \\<sigma>\" shows \"range_vars \\<sigma> \\<subseteq> vars_term s \\<union> vars_term t\"", "lemma mgu_subst_domain_range_vars_disjoint:\n  assumes \"mgu s t = Some \\<sigma>\" shows \"subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\"", "lemma mgu_same_empty: \"mgu (t::('a,'b) term) t = Some Var\"", "lemma mgu_var: assumes \"x \\<notin> fv t\" shows \"mgu (Var x) t = Some (Var(x := t))\"", "lemma mgu_gives_wellformed_subst:\n  assumes \"mgu s t = Some \\<theta>\" shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\"", "lemma mgu_gives_wellformed_MGU:\n  assumes \"mgu s t = Some \\<theta>\" shows \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t\"", "lemma mgu_vars_bounded[dest?]:\n  \"mgu M N = Some \\<sigma> \\<Longrightarrow> subst_domain \\<sigma> \\<union> range_vars \\<sigma> \\<subseteq> fv M \\<union> fv N\"", "lemma mgu_gives_subst_idem: \"mgu s t = Some \\<theta> \\<Longrightarrow> subst_idem \\<theta>\"", "lemma mgu_always_unifies: \"Unifier \\<theta> M N \\<Longrightarrow> \\<exists>\\<delta>. mgu M N = Some \\<delta>\"", "lemma mgu_gives_MGU: \"mgu s t = Some \\<theta> \\<Longrightarrow> MGU \\<theta> s t\"", "lemma mgu_eliminates[dest?]:\n  assumes \"mgu M N = Some \\<sigma>\"\n  shows \"(\\<exists>v \\<in> fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or> \\<sigma> = Var\"\n  (is \"?P M N \\<sigma>\")", "lemma mgu_eliminates_dom:\n  assumes \"mgu x y = Some \\<theta>\" \"v \\<in> subst_domain \\<theta>\"\n  shows \"subst_elim \\<theta> v\"", "lemma unify_list_distinct:\n  assumes \"Unification.unify E B = Some U\" \"distinct (map fst B)\"\n  and \"(\\<Union>x \\<in> set E. fv (fst x) \\<union> fv (snd x)) \\<inter> set (map fst B) = {}\"\n  shows \"distinct (map fst U)\"", "lemma mgu_None_is_subst_neq:\n  fixes s t::\"('a,'b) term\" and \\<delta>::\"('a,'b) subst\"\n  assumes \"mgu s t = None\"\n  shows \"s \\<cdot> \\<delta> \\<noteq> t \\<cdot> \\<delta>\"", "lemma mgu_None_if_neq_ground:\n  assumes \"t \\<noteq> t'\" \"fv t = {}\" \"fv t' = {}\"\n  shows \"mgu t t' = None\"", "lemma mgu_None_commutes:\n  \"mgu s t = None \\<Longrightarrow> mgu t s = None\"", "lemma mgu_img_subterm_subst:\n  fixes \\<delta>::\"('f,'v) subst\" and s t u::\"('f,'v) term\"\n  assumes \"mgu s t = Some \\<delta>\" \"u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) - range Var\"\n  shows \"u \\<in> ((subterms s \\<union> subterms t) - range Var) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\"", "lemma mgu_img_consts:\n  fixes \\<delta>::\"('f,'v) subst\" and s t::\"('f,'v) term\" and c::'f and z::'v\n  assumes \"mgu s t = Some \\<delta>\" \"Fun c [] \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)\"\n  shows \"Fun c [] \\<in> subterms s \\<union> subterms t\"", "lemma mgu_img_consts':\n  fixes \\<delta>::\"('f,'v) subst\" and s t::\"('f,'v) term\" and c::'f and z::'v\n  assumes \"mgu s t = Some \\<delta>\" \"\\<delta> z = Fun c []\"\n  shows \"Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\"", "lemma mgu_img_composed_var_term:\n  fixes \\<delta>::\"('f,'v) subst\" and s t::\"('f,'v) term\" and f::'f and Z::\"'v list\"\n  assumes \"mgu s t = Some \\<delta>\" \"Fun f (map Var Z) \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)\"\n  shows \"\\<exists>Z'. map \\<delta> Z' = map Var Z \\<and> Fun f (map Var Z') \\<in> subterms s \\<union> subterms t\"", "lemma subterm_inj_on_imp_inj_on: \"subterm_inj_on f A \\<Longrightarrow> inj_on f A\"", "lemma subst_inj_on_is_bij_betw:\n  \"inj_on \\<theta> (subst_domain \\<theta>) = bij_betw \\<theta> (subst_domain \\<theta>) (subst_range \\<theta>)\"", "lemma subterm_inj_on_alt_def:\n    \"subterm_inj_on f A \\<longleftrightarrow>\n     (inj_on f A \\<and> (\\<forall>s \\<in> f`A. \\<forall>u \\<in> f`A. (\\<exists>v. v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow> s = u))\"\n    (is \"?A \\<longleftrightarrow> ?B\")", "lemma subterm_inj_on_alt_def':\n    \"subterm_inj_on \\<theta> (subst_domain \\<theta>) \\<longleftrightarrow>\n     (inj_on \\<theta> (subst_domain \\<theta>) \\<and>\n      (\\<forall>s \\<in> subst_range \\<theta>. \\<forall>u \\<in> subst_range \\<theta>. (\\<exists>v. v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow> s = u))\"\n    (is \"?A \\<longleftrightarrow> ?B\")", "lemma subterm_inj_on_subset:\n  assumes \"subterm_inj_on f A\"\n    and \"B \\<subseteq> A\"\n  shows \"subterm_inj_on f B\"", "lemma inj_subst_unif_consts:\n  fixes \\<I> \\<theta> \\<sigma>::\"('f,'v) subst\" and s t::\"('f,'v) term\"\n  assumes \\<theta>: \"subterm_inj_on \\<theta> (subst_domain \\<theta>)\" \"\\<forall>x \\<in> (fv s \\<union> fv t) - X. \\<exists>c. \\<theta> x = Fun c []\"\n             \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter> (subterms s \\<union> subterms t) = {}\" \"ground (subst_range \\<theta>)\"\n             \"subst_domain \\<theta> \\<inter> X = {}\"\n  and \\<I>: \"ground (subst_range \\<I>)\" \"subst_domain \\<I> = subst_domain \\<theta>\"\n  and unif: \"Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\"\n  shows \"\\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\"", "lemma inj_subst_unif_comp_terms:\n  fixes \\<I> \\<theta> \\<sigma>::\"('f,'v) subst\" and s t::\"('f,'v) term\"\n  assumes \\<theta>: \"subterm_inj_on \\<theta> (subst_domain \\<theta>)\" \"ground (subst_range \\<theta>)\"\n             \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter> (subterms s \\<union> subterms t) = {}\"\n             \"(fv s \\<union> fv t) - subst_domain \\<theta> \\<subseteq> X\"\n  and tfr: \"\\<forall>f U. Fun f U \\<in> subterms s \\<union> subterms t \\<longrightarrow> U = [] \\<or> (\\<exists>u \\<in> set U. u \\<notin> Var ` X)\"\n  and \\<I>: \"ground (subst_range \\<I>)\" \"subst_domain \\<I> = subst_domain \\<theta>\"\n  and unif: \"Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\"\n  shows \"\\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\"", "lemma sat_ineq_subterm_inj_subst_aux:\n  fixes \\<I>::\"('f,'v) subst\"\n  assumes \"Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\" \"ground (subst_range \\<I>)\"\n          \"(fv s \\<union> fv t) - X \\<subseteq> subst_domain \\<I>\" \"subst_domain \\<I> \\<inter> X = {}\"\n  shows \"\\<exists>\\<delta>::('f,'v) subst. subst_domain \\<delta> = X \\<and> ground (subst_range \\<delta>) \\<and> s \\<cdot> \\<delta> \\<cdot> \\<I> = t \\<cdot> \\<delta> \\<cdot> \\<I>\"", "lemma sat_ineq_subterm_inj_subst:\n  fixes \\<theta> \\<I> \\<delta>::\"('f,'v) subst\"\n  assumes \\<theta>: \"subterm_inj_on \\<theta> (subst_domain \\<theta>)\"\n             \"ground (subst_range \\<theta>)\"\n             \"subst_domain \\<theta> \\<inter> X = {}\"\n             \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter> (subterms s \\<union> subterms t) = {}\"\n             \"(fv s \\<union> fv t) - subst_domain \\<theta> \\<subseteq> X\"\n  and tfr: \"(\\<forall>x \\<in> (fv s \\<union> fv t) - X. \\<exists>c. \\<theta> x = Fun c []) \\<or>\n            (\\<forall>f U. Fun f U \\<in> subterms s \\<union> subterms t \\<longrightarrow> U = [] \\<or> (\\<exists>u \\<in> set U. u \\<notin> Var ` X))\"\n  and \\<I>: \"\\<forall>\\<delta>::('f,'v) subst. subst_domain \\<delta> = X \\<and> ground (subst_range \\<delta>) \\<longrightarrow> s \\<cdot> \\<delta> \\<cdot> \\<I> \\<noteq> t \\<cdot> \\<delta> \\<cdot> \\<I>\"\n         \"(fv s \\<union> fv t) - X \\<subseteq> subst_domain \\<I>\" \"subst_domain \\<I> \\<inter> X = {}\" \"ground (subst_range \\<I>)\"\n         \"subst_domain \\<I> = subst_domain \\<theta>\"\n  and \\<delta>: \"subst_domain \\<delta> = X\" \"ground (subst_range \\<delta>)\"\n  shows \"s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq> t \\<cdot> \\<delta> \\<cdot> \\<theta>\"", "lemma ineq_subterm_inj_cond_subst:\n  assumes \"X \\<inter> range_vars \\<theta> = {}\"\n  and \"\\<forall>f T. Fun f T \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<longrightarrow> T = [] \\<or> (\\<exists>u \\<in> set T. u \\<notin> Var`X)\"\n  shows \"\\<forall>f T. Fun f T \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<longrightarrow> T = [] \\<or> (\\<exists>u \\<in> set T. u \\<notin> Var`X)\"", "lemma inj_var_ran_subst_is_invertible:\n  assumes \\<delta>_inj_on_t: \"inj_on \\<delta> (fv t)\"\n    and \\<delta>_var_on_t: \"\\<delta> ` fv t \\<subseteq> range Var\"\n  shows \"t = t \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)\"", "lemma inj_var_ran_unifiable_has_subst_match:\n  assumes \"t \\<cdot> \\<delta> = s \\<cdot> \\<delta>\" \"inj_on \\<delta> (fv t)\" \"\\<delta> ` fv t \\<subseteq> range Var\"\n  shows \"t = s \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)\""], "translations": [["", "lemma subst_support_def: \"\\<theta> supports \\<tau> \\<longleftrightarrow> \\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<theta> supports \\<tau>) = (\\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>)", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<theta> supports \\<tau>) =\n    (\\<tau> = (\\<lambda>x. \\<theta> x \\<cdot> \\<tau>))", "by metis"], ["", "lemma subst_supportD: \"\\<theta> supports \\<delta> \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta> \\<Longrightarrow>\n    \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>", "using subst_support_def"], ["proof (prove)\nusing this:\n  (?\\<theta> supports ?\\<tau>) =\n  (?\\<tau> = ?\\<theta> \\<circ>\\<^sub>s ?\\<tau>)\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta> \\<Longrightarrow>\n    \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>", "by auto"], ["", "lemma rm_vars_empty[simp]: \"rm_vars {} s = s\" \"rm_vars (set []) s = s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. rm_vars {} s = s &&& rm_vars (set []) s = s", "by simp_all"], ["", "lemma rm_vars_singleton: \"rm_vars {v} s = rm_var v s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. rm_vars {v} s = rm_var v s", "by auto"], ["", "lemma subst_apply_terms_empty: \"M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var = M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var = M", "by simp"], ["", "lemma subst_agreement: \"(t \\<cdot> r = t \\<cdot> s) \\<longleftrightarrow> (\\<forall>v \\<in> fv t. Var v \\<cdot> r = Var v \\<cdot> s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (t \\<cdot> r = t \\<cdot> s) =\n    (\\<forall>v\\<in>fv t. Var v \\<cdot> r = Var v \\<cdot> s)", "by (induct t) auto"], ["", "lemma repl_invariance[dest?]: \"v \\<notin> fv t \\<Longrightarrow> t \\<cdot> s(v := u) = t \\<cdot> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> fv t \\<Longrightarrow> t \\<cdot> s(v := u) = t \\<cdot> s", "by (simp add: subst_agreement)"], ["", "lemma subst_idx_map:\n  assumes \"\\<forall>i \\<in> set I. i < length T\"\n  shows \"(map ((!) T) I) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> = map ((!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T)) I\""], ["proof (prove)\ngoal (1 subgoal):\n 1. map ((!) T) I \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> =\n    map ((!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)) I", "using assms"], ["proof (prove)\nusing this:\n  \\<forall>i\\<in>set I. i < length T\n\ngoal (1 subgoal):\n 1. map ((!) T) I \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> =\n    map ((!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)) I", "by auto"], ["", "lemma subst_idx_map':\n  assumes \"\\<forall>i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K). i < length T\"\n  shows \"(K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> = K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t ((!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T))\" (is \"?A = ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. (K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n     (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    \\<delta> =\n    K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n     (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    \\<delta> =\n    K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "have \"T ! i \\<cdot> \\<delta> = (map (\\<lambda>t. t \\<cdot> \\<delta>) T) ! i\"\n    when \"i < length T\" for i"], ["proof (prove)\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "using that"], ["proof (prove)\nusing this:\n  i < length T\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "by auto"], ["proof (state)\nthis:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (1 subgoal):\n 1. (K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n     (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    \\<delta> =\n    K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "hence \"T ! i \\<cdot> \\<delta> = (map (\\<lambda>t. t \\<cdot> \\<delta>) T) ! i\"\n    when \"i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K)\" for i"], ["proof (prove)\nusing this:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "using that assms"], ["proof (prove)\nusing this:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n  i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K)\n  \\<forall>i\\<in>fv\\<^sub>s\\<^sub>e\\<^sub>t (set K). i < length T\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "by auto"], ["proof (state)\nthis:\n  ?i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K) \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (1 subgoal):\n 1. (K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n     (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    \\<delta> =\n    K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "hence \"k \\<cdot> (!) T \\<cdot> \\<delta> = k \\<cdot> (!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T)\"\n    when \"fv k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K)\" for k"], ["proof (prove)\nusing this:\n  ?i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K) \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (1 subgoal):\n 1. k \\<cdot> (!) T \\<cdot> \\<delta> =\n    k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "using that"], ["proof (prove)\nusing this:\n  ?i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K) \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n  fv k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K)\n\ngoal (1 subgoal):\n 1. k \\<cdot> (!) T \\<cdot> \\<delta> =\n    k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "by (induction k) force+"], ["proof (state)\nthis:\n  fv ?k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K) \\<Longrightarrow>\n  ?k \\<cdot> (!) T \\<cdot> \\<delta> =\n  ?k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n\ngoal (1 subgoal):\n 1. (K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n     (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    \\<delta> =\n    K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv ?k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (set K) \\<Longrightarrow>\n  ?k \\<cdot> (!) T \\<cdot> \\<delta> =\n  ?k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n\ngoal (1 subgoal):\n 1. (K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n     (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    \\<delta> =\n    K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "by auto"], ["proof (state)\nthis:\n  (K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n   (!) T) \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n  \\<delta> =\n  K \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n  (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_remove_var: \"v \\<notin> fv s \\<Longrightarrow> v \\<notin> fv (t \\<cdot> Var(v := s))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> fv s \\<Longrightarrow> v \\<notin> fv (t \\<cdot> Var(v := s))", "by (induct t) simp_all"], ["", "lemma subst_set_map: \"x \\<in> set X \\<Longrightarrow> x \\<cdot> s \\<in> set (map (\\<lambda>x. x \\<cdot> s) X)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> set X \\<Longrightarrow>\n    x \\<cdot> s \\<in> set (X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t s)", "by simp"], ["", "lemma subst_set_idx_map:\n  assumes \"\\<forall>i \\<in> I. i < length T\"\n  shows \"(!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> = (!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T) ` I\" (is \"?A = ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> =\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\n    \\<subseteq> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n 2. (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n    \\<subseteq> (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>", "have *: \"T ! i \\<cdot> \\<delta> = (map (\\<lambda>t. t \\<cdot> \\<delta>) T) ! i\"\n    when \"i < length T\" for i"], ["proof (prove)\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "using that"], ["proof (prove)\nusing this:\n  i < length T\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "by auto"], ["proof (state)\nthis:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (2 subgoals):\n 1. (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\n    \\<subseteq> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n 2. (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n    \\<subseteq> (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>", "show \"?A \\<subseteq> ?B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\n    \\<subseteq> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I", "using * assms"], ["proof (prove)\nusing this:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n  \\<forall>i\\<in>I. i < length T\n\ngoal (1 subgoal):\n 1. (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\n    \\<subseteq> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I", "by blast"], ["proof (state)\nthis:\n  (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\n  \\<subseteq> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n\ngoal (1 subgoal):\n 1. (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n    \\<subseteq> (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>", "show \"?B \\<subseteq> ?A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n    \\<subseteq> (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>", "using * assms"], ["proof (prove)\nusing this:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n  \\<forall>i\\<in>I. i < length T\n\ngoal (1 subgoal):\n 1. (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n    \\<subseteq> (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>", "by auto"], ["proof (state)\nthis:\n  (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ` I\n  \\<subseteq> (!) T ` I \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_set_idx_map':\n  assumes \"\\<forall>i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t K. i < length T\"\n  shows \"K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> = K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T)\" (is \"?A = ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta> =\n    K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta>\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n 2. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<delta>", "have \"T ! i \\<cdot> \\<delta> = (map (\\<lambda>t. t \\<cdot> \\<delta>) T) ! i\"\n    when \"i < length T\" for i"], ["proof (prove)\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "using that"], ["proof (prove)\nusing this:\n  i < length T\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "by auto"], ["proof (state)\nthis:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (2 subgoals):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta>\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n 2. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<delta>", "hence \"T ! i \\<cdot> \\<delta> = (map (\\<lambda>t. t \\<cdot> \\<delta>) T) ! i\"\n    when \"i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t K\" for i"], ["proof (prove)\nusing this:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "using that assms"], ["proof (prove)\nusing this:\n  ?i < length T \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n  i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t K\n  \\<forall>i\\<in>fv\\<^sub>s\\<^sub>e\\<^sub>t K. i < length T\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> =\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! i", "by auto"], ["proof (state)\nthis:\n  ?i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t K \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (2 subgoals):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta>\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n 2. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<delta>", "hence *: \"k \\<cdot> (!) T \\<cdot> \\<delta> = k \\<cdot> (!) (map (\\<lambda>t. t \\<cdot> \\<delta>) T)\"\n    when \"fv k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t K\" for k"], ["proof (prove)\nusing this:\n  ?i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t K \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n\ngoal (1 subgoal):\n 1. k \\<cdot> (!) T \\<cdot> \\<delta> =\n    k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "using that"], ["proof (prove)\nusing this:\n  ?i \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t K \\<Longrightarrow>\n  T ! ?i \\<cdot> \\<delta> =\n  (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>) ! ?i\n  fv k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t K\n\ngoal (1 subgoal):\n 1. k \\<cdot> (!) T \\<cdot> \\<delta> =\n    k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "by (induction k) force+"], ["proof (state)\nthis:\n  fv ?k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t K \\<Longrightarrow>\n  ?k \\<cdot> (!) T \\<cdot> \\<delta> =\n  ?k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n\ngoal (2 subgoals):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta>\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n 2. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<delta>", "show \"?A \\<subseteq> ?B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta>\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "using *"], ["proof (prove)\nusing this:\n  fv ?k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t K \\<Longrightarrow>\n  ?k \\<cdot> (!) T \\<cdot> \\<delta> =\n  ?k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n\ngoal (1 subgoal):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta>\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)", "by auto"], ["proof (state)\nthis:\n  K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n  \\<delta>\n  \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n\ngoal (1 subgoal):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<delta>", "show \"?B \\<subseteq> ?A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<delta>", "using *"], ["proof (prove)\nusing this:\n  fv ?k \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t K \\<Longrightarrow>\n  ?k \\<cdot> (!) T \\<cdot> \\<delta> =\n  ?k \\<cdot> (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n\ngoal (1 subgoal):\n 1. K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n    \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<delta>", "by force"], ["proof (state)\nthis:\n  K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n  (!) (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>)\n  \\<subseteq> K \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              (!) T \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_term_list_obtain:\n  assumes \"\\<forall>i < length T. \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\"\n    and \"length T = length S\"\n  shows \"\\<exists>U. length T = length U \\<and> (\\<forall>i < length T. P (T ! i) (U ! i)) \\<and> S = map (\\<lambda>u. u \\<cdot> \\<delta>) U\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>U.\n       length T = length U \\<and>\n       (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n       S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "using assms"], ["proof (prove)\nusing this:\n  \\<forall>i<length T.\n     \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\n  length T = length S\n\ngoal (1 subgoal):\n 1. \\<exists>U.\n       length T = length U \\<and>\n       (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n       S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "proof (induction T arbitrary: S)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "case (Cons t T S')"], ["proof (state)\nthis:\n  \\<lbrakk>\\<forall>i<length T.\n              \\<exists>s. P (T ! i) s \\<and> ?S ! i = s \\<cdot> \\<delta>;\n   length T = length ?S\\<rbrakk>\n  \\<Longrightarrow> \\<exists>U.\n                       length T = length U \\<and>\n                       (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n                       ?S =\n                       U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n  \\<forall>i<length (t # T).\n     \\<exists>s. P ((t # T) ! i) s \\<and> S' ! i = s \\<cdot> \\<delta>\n  length (t # T) = length S'\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "then"], ["proof (chain)\npicking this:\n  \\<lbrakk>\\<forall>i<length T.\n              \\<exists>s. P (T ! i) s \\<and> ?S ! i = s \\<cdot> \\<delta>;\n   length T = length ?S\\<rbrakk>\n  \\<Longrightarrow> \\<exists>U.\n                       length T = length U \\<and>\n                       (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n                       ?S =\n                       U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n  \\<forall>i<length (t # T).\n     \\<exists>s. P ((t # T) ! i) s \\<and> S' ! i = s \\<cdot> \\<delta>\n  length (t # T) = length S'", "obtain s S where S': \"S' = s#S\""], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<forall>i<length T.\n              \\<exists>s. P (T ! i) s \\<and> ?S ! i = s \\<cdot> \\<delta>;\n   length T = length ?S\\<rbrakk>\n  \\<Longrightarrow> \\<exists>U.\n                       length T = length U \\<and>\n                       (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n                       ?S =\n                       U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n  \\<forall>i<length (t # T).\n     \\<exists>s. P ((t # T) ! i) s \\<and> S' ! i = s \\<cdot> \\<delta>\n  length (t # T) = length S'\n\ngoal (1 subgoal):\n 1. (\\<And>s S. S' = s # S \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (cases S') auto"], ["proof (state)\nthis:\n  S' = s # S\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "have \"\\<forall>i < length T. \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\" \"length T = length S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>i<length T.\n       \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta> &&&\n    length T = length S", "using Cons.prems S'"], ["proof (prove)\nusing this:\n  \\<forall>i<length (t # T).\n     \\<exists>s. P ((t # T) ! i) s \\<and> S' ! i = s \\<cdot> \\<delta>\n  length (t # T) = length S'\n  S' = s # S\n\ngoal (1 subgoal):\n 1. \\<forall>i<length T.\n       \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta> &&&\n    length T = length S", "by force+"], ["proof (state)\nthis:\n  \\<forall>i<length T.\n     \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\n  length T = length S\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "then"], ["proof (chain)\npicking this:\n  \\<forall>i<length T.\n     \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\n  length T = length S", "obtain U where U:\n      \"length T = length U\" \"\\<forall>i < length T. P (T ! i) (U ! i)\" \"S = map (\\<lambda>u. u \\<cdot> \\<delta>) U\""], ["proof (prove)\nusing this:\n  \\<forall>i<length T.\n     \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\n  length T = length S\n\ngoal (1 subgoal):\n 1. (\\<And>U.\n        \\<lbrakk>length T = length U;\n         \\<forall>i<length T. P (T ! i) (U ! i);\n         S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using Cons.IH"], ["proof (prove)\nusing this:\n  \\<forall>i<length T.\n     \\<exists>s. P (T ! i) s \\<and> S ! i = s \\<cdot> \\<delta>\n  length T = length S\n  \\<lbrakk>\\<forall>i<length T.\n              \\<exists>s. P (T ! i) s \\<and> ?S ! i = s \\<cdot> \\<delta>;\n   length T = length ?S\\<rbrakk>\n  \\<Longrightarrow> \\<exists>U.\n                       length T = length U \\<and>\n                       (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n                       ?S =\n                       U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<And>U.\n        \\<lbrakk>length T = length U;\n         \\<forall>i<length T. P (T ! i) (U ! i);\n         S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  length T = length U\n  \\<forall>i<length T. P (T ! i) (U ! i)\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "obtain u where u: \"P t u\" \"s = u \\<cdot> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>P t u; s = u \\<cdot> \\<delta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using Cons.prems(1) S'"], ["proof (prove)\nusing this:\n  \\<forall>i<length (t # T).\n     \\<exists>s. P ((t # T) ! i) s \\<and> S' ! i = s \\<cdot> \\<delta>\n  S' = s # S\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>P t u; s = u \\<cdot> \\<delta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  P t u\n  s = u \\<cdot> \\<delta>\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "have 1: \"length (t#T) = length (u#U)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. length (t # T) = length (u # U)", "using Cons.prems(2) U(1)"], ["proof (prove)\nusing this:\n  length (t # T) = length S'\n  length T = length U\n\ngoal (1 subgoal):\n 1. length (t # T) = length (u # U)", "by fastforce"], ["proof (state)\nthis:\n  length (t # T) = length (u # U)\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "have 2: \"\\<forall>i < length (t#T). P ((t#T) ! i) ((u#U) ! i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>i<length (t # T). P ((t # T) ! i) ((u # U) ! i)", "using u(1) U(2)"], ["proof (prove)\nusing this:\n  P t u\n  \\<forall>i<length T. P (T ! i) (U ! i)\n\ngoal (1 subgoal):\n 1. \\<forall>i<length (t # T). P ((t # T) ! i) ((u # U) ! i)", "by (simp add: nth_Cons')"], ["proof (state)\nthis:\n  \\<forall>i<length (t # T). P ((t # T) ! i) ((u # U) ! i)\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "have 3: \"S' = map (\\<lambda>u. u \\<cdot> \\<delta>) (u#U)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. S' = u # U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "using U u S'"], ["proof (prove)\nusing this:\n  length T = length U\n  \\<forall>i<length T. P (T ! i) (U ! i)\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n  P t u\n  s = u \\<cdot> \\<delta>\n  S' = s # S\n\ngoal (1 subgoal):\n 1. S' = u # U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "by simp"], ["proof (state)\nthis:\n  S' = u # U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (2 subgoals):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>\n 2. \\<And>a T S.\n       \\<lbrakk>\\<And>S.\n                   \\<lbrakk>\\<forall>i<length T.\n                               \\<exists>s.\n                                  P (T ! i) s \\<and>\n                                  S ! i = s \\<cdot> \\<delta>;\n                    length T = length S\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>U.\n  length T = length U \\<and>\n  (\\<forall>i<length T. P (T ! i) (U ! i)) \\<and>\n  S = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>;\n        \\<forall>i<length (a # T).\n           \\<exists>s. P ((a # T) ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length (a # T) = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length (a # T) = length U \\<and>\n                            (\\<forall>i<length (a # T).\n                                P ((a # T) ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>U.\n       length (t # T) = length U \\<and>\n       (\\<forall>i<length (t # T). P ((t # T) ! i) (U ! i)) \\<and>\n       S' = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "using 1 2 3"], ["proof (prove)\nusing this:\n  length (t # T) = length (u # U)\n  \\<forall>i<length (t # T). P ((t # T) ! i) ((u # U) ! i)\n  S' = u # U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (1 subgoal):\n 1. \\<exists>U.\n       length (t # T) = length U \\<and>\n       (\\<forall>i<length (t # T). P ((t # T) ! i) (U ! i)) \\<and>\n       S' = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "by blast"], ["proof (state)\nthis:\n  \\<exists>U.\n     length (t # T) = length U \\<and>\n     (\\<forall>i<length (t # T). P ((t # T) ! i) (U ! i)) \\<and>\n     S' = U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (1 subgoal):\n 1. \\<And>S.\n       \\<lbrakk>\\<forall>i<length [].\n                   \\<exists>s.\n                      P ([] ! i) s \\<and> S ! i = s \\<cdot> \\<delta>;\n        length [] = length S\\<rbrakk>\n       \\<Longrightarrow> \\<exists>U.\n                            length [] = length U \\<and>\n                            (\\<forall>i<length [].\n                                P ([] ! i) (U ! i)) \\<and>\n                            S =\n                            U \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n                            \\<delta>", "qed simp"], ["", "lemma subst_mono: \"t \\<sqsubseteq> u \\<Longrightarrow> t \\<cdot> s \\<sqsubseteq> u \\<cdot> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<sqsubseteq> u \\<Longrightarrow>\n    t \\<cdot> s \\<sqsubseteq> u \\<cdot> s", "by (induct u) auto"], ["", "lemma subst_mono_fv: \"x \\<in> fv t \\<Longrightarrow> s x \\<sqsubseteq> t \\<cdot> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> fv t \\<Longrightarrow> s x \\<sqsubseteq> t \\<cdot> s", "by (induct t) auto"], ["", "lemma subst_mono_neq:\n  assumes \"t \\<sqsubset> u\"\n  shows \"t \\<cdot> s \\<sqsubset> u \\<cdot> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubset> u \\<cdot> s", "proof (cases u)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x1.\n       u = Var x1 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s\n 2. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "case (Var v)"], ["proof (state)\nthis:\n  u = Var v\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       u = Var x1 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s\n 2. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "hence False"], ["proof (prove)\nusing this:\n  u = Var v\n\ngoal (1 subgoal):\n 1. False", "using \\<open>t \\<sqsubset> u\\<close>"], ["proof (prove)\nusing this:\n  u = Var v\n  t \\<sqsubset> u\n\ngoal (1 subgoal):\n 1. False", "by simp"], ["proof (state)\nthis:\n  False\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       u = Var x1 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s\n 2. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "thus ?thesis"], ["proof (prove)\nusing this:\n  False\n\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubset> u \\<cdot> s", ".."], ["proof (state)\nthis:\n  t \\<cdot> s \\<sqsubset> u \\<cdot> s\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "case (Fun f X)"], ["proof (state)\nthis:\n  u = Fun f X\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "then"], ["proof (chain)\npicking this:\n  u = Fun f X", "obtain x where \"x \\<in> set X\" \"t \\<sqsubseteq> x\""], ["proof (prove)\nusing this:\n  u = Fun f X\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> set X; t \\<sqsubseteq> x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using \\<open>t \\<sqsubset> u\\<close>"], ["proof (prove)\nusing this:\n  u = Fun f X\n  t \\<sqsubset> u\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> set X; t \\<sqsubseteq> x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  x \\<in> set X\n  t \\<sqsubseteq> x\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "hence \"t \\<cdot> s \\<sqsubseteq> x \\<cdot> s\""], ["proof (prove)\nusing this:\n  x \\<in> set X\n  t \\<sqsubseteq> x\n\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubseteq> x \\<cdot> s", "using subst_mono"], ["proof (prove)\nusing this:\n  x \\<in> set X\n  t \\<sqsubseteq> x\n  ?t \\<sqsubseteq> ?u \\<Longrightarrow>\n  ?t \\<cdot> ?s \\<sqsubseteq> ?u \\<cdot> ?s\n\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubseteq> x \\<cdot> s", "by metis"], ["proof (state)\nthis:\n  t \\<cdot> s \\<sqsubseteq> x \\<cdot> s\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "obtain Y where \"Fun f X \\<cdot> s = Fun f Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>Y.\n        Fun f X \\<cdot> s = Fun f Y \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  Fun f X \\<cdot> s = Fun f Y\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "hence \"x \\<cdot> s \\<in> set Y\""], ["proof (prove)\nusing this:\n  Fun f X \\<cdot> s = Fun f Y\n\ngoal (1 subgoal):\n 1. x \\<cdot> s \\<in> set Y", "using \\<open>x \\<in> set X\\<close>"], ["proof (prove)\nusing this:\n  Fun f X \\<cdot> s = Fun f Y\n  x \\<in> set X\n\ngoal (1 subgoal):\n 1. x \\<cdot> s \\<in> set Y", "by auto"], ["proof (state)\nthis:\n  x \\<cdot> s \\<in> set Y\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "hence \"x \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\""], ["proof (prove)\nusing this:\n  x \\<cdot> s \\<in> set Y\n\ngoal (1 subgoal):\n 1. x \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s", "using \\<open>Fun f X \\<cdot> s = Fun f Y\\<close> Fun_param_is_subterm"], ["proof (prove)\nusing this:\n  x \\<cdot> s \\<in> set Y\n  Fun f X \\<cdot> s = Fun f Y\n  ?x \\<in> set ?X \\<Longrightarrow> ?x \\<sqsubset> Fun ?f ?X\n\ngoal (1 subgoal):\n 1. x \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s", "by simp"], ["proof (state)\nthis:\n  x \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "hence \"t \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\""], ["proof (prove)\nusing this:\n  x \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\n\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s", "using \\<open>t \\<cdot> s \\<sqsubseteq> x \\<cdot> s\\<close>"], ["proof (prove)\nusing this:\n  x \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\n  t \\<cdot> s \\<sqsubseteq> x \\<cdot> s\n\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s", "by (metis term.dual_order.trans term.eq_iff)"], ["proof (state)\nthis:\n  t \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow> t \\<cdot> s \\<sqsubset> u \\<cdot> s", "thus ?thesis"], ["proof (prove)\nusing this:\n  t \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\n\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubset> u \\<cdot> s", "using \\<open>u = Fun f X\\<close> \\<open>t \\<sqsubset> u\\<close>"], ["proof (prove)\nusing this:\n  t \\<cdot> s \\<sqsubset> Fun f X \\<cdot> s\n  u = Fun f X\n  t \\<sqsubset> u\n\ngoal (1 subgoal):\n 1. t \\<cdot> s \\<sqsubset> u \\<cdot> s", "by metis"], ["proof (state)\nthis:\n  t \\<cdot> s \\<sqsubset> u \\<cdot> s\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_no_occs[dest]: \"\\<not>Var v \\<sqsubseteq> t \\<Longrightarrow> t \\<cdot> Var(v := s) = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Var v \\<notin> subterms t \\<Longrightarrow> t \\<cdot> Var(v := s) = t", "by (induct t) (simp_all add: map_idI)"], ["", "lemma var_comp[simp]: \"\\<sigma> \\<circ>\\<^sub>s Var = \\<sigma>\" \"Var \\<circ>\\<^sub>s \\<sigma> = \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma> \\<circ>\\<^sub>s Var = \\<sigma> &&&\n    Var \\<circ>\\<^sub>s \\<sigma> = \\<sigma>", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. \\<sigma> x \\<cdot> Var) = \\<sigma> &&&\n    (\\<lambda>x. Var x \\<cdot> \\<sigma>) = \\<sigma>", "by simp_all"], ["", "lemma subst_comp_all: \"M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> \\<circ>\\<^sub>s \\<theta>) = (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> \\<circ>\\<^sub>s \\<theta> =\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta> \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta>", "using subst_subst_compose[of _ \\<delta> \\<theta>]"], ["proof (prove)\nusing this:\n  ?t \\<cdot> \\<delta> \\<circ>\\<^sub>s \\<theta> =\n  ?t \\<cdot> \\<delta> \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> \\<circ>\\<^sub>s \\<theta> =\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta> \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta>", "by auto"], ["", "lemma subst_all_mono: \"M \\<subseteq> M' \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s \\<subseteq> M' \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<subseteq> M' \\<Longrightarrow>\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s\n    \\<subseteq> M' \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s", "by auto"], ["", "lemma subst_comp_set_image: \"(\\<delta> \\<circ>\\<^sub>s \\<theta>) ` X = \\<delta> ` X \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<theta>) ` X =\n    \\<delta> ` X \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "using subst_compose"], ["proof (prove)\nusing this:\n  (?\\<sigma> \\<circ>\\<^sub>s ?\\<tau>) ?x = ?\\<sigma> ?x \\<cdot> ?\\<tau>\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<theta>) ` X =\n    \\<delta> ` X \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "by fastforce"], ["", "lemma subst_ground_ident[dest?]: \"fv t = {} \\<Longrightarrow> t \\<cdot> s = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t = {} \\<Longrightarrow> t \\<cdot> s = t", "by (induct t, simp, metis subst_agreement empty_iff subst_apply_term_empty)"], ["", "lemma subst_ground_ident_compose:\n  \"fv (\\<sigma> x) = {} \\<Longrightarrow> (\\<sigma> \\<circ>\\<^sub>s \\<theta>) x = \\<sigma> x\"\n  \"fv (t \\<cdot> \\<sigma>) = {} \\<Longrightarrow> t \\<cdot> (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = t \\<cdot> \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (fv (\\<sigma> x) = {} \\<Longrightarrow>\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>) x = \\<sigma> x) &&&\n    (fv (t \\<cdot> \\<sigma>) = {} \\<Longrightarrow>\n     t \\<cdot> \\<sigma> \\<circ>\\<^sub>s \\<theta> = t \\<cdot> \\<sigma>)", "using subst_subst_compose[of t \\<sigma> \\<theta>]"], ["proof (prove)\nusing this:\n  t \\<cdot> \\<sigma> \\<circ>\\<^sub>s \\<theta> =\n  t \\<cdot> \\<sigma> \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (fv (\\<sigma> x) = {} \\<Longrightarrow>\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>) x = \\<sigma> x) &&&\n    (fv (t \\<cdot> \\<sigma>) = {} \\<Longrightarrow>\n     t \\<cdot> \\<sigma> \\<circ>\\<^sub>s \\<theta> = t \\<cdot> \\<sigma>)", "by (simp_all add: subst_compose_def subst_ground_ident)"], ["", "lemma subst_all_ground_ident[dest?]: \"ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "assume \"ground M\""], ["proof (state)\nthis:\n  ground M\n\ngoal (1 subgoal):\n 1. ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "hence \"\\<And>t. t \\<in> M \\<Longrightarrow> fv t = {}\""], ["proof (prove)\nusing this:\n  ground M\n\ngoal (1 subgoal):\n 1. \\<And>t. t \\<in> M \\<Longrightarrow> fv t = {}", "by auto"], ["proof (state)\nthis:\n  ?t \\<in> M \\<Longrightarrow> fv ?t = {}\n\ngoal (1 subgoal):\n 1. ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "hence \"\\<And>t. t \\<in> M \\<Longrightarrow> t \\<cdot> s = t\""], ["proof (prove)\nusing this:\n  ?t \\<in> M \\<Longrightarrow> fv ?t = {}\n\ngoal (1 subgoal):\n 1. \\<And>t. t \\<in> M \\<Longrightarrow> t \\<cdot> s = t", "by (metis subst_ground_ident)"], ["proof (state)\nthis:\n  ?t \\<in> M \\<Longrightarrow> ?t \\<cdot> s = ?t\n\ngoal (1 subgoal):\n 1. ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "moreover"], ["proof (state)\nthis:\n  ?t \\<in> M \\<Longrightarrow> ?t \\<cdot> s = ?t\n\ngoal (1 subgoal):\n 1. ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "have \"\\<And>t. t \\<in> M \\<Longrightarrow> t \\<cdot> s \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>t.\n       t \\<in> M \\<Longrightarrow>\n       t \\<cdot> s \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s", "by (metis imageI)"], ["proof (state)\nthis:\n  ?t \\<in> M \\<Longrightarrow>\n  ?t \\<cdot> s \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s\n\ngoal (1 subgoal):\n 1. ground M \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "ultimately"], ["proof (chain)\npicking this:\n  ?t \\<in> M \\<Longrightarrow> ?t \\<cdot> s = ?t\n  ?t \\<in> M \\<Longrightarrow>\n  ?t \\<cdot> s \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s", "show \"M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M\""], ["proof (prove)\nusing this:\n  ?t \\<in> M \\<Longrightarrow> ?t \\<cdot> s = ?t\n  ?t \\<in> M \\<Longrightarrow>\n  ?t \\<cdot> s \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M", "by (simp add: image_cong)"], ["proof (state)\nthis:\n  M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t s = M\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_eqI[intro]: \"(\\<And>t. t \\<cdot> \\<sigma> = t \\<cdot> \\<theta>) \\<Longrightarrow> \\<sigma> = \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t. t \\<cdot> \\<sigma> = t \\<cdot> \\<theta>) \\<Longrightarrow>\n    \\<sigma> = \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<And>t. t \\<cdot> \\<sigma> = t \\<cdot> \\<theta>) \\<Longrightarrow>\n    \\<sigma> = \\<theta>", "assume \"\\<And>t. t \\<cdot> \\<sigma> = t \\<cdot> \\<theta>\""], ["proof (state)\nthis:\n  ?t \\<cdot> \\<sigma> = ?t \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>t. t \\<cdot> \\<sigma> = t \\<cdot> \\<theta>) \\<Longrightarrow>\n    \\<sigma> = \\<theta>", "hence \"\\<And>v. Var v \\<cdot> \\<sigma> = Var v \\<cdot> \\<theta>\""], ["proof (prove)\nusing this:\n  ?t \\<cdot> \\<sigma> = ?t \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>v. Var v \\<cdot> \\<sigma> = Var v \\<cdot> \\<theta>", "by auto"], ["proof (state)\nthis:\n  Var ?v \\<cdot> \\<sigma> = Var ?v \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>t. t \\<cdot> \\<sigma> = t \\<cdot> \\<theta>) \\<Longrightarrow>\n    \\<sigma> = \\<theta>", "thus \"\\<sigma> = \\<theta>\""], ["proof (prove)\nusing this:\n  Var ?v \\<cdot> \\<sigma> = Var ?v \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<sigma> = \\<theta>", "by auto"], ["proof (state)\nthis:\n  \\<sigma> = \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_cong: \"\\<lbrakk>\\<sigma> = \\<sigma>'; \\<theta> = \\<theta>'\\<rbrakk> \\<Longrightarrow> (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = (\\<sigma>' \\<circ>\\<^sub>s \\<theta>')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<sigma> = \\<sigma>'; \\<theta> = \\<theta>'\\<rbrakk>\n    \\<Longrightarrow> \\<sigma> \\<circ>\\<^sub>s \\<theta> =\n                      \\<sigma>' \\<circ>\\<^sub>s \\<theta>'", "by auto"], ["", "lemma subst_mgt_bot[simp]: \"Var \\<preceq>\\<^sub>\\<circ> \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Var \\<preceq>\\<^sub>\\<circ> \\<theta>", "by simp"], ["", "lemma subst_mgt_refl[simp]: \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>", "by (metis var_comp(1))"], ["", "lemma subst_mgt_trans: \"\\<lbrakk>\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>; \\<delta> \\<preceq>\\<^sub>\\<circ> \\<sigma>\\<rbrakk> \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>;\n     \\<delta> \\<preceq>\\<^sub>\\<circ> \\<sigma>\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<sigma>", "by (metis subst_compose_assoc)"], ["", "lemma subst_mgt_comp: \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<delta>", "by auto"], ["", "lemma subst_mgt_comp': \"\\<theta> \\<circ>\\<^sub>s \\<delta> \\<preceq>\\<^sub>\\<circ> \\<sigma> \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> \\<circ>\\<^sub>s \\<delta> \\<preceq>\\<^sub>\\<circ>\n    \\<sigma> \\<Longrightarrow>\n    \\<theta> \\<preceq>\\<^sub>\\<circ> \\<sigma>", "by (metis subst_compose_assoc)"], ["", "lemma var_self: \"(\\<lambda>w. if w = v then Var v else Var w) = Var\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>w. if w = v then Var v else Var w) = Var", "using subst_agreement"], ["proof (prove)\nusing this:\n  (?t \\<cdot> ?r = ?t \\<cdot> ?s) =\n  (\\<forall>v\\<in>fv ?t. Var v \\<cdot> ?r = Var v \\<cdot> ?s)\n\ngoal (1 subgoal):\n 1. (\\<lambda>w. if w = v then Var v else Var w) = Var", "by auto"], ["", "lemma var_same[simp]: \"Var(v := t) = Var \\<longleftrightarrow> t = Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (Var(v := t) = Var) = (t = Var v)", "by (intro iffI, metis fun_upd_same, simp add: var_self)"], ["", "lemma subst_eq_if_eq_vars: \"(\\<And>v. (Var v) \\<cdot> \\<theta> = (Var v) \\<cdot> \\<sigma>) \\<Longrightarrow> \\<theta> = \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v.\n        Var v \\<cdot> \\<theta> = Var v \\<cdot> \\<sigma>) \\<Longrightarrow>\n    \\<theta> = \\<sigma>", "by (auto simp add: subst_agreement)"], ["", "lemma subst_all_empty[simp]: \"{} \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {} \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = {}", "by simp"], ["", "lemma subst_all_insert:\"(insert t M) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> = insert (t \\<cdot> \\<delta>) (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. insert t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> =\n    insert (t \\<cdot> \\<delta>) (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>)", "by auto"], ["", "lemma subst_apply_fv_subset: \"fv t \\<subseteq> V \\<Longrightarrow> fv (t \\<cdot> \\<delta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<subseteq> V \\<Longrightarrow>\n    fv (t \\<cdot> \\<delta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V)", "by (induct t) auto"], ["", "lemma subst_apply_fv_empty:\n  assumes \"fv t = {}\"\n  shows \"fv (t \\<cdot> \\<sigma>) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<sigma>) = {}", "using assms subst_apply_fv_subset[of t \"{}\" \\<sigma>]"], ["proof (prove)\nusing this:\n  fv t = {}\n  fv t \\<subseteq> {} \\<Longrightarrow>\n  fv (t \\<cdot> \\<sigma>)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<sigma> ` {})\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<sigma>) = {}", "by auto"], ["", "lemma subst_compose_fv:\n  assumes \"fv (\\<theta> x) = {}\"\n  shows \"fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) x) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) x) = {}", "using assms subst_apply_fv_empty"], ["proof (prove)\nusing this:\n  fv (\\<theta> x) = {}\n  fv ?t = {} \\<Longrightarrow> fv (?t \\<cdot> ?\\<sigma>) = {}\n\ngoal (1 subgoal):\n 1. fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) x) = {}", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  fv (\\<theta> x) = {}\n  fv ?t = {} \\<Longrightarrow> fv (?t \\<cdot> ?\\<sigma>) = {}\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x \\<cdot> \\<sigma>) = {}", "by fast"], ["", "lemma subst_compose_fv':\n  fixes \\<theta> \\<sigma>::\"('a,'b) subst\"\n  assumes \"y \\<in> fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) x)\"\n  shows \"\\<exists>z. z \\<in> fv (\\<theta> x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>z. z \\<in> fv (\\<theta> x)", "using assms subst_compose_fv"], ["proof (prove)\nusing this:\n  y \\<in> fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) x)\n  fv (?\\<theta> ?x) = {} \\<Longrightarrow>\n  fv ((?\\<theta> \\<circ>\\<^sub>s ?\\<sigma>) ?x) = {}\n\ngoal (1 subgoal):\n 1. \\<exists>z. z \\<in> fv (\\<theta> x)", "by fast"], ["", "lemma subst_apply_fv_unfold: \"fv (t \\<cdot> \\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)", "by (induct t) auto"], ["", "lemma subst_apply_fv_unfold': \"fv (t \\<cdot> \\<delta>) = (\\<Union>v \\<in> fv t. fv (\\<delta> v))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<delta>) = (\\<Union>v\\<in>fv t. fv (\\<delta> v))", "using subst_apply_fv_unfold"], ["proof (prove)\nusing this:\n  fv (?t \\<cdot> ?\\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (?\\<delta> ` fv ?t)\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<delta>) = (\\<Union>v\\<in>fv t. fv (\\<delta> v))", "by simp"], ["", "lemma subst_apply_fv_union: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union> fv (t \\<cdot> \\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n    fv (t \\<cdot> \\<delta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n    fv (t \\<cdot> \\<delta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))", "have \"fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t)) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t)) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)", "by auto"], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t)) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n    fv (t \\<cdot> \\<delta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t)) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n    fv (t \\<cdot> \\<delta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))", "using subst_apply_fv_unfold"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t)) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv t)\n  fv (?t \\<cdot> ?\\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (?\\<delta> ` fv ?t)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n    fv (t \\<cdot> \\<delta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))", "by metis"], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` V) \\<union>\n  fv (t \\<cdot> \\<delta>) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (V \\<union> fv t))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_elimI[intro]: \"(\\<And>t. v \\<notin> fv (t \\<cdot> \\<sigma>)) \\<Longrightarrow> subst_elim \\<sigma> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t. v \\<notin> fv (t \\<cdot> \\<sigma>)) \\<Longrightarrow>\n    subst_elim \\<sigma> v", "by (auto simp add: subst_elim_def)"], ["", "lemma subst_elimI'[intro]: \"(\\<And>w. v \\<notin> fv (Var w \\<cdot> \\<theta>)) \\<Longrightarrow> subst_elim \\<theta> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>w. v \\<notin> fv (Var w \\<cdot> \\<theta>)) \\<Longrightarrow>\n    subst_elim \\<theta> v", "by (simp add: subst_elim_def subst_apply_fv_unfold')"], ["", "lemma subst_elimD[dest]: \"subst_elim \\<sigma> v \\<Longrightarrow> v \\<notin> fv (t \\<cdot> \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_elim \\<sigma> v \\<Longrightarrow>\n    v \\<notin> fv (t \\<cdot> \\<sigma>)", "by (auto simp add: subst_elim_def)"], ["", "lemma subst_elimD'[dest]: \"subst_elim \\<sigma> v \\<Longrightarrow> \\<sigma> v \\<noteq> Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_elim \\<sigma> v \\<Longrightarrow> \\<sigma> v \\<noteq> Var v", "by (metis subst_elim_def subst_apply_term.simps(1) term.set_intros(3))"], ["", "lemma subst_elimD''[dest]: \"subst_elim \\<sigma> v \\<Longrightarrow> v \\<notin> fv (\\<sigma> w)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_elim \\<sigma> v \\<Longrightarrow> v \\<notin> fv (\\<sigma> w)", "by (metis subst_elim_def subst_apply_term.simps(1))"], ["", "lemma subst_elim_rm_vars_dest[dest]:\n  \"subst_elim (\\<sigma>::('a,'b) subst) v \\<Longrightarrow> v \\<notin> vs \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "assume assms: \"subst_elim \\<sigma> v\" \"v \\<notin> vs\""], ["proof (state)\nthis:\n  subst_elim \\<sigma> v\n  v \\<notin> vs\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "obtain f::\"('a, 'b) subst \\<Rightarrow> 'b \\<Rightarrow> 'b\" where\n      \"\\<forall>\\<sigma> v. (\\<exists>w. v \\<in> fv (Var w \\<cdot> \\<sigma>)) = (v \\<in> fv (Var (f \\<sigma> v) \\<cdot> \\<sigma>))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>f.\n        \\<forall>\\<sigma> v.\n           (\\<exists>w. v \\<in> fv (Var w \\<cdot> \\<sigma>)) =\n           (v \\<in> fv (Var (f \\<sigma> v) \\<cdot>\n                        \\<sigma>)) \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  \\<forall>\\<sigma> v.\n     (\\<exists>w. v \\<in> fv (Var w \\<cdot> \\<sigma>)) =\n     (v \\<in> fv (Var (f \\<sigma> v) \\<cdot> \\<sigma>))\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "hence *: \"\\<forall>a \\<sigma>. a \\<in> fv (Var (f \\<sigma> a) \\<cdot> \\<sigma>) \\<or> subst_elim \\<sigma> a\""], ["proof (prove)\nusing this:\n  \\<forall>\\<sigma> v.\n     (\\<exists>w. v \\<in> fv (Var w \\<cdot> \\<sigma>)) =\n     (v \\<in> fv (Var (f \\<sigma> v) \\<cdot> \\<sigma>))\n\ngoal (1 subgoal):\n 1. \\<forall>a \\<sigma>.\n       a \\<in> fv (Var (f \\<sigma> a) \\<cdot> \\<sigma>) \\<or>\n       subst_elim \\<sigma> a", "by blast"], ["proof (state)\nthis:\n  \\<forall>a \\<sigma>.\n     a \\<in> fv (Var (f \\<sigma> a) \\<cdot> \\<sigma>) \\<or>\n     subst_elim \\<sigma> a\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "have \"Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq> Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma>\n        \\<or> v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n    Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n    v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                   rm_vars vs \\<sigma>)", "using assms(1)"], ["proof (prove)\nusing this:\n  subst_elim \\<sigma> v\n\ngoal (1 subgoal):\n 1. Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n    Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n    v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                   rm_vars vs \\<sigma>)", "by fastforce"], ["proof (state)\nthis:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n  v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                 rm_vars vs \\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "moreover"], ["proof (state)\nthis:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n  v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                 rm_vars vs \\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "{"], ["proof (state)\nthis:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n  v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                 rm_vars vs \\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "assume \"Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq> Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma>\""], ["proof (state)\nthis:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "hence \"rm_vars vs \\<sigma> (f (rm_vars vs \\<sigma>) v) \\<noteq> \\<sigma> (f (rm_vars vs \\<sigma>) v)\""], ["proof (prove)\nusing this:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma>\n\ngoal (1 subgoal):\n 1. rm_vars vs \\<sigma> (f (rm_vars vs \\<sigma>) v) \\<noteq>\n    \\<sigma> (f (rm_vars vs \\<sigma>) v)", "by auto"], ["proof (state)\nthis:\n  rm_vars vs \\<sigma> (f (rm_vars vs \\<sigma>) v) \\<noteq>\n  \\<sigma> (f (rm_vars vs \\<sigma>) v)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "hence \"f (rm_vars vs \\<sigma>) v \\<in> vs\""], ["proof (prove)\nusing this:\n  rm_vars vs \\<sigma> (f (rm_vars vs \\<sigma>) v) \\<noteq>\n  \\<sigma> (f (rm_vars vs \\<sigma>) v)\n\ngoal (1 subgoal):\n 1. f (rm_vars vs \\<sigma>) v \\<in> vs", "by meson"], ["proof (state)\nthis:\n  f (rm_vars vs \\<sigma>) v \\<in> vs\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "hence ?thesis"], ["proof (prove)\nusing this:\n  f (rm_vars vs \\<sigma>) v \\<in> vs\n\ngoal (1 subgoal):\n 1. subst_elim (rm_vars vs \\<sigma>) v", "using * assms(2)"], ["proof (prove)\nusing this:\n  f (rm_vars vs \\<sigma>) v \\<in> vs\n  \\<forall>a \\<sigma>.\n     a \\<in> fv (Var (f \\<sigma> a) \\<cdot> \\<sigma>) \\<or>\n     subst_elim \\<sigma> a\n  v \\<notin> vs\n\ngoal (1 subgoal):\n 1. subst_elim (rm_vars vs \\<sigma>) v", "by force"], ["proof (state)\nthis:\n  subst_elim (rm_vars vs \\<sigma>) v\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "}"], ["proof (state)\nthis:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n  rm_vars vs \\<sigma> \\<Longrightarrow>\n  subst_elim (rm_vars vs \\<sigma>) v\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim \\<sigma> v; v \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> subst_elim (rm_vars vs \\<sigma>) v", "ultimately"], ["proof (chain)\npicking this:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n  v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                 rm_vars vs \\<sigma>)\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n  rm_vars vs \\<sigma> \\<Longrightarrow>\n  subst_elim (rm_vars vs \\<sigma>) v", "show ?thesis"], ["proof (prove)\nusing this:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n  v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                 rm_vars vs \\<sigma>)\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n  rm_vars vs \\<sigma> \\<Longrightarrow>\n  subst_elim (rm_vars vs \\<sigma>) v\n\ngoal (1 subgoal):\n 1. subst_elim (rm_vars vs \\<sigma>) v", "using *"], ["proof (prove)\nusing this:\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> rm_vars vs \\<sigma> \\<or>\n  v \\<notin> fv (Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n                 rm_vars vs \\<sigma>)\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot> \\<sigma> \\<noteq>\n  Var (f (rm_vars vs \\<sigma>) v) \\<cdot>\n  rm_vars vs \\<sigma> \\<Longrightarrow>\n  subst_elim (rm_vars vs \\<sigma>) v\n  \\<forall>a \\<sigma>.\n     a \\<in> fv (Var (f \\<sigma> a) \\<cdot> \\<sigma>) \\<or>\n     subst_elim \\<sigma> a\n\ngoal (1 subgoal):\n 1. subst_elim (rm_vars vs \\<sigma>) v", "by blast"], ["proof (state)\nthis:\n  subst_elim (rm_vars vs \\<sigma>) v\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma occs_subst_elim: \"\\<not>Var v \\<sqsubset> t \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> (Var(v := t)) = Var\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> Var v \\<sqsubset> t \\<Longrightarrow>\n    subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var", "proof (cases \"Var v = t\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<not> Var v \\<sqsubset> t; Var v = t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var\n 2. \\<lbrakk>\\<not> Var v \\<sqsubset> t; Var v \\<noteq> t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var", "assume \"Var v \\<noteq> t\" \"\\<not>Var v \\<sqsubset> t\""], ["proof (state)\nthis:\n  Var v \\<noteq> t\n  \\<not> Var v \\<sqsubset> t\n\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<not> Var v \\<sqsubset> t; Var v = t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var\n 2. \\<lbrakk>\\<not> Var v \\<sqsubset> t; Var v \\<noteq> t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var", "hence \"v \\<notin> fv t\""], ["proof (prove)\nusing this:\n  Var v \\<noteq> t\n  \\<not> Var v \\<sqsubset> t\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t", "by (simp add: vars_iff_subterm_or_eq)"], ["proof (state)\nthis:\n  v \\<notin> fv t\n\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<not> Var v \\<sqsubset> t; Var v = t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var\n 2. \\<lbrakk>\\<not> Var v \\<sqsubset> t; Var v \\<noteq> t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var", "thus ?thesis"], ["proof (prove)\nusing this:\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var", "by (auto simp add: subst_remove_var)"], ["proof (state)\nthis:\n  subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<not> Var v \\<sqsubset> t; Var v = t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(v := t)) v \\<or> Var(v := t) = Var", "qed auto"], ["", "lemma occs_subst_elim': \"\\<not>Var v \\<sqsubseteq> t \\<Longrightarrow> subst_elim (Var(v := t)) v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Var v \\<notin> subterms t \\<Longrightarrow> subst_elim (Var(v := t)) v", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Var v \\<notin> subterms t \\<Longrightarrow> subst_elim (Var(v := t)) v", "assume \"\\<not>Var v \\<sqsubseteq> t\""], ["proof (state)\nthis:\n  Var v \\<notin> subterms t\n\ngoal (1 subgoal):\n 1. Var v \\<notin> subterms t \\<Longrightarrow> subst_elim (Var(v := t)) v", "hence \"v \\<notin> fv t\""], ["proof (prove)\nusing this:\n  Var v \\<notin> subterms t\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t", "by (auto simp add: vars_iff_subterm_or_eq)"], ["proof (state)\nthis:\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. Var v \\<notin> subterms t \\<Longrightarrow> subst_elim (Var(v := t)) v", "thus \"subst_elim (Var(v := t)) v\""], ["proof (prove)\nusing this:\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. subst_elim (Var(v := t)) v", "by (simp add: subst_elim_def subst_remove_var)"], ["proof (state)\nthis:\n  subst_elim (Var(v := t)) v\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_elim_comp: \"subst_elim \\<theta> v \\<Longrightarrow> subst_elim (\\<delta> \\<circ>\\<^sub>s \\<theta>) v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_elim \\<theta> v \\<Longrightarrow>\n    subst_elim (\\<delta> \\<circ>\\<^sub>s \\<theta>) v", "by (auto simp add: subst_elim_def)"], ["", "lemma var_subst_idem: \"subst_idem Var\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_idem Var", "by (simp add: subst_idem_def)"], ["", "lemma var_upd_subst_idem:\n  assumes \"\\<not>Var v \\<sqsubseteq> t\" shows \"subst_idem (Var(v := t))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_idem (Var(v := t))", "unfolding subst_idem_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. Var(v := t) \\<circ>\\<^sub>s Var(v := t) = Var(v := t)", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ta.\n       ta \\<cdot> Var(v := t) \\<circ>\\<^sub>s Var(v := t) =\n       ta \\<cdot> Var(v := t)", "let ?\\<theta> = \"Var(v := t)\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ta.\n       ta \\<cdot> Var(v := t) \\<circ>\\<^sub>s Var(v := t) =\n       ta \\<cdot> Var(v := t)", "from assms"], ["proof (chain)\npicking this:\n  Var v \\<notin> subterms t", "have t_\\<theta>_id: \"t \\<cdot> ?\\<theta> = t\""], ["proof (prove)\nusing this:\n  Var v \\<notin> subterms t\n\ngoal (1 subgoal):\n 1. t \\<cdot> Var(v := t) = t", "by blast"], ["proof (state)\nthis:\n  t \\<cdot> Var(v := t) = t\n\ngoal (1 subgoal):\n 1. \\<And>ta.\n       ta \\<cdot> Var(v := t) \\<circ>\\<^sub>s Var(v := t) =\n       ta \\<cdot> Var(v := t)", "fix s"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ta.\n       ta \\<cdot> Var(v := t) \\<circ>\\<^sub>s Var(v := t) =\n       ta \\<cdot> Var(v := t)", "show \"s \\<cdot> (?\\<theta> \\<circ>\\<^sub>s ?\\<theta>) = s \\<cdot> ?\\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<cdot> Var(v := t) \\<circ>\\<^sub>s Var(v := t) =\n    s \\<cdot> Var(v := t)", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<cdot> (\\<lambda>x. (Var(v := t)) x \\<cdot> Var(v := t)) =\n    s \\<cdot> Var(v := t)", "by (induction s, metis t_\\<theta>_id fun_upd_def subst_apply_term.simps(1), simp)"], ["proof (state)\nthis:\n  s \\<cdot> Var(v := t) \\<circ>\\<^sub>s Var(v := t) = s \\<cdot> Var(v := t)\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \\<open>Lemmata: Domain and Range of Substitutions\\<close>"], ["", "lemma range_vars_alt_def: \"range_vars s \\<equiv> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars s \\<equiv> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)", "unfolding range_vars_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Union> (fv ` subst_range s) \\<equiv>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)", "by simp"], ["", "lemma subst_dom_var_finite[simp]: \"finite (subst_domain Var)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain Var)", "by simp"], ["", "lemma subst_range_Var[simp]: \"subst_range Var = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range Var = {}", "by simp"], ["", "lemma range_vars_Var[simp]: \"range_vars Var = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars Var = {}", "by fastforce"], ["", "lemma finite_subst_img_if_finite_dom: \"finite (subst_domain \\<sigma>) \\<Longrightarrow> finite (range_vars \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain \\<sigma>) \\<Longrightarrow>\n    finite (range_vars \\<sigma>)", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain \\<sigma>) \\<Longrightarrow>\n    finite (fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>))", "by auto"], ["", "lemma finite_subst_img_if_finite_dom': \"finite (subst_domain \\<sigma>) \\<Longrightarrow> finite (subst_range \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain \\<sigma>) \\<Longrightarrow>\n    finite (subst_range \\<sigma>)", "by auto"], ["", "lemma subst_img_alt_def: \"subst_range s = {t. \\<exists>v. s v = t \\<and> t \\<noteq> Var v}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range s = {t. \\<exists>v. s v = t \\<and> t \\<noteq> Var v}", "by (auto simp add: subst_domain_def)"], ["", "lemma subst_fv_img_alt_def: \"range_vars s = (\\<Union>t \\<in> {t. \\<exists>v. s v = t \\<and> t \\<noteq> Var v}. fv t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars s =\n    \\<Union> (fv ` {t. \\<exists>v. s v = t \\<and> t \\<noteq> Var v})", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s) =\n    \\<Union> (fv ` {t. \\<exists>v. s v = t \\<and> t \\<noteq> Var v})", "by (auto simp add: subst_domain_def)"], ["", "lemma subst_domI[intro]: \"\\<sigma> v \\<noteq> Var v \\<Longrightarrow> v \\<in> subst_domain \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma> v \\<noteq> Var v \\<Longrightarrow>\n    v \\<in> subst_domain \\<sigma>", "by (simp add: subst_domain_def)"], ["", "lemma subst_imgI[intro]: \"\\<sigma> v \\<noteq> Var v \\<Longrightarrow> \\<sigma> v \\<in> subst_range \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma> v \\<noteq> Var v \\<Longrightarrow>\n    \\<sigma> v \\<in> subst_range \\<sigma>", "by (simp add: subst_domain_def)"], ["", "lemma subst_fv_imgI[intro]: \"\\<sigma> v \\<noteq> Var v \\<Longrightarrow> fv (\\<sigma> v) \\<subseteq> range_vars \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma> v \\<noteq> Var v \\<Longrightarrow>\n    fv (\\<sigma> v) \\<subseteq> range_vars \\<sigma>", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma> v \\<noteq> Var v \\<Longrightarrow>\n    fv (\\<sigma> v)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>)", "by auto"], ["", "lemma subst_domain_subst_Fun_single[simp]:\n  \"subst_domain (Var(x := Fun f T)) = {x}\" (is \"?A = ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (Var(x := Fun f T)) = {x}", "unfolding subst_domain_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. {xa. (Var(x := Fun f T)) xa \\<noteq> Var xa} = {x}", "by simp"], ["", "lemma subst_range_subst_Fun_single[simp]:\n  \"subst_range (Var(x := Fun f T)) = {Fun f T}\" (is \"?A = ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range (Var(x := Fun f T)) = {Fun f T}", "by simp"], ["", "lemma range_vars_subst_Fun_single[simp]:\n  \"range_vars (Var(x := Fun f T)) = fv (Fun f T)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars (Var(x := Fun f T)) = fv (Fun f T)", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (Var(x := Fun f T))) =\n    fv (Fun f T)", "by force"], ["", "lemma var_renaming_is_Fun_iff:\n  assumes \"subst_range \\<delta> \\<subseteq> range Var\"\n  shows \"is_Fun t = is_Fun (t \\<cdot> \\<delta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. is_Fun t = is_Fun (t \\<cdot> \\<delta>)", "proof (cases t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x1.\n       t = Var x1 \\<Longrightarrow> is_Fun t = is_Fun (t \\<cdot> \\<delta>)\n 2. \\<And>x21 x22.\n       t = Fun x21 x22 \\<Longrightarrow>\n       is_Fun t = is_Fun (t \\<cdot> \\<delta>)", "case (Var x)"], ["proof (state)\nthis:\n  t = Var x\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       t = Var x1 \\<Longrightarrow> is_Fun t = is_Fun (t \\<cdot> \\<delta>)\n 2. \\<And>x21 x22.\n       t = Fun x21 x22 \\<Longrightarrow>\n       is_Fun t = is_Fun (t \\<cdot> \\<delta>)", "hence \"\\<exists>y. \\<delta> x = Var y\""], ["proof (prove)\nusing this:\n  t = Var x\n\ngoal (1 subgoal):\n 1. \\<exists>y. \\<delta> x = Var y", "using assms"], ["proof (prove)\nusing this:\n  t = Var x\n  subst_range \\<delta> \\<subseteq> range Var\n\ngoal (1 subgoal):\n 1. \\<exists>y. \\<delta> x = Var y", "by auto"], ["proof (state)\nthis:\n  \\<exists>y. \\<delta> x = Var y\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       t = Var x1 \\<Longrightarrow> is_Fun t = is_Fun (t \\<cdot> \\<delta>)\n 2. \\<And>x21 x22.\n       t = Fun x21 x22 \\<Longrightarrow>\n       is_Fun t = is_Fun (t \\<cdot> \\<delta>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<exists>y. \\<delta> x = Var y\n\ngoal (1 subgoal):\n 1. is_Fun t = is_Fun (t \\<cdot> \\<delta>)", "using Var"], ["proof (prove)\nusing this:\n  \\<exists>y. \\<delta> x = Var y\n  t = Var x\n\ngoal (1 subgoal):\n 1. is_Fun t = is_Fun (t \\<cdot> \\<delta>)", "by auto"], ["proof (state)\nthis:\n  is_Fun t = is_Fun (t \\<cdot> \\<delta>)\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       t = Fun x21 x22 \\<Longrightarrow>\n       is_Fun t = is_Fun (t \\<cdot> \\<delta>)", "qed simp"], ["", "lemma subst_fv_dom_img_subset: \"fv t \\<subseteq> subst_domain \\<theta> \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> range_vars \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>) \\<subseteq> range_vars \\<theta>", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)", "by (induct t) auto"], ["", "lemma subst_fv_dom_img_subset_set: \"fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<subseteq> subst_domain \\<theta> \\<Longrightarrow> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<subseteq> range_vars \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "assume assms: \"fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<subseteq> subst_domain \\<theta>\""], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "obtain f::\"'a set \\<Rightarrow> (('b, 'a) term \\<Rightarrow> 'a set) \\<Rightarrow> ('b, 'a) terms \\<Rightarrow> ('b, 'a) term\" where\n      \"\\<forall>x y z. (\\<exists>v. v \\<in> z \\<and> \\<not> y v \\<subseteq> x) \\<longleftrightarrow> (f x y z \\<in> z \\<and> \\<not> y (f x y z) \\<subseteq> x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>f.\n        \\<forall>x y z.\n           (\\<exists>v. v \\<in> z \\<and> \\<not> y v \\<subseteq> x) =\n           (f x y z \\<in> z \\<and>\n            \\<not> y (f x y z) \\<subseteq> x) \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  \\<forall>x y z.\n     (\\<exists>v. v \\<in> z \\<and> \\<not> y v \\<subseteq> x) =\n     (f x y z \\<in> z \\<and> \\<not> y (f x y z) \\<subseteq> x)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "hence *:\n      \"\\<forall>T g A. (\\<not> \\<Union> (g ` T) \\<subseteq> A \\<or> (\\<forall>t. t \\<notin> T \\<or> g t \\<subseteq> A)) \\<and>\n               (\\<Union> (g ` T) \\<subseteq> A \\<or> f A g T \\<in> T \\<and> \\<not> g (f A g T) \\<subseteq> A)\""], ["proof (prove)\nusing this:\n  \\<forall>x y z.\n     (\\<exists>v. v \\<in> z \\<and> \\<not> y v \\<subseteq> x) =\n     (f x y z \\<in> z \\<and> \\<not> y (f x y z) \\<subseteq> x)\n\ngoal (1 subgoal):\n 1. \\<forall>T g A.\n       (\\<not> \\<Union> (g ` T) \\<subseteq> A \\<or>\n        (\\<forall>t. t \\<notin> T \\<or> g t \\<subseteq> A)) \\<and>\n       (\\<Union> (g ` T) \\<subseteq> A \\<or>\n        f A g T \\<in> T \\<and> \\<not> g (f A g T) \\<subseteq> A)", "by (metis (no_types) SUP_le_iff)"], ["proof (state)\nthis:\n  \\<forall>T g A.\n     (\\<not> \\<Union> (g ` T) \\<subseteq> A \\<or>\n      (\\<forall>t. t \\<notin> T \\<or> g t \\<subseteq> A)) \\<and>\n     (\\<Union> (g ` T) \\<subseteq> A \\<or>\n      f A g T \\<in> T \\<and> \\<not> g (f A g T) \\<subseteq> A)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "hence **: \"\\<forall>t. t \\<notin> M \\<or> fv t \\<subseteq> subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  \\<forall>T g A.\n     (\\<not> \\<Union> (g ` T) \\<subseteq> A \\<or>\n      (\\<forall>t. t \\<notin> T \\<or> g t \\<subseteq> A)) \\<and>\n     (\\<Union> (g ` T) \\<subseteq> A \\<or>\n      f A g T \\<in> T \\<and> \\<not> g (f A g T) \\<subseteq> A)\n\ngoal (1 subgoal):\n 1. \\<forall>t. t \\<notin> M \\<or> fv t \\<subseteq> subst_domain \\<theta>", "by (metis (no_types) assms fv\\<^sub>s\\<^sub>e\\<^sub>t.simps)"], ["proof (state)\nthis:\n  \\<forall>t. t \\<notin> M \\<or> fv t \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "have \"\\<forall>t::('b, 'a) term. \\<forall>f T. t \\<notin> f ` T \\<or> (\\<exists>t'::('b, 'a) term. t = f t' \\<and> t' \\<in> T)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>t f T.\n       t \\<notin> f ` T \\<or> (\\<exists>t'. t = f t' \\<and> t' \\<in> T)", "by blast"], ["proof (state)\nthis:\n  \\<forall>t f T.\n     t \\<notin> f ` T \\<or> (\\<exists>t'. t = f t' \\<and> t' \\<in> T)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "hence \"f (range_vars \\<theta>) fv (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<notin> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<or>\n         fv (f (range_vars \\<theta>) fv (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)) \\<subseteq> range_vars \\<theta>\""], ["proof (prove)\nusing this:\n  \\<forall>t f T.\n     t \\<notin> f ` T \\<or> (\\<exists>t'. t = f t' \\<and> t' \\<in> T)\n\ngoal (1 subgoal):\n 1. f (range_vars \\<theta>) fv (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<notin> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<or>\n    fv (f (range_vars \\<theta>) fv\n         (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\n    \\<subseteq> range_vars \\<theta>", "by (metis (full_types) ** subst_fv_dom_img_subset)"], ["proof (state)\nthis:\n  f (range_vars \\<theta>) fv (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n  \\<notin> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<or>\n  fv (f (range_vars \\<theta>) fv\n       (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\n  \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M\n    \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "thus ?thesis"], ["proof (prove)\nusing this:\n  f (range_vars \\<theta>) fv (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n  \\<notin> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<or>\n  fv (f (range_vars \\<theta>) fv\n       (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\n  \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> range_vars \\<theta>", "by (metis (no_types) * fv\\<^sub>s\\<^sub>e\\<^sub>t.simps)"], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n  \\<subseteq> range_vars \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_fv_dom_ground_if_ground_img:\n  assumes \"fv t \\<subseteq> subst_domain s\" \"ground (subst_range s)\"\n  shows \"fv (t \\<cdot> s) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> s) = {}", "using subst_fv_dom_img_subset[OF assms(1)] assms(2)"], ["proof (prove)\nusing this:\n  fv (t \\<cdot> s) \\<subseteq> range_vars s\n  ground (subst_range s)\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> s) = {}", "by force"], ["", "lemma subst_fv_dom_ground_if_ground_img':\n  assumes \"fv t \\<subseteq> subst_domain s\" \"\\<And>x. x \\<in> subst_domain s \\<Longrightarrow> fv (s x) = {}\"\n  shows \"fv (t \\<cdot> s) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> s) = {}", "using subst_fv_dom_ground_if_ground_img[OF assms(1)] assms(2)"], ["proof (prove)\nusing this:\n  ground (subst_range s) \\<Longrightarrow> fv (t \\<cdot> s) = {}\n  ?x \\<in> subst_domain s \\<Longrightarrow> fv (s ?x) = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> s) = {}", "by auto"], ["", "lemma subst_fv_unfold: \"fv (t \\<cdot> s) = (fv t - subst_domain s) \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv t \\<inter> subst_domain s))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> s) =\n    fv t - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv t \\<inter> subst_domain s))", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       fv (Var x \\<cdot> s) =\n       fv (Var x) - subst_domain s \\<union>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var x) \\<inter> subst_domain s))\n 2. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s) =\n           fv x2a - subst_domain s \\<union>\n           fv\\<^sub>s\\<^sub>e\\<^sub>t\n            (s ` (fv x2a \\<inter> subst_domain s))) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s) =\n       fv (Fun x1a x2) - subst_domain s \\<union>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (s ` (fv (Fun x1a x2) \\<inter> subst_domain s))", "case (Var v)"], ["proof (state)\nthis:\n  \n\ngoal (2 subgoals):\n 1. \\<And>x.\n       fv (Var x \\<cdot> s) =\n       fv (Var x) - subst_domain s \\<union>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var x) \\<inter> subst_domain s))\n 2. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s) =\n           fv x2a - subst_domain s \\<union>\n           fv\\<^sub>s\\<^sub>e\\<^sub>t\n            (s ` (fv x2a \\<inter> subst_domain s))) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s) =\n       fv (Fun x1a x2) - subst_domain s \\<union>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (s ` (fv (Fun x1a x2) \\<inter> subst_domain s))", "thus ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "proof (cases \"v \\<in> subst_domain s\")"], ["proof (state)\ngoal (2 subgoals):\n 1. v \\<in> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))\n 2. v \\<notin> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "case True"], ["proof (state)\nthis:\n  v \\<in> subst_domain s\n\ngoal (2 subgoals):\n 1. v \\<in> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))\n 2. v \\<notin> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "thus ?thesis"], ["proof (prove)\nusing this:\n  v \\<in> subst_domain s\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "by auto"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) =\n  fv (Var v) - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "case False"], ["proof (state)\nthis:\n  v \\<notin> subst_domain s\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "hence \"fv (Var v \\<cdot> s) = {v}\" \"fv (Var v) \\<inter> subst_domain s = {}\""], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain s\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) = {v} &&& fv (Var v) \\<inter> subst_domain s = {}", "by auto"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) = {v}\n  fv (Var v) \\<inter> subst_domain s = {}\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain s \\<Longrightarrow>\n    fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv (Var v \\<cdot> s) = {v}\n  fv (Var v) \\<inter> subst_domain s = {}\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) =\n    fv (Var v) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))", "by auto"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) =\n  fv (Var v) - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) =\n  fv (Var v) - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv (Var v) \\<inter> subst_domain s))\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s) =\n           fv x2a - subst_domain s \\<union>\n           fv\\<^sub>s\\<^sub>e\\<^sub>t\n            (s ` (fv x2a \\<inter> subst_domain s))) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s) =\n       fv (Fun x1a x2) - subst_domain s \\<union>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (s ` (fv (Fun x1a x2) \\<inter> subst_domain s))", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s) =\n           fv x2a - subst_domain s \\<union>\n           fv\\<^sub>s\\<^sub>e\\<^sub>t\n            (s ` (fv x2a \\<inter> subst_domain s))) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s) =\n       fv (Fun x1a x2) - subst_domain s \\<union>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (s ` (fv (Fun x1a x2) \\<inter> subst_domain s))", "case Fun"], ["proof (state)\nthis:\n  ?x2a \\<in> set x2_ \\<Longrightarrow>\n  fv (?x2a \\<cdot> s) =\n  fv ?x2a - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv ?x2a \\<inter> subst_domain s))\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s) =\n           fv x2a - subst_domain s \\<union>\n           fv\\<^sub>s\\<^sub>e\\<^sub>t\n            (s ` (fv x2a \\<inter> subst_domain s))) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s) =\n       fv (Fun x1a x2) - subst_domain s \\<union>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (s ` (fv (Fun x1a x2) \\<inter> subst_domain s))", "thus ?case"], ["proof (prove)\nusing this:\n  ?x2a \\<in> set x2_ \\<Longrightarrow>\n  fv (?x2a \\<cdot> s) =\n  fv ?x2a - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv ?x2a \\<inter> subst_domain s))\n\ngoal (1 subgoal):\n 1. fv (Fun x1a_ x2_ \\<cdot> s) =\n    fv (Fun x1a_ x2_) - subst_domain s \\<union>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (s ` (fv (Fun x1a_ x2_) \\<inter> subst_domain s))", "by auto"], ["proof (state)\nthis:\n  fv (Fun x1a_ x2_ \\<cdot> s) =\n  fv (Fun x1a_ x2_) - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (s ` (fv (Fun x1a_ x2_) \\<inter> subst_domain s))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_fv_unfold_ground_img: \"range_vars s = {} \\<Longrightarrow> fv (t \\<cdot> s) = fv t - subst_domain s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars s = {} \\<Longrightarrow>\n    fv (t \\<cdot> s) = fv t - subst_domain s", "using subst_fv_unfold[of t s]"], ["proof (prove)\nusing this:\n  fv (t \\<cdot> s) =\n  fv t - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv t \\<inter> subst_domain s))\n\ngoal (1 subgoal):\n 1. range_vars s = {} \\<Longrightarrow>\n    fv (t \\<cdot> s) = fv t - subst_domain s", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv (t \\<cdot> s) =\n  fv t - subst_domain s \\<union>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (s ` (fv t \\<inter> subst_domain s))\n\ngoal (1 subgoal):\n 1. ground (subst_range s) \\<Longrightarrow>\n    fv (t \\<cdot> s) = fv t - subst_domain s", "by auto"], ["", "lemma subst_img_update:\n  \"\\<lbrakk>\\<sigma> v = Var v; t \\<noteq> Var v\\<rbrakk> \\<Longrightarrow> range_vars (\\<sigma>(v := t)) = range_vars \\<sigma> \\<union> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<sigma> v = Var v; t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> range_vars (\\<sigma>(v := t)) =\n                      range_vars \\<sigma> \\<union> fv t", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<sigma> v = Var v; t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> range_vars (\\<sigma>(v := t)) =\n                      range_vars \\<sigma> \\<union> fv t", "assume \"\\<sigma> v = Var v\" \"t \\<noteq> Var v\""], ["proof (state)\nthis:\n  \\<sigma> v = Var v\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<sigma> v = Var v; t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> range_vars (\\<sigma>(v := t)) =\n                      range_vars \\<sigma> \\<union> fv t", "hence \"(\\<Union>s \\<in> {s. \\<exists>w. (\\<sigma>(v := t)) w = s \\<and> s \\<noteq> Var w}. fv s) = fv t \\<union> range_vars \\<sigma>\""], ["proof (prove)\nusing this:\n  \\<sigma> v = Var v\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<Union>\n     (fv `\n      {s. \\<exists>w. (\\<sigma>(v := t)) w = s \\<and> s \\<noteq> Var w}) =\n    fv t \\<union> range_vars \\<sigma>", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  \\<sigma> v = Var v\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<Union>\n     (fv `\n      {s. \\<exists>w. (\\<sigma>(v := t)) w = s \\<and> s \\<noteq> Var w}) =\n    fv t \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<Union>\n   (fv `\n    {s. \\<exists>w. (\\<sigma>(v := t)) w = s \\<and> s \\<noteq> Var w}) =\n  fv t \\<union> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<sigma> v = Var v; t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> range_vars (\\<sigma>(v := t)) =\n                      range_vars \\<sigma> \\<union> fv t", "thus \"range_vars (\\<sigma>(v := t)) = range_vars \\<sigma> \\<union> fv t\""], ["proof (prove)\nusing this:\n  \\<Union>\n   (fv `\n    {s. \\<exists>w. (\\<sigma>(v := t)) w = s \\<and> s \\<noteq> Var w}) =\n  fv t \\<union> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. range_vars (\\<sigma>(v := t)) = range_vars \\<sigma> \\<union> fv t", "by (metis Un_commute subst_fv_img_alt_def)"], ["proof (state)\nthis:\n  range_vars (\\<sigma>(v := t)) = range_vars \\<sigma> \\<union> fv t\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_dom_update1: \"v \\<notin> subst_domain \\<sigma> \\<Longrightarrow> subst_domain (\\<sigma>(v := Var v)) = subst_domain \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain \\<sigma> \\<Longrightarrow>\n    subst_domain (rm_var v \\<sigma>) = subst_domain \\<sigma>", "by (auto simp add: subst_domain_def)"], ["", "lemma subst_dom_update2: \"t \\<noteq> Var v \\<Longrightarrow> subst_domain (\\<sigma>(v := t)) = insert v (subst_domain \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) = insert v (subst_domain \\<sigma>)", "by (auto simp add: subst_domain_def)"], ["", "lemma subst_dom_update3: \"t = Var v \\<Longrightarrow> subst_domain (\\<sigma>(v := t)) = subst_domain \\<sigma> - {v}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t = Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) = subst_domain \\<sigma> - {v}", "by (auto simp add: subst_domain_def)"], ["", "lemma var_not_in_subst_dom[elim]: \"v \\<notin> subst_domain s \\<Longrightarrow> s v = Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain s \\<Longrightarrow> s v = Var v", "by (simp add: subst_domain_def)"], ["", "lemma subst_dom_vars_in_subst[elim]: \"v \\<in> subst_domain s \\<Longrightarrow> s v \\<noteq> Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<in> subst_domain s \\<Longrightarrow> s v \\<noteq> Var v", "by (simp add: subst_domain_def)"], ["", "lemma subst_not_dom_fixed: \"\\<lbrakk>v \\<in> fv t; v \\<notin> subst_domain s\\<rbrakk> \\<Longrightarrow> v \\<in> fv (t \\<cdot> s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>v \\<in> fv t; v \\<notin> subst_domain s\\<rbrakk>\n    \\<Longrightarrow> v \\<in> fv (t \\<cdot> s)", "by (induct t) auto"], ["", "lemma subst_not_img_fixed: \"\\<lbrakk>v \\<in> fv (t \\<cdot> s); v \\<notin> range_vars s\\<rbrakk> \\<Longrightarrow> v \\<in> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>v \\<in> fv (t \\<cdot> s); v \\<notin> range_vars s\\<rbrakk>\n    \\<Longrightarrow> v \\<in> fv t", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>v \\<in> fv (t \\<cdot> s);\n     v \\<notin> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)\\<rbrakk>\n    \\<Longrightarrow> v \\<in> fv t", "by (induct t) force+"], ["", "lemma ground_range_vars[intro]: \"ground (subst_range s) \\<Longrightarrow> range_vars s = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range s) \\<Longrightarrow> range_vars s = {}", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range s) \\<Longrightarrow> ground (subst_range s)", "by metis"], ["", "lemma ground_subst_no_var[intro]: \"ground (subst_range s) \\<Longrightarrow> x \\<notin> range_vars s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range s) \\<Longrightarrow> x \\<notin> range_vars s", "using ground_range_vars[of s]"], ["proof (prove)\nusing this:\n  ground (subst_range s) \\<Longrightarrow> range_vars s = {}\n\ngoal (1 subgoal):\n 1. ground (subst_range s) \\<Longrightarrow> x \\<notin> range_vars s", "by blast"], ["", "lemma ground_img_obtain_fun:\n  assumes \"ground (subst_range s)\" \"x \\<in> subst_domain s\"\n  obtains f T where \"s x = Fun f T\" \"Fun f T \\<in> subst_range s\" \"fv (Fun f T) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>f T.\n        \\<lbrakk>s x = Fun f T; Fun f T \\<in> subst_range s;\n         fv (Fun f T) = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<And>f T.\n        \\<lbrakk>s x = Fun f T; Fun f T \\<in> subst_range s;\n         fv (Fun f T) = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "from assms(2)"], ["proof (chain)\npicking this:\n  x \\<in> subst_domain s", "obtain t where t: \"s x = t\" \"t \\<in> subst_range s\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain s\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>s x = t; t \\<in> subst_range s\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  s x = t\n  t \\<in> subst_range s\n\ngoal (1 subgoal):\n 1. (\\<And>f T.\n        \\<lbrakk>s x = Fun f T; Fun f T \\<in> subst_range s;\n         fv (Fun f T) = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "hence \"fv t = {}\""], ["proof (prove)\nusing this:\n  s x = t\n  t \\<in> subst_range s\n\ngoal (1 subgoal):\n 1. fv t = {}", "using assms(1)"], ["proof (prove)\nusing this:\n  s x = t\n  t \\<in> subst_range s\n  ground (subst_range s)\n\ngoal (1 subgoal):\n 1. fv t = {}", "by auto"], ["proof (state)\nthis:\n  fv t = {}\n\ngoal (1 subgoal):\n 1. (\\<And>f T.\n        \\<lbrakk>s x = Fun f T; Fun f T \\<in> subst_range s;\n         fv (Fun f T) = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv t = {}\n\ngoal (1 subgoal):\n 1. thesis", "using t that"], ["proof (prove)\nusing this:\n  fv t = {}\n  s x = t\n  t \\<in> subst_range s\n  \\<lbrakk>s x = Fun ?f ?T; Fun ?f ?T \\<in> subst_range s;\n   fv (Fun ?f ?T) = {}\\<rbrakk>\n  \\<Longrightarrow> thesis\n\ngoal (1 subgoal):\n 1. thesis", "by (cases t) simp_all"], ["proof (state)\nthis:\n  thesis\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma ground_term_subst_domain_fv_subset:\n  \"fv (t \\<cdot> \\<delta>) = {} \\<Longrightarrow> fv t \\<subseteq> subst_domain \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<delta>) = {} \\<Longrightarrow>\n    fv t \\<subseteq> subst_domain \\<delta>", "by (induct t) auto"], ["", "lemma ground_subst_range_empty_fv:\n  \"ground (subst_range \\<theta>) \\<Longrightarrow> x \\<in> subst_domain \\<theta> \\<Longrightarrow> fv (\\<theta> x) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>ground (subst_range \\<theta>);\n     x \\<in> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> fv (\\<theta> x) = {}", "by simp"], ["", "lemma subst_Var_notin_img: \"x \\<notin> range_vars s \\<Longrightarrow> t \\<cdot> s = Var x \\<Longrightarrow> t = Var x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>x \\<notin> range_vars s; t \\<cdot> s = Var x\\<rbrakk>\n    \\<Longrightarrow> t = Var x", "using subst_not_img_fixed[of x t s]"], ["proof (prove)\nusing this:\n  \\<lbrakk>x \\<in> fv (t \\<cdot> s); x \\<notin> range_vars s\\<rbrakk>\n  \\<Longrightarrow> x \\<in> fv t\n\ngoal (1 subgoal):\n 1. \\<lbrakk>x \\<notin> range_vars s; t \\<cdot> s = Var x\\<rbrakk>\n    \\<Longrightarrow> t = Var x", "by (induct t) auto"], ["", "lemma fv_in_subst_img: \"\\<lbrakk>s v = t; t \\<noteq> Var v\\<rbrakk> \\<Longrightarrow> fv t \\<subseteq> range_vars s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>s v = t; t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> fv t \\<subseteq> range_vars s", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>s v = t; t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> fv t\n                      \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)", "by auto"], ["", "lemma empty_dom_iff_empty_subst: \"subst_domain \\<theta> = {} \\<longleftrightarrow> \\<theta> = Var\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (subst_domain \\<theta> = {}) = (\\<theta> = Var)", "by auto"], ["", "lemma subst_dom_cong: \"(\\<And>v t. \\<theta> v = t \\<Longrightarrow> \\<delta> v = t) \\<Longrightarrow> subst_domain \\<theta> \\<subseteq> subst_domain \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v t.\n        \\<theta> v = t \\<Longrightarrow> \\<delta> v = t) \\<Longrightarrow>\n    subst_domain \\<theta> \\<subseteq> subst_domain \\<delta>", "by (auto simp add: subst_domain_def)"], ["", "lemma subst_img_cong: \"(\\<And>v t. \\<theta> v = t \\<Longrightarrow> \\<delta> v = t) \\<Longrightarrow> range_vars \\<theta> \\<subseteq> range_vars \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v t.\n        \\<theta> v = t \\<Longrightarrow> \\<delta> v = t) \\<Longrightarrow>\n    range_vars \\<theta> \\<subseteq> range_vars \\<delta>", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v t.\n        \\<theta> v = t \\<Longrightarrow> \\<delta> v = t) \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)", "by (auto simp add: subst_domain_def)"], ["", "lemma subst_dom_elim: \"subst_domain s \\<inter> range_vars s = {} \\<Longrightarrow> fv (t \\<cdot> s) \\<inter> subst_domain s = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain s \\<inter> range_vars s = {} \\<Longrightarrow>\n    fv (t \\<cdot> s) \\<inter> subst_domain s = {}", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       subst_domain s \\<inter> range_vars s = {} \\<Longrightarrow>\n       fv (Var x \\<cdot> s) \\<inter> subst_domain s = {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> s) \\<inter>\n                                     subst_domain s =\n                                     {};\n        subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> s) \\<inter> subst_domain s =\n                         {}", "case (Var v)"], ["proof (state)\nthis:\n  subst_domain s \\<inter> range_vars s = {}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       subst_domain s \\<inter> range_vars s = {} \\<Longrightarrow>\n       fv (Var x \\<cdot> s) \\<inter> subst_domain s = {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> s) \\<inter>\n                                     subst_domain s =\n                                     {};\n        subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> s) \\<inter> subst_domain s =\n                         {}", "thus ?case"], ["proof (prove)\nusing this:\n  subst_domain s \\<inter> range_vars s = {}\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) \\<inter> subst_domain s = {}", "using fv_in_subst_img[of s]"], ["proof (prove)\nusing this:\n  subst_domain s \\<inter> range_vars s = {}\n  \\<lbrakk>s ?v = ?t; ?t \\<noteq> Var ?v\\<rbrakk>\n  \\<Longrightarrow> fv ?t \\<subseteq> range_vars s\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) \\<inter> subst_domain s = {}", "by (cases \"s v = Var v\") (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) \\<inter> subst_domain s = {}\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> s) \\<inter>\n                                     subst_domain s =\n                                     {};\n        subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> s) \\<inter> subst_domain s =\n                         {}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> s) \\<inter>\n                                     subst_domain s =\n                                     {};\n        subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> s) \\<inter> subst_domain s =\n                         {}", "case Fun"], ["proof (state)\nthis:\n  \\<lbrakk>?x2a \\<in> set x2_;\n   subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n  \\<Longrightarrow> fv (?x2a \\<cdot> s) \\<inter> subst_domain s = {}\n  subst_domain s \\<inter> range_vars s = {}\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> s) \\<inter>\n                                     subst_domain s =\n                                     {};\n        subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> s) \\<inter> subst_domain s =\n                         {}", "thus ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x2a \\<in> set x2_;\n   subst_domain s \\<inter> range_vars s = {}\\<rbrakk>\n  \\<Longrightarrow> fv (?x2a \\<cdot> s) \\<inter> subst_domain s = {}\n  subst_domain s \\<inter> range_vars s = {}\n\ngoal (1 subgoal):\n 1. fv (Fun x1a_ x2_ \\<cdot> s) \\<inter> subst_domain s = {}", "by auto"], ["proof (state)\nthis:\n  fv (Fun x1a_ x2_ \\<cdot> s) \\<inter> subst_domain s = {}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_dom_insert_finite: \"finite (subst_domain s) = finite (subst_domain (s(v := t)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain s) = finite (subst_domain (s(v := t)))", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. finite (subst_domain s) \\<Longrightarrow>\n    finite (subst_domain (s(v := t)))\n 2. finite (subst_domain (s(v := t))) \\<Longrightarrow>\n    finite (subst_domain s)", "assume \"finite (subst_domain s)\""], ["proof (state)\nthis:\n  finite (subst_domain s)\n\ngoal (2 subgoals):\n 1. finite (subst_domain s) \\<Longrightarrow>\n    finite (subst_domain (s(v := t)))\n 2. finite (subst_domain (s(v := t))) \\<Longrightarrow>\n    finite (subst_domain s)", "have \"subst_domain (s(v := t)) \\<subseteq> insert v (subst_domain s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (s(v := t)) \\<subseteq> insert v (subst_domain s)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (s(v := t)) \\<subseteq> insert v (subst_domain s)\n\ngoal (2 subgoals):\n 1. finite (subst_domain s) \\<Longrightarrow>\n    finite (subst_domain (s(v := t)))\n 2. finite (subst_domain (s(v := t))) \\<Longrightarrow>\n    finite (subst_domain s)", "thus \"finite (subst_domain (s(v := t)))\""], ["proof (prove)\nusing this:\n  subst_domain (s(v := t)) \\<subseteq> insert v (subst_domain s)\n\ngoal (1 subgoal):\n 1. finite (subst_domain (s(v := t)))", "by (meson \\<open>finite (subst_domain s)\\<close> finite_insert rev_finite_subset)"], ["proof (state)\nthis:\n  finite (subst_domain (s(v := t)))\n\ngoal (1 subgoal):\n 1. finite (subst_domain (s(v := t))) \\<Longrightarrow>\n    finite (subst_domain s)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. finite (subst_domain (s(v := t))) \\<Longrightarrow>\n    finite (subst_domain s)", "assume *: \"finite (subst_domain (s(v := t)))\""], ["proof (state)\nthis:\n  finite (subst_domain (s(v := t)))\n\ngoal (1 subgoal):\n 1. finite (subst_domain (s(v := t))) \\<Longrightarrow>\n    finite (subst_domain s)", "hence \"finite (insert v (subst_domain s))\""], ["proof (prove)\nusing this:\n  finite (subst_domain (s(v := t)))\n\ngoal (1 subgoal):\n 1. finite (insert v (subst_domain s))", "proof (cases \"t = Var v\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>finite (subst_domain (s(v := t))); t = Var v\\<rbrakk>\n    \\<Longrightarrow> finite (insert v (subst_domain s))\n 2. \\<lbrakk>finite (subst_domain (s(v := t))); t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> finite (insert v (subst_domain s))", "case True"], ["proof (state)\nthis:\n  t = Var v\n\ngoal (2 subgoals):\n 1. \\<lbrakk>finite (subst_domain (s(v := t))); t = Var v\\<rbrakk>\n    \\<Longrightarrow> finite (insert v (subst_domain s))\n 2. \\<lbrakk>finite (subst_domain (s(v := t))); t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> finite (insert v (subst_domain s))", "hence \"finite (subst_domain s - {v})\""], ["proof (prove)\nusing this:\n  t = Var v\n\ngoal (1 subgoal):\n 1. finite (subst_domain s - {v})", "by (metis * subst_dom_update3)"], ["proof (state)\nthis:\n  finite (subst_domain s - {v})\n\ngoal (2 subgoals):\n 1. \\<lbrakk>finite (subst_domain (s(v := t))); t = Var v\\<rbrakk>\n    \\<Longrightarrow> finite (insert v (subst_domain s))\n 2. \\<lbrakk>finite (subst_domain (s(v := t))); t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> finite (insert v (subst_domain s))", "thus ?thesis"], ["proof (prove)\nusing this:\n  finite (subst_domain s - {v})\n\ngoal (1 subgoal):\n 1. finite (insert v (subst_domain s))", "by simp"], ["proof (state)\nthis:\n  finite (insert v (subst_domain s))\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite (subst_domain (s(v := t))); t \\<noteq> Var v\\<rbrakk>\n    \\<Longrightarrow> finite (insert v (subst_domain s))", "qed (metis * subst_dom_update2[of t v s])"], ["proof (state)\nthis:\n  finite (insert v (subst_domain s))\n\ngoal (1 subgoal):\n 1. finite (subst_domain (s(v := t))) \\<Longrightarrow>\n    finite (subst_domain s)", "thus \"finite (subst_domain s)\""], ["proof (prove)\nusing this:\n  finite (insert v (subst_domain s))\n\ngoal (1 subgoal):\n 1. finite (subst_domain s)", "by simp"], ["proof (state)\nthis:\n  finite (subst_domain s)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma trm_subst_disj: \"t \\<cdot> \\<theta> = t \\<Longrightarrow> fv t \\<inter> subst_domain \\<theta> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> = t \\<Longrightarrow>\n    fv t \\<inter> subst_domain \\<theta> = {}", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       Var x \\<cdot> \\<theta> = Var x \\<Longrightarrow>\n       fv (Var x) \\<inter> subst_domain \\<theta> = {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    x2a \\<cdot> \\<theta> = x2a\\<rbrakk>\n                   \\<Longrightarrow> fv x2a \\<inter> subst_domain \\<theta> =\n                                     {};\n        Fun x1a x2 \\<cdot> \\<theta> = Fun x1a x2\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2) \\<inter> subst_domain \\<theta> = {}", "case (Fun f X)"], ["proof (state)\nthis:\n  \\<lbrakk>?x2a \\<in> set X; ?x2a \\<cdot> \\<theta> = ?x2a\\<rbrakk>\n  \\<Longrightarrow> fv ?x2a \\<inter> subst_domain \\<theta> = {}\n  Fun f X \\<cdot> \\<theta> = Fun f X\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       Var x \\<cdot> \\<theta> = Var x \\<Longrightarrow>\n       fv (Var x) \\<inter> subst_domain \\<theta> = {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    x2a \\<cdot> \\<theta> = x2a\\<rbrakk>\n                   \\<Longrightarrow> fv x2a \\<inter> subst_domain \\<theta> =\n                                     {};\n        Fun x1a x2 \\<cdot> \\<theta> = Fun x1a x2\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2) \\<inter> subst_domain \\<theta> = {}", "hence \"map (\\<lambda>x. x \\<cdot> \\<theta>) X = X\""], ["proof (prove)\nusing this:\n  \\<lbrakk>?x2a \\<in> set X; ?x2a \\<cdot> \\<theta> = ?x2a\\<rbrakk>\n  \\<Longrightarrow> fv ?x2a \\<inter> subst_domain \\<theta> = {}\n  Fun f X \\<cdot> \\<theta> = Fun f X\n\ngoal (1 subgoal):\n 1. X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> = X", "by simp"], ["proof (state)\nthis:\n  X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> = X\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       Var x \\<cdot> \\<theta> = Var x \\<Longrightarrow>\n       fv (Var x) \\<inter> subst_domain \\<theta> = {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    x2a \\<cdot> \\<theta> = x2a\\<rbrakk>\n                   \\<Longrightarrow> fv x2a \\<inter> subst_domain \\<theta> =\n                                     {};\n        Fun x1a x2 \\<cdot> \\<theta> = Fun x1a x2\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2) \\<inter> subst_domain \\<theta> = {}", "hence \"\\<And>x. x \\<in> set X \\<Longrightarrow> x \\<cdot> \\<theta> = x\""], ["proof (prove)\nusing this:\n  X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> = X\n\ngoal (1 subgoal):\n 1. \\<And>x. x \\<in> set X \\<Longrightarrow> x \\<cdot> \\<theta> = x", "using map_eq_conv"], ["proof (prove)\nusing this:\n  X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> = X\n  (map ?f ?xs = map ?g ?xs) = (\\<forall>x\\<in>set ?xs. ?f x = ?g x)\n\ngoal (1 subgoal):\n 1. \\<And>x. x \\<in> set X \\<Longrightarrow> x \\<cdot> \\<theta> = x", "by fastforce"], ["proof (state)\nthis:\n  ?x \\<in> set X \\<Longrightarrow> ?x \\<cdot> \\<theta> = ?x\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       Var x \\<cdot> \\<theta> = Var x \\<Longrightarrow>\n       fv (Var x) \\<inter> subst_domain \\<theta> = {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    x2a \\<cdot> \\<theta> = x2a\\<rbrakk>\n                   \\<Longrightarrow> fv x2a \\<inter> subst_domain \\<theta> =\n                                     {};\n        Fun x1a x2 \\<cdot> \\<theta> = Fun x1a x2\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2) \\<inter> subst_domain \\<theta> = {}", "thus ?case"], ["proof (prove)\nusing this:\n  ?x \\<in> set X \\<Longrightarrow> ?x \\<cdot> \\<theta> = ?x\n\ngoal (1 subgoal):\n 1. fv (Fun f X) \\<inter> subst_domain \\<theta> = {}", "using Fun.IH"], ["proof (prove)\nusing this:\n  ?x \\<in> set X \\<Longrightarrow> ?x \\<cdot> \\<theta> = ?x\n  \\<lbrakk>?x2a \\<in> set X; ?x2a \\<cdot> \\<theta> = ?x2a\\<rbrakk>\n  \\<Longrightarrow> fv ?x2a \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. fv (Fun f X) \\<inter> subst_domain \\<theta> = {}", "by auto"], ["proof (state)\nthis:\n  fv (Fun f X) \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       Var x \\<cdot> \\<theta> = Var x \\<Longrightarrow>\n       fv (Var x) \\<inter> subst_domain \\<theta> = {}", "qed (simp add: subst_domain_def)"], ["", "lemma trm_subst_ident[intro]: \"fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> t \\<cdot> \\<theta> = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "assume \"fv t \\<inter> subst_domain \\<theta> = {}\""], ["proof (state)\nthis:\n  fv t \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "hence \"\\<forall>v \\<in> fv t. \\<forall>w \\<in> subst_domain \\<theta>. v \\<noteq> w\""], ["proof (prove)\nusing this:\n  fv t \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>fv t. \\<forall>w\\<in>subst_domain \\<theta>. v \\<noteq> w", "by auto"], ["proof (state)\nthis:\n  \\<forall>v\\<in>fv t. \\<forall>w\\<in>subst_domain \\<theta>. v \\<noteq> w\n\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<forall>v\\<in>fv t. \\<forall>w\\<in>subst_domain \\<theta>. v \\<noteq> w\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> = t", "by (metis subst_agreement subst_apply_term.simps(1) subst_apply_term_empty subst_domI)"], ["proof (state)\nthis:\n  t \\<cdot> \\<theta> = t\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma trm_subst_ident'[intro]: \"v \\<notin> subst_domain \\<theta> \\<Longrightarrow> (Var v) \\<cdot> \\<theta> = Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    Var v \\<cdot> \\<theta> = Var v", "using trm_subst_ident"], ["proof (prove)\nusing this:\n  fv ?t \\<inter> subst_domain ?\\<theta> = {} \\<Longrightarrow>\n  ?t \\<cdot> ?\\<theta> = ?t\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    Var v \\<cdot> \\<theta> = Var v", "by (simp add: subst_domain_def)"], ["", "lemma trm_subst_ident''[intro]: \"(\\<And>x. x \\<in> fv t \\<Longrightarrow> \\<theta> x = Var x) \\<Longrightarrow> t \\<cdot> \\<theta> = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>x.\n        x \\<in> fv t \\<Longrightarrow> \\<theta> x = Var x) \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<And>x.\n        x \\<in> fv t \\<Longrightarrow> \\<theta> x = Var x) \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "assume \"\\<And>x. x \\<in> fv t \\<Longrightarrow> \\<theta> x = Var x\""], ["proof (state)\nthis:\n  ?x \\<in> fv t \\<Longrightarrow> \\<theta> ?x = Var ?x\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        x \\<in> fv t \\<Longrightarrow> \\<theta> x = Var x) \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "hence \"fv t \\<inter> subst_domain \\<theta> = {}\""], ["proof (prove)\nusing this:\n  ?x \\<in> fv t \\<Longrightarrow> \\<theta> ?x = Var ?x\n\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {}", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  fv t \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        x \\<in> fv t \\<Longrightarrow> \\<theta> x = Var x) \\<Longrightarrow>\n    t \\<cdot> \\<theta> = t", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv t \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> = t", "using trm_subst_ident"], ["proof (prove)\nusing this:\n  fv t \\<inter> subst_domain \\<theta> = {}\n  fv ?t \\<inter> subst_domain ?\\<theta> = {} \\<Longrightarrow>\n  ?t \\<cdot> ?\\<theta> = ?t\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> = t", "by auto"], ["proof (state)\nthis:\n  t \\<cdot> \\<theta> = t\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma set_subst_ident: \"fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> =\n    {} \\<Longrightarrow>\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> =\n    {} \\<Longrightarrow>\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "assume \"fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> = {}\""], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> =\n    {} \\<Longrightarrow>\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "hence \"\\<forall>t \\<in> M. t \\<cdot> \\<theta> = t\""], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>M. t \\<cdot> \\<theta> = t", "by auto"], ["proof (state)\nthis:\n  \\<forall>t\\<in>M. t \\<cdot> \\<theta> = t\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<inter> subst_domain \\<theta> =\n    {} \\<Longrightarrow>\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>M. t \\<cdot> \\<theta> = t\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "by force"], ["proof (state)\nthis:\n  M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma trm_subst_ident_subterms[intro]:\n  \"fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = subterms t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow>\n    subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = subterms t", "using set_subst_ident[of \"subterms t\" \\<theta>] fv_subterms[of t]"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t) \\<inter> subst_domain \\<theta> =\n  {} \\<Longrightarrow>\n  subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = subterms t\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t) = fv t\n\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow>\n    subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = subterms t", "by simp"], ["", "lemma trm_subst_ident_subterms'[intro]:\n  \"v \\<notin> fv t \\<Longrightarrow> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var(v := s) = subterms t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> fv t \\<Longrightarrow>\n    subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var(v := s) = subterms t", "using trm_subst_ident_subterms[of t \"Var(v := s)\"]"], ["proof (prove)\nusing this:\n  fv t \\<inter> subst_domain (Var(v := s)) = {} \\<Longrightarrow>\n  subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var(v := s) = subterms t\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t \\<Longrightarrow>\n    subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t Var(v := s) = subterms t", "by (meson subst_no_occs trm_subst_disj vars_iff_subtermeq)"], ["", "lemma const_mem_subst_cases:\n  assumes \"Fun c [] \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"\n  shows \"Fun c [] \\<in> M \\<or> Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun c [] \\<in> M \\<or>\n    Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Fun c [] \\<in> M \\<or>\n    Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M", "obtain m where m: \"m \\<in> M\" \"m \\<cdot> \\<theta> = Fun c []\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>m.\n        \\<lbrakk>m \\<in> M; m \\<cdot> \\<theta> = Fun c []\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using assms"], ["proof (prove)\nusing this:\n  Fun c [] \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>m.\n        \\<lbrakk>m \\<in> M; m \\<cdot> \\<theta> = Fun c []\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  m \\<in> M\n  m \\<cdot> \\<theta> = Fun c []\n\ngoal (1 subgoal):\n 1. Fun c [] \\<in> M \\<or>\n    Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M", "thus ?thesis"], ["proof (prove)\nusing this:\n  m \\<in> M\n  m \\<cdot> \\<theta> = Fun c []\n\ngoal (1 subgoal):\n 1. Fun c [] \\<in> M \\<or>\n    Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M", "by (cases m) force+"], ["proof (state)\nthis:\n  Fun c [] \\<in> M \\<or>\n  Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma const_mem_subst_cases':\n  assumes \"Fun c [] \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"\n  shows \"Fun c [] \\<in> M \\<or> Fun c [] \\<in> subst_range \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun c [] \\<in> M \\<or> Fun c [] \\<in> subst_range \\<theta>", "using const_mem_subst_cases[OF assms]"], ["proof (prove)\nusing this:\n  Fun c [] \\<in> M \\<or>\n  Fun c [] \\<in> \\<theta> ` fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. Fun c [] \\<in> M \\<or> Fun c [] \\<in> subst_range \\<theta>", "by force"], ["", "lemma fv_subterms_substI[intro]: \"y \\<in> fv t \\<Longrightarrow> \\<theta> y \\<in> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. y \\<in> fv t \\<Longrightarrow>\n    \\<theta> y \\<in> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "using image_iff vars_iff_subtermeq"], ["proof (prove)\nusing this:\n  (?z \\<in> ?f ` ?A) = (\\<exists>x\\<in>?A. ?z = ?f x)\n  (?x \\<in> fv ?t) = (Var ?x \\<sqsubseteq> ?t)\n\ngoal (1 subgoal):\n 1. y \\<in> fv t \\<Longrightarrow>\n    \\<theta> y \\<in> subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "by fastforce"], ["", "lemma fv_subterms_subst_eq[simp]: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms (t \\<cdot> \\<theta>)) = fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms (t \\<cdot> \\<theta>)) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "using fv_subterms"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms ?t) = fv ?t\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms (t \\<cdot> \\<theta>)) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "by (induct t) force+"], ["", "lemma fv_subterms_set_subst: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n      \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n       (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))", "using fv_subterms_subst_eq[of _ \\<theta>]"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms (?t \\<cdot> \\<theta>)) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (subterms ?t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n      \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n       (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))", "by auto"], ["", "lemma fv_subterms_set_subst': \"fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n      \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "using fv_subterms_set[of \"M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\"] fv_subterms_set_subst[of \\<theta> M]"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta>) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n      \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "by simp"], ["", "lemma fv_subst_subset: \"x \\<in> fv t \\<Longrightarrow> fv (\\<theta> x) \\<subseteq> fv (t \\<cdot> \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> fv t \\<Longrightarrow>\n    fv (\\<theta> x) \\<subseteq> fv (t \\<cdot> \\<theta>)", "by (metis fv_subset image_eqI subst_apply_fv_unfold)"], ["", "lemma fv_subst_subset': \"fv s \\<subseteq> fv t \\<Longrightarrow> fv (s \\<cdot> \\<theta>) \\<subseteq> fv (t \\<cdot> \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv s \\<subseteq> fv t \\<Longrightarrow>\n    fv (s \\<cdot> \\<theta>) \\<subseteq> fv (t \\<cdot> \\<theta>)", "using fv_subst_subset"], ["proof (prove)\nusing this:\n  ?x \\<in> fv ?t \\<Longrightarrow>\n  fv (?\\<theta> ?x) \\<subseteq> fv (?t \\<cdot> ?\\<theta>)\n\ngoal (1 subgoal):\n 1. fv s \\<subseteq> fv t \\<Longrightarrow>\n    fv (s \\<cdot> \\<theta>) \\<subseteq> fv (t \\<cdot> \\<theta>)", "by (induct s) force+"], ["", "lemma fv_subst_obtain_var:\n  fixes \\<delta>::\"('a,'b) subst\"\n  assumes \"x \\<in> fv (t \\<cdot> \\<delta>)\"\n  shows \"\\<exists>y \\<in> fv t. x \\<in> fv (\\<delta> y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv t. x \\<in> fv (\\<delta> y)", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> fv (t \\<cdot> \\<delta>)\n\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv t. x \\<in> fv (\\<delta> y)", "by (induct t) force+"], ["", "lemma set_subst_all_ident: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<inter> subst_domain \\<delta> = {} \\<Longrightarrow> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> \\<circ>\\<^sub>s \\<delta>) = M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<inter>\n    subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<circ>\\<^sub>s \\<delta> =\n    M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "by (metis set_subst_ident subst_comp_all)"], ["", "lemma subterms_subst:\n  \"subterms (t \\<cdot> d) = (subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d) \\<union> subterms\\<^sub>s\\<^sub>e\\<^sub>t (d ` (fv t \\<inter> subst_domain d))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms (t \\<cdot> d) =\n    (subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d) \\<union>\n    subterms\\<^sub>s\\<^sub>e\\<^sub>t (d ` (fv t \\<inter> subst_domain d))", "by (induct t) (auto simp add: subst_domain_def)"], ["", "lemma subterms_subst':\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"\\<forall>x \\<in> fv t. (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\"\n  shows \"subterms (t \\<cdot> \\<theta>) = subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms (t \\<cdot> \\<theta>) =\n    subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "using assms"], ["proof (prove)\nusing this:\n  \\<forall>x\\<in>fv t.\n     (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n     (\\<exists>y. \\<theta> x = Var y)\n\ngoal (1 subgoal):\n 1. subterms (t \\<cdot> \\<theta>) =\n    subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<forall>x\\<in>fv (Var x).\n          (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n          (\\<exists>y. \\<theta> x = Var y) \\<Longrightarrow>\n       subterms (Var x \\<cdot> \\<theta>) =\n       subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    \\<forall>x\\<in>fv x2a.\n                       (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                       (\\<exists>y. \\<theta> x = Var y)\\<rbrakk>\n                   \\<Longrightarrow> subterms (x2a \\<cdot> \\<theta>) =\n                                     subterms\nx2a \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     \\<theta>;\n        \\<forall>x\\<in>fv (Fun x1a x2).\n           (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n           (\\<exists>y. \\<theta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> subterms (Fun x1a x2 \\<cdot> \\<theta>) =\n                         subterms\n                          (Fun x1a x2) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                         \\<theta>", "case (Var x)"], ["proof (state)\nthis:\n  \\<forall>x\\<in>fv (Var x).\n     (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n     (\\<exists>y. \\<theta> x = Var y)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<forall>x\\<in>fv (Var x).\n          (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n          (\\<exists>y. \\<theta> x = Var y) \\<Longrightarrow>\n       subterms (Var x \\<cdot> \\<theta>) =\n       subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    \\<forall>x\\<in>fv x2a.\n                       (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                       (\\<exists>y. \\<theta> x = Var y)\\<rbrakk>\n                   \\<Longrightarrow> subterms (x2a \\<cdot> \\<theta>) =\n                                     subterms\nx2a \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     \\<theta>;\n        \\<forall>x\\<in>fv (Fun x1a x2).\n           (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n           (\\<exists>y. \\<theta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> subterms (Fun x1a x2 \\<cdot> \\<theta>) =\n                         subterms\n                          (Fun x1a x2) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                         \\<theta>", "thus ?case"], ["proof (prove)\nusing this:\n  \\<forall>x\\<in>fv (Var x).\n     (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n     (\\<exists>y. \\<theta> x = Var y)\n\ngoal (1 subgoal):\n 1. subterms (Var x \\<cdot> \\<theta>) =\n    subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "proof (cases \"x \\<in> subst_domain \\<theta>\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<in> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>\n 2. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<notin> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>", "case True"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<in> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>\n 2. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<notin> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>", "hence \"(\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n    (\\<exists>y. \\<theta> x = Var y)", "using Var"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  \\<forall>x\\<in>fv (Var x).\n     (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n     (\\<exists>y. \\<theta> x = Var y)\n\ngoal (1 subgoal):\n 1. (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n    (\\<exists>y. \\<theta> x = Var y)", "by simp"], ["proof (state)\nthis:\n  (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<in> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>\n 2. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<notin> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>", "hence \"subterms (\\<theta> x) = {\\<theta> x}\""], ["proof (prove)\nusing this:\n  (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\n\ngoal (1 subgoal):\n 1. subterms (\\<theta> x) = {\\<theta> x}", "by auto"], ["proof (state)\nthis:\n  subterms (\\<theta> x) = {\\<theta> x}\n\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<in> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>\n 2. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<notin> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>", "thus ?thesis"], ["proof (prove)\nusing this:\n  subterms (\\<theta> x) = {\\<theta> x}\n\ngoal (1 subgoal):\n 1. subterms (Var x \\<cdot> \\<theta>) =\n    subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "by simp"], ["proof (state)\nthis:\n  subterms (Var x \\<cdot> \\<theta>) =\n  subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<forall>x\\<in>fv (Var x).\n                (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                (\\<exists>y. \\<theta> x = Var y);\n     x \\<notin> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> subterms (Var x \\<cdot> \\<theta>) =\n                      subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                      \\<theta>", "qed auto"], ["proof (state)\nthis:\n  subterms (Var x \\<cdot> \\<theta>) =\n  subterms (Var x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    \\<forall>x\\<in>fv x2a.\n                       (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n                       (\\<exists>y. \\<theta> x = Var y)\\<rbrakk>\n                   \\<Longrightarrow> subterms (x2a \\<cdot> \\<theta>) =\n                                     subterms\nx2a \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     \\<theta>;\n        \\<forall>x\\<in>fv (Fun x1a x2).\n           (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n           (\\<exists>y. \\<theta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> subterms (Fun x1a x2 \\<cdot> \\<theta>) =\n                         subterms\n                          (Fun x1a x2) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                         \\<theta>", "qed auto"], ["", "lemma subterms_subst'':\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"\\<forall>x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M. (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\"\n  shows \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) = subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) =\n    subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta>", "using subterms_subst'[of _ \\<theta>] assms"], ["proof (prove)\nusing this:\n  \\<forall>x\\<in>fv ?t.\n     (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n     (\\<exists>y. \\<theta> x = Var y) \\<Longrightarrow>\n  subterms (?t \\<cdot> \\<theta>) =\n  subterms ?t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n  \\<forall>x\\<in>fv\\<^sub>s\\<^sub>e\\<^sub>t M.\n     (\\<exists>f. \\<theta> x = Fun f []) \\<or>\n     (\\<exists>y. \\<theta> x = Var y)\n\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) =\n    subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta>", "by auto"], ["", "lemma subterms_subst_subterm:\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"\\<forall>x \\<in> fv a. (\\<exists>f. \\<theta> x = Fun f []) \\<or> (\\<exists>y. \\<theta> x = Var y)\"\n    and \"b \\<in> subterms (a \\<cdot> \\<theta>)\"\n  shows \"\\<exists>c \\<in> subterms a. c \\<cdot> \\<theta> = b\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>c\\<in>subterms a. c \\<cdot> \\<theta> = b", "using subterms_subst'[OF assms(1)] assms(2)"], ["proof (prove)\nusing this:\n  subterms (a \\<cdot> \\<theta>) =\n  subterms a \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n  b \\<sqsubseteq> a \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<exists>c\\<in>subterms a. c \\<cdot> \\<theta> = b", "by auto"], ["", "lemma subterms_subst_subset: \"subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma> \\<subseteq> subterms (t \\<cdot> \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma>\n    \\<subseteq> subterms (t \\<cdot> \\<sigma>)", "by (induct t) auto"], ["", "lemma subterms_subst_subset': \"subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma> \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<sigma>\n    \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma>)", "using subterms_subst_subset"], ["proof (prove)\nusing this:\n  subterms ?t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t ?\\<sigma>\n  \\<subseteq> subterms (?t \\<cdot> ?\\<sigma>)\n\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<sigma>\n    \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<sigma>)", "by fast"], ["", "lemma subterms\\<^sub>s\\<^sub>e\\<^sub>t_subst:\n  fixes \\<theta>::\"('a,'b) subst\"\n  assumes \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\"\n  shows \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<or> (\\<exists>x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M. t \\<in> subterms (\\<theta> x))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<theta> \\<or>\n    (\\<exists>x\\<in>fv\\<^sub>s\\<^sub>e\\<^sub>t M.\n        t \\<sqsubseteq> \\<theta> x)", "using assms subterms_subst[of _ \\<theta>]"], ["proof (prove)\nusing this:\n  t \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n  subterms (?t \\<cdot> \\<theta>) =\n  (subterms ?t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<theta> ` (fv ?t \\<inter> subst_domain \\<theta>))\n\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<theta> \\<or>\n    (\\<exists>x\\<in>fv\\<^sub>s\\<^sub>e\\<^sub>t M.\n        t \\<sqsubseteq> \\<theta> x)", "by auto"], ["", "lemma rm_vars_dom: \"subst_domain (rm_vars V s) = subst_domain s - V\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars V s) = subst_domain s - V", "by (auto simp add: subst_domain_def)"], ["", "lemma rm_vars_dom_subset: \"subst_domain (rm_vars V s) \\<subseteq> subst_domain s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars V s) \\<subseteq> subst_domain s", "by (auto simp add: subst_domain_def)"], ["", "lemma rm_vars_dom_eq':\n  \"subst_domain (rm_vars (UNIV - V) s) = subst_domain s \\<inter> V\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars (UNIV - V) s) = subst_domain s \\<inter> V", "using rm_vars_dom[of \"UNIV - V\" s]"], ["proof (prove)\nusing this:\n  subst_domain (rm_vars (UNIV - V) s) = subst_domain s - (UNIV - V)\n\ngoal (1 subgoal):\n 1. subst_domain (rm_vars (UNIV - V) s) = subst_domain s \\<inter> V", "by blast"], ["", "lemma rm_vars_img: \"subst_range (rm_vars V s) = s ` subst_domain (rm_vars V s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range (rm_vars V s) = s ` subst_domain (rm_vars V s)", "by (auto simp add: subst_domain_def)"], ["", "lemma rm_vars_img_subset: \"subst_range (rm_vars V s) \\<subseteq> subst_range s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range (rm_vars V s) \\<subseteq> subst_range s", "by (auto simp add: subst_domain_def)"], ["", "lemma rm_vars_img_fv_subset: \"range_vars (rm_vars V s) \\<subseteq> range_vars s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars (rm_vars V s) \\<subseteq> range_vars s", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (rm_vars V s))\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)", "by (auto simp add: subst_domain_def)"], ["", "lemma rm_vars_fv_obtain:\n  assumes \"x \\<in> fv (t \\<cdot> rm_vars X \\<theta>) - X\"\n  shows \"\\<exists>y \\<in> fv t - X. x \\<in> fv (rm_vars X \\<theta> y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv t - X. x \\<in> fv (rm_vars X \\<theta> y)", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> fv (t \\<cdot> rm_vars X \\<theta>) - X\n\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv t - X. x \\<in> fv (rm_vars X \\<theta> y)", "by (induct t) (fastforce, force)"], ["", "lemma rm_vars_apply: \"v \\<in> subst_domain (rm_vars V s) \\<Longrightarrow> (rm_vars V s) v = s v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<in> subst_domain (rm_vars V s) \\<Longrightarrow> rm_vars V s v = s v", "by (auto simp add: subst_domain_def)"], ["", "lemma rm_vars_apply': \"subst_domain \\<delta> \\<inter> vs = {} \\<Longrightarrow> rm_vars vs \\<delta> = \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> vs = {} \\<Longrightarrow>\n    rm_vars vs \\<delta> = \\<delta>", "by force"], ["", "lemma rm_vars_ident: \"fv t \\<inter> vs = {} \\<Longrightarrow> t \\<cdot> (rm_vars vs \\<theta>) = t \\<cdot> \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<inter> vs = {} \\<Longrightarrow>\n    t \\<cdot> rm_vars vs \\<theta> = t \\<cdot> \\<theta>", "by (induct t) auto"], ["", "lemma rm_vars_fv_subset: \"fv (t \\<cdot> rm_vars X \\<theta>) \\<subseteq> fv t \\<union> fv (t \\<cdot> \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> rm_vars X \\<theta>)\n    \\<subseteq> fv t \\<union> fv (t \\<cdot> \\<theta>)", "by (induct t) auto"], ["", "lemma rm_vars_fv_disj:\n  assumes \"fv t \\<inter> X = {}\" \"fv (t \\<cdot> \\<theta>) \\<inter> X = {}\"\n  shows \"fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "using rm_vars_ident[OF assms(1)] assms(2)"], ["proof (prove)\nusing this:\n  t \\<cdot> rm_vars X ?\\<theta> = t \\<cdot> ?\\<theta>\n  fv (t \\<cdot> \\<theta>) \\<inter> X = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "by auto"], ["", "lemma rm_vars_ground_supports:\n  assumes \"ground (subst_range \\<theta>)\"\n  shows \"rm_vars X \\<theta> supports \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> supports \\<theta>", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x. rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x. rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "have *: \"ground (subst_range (rm_vars X \\<theta>))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range (rm_vars X \\<theta>))", "using rm_vars_img_subset[of X \\<theta>] assms"], ["proof (prove)\nusing this:\n  subst_range (rm_vars X \\<theta>) \\<subseteq> subst_range \\<theta>\n  ground (subst_range \\<theta>)\n\ngoal (1 subgoal):\n 1. ground (subst_range (rm_vars X \\<theta>))", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  ground (subst_range (rm_vars X \\<theta>))\n\ngoal (1 subgoal):\n 1. \\<And>x. rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "show \"rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x \""], ["proof (prove)\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "proof (cases \"x \\<in> subst_domain (rm_vars X \\<theta>)\")"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> subst_domain (rm_vars X \\<theta>) \\<Longrightarrow>\n    rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x\n 2. x \\<notin> subst_domain (rm_vars X \\<theta>) \\<Longrightarrow>\n    rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "case True"], ["proof (state)\nthis:\n  x \\<in> subst_domain (rm_vars X \\<theta>)\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain (rm_vars X \\<theta>) \\<Longrightarrow>\n    rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x\n 2. x \\<notin> subst_domain (rm_vars X \\<theta>) \\<Longrightarrow>\n    rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "hence \"fv (rm_vars X \\<theta> x) = {}\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain (rm_vars X \\<theta>)\n\ngoal (1 subgoal):\n 1. fv (rm_vars X \\<theta> x) = {}", "using *"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain (rm_vars X \\<theta>)\n  ground (subst_range (rm_vars X \\<theta>))\n\ngoal (1 subgoal):\n 1. fv (rm_vars X \\<theta> x) = {}", "by auto"], ["proof (state)\nthis:\n  fv (rm_vars X \\<theta> x) = {}\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain (rm_vars X \\<theta>) \\<Longrightarrow>\n    rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x\n 2. x \\<notin> subst_domain (rm_vars X \\<theta>) \\<Longrightarrow>\n    rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv (rm_vars X \\<theta> x) = {}\n\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "using True"], ["proof (prove)\nusing this:\n  fv (rm_vars X \\<theta> x) = {}\n  x \\<in> subst_domain (rm_vars X \\<theta>)\n\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "by auto"], ["proof (state)\nthis:\n  rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain (rm_vars X \\<theta>) \\<Longrightarrow>\n    rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x", "qed (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  rm_vars X \\<theta> x \\<cdot> \\<theta> = \\<theta> x\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma rm_vars_split:\n  assumes \"ground (subst_range \\<theta>)\"\n  shows \"\\<theta> = rm_vars X \\<theta> \\<circ>\\<^sub>s rm_vars (subst_domain \\<theta> - X) \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "let ?s1 = \"rm_vars X \\<theta>\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "let ?s2 = \"rm_vars (subst_domain \\<theta> - X) \\<theta>\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "have doms: \"subst_domain ?s1 \\<subseteq> subst_domain \\<theta>\" \"subst_domain ?s2 \\<subseteq> subst_domain \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta> &&&\n    subst_domain (rm_vars (subst_domain \\<theta> - X) \\<theta>)\n    \\<subseteq> subst_domain \\<theta>", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  subst_domain (rm_vars (subst_domain \\<theta> - X) \\<theta>)\n  \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "{"], ["proof (state)\nthis:\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  subst_domain (rm_vars (subst_domain \\<theta> - X) \\<theta>)\n  \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "assume \"x \\<notin> subst_domain \\<theta>\""], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "hence \"\\<theta> x = Var x\" \"?s1 x = Var x\" \"?s2 x = Var x\""], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> x = Var x &&&\n    rm_vars X \\<theta> x = Var x &&&\n    rm_vars (subst_domain \\<theta> - X) \\<theta> x = Var x", "using doms"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  subst_domain (rm_vars (subst_domain \\<theta> - X) \\<theta>)\n  \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> x = Var x &&&\n    rm_vars X \\<theta> x = Var x &&&\n    rm_vars (subst_domain \\<theta> - X) \\<theta> x = Var x", "by auto"], ["proof (state)\nthis:\n  \\<theta> x = Var x\n  rm_vars X \\<theta> x = Var x\n  rm_vars (subst_domain \\<theta> - X) \\<theta> x = Var x\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "hence \"\\<theta> x = (?s1 \\<circ>\\<^sub>s ?s2) x\""], ["proof (prove)\nusing this:\n  \\<theta> x = Var x\n  rm_vars X \\<theta> x = Var x\n  rm_vars (subst_domain \\<theta> - X) \\<theta> x = Var x\n\ngoal (1 subgoal):\n 1. \\<theta> x =\n    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n     x", "by (simp add: subst_compose_def)"], ["proof (state)\nthis:\n  \\<theta> x =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   x\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "}"], ["proof (state)\nthis:\n  ?x2 \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n  \\<theta> ?x2 =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "moreover"], ["proof (state)\nthis:\n  ?x2 \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n  \\<theta> ?x2 =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "{"], ["proof (state)\nthis:\n  ?x2 \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n  \\<theta> ?x2 =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "assume \"x \\<in> subst_domain \\<theta>\" \"x \\<in> X\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>\n  x \\<in> X\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "hence \"?s1 x = Var x\" \"?s2 x = \\<theta> x\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  x \\<in> X\n\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x = Var x &&&\n    rm_vars (subst_domain \\<theta> - X) \\<theta> x = \\<theta> x", "using doms"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  x \\<in> X\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  subst_domain (rm_vars (subst_domain \\<theta> - X) \\<theta>)\n  \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x = Var x &&&\n    rm_vars (subst_domain \\<theta> - X) \\<theta> x = \\<theta> x", "by auto"], ["proof (state)\nthis:\n  rm_vars X \\<theta> x = Var x\n  rm_vars (subst_domain \\<theta> - X) \\<theta> x = \\<theta> x\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "hence \"\\<theta> x = (?s1 \\<circ>\\<^sub>s ?s2) x\""], ["proof (prove)\nusing this:\n  rm_vars X \\<theta> x = Var x\n  rm_vars (subst_domain \\<theta> - X) \\<theta> x = \\<theta> x\n\ngoal (1 subgoal):\n 1. \\<theta> x =\n    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n     x", "by (simp add: subst_compose_def)"], ["proof (state)\nthis:\n  \\<theta> x =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   x\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "}"], ["proof (state)\nthis:\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<in> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "moreover"], ["proof (state)\nthis:\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<in> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "{"], ["proof (state)\nthis:\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<in> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "assume \"x \\<in> subst_domain \\<theta>\" \"x \\<notin> X\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>\n  x \\<notin> X\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "hence \"?s1 x = \\<theta> x\" \"fv (\\<theta> x) = {}\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  x \\<notin> X\n\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x = \\<theta> x &&& fv (\\<theta> x) = {}", "using assms doms"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  x \\<notin> X\n  ground (subst_range \\<theta>)\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  subst_domain (rm_vars (subst_domain \\<theta> - X) \\<theta>)\n  \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x = \\<theta> x &&& fv (\\<theta> x) = {}", "by auto"], ["proof (state)\nthis:\n  rm_vars X \\<theta> x = \\<theta> x\n  fv (\\<theta> x) = {}\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "hence \"\\<theta> x = (?s1 \\<circ>\\<^sub>s ?s2) x\""], ["proof (prove)\nusing this:\n  rm_vars X \\<theta> x = \\<theta> x\n  fv (\\<theta> x) = {}\n\ngoal (1 subgoal):\n 1. \\<theta> x =\n    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n     x", "by (simp add: subst_compose subst_ground_ident)"], ["proof (state)\nthis:\n  \\<theta> x =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   x\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "}"], ["proof (state)\nthis:\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<notin> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  ?x2 \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n  \\<theta> ?x2 =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   ?x2\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<in> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<notin> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2", "show ?thesis"], ["proof (prove)\nusing this:\n  ?x2 \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n  \\<theta> ?x2 =\n  (rm_vars X \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - X) \\<theta>)\n   ?x2\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<in> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2\n  \\<lbrakk>?x2 \\<in> subst_domain \\<theta>; ?x2 \\<notin> X\\<rbrakk>\n  \\<Longrightarrow> \\<theta> ?x2 =\n                    (rm_vars X \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - X) \\<theta>)\n                     ?x2\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars X \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - X) \\<theta>", "by blast"], ["proof (state)\nthis:\n  \\<theta> =\n  rm_vars X \\<theta> \\<circ>\\<^sub>s\n  rm_vars (subst_domain \\<theta> - X) \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma rm_vars_fv_img_disj:\n  assumes \"fv t \\<inter> X = {}\" \"X \\<inter> range_vars \\<theta> = {}\"\n  shows \"fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "using assms"], ["proof (prove)\nusing this:\n  fv t \\<inter> X = {}\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>fv (Var x) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X =\n                         {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; fv x2a \\<inter> X = {};\n                    X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n                   \\<Longrightarrow> fv\n(x2a \\<cdot> rm_vars X \\<theta>) \\<inter>\n                                     X =\n                                     {};\n        fv (Fun x1a x2) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> rm_vars X \\<theta>) \\<inter>\n                         X =\n                         {}", "case (Var x)"], ["proof (state)\nthis:\n  fv (Var x) \\<inter> X = {}\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>fv (Var x) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X =\n                         {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; fv x2a \\<inter> X = {};\n                    X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n                   \\<Longrightarrow> fv\n(x2a \\<cdot> rm_vars X \\<theta>) \\<inter>\n                                     X =\n                                     {};\n        fv (Fun x1a x2) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> rm_vars X \\<theta>) \\<inter>\n                         X =\n                         {}", "hence *: \"(rm_vars X \\<theta>) x = \\<theta> x\""], ["proof (prove)\nusing this:\n  fv (Var x) \\<inter> X = {}\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. rm_vars X \\<theta> x = \\<theta> x", "by auto"], ["proof (state)\nthis:\n  rm_vars X \\<theta> x = \\<theta> x\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>fv (Var x) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X =\n                         {}\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; fv x2a \\<inter> X = {};\n                    X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n                   \\<Longrightarrow> fv\n(x2a \\<cdot> rm_vars X \\<theta>) \\<inter>\n                                     X =\n                                     {};\n        fv (Fun x1a x2) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> rm_vars X \\<theta>) \\<inter>\n                         X =\n                         {}", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "proof (cases \"x \\<in> subst_domain \\<theta>\")"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n 2. x \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "case True"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n 2. x \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "hence \"\\<theta> x \\<in> subst_range \\<theta>\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> x \\<in> subst_range \\<theta>", "by auto"], ["proof (state)\nthis:\n  \\<theta> x \\<in> subst_range \\<theta>\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n 2. x \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "hence \"fv (\\<theta> x) \\<inter> X = {}\""], ["proof (prove)\nusing this:\n  \\<theta> x \\<in> subst_range \\<theta>\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x) \\<inter> X = {}", "using Var.prems(2)"], ["proof (prove)\nusing this:\n  \\<theta> x \\<in> subst_range \\<theta>\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x) \\<inter> X = {}", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  \\<theta> x \\<in> subst_range \\<theta>\n  X \\<inter> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) = {}\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x) \\<inter> X = {}", "by fastforce"], ["proof (state)\nthis:\n  fv (\\<theta> x) \\<inter> X = {}\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n 2. x \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv (\\<theta> x) \\<inter> X = {}\n\ngoal (1 subgoal):\n 1. fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "using *"], ["proof (prove)\nusing this:\n  fv (\\<theta> x) \\<inter> X = {}\n  rm_vars X \\<theta> x = \\<theta> x\n\ngoal (1 subgoal):\n 1. fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "by auto"], ["proof (state)\nthis:\n  fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "case False"], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "thus ?thesis"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "using Var.prems(1)"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>\n  fv (Var x) \\<inter> X = {}\n\ngoal (1 subgoal):\n 1. fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "by auto"], ["proof (state)\nthis:\n  fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  fv (Var x \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; fv x2a \\<inter> X = {};\n                    X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n                   \\<Longrightarrow> fv\n(x2a \\<cdot> rm_vars X \\<theta>) \\<inter>\n                                     X =\n                                     {};\n        fv (Fun x1a x2) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> rm_vars X \\<theta>) \\<inter>\n                         X =\n                         {}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; fv x2a \\<inter> X = {};\n                    X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n                   \\<Longrightarrow> fv\n(x2a \\<cdot> rm_vars X \\<theta>) \\<inter>\n                                     X =\n                                     {};\n        fv (Fun x1a x2) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> rm_vars X \\<theta>) \\<inter>\n                         X =\n                         {}", "case Fun"], ["proof (state)\nthis:\n  \\<lbrakk>?x2a \\<in> set x2_; fv ?x2a \\<inter> X = {};\n   X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n  \\<Longrightarrow> fv (?x2a \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n  fv (Fun x1a_ x2_) \\<inter> X = {}\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; fv x2a \\<inter> X = {};\n                    X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n                   \\<Longrightarrow> fv\n(x2a \\<cdot> rm_vars X \\<theta>) \\<inter>\n                                     X =\n                                     {};\n        fv (Fun x1a x2) \\<inter> X = {};\n        X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> rm_vars X \\<theta>) \\<inter>\n                         X =\n                         {}", "thus ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x2a \\<in> set x2_; fv ?x2a \\<inter> X = {};\n   X \\<inter> range_vars \\<theta> = {}\\<rbrakk>\n  \\<Longrightarrow> fv (?x2a \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n  fv (Fun x1a_ x2_) \\<inter> X = {}\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. fv (Fun x1a_ x2_ \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}", "by auto"], ["proof (state)\nthis:\n  fv (Fun x1a_ x2_ \\<cdot> rm_vars X \\<theta>) \\<inter> X = {}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_apply_dom_ident: \"t \\<cdot> \\<theta> = t \\<Longrightarrow> subst_domain \\<delta> \\<subseteq> subst_domain \\<theta> \\<Longrightarrow> t \\<cdot> \\<delta> = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>t \\<cdot> \\<theta> = t;\n     subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n    \\<Longrightarrow> t \\<cdot> \\<delta> = t", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>Var x \\<cdot> \\<theta> = Var x;\n        subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> Var x \\<cdot> \\<delta> = Var x\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; x2a \\<cdot> \\<theta> = x2a;\n                    subst_domain \\<delta>\n                    \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n                   \\<Longrightarrow> x2a \\<cdot> \\<delta> = x2a;\n        Fun x1a x2 \\<cdot> \\<theta> = Fun x1a x2;\n        subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> Fun x1a x2 \\<cdot> \\<delta> = Fun x1a x2", "case (Fun f T)"], ["proof (state)\nthis:\n  \\<lbrakk>?x2a \\<in> set T; ?x2a \\<cdot> \\<theta> = ?x2a;\n   subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> ?x2a \\<cdot> \\<delta> = ?x2a\n  Fun f T \\<cdot> \\<theta> = Fun f T\n  subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>Var x \\<cdot> \\<theta> = Var x;\n        subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> Var x \\<cdot> \\<delta> = Var x\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2; x2a \\<cdot> \\<theta> = x2a;\n                    subst_domain \\<delta>\n                    \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n                   \\<Longrightarrow> x2a \\<cdot> \\<delta> = x2a;\n        Fun x1a x2 \\<cdot> \\<theta> = Fun x1a x2;\n        subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> Fun x1a x2 \\<cdot> \\<delta> = Fun x1a x2", "thus ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x2a \\<in> set T; ?x2a \\<cdot> \\<theta> = ?x2a;\n   subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> ?x2a \\<cdot> \\<delta> = ?x2a\n  Fun f T \\<cdot> \\<theta> = Fun f T\n  subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. Fun f T \\<cdot> \\<delta> = Fun f T", "by (induct T) auto"], ["proof (state)\nthis:\n  Fun f T \\<cdot> \\<delta> = Fun f T\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>Var x \\<cdot> \\<theta> = Var x;\n        subst_domain \\<delta> \\<subseteq> subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> Var x \\<cdot> \\<delta> = Var x", "qed (auto simp add: subst_domain_def)"], ["", "lemma rm_vars_subst_apply_ident:\n  assumes \"t \\<cdot> \\<theta> = t\"\n  shows \"t \\<cdot> (rm_vars vs \\<theta>) = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> rm_vars vs \\<theta> = t", "using rm_vars_dom[of vs \\<theta>] subst_apply_dom_ident[OF assms, of \"rm_vars vs \\<theta>\"]"], ["proof (prove)\nusing this:\n  subst_domain (rm_vars vs \\<theta>) = subst_domain \\<theta> - vs\n  subst_domain (rm_vars vs \\<theta>)\n  \\<subseteq> subst_domain \\<theta> \\<Longrightarrow>\n  t \\<cdot> rm_vars vs \\<theta> = t\n\ngoal (1 subgoal):\n 1. t \\<cdot> rm_vars vs \\<theta> = t", "by auto"], ["", "lemma rm_vars_subst_eq:\n  \"t \\<cdot> \\<delta> = t \\<cdot> rm_vars (subst_domain \\<delta> - subst_domain \\<delta> \\<inter> fv t) \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> \\<delta> =\n    t \\<cdot>\n    rm_vars (subst_domain \\<delta> - subst_domain \\<delta> \\<inter> fv t)\n     \\<delta>", "by (auto intro: term_subst_eq)"], ["", "lemma rm_vars_subst_eq':\n  \"t \\<cdot> \\<delta> = t \\<cdot> rm_vars (UNIV - fv t) \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> \\<delta> = t \\<cdot> rm_vars (UNIV - fv t) \\<delta>", "by (auto intro: term_subst_eq)"], ["", "lemma rm_vars_comp:\n  assumes \"range_vars \\<delta> \\<inter> vs = {}\"\n  shows \"t \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) = t \\<cdot> (rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    t \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "using assms"], ["proof (prove)\nusing this:\n  range_vars \\<delta> \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. t \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    t \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       range_vars \\<delta> \\<inter> vs = {} \\<Longrightarrow>\n       Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n       Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n                   \\<Longrightarrow> x2a \\<cdot>\n                                     rm_vars vs\n(\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                                     x2a \\<cdot>\n                                     rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                                     rm_vars vs \\<theta>;\n        range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n       \\<Longrightarrow> Fun x1a x2 \\<cdot>\n                         rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                         Fun x1a x2 \\<cdot>\n                         rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                         rm_vars vs \\<theta>", "case (Var x)"], ["proof (state)\nthis:\n  range_vars \\<delta> \\<inter> vs = {}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       range_vars \\<delta> \\<inter> vs = {} \\<Longrightarrow>\n       Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n       Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n                   \\<Longrightarrow> x2a \\<cdot>\n                                     rm_vars vs\n(\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                                     x2a \\<cdot>\n                                     rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                                     rm_vars vs \\<theta>;\n        range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n       \\<Longrightarrow> Fun x1a x2 \\<cdot>\n                         rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                         Fun x1a x2 \\<cdot>\n                         rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                         rm_vars vs \\<theta>", "thus ?case"], ["proof (prove)\nusing this:\n  range_vars \\<delta> \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "proof (cases \"x \\<in> vs\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<in> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>\n 2. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "case True"], ["proof (state)\nthis:\n  x \\<in> vs\n\ngoal (2 subgoals):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<in> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>\n 2. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "thus ?thesis"], ["proof (prove)\nusing this:\n  x \\<in> vs\n\ngoal (1 subgoal):\n 1. Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "using Var"], ["proof (prove)\nusing this:\n  x \\<in> vs\n  range_vars \\<delta> \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "by auto"], ["proof (state)\nthis:\n  Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n  Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "case False"], ["proof (state)\nthis:\n  x \\<notin> vs\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "have \"subst_domain (rm_vars vs \\<theta>) \\<inter> vs = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars vs \\<theta>) \\<inter> vs = {}", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (rm_vars vs \\<theta>) \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "moreover"], ["proof (state)\nthis:\n  subst_domain (rm_vars vs \\<theta>) \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "have \"fv (\\<delta> x) \\<inter> vs = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<delta> x) \\<inter> vs = {}", "using Var False"], ["proof (prove)\nusing this:\n  range_vars \\<delta> \\<inter> vs = {}\n  x \\<notin> vs\n\ngoal (1 subgoal):\n 1. fv (\\<delta> x) \\<inter> vs = {}", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) \\<inter> vs = {}\n  x \\<notin> vs\n\ngoal (1 subgoal):\n 1. fv (\\<delta> x) \\<inter> vs = {}", "by force"], ["proof (state)\nthis:\n  fv (\\<delta> x) \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain (rm_vars vs \\<theta>) \\<inter> vs = {}\n  fv (\\<delta> x) \\<inter> vs = {}", "have \"\\<delta> x \\<cdot> (rm_vars vs \\<theta>) = \\<delta> x \\<cdot> \\<theta>\""], ["proof (prove)\nusing this:\n  subst_domain (rm_vars vs \\<theta>) \\<inter> vs = {}\n  fv (\\<delta> x) \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> rm_vars vs \\<theta> = \\<delta> x \\<cdot> \\<theta>", "using rm_vars_ident"], ["proof (prove)\nusing this:\n  subst_domain (rm_vars vs \\<theta>) \\<inter> vs = {}\n  fv (\\<delta> x) \\<inter> vs = {}\n  fv ?t \\<inter> ?vs = {} \\<Longrightarrow>\n  ?t \\<cdot> rm_vars ?vs ?\\<theta> = ?t \\<cdot> ?\\<theta>\n\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> rm_vars vs \\<theta> = \\<delta> x \\<cdot> \\<theta>", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<delta> x \\<cdot> rm_vars vs \\<theta> = \\<delta> x \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "moreover"], ["proof (state)\nthis:\n  \\<delta> x \\<cdot> rm_vars vs \\<theta> = \\<delta> x \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "have \"(rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>)) x = (\\<delta> \\<circ>\\<^sub>s \\<theta>) x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) x =\n    (\\<delta> \\<circ>\\<^sub>s \\<theta>) x", "by (metis False)"], ["proof (state)\nthis:\n  rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) x =\n  (\\<delta> \\<circ>\\<^sub>s \\<theta>) x\n\ngoal (1 subgoal):\n 1. \\<lbrakk>range_vars \\<delta> \\<inter> vs = {}; x \\<notin> vs\\<rbrakk>\n    \\<Longrightarrow> Var x \\<cdot>\n                      rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                      Var x \\<cdot>\n                      rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                      rm_vars vs \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  \\<delta> x \\<cdot> rm_vars vs \\<theta> = \\<delta> x \\<cdot> \\<theta>\n  rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) x =\n  (\\<delta> \\<circ>\\<^sub>s \\<theta>) x", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<delta> x \\<cdot> rm_vars vs \\<theta> = \\<delta> x \\<cdot> \\<theta>\n  rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) x =\n  (\\<delta> \\<circ>\\<^sub>s \\<theta>) x\n\ngoal (1 subgoal):\n 1. Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "using subst_compose"], ["proof (prove)\nusing this:\n  \\<delta> x \\<cdot> rm_vars vs \\<theta> = \\<delta> x \\<cdot> \\<theta>\n  rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) x =\n  (\\<delta> \\<circ>\\<^sub>s \\<theta>) x\n  (?\\<sigma> \\<circ>\\<^sub>s ?\\<tau>) ?x = ?\\<sigma> ?x \\<cdot> ?\\<tau>\n\ngoal (1 subgoal):\n 1. Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "by auto"], ["proof (state)\nthis:\n  Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n  Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  Var x \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n  Var x \\<cdot> rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n                   \\<Longrightarrow> x2a \\<cdot>\n                                     rm_vars vs\n(\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                                     x2a \\<cdot>\n                                     rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                                     rm_vars vs \\<theta>;\n        range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n       \\<Longrightarrow> Fun x1a x2 \\<cdot>\n                         rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                         Fun x1a x2 \\<cdot>\n                         rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                         rm_vars vs \\<theta>", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n                   \\<Longrightarrow> x2a \\<cdot>\n                                     rm_vars vs\n(\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                                     x2a \\<cdot>\n                                     rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                                     rm_vars vs \\<theta>;\n        range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n       \\<Longrightarrow> Fun x1a x2 \\<cdot>\n                         rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                         Fun x1a x2 \\<cdot>\n                         rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                         rm_vars vs \\<theta>", "case Fun"], ["proof (state)\nthis:\n  \\<lbrakk>?x2a \\<in> set x2_; range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n  \\<Longrightarrow> ?x2a \\<cdot>\n                    rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                    ?x2a \\<cdot>\n                    rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n  range_vars \\<delta> \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n                   \\<Longrightarrow> x2a \\<cdot>\n                                     rm_vars vs\n(\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                                     x2a \\<cdot>\n                                     rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                                     rm_vars vs \\<theta>;\n        range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n       \\<Longrightarrow> Fun x1a x2 \\<cdot>\n                         rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                         Fun x1a x2 \\<cdot>\n                         rm_vars vs \\<delta> \\<circ>\\<^sub>s\n                         rm_vars vs \\<theta>", "thus ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x2a \\<in> set x2_; range_vars \\<delta> \\<inter> vs = {}\\<rbrakk>\n  \\<Longrightarrow> ?x2a \\<cdot>\n                    rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n                    ?x2a \\<cdot>\n                    rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n  range_vars \\<delta> \\<inter> vs = {}\n\ngoal (1 subgoal):\n 1. Fun x1a_ x2_ \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n    Fun x1a_ x2_ \\<cdot>\n    rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>", "by auto"], ["proof (state)\nthis:\n  Fun x1a_ x2_ \\<cdot> rm_vars vs (\\<delta> \\<circ>\\<^sub>s \\<theta>) =\n  Fun x1a_ x2_ \\<cdot>\n  rm_vars vs \\<delta> \\<circ>\\<^sub>s rm_vars vs \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma rm_vars_fv\\<^sub>s\\<^sub>e\\<^sub>t_subst:\n  assumes \"x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (rm_vars X \\<theta> ` Y)\"\n  shows \"x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` Y) \\<or> x \\<in> X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` Y) \\<or> x \\<in> X", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (rm_vars X \\<theta> ` Y)\n\ngoal (1 subgoal):\n 1. x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` Y) \\<or> x \\<in> X", "by auto"], ["", "lemma disj_dom_img_var_notin:\n  assumes \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\" \"\\<theta> v = t\" \"t \\<noteq> Var v\"\n  shows \"v \\<notin> fv t\" \"\\<forall>v \\<in> fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> fv t &&&\n    \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "proof -"], ["proof (state)\ngoal (2 subgoals):\n 1. v \\<notin> fv t\n 2. \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "have \"v \\<in> subst_domain \\<theta>\" \"fv t \\<subseteq> range_vars \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<in> subst_domain \\<theta> &&& fv t \\<subseteq> range_vars \\<theta>", "using fv_in_subst_img[of \\<theta> v t, OF assms(2)] assms(2,3)"], ["proof (prove)\nusing this:\n  t \\<noteq> Var v \\<Longrightarrow> fv t \\<subseteq> range_vars \\<theta>\n  \\<theta> v = t\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. v \\<in> subst_domain \\<theta> &&& fv t \\<subseteq> range_vars \\<theta>", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  v \\<in> subst_domain \\<theta>\n  fv t \\<subseteq> range_vars \\<theta>\n\ngoal (2 subgoals):\n 1. v \\<notin> fv t\n 2. \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "thus \"v \\<notin> fv t\""], ["proof (prove)\nusing this:\n  v \\<in> subst_domain \\<theta>\n  fv t \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t", "using assms(1)"], ["proof (prove)\nusing this:\n  v \\<in> subst_domain \\<theta>\n  fv t \\<subseteq> range_vars \\<theta>\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t", "by auto"], ["proof (state)\nthis:\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "have *: \"fv t \\<inter> subst_domain \\<theta> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {}", "using assms(1) \\<open>fv t \\<subseteq> range_vars \\<theta>\\<close>"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n  fv t \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain \\<theta> = {}", "by auto"], ["proof (state)\nthis:\n  fv t \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "hence \"t \\<cdot> \\<theta> = t\""], ["proof (prove)\nusing this:\n  fv t \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> = t", "by blast"], ["proof (state)\nthis:\n  t \\<cdot> \\<theta> = t\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "thus \"\\<forall>v \\<in> fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  t \\<cdot> \\<theta> = t\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "using *"], ["proof (prove)\nusing this:\n  t \\<cdot> \\<theta> = t\n  fv t \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  \\<forall>v\\<in>fv (t \\<cdot> \\<theta>). v \\<notin> subst_domain \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_sends_dom_to_img: \"v \\<in> subst_domain \\<theta> \\<Longrightarrow> fv (Var v \\<cdot> \\<theta>) \\<subseteq> range_vars \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var v \\<cdot> \\<theta>) \\<subseteq> range_vars \\<theta>", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    fv (Var v \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)", "by auto"], ["", "lemma subst_sends_fv_to_img: \"fv (t \\<cdot> s) \\<subseteq> fv t \\<union> range_vars s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> s) \\<subseteq> fv t \\<union> range_vars s", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       fv (Var x \\<cdot> s) \\<subseteq> fv (Var x) \\<union> range_vars s\n 2. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s)\n           \\<subseteq> fv x2a \\<union> range_vars s) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s)\n       \\<subseteq> fv (Fun x1a x2) \\<union> range_vars s", "case (Var v)"], ["proof (state)\nthis:\n  \n\ngoal (2 subgoals):\n 1. \\<And>x.\n       fv (Var x \\<cdot> s) \\<subseteq> fv (Var x) \\<union> range_vars s\n 2. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s)\n           \\<subseteq> fv x2a \\<union> range_vars s) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s)\n       \\<subseteq> fv (Fun x1a x2) \\<union> range_vars s", "thus ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "proof (cases \"Var v \\<cdot> s = Var v\")"], ["proof (state)\ngoal (2 subgoals):\n 1. Var v \\<cdot> s = Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s\n 2. Var v \\<cdot> s \\<noteq> Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "case True"], ["proof (state)\nthis:\n  Var v \\<cdot> s = Var v\n\ngoal (2 subgoals):\n 1. Var v \\<cdot> s = Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s\n 2. Var v \\<cdot> s \\<noteq> Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "thus ?thesis"], ["proof (prove)\nusing this:\n  Var v \\<cdot> s = Var v\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "by simp"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s\n\ngoal (1 subgoal):\n 1. Var v \\<cdot> s \\<noteq> Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. Var v \\<cdot> s \\<noteq> Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "case False"], ["proof (state)\nthis:\n  Var v \\<cdot> s \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. Var v \\<cdot> s \\<noteq> Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "hence \"v \\<in> subst_domain s\""], ["proof (prove)\nusing this:\n  Var v \\<cdot> s \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. v \\<in> subst_domain s", "by (meson trm_subst_ident')"], ["proof (state)\nthis:\n  v \\<in> subst_domain s\n\ngoal (1 subgoal):\n 1. Var v \\<cdot> s \\<noteq> Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "hence \"fv (Var v \\<cdot> s) \\<subseteq> range_vars s\""], ["proof (prove)\nusing this:\n  v \\<in> subst_domain s\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) \\<subseteq> range_vars s", "using subst_sends_dom_to_img"], ["proof (prove)\nusing this:\n  v \\<in> subst_domain s\n  ?v \\<in> subst_domain ?\\<theta> \\<Longrightarrow>\n  fv (Var ?v \\<cdot> ?\\<theta>) \\<subseteq> range_vars ?\\<theta>\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) \\<subseteq> range_vars s", "by simp"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) \\<subseteq> range_vars s\n\ngoal (1 subgoal):\n 1. Var v \\<cdot> s \\<noteq> Var v \\<Longrightarrow>\n    fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv (Var v \\<cdot> s) \\<subseteq> range_vars s\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s", "by auto"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> s) \\<subseteq> fv (Var v) \\<union> range_vars s\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s)\n           \\<subseteq> fv x2a \\<union> range_vars s) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s)\n       \\<subseteq> fv (Fun x1a x2) \\<union> range_vars s", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s)\n           \\<subseteq> fv x2a \\<union> range_vars s) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s)\n       \\<subseteq> fv (Fun x1a x2) \\<union> range_vars s", "case Fun"], ["proof (state)\nthis:\n  ?x2a \\<in> set x2_ \\<Longrightarrow>\n  fv (?x2a \\<cdot> s) \\<subseteq> fv ?x2a \\<union> range_vars s\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       (\\<And>x2a.\n           x2a \\<in> set x2 \\<Longrightarrow>\n           fv (x2a \\<cdot> s)\n           \\<subseteq> fv x2a \\<union> range_vars s) \\<Longrightarrow>\n       fv (Fun x1a x2 \\<cdot> s)\n       \\<subseteq> fv (Fun x1a x2) \\<union> range_vars s", "thus ?case"], ["proof (prove)\nusing this:\n  ?x2a \\<in> set x2_ \\<Longrightarrow>\n  fv (?x2a \\<cdot> s) \\<subseteq> fv ?x2a \\<union> range_vars s\n\ngoal (1 subgoal):\n 1. fv (Fun x1a_ x2_ \\<cdot> s)\n    \\<subseteq> fv (Fun x1a_ x2_) \\<union> range_vars s", "by auto"], ["proof (state)\nthis:\n  fv (Fun x1a_ x2_ \\<cdot> s)\n  \\<subseteq> fv (Fun x1a_ x2_) \\<union> range_vars s\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma ident_comp_subst_trm_if_disj:\n  assumes \"subst_domain \\<sigma> \\<inter> range_vars \\<theta> = {}\" \"v \\<in> subst_domain \\<theta>\"\n  shows \"(\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v", "from assms"], ["proof (chain)\npicking this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<theta> = {}\n  v \\<in> subst_domain \\<theta>", "have \" subst_domain \\<sigma> \\<inter> fv (\\<theta> v) = {}\""], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<theta> = {}\n  v \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> fv (\\<theta> v) = {}", "using fv_in_subst_img"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<theta> = {}\n  v \\<in> subst_domain \\<theta>\n  \\<lbrakk>?s ?v = ?t; ?t \\<noteq> Var ?v\\<rbrakk>\n  \\<Longrightarrow> fv ?t \\<subseteq> range_vars ?s\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> fv (\\<theta> v) = {}", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) =\n  {}\n  v \\<in> subst_domain \\<theta>\n  \\<lbrakk>?s ?v = ?t; ?t \\<noteq> Var ?v\\<rbrakk>\n  \\<Longrightarrow> fv ?t\n                    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range ?s)\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> fv (\\<theta> v) = {}", "by auto"], ["proof (state)\nthis:\n  subst_domain \\<sigma> \\<inter> fv (\\<theta> v) = {}\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v", "thus \"(\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v\""], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> fv (\\<theta> v) = {}\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> fv (\\<theta> v) = {}\n\ngoal (1 subgoal):\n 1. \\<theta> v \\<cdot> \\<sigma> = \\<theta> v", "by blast"], ["proof (state)\nthis:\n  (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma ident_comp_subst_trm_if_disj': \"fv (\\<theta> v) \\<inter> subst_domain \\<sigma> = {} \\<Longrightarrow> (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<theta> v) \\<inter> subst_domain \\<sigma> = {} \\<Longrightarrow>\n    (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v = \\<theta> v", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<theta> v) \\<inter> subst_domain \\<sigma> = {} \\<Longrightarrow>\n    \\<theta> v \\<cdot> \\<sigma> = \\<theta> v", "by blast"], ["", "lemma subst_idemI[intro]: \"subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {} \\<Longrightarrow> subst_idem \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> =\n    {} \\<Longrightarrow>\n    subst_idem \\<sigma>", "using ident_comp_subst_trm_if_disj[of \\<sigma> \\<sigma>]\n      var_not_in_subst_dom[of _ \\<sigma>]\n      subst_eq_if_eq_vars[of \\<sigma>]"], ["proof (prove)\nusing this:\n  \\<lbrakk>subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {};\n   ?v \\<in> subst_domain \\<sigma>\\<rbrakk>\n  \\<Longrightarrow> (\\<sigma> \\<circ>\\<^sub>s \\<sigma>) ?v = \\<sigma> ?v\n  ?v \\<notin> subst_domain \\<sigma> \\<Longrightarrow> \\<sigma> ?v = Var ?v\n  (\\<And>v.\n      Var v \\<cdot> \\<sigma> = Var v \\<cdot> ?\\<sigma>) \\<Longrightarrow>\n  \\<sigma> = ?\\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> =\n    {} \\<Longrightarrow>\n    subst_idem \\<sigma>", "by (metis subst_idem_def subst_compose_def var_comp(2))"], ["", "lemma subst_idemI'[intro]: \"ground (subst_range \\<sigma>) \\<Longrightarrow> subst_idem \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range \\<sigma>) \\<Longrightarrow> subst_idem \\<sigma>", "proof (intro subst_idemI)"], ["proof (state)\ngoal (1 subgoal):\n 1. ground (subst_range \\<sigma>) \\<Longrightarrow>\n    subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "assume \"ground (subst_range \\<sigma>)\""], ["proof (state)\nthis:\n  ground (subst_range \\<sigma>)\n\ngoal (1 subgoal):\n 1. ground (subst_range \\<sigma>) \\<Longrightarrow>\n    subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "hence \"range_vars \\<sigma> = {}\""], ["proof (prove)\nusing this:\n  ground (subst_range \\<sigma>)\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> = {}", "by (metis ground_range_vars)"], ["proof (state)\nthis:\n  range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. ground (subst_range \\<sigma>) \\<Longrightarrow>\n    subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "thus \"subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\""], ["proof (prove)\nusing this:\n  range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_idemE: \"subst_idem \\<sigma> \\<Longrightarrow> subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_idem \\<sigma> \\<Longrightarrow>\n    subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. subst_idem \\<sigma> \\<Longrightarrow>\n    subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "assume \"subst_idem \\<sigma>\""], ["proof (state)\nthis:\n  subst_idem \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_idem \\<sigma> \\<Longrightarrow>\n    subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "hence \"\\<And>v. fv (\\<sigma> v) \\<inter> subst_domain \\<sigma> = {}\""], ["proof (prove)\nusing this:\n  subst_idem \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<And>v. fv (\\<sigma> v) \\<inter> subst_domain \\<sigma> = {}", "unfolding subst_idem_def subst_compose_def"], ["proof (prove)\nusing this:\n  (\\<lambda>x. \\<sigma> x \\<cdot> \\<sigma>) = \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<And>v. fv (\\<sigma> v) \\<inter> subst_domain \\<sigma> = {}", "by (metis trm_subst_disj)"], ["proof (state)\nthis:\n  fv (\\<sigma> ?v) \\<inter> subst_domain \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. subst_idem \\<sigma> \\<Longrightarrow>\n    subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv (\\<sigma> ?v) \\<inter> subst_domain \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv (\\<sigma> ?v) \\<inter> subst_domain \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>) =\n    {}", "by auto"], ["proof (state)\nthis:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_idem_rm_vars: \"subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)", "assume \"subst_idem \\<theta>\""], ["proof (state)\nthis:\n  subst_idem \\<theta>\n\ngoal (1 subgoal):\n 1. subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)", "hence \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\""], ["proof (prove)\nusing this:\n  subst_idem \\<theta>\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}", "by (metis subst_idemE)"], ["proof (state)\nthis:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)", "moreover"], ["proof (state)\nthis:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)", "have\n      \"subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\"\n      \"range_vars (rm_vars X \\<theta>) \\<subseteq> range_vars \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta> &&&\n    range_vars (rm_vars X \\<theta>) \\<subseteq> range_vars \\<theta>", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta> &&&\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (rm_vars X \\<theta>))\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  range_vars (rm_vars X \\<theta>) \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. subst_idem \\<theta> \\<Longrightarrow> subst_idem (rm_vars X \\<theta>)", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  range_vars (rm_vars X \\<theta>) \\<subseteq> range_vars \\<theta>", "show ?thesis"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n  subst_domain (rm_vars X \\<theta>) \\<subseteq> subst_domain \\<theta>\n  range_vars (rm_vars X \\<theta>) \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. subst_idem (rm_vars X \\<theta>)", "by blast"], ["proof (state)\nthis:\n  subst_idem (rm_vars X \\<theta>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_fv_bounded_if_img_bounded: \"range_vars \\<theta> \\<subseteq> fv t \\<union> V \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> fv t \\<union> V\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars \\<theta> \\<subseteq> fv t \\<union> V \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>) \\<subseteq> fv t \\<union> V", "proof (induction t)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       range_vars \\<theta>\n       \\<subseteq> fv (Var x) \\<union> V \\<Longrightarrow>\n       fv (Var x \\<cdot> \\<theta>) \\<subseteq> fv (Var x) \\<union> V\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<theta>\n                    \\<subseteq> fv x2a \\<union> V\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> \\<theta>)\n                                     \\<subseteq> fv x2a \\<union> V;\n        range_vars \\<theta> \\<subseteq> fv (Fun x1a x2) \\<union> V\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> \\<theta>)\n                         \\<subseteq> fv (Fun x1a x2) \\<union> V", "case (Var v)"], ["proof (state)\nthis:\n  range_vars \\<theta> \\<subseteq> fv (Var v) \\<union> V\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       range_vars \\<theta>\n       \\<subseteq> fv (Var x) \\<union> V \\<Longrightarrow>\n       fv (Var x \\<cdot> \\<theta>) \\<subseteq> fv (Var x) \\<union> V\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<theta>\n                    \\<subseteq> fv x2a \\<union> V\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> \\<theta>)\n                                     \\<subseteq> fv x2a \\<union> V;\n        range_vars \\<theta> \\<subseteq> fv (Fun x1a x2) \\<union> V\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> \\<theta>)\n                         \\<subseteq> fv (Fun x1a x2) \\<union> V", "thus ?case"], ["proof (prove)\nusing this:\n  range_vars \\<theta> \\<subseteq> fv (Var v) \\<union> V\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> \\<theta>) \\<subseteq> fv (Var v) \\<union> V", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\n  \\<subseteq> fv (Var v) \\<union> V\n\ngoal (1 subgoal):\n 1. fv (Var v \\<cdot> \\<theta>) \\<subseteq> fv (Var v) \\<union> V", "by (cases \"\\<theta> v = Var v\") auto"], ["proof (state)\nthis:\n  fv (Var v \\<cdot> \\<theta>) \\<subseteq> fv (Var v) \\<union> V\n\ngoal (1 subgoal):\n 1. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    range_vars \\<theta>\n                    \\<subseteq> fv x2a \\<union> V\\<rbrakk>\n                   \\<Longrightarrow> fv (x2a \\<cdot> \\<theta>)\n                                     \\<subseteq> fv x2a \\<union> V;\n        range_vars \\<theta> \\<subseteq> fv (Fun x1a x2) \\<union> V\\<rbrakk>\n       \\<Longrightarrow> fv (Fun x1a x2 \\<cdot> \\<theta>)\n                         \\<subseteq> fv (Fun x1a x2) \\<union> V", "qed (metis (no_types, lifting) Un_assoc Un_commute subst_sends_fv_to_img sup.absorb_iff2)"], ["", "lemma subst_fv_bound_singleton: \"fv (t \\<cdot> Var(v := t')) \\<subseteq> fv t \\<union> fv t'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> Var(v := t')) \\<subseteq> fv t \\<union> fv t'", "using subst_fv_bounded_if_img_bounded[of \"Var(v := t')\" t \"fv t'\"]"], ["proof (prove)\nusing this:\n  range_vars (Var(v := t'))\n  \\<subseteq> fv t \\<union> fv t' \\<Longrightarrow>\n  fv (t \\<cdot> Var(v := t')) \\<subseteq> fv t \\<union> fv t'\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> Var(v := t')) \\<subseteq> fv t \\<union> fv t'", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (Var(v := t')))\n  \\<subseteq> fv t \\<union> fv t' \\<Longrightarrow>\n  fv (t \\<cdot> Var(v := t')) \\<subseteq> fv t \\<union> fv t'\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> Var(v := t')) \\<subseteq> fv t \\<union> fv t'", "by (auto simp add: subst_domain_def)"], ["", "lemma subst_fv_bounded_if_img_bounded':\n  assumes \"range_vars \\<theta> \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\"\n  shows \"fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>) \\<Longrightarrow>\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "fix v"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>) \\<Longrightarrow>\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "assume *:  \"v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\""], ["proof (state)\nthis:\n  v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n           (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>) \\<Longrightarrow>\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "obtain t where t: \"t \\<in> M\" \"t \\<cdot> \\<theta> \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\" \"v \\<in> fv (t \\<cdot> \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>t \\<in> M;\n         t \\<cdot> \\<theta>\n         \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>;\n         v \\<in> fv (t \\<cdot> \\<theta>)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>t \\<in> M;\n         t \\<cdot> \\<theta>\n         \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>;\n         v \\<in> fv (t \\<cdot> \\<theta>)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "assume **: \"\\<And>t. \\<lbrakk>t \\<in> M; t \\<cdot> \\<theta> \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>; v \\<in> fv (t \\<cdot> \\<theta>)\\<rbrakk> \\<Longrightarrow> thesis\""], ["proof (state)\nthis:\n  \\<lbrakk>?t \\<in> M;\n   ?t \\<cdot> \\<theta> \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>;\n   v \\<in> fv (?t \\<cdot> \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> thesis\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>t \\<in> M;\n         t \\<cdot> \\<theta>\n         \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>;\n         v \\<in> fv (t \\<cdot> \\<theta>)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "have \"v \\<in> \\<Union> (fv ` ((\\<lambda>t. t \\<cdot> \\<theta>) ` M))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<in> \\<Union> (fv ` (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))", "using *"], ["proof (prove)\nusing this:\n  v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n           (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n\ngoal (1 subgoal):\n 1. v \\<in> \\<Union> (fv ` (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))", "by (metis fv\\<^sub>s\\<^sub>e\\<^sub>t.simps)"], ["proof (state)\nthis:\n  v \\<in> \\<Union> (fv ` (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>t \\<in> M;\n         t \\<cdot> \\<theta>\n         \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>;\n         v \\<in> fv (t \\<cdot> \\<theta>)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "hence \"\\<exists>t. t \\<in> M \\<and> v \\<in> fv (t \\<cdot> \\<theta>)\""], ["proof (prove)\nusing this:\n  v \\<in> \\<Union> (fv ` (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>))\n\ngoal (1 subgoal):\n 1. \\<exists>t. t \\<in> M \\<and> v \\<in> fv (t \\<cdot> \\<theta>)", "by blast"], ["proof (state)\nthis:\n  \\<exists>t. t \\<in> M \\<and> v \\<in> fv (t \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>t \\<in> M;\n         t \\<cdot> \\<theta>\n         \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>;\n         v \\<in> fv (t \\<cdot> \\<theta>)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<exists>t. t \\<in> M \\<and> v \\<in> fv (t \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. thesis", "using ** imageI"], ["proof (prove)\nusing this:\n  \\<exists>t. t \\<in> M \\<and> v \\<in> fv (t \\<cdot> \\<theta>)\n  \\<lbrakk>?t \\<in> M;\n   ?t \\<cdot> \\<theta> \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>;\n   v \\<in> fv (?t \\<cdot> \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> thesis\n  ?x \\<in> ?A \\<Longrightarrow> ?f ?x \\<in> ?f ` ?A\n\ngoal (1 subgoal):\n 1. thesis", "by blast"], ["proof (state)\nthis:\n  thesis\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  t \\<in> M\n  t \\<cdot> \\<theta> \\<in> M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n  v \\<in> fv (t \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>) \\<Longrightarrow>\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "from \\<open>t \\<in> M\\<close>"], ["proof (chain)\npicking this:\n  t \\<in> M", "obtain M' where \"t \\<notin> M'\" \"M = insert t M'\""], ["proof (prove)\nusing this:\n  t \\<in> M\n\ngoal (1 subgoal):\n 1. (\\<And>M'.\n        \\<lbrakk>t \\<notin> M'; M = insert t M'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (meson Set.set_insert)"], ["proof (state)\nthis:\n  t \\<notin> M'\n  M = insert t M'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>) \\<Longrightarrow>\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "hence \"fv\\<^sub>s\\<^sub>e\\<^sub>t M = fv t \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t M'\""], ["proof (prove)\nusing this:\n  t \\<notin> M'\n  M = insert t M'\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t M =\n    fv t \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t M'", "by simp"], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t M = fv t \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t M'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>) \\<Longrightarrow>\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "hence \"fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\""], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t M = fv t \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t M'\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "using subst_fv_bounded_if_img_bounded assms"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t M = fv t \\<union> fv\\<^sub>s\\<^sub>e\\<^sub>t M'\n  range_vars ?\\<theta> \\<subseteq> fv ?t \\<union> ?V \\<Longrightarrow>\n  fv (?t \\<cdot> ?\\<theta>) \\<subseteq> fv ?t \\<union> ?V\n  range_vars \\<theta> \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "by simp"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>) \\<Longrightarrow>\n       x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "thus \"v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M\""], ["proof (prove)\nusing this:\n  fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "using assms \\<open>v \\<in> fv (t \\<cdot> \\<theta>)\\<close>"], ["proof (prove)\nusing this:\n  fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n  range_vars \\<theta> \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n  v \\<in> fv (t \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "by auto"], ["proof (state)\nthis:\n  v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma ground_img_if_ground_subst: \"(\\<And>v t. s v = t \\<Longrightarrow> fv t = {}) \\<Longrightarrow> range_vars s = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v t. s v = t \\<Longrightarrow> fv t = {}) \\<Longrightarrow>\n    range_vars s = {}", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v t. s v = t \\<Longrightarrow> fv t = {}) \\<Longrightarrow>\n    ground (subst_range s)", "by auto"], ["", "lemma ground_subst_fv_subset: \"ground (subst_range \\<theta>) \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>) \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>) \\<subseteq> fv t", "using subst_fv_bounded_if_img_bounded[of \\<theta>]"], ["proof (prove)\nusing this:\n  range_vars \\<theta> \\<subseteq> fv ?t \\<union> ?V \\<Longrightarrow>\n  fv (?t \\<cdot> \\<theta>) \\<subseteq> fv ?t \\<union> ?V\n\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>) \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>) \\<subseteq> fv t", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\n  \\<subseteq> fv ?t \\<union> ?V \\<Longrightarrow>\n  fv (?t \\<cdot> \\<theta>) \\<subseteq> fv ?t \\<union> ?V\n\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>) \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>) \\<subseteq> fv t", "by force"], ["", "lemma ground_subst_fv_subset': \"ground (subst_range \\<theta>) \\<Longrightarrow> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>) \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "using subst_fv_bounded_if_img_bounded'[of \\<theta> M]"], ["proof (prove)\nusing this:\n  range_vars \\<theta>\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>) \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>) \\<Longrightarrow>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "by auto"], ["", "lemma subst_to_var_is_var[elim]: \"t \\<cdot> s = Var v \\<Longrightarrow> \\<exists>w. t = Var w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> s = Var v \\<Longrightarrow> \\<exists>w. t = Var w", "using subst_apply_term.elims"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x \\<cdot> ?xa = ?y;\n   \\<And>x \\<sigma>.\n      \\<lbrakk>?x = Var x; ?xa = \\<sigma>; ?y = \\<sigma> x\\<rbrakk>\n      \\<Longrightarrow> ?P;\n   \\<And>f ss \\<sigma>.\n      \\<lbrakk>?x = Fun f ss; ?xa = \\<sigma>;\n       ?y =\n       Fun f (ss \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<sigma>)\\<rbrakk>\n      \\<Longrightarrow> ?P\\<rbrakk>\n  \\<Longrightarrow> ?P\n\ngoal (1 subgoal):\n 1. t \\<cdot> s = Var v \\<Longrightarrow> \\<exists>w. t = Var w", "by blast"], ["", "lemma subst_dom_comp_inI:\n  assumes \"y \\<notin> subst_domain \\<sigma>\"\n    and \"y \\<in> subst_domain \\<delta>\"\n  shows \"y \\<in> subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<delta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. y \\<in> subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<delta>)", "using assms subst_domain_subst_compose[of \\<sigma> \\<delta>]"], ["proof (prove)\nusing this:\n  y \\<notin> subst_domain \\<sigma>\n  y \\<in> subst_domain \\<delta>\n  subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<delta>) =\n  subst_domain \\<sigma> -\n  {x. \\<exists>y. \\<sigma> x = Var y \\<and> \\<delta> y = Var x} \\<union>\n  (subst_domain \\<delta> - subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. y \\<in> subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<delta>)", "by blast"], ["", "lemma subst_comp_notin_dom_eq:\n  \"x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    \\<theta>1 x \\<cdot> \\<theta>2 = \\<theta>2 x", "by fastforce"], ["", "lemma subst_dom_comp_eq:\n  assumes \"subst_domain \\<theta> \\<inter> range_vars \\<sigma> = {}\"\n  shows \"subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = subst_domain \\<theta> \\<union> subst_domain \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) =\n    subst_domain \\<theta> \\<union> subst_domain \\<sigma>", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n    subst_domain \\<theta> \\<union> subst_domain \\<sigma> \\<Longrightarrow>\n    False", "assume \"subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\""], ["proof (state)\nthis:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n  subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n    subst_domain \\<theta> \\<union> subst_domain \\<sigma> \\<Longrightarrow>\n    False", "hence \"subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<subset> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\""], ["proof (prove)\nusing this:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n  subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n    \\<subset> subst_domain \\<theta> \\<union> subst_domain \\<sigma>", "using subst_domain_compose[of \\<theta> \\<sigma>]"], ["proof (prove)\nusing this:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n  subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n  \\<subseteq> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n    \\<subset> subst_domain \\<theta> \\<union> subst_domain \\<sigma>", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n  \\<subset> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n    subst_domain \\<theta> \\<union> subst_domain \\<sigma> \\<Longrightarrow>\n    False", "then"], ["proof (chain)\npicking this:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n  \\<subset> subst_domain \\<theta> \\<union> subst_domain \\<sigma>", "obtain v where \"v \\<notin> subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\" \"v \\<in> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\""], ["proof (prove)\nusing this:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n  \\<subset> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        \\<lbrakk>v \\<notin> subst_domain\n                             (\\<theta> \\<circ>\\<^sub>s \\<sigma>);\n         v \\<in> subst_domain \\<theta> \\<union>\n                 subst_domain \\<sigma>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  v \\<notin> subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n  v \\<in> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n    subst_domain \\<theta> \\<union> subst_domain \\<sigma> \\<Longrightarrow>\n    False", "hence v_in_some_subst: \"\\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v\" and \"\\<theta> v \\<cdot> \\<sigma> = Var v\""], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n  v \\<in> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v &&&\n    \\<theta> v \\<cdot> \\<sigma> = Var v", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain (\\<lambda>x. \\<theta> x \\<cdot> \\<sigma>)\n  v \\<in> subst_domain \\<theta> \\<union> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v &&&\n    \\<theta> v \\<cdot> \\<sigma> = Var v", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v\n  \\<theta> v \\<cdot> \\<sigma> = Var v\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n    subst_domain \\<theta> \\<union> subst_domain \\<sigma> \\<Longrightarrow>\n    False", "then"], ["proof (chain)\npicking this:\n  \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v\n  \\<theta> v \\<cdot> \\<sigma> = Var v", "obtain w where \"\\<theta> v = Var w\""], ["proof (prove)\nusing this:\n  \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v\n  \\<theta> v \\<cdot> \\<sigma> = Var v\n\ngoal (1 subgoal):\n 1. (\\<And>w. \\<theta> v = Var w \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using subst_to_var_is_var"], ["proof (prove)\nusing this:\n  \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v\n  \\<theta> v \\<cdot> \\<sigma> = Var v\n  ?t \\<cdot> ?s = Var ?v \\<Longrightarrow> \\<exists>w. ?t = Var w\n\ngoal (1 subgoal):\n 1. (\\<And>w. \\<theta> v = Var w \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by fastforce"], ["proof (state)\nthis:\n  \\<theta> v = Var w\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) \\<noteq>\n    subst_domain \\<theta> \\<union> subst_domain \\<sigma> \\<Longrightarrow>\n    False", "show False"], ["proof (prove)\ngoal (1 subgoal):\n 1. False", "proof (cases \"v = w\")"], ["proof (state)\ngoal (2 subgoals):\n 1. v = w \\<Longrightarrow> False\n 2. v \\<noteq> w \\<Longrightarrow> False", "case True"], ["proof (state)\nthis:\n  v = w\n\ngoal (2 subgoals):\n 1. v = w \\<Longrightarrow> False\n 2. v \\<noteq> w \\<Longrightarrow> False", "hence \"\\<theta> v = Var v\""], ["proof (prove)\nusing this:\n  v = w\n\ngoal (1 subgoal):\n 1. \\<theta> v = Var v", "using \\<open>\\<theta> v = Var w\\<close>"], ["proof (prove)\nusing this:\n  v = w\n  \\<theta> v = Var w\n\ngoal (1 subgoal):\n 1. \\<theta> v = Var v", "by simp"], ["proof (state)\nthis:\n  \\<theta> v = Var v\n\ngoal (2 subgoals):\n 1. v = w \\<Longrightarrow> False\n 2. v \\<noteq> w \\<Longrightarrow> False", "hence \"\\<sigma> v \\<noteq> Var v\""], ["proof (prove)\nusing this:\n  \\<theta> v = Var v\n\ngoal (1 subgoal):\n 1. \\<sigma> v \\<noteq> Var v", "using v_in_some_subst"], ["proof (prove)\nusing this:\n  \\<theta> v = Var v\n  \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<sigma> v \\<noteq> Var v", "by simp"], ["proof (state)\nthis:\n  \\<sigma> v \\<noteq> Var v\n\ngoal (2 subgoals):\n 1. v = w \\<Longrightarrow> False\n 2. v \\<noteq> w \\<Longrightarrow> False", "thus False"], ["proof (prove)\nusing this:\n  \\<sigma> v \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. False", "using \\<open>\\<theta> v = Var v\\<close> \\<open>\\<theta> v \\<cdot> \\<sigma> = Var v\\<close>"], ["proof (prove)\nusing this:\n  \\<sigma> v \\<noteq> Var v\n  \\<theta> v = Var v\n  \\<theta> v \\<cdot> \\<sigma> = Var v\n\ngoal (1 subgoal):\n 1. False", "by simp"], ["proof (state)\nthis:\n  False\n\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "case False"], ["proof (state)\nthis:\n  v \\<noteq> w\n\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "hence \"v \\<in> subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  v \\<noteq> w\n\ngoal (1 subgoal):\n 1. v \\<in> subst_domain \\<theta>", "using v_in_some_subst \\<open>\\<theta> v \\<cdot> \\<sigma> = Var v\\<close>"], ["proof (prove)\nusing this:\n  v \\<noteq> w\n  \\<theta> v \\<noteq> Var v \\<or> \\<sigma> v \\<noteq> Var v\n  \\<theta> v \\<cdot> \\<sigma> = Var v\n\ngoal (1 subgoal):\n 1. v \\<in> subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  v \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "hence \"v \\<notin> range_vars \\<sigma>\""], ["proof (prove)\nusing this:\n  v \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<sigma>", "using assms"], ["proof (prove)\nusing this:\n  v \\<in> subst_domain \\<theta>\n  subst_domain \\<theta> \\<inter> range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<sigma>", "by auto"], ["proof (state)\nthis:\n  v \\<notin> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  v \\<notin> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "have \"\\<sigma> w = Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma> w = Var v", "using \\<open>\\<theta> v \\<cdot> \\<sigma> = Var v\\<close> \\<open>\\<theta> v = Var w\\<close>"], ["proof (prove)\nusing this:\n  \\<theta> v \\<cdot> \\<sigma> = Var v\n  \\<theta> v = Var w\n\ngoal (1 subgoal):\n 1. \\<sigma> w = Var v", "by simp"], ["proof (state)\nthis:\n  \\<sigma> w = Var v\n\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "hence \"v \\<in> range_vars \\<sigma>\""], ["proof (prove)\nusing this:\n  \\<sigma> w = Var v\n\ngoal (1 subgoal):\n 1. v \\<in> range_vars \\<sigma>", "using \\<open>v \\<noteq> w\\<close> subst_fv_imgI[of \\<sigma> w]"], ["proof (prove)\nusing this:\n  \\<sigma> w = Var v\n  v \\<noteq> w\n  \\<sigma> w \\<noteq> Var w \\<Longrightarrow>\n  fv (\\<sigma> w) \\<subseteq> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. v \\<in> range_vars \\<sigma>", "by simp"], ["proof (state)\nthis:\n  v \\<in> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. v \\<noteq> w \\<Longrightarrow> False", "ultimately"], ["proof (chain)\npicking this:\n  v \\<notin> range_vars \\<sigma>\n  v \\<in> range_vars \\<sigma>", "show False"], ["proof (prove)\nusing this:\n  v \\<notin> range_vars \\<sigma>\n  v \\<in> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. False", ".."], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_img_comp_subset[simp]:\n  \"range_vars (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<subseteq> range_vars \\<theta>1 \\<union> range_vars \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n    \\<subseteq> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "let ?img = \"range_vars\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "assume \"x \\<in> ?img (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\""], ["proof (state)\nthis:\n  x \\<in> range_vars (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "then"], ["proof (chain)\npicking this:\n  x \\<in> range_vars (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)", "obtain v t where vt: \"x \\<in> fv t\" \"t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) v\" \"t \\<noteq> Var v\""], ["proof (prove)\nusing this:\n  x \\<in> range_vars (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. (\\<And>t v.\n        \\<lbrakk>x \\<in> fv t; t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) v;\n         t \\<noteq> Var v\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding range_vars_alt_def subst_compose_def"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t\n           (subst_range (\\<lambda>x. \\<theta>1 x \\<cdot> \\<theta>2))\n\ngoal (1 subgoal):\n 1. (\\<And>t v.\n        \\<lbrakk>x \\<in> fv t; t = \\<theta>1 v \\<cdot> \\<theta>2;\n         t \\<noteq> Var v\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  x \\<in> fv t\n  t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) v\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "{"], ["proof (state)\nthis:\n  x \\<in> fv t\n  t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) v\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "assume \"x \\<notin> ?img \\<theta>1\""], ["proof (state)\nthis:\n  x \\<notin> range_vars \\<theta>1\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "hence \"x \\<in> ?img \\<theta>2\""], ["proof (prove)\nusing this:\n  x \\<notin> range_vars \\<theta>1\n\ngoal (1 subgoal):\n 1. x \\<in> range_vars \\<theta>2", "by (metis (no_types, hide_lams) fv_in_subst_img Un_iff subst_compose_def \n                vt subsetCE subst_apply_term.simps(1) subst_sends_fv_to_img)"], ["proof (state)\nthis:\n  x \\<in> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "}"], ["proof (state)\nthis:\n  x \\<notin> range_vars \\<theta>1 \\<Longrightarrow>\n  x \\<in> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> range_vars\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "thus \"x \\<in> ?img \\<theta>1 \\<union> ?img \\<theta>2\""], ["proof (prove)\nusing this:\n  x \\<notin> range_vars \\<theta>1 \\<Longrightarrow>\n  x \\<in> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2", "by auto"], ["proof (state)\nthis:\n  x \\<in> range_vars \\<theta>1 \\<union> range_vars \\<theta>2\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_img_comp_subset':\n  assumes \"t \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\"\n  shows \"t \\<in> subst_range \\<theta>2 \\<or> (\\<exists>t' \\<in> subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "obtain x where x: \"x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\" \"(\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = t\" \"t \\<noteq> Var x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2);\n         (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = t;\n         t \\<noteq> Var x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using assms"], ["proof (prove)\nusing this:\n  t \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2);\n         (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = t;\n         t \\<noteq> Var x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = t\n  t \\<noteq> Var x\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "{"], ["proof (state)\nthis:\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = t\n  t \\<noteq> Var x\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "assume \"x \\<notin> subst_domain \\<theta>1\""], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "hence \"(\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\""], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. \\<theta>1 x \\<cdot> \\<theta>2 = \\<theta>2 x", "by auto"], ["proof (state)\nthis:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "hence ?thesis"], ["proof (prove)\nusing this:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "using x"], ["proof (prove)\nusing this:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = t\n  t \\<noteq> Var x\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "by auto"], ["proof (state)\nthis:\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "}"], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "moreover"], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "{"], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "assume \"x \\<in> subst_domain \\<theta>1\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "hence ?thesis"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "using subst_compose x(2)"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n  (?\\<sigma> \\<circ>\\<^sub>s ?\\<tau>) ?x = ?\\<sigma> ?x \\<cdot> ?\\<tau>\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = t\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "by fastforce"], ["proof (state)\nthis:\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "}"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "ultimately"], ["proof (chain)\npicking this:\n  x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n  x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "show ?thesis"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n  x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>2 \\<or>\n    (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)", "by metis"], ["proof (state)\nthis:\n  t \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. t = t' \\<cdot> \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_img_comp_subset'':\n  \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) \\<subseteq>\n   subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union> ((subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1)) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2))\n    \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range \\<theta>2) \\<union>\n                (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                  (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>2)", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range \\<theta>2) \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "fix t"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range \\<theta>2) \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "assume \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2))\""], ["proof (state)\nthis:\n  t \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range \\<theta>2) \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "then"], ["proof (chain)\npicking this:\n  t \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)", "obtain x where x: \"x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\" \"t \\<in> subterms ((\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x)\""], ["proof (prove)\nusing this:\n  t \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2);\n         t \\<sqsubseteq> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  t \\<sqsubseteq> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range \\<theta>2) \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "show \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union> (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "proof (cases \"x \\<in> subst_domain \\<theta>1\")"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "case True"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "thus ?thesis"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "using subst_compose[of \\<theta>1 \\<theta>2] x(2) subterms_subst"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) ?x = \\<theta>1 ?x \\<cdot> \\<theta>2\n  t \\<sqsubseteq> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n  subterms (?t \\<cdot> ?d) =\n  (subterms ?t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t ?d) \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (?d ` (fv ?t \\<inter> subst_domain ?d))\n\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "by fastforce"], ["proof (state)\nthis:\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n            (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "case False"], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "hence \"(\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\""], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. \\<theta>1 x \\<cdot> \\<theta>2 = \\<theta>2 x", "by auto"], ["proof (state)\nthis:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "thus ?thesis"], ["proof (prove)\nusing this:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "using x"], ["proof (prove)\nusing this:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  t \\<sqsubseteq> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (subst_range \\<theta>2) \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n            (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n            (subst_range \\<theta>1) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_img_comp_subset''':\n  \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) - range Var \\<subseteq>\n   subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) - range Var \\<union> ((subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) - range Var) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n    range Var\n    \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n                range Var \\<union>\n                (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n                 range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 \\<theta>2)", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n               range Var \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n               range Var \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n                range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "fix t"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n               range Var \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n               range Var \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n                range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "assume t: \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) - range Var\""], ["proof (state)\nthis:\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n           (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n          range Var\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n               range Var \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n               range Var \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n                range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "then"], ["proof (chain)\npicking this:\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n           (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n          range Var", "obtain f T where fT: \"t = Fun f T\""], ["proof (prove)\nusing this:\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n           (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n          range Var\n\ngoal (1 subgoal):\n 1. (\\<And>f T. t = Fun f T \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (cases t) simp_all"], ["proof (state)\nthis:\n  t = Fun f T\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n               range Var \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n               range Var \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n                range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "then"], ["proof (chain)\npicking this:\n  t = Fun f T", "obtain x where x: \"x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\" \"Fun f T \\<in> subterms ((\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x)\""], ["proof (prove)\nusing this:\n  t = Fun f T\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2);\n         Fun f T \\<sqsubseteq>\n         (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using t"], ["proof (prove)\nusing this:\n  t = Fun f T\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n           (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n          range Var\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2);\n         Fun f T \\<sqsubseteq>\n         (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  Fun f T \\<sqsubseteq> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n               range Var \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n               range Var \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n                range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "have \"Fun f T \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union> (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "proof (cases \"x \\<in> subst_domain \\<theta>1\")"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "case True"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "hence \"Fun f T \\<in> (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2)) \\<union> (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)", "using x(2) subterms_subst[of \"\\<theta>1 x\" \\<theta>2]"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n  Fun f T \\<sqsubseteq> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n  subterms (\\<theta>1 x \\<cdot> \\<theta>2) =\n  (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n   \\<theta>2) \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<theta>2 ` (fv (\\<theta>1 x) \\<inter> subst_domain \\<theta>2))\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)", "unfolding subst_compose[of \\<theta>1 \\<theta>2 x]"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n  Fun f T \\<sqsubseteq> \\<theta>1 x \\<cdot> \\<theta>2\n  subterms (\\<theta>1 x \\<cdot> \\<theta>2) =\n  (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n   \\<theta>2) \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<theta>2 ` (fv (\\<theta>1 x) \\<inter> subst_domain \\<theta>2))\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)", "by auto"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "moreover"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "have ?thesis when *: \"Fun f T \\<in> subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "obtain s where s: \"s \\<in> subterms (\\<theta>1 x)\" \"Fun f T = s \\<cdot> \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>s.\n        \\<lbrakk>s \\<sqsubseteq> \\<theta>1 x;\n         Fun f T = s \\<cdot> \\<theta>2\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using *"], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2\n\ngoal (1 subgoal):\n 1. (\\<And>s.\n        \\<lbrakk>s \\<sqsubseteq> \\<theta>1 x;\n         Fun f T = s \\<cdot> \\<theta>2\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  s \\<sqsubseteq> \\<theta>1 x\n  Fun f T = s \\<cdot> \\<theta>2\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "proof (cases s)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x1.\n       s = Var x1 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)\n 2. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)", "case (Var y)"], ["proof (state)\nthis:\n  s = Var y\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       s = Var x1 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)\n 2. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)", "hence \"Fun f T \\<in> subst_range \\<theta>2\""], ["proof (prove)\nusing this:\n  s = Var y\n\ngoal (1 subgoal):\n 1. Fun f T \\<in> subst_range \\<theta>2", "using s"], ["proof (prove)\nusing this:\n  s = Var y\n  s \\<sqsubseteq> \\<theta>1 x\n  Fun f T = s \\<cdot> \\<theta>2\n\ngoal (1 subgoal):\n 1. Fun f T \\<in> subst_range \\<theta>2", "by force"], ["proof (state)\nthis:\n  Fun f T \\<in> subst_range \\<theta>2\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       s = Var x1 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)\n 2. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)", "thus ?thesis"], ["proof (prove)\nusing this:\n  Fun f T \\<in> subst_range \\<theta>2\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "by blast"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)", "case (Fun g S)"], ["proof (state)\nthis:\n  s = Fun g S\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)", "hence \"Fun f T \\<in> (subterms (\\<theta>1 x) - range Var) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2\""], ["proof (prove)\nusing this:\n  s = Fun g S\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms (\\<theta>1 x) - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<theta>2", "using s"], ["proof (prove)\nusing this:\n  s = Fun g S\n  s \\<sqsubseteq> \\<theta>1 x\n  Fun f T = s \\<cdot> \\<theta>2\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms (\\<theta>1 x) - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<theta>2", "by blast"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms (\\<theta>1 x) - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       Fun f T\n       \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n              (subst_range \\<theta>2) \\<union>\n             (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n              range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              \\<theta>2)", "thus ?thesis"], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms (\\<theta>1 x) - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>2\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "using True"], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms (\\<theta>1 x) - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>2\n  x \\<in> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "by auto"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>2 \\<Longrightarrow>\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "ultimately"], ["proof (chain)\npicking this:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\n  Fun f T\n  \\<in> subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>2 \\<Longrightarrow>\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)", "show ?thesis"], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\n  Fun f T\n  \\<in> subterms (\\<theta>1 x) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>2 \\<Longrightarrow>\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "by blast"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "case False"], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "hence \"(\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\""], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. \\<theta>1 x \\<cdot> \\<theta>2 = \\<theta>2 x", "by auto"], ["proof (state)\nthis:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "thus ?thesis"], ["proof (prove)\nusing this:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "using x"], ["proof (prove)\nusing this:\n  (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x = \\<theta>2 x\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  Fun f T \\<sqsubseteq> (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)) -\n               range Var \\<Longrightarrow>\n       x \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n               range Var \\<union>\n               (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n                range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                \\<theta>2)", "thus \"t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) - range Var \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>2)\""], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n            range Var \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n             range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "using fT"], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) \\<union>\n        (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n         range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n         \\<theta>2)\n  t = Fun f T\n\ngoal (1 subgoal):\n 1. t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n            range Var \\<union>\n            (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n             range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n             \\<theta>2)", "by auto"], ["proof (state)\nthis:\n  t \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) -\n          range Var \\<union>\n          (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>1) -\n           range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n           \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_img_comp_subset_const:\n  assumes \"Fun c [] \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\"\n  shows \"Fun c [] \\<in> subst_range \\<theta>2 \\<or> Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n         (\\<exists>x. Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])", "proof (cases \"Fun c [] \\<in> subst_range \\<theta>2\")"], ["proof (state)\ngoal (2 subgoals):\n 1. Fun c [] \\<in> subst_range \\<theta>2 \\<Longrightarrow>\n    Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])\n 2. Fun c [] \\<notin> subst_range \\<theta>2 \\<Longrightarrow>\n    Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])", "case False"], ["proof (state)\nthis:\n  Fun c [] \\<notin> subst_range \\<theta>2\n\ngoal (2 subgoals):\n 1. Fun c [] \\<in> subst_range \\<theta>2 \\<Longrightarrow>\n    Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])\n 2. Fun c [] \\<notin> subst_range \\<theta>2 \\<Longrightarrow>\n    Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])", "then"], ["proof (chain)\npicking this:\n  Fun c [] \\<notin> subst_range \\<theta>2", "obtain t where t: \"t \\<in> subst_range \\<theta>1\" \"Fun c [] = t \\<cdot> \\<theta>2\""], ["proof (prove)\nusing this:\n  Fun c [] \\<notin> subst_range \\<theta>2\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>t \\<in> subst_range \\<theta>1;\n         Fun c [] = t \\<cdot> \\<theta>2\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using subst_img_comp_subset'[OF assms]"], ["proof (prove)\nusing this:\n  Fun c [] \\<notin> subst_range \\<theta>2\n  Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n  (\\<exists>t'\\<in>subst_range \\<theta>1. Fun c [] = t' \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>t \\<in> subst_range \\<theta>1;\n         Fun c [] = t \\<cdot> \\<theta>2\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  t \\<in> subst_range \\<theta>1\n  Fun c [] = t \\<cdot> \\<theta>2\n\ngoal (2 subgoals):\n 1. Fun c [] \\<in> subst_range \\<theta>2 \\<Longrightarrow>\n    Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])\n 2. Fun c [] \\<notin> subst_range \\<theta>2 \\<Longrightarrow>\n    Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])", "thus ?thesis"], ["proof (prove)\nusing this:\n  t \\<in> subst_range \\<theta>1\n  Fun c [] = t \\<cdot> \\<theta>2\n\ngoal (1 subgoal):\n 1. Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])", "by (cases t) auto"], ["proof (state)\nthis:\n  Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n  Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n  (\\<exists>x.\n      Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])\n\ngoal (1 subgoal):\n 1. Fun c [] \\<in> subst_range \\<theta>2 \\<Longrightarrow>\n    Fun c [] \\<in> subst_range \\<theta>2 \\<or>\n    Fun c [] \\<in> subst_range \\<theta>1 \\<or>\n    (\\<exists>x.\n        Var x \\<in> subst_range \\<theta>1 \\<and> \\<theta>2 x = Fun c [])", "qed (simp add: subst_img_comp_subset'[OF assms])"], ["", "lemma subst_img_comp_subset_const':\n  fixes \\<delta> \\<tau>::\"('f,'v) subst\"\n  assumes \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\"\n  shows \"\\<delta> x = Fun c [] \\<or> (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])", "proof (cases \"\\<delta> x = Fun c []\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<delta> x = Fun c [] \\<Longrightarrow>\n    \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n 2. \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow>\n    \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])", "case False"], ["proof (state)\nthis:\n  \\<delta> x \\<noteq> Fun c []\n\ngoal (2 subgoals):\n 1. \\<delta> x = Fun c [] \\<Longrightarrow>\n    \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n 2. \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow>\n    \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])", "then"], ["proof (chain)\npicking this:\n  \\<delta> x \\<noteq> Fun c []", "obtain t where \"\\<delta> x = t\" \"t \\<cdot> \\<tau> = Fun c []\""], ["proof (prove)\nusing this:\n  \\<delta> x \\<noteq> Fun c []\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>\\<delta> x = t; t \\<cdot> \\<tau> = Fun c []\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using assms"], ["proof (prove)\nusing this:\n  \\<delta> x \\<noteq> Fun c []\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>\\<delta> x = t; t \\<cdot> \\<tau> = Fun c []\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  \\<delta> x \\<noteq> Fun c []\n  \\<delta> x \\<cdot> \\<tau> = Fun c []\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>\\<delta> x = t; t \\<cdot> \\<tau> = Fun c []\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  \\<delta> x = t\n  t \\<cdot> \\<tau> = Fun c []\n\ngoal (2 subgoals):\n 1. \\<delta> x = Fun c [] \\<Longrightarrow>\n    \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n 2. \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow>\n    \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<delta> x = t\n  t \\<cdot> \\<tau> = Fun c []\n\ngoal (1 subgoal):\n 1. \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])", "by (cases t) auto"], ["proof (state)\nthis:\n  \\<delta> x = Fun c [] \\<or>\n  (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n\ngoal (1 subgoal):\n 1. \\<delta> x = Fun c [] \\<Longrightarrow>\n    \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])", "qed simp"], ["", "lemma subst_img_comp_subset_ground:\n  assumes \"ground (subst_range \\<theta>1)\"\n  shows \"subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<subseteq> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n    \\<subseteq> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_range\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "fix t"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_range\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "assume t: \"t \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\""], ["proof (state)\nthis:\n  t \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_range\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "then"], ["proof (chain)\npicking this:\n  t \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)", "obtain x where x: \"x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\" \"t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\""], ["proof (prove)\nusing this:\n  t \\<in> subst_range (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2);\n         t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_range\n                (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) \\<Longrightarrow>\n       x \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "show \"t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "proof (cases \"x \\<in> subst_domain \\<theta>1\")"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "case True"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "hence \"fv (\\<theta>1 x) = {}\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. fv (\\<theta>1 x) = {}", "using assms ground_subst_range_empty_fv"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>1\n  ground (subst_range \\<theta>1)\n  \\<lbrakk>ground (subst_range ?\\<theta>);\n   ?x \\<in> subst_domain ?\\<theta>\\<rbrakk>\n  \\<Longrightarrow> fv (?\\<theta> ?x) = {}\n\ngoal (1 subgoal):\n 1. fv (\\<theta>1 x) = {}", "by fast"], ["proof (state)\nthis:\n  fv (\\<theta>1 x) = {}\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "hence \"t = \\<theta>1 x\""], ["proof (prove)\nusing this:\n  fv (\\<theta>1 x) = {}\n\ngoal (1 subgoal):\n 1. t = \\<theta>1 x", "using x(2)"], ["proof (prove)\nusing this:\n  fv (\\<theta>1 x) = {}\n  t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n\ngoal (1 subgoal):\n 1. t = \\<theta>1 x", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  fv (\\<theta>1 x) = {}\n  t = \\<theta>1 x \\<cdot> \\<theta>2\n\ngoal (1 subgoal):\n 1. t = \\<theta>1 x", "by blast"], ["proof (state)\nthis:\n  t = \\<theta>1 x\n\ngoal (2 subgoals):\n 1. x \\<in> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\n 2. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "thus ?thesis"], ["proof (prove)\nusing this:\n  t = \\<theta>1 x\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "using True"], ["proof (prove)\nusing this:\n  t = \\<theta>1 x\n  x \\<in> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "by simp"], ["proof (state)\nthis:\n  t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "case False"], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "hence \"t = \\<theta>2 x\" \"x \\<in> subst_domain \\<theta>2\""], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n\ngoal (1 subgoal):\n 1. t = \\<theta>2 x &&& x \\<in> subst_domain \\<theta>2", "using x subst_domain_compose[of \\<theta>1 \\<theta>2]"], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<theta>1\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n  subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  \\<subseteq> subst_domain \\<theta>1 \\<union> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. t = \\<theta>2 x &&& x \\<in> subst_domain \\<theta>2", "by (metis subst_comp_notin_dom_eq, blast)"], ["proof (state)\nthis:\n  t = \\<theta>2 x\n  x \\<in> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. x \\<notin> subst_domain \\<theta>1 \\<Longrightarrow>\n    t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "thus ?thesis"], ["proof (prove)\nusing this:\n  t = \\<theta>2 x\n  x \\<in> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "using x"], ["proof (prove)\nusing this:\n  t = \\<theta>2 x\n  x \\<in> subst_domain \\<theta>2\n  x \\<in> subst_domain (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\n  t = (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2) x\n\ngoal (1 subgoal):\n 1. t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2", "by simp"], ["proof (state)\nthis:\n  t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  t \\<in> subst_range \\<theta>1 \\<union> subst_range \\<theta>2\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_fv_dom_img_single:\n  assumes \"v \\<notin> fv t\" \"\\<sigma> v = t\" \"\\<And>w. v \\<noteq> w \\<Longrightarrow> \\<sigma> w = Var w\"\n  shows \"subst_domain \\<sigma> = {v}\" \"range_vars \\<sigma> = fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> = {v} &&& range_vars \\<sigma> = fv t", "proof -"], ["proof (state)\ngoal (2 subgoals):\n 1. subst_domain \\<sigma> = {v}\n 2. range_vars \\<sigma> = fv t", "show \"subst_domain \\<sigma> = {v}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> = {v}", "using assms"], ["proof (prove)\nusing this:\n  v \\<notin> fv t\n  \\<sigma> v = t\n  v \\<noteq> ?w \\<Longrightarrow> \\<sigma> ?w = Var ?w\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> = {v}", "by (fastforce simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain \\<sigma> = {v}\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> = fv t", "have \"fv t \\<subseteq> range_vars \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<subseteq> range_vars \\<sigma>", "by (metis fv_in_subst_img assms(1,2) vars_iff_subterm_or_eq)"], ["proof (state)\nthis:\n  fv t \\<subseteq> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> = fv t", "moreover"], ["proof (state)\nthis:\n  fv t \\<subseteq> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> = fv t", "have \"\\<And>v. \\<sigma> v \\<noteq> Var v \\<Longrightarrow> \\<sigma> v = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>v. \\<sigma> v \\<noteq> Var v \\<Longrightarrow> \\<sigma> v = t", "using assms"], ["proof (prove)\nusing this:\n  v \\<notin> fv t\n  \\<sigma> v = t\n  v \\<noteq> ?w \\<Longrightarrow> \\<sigma> ?w = Var ?w\n\ngoal (1 subgoal):\n 1. \\<And>v. \\<sigma> v \\<noteq> Var v \\<Longrightarrow> \\<sigma> v = t", "by fastforce"], ["proof (state)\nthis:\n  \\<sigma> ?v \\<noteq> Var ?v \\<Longrightarrow> \\<sigma> ?v = t\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> = fv t", "ultimately"], ["proof (chain)\npicking this:\n  fv t \\<subseteq> range_vars \\<sigma>\n  \\<sigma> ?v \\<noteq> Var ?v \\<Longrightarrow> \\<sigma> ?v = t", "show \"range_vars \\<sigma> = fv t\""], ["proof (prove)\nusing this:\n  fv t \\<subseteq> range_vars \\<sigma>\n  \\<sigma> ?v \\<noteq> Var ?v \\<Longrightarrow> \\<sigma> ?v = t\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> = fv t", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>)\n  \\<sigma> ?v \\<noteq> Var ?v \\<Longrightarrow> \\<sigma> ?v = t\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>) = fv t", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  range_vars \\<sigma> = fv t\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_comp_upd1:\n  \"\\<theta>(v := t) \\<circ>\\<^sub>s \\<sigma> = (\\<theta> \\<circ>\\<^sub>s \\<sigma>)(v := t \\<cdot> \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta>(v := t) \\<circ>\\<^sub>s \\<sigma> =\n    (\\<theta> \\<circ>\\<^sub>s \\<sigma>)(v := t \\<cdot> \\<sigma>)", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. (\\<theta>(v := t)) x \\<cdot> \\<sigma>) =\n    (\\<lambda>x. \\<theta> x \\<cdot> \\<sigma>)(v := t \\<cdot> \\<sigma>)", "by auto"], ["", "lemma subst_comp_upd2:\n  assumes \"v \\<notin> subst_domain s\" \"v \\<notin> range_vars s\"\n  shows \"s(v := t) = s \\<circ>\\<^sub>s (Var(v := t))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s(v := t) = s \\<circ>\\<^sub>s Var(v := t)", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. s(v := t) = (\\<lambda>x. s x \\<cdot> Var(v := t))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. s(v := t) = (\\<lambda>x. s x \\<cdot> Var(v := t))", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. s(v := t) = (\\<lambda>x. s x \\<cdot> Var(v := t))", "fix w"], ["proof (state)\ngoal (1 subgoal):\n 1. s(v := t) = (\\<lambda>x. s x \\<cdot> Var(v := t))", "have \"(s(v := t)) w = s w \\<cdot> Var(v := t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (s(v := t)) w = s w \\<cdot> Var(v := t)", "proof (cases \"w = v\")"], ["proof (state)\ngoal (2 subgoals):\n 1. w = v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)\n 2. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "case True"], ["proof (state)\nthis:\n  w = v\n\ngoal (2 subgoals):\n 1. w = v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)\n 2. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "hence \"s w = Var w\""], ["proof (prove)\nusing this:\n  w = v\n\ngoal (1 subgoal):\n 1. s w = Var w", "using \\<open>v \\<notin> subst_domain s\\<close>"], ["proof (prove)\nusing this:\n  w = v\n  v \\<notin> subst_domain s\n\ngoal (1 subgoal):\n 1. s w = Var w", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  s w = Var w\n\ngoal (2 subgoals):\n 1. w = v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)\n 2. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "thus ?thesis"], ["proof (prove)\nusing this:\n  s w = Var w\n\ngoal (1 subgoal):\n 1. (s(v := t)) w = s w \\<cdot> Var(v := t)", "using \\<open>w = v\\<close>"], ["proof (prove)\nusing this:\n  s w = Var w\n  w = v\n\ngoal (1 subgoal):\n 1. (s(v := t)) w = s w \\<cdot> Var(v := t)", "by simp"], ["proof (state)\nthis:\n  (s(v := t)) w = s w \\<cdot> Var(v := t)\n\ngoal (1 subgoal):\n 1. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "case False"], ["proof (state)\nthis:\n  w \\<noteq> v\n\ngoal (1 subgoal):\n 1. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "hence \"(s(v := t)) w = s w\""], ["proof (prove)\nusing this:\n  w \\<noteq> v\n\ngoal (1 subgoal):\n 1. (s(v := t)) w = s w", "by simp"], ["proof (state)\nthis:\n  (s(v := t)) w = s w\n\ngoal (1 subgoal):\n 1. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "moreover"], ["proof (state)\nthis:\n  (s(v := t)) w = s w\n\ngoal (1 subgoal):\n 1. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "have \"s w \\<cdot> Var(v := t) = s w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s w \\<cdot> Var(v := t) = s w", "using \\<open>w \\<noteq> v\\<close> \\<open>v \\<notin> range_vars s\\<close>"], ["proof (prove)\nusing this:\n  w \\<noteq> v\n  v \\<notin> range_vars s\n\ngoal (1 subgoal):\n 1. s w \\<cdot> Var(v := t) = s w", "by (metis fv_in_subst_img fun_upd_apply insert_absorb insert_subset\n                  repl_invariance subst_apply_term.simps(1) subst_apply_term_empty)"], ["proof (state)\nthis:\n  s w \\<cdot> Var(v := t) = s w\n\ngoal (1 subgoal):\n 1. w \\<noteq> v \\<Longrightarrow> (s(v := t)) w = s w \\<cdot> Var(v := t)", "ultimately"], ["proof (chain)\npicking this:\n  (s(v := t)) w = s w\n  s w \\<cdot> Var(v := t) = s w", "show ?thesis"], ["proof (prove)\nusing this:\n  (s(v := t)) w = s w\n  s w \\<cdot> Var(v := t) = s w\n\ngoal (1 subgoal):\n 1. (s(v := t)) w = s w \\<cdot> Var(v := t)", ".."], ["proof (state)\nthis:\n  (s(v := t)) w = s w \\<cdot> Var(v := t)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (s(v := t)) w = s w \\<cdot> Var(v := t)\n\ngoal (1 subgoal):\n 1. s(v := t) = (\\<lambda>x. s x \\<cdot> Var(v := t))", "}"], ["proof (state)\nthis:\n  (s(v := t)) ?w2 = s ?w2 \\<cdot> Var(v := t)\n\ngoal (1 subgoal):\n 1. s(v := t) = (\\<lambda>x. s x \\<cdot> Var(v := t))", "thus \"s(v := t) = (\\<lambda>w. s w \\<cdot> Var(v := t))\""], ["proof (prove)\nusing this:\n  (s(v := t)) ?w2 = s ?w2 \\<cdot> Var(v := t)\n\ngoal (1 subgoal):\n 1. s(v := t) = (\\<lambda>w. s w \\<cdot> Var(v := t))", "by auto"], ["proof (state)\nthis:\n  s(v := t) = (\\<lambda>w. s w \\<cdot> Var(v := t))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma ground_subst_dom_iff_img:\n  \"ground (subst_range \\<sigma>) \\<Longrightarrow> x \\<in> subst_domain \\<sigma> \\<longleftrightarrow> \\<sigma> x \\<in> subst_range \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range \\<sigma>) \\<Longrightarrow>\n    (x \\<in> subst_domain \\<sigma>) =\n    (\\<sigma> x \\<in> subst_range \\<sigma>)", "by (auto simp add: subst_domain_def)"], ["", "lemma finite_dom_subst_exists:\n  \"finite S \\<Longrightarrow> \\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite S \\<Longrightarrow> \\<exists>\\<sigma>. subst_domain \\<sigma> = S", "proof (induction S rule: finite.induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<exists>\\<sigma>. subst_domain \\<sigma> = {}\n 2. \\<And>A a.\n       \\<lbrakk>finite A;\n        \\<exists>\\<sigma>. subst_domain \\<sigma> = A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>\\<sigma>.\n                            subst_domain \\<sigma> = insert a A", "case (insertI A a)"], ["proof (state)\nthis:\n  finite A\n  \\<exists>\\<sigma>. subst_domain \\<sigma> = A\n\ngoal (2 subgoals):\n 1. \\<exists>\\<sigma>. subst_domain \\<sigma> = {}\n 2. \\<And>A a.\n       \\<lbrakk>finite A;\n        \\<exists>\\<sigma>. subst_domain \\<sigma> = A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>\\<sigma>.\n                            subst_domain \\<sigma> = insert a A", "then"], ["proof (chain)\npicking this:\n  finite A\n  \\<exists>\\<sigma>. subst_domain \\<sigma> = A", "obtain \\<sigma>::\"('f,'v) subst\" where \"subst_domain \\<sigma> = A\""], ["proof (prove)\nusing this:\n  finite A\n  \\<exists>\\<sigma>. subst_domain \\<sigma> = A\n\ngoal (1 subgoal):\n 1. (\\<And>\\<sigma>.\n        subst_domain \\<sigma> = A \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<sigma> = A\n\ngoal (2 subgoals):\n 1. \\<exists>\\<sigma>. subst_domain \\<sigma> = {}\n 2. \\<And>A a.\n       \\<lbrakk>finite A;\n        \\<exists>\\<sigma>. subst_domain \\<sigma> = A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>\\<sigma>.\n                            subst_domain \\<sigma> = insert a A", "fix f::'f"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<exists>\\<sigma>. subst_domain \\<sigma> = {}\n 2. \\<And>A a.\n       \\<lbrakk>finite A;\n        \\<exists>\\<sigma>. subst_domain \\<sigma> = A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>\\<sigma>.\n                            subst_domain \\<sigma> = insert a A", "have \"subst_domain (\\<sigma>(a := Fun f [])) = insert a A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(a := Fun f [])) = insert a A", "using \\<open>subst_domain \\<sigma> = A\\<close>"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> = A\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(a := Fun f [])) = insert a A", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>(a := Fun f [])) = insert a A\n\ngoal (2 subgoals):\n 1. \\<exists>\\<sigma>. subst_domain \\<sigma> = {}\n 2. \\<And>A a.\n       \\<lbrakk>finite A;\n        \\<exists>\\<sigma>. subst_domain \\<sigma> = A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>\\<sigma>.\n                            subst_domain \\<sigma> = insert a A", "thus ?case"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>(a := Fun f [])) = insert a A\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>. subst_domain \\<sigma> = insert a A", "by metis"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>. subst_domain \\<sigma> = insert a A\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>. subst_domain \\<sigma> = {}", "qed (auto simp add: subst_domain_def)"], ["", "lemma subst_inj_is_bij_betw_dom_img_if_ground_img:\n  assumes \"ground (subst_range \\<sigma>)\"\n  shows \"inj \\<sigma> \\<longleftrightarrow> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\" (is \"?A \\<longleftrightarrow> ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. inj \\<sigma> =\n    bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. inj \\<sigma> \\<Longrightarrow>\n    bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n 2. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "show \"?A \\<Longrightarrow> ?B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inj \\<sigma> \\<Longrightarrow>\n    bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)", "by (metis bij_betw_def injD inj_onI subst_range.simps)"], ["proof (state)\nthis:\n  inj \\<sigma> \\<Longrightarrow>\n  bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "assume ?B"], ["proof (state)\nthis:\n  bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "hence \"inj_on \\<sigma> (subst_domain \\<sigma>)\""], ["proof (prove)\nusing this:\n  bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n\ngoal (1 subgoal):\n 1. inj_on \\<sigma> (subst_domain \\<sigma>)", "unfolding bij_betw_def"], ["proof (prove)\nusing this:\n  inj_on \\<sigma> (subst_domain \\<sigma>) \\<and>\n  \\<sigma> ` subst_domain \\<sigma> = subst_range \\<sigma>\n\ngoal (1 subgoal):\n 1. inj_on \\<sigma> (subst_domain \\<sigma>)", "by auto"], ["proof (state)\nthis:\n  inj_on \\<sigma> (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "moreover"], ["proof (state)\nthis:\n  inj_on \\<sigma> (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "have \"\\<And>x. x \\<in> UNIV - subst_domain \\<sigma> \\<Longrightarrow> \\<sigma> x = Var x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> UNIV - subst_domain \\<sigma> \\<Longrightarrow>\n       \\<sigma> x = Var x", "by auto"], ["proof (state)\nthis:\n  ?x \\<in> UNIV - subst_domain \\<sigma> \\<Longrightarrow>\n  \\<sigma> ?x = Var ?x\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "hence \"inj_on \\<sigma> (UNIV - subst_domain \\<sigma>)\""], ["proof (prove)\nusing this:\n  ?x \\<in> UNIV - subst_domain \\<sigma> \\<Longrightarrow>\n  \\<sigma> ?x = Var ?x\n\ngoal (1 subgoal):\n 1. inj_on \\<sigma> (UNIV - subst_domain \\<sigma>)", "using inj_onI[of \"UNIV - subst_domain \\<sigma>\"]"], ["proof (prove)\nusing this:\n  ?x \\<in> UNIV - subst_domain \\<sigma> \\<Longrightarrow>\n  \\<sigma> ?x = Var ?x\n  (\\<And>x y.\n      \\<lbrakk>x \\<in> UNIV - subst_domain \\<sigma>;\n       y \\<in> UNIV - subst_domain \\<sigma>; ?f x = ?f y\\<rbrakk>\n      \\<Longrightarrow> x = y) \\<Longrightarrow>\n  inj_on ?f (UNIV - subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. inj_on \\<sigma> (UNIV - subst_domain \\<sigma>)", "by (metis term.inject(1))"], ["proof (state)\nthis:\n  inj_on \\<sigma> (UNIV - subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "moreover"], ["proof (state)\nthis:\n  inj_on \\<sigma> (UNIV - subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "have \"\\<And>x y. x \\<in> subst_domain \\<sigma> \\<Longrightarrow> y \\<notin> subst_domain \\<sigma> \\<Longrightarrow> \\<sigma> x \\<noteq> \\<sigma> y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<sigma>;\n        y \\<notin> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> \\<sigma> x \\<noteq> \\<sigma> y", "using assms"], ["proof (prove)\nusing this:\n  ground (subst_range \\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<sigma>;\n        y \\<notin> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> \\<sigma> x \\<noteq> \\<sigma> y", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<lbrakk>?x \\<in> subst_domain \\<sigma>;\n   ?y \\<notin> subst_domain \\<sigma>\\<rbrakk>\n  \\<Longrightarrow> \\<sigma> ?x \\<noteq> \\<sigma> ?y\n\ngoal (1 subgoal):\n 1. bij_betw \\<sigma> (subst_domain \\<sigma>)\n     (subst_range \\<sigma>) \\<Longrightarrow>\n    inj \\<sigma>", "ultimately"], ["proof (chain)\npicking this:\n  inj_on \\<sigma> (subst_domain \\<sigma>)\n  inj_on \\<sigma> (UNIV - subst_domain \\<sigma>)\n  \\<lbrakk>?x \\<in> subst_domain \\<sigma>;\n   ?y \\<notin> subst_domain \\<sigma>\\<rbrakk>\n  \\<Longrightarrow> \\<sigma> ?x \\<noteq> \\<sigma> ?y", "show ?A"], ["proof (prove)\nusing this:\n  inj_on \\<sigma> (subst_domain \\<sigma>)\n  inj_on \\<sigma> (UNIV - subst_domain \\<sigma>)\n  \\<lbrakk>?x \\<in> subst_domain \\<sigma>;\n   ?y \\<notin> subst_domain \\<sigma>\\<rbrakk>\n  \\<Longrightarrow> \\<sigma> ?x \\<noteq> \\<sigma> ?y\n\ngoal (1 subgoal):\n 1. inj \\<sigma>", "by (metis injI inj_onD subst_domI term.inject(1))"], ["proof (state)\nthis:\n  inj \\<sigma>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bij_finite_ground_subst_exists:\n  assumes \"finite (S::'v set)\" \"infinite (U::('f,'v) term set)\" \"ground U\"\n  shows \"\\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\n                          \\<and> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n                          \\<and> subst_range \\<sigma> \\<subseteq> U\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "obtain T' where \"T' \\<subseteq> U\" \"card T' = card S\" \"finite T'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>T'.\n        \\<lbrakk>T' \\<subseteq> U; card T' = card S; finite T'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (meson assms(2) finite_Diff2 infinite_arbitrarily_large)"], ["proof (state)\nthis:\n  T' \\<subseteq> U\n  card T' = card S\n  finite T'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "then"], ["proof (chain)\npicking this:\n  T' \\<subseteq> U\n  card T' = card S\n  finite T'", "obtain f::\"'v \\<Rightarrow> ('f,'v) term\" where f_bij: \"bij_betw f S T'\""], ["proof (prove)\nusing this:\n  T' \\<subseteq> U\n  card T' = card S\n  finite T'\n\ngoal (1 subgoal):\n 1. (\\<And>f. bij_betw f S T' \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using finite_same_card_bij[OF assms(1)]"], ["proof (prove)\nusing this:\n  T' \\<subseteq> U\n  card T' = card S\n  finite T'\n  \\<lbrakk>finite ?B; card S = card ?B\\<rbrakk>\n  \\<Longrightarrow> \\<exists>h. bij_betw h S ?B\n\ngoal (1 subgoal):\n 1. (\\<And>f. bij_betw f S T' \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by metis"], ["proof (state)\nthis:\n  bij_betw f S T'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "hence *: \"\\<And>v. v \\<in> S \\<Longrightarrow> f v \\<noteq> Var v\""], ["proof (prove)\nusing this:\n  bij_betw f S T'\n\ngoal (1 subgoal):\n 1. \\<And>v. v \\<in> S \\<Longrightarrow> f v \\<noteq> Var v", "using \\<open>ground U\\<close> \\<open>T' \\<subseteq> U\\<close> bij_betwE"], ["proof (prove)\nusing this:\n  bij_betw f S T'\n  ground U\n  T' \\<subseteq> U\n  bij_betw ?f ?A ?B \\<Longrightarrow> \\<forall>a\\<in>?A. ?f a \\<in> ?B\n\ngoal (1 subgoal):\n 1. \\<And>v. v \\<in> S \\<Longrightarrow> f v \\<noteq> Var v", "by fastforce"], ["proof (state)\nthis:\n  ?v \\<in> S \\<Longrightarrow> f ?v \\<noteq> Var ?v\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "let ?\\<sigma> = \"\\<lambda>v. if v \\<in> S then f v else Var v\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "have \"subst_domain ?\\<sigma> = S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v)\n    \\<subseteq> S\n 2. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "show \"subst_domain ?\\<sigma> \\<subseteq> S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v)\n    \\<subseteq> S", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> S\n\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "{"], ["proof (state)\nthis:\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> S\n\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "fix v"], ["proof (state)\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "assume \"v \\<in> S\" \"v \\<notin> subst_domain ?\\<sigma>\""], ["proof (state)\nthis:\n  v \\<in> S\n  v \\<notin> subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v)\n\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "hence \"f v = Var v\""], ["proof (prove)\nusing this:\n  v \\<in> S\n  v \\<notin> subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v)\n\ngoal (1 subgoal):\n 1. f v = Var v", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  f v = Var v\n\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "hence False"], ["proof (prove)\nusing this:\n  f v = Var v\n\ngoal (1 subgoal):\n 1. False", "using *[OF \\<open>v \\<in> S\\<close>]"], ["proof (prove)\nusing this:\n  f v = Var v\n  f v \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. False", "by metis"], ["proof (state)\nthis:\n  False\n\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "}"], ["proof (state)\nthis:\n  \\<lbrakk>?v2 \\<in> S;\n   ?v2\n   \\<notin> subst_domain\n             (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n  \\<Longrightarrow> False\n\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "thus \"S \\<subseteq> subst_domain ?\\<sigma>\""], ["proof (prove)\nusing this:\n  \\<lbrakk>?v2 \\<in> S;\n   ?v2\n   \\<notin> subst_domain\n             (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n  \\<Longrightarrow> False\n\ngoal (1 subgoal):\n 1. S \\<subseteq> subst_domain\n                   (\\<lambda>v. if v \\<in> S then f v else Var v)", "by blast"], ["proof (state)\nthis:\n  S \\<subseteq> subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "hence \"\\<And>v w. \\<lbrakk>v \\<in> subst_domain ?\\<sigma>; w \\<notin> subst_domain ?\\<sigma>\\<rbrakk> \\<Longrightarrow> ?\\<sigma> w \\<noteq> ?\\<sigma> v\""], ["proof (prove)\nusing this:\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n\ngoal (1 subgoal):\n 1. \\<And>v w.\n       \\<lbrakk>v \\<in> subst_domain\n                         (\\<lambda>v. if v \\<in> S then f v else Var v);\n        w \\<notin> subst_domain\n                    (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n       \\<Longrightarrow> (if w \\<in> S then f w else Var w) \\<noteq>\n                         (if v \\<in> S then f v else Var v)", "using \\<open>ground U\\<close> bij_betwE[OF f_bij] set_rev_mp[OF _ \\<open>T' \\<subseteq> U\\<close>]"], ["proof (prove)\nusing this:\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n  ground U\n  \\<forall>a\\<in>S. f a \\<in> T'\n  ?c \\<in> T' \\<Longrightarrow> ?c \\<in> U\n\ngoal (1 subgoal):\n 1. \\<And>v w.\n       \\<lbrakk>v \\<in> subst_domain\n                         (\\<lambda>v. if v \\<in> S then f v else Var v);\n        w \\<notin> subst_domain\n                    (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n       \\<Longrightarrow> (if w \\<in> S then f w else Var w) \\<noteq>\n                         (if v \\<in> S then f v else Var v)", "by (metis (no_types, lifting) UN_iff empty_iff vars_iff_subterm_or_eq fv\\<^sub>s\\<^sub>e\\<^sub>t.simps)"], ["proof (state)\nthis:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v. if v \\<in> S then f v else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then f ?w else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then f ?v else Var ?v)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "hence \"inj_on ?\\<sigma> (subst_domain ?\\<sigma>)\""], ["proof (prove)\nusing this:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v. if v \\<in> S then f v else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then f ?w else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then f ?v else Var ?v)\n\ngoal (1 subgoal):\n 1. inj_on (\\<lambda>v. if v \\<in> S then f v else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))", "using f_bij \\<open>subst_domain ?\\<sigma> = S\\<close>"], ["proof (prove)\nusing this:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v. if v \\<in> S then f v else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then f ?w else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then f ?v else Var ?v)\n  bij_betw f S T'\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n\ngoal (1 subgoal):\n 1. inj_on (\\<lambda>v. if v \\<in> S then f v else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))", "unfolding bij_betw_def inj_on_def"], ["proof (prove)\nusing this:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v. if v \\<in> S then f v else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v. if v \\<in> S then f v else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then f ?w else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then f ?v else Var ?v)\n  (\\<forall>x\\<in>S.\n      \\<forall>y\\<in>S. f x = f y \\<longrightarrow> x = y) \\<and>\n  f ` S = T'\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n\ngoal (1 subgoal):\n 1. \\<forall>x\\<in>subst_domain\n                    (\\<lambda>v. if v \\<in> S then f v else Var v).\n       \\<forall>y\\<in>subst_domain\n                       (\\<lambda>v. if v \\<in> S then f v else Var v).\n          (if x \\<in> S then f x else Var x) =\n          (if y \\<in> S then f y else Var y) \\<longrightarrow>\n          x = y", "by metis"], ["proof (state)\nthis:\n  inj_on (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "hence \"bij_betw ?\\<sigma> (subst_domain ?\\<sigma>) (subst_range ?\\<sigma>)\""], ["proof (prove)\nusing this:\n  inj_on (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n     (subst_range (\\<lambda>v. if v \\<in> S then f v else Var v))", "using inj_on_imp_bij_betw[of ?\\<sigma>]"], ["proof (prove)\nusing this:\n  inj_on (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n  inj_on (\\<lambda>v. if v \\<in> S then f v else Var v) ?A \\<Longrightarrow>\n  bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v) ?A\n   ((\\<lambda>v. if v \\<in> S then f v else Var v) ` ?A)\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n     (subst_range (\\<lambda>v. if v \\<in> S then f v else Var v))", "by simp"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then f v else Var v))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "moreover"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then f v else Var v))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "have \"subst_range ?\\<sigma> = T'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) = T'", "using \\<open>bij_betw f S T'\\<close> \\<open>subst_domain ?\\<sigma> = S\\<close>"], ["proof (prove)\nusing this:\n  bij_betw f S T'\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) = T'", "unfolding bij_betw_def"], ["proof (prove)\nusing this:\n  inj_on f S \\<and> f ` S = T'\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) = T'", "by auto"], ["proof (state)\nthis:\n  subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) = T'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "hence \"subst_range ?\\<sigma> \\<subseteq> U\""], ["proof (prove)\nusing this:\n  subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) = T'\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> U", "using \\<open>T' \\<subseteq> U\\<close>"], ["proof (prove)\nusing this:\n  subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) = T'\n  T' \\<subseteq> U\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> U", "by auto"], ["proof (state)\nthis:\n  subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> U\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "ultimately"], ["proof (chain)\npicking this:\n  bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then f v else Var v))\n  subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> U", "show ?thesis"], ["proof (prove)\nusing this:\n  bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then f v else Var v))\n  subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> U\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "using \\<open>subst_domain ?\\<sigma> = S\\<close>"], ["proof (prove)\nusing this:\n  bij_betw (\\<lambda>v. if v \\<in> S then f v else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then f v else Var v))\n  subst_range (\\<lambda>v. if v \\<in> S then f v else Var v) \\<subseteq> U\n  subst_domain (\\<lambda>v. if v \\<in> S then f v else Var v) = S\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> U", "by (metis (lifting))"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>.\n     subst_domain \\<sigma> = S \\<and>\n     bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>) \\<and>\n     subst_range \\<sigma> \\<subseteq> U\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bij_finite_const_subst_exists:\n  assumes \"finite (S::'v set)\" \"finite (T::'f set)\" \"infinite (U::'f set)\"\n  shows \"\\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\n                          \\<and> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n                          \\<and> subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "obtain T' where \"T' \\<subseteq> U - T\" \"card T' = card S\" \"finite T'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>T'.\n        \\<lbrakk>T' \\<subseteq> U - T; card T' = card S; finite T'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (meson assms(2,3) finite_Diff2 infinite_arbitrarily_large)"], ["proof (state)\nthis:\n  T' \\<subseteq> U - T\n  card T' = card S\n  finite T'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "then"], ["proof (chain)\npicking this:\n  T' \\<subseteq> U - T\n  card T' = card S\n  finite T'", "obtain f::\"'v \\<Rightarrow> 'f\" where f_bij: \"bij_betw f S T'\""], ["proof (prove)\nusing this:\n  T' \\<subseteq> U - T\n  card T' = card S\n  finite T'\n\ngoal (1 subgoal):\n 1. (\\<And>f. bij_betw f S T' \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using finite_same_card_bij[OF assms(1)]"], ["proof (prove)\nusing this:\n  T' \\<subseteq> U - T\n  card T' = card S\n  finite T'\n  \\<lbrakk>finite ?B; card S = card ?B\\<rbrakk>\n  \\<Longrightarrow> \\<exists>h. bij_betw h S ?B\n\ngoal (1 subgoal):\n 1. (\\<And>f. bij_betw f S T' \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by metis"], ["proof (state)\nthis:\n  bij_betw f S T'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "let ?\\<sigma> = \"\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "have \"subst_domain ?\\<sigma> = S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) = S", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) = S\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "moreover"], ["proof (state)\nthis:\n  subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) = S\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "have \"\\<And>v w. \\<lbrakk>v \\<in> subst_domain ?\\<sigma>; w \\<notin> subst_domain ?\\<sigma>\\<rbrakk> \\<Longrightarrow> ?\\<sigma> w \\<noteq> ?\\<sigma> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>v w.\n       \\<lbrakk>v \\<in> subst_domain\n                         (\\<lambda>v.\n                             if v \\<in> S then Fun (f v) [] else Var v);\n        w \\<notin> subst_domain\n                    (\\<lambda>v.\n                        if v \\<in> S then Fun (f v) [] else Var v)\\<rbrakk>\n       \\<Longrightarrow> (if w \\<in> S then Fun (f w) []\n                          else Var w) \\<noteq>\n                         (if v \\<in> S then Fun (f v) [] else Var v)", "by auto"], ["proof (state)\nthis:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v.\n                         if v \\<in> S then Fun (f v) [] else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v.\n                    if v \\<in> S then Fun (f v) [] else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then Fun (f ?w) [] else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then Fun (f ?v) [] else Var ?v)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "hence \"inj_on ?\\<sigma> (subst_domain ?\\<sigma>)\""], ["proof (prove)\nusing this:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v.\n                         if v \\<in> S then Fun (f v) [] else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v.\n                    if v \\<in> S then Fun (f v) [] else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then Fun (f ?w) [] else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then Fun (f ?v) [] else Var ?v)\n\ngoal (1 subgoal):\n 1. inj_on (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))", "using f_bij"], ["proof (prove)\nusing this:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v.\n                         if v \\<in> S then Fun (f v) [] else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v.\n                    if v \\<in> S then Fun (f v) [] else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then Fun (f ?w) [] else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then Fun (f ?v) [] else Var ?v)\n  bij_betw f S T'\n\ngoal (1 subgoal):\n 1. inj_on (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))", "unfolding bij_betw_def inj_on_def"], ["proof (prove)\nusing this:\n  \\<lbrakk>?v \\<in> subst_domain\n                     (\\<lambda>v.\n                         if v \\<in> S then Fun (f v) [] else Var v);\n   ?w \\<notin> subst_domain\n                (\\<lambda>v.\n                    if v \\<in> S then Fun (f v) [] else Var v)\\<rbrakk>\n  \\<Longrightarrow> (if ?w \\<in> S then Fun (f ?w) [] else Var ?w) \\<noteq>\n                    (if ?v \\<in> S then Fun (f ?v) [] else Var ?v)\n  (\\<forall>x\\<in>S.\n      \\<forall>y\\<in>S. f x = f y \\<longrightarrow> x = y) \\<and>\n  f ` S = T'\n\ngoal (1 subgoal):\n 1. \\<forall>x\\<in>subst_domain\n                    (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v).\n       \\<forall>y\\<in>subst_domain\n                       (\\<lambda>v.\n                           if v \\<in> S then Fun (f v) [] else Var v).\n          (if x \\<in> S then Fun (f x) [] else Var x) =\n          (if y \\<in> S then Fun (f y) [] else Var y) \\<longrightarrow>\n          x = y", "by (metis \\<open>subst_domain ?\\<sigma> = S\\<close> term.inject(2))"], ["proof (state)\nthis:\n  inj_on (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "hence \"bij_betw ?\\<sigma> (subst_domain ?\\<sigma>) (subst_range ?\\<sigma>)\""], ["proof (prove)\nusing this:\n  inj_on (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n     (subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))", "using inj_on_imp_bij_betw[of ?\\<sigma>]"], ["proof (prove)\nusing this:\n  inj_on (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n  inj_on (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   ?A \\<Longrightarrow>\n  bij_betw (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) ?A\n   ((\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) ` ?A)\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n     (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n     (subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))", "by simp"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "moreover"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "have \"subst_range ?\\<sigma> = ((\\<lambda>c. Fun c []) ` T')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) =\n    (\\<lambda>c. Fun c []) ` T'", "using \\<open>bij_betw f S T'\\<close>"], ["proof (prove)\nusing this:\n  bij_betw f S T'\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) =\n    (\\<lambda>c. Fun c []) ` T'", "unfolding bij_betw_def inj_on_def"], ["proof (prove)\nusing this:\n  (\\<forall>x\\<in>S.\n      \\<forall>y\\<in>S. f x = f y \\<longrightarrow> x = y) \\<and>\n  f ` S = T'\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) =\n    (\\<lambda>c. Fun c []) ` T'", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) =\n  (\\<lambda>c. Fun c []) ` T'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "hence \"subst_range ?\\<sigma> \\<subseteq> ((\\<lambda>c. Fun c []) ` (U - T))\""], ["proof (prove)\nusing this:\n  subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) =\n  (\\<lambda>c. Fun c []) ` T'\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n    \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "using \\<open>T' \\<subseteq> U - T\\<close>"], ["proof (prove)\nusing this:\n  subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) =\n  (\\<lambda>c. Fun c []) ` T'\n  T' \\<subseteq> U - T\n\ngoal (1 subgoal):\n 1. subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n    \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "by auto"], ["proof (state)\nthis:\n  subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n  \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) = S\n  bij_betw (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n  subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n  \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "show ?thesis"], ["proof (prove)\nusing this:\n  subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v) = S\n  bij_betw (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n   (subst_domain (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n   (subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v))\n  subst_range (\\<lambda>v. if v \\<in> S then Fun (f v) [] else Var v)\n  \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)", "by (metis (lifting))"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>.\n     subst_domain \\<sigma> = S \\<and>\n     bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>) \\<and>\n     subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - T)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bij_finite_const_subst_exists':\n  assumes \"finite (S::'v set)\" \"finite (T::('f,'v) terms)\" \"infinite (U::'f set)\"\n  shows \"\\<exists>\\<sigma>::('f,'v) subst. subst_domain \\<sigma> = S\n                          \\<and> bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n                          \\<and> subst_range \\<sigma> \\<subseteq> ((\\<lambda>c. Fun c []) ` U) - T\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "have \"finite (\\<Union>(funs_term ` T))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (\\<Union> (funs_term ` T))", "using assms(2)"], ["proof (prove)\nusing this:\n  finite T\n\ngoal (1 subgoal):\n 1. finite (\\<Union> (funs_term ` T))", "by auto"], ["proof (state)\nthis:\n  finite (\\<Union> (funs_term ` T))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "then"], ["proof (chain)\npicking this:\n  finite (\\<Union> (funs_term ` T))", "obtain \\<sigma> where \\<sigma>:\n      \"subst_domain \\<sigma> = S\" \"bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\"\n      \"subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - (\\<Union>(funs_term ` T)))\""], ["proof (prove)\nusing this:\n  finite (\\<Union> (funs_term ` T))\n\ngoal (1 subgoal):\n 1. (\\<And>\\<sigma>.\n        \\<lbrakk>subst_domain \\<sigma> = S;\n         bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>);\n         subst_range \\<sigma>\n         \\<subseteq> (\\<lambda>c. Fun c []) `\n                     (U - \\<Union> (funs_term ` T))\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using bij_finite_const_subst_exists[OF assms(1) _ assms(3)]"], ["proof (prove)\nusing this:\n  finite (\\<Union> (funs_term ` T))\n  finite ?T \\<Longrightarrow>\n  \\<exists>\\<sigma>.\n     subst_domain \\<sigma> = S \\<and>\n     bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>) \\<and>\n     subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` (U - ?T)\n\ngoal (1 subgoal):\n 1. (\\<And>\\<sigma>.\n        \\<lbrakk>subst_domain \\<sigma> = S;\n         bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>);\n         subst_range \\<sigma>\n         \\<subseteq> (\\<lambda>c. Fun c []) `\n                     (U - \\<Union> (funs_term ` T))\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<sigma> = S\n  bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n  subst_range \\<sigma>\n  \\<subseteq> (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "moreover"], ["proof (state)\nthis:\n  subst_domain \\<sigma> = S\n  bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n  subst_range \\<sigma>\n  \\<subseteq> (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "have \"(\\<lambda>c. Fun c []) ` (U - (\\<Union>(funs_term ` T))) \\<subseteq> ((\\<lambda>c. Fun c []) ` U) - T\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n    \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "by auto"], ["proof (state)\nthis:\n  (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n  \\<subseteq> (\\<lambda>c. Fun c []) ` U - T\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain \\<sigma> = S\n  bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n  subst_range \\<sigma>\n  \\<subseteq> (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n  (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n  \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "show ?thesis"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> = S\n  bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>)\n  subst_range \\<sigma>\n  \\<subseteq> (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n  (\\<lambda>c. Fun c []) ` (U - \\<Union> (funs_term ` T))\n  \\<subseteq> (\\<lambda>c. Fun c []) ` U - T\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       subst_domain \\<sigma> = S \\<and>\n       bij_betw \\<sigma> (subst_domain \\<sigma>)\n        (subst_range \\<sigma>) \\<and>\n       subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T", "by blast"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>.\n     subst_domain \\<sigma> = S \\<and>\n     bij_betw \\<sigma> (subst_domain \\<sigma>) (subst_range \\<sigma>) \\<and>\n     subst_range \\<sigma> \\<subseteq> (\\<lambda>c. Fun c []) ` U - T\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bij_betw_iteI:\n  assumes \"bij_betw f A B\" \"bij_betw g C D\" \"A \\<inter> C = {}\" \"B \\<inter> D = {}\"\n  shows \"bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C) (B \\<union> D)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n     (B \\<union> D)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n     (B \\<union> D)", "have \"bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) A B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) A B", "by (metis bij_betw_cong[of A f \"\\<lambda>x. if x \\<in> A then f x else g x\" B] assms(1))"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) A B\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n     (B \\<union> D)", "moreover"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) A B\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n     (B \\<union> D)", "have \"bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D\""], ["proof (prove)\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D", "using bij_betw_cong[of C g \"\\<lambda>x. if x \\<in> A then f x else g x\" D] assms(2,3)"], ["proof (prove)\nusing this:\n  (\\<And>a.\n      a \\<in> C \\<Longrightarrow>\n      g a = (if a \\<in> A then f a else g a)) \\<Longrightarrow>\n  bij_betw g C D = bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D\n  bij_betw g C D\n  A \\<inter> C = {}\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D", "by force"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n     (B \\<union> D)", "ultimately"], ["proof (chain)\npicking this:\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) A B\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D", "show ?thesis"], ["proof (prove)\nusing this:\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) A B\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n     (B \\<union> D)", "using bij_betw_combine[OF _ _ assms(4)]"], ["proof (prove)\nusing this:\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) A B\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) C D\n  \\<lbrakk>bij_betw ?f ?A B; bij_betw ?f ?C D\\<rbrakk>\n  \\<Longrightarrow> bij_betw ?f (?A \\<union> ?C) (B \\<union> D)\n\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n     (B \\<union> D)", "by metis"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>x. if x \\<in> A then f x else g x) (A \\<union> C)\n   (B \\<union> D)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_comp_split:\n  assumes \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\"\n  shows \"\\<theta> = (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<circ>\\<^sub>s (rm_vars V \\<theta>)\" (is ?P)\n    and \"\\<theta> = (rm_vars V \\<theta>) \\<circ>\\<^sub>s (rm_vars (subst_domain \\<theta> - V) \\<theta>)\" (is ?Q)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta> &&&\n    \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "proof -"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta>\n 2. \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "let ?rm1 = \"rm_vars (subst_domain \\<theta> - V) \\<theta>\" and ?rm2 = \"rm_vars V \\<theta>\""], ["proof (state)\ngoal (2 subgoals):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta>\n 2. \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "have \"subst_domain ?rm2 \\<inter> range_vars ?rm1 = {}\"\n       \"subst_domain ?rm1 \\<inter> range_vars ?rm2 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars V \\<theta>) \\<inter>\n    range_vars (rm_vars (subst_domain \\<theta> - V) \\<theta>) =\n    {} &&&\n    subst_domain (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<inter>\n    range_vars (rm_vars V \\<theta>) =\n    {}", "using assms"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. subst_domain (rm_vars V \\<theta>) \\<inter>\n    range_vars (rm_vars (subst_domain \\<theta> - V) \\<theta>) =\n    {} &&&\n    subst_domain (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<inter>\n    range_vars (rm_vars V \\<theta>) =\n    {}", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) =\n  {}\n\ngoal (1 subgoal):\n 1. subst_domain (rm_vars V \\<theta>) \\<inter>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (subst_range (rm_vars (subst_domain \\<theta> - V) \\<theta>)) =\n    {} &&&\n    subst_domain (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<inter>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (rm_vars V \\<theta>)) =\n    {}", "by (force simp add: subst_domain_def)+"], ["proof (state)\nthis:\n  subst_domain (rm_vars V \\<theta>) \\<inter>\n  range_vars (rm_vars (subst_domain \\<theta> - V) \\<theta>) =\n  {}\n  subst_domain (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<inter>\n  range_vars (rm_vars V \\<theta>) =\n  {}\n\ngoal (2 subgoals):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta>\n 2. \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "hence *: \"\\<And>v. v \\<in> subst_domain ?rm1 \\<Longrightarrow> (?rm1 \\<circ>\\<^sub>s ?rm2) v = \\<theta> v\"\n           \"\\<And>v. v \\<in> subst_domain ?rm2 \\<Longrightarrow> (?rm2 \\<circ>\\<^sub>s ?rm1) v = \\<theta> v\""], ["proof (prove)\nusing this:\n  subst_domain (rm_vars V \\<theta>) \\<inter>\n  range_vars (rm_vars (subst_domain \\<theta> - V) \\<theta>) =\n  {}\n  subst_domain (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<inter>\n  range_vars (rm_vars V \\<theta>) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        v \\<in> subst_domain\n                 (rm_vars (subst_domain \\<theta> - V)\n                   \\<theta>) \\<Longrightarrow>\n        (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n         rm_vars V \\<theta>)\n         v =\n        \\<theta> v) &&&\n    (\\<And>v.\n        v \\<in> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n        (rm_vars V \\<theta> \\<circ>\\<^sub>s\n         rm_vars (subst_domain \\<theta> - V) \\<theta>)\n         v =\n        \\<theta> v)", "using ident_comp_subst_trm_if_disj[of ?rm2 ?rm1]\n          ident_comp_subst_trm_if_disj[of ?rm1 ?rm2]"], ["proof (prove)\nusing this:\n  subst_domain (rm_vars V \\<theta>) \\<inter>\n  range_vars (rm_vars (subst_domain \\<theta> - V) \\<theta>) =\n  {}\n  subst_domain (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<inter>\n  range_vars (rm_vars V \\<theta>) =\n  {}\n  \\<lbrakk>subst_domain (rm_vars V \\<theta>) \\<inter>\n           range_vars (rm_vars (subst_domain \\<theta> - V) \\<theta>) =\n           {};\n   ?v \\<in> subst_domain\n             (rm_vars (subst_domain \\<theta> - V) \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> (rm_vars (subst_domain \\<theta> - V)\n                      \\<theta> \\<circ>\\<^sub>s\n                     rm_vars V \\<theta>)\n                     ?v =\n                    rm_vars (subst_domain \\<theta> - V) \\<theta> ?v\n  \\<lbrakk>subst_domain\n            (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<inter>\n           range_vars (rm_vars V \\<theta>) =\n           {};\n   ?v \\<in> subst_domain (rm_vars V \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> (rm_vars V \\<theta> \\<circ>\\<^sub>s\n                     rm_vars (subst_domain \\<theta> - V) \\<theta>)\n                     ?v =\n                    rm_vars V \\<theta> ?v\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        v \\<in> subst_domain\n                 (rm_vars (subst_domain \\<theta> - V)\n                   \\<theta>) \\<Longrightarrow>\n        (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n         rm_vars V \\<theta>)\n         v =\n        \\<theta> v) &&&\n    (\\<And>v.\n        v \\<in> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n        (rm_vars V \\<theta> \\<circ>\\<^sub>s\n         rm_vars (subst_domain \\<theta> - V) \\<theta>)\n         v =\n        \\<theta> v)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  ?v \\<in> subst_domain\n            (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<Longrightarrow>\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  ?v \\<in> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n\ngoal (2 subgoals):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta>\n 2. \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "hence \"\\<And>v. v \\<notin> subst_domain ?rm1 \\<Longrightarrow> (?rm1 \\<circ>\\<^sub>s ?rm2) v = \\<theta> v\"\n        \"\\<And>v. v \\<notin> subst_domain ?rm2 \\<Longrightarrow> (?rm2 \\<circ>\\<^sub>s ?rm1) v = \\<theta> v\""], ["proof (prove)\nusing this:\n  ?v \\<in> subst_domain\n            (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<Longrightarrow>\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  ?v \\<in> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        v \\<notin> subst_domain\n                    (rm_vars (subst_domain \\<theta> - V)\n                      \\<theta>) \\<Longrightarrow>\n        (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n         rm_vars V \\<theta>)\n         v =\n        \\<theta> v) &&&\n    (\\<And>v.\n        v \\<notin> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n        (rm_vars V \\<theta> \\<circ>\\<^sub>s\n         rm_vars (subst_domain \\<theta> - V) \\<theta>)\n         v =\n        \\<theta> v)", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  ?v \\<in> subst_domain\n            (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<Longrightarrow>\n  rm_vars (subst_domain \\<theta> - V) \\<theta> ?v \\<cdot>\n  rm_vars V \\<theta> =\n  \\<theta> ?v\n  ?v \\<in> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n  rm_vars V \\<theta> ?v \\<cdot>\n  rm_vars (subst_domain \\<theta> - V) \\<theta> =\n  \\<theta> ?v\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        v \\<notin> subst_domain\n                    (rm_vars (subst_domain \\<theta> - V)\n                      \\<theta>) \\<Longrightarrow>\n        rm_vars (subst_domain \\<theta> - V) \\<theta> v \\<cdot>\n        rm_vars V \\<theta> =\n        \\<theta> v) &&&\n    (\\<And>v.\n        v \\<notin> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n        rm_vars V \\<theta> v \\<cdot>\n        rm_vars (subst_domain \\<theta> - V) \\<theta> =\n        \\<theta> v)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  ?v \\<notin> subst_domain\n               (rm_vars (subst_domain \\<theta> - V)\n                 \\<theta>) \\<Longrightarrow>\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  ?v \\<notin> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n\ngoal (2 subgoals):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta>\n 2. \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "hence \"\\<And>v. (?rm1 \\<circ>\\<^sub>s ?rm2) v = \\<theta> v\" \"\\<And>v. (?rm2 \\<circ>\\<^sub>s ?rm1) v = \\<theta> v\""], ["proof (prove)\nusing this:\n  ?v \\<notin> subst_domain\n               (rm_vars (subst_domain \\<theta> - V)\n                 \\<theta>) \\<Longrightarrow>\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  ?v \\<notin> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n         rm_vars V \\<theta>)\n         v =\n        \\<theta> v) &&&\n    (\\<And>v.\n        (rm_vars V \\<theta> \\<circ>\\<^sub>s\n         rm_vars (subst_domain \\<theta> - V) \\<theta>)\n         v =\n        \\<theta> v)", "using *"], ["proof (prove)\nusing this:\n  ?v \\<notin> subst_domain\n               (rm_vars (subst_domain \\<theta> - V)\n                 \\<theta>) \\<Longrightarrow>\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  ?v \\<notin> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n  ?v \\<in> subst_domain\n            (rm_vars (subst_domain \\<theta> - V) \\<theta>) \\<Longrightarrow>\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  ?v \\<in> subst_domain (rm_vars V \\<theta>) \\<Longrightarrow>\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n         rm_vars V \\<theta>)\n         v =\n        \\<theta> v) &&&\n    (\\<And>v.\n        (rm_vars V \\<theta> \\<circ>\\<^sub>s\n         rm_vars (subst_domain \\<theta> - V) \\<theta>)\n         v =\n        \\<theta> v)", "by blast+"], ["proof (state)\nthis:\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n\ngoal (2 subgoals):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta>\n 2. \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "thus ?P ?Q"], ["proof (prove)\nusing this:\n  (rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n   rm_vars V \\<theta>)\n   ?v =\n  \\<theta> ?v\n  (rm_vars V \\<theta> \\<circ>\\<^sub>s\n   rm_vars (subst_domain \\<theta> - V) \\<theta>)\n   ?v =\n  \\<theta> ?v\n\ngoal (1 subgoal):\n 1. \\<theta> =\n    rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n    rm_vars V \\<theta> &&&\n    \\<theta> =\n    rm_vars V \\<theta> \\<circ>\\<^sub>s\n    rm_vars (subst_domain \\<theta> - V) \\<theta>", "by auto"], ["proof (state)\nthis:\n  \\<theta> =\n  rm_vars (subst_domain \\<theta> - V) \\<theta> \\<circ>\\<^sub>s\n  rm_vars V \\<theta>\n  \\<theta> =\n  rm_vars V \\<theta> \\<circ>\\<^sub>s\n  rm_vars (subst_domain \\<theta> - V) \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_comp_eq_if_disjoint_vars:\n  assumes \"(subst_domain \\<delta> \\<union> range_vars \\<delta>) \\<inter> (subst_domain \\<gamma> \\<union> range_vars \\<gamma>) = {}\"\n  shows \"\\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "assume \"x \\<in> subst_domain \\<gamma>\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<gamma>\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "hence \"(\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<gamma> x\" \"(\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<gamma> x\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<gamma>\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<gamma> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<gamma> x", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<gamma>\n  (subst_domain \\<delta> \\<union> range_vars \\<delta>) \\<inter>\n  (subst_domain \\<gamma> \\<union> range_vars \\<gamma>) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<gamma> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<gamma> x", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<gamma>\n  (subst_domain \\<delta> \\<union>\n   fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)) \\<inter>\n  (subst_domain \\<gamma> \\<union>\n   fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<gamma>)) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<gamma> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<gamma> x", "by (force simp add: subst_compose)+"], ["proof (state)\nthis:\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<gamma> x\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<gamma> x\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "hence \"(\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x\""], ["proof (prove)\nusing this:\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<gamma> x\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<gamma> x\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x =\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x", "by metis"], ["proof (state)\nthis:\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "}"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<gamma> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "moreover"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<gamma> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "{"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<gamma> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "assume \"x \\<in> subst_domain \\<delta>\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "hence \"(\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<delta> x\" \"(\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<delta> x\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<delta> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<delta> x", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n  (subst_domain \\<delta> \\<union> range_vars \\<delta>) \\<inter>\n  (subst_domain \\<gamma> \\<union> range_vars \\<gamma>) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<delta> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<delta> x", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n  (subst_domain \\<delta> \\<union>\n   fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)) \\<inter>\n  (subst_domain \\<gamma> \\<union>\n   fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<gamma>)) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<delta> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<delta> x", "by (auto simp add: subst_compose subst_domain_def)"], ["proof (state)\nthis:\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<delta> x\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<delta> x\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "hence \"(\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x\""], ["proof (prove)\nusing this:\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = \\<delta> x\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x = \\<delta> x\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x =\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x", "by metis"], ["proof (state)\nthis:\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "}"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<delta> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "moreover"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<delta> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "{"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<delta> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "assume \"x \\<notin> subst_domain \\<gamma>\" \"x \\<notin> subst_domain \\<delta>\""], ["proof (state)\nthis:\n  x \\<notin> subst_domain \\<gamma>\n  x \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "hence \"(\\<gamma> \\<circ>\\<^sub>s \\<delta>) x = (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x\""], ["proof (prove)\nusing this:\n  x \\<notin> subst_domain \\<gamma>\n  x \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x =\n    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x", "by (simp add: subst_compose subst_domain_def)"], ["proof (state)\nthis:\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) x =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) x\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "}"], ["proof (state)\nthis:\n  \\<lbrakk>?x2 \\<notin> subst_domain \\<gamma>;\n   ?x2 \\<notin> subst_domain \\<delta>\\<rbrakk>\n  \\<Longrightarrow> (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n                    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "ultimately"], ["proof (chain)\npicking this:\n  ?x2 \\<in> subst_domain \\<gamma> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n  ?x2 \\<in> subst_domain \\<delta> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n  \\<lbrakk>?x2 \\<notin> subst_domain \\<gamma>;\n   ?x2 \\<notin> subst_domain \\<delta>\\<rbrakk>\n  \\<Longrightarrow> (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n                    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2", "show ?thesis"], ["proof (prove)\nusing this:\n  ?x2 \\<in> subst_domain \\<gamma> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n  ?x2 \\<in> subst_domain \\<delta> \\<Longrightarrow>\n  (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n  (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n  \\<lbrakk>?x2 \\<notin> subst_domain \\<gamma>;\n   ?x2 \\<notin> subst_domain \\<delta>\\<rbrakk>\n  \\<Longrightarrow> (\\<gamma> \\<circ>\\<^sub>s \\<delta>) ?x2 =\n                    (\\<delta> \\<circ>\\<^sub>s \\<gamma>) ?x2\n\ngoal (1 subgoal):\n 1. \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>", "by auto"], ["proof (state)\nthis:\n  \\<gamma> \\<circ>\\<^sub>s \\<delta> = \\<delta> \\<circ>\\<^sub>s \\<gamma>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_eq_if_disjoint_vars_ground:\n  fixes \\<xi> \\<delta>::\"('f,'v) subst\"\n  assumes \"subst_domain \\<delta> \\<inter> subst_domain \\<xi> = {}\" \"ground (subst_range \\<xi>)\" \"ground (subst_range \\<delta>)\" \n  shows \"t \\<cdot> \\<delta> \\<cdot> \\<xi> = t \\<cdot> \\<xi> \\<cdot> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<cdot> \\<delta> \\<cdot> \\<xi> = t \\<cdot> \\<xi> \\<cdot> \\<delta>", "by (metis assms subst_comp_eq_if_disjoint_vars range_vars_alt_def\n          subst_subst_compose sup_bot.right_neutral)"], ["", "lemma subst_img_bound: \"subst_domain \\<delta> \\<union> range_vars \\<delta> \\<subseteq> fv t \\<Longrightarrow> range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<union> range_vars \\<delta>\n    \\<subseteq> fv t \\<Longrightarrow>\n    range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<union> range_vars \\<delta>\n    \\<subseteq> fv t \\<Longrightarrow>\n    range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)", "assume \"subst_domain \\<delta> \\<union> range_vars \\<delta> \\<subseteq> fv t\""], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<union> range_vars \\<delta> \\<subseteq> fv t\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<union> range_vars \\<delta>\n    \\<subseteq> fv t \\<Longrightarrow>\n    range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)", "hence \"subst_domain \\<delta> \\<subseteq> fv t\""], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<union> range_vars \\<delta> \\<subseteq> fv t\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<subseteq> fv t", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<subseteq> fv t\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<union> range_vars \\<delta>\n    \\<subseteq> fv t \\<Longrightarrow>\n    range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<subseteq> fv t\n\ngoal (1 subgoal):\n 1. range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)", "by (metis (no_types) range_vars_alt_def le_iff_sup subst_apply_fv_unfold\n              subst_apply_fv_union subst_range.simps)"], ["proof (state)\nthis:\n  range_vars \\<delta> \\<subseteq> fv (t \\<cdot> \\<delta>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_all_fv_subset: \"fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow> fv (t \\<cdot> \\<theta>) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "assume *: \"fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\""], ["proof (state)\nthis:\n  fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "{"], ["proof (state)\nthis:\n  fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "fix v"], ["proof (state)\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "assume \"v \\<in> fv t\""], ["proof (state)\nthis:\n  v \\<in> fv t\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "hence \"v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M\""], ["proof (prove)\nusing this:\n  v \\<in> fv t\n\ngoal (1 subgoal):\n 1. v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "using *"], ["proof (prove)\nusing this:\n  v \\<in> fv t\n  fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "by auto"], ["proof (state)\nthis:\n  v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "then"], ["proof (chain)\npicking this:\n  v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M", "obtain t' where \"t' \\<in> M\" \"v \\<in> fv t'\""], ["proof (prove)\nusing this:\n  v \\<in> fv\\<^sub>s\\<^sub>e\\<^sub>t M\n\ngoal (1 subgoal):\n 1. (\\<And>t'.\n        \\<lbrakk>t' \\<in> M; v \\<in> fv t'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  t' \\<in> M\n  v \\<in> fv t'\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "hence \"fv (\\<theta> v) \\<subseteq> fv (t' \\<cdot> \\<theta>)\""], ["proof (prove)\nusing this:\n  t' \\<in> M\n  v \\<in> fv t'\n\ngoal (1 subgoal):\n 1. fv (\\<theta> v) \\<subseteq> fv (t' \\<cdot> \\<theta>)", "by (metis subst_apply_term.simps(1) subst_apply_fv_subset subst_apply_fv_unfold\n                subtermeq_vars_subset vars_iff_subtermeq)"], ["proof (state)\nthis:\n  fv (\\<theta> v) \\<subseteq> fv (t' \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "hence \"fv (\\<theta> v) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\""], ["proof (prove)\nusing this:\n  fv (\\<theta> v) \\<subseteq> fv (t' \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. fv (\\<theta> v)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "using \\<open>t' \\<in> M\\<close>"], ["proof (prove)\nusing this:\n  fv (\\<theta> v) \\<subseteq> fv (t' \\<cdot> \\<theta>)\n  t' \\<in> M\n\ngoal (1 subgoal):\n 1. fv (\\<theta> v)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "by auto"], ["proof (state)\nthis:\n  fv (\\<theta> v)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n               (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "}"], ["proof (state)\nthis:\n  ?v2 \\<in> fv t \\<Longrightarrow>\n  fv (\\<theta> ?v2)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n               (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n\ngoal (1 subgoal):\n 1. fv t \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t M \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  ?v2 \\<in> fv t \\<Longrightarrow>\n  fv (\\<theta> ?v2)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n               (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "using subst_apply_fv_unfold[of t \\<theta>]"], ["proof (prove)\nusing this:\n  ?v2 \\<in> fv t \\<Longrightarrow>\n  fv (\\<theta> ?v2)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n               (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n  fv (t \\<cdot> \\<theta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` fv t)\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                 (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "by auto"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<theta>)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t\n               (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_support_if_mgt_subst_idem:\n  assumes \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\" \"subst_idem \\<theta>\"\n  shows \"\\<theta> supports \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta>", "from \\<open>\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\\<close>"], ["proof (chain)\npicking this:\n  \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>", "obtain \\<sigma> where \\<sigma>: \"\\<delta> = \\<theta> \\<circ>\\<^sub>s \\<sigma>\""], ["proof (prove)\nusing this:\n  \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<sigma>.\n        \\<delta> = \\<theta> \\<circ>\\<^sub>s \\<sigma> \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  \\<delta> = \\<theta> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta>", "hence \"\\<And>v. \\<theta> v \\<cdot> \\<delta> = Var v \\<cdot> (\\<theta> \\<circ>\\<^sub>s \\<theta> \\<circ>\\<^sub>s \\<sigma>)\""], ["proof (prove)\nusing this:\n  \\<delta> = \\<theta> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<And>v.\n       \\<theta> v \\<cdot> \\<delta> =\n       Var v \\<cdot>\n       \\<theta> \\<circ>\\<^sub>s \\<theta> \\<circ>\\<^sub>s \\<sigma>", "by simp"], ["proof (state)\nthis:\n  \\<theta> ?v \\<cdot> \\<delta> =\n  Var ?v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<theta> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta>", "hence \"\\<And>v. \\<theta> v \\<cdot> \\<delta> = Var v \\<cdot> (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\""], ["proof (prove)\nusing this:\n  \\<theta> ?v \\<cdot> \\<delta> =\n  Var ?v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<theta> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<And>v.\n       \\<theta> v \\<cdot> \\<delta> =\n       Var v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<sigma>", "using \\<open>subst_idem \\<theta> \\<close>"], ["proof (prove)\nusing this:\n  \\<theta> ?v \\<cdot> \\<delta> =\n  Var ?v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<theta> \\<circ>\\<^sub>s \\<sigma>\n  subst_idem \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>v.\n       \\<theta> v \\<cdot> \\<delta> =\n       Var v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<sigma>", "unfolding subst_idem_def"], ["proof (prove)\nusing this:\n  \\<theta> ?v \\<cdot> \\<delta> =\n  Var ?v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<theta> \\<circ>\\<^sub>s \\<sigma>\n  \\<theta> \\<circ>\\<^sub>s \\<theta> = \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>v.\n       \\<theta> v \\<cdot> \\<delta> =\n       Var v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<sigma>", "by simp"], ["proof (state)\nthis:\n  \\<theta> ?v \\<cdot> \\<delta> =\n  Var ?v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta>", "hence \"\\<And>v. \\<theta> v \\<cdot> \\<delta> = Var v \\<cdot> \\<delta>\""], ["proof (prove)\nusing this:\n  \\<theta> ?v \\<cdot> \\<delta> =\n  Var ?v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<And>v. \\<theta> v \\<cdot> \\<delta> = Var v \\<cdot> \\<delta>", "using \\<sigma>"], ["proof (prove)\nusing this:\n  \\<theta> ?v \\<cdot> \\<delta> =\n  Var ?v \\<cdot> \\<theta> \\<circ>\\<^sub>s \\<sigma>\n  \\<delta> = \\<theta> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<And>v. \\<theta> v \\<cdot> \\<delta> = Var v \\<cdot> \\<delta>", "by simp"], ["proof (state)\nthis:\n  \\<theta> ?v \\<cdot> \\<delta> = Var ?v \\<cdot> \\<delta>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta>", "thus \"\\<theta> supports \\<delta>\""], ["proof (prove)\nusing this:\n  \\<theta> ?v \\<cdot> \\<delta> = Var ?v \\<cdot> \\<delta>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta>", "by simp"], ["proof (state)\nthis:\n  \\<theta> supports \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_support_iff_mgt_if_subst_idem:\n  assumes \"subst_idem \\<theta>\"\n  shows \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta> \\<longleftrightarrow> \\<theta> supports \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>) =\n    (\\<theta> supports \\<delta>)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta> \\<Longrightarrow>\n    \\<theta> supports \\<delta>\n 2. \\<theta> supports \\<delta> \\<Longrightarrow>\n    \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>", "show \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta> \\<Longrightarrow> \\<theta> supports \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta> \\<Longrightarrow>\n    \\<theta> supports \\<delta>", "by (fact subst_support_if_mgt_subst_idem[OF _ \\<open>subst_idem \\<theta>\\<close>])"], ["proof (state)\nthis:\n  \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta> \\<Longrightarrow>\n  \\<theta> supports \\<delta>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta> \\<Longrightarrow>\n    \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>", "show \"\\<theta> supports \\<delta> \\<Longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta> \\<Longrightarrow>\n    \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>", "by (fact subst_supportD)"], ["proof (state)\nthis:\n  \\<theta> supports \\<delta> \\<Longrightarrow>\n  \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_support_comp:\n  fixes \\<theta> \\<delta> \\<I>::\"('a,'b) subst\"\n  assumes \"\\<theta> supports \\<I>\" \"\\<delta> supports \\<I>\"\n  shows \"(\\<theta> \\<circ>\\<^sub>s \\<delta>) supports \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> \\<circ>\\<^sub>s \\<delta> supports \\<I>", "by (metis (no_types) assms subst_agreement subst_apply_term.simps(1) subst_subst_compose)"], ["", "lemma subst_support_comp':\n  fixes \\<theta> \\<delta> \\<sigma>::\"('a,'b) subst\"\n  assumes \"\\<theta> supports \\<delta>\"\n  shows \"\\<theta> supports (\\<delta> \\<circ>\\<^sub>s \\<sigma>)\" \"\\<sigma> supports \\<delta> \\<Longrightarrow> \\<theta> supports (\\<sigma> \\<circ>\\<^sub>s \\<delta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta> \\<circ>\\<^sub>s \\<sigma> &&&\n    (\\<sigma> supports \\<delta> \\<Longrightarrow>\n     \\<theta> supports \\<sigma> \\<circ>\\<^sub>s \\<delta>)", "using assms"], ["proof (prove)\nusing this:\n  \\<theta> supports \\<delta>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<delta> \\<circ>\\<^sub>s \\<sigma> &&&\n    (\\<sigma> supports \\<delta> \\<Longrightarrow>\n     \\<theta> supports \\<sigma> \\<circ>\\<^sub>s \\<delta>)", "unfolding subst_support_def"], ["proof (prove)\nusing this:\n  \\<delta> = \\<theta> \\<circ>\\<^sub>s \\<delta>\n\ngoal (1 subgoal):\n 1. \\<delta> \\<circ>\\<^sub>s \\<sigma> =\n    \\<theta> \\<circ>\\<^sub>s (\\<delta> \\<circ>\\<^sub>s \\<sigma>) &&&\n    (\\<delta> = \\<sigma> \\<circ>\\<^sub>s \\<delta> \\<Longrightarrow>\n     \\<sigma> \\<circ>\\<^sub>s \\<delta> =\n     \\<theta> \\<circ>\\<^sub>s (\\<sigma> \\<circ>\\<^sub>s \\<delta>))", "by (metis subst_compose_assoc, metis)"], ["", "lemma subst_support_comp_split:\n  fixes \\<theta> \\<delta> \\<I>::\"('a,'b) subst\"\n  assumes \"(\\<theta> \\<circ>\\<^sub>s \\<delta>) supports \\<I>\"\n  shows \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<Longrightarrow> \\<theta> supports \\<I>\"\n  and \"subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {} \\<Longrightarrow> \\<delta> supports \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n     {} \\<Longrightarrow>\n     \\<theta> supports \\<I>) &&&\n    (subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n     {} \\<Longrightarrow>\n     \\<delta> supports \\<I>)", "proof -"], ["proof (state)\ngoal (2 subgoals):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n    {} \\<Longrightarrow>\n    \\<theta> supports \\<I>\n 2. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "assume \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\""], ["proof (state)\nthis:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (2 subgoals):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n    {} \\<Longrightarrow>\n    \\<theta> supports \\<I>\n 2. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "hence \"subst_idem \\<theta>\""], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. subst_idem \\<theta>", "by (metis subst_idemI)"], ["proof (state)\nthis:\n  subst_idem \\<theta>\n\ngoal (2 subgoals):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n    {} \\<Longrightarrow>\n    \\<theta> supports \\<I>\n 2. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "have \"\\<theta> \\<preceq>\\<^sub>\\<circ> \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> \\<preceq>\\<^sub>\\<circ> \\<I>", "using assms subst_compose_assoc[of \\<theta> \\<delta> \\<I>]"], ["proof (prove)\nusing this:\n  \\<theta> \\<circ>\\<^sub>s \\<delta> supports \\<I>\n  \\<theta> \\<circ>\\<^sub>s \\<delta> \\<circ>\\<^sub>s \\<I> =\n  \\<theta> \\<circ>\\<^sub>s (\\<delta> \\<circ>\\<^sub>s \\<I>)\n\ngoal (1 subgoal):\n 1. \\<theta> \\<preceq>\\<^sub>\\<circ> \\<I>", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  (\\<lambda>x. \\<theta> x \\<cdot> \\<delta>) supports \\<I>\n  (\\<lambda>x. \\<theta> x \\<cdot> \\<delta> \\<cdot> \\<I>) =\n  (\\<lambda>x. \\<theta> x \\<cdot> (\\<lambda>x. \\<delta> x \\<cdot> \\<I>))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<gamma>. \\<I> = (\\<lambda>x. \\<theta> x \\<cdot> \\<gamma>)", "by metis"], ["proof (state)\nthis:\n  \\<theta> \\<preceq>\\<^sub>\\<circ> \\<I>\n\ngoal (2 subgoals):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n    {} \\<Longrightarrow>\n    \\<theta> supports \\<I>\n 2. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "show \"\\<theta> supports \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> supports \\<I>", "using subst_support_if_mgt_subst_idem[OF \\<open>\\<theta> \\<preceq>\\<^sub>\\<circ> \\<I>\\<close> \\<open>subst_idem \\<theta>\\<close>]"], ["proof (prove)\nusing this:\n  \\<theta> supports \\<I>\n\ngoal (1 subgoal):\n 1. \\<theta> supports \\<I>", "by auto"], ["proof (state)\nthis:\n  \\<theta> supports \\<I>\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "assume \"subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {}\""], ["proof (state)\nthis:\n  subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "moreover"], ["proof (state)\nthis:\n  subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "have \"\\<forall>v \\<in> subst_domain (\\<theta> \\<circ>\\<^sub>s \\<delta>). (\\<theta> \\<circ>\\<^sub>s \\<delta>) v \\<cdot> \\<I> = \\<I> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain (\\<theta> \\<circ>\\<^sub>s \\<delta>).\n       (\\<theta> \\<circ>\\<^sub>s \\<delta>) v \\<cdot> \\<I> = \\<I> v", "using assms"], ["proof (prove)\nusing this:\n  \\<theta> \\<circ>\\<^sub>s \\<delta> supports \\<I>\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain (\\<theta> \\<circ>\\<^sub>s \\<delta>).\n       (\\<theta> \\<circ>\\<^sub>s \\<delta>) v \\<cdot> \\<I> = \\<I> v", "by metis"], ["proof (state)\nthis:\n  \\<forall>v\\<in>subst_domain (\\<theta> \\<circ>\\<^sub>s \\<delta>).\n     (\\<theta> \\<circ>\\<^sub>s \\<delta>) v \\<cdot> \\<I> = \\<I> v\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {}\n  \\<forall>v\\<in>subst_domain (\\<theta> \\<circ>\\<^sub>s \\<delta>).\n     (\\<theta> \\<circ>\\<^sub>s \\<delta>) v \\<cdot> \\<I> = \\<I> v", "have \"\\<forall>v \\<in> subst_domain \\<delta>. \\<delta> v \\<cdot> \\<I> = \\<I> v\""], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {}\n  \\<forall>v\\<in>subst_domain (\\<theta> \\<circ>\\<^sub>s \\<delta>).\n     (\\<theta> \\<circ>\\<^sub>s \\<delta>) v \\<cdot> \\<I> = \\<I> v\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain \\<delta>. \\<delta> v \\<cdot> \\<I> = \\<I> v", "using var_not_in_subst_dom"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {}\n  \\<forall>v\\<in>subst_domain (\\<theta> \\<circ>\\<^sub>s \\<delta>).\n     (\\<theta> \\<circ>\\<^sub>s \\<delta>) v \\<cdot> \\<I> = \\<I> v\n  ?v \\<notin> subst_domain ?s \\<Longrightarrow> ?s ?v = Var ?v\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain \\<delta>. \\<delta> v \\<cdot> \\<I> = \\<I> v", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> subst_domain \\<delta> = {}\n  \\<forall>v\\<in>subst_domain (\\<lambda>x. \\<theta> x \\<cdot> \\<delta>).\n     \\<theta> v \\<cdot> \\<delta> \\<cdot> \\<I> = \\<I> v\n  ?v \\<notin> subst_domain ?s \\<Longrightarrow> ?s ?v = Var ?v\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain \\<delta>. \\<delta> v \\<cdot> \\<I> = \\<I> v", "by (metis IntI empty_iff subst_apply_term.simps(1))"], ["proof (state)\nthis:\n  \\<forall>v\\<in>subst_domain \\<delta>. \\<delta> v \\<cdot> \\<I> = \\<I> v\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> subst_domain \\<delta> =\n    {} \\<Longrightarrow>\n    \\<delta> supports \\<I>", "thus \"\\<delta> supports \\<I>\""], ["proof (prove)\nusing this:\n  \\<forall>v\\<in>subst_domain \\<delta>. \\<delta> v \\<cdot> \\<I> = \\<I> v\n\ngoal (1 subgoal):\n 1. \\<delta> supports \\<I>", "by force"], ["proof (state)\nthis:\n  \\<delta> supports \\<I>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_idem_support: \"subst_idem \\<theta> \\<Longrightarrow> \\<theta> supports \\<theta> \\<circ>\\<^sub>s \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_idem \\<theta> \\<Longrightarrow>\n    \\<theta> supports \\<theta> \\<circ>\\<^sub>s \\<delta>", "unfolding subst_idem_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> \\<circ>\\<^sub>s \\<theta> = \\<theta> \\<Longrightarrow>\n    \\<theta> supports \\<theta> \\<circ>\\<^sub>s \\<delta>", "by (metis subst_support_def subst_compose_assoc)"], ["", "lemma subst_idem_iff_self_support: \"subst_idem \\<theta> \\<longleftrightarrow> \\<theta> supports \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_idem \\<theta> = (\\<theta> supports \\<theta>)", "using subst_support_def[of \\<theta> \\<theta>]"], ["proof (prove)\nusing this:\n  (\\<theta> supports \\<theta>) =\n  (\\<theta> = \\<theta> \\<circ>\\<^sub>s \\<theta>)\n\ngoal (1 subgoal):\n 1. subst_idem \\<theta> = (\\<theta> supports \\<theta>)", "unfolding subst_idem_def"], ["proof (prove)\nusing this:\n  (\\<theta> supports \\<theta>) =\n  (\\<theta> = \\<theta> \\<circ>\\<^sub>s \\<theta>)\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<theta> = \\<theta>) =\n    (\\<theta> supports \\<theta>)", "by auto"], ["", "lemma subterm_subst_neq: \"t \\<sqsubset> t' \\<Longrightarrow> t \\<cdot> s \\<noteq> t' \\<cdot> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<sqsubset> t' \\<Longrightarrow> t \\<cdot> s \\<noteq> t' \\<cdot> s", "by (metis subst_mono_neq)"], ["", "lemma fv_Fun_subst_neq: \"x \\<in> fv (Fun f T) \\<Longrightarrow> \\<sigma> x \\<noteq> Fun f T \\<cdot> \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> fv (Fun f T) \\<Longrightarrow>\n    \\<sigma> x \\<noteq> Fun f T \\<cdot> \\<sigma>", "using subterm_subst_neq[of \"Var x\" \"Fun f T\"] vars_iff_subterm_or_eq[of x \"Fun f T\"]"], ["proof (prove)\nusing this:\n  Var x \\<sqsubset> Fun f T \\<Longrightarrow>\n  Var x \\<cdot> ?s \\<noteq> Fun f T \\<cdot> ?s\n  (x \\<in> fv (Fun f T)) = (Var x \\<sqsubset> Fun f T \\<or> Var x = Fun f T)\n\ngoal (1 subgoal):\n 1. x \\<in> fv (Fun f T) \\<Longrightarrow>\n    \\<sigma> x \\<noteq> Fun f T \\<cdot> \\<sigma>", "by auto"], ["", "lemma subterm_subst_unfold:\n  assumes \"t \\<sqsubseteq> s \\<cdot> \\<theta>\"\n  shows \"(\\<exists>s'. s' \\<sqsubseteq> s \\<and> t = s' \\<cdot> \\<theta>) \\<or> (\\<exists>x \\<in> fv s. t \\<sqsubset> \\<theta> x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<exists>s'. s' \\<sqsubseteq> s \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv s. t \\<sqsubset> \\<theta> x)", "using assms"], ["proof (prove)\nusing this:\n  t \\<sqsubseteq> s \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<exists>s'. s' \\<sqsubseteq> s \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv s. t \\<sqsubset> \\<theta> x)", "proof (induction s)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       t \\<sqsubseteq> Var x \\<cdot> \\<theta> \\<Longrightarrow>\n       (\\<exists>s'.\n           s' \\<sqsubseteq> Var x \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n       (\\<exists>x\\<in>fv (Var x). t \\<sqsubset> \\<theta> x)\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                   \\<Longrightarrow> (\\<exists>s'.\n   s' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                     (\\<exists>x\\<in>fv x2a.\n   t \\<sqsubset> \\<theta> x);\n        t \\<sqsubseteq> Fun x1a x2 \\<cdot> \\<theta>\\<rbrakk>\n       \\<Longrightarrow> (\\<exists>s'.\n                             s' \\<sqsubseteq> Fun x1a x2 \\<and>\n                             t = s' \\<cdot> \\<theta>) \\<or>\n                         (\\<exists>x\\<in>fv (Fun x1a x2).\n                             t \\<sqsubset> \\<theta> x)", "case (Fun f T)"], ["proof (state)\nthis:\n  \\<lbrakk>?x2a \\<in> set T; t \\<sqsubseteq> ?x2a \\<cdot> \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<exists>s'.\n                        s' \\<sqsubseteq> ?x2a \\<and>\n                        t = s' \\<cdot> \\<theta>) \\<or>\n                    (\\<exists>x\\<in>fv ?x2a. t \\<sqsubset> \\<theta> x)\n  t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       t \\<sqsubseteq> Var x \\<cdot> \\<theta> \\<Longrightarrow>\n       (\\<exists>s'.\n           s' \\<sqsubseteq> Var x \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n       (\\<exists>x\\<in>fv (Var x). t \\<sqsubset> \\<theta> x)\n 2. \\<And>x1a x2.\n       \\<lbrakk>\\<And>x2a.\n                   \\<lbrakk>x2a \\<in> set x2;\n                    t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                   \\<Longrightarrow> (\\<exists>s'.\n   s' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                     (\\<exists>x\\<in>fv x2a.\n   t \\<sqsubset> \\<theta> x);\n        t \\<sqsubseteq> Fun x1a x2 \\<cdot> \\<theta>\\<rbrakk>\n       \\<Longrightarrow> (\\<exists>s'.\n                             s' \\<sqsubseteq> Fun x1a x2 \\<and>\n                             t = s' \\<cdot> \\<theta>) \\<or>\n                         (\\<exists>x\\<in>fv (Fun x1a x2).\n                             t \\<sqsubset> \\<theta> x)", "thus ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x2a \\<in> set T; t \\<sqsubseteq> ?x2a \\<cdot> \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<exists>s'.\n                        s' \\<sqsubseteq> ?x2a \\<and>\n                        t = s' \\<cdot> \\<theta>) \\<or>\n                    (\\<exists>x\\<in>fv ?x2a. t \\<sqsubset> \\<theta> x)\n  t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<exists>s'.\n        s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)", "proof (cases \"t = Fun f T \\<cdot> \\<theta>\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t = Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)\n 2. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t \\<noteq> Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)", "case True"], ["proof (state)\nthis:\n  t = Fun f T \\<cdot> \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t = Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)\n 2. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t \\<noteq> Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)", "thus ?thesis"], ["proof (prove)\nusing this:\n  t = Fun f T \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<exists>s'.\n        s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)", "using Fun"], ["proof (prove)\nusing this:\n  t = Fun f T \\<cdot> \\<theta>\n  \\<lbrakk>?x2a \\<in> set T; t \\<sqsubseteq> ?x2a \\<cdot> \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<exists>s'.\n                        s' \\<sqsubseteq> ?x2a \\<and>\n                        t = s' \\<cdot> \\<theta>) \\<or>\n                    (\\<exists>x\\<in>fv ?x2a. t \\<sqsubset> \\<theta> x)\n  t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<exists>s'.\n        s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)", "by auto"], ["proof (state)\nthis:\n  (\\<exists>s'.\n      s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n  (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t \\<noteq> Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t \\<noteq> Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)", "case False"], ["proof (state)\nthis:\n  t \\<noteq> Fun f T \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t \\<noteq> Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)", "then"], ["proof (chain)\npicking this:\n  t \\<noteq> Fun f T \\<cdot> \\<theta>", "obtain s' where s': \"s' \\<in> set T\" \"t \\<sqsubseteq> s' \\<cdot> \\<theta>\""], ["proof (prove)\nusing this:\n  t \\<noteq> Fun f T \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>s'.\n        \\<lbrakk>s' \\<in> set T;\n         t \\<sqsubseteq> s' \\<cdot> \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using Fun"], ["proof (prove)\nusing this:\n  t \\<noteq> Fun f T \\<cdot> \\<theta>\n  \\<lbrakk>?x2a \\<in> set T; t \\<sqsubseteq> ?x2a \\<cdot> \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<exists>s'.\n                        s' \\<sqsubseteq> ?x2a \\<and>\n                        t = s' \\<cdot> \\<theta>) \\<or>\n                    (\\<exists>x\\<in>fv ?x2a. t \\<sqsubset> \\<theta> x)\n  t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>s'.\n        \\<lbrakk>s' \\<in> set T;\n         t \\<sqsubseteq> s' \\<cdot> \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  s' \\<in> set T\n  t \\<sqsubseteq> s' \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t \\<noteq> Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)", "hence \"(\\<exists>s''. s'' \\<sqsubseteq> s' \\<and> t = s'' \\<cdot> \\<theta>) \\<or> (\\<exists>x \\<in> fv s'. t \\<sqsubset> \\<theta> x)\""], ["proof (prove)\nusing this:\n  s' \\<in> set T\n  t \\<sqsubseteq> s' \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<exists>s''.\n        s'' \\<sqsubseteq> s' \\<and> t = s'' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv s'. t \\<sqsubset> \\<theta> x)", "by (metis Fun.IH)"], ["proof (state)\nthis:\n  (\\<exists>s''. s'' \\<sqsubseteq> s' \\<and> t = s'' \\<cdot> \\<theta>) \\<or>\n  (\\<exists>x\\<in>fv s'. t \\<sqsubset> \\<theta> x)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x2a.\n                \\<lbrakk>x2a \\<in> set T;\n                 t \\<sqsubseteq> x2a \\<cdot> \\<theta>\\<rbrakk>\n                \\<Longrightarrow> (\\<exists>s'.\ns' \\<sqsubseteq> x2a \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n                                  (\\<exists>x\\<in>fv x2a.\nt \\<sqsubset> \\<theta> x);\n     t \\<sqsubseteq> Fun f T \\<cdot> \\<theta>;\n     t \\<noteq> Fun f T \\<cdot> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>s'.\n                          s' \\<sqsubseteq> Fun f T \\<and>\n                          t = s' \\<cdot> \\<theta>) \\<or>\n                      (\\<exists>x\\<in>fv (Fun f T).\n                          t \\<sqsubset> \\<theta> x)", "thus ?thesis"], ["proof (prove)\nusing this:\n  (\\<exists>s''. s'' \\<sqsubseteq> s' \\<and> t = s'' \\<cdot> \\<theta>) \\<or>\n  (\\<exists>x\\<in>fv s'. t \\<sqsubset> \\<theta> x)\n\ngoal (1 subgoal):\n 1. (\\<exists>s'.\n        s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)", "using s'(1)"], ["proof (prove)\nusing this:\n  (\\<exists>s''. s'' \\<sqsubseteq> s' \\<and> t = s'' \\<cdot> \\<theta>) \\<or>\n  (\\<exists>x\\<in>fv s'. t \\<sqsubset> \\<theta> x)\n  s' \\<in> set T\n\ngoal (1 subgoal):\n 1. (\\<exists>s'.\n        s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n    (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)", "by auto"], ["proof (state)\nthis:\n  (\\<exists>s'.\n      s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n  (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (\\<exists>s'.\n      s' \\<sqsubseteq> Fun f T \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n  (\\<exists>x\\<in>fv (Fun f T). t \\<sqsubset> \\<theta> x)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       t \\<sqsubseteq> Var x \\<cdot> \\<theta> \\<Longrightarrow>\n       (\\<exists>s'.\n           s' \\<sqsubseteq> Var x \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n       (\\<exists>x\\<in>fv (Var x). t \\<sqsubset> \\<theta> x)", "qed simp"], ["", "lemma subterm_subst_img_subterm:\n  assumes \"t \\<sqsubseteq> s \\<cdot> \\<theta>\" \"\\<And>s'. s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> s' \\<cdot> \\<theta>\"\n  shows \"\\<exists>w \\<in> fv s. t \\<sqsubset> \\<theta> w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>w\\<in>fv s. t \\<sqsubset> \\<theta> w", "using subterm_subst_unfold[OF assms(1)] assms(2)"], ["proof (prove)\nusing this:\n  (\\<exists>s'. s' \\<sqsubseteq> s \\<and> t = s' \\<cdot> \\<theta>) \\<or>\n  (\\<exists>x\\<in>fv s. t \\<sqsubset> \\<theta> x)\n  ?s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> ?s' \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. \\<exists>w\\<in>fv s. t \\<sqsubset> \\<theta> w", "by force"], ["", "lemma subterm_subst_not_img_subterm:\n  assumes \"t \\<sqsubseteq> s \\<cdot> \\<I>\" \"\\<not>(\\<exists>w \\<in> fv s. t \\<sqsubseteq> \\<I> w)\"\n  shows \"\\<exists>f T. Fun f T \\<sqsubseteq> s \\<and> t = Fun f T \\<cdot> \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>f T. Fun f T \\<sqsubseteq> s \\<and> t = Fun f T \\<cdot> \\<I>", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<nexists>f T.\n       Fun f T \\<sqsubseteq> s \\<and>\n       t = Fun f T \\<cdot> \\<I> \\<Longrightarrow>\n    False", "assume \"\\<not>(\\<exists>f T. Fun f T \\<sqsubseteq> s \\<and> t = Fun f T \\<cdot> \\<I>)\""], ["proof (state)\nthis:\n  \\<nexists>f T. Fun f T \\<sqsubseteq> s \\<and> t = Fun f T \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<nexists>f T.\n       Fun f T \\<sqsubseteq> s \\<and>\n       t = Fun f T \\<cdot> \\<I> \\<Longrightarrow>\n    False", "hence \"\\<And>f T. Fun f T \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> Fun f T \\<cdot> \\<I>\""], ["proof (prove)\nusing this:\n  \\<nexists>f T. Fun f T \\<sqsubseteq> s \\<and> t = Fun f T \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq> s \\<Longrightarrow>\n       t \\<noteq> Fun f T \\<cdot> \\<I>", "by simp"], ["proof (state)\nthis:\n  Fun ?f ?T \\<sqsubseteq> s \\<Longrightarrow>\n  t \\<noteq> Fun ?f ?T \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<nexists>f T.\n       Fun f T \\<sqsubseteq> s \\<and>\n       t = Fun f T \\<cdot> \\<I> \\<Longrightarrow>\n    False", "moreover"], ["proof (state)\nthis:\n  Fun ?f ?T \\<sqsubseteq> s \\<Longrightarrow>\n  t \\<noteq> Fun ?f ?T \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<nexists>f T.\n       Fun f T \\<sqsubseteq> s \\<and>\n       t = Fun f T \\<cdot> \\<I> \\<Longrightarrow>\n    False", "have \"\\<And>x. Var x \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> Var x \\<cdot> \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x.\n       Var x \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> Var x \\<cdot> \\<I>", "using assms(2) vars_iff_subtermeq"], ["proof (prove)\nusing this:\n  \\<not> (\\<exists>w\\<in>fv s. t \\<sqsubseteq> \\<I> w)\n  (?x \\<in> fv ?t) = (Var ?x \\<sqsubseteq> ?t)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       Var x \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> Var x \\<cdot> \\<I>", "by force"], ["proof (state)\nthis:\n  Var ?x \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> Var ?x \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<nexists>f T.\n       Fun f T \\<sqsubseteq> s \\<and>\n       t = Fun f T \\<cdot> \\<I> \\<Longrightarrow>\n    False", "ultimately"], ["proof (chain)\npicking this:\n  Fun ?f ?T \\<sqsubseteq> s \\<Longrightarrow>\n  t \\<noteq> Fun ?f ?T \\<cdot> \\<I>\n  Var ?x \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> Var ?x \\<cdot> \\<I>", "have \"\\<And>s'. s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> s' \\<cdot> \\<I>\""], ["proof (prove)\nusing this:\n  Fun ?f ?T \\<sqsubseteq> s \\<Longrightarrow>\n  t \\<noteq> Fun ?f ?T \\<cdot> \\<I>\n  Var ?x \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> Var ?x \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<And>s'.\n       s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> s' \\<cdot> \\<I>", "by (metis \"term.exhaust\")"], ["proof (state)\nthis:\n  ?s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> ?s' \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<nexists>f T.\n       Fun f T \\<sqsubseteq> s \\<and>\n       t = Fun f T \\<cdot> \\<I> \\<Longrightarrow>\n    False", "thus False"], ["proof (prove)\nusing this:\n  ?s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> ?s' \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. False", "using assms subterm_subst_img_subterm"], ["proof (prove)\nusing this:\n  ?s' \\<sqsubseteq> s \\<Longrightarrow> t \\<noteq> ?s' \\<cdot> \\<I>\n  t \\<sqsubseteq> s \\<cdot> \\<I>\n  \\<not> (\\<exists>w\\<in>fv s. t \\<sqsubseteq> \\<I> w)\n  \\<lbrakk>?t \\<sqsubseteq> ?s \\<cdot> ?\\<theta>;\n   \\<And>s'.\n      s' \\<sqsubseteq> ?s \\<Longrightarrow>\n      ?t \\<noteq> s' \\<cdot> ?\\<theta>\\<rbrakk>\n  \\<Longrightarrow> \\<exists>w\\<in>fv ?s. ?t \\<sqsubset> ?\\<theta> w\n\ngoal (1 subgoal):\n 1. False", "by blast"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_apply_img_var:\n  assumes \"v \\<in> fv (t \\<cdot> \\<delta>)\" \"v \\<notin> fv t\"\n  obtains w where \"w \\<in> fv t\" \"v \\<in> fv (\\<delta> w)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>w.\n        \\<lbrakk>w \\<in> fv t; v \\<in> fv (\\<delta> w)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using assms"], ["proof (prove)\nusing this:\n  v \\<in> fv (t \\<cdot> \\<delta>)\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. (\\<And>w.\n        \\<lbrakk>w \\<in> fv t; v \\<in> fv (\\<delta> w)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (induct t) auto"], ["", "lemma subst_apply_img_var':\n  assumes \"x \\<in> fv (t \\<cdot> \\<delta>)\" \"x \\<notin> fv t\"\n  shows \"\\<exists>y \\<in> fv t. x \\<in> fv (\\<delta> y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv t. x \\<in> fv (\\<delta> y)", "by (metis assms subst_apply_img_var)"], ["", "lemma nth_map_subst:\n  fixes \\<theta>::\"('f,'v) subst\" and T::\"('f,'v) term list\" and i::nat\n  shows \"i < length T \\<Longrightarrow> (map (\\<lambda>t. t \\<cdot> \\<theta>) T) ! i = (T ! i) \\<cdot> \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. i < length T \\<Longrightarrow>\n    (T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>) ! i =\n    T ! i \\<cdot> \\<theta>", "by (fact nth_map)"], ["", "lemma subst_subterm:\n  assumes \"Fun f T \\<sqsubseteq> t \\<cdot> \\<theta>\"\n  shows \"(\\<exists>S. Fun f S \\<sqsubseteq> t \\<and> Fun f S \\<cdot> \\<theta> = Fun f T) \\<or>\n         (\\<exists>s \\<in> subst_range \\<theta>. Fun f T \\<sqsubseteq> s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<exists>S.\n        Fun f S \\<sqsubseteq> t \\<and>\n        Fun f S \\<cdot> \\<theta> = Fun f T) \\<or>\n    (\\<exists>s\\<in>subst_range \\<theta>. Fun f T \\<sqsubseteq> s)", "using assms subterm_subst_not_img_subterm"], ["proof (prove)\nusing this:\n  Fun f T \\<sqsubseteq> t \\<cdot> \\<theta>\n  \\<lbrakk>?t \\<sqsubseteq> ?s \\<cdot> ?\\<I>;\n   \\<not> (\\<exists>w\\<in>fv ?s. ?t \\<sqsubseteq> ?\\<I> w)\\<rbrakk>\n  \\<Longrightarrow> \\<exists>f T.\n                       Fun f T \\<sqsubseteq> ?s \\<and>\n                       ?t = Fun f T \\<cdot> ?\\<I>\n\ngoal (1 subgoal):\n 1. (\\<exists>S.\n        Fun f S \\<sqsubseteq> t \\<and>\n        Fun f S \\<cdot> \\<theta> = Fun f T) \\<or>\n    (\\<exists>s\\<in>subst_range \\<theta>. Fun f T \\<sqsubseteq> s)", "by (cases \"\\<exists>s \\<in> subst_range \\<theta>. Fun f T \\<sqsubseteq> s\") fastforce+"], ["", "lemma subst_subterm':\n  assumes \"Fun f T \\<sqsubseteq> t \\<cdot> \\<theta>\"\n  shows \"\\<exists>S. length S = length T \\<and> (Fun f S \\<sqsubseteq> t \\<or> (\\<exists>s \\<in> subst_range \\<theta>. Fun f S \\<sqsubseteq> s))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>S.\n       length S = length T \\<and>\n       (Fun f S \\<sqsubseteq> t \\<or>\n        (\\<exists>s\\<in>subst_range \\<theta>. Fun f S \\<sqsubseteq> s))", "using subst_subterm[OF assms]"], ["proof (prove)\nusing this:\n  (\\<exists>S.\n      Fun f S \\<sqsubseteq> t \\<and>\n      Fun f S \\<cdot> \\<theta> = Fun f T) \\<or>\n  (\\<exists>s\\<in>subst_range \\<theta>. Fun f T \\<sqsubseteq> s)\n\ngoal (1 subgoal):\n 1. \\<exists>S.\n       length S = length T \\<and>\n       (Fun f S \\<sqsubseteq> t \\<or>\n        (\\<exists>s\\<in>subst_range \\<theta>. Fun f S \\<sqsubseteq> s))", "by auto"], ["", "lemma subst_subterm'':\n  assumes \"s \\<in> subterms (t \\<cdot> \\<theta>)\"\n  shows \"(\\<exists>u \\<in> subterms t. s = u \\<cdot> \\<theta>) \\<or> s \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n    s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "proof (cases s)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x1.\n       s = Var x1 \\<Longrightarrow>\n       (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n       s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>\n 2. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n       s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "case (Var x)"], ["proof (state)\nthis:\n  s = Var x\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       s = Var x1 \\<Longrightarrow>\n       (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n       s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>\n 2. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n       s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "thus ?thesis"], ["proof (prove)\nusing this:\n  s = Var x\n\ngoal (1 subgoal):\n 1. (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n    s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "using assms subterm_subst_not_img_subterm vars_iff_subtermeq"], ["proof (prove)\nusing this:\n  s = Var x\n  s \\<sqsubseteq> t \\<cdot> \\<theta>\n  \\<lbrakk>?t \\<sqsubseteq> ?s \\<cdot> ?\\<I>;\n   \\<not> (\\<exists>w\\<in>fv ?s. ?t \\<sqsubseteq> ?\\<I> w)\\<rbrakk>\n  \\<Longrightarrow> \\<exists>f T.\n                       Fun f T \\<sqsubseteq> ?s \\<and>\n                       ?t = Fun f T \\<cdot> ?\\<I>\n  (?x \\<in> fv ?t) = (Var ?x \\<sqsubseteq> ?t)\n\ngoal (1 subgoal):\n 1. (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n    s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "by (cases \"s = t \\<cdot> \\<theta>\") fastforce+"], ["proof (state)\nthis:\n  (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n  s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n       s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n       s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "case (Fun f T)"], ["proof (state)\nthis:\n  s = Fun f T\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       s = Fun x21 x22 \\<Longrightarrow>\n       (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n       s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "thus ?thesis"], ["proof (prove)\nusing this:\n  s = Fun f T\n\ngoal (1 subgoal):\n 1. (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n    s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "using subst_subterm[of f T t \\<theta>] assms"], ["proof (prove)\nusing this:\n  s = Fun f T\n  Fun f T \\<sqsubseteq> t \\<cdot> \\<theta> \\<Longrightarrow>\n  (\\<exists>S.\n      Fun f S \\<sqsubseteq> t \\<and>\n      Fun f S \\<cdot> \\<theta> = Fun f T) \\<or>\n  (\\<exists>s\\<in>subst_range \\<theta>. Fun f T \\<sqsubseteq> s)\n  s \\<sqsubseteq> t \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n    s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>", "by fastforce"], ["proof (state)\nthis:\n  (\\<exists>u\\<in>subterms t. s = u \\<cdot> \\<theta>) \\<or>\n  s \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \\<open>More Small Lemmata\\<close>"], ["", "lemma funs_term_subst: \"funs_term (t \\<cdot> \\<theta>) = funs_term t \\<union> (\\<Union>x \\<in> fv t. funs_term (\\<theta> x))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. funs_term (t \\<cdot> \\<theta>) =\n    funs_term t \\<union> (\\<Union>x\\<in>fv t. funs_term (\\<theta> x))", "by (induct t) auto"], ["", "lemma fv\\<^sub>s\\<^sub>e\\<^sub>t_subst_img_eq:\n  assumes \"X \\<inter> (subst_domain \\<delta> \\<union> range_vars \\<delta>) = {}\"\n  shows \"fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (Y - X)) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` Y) - X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (Y - X)) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` Y) - X", "using assms"], ["proof (prove)\nusing this:\n  X \\<inter> (subst_domain \\<delta> \\<union> range_vars \\<delta>) = {}\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (Y - X)) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` Y) - X", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  X \\<inter>\n  (subst_domain \\<delta> \\<union>\n   fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)) =\n  {}\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` (Y - X)) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` Y) - X", "by force"], ["", "lemma subst_Fun_index_eq:\n  assumes \"i < length T\" \"Fun f T \\<cdot> \\<delta> = Fun g T' \\<cdot> \\<delta>\"\n  shows \"T ! i \\<cdot> \\<delta> = T' ! i \\<cdot> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> = T' ! i \\<cdot> \\<delta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> = T' ! i \\<cdot> \\<delta>", "have \"map (\\<lambda>x. x \\<cdot> \\<delta>) T = map (\\<lambda>x. x \\<cdot> \\<delta>) T'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> =\n    T' \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "using assms"], ["proof (prove)\nusing this:\n  i < length T\n  Fun f T \\<cdot> \\<delta> = Fun g T' \\<cdot> \\<delta>\n\ngoal (1 subgoal):\n 1. T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> =\n    T' \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>", "by simp"], ["proof (state)\nthis:\n  T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> =\n  T' \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> = T' ! i \\<cdot> \\<delta>", "thus ?thesis"], ["proof (prove)\nusing this:\n  T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> =\n  T' \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (1 subgoal):\n 1. T ! i \\<cdot> \\<delta> = T' ! i \\<cdot> \\<delta>", "by (metis assms(1) length_map nth_map)"], ["proof (state)\nthis:\n  T ! i \\<cdot> \\<delta> = T' ! i \\<cdot> \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma fv_exists_if_unifiable_and_neq:\n  fixes t t'::\"('a,'b) term\" and \\<delta> \\<theta>::\"('a,'b) subst\"\n  assumes \"t \\<noteq> t'\" \"t \\<cdot> \\<theta> = t' \\<cdot> \\<theta>\"\n  shows \"fv t \\<union> fv t' \\<noteq> {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<union> fv t' \\<noteq> {}", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. fv t \\<union> fv t' = {} \\<Longrightarrow> False", "assume \"fv t \\<union> fv t' = {}\""], ["proof (state)\nthis:\n  fv t \\<union> fv t' = {}\n\ngoal (1 subgoal):\n 1. fv t \\<union> fv t' = {} \\<Longrightarrow> False", "hence \"fv t = {}\" \"fv t' = {}\""], ["proof (prove)\nusing this:\n  fv t \\<union> fv t' = {}\n\ngoal (1 subgoal):\n 1. fv t = {} &&& fv t' = {}", "by auto"], ["proof (state)\nthis:\n  fv t = {}\n  fv t' = {}\n\ngoal (1 subgoal):\n 1. fv t \\<union> fv t' = {} \\<Longrightarrow> False", "hence \"t \\<cdot> \\<theta> = t\" \"t' \\<cdot> \\<theta> = t'\""], ["proof (prove)\nusing this:\n  fv t = {}\n  fv t' = {}\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> = t &&& t' \\<cdot> \\<theta> = t'", "by auto"], ["proof (state)\nthis:\n  t \\<cdot> \\<theta> = t\n  t' \\<cdot> \\<theta> = t'\n\ngoal (1 subgoal):\n 1. fv t \\<union> fv t' = {} \\<Longrightarrow> False", "hence \"t = t'\""], ["proof (prove)\nusing this:\n  t \\<cdot> \\<theta> = t\n  t' \\<cdot> \\<theta> = t'\n\ngoal (1 subgoal):\n 1. t = t'", "using assms(2)"], ["proof (prove)\nusing this:\n  t \\<cdot> \\<theta> = t\n  t' \\<cdot> \\<theta> = t'\n  t \\<cdot> \\<theta> = t' \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. t = t'", "by metis"], ["proof (state)\nthis:\n  t = t'\n\ngoal (1 subgoal):\n 1. fv t \\<union> fv t' = {} \\<Longrightarrow> False", "thus False"], ["proof (prove)\nusing this:\n  t = t'\n\ngoal (1 subgoal):\n 1. False", "using assms(1)"], ["proof (prove)\nusing this:\n  t = t'\n  t \\<noteq> t'\n\ngoal (1 subgoal):\n 1. False", "by auto"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma const_subterm_subst: \"Fun c [] \\<sqsubseteq> t \\<Longrightarrow> Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>", "by (induct t) auto"], ["", "lemma const_subterm_subst_var_obtain:\n  assumes \"Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>\" \"\\<not>Fun c [] \\<sqsubseteq> t\"\n  obtains x where \"x \\<in> fv t\" \"Fun c [] \\<sqsubseteq> \\<sigma> x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> fv t; Fun c [] \\<sqsubseteq> \\<sigma> x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using assms"], ["proof (prove)\nusing this:\n  Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>\n  Fun c [] \\<notin> subterms t\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> fv t; Fun c [] \\<sqsubseteq> \\<sigma> x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (induct t) auto"], ["", "lemma const_subterm_subst_cases:\n  assumes \"Fun c [] \\<sqsubseteq> t \\<cdot> \\<sigma>\"\n  shows \"Fun c [] \\<sqsubseteq> t \\<or> (\\<exists>x \\<in> fv t. x \\<in> subst_domain \\<sigma> \\<and> Fun c [] \\<sqsubseteq> \\<sigma> x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)", "proof (cases \"Fun c [] \\<sqsubseteq> t\")"], ["proof (state)\ngoal (2 subgoals):\n 1. Fun c [] \\<sqsubseteq> t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)\n 2. Fun c [] \\<notin> subterms t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)", "case False"], ["proof (state)\nthis:\n  Fun c [] \\<notin> subterms t\n\ngoal (2 subgoals):\n 1. Fun c [] \\<sqsubseteq> t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)\n 2. Fun c [] \\<notin> subterms t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)", "then"], ["proof (chain)\npicking this:\n  Fun c [] \\<notin> subterms t", "obtain x where \"x \\<in> fv t\" \"Fun c [] \\<sqsubseteq> \\<sigma> x\""], ["proof (prove)\nusing this:\n  Fun c [] \\<notin> subterms t\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> fv t; Fun c [] \\<sqsubseteq> \\<sigma> x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using const_subterm_subst_var_obtain[OF assms]"], ["proof (prove)\nusing this:\n  Fun c [] \\<notin> subterms t\n  \\<lbrakk>Fun c [] \\<notin> subterms t;\n   \\<And>x.\n      \\<lbrakk>x \\<in> fv t; Fun c [] \\<sqsubseteq> \\<sigma> x\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in> fv t; Fun c [] \\<sqsubseteq> \\<sigma> x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  x \\<in> fv t\n  Fun c [] \\<sqsubseteq> \\<sigma> x\n\ngoal (2 subgoals):\n 1. Fun c [] \\<sqsubseteq> t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)\n 2. Fun c [] \\<notin> subterms t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)", "thus ?thesis"], ["proof (prove)\nusing this:\n  x \\<in> fv t\n  Fun c [] \\<sqsubseteq> \\<sigma> x\n\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)", "by (cases \"x \\<in> subst_domain \\<sigma>\") auto"], ["proof (state)\nthis:\n  Fun c [] \\<sqsubseteq> t \\<or>\n  (\\<exists>x\\<in>fv t.\n      x \\<in> subst_domain \\<sigma> \\<and>\n      Fun c [] \\<sqsubseteq> \\<sigma> x)\n\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> t \\<Longrightarrow>\n    Fun c [] \\<sqsubseteq> t \\<or>\n    (\\<exists>x\\<in>fv t.\n        x \\<in> subst_domain \\<sigma> \\<and>\n        Fun c [] \\<sqsubseteq> \\<sigma> x)", "qed simp"], ["", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst_fv_subset:\n  assumes \"x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\"\n  shows \"fv (\\<theta> x) \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "proof (induction F)"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [] \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)\n 2. \\<And>a F.\n       \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                         F \\<Longrightarrow>\n                fv (\\<theta> x)\n                \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                             (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                              \\<theta>);\n        x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\\<rbrakk>\n       \\<Longrightarrow> fv (\\<theta> x)\n                         \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)", "case (Cons f F)"], ["proof (state)\nthis:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<Longrightarrow>\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F)\n\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [] \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)\n 2. \\<And>a F.\n       \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                         F \\<Longrightarrow>\n                fv (\\<theta> x)\n                \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                             (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                              \\<theta>);\n        x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\\<rbrakk>\n       \\<Longrightarrow> fv (\\<theta> x)\n                         \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)", "then"], ["proof (chain)\npicking this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<Longrightarrow>\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F)", "obtain t t' where f: \"f = (t,t')\""], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<Longrightarrow>\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F)\n\ngoal (1 subgoal):\n 1. (\\<And>t t'. f = (t, t') \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis surj_pair)"], ["proof (state)\nthis:\n  f = (t, t')\n\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [] \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)\n 2. \\<And>a F.\n       \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                         F \\<Longrightarrow>\n                fv (\\<theta> x)\n                \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                             (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                              \\<theta>);\n        x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\\<rbrakk>\n       \\<Longrightarrow> fv (\\<theta> x)\n                         \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "proof (cases \"x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\")"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)\n 2. x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "case True"], ["proof (state)\nthis:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)\n 2. x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "using Cons.IH"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<Longrightarrow>\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "unfolding subst_apply_pairs_def"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<Longrightarrow>\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (map (\\<lambda>f. f \\<cdot>\\<^sub>p \\<theta>) F)\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (map (\\<lambda>f. f \\<cdot>\\<^sub>p \\<theta>) (f # F))", "by auto"], ["proof (state)\nthis:\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                \\<theta>)\n\ngoal (1 subgoal):\n 1. x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "case False"], ["proof (state)\nthis:\n  x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n\ngoal (1 subgoal):\n 1. x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "hence \"x \\<in> fv t \\<union> fv t'\""], ["proof (prove)\nusing this:\n  x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n\ngoal (1 subgoal):\n 1. x \\<in> fv t \\<union> fv t'", "using Cons.prems f"], ["proof (prove)\nusing this:\n  x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F)\n  f = (t, t')\n\ngoal (1 subgoal):\n 1. x \\<in> fv t \\<union> fv t'", "by simp"], ["proof (state)\nthis:\n  x \\<in> fv t \\<union> fv t'\n\ngoal (1 subgoal):\n 1. x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "hence \"fv (\\<theta> x) \\<subseteq> fv (t \\<cdot> \\<theta>) \\<union> fv (t' \\<cdot> \\<theta>)\""], ["proof (prove)\nusing this:\n  x \\<in> fv t \\<union> fv t'\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv (t \\<cdot> \\<theta>) \\<union> fv (t' \\<cdot> \\<theta>)", "using fv_subst_subset[of x]"], ["proof (prove)\nusing this:\n  x \\<in> fv t \\<union> fv t'\n  x \\<in> fv ?t \\<Longrightarrow>\n  fv (?\\<theta> x) \\<subseteq> fv (?t \\<cdot> ?\\<theta>)\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv (t \\<cdot> \\<theta>) \\<union> fv (t' \\<cdot> \\<theta>)", "by force"], ["proof (state)\nthis:\n  fv (\\<theta> x)\n  \\<subseteq> fv (t \\<cdot> \\<theta>) \\<union> fv (t' \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                F \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  fv (\\<theta> x)\n  \\<subseteq> fv (t \\<cdot> \\<theta>) \\<union> fv (t' \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "using f"], ["proof (prove)\nusing this:\n  fv (\\<theta> x)\n  \\<subseteq> fv (t \\<cdot> \\<theta>) \\<union> fv (t' \\<cdot> \\<theta>)\n  f = (t, t')\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "unfolding subst_apply_pairs_def"], ["proof (prove)\nusing this:\n  fv (\\<theta> x)\n  \\<subseteq> fv (t \\<cdot> \\<theta>) \\<union> fv (t' \\<cdot> \\<theta>)\n  f = (t, t')\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (map (\\<lambda>f. f \\<cdot>\\<^sub>p \\<theta>) (f # F))", "by auto"], ["proof (state)\nthis:\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                \\<theta>)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  fv (\\<theta> x)\n  \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                \\<theta>)\n\ngoal (1 subgoal):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [] \\<Longrightarrow>\n    fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<theta>)", "qed simp"], ["", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_step_subst: \"fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) = fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) =\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "proof (induction F)"], ["proof (state)\ngoal (2 subgoals):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []) =\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n 2. \\<And>a F.\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) =\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         \\<delta>) \\<Longrightarrow>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)) =\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "case (Cons f F)"], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) =\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (2 subgoals):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []) =\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n 2. \\<And>a F.\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) =\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         \\<delta>) \\<Longrightarrow>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)) =\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "obtain t t' where \"f = (t,t')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t t'. f = (t, t') \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  f = (t, t')\n\ngoal (2 subgoals):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []) =\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n 2. \\<And>a F.\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) =\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         \\<delta>) \\<Longrightarrow>\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)) =\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "thus ?case"], ["proof (prove)\nusing this:\n  f = (t, t')\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F)) =\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "using Cons"], ["proof (prove)\nusing this:\n  f = (t, t')\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) =\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F)) =\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "by (simp add: subst_apply_pairs_def subst_apply_fv_unfold)"], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F)) =\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<delta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []) =\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "qed (simp_all add: subst_apply_pairs_def)"], ["", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst_obtain_var:\n  fixes \\<delta>::\"('a,'b) subst\"\n  assumes \"x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\"\n  shows \"\\<exists>y \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F. x \\<in> fv (\\<delta> y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n       x \\<in> fv (\\<delta> y)", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n       x \\<in> fv (\\<delta> y)", "proof (induction F)"], ["proof (state)\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n             ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              \\<delta>) \\<Longrightarrow>\n    \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [].\n       x \\<in> fv (\\<delta> y)\n 2. \\<And>a F.\n       \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                         (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                          \\<delta>) \\<Longrightarrow>\n                \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                   x \\<in> fv (\\<delta> y);\n        x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (a # F).\n                            x \\<in> fv (\\<delta> y)", "case (Cons f F)"], ["proof (state)\nthis:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n            \\<delta>) \\<Longrightarrow>\n  \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n     x \\<in> fv (\\<delta> y)\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n             ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              \\<delta>) \\<Longrightarrow>\n    \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [].\n       x \\<in> fv (\\<delta> y)\n 2. \\<And>a F.\n       \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                         (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                          \\<delta>) \\<Longrightarrow>\n                \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                   x \\<in> fv (\\<delta> y);\n        x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (a # F).\n                            x \\<in> fv (\\<delta> y)", "then"], ["proof (chain)\npicking this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n            \\<delta>) \\<Longrightarrow>\n  \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n     x \\<in> fv (\\<delta> y)\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)", "obtain t s where f: \"f = (t,s)\""], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n            \\<delta>) \\<Longrightarrow>\n  \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n     x \\<in> fv (\\<delta> y)\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (1 subgoal):\n 1. (\\<And>t s. f = (t, s) \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis surj_pair)"], ["proof (state)\nthis:\n  f = (t, s)\n\ngoal (2 subgoals):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n             ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              \\<delta>) \\<Longrightarrow>\n    \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [].\n       x \\<in> fv (\\<delta> y)\n 2. \\<And>a F.\n       \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                         (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                          \\<delta>) \\<Longrightarrow>\n                \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                   x \\<in> fv (\\<delta> y);\n        x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (a # F).\n                            x \\<in> fv (\\<delta> y)", "from Cons.IH"], ["proof (chain)\npicking this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n            \\<delta>) \\<Longrightarrow>\n  \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n     x \\<in> fv (\\<delta> y)", "show ?case"], ["proof (prove)\nusing this:\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n            \\<delta>) \\<Longrightarrow>\n  \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n     x \\<in> fv (\\<delta> y)\n\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F).\n       x \\<in> fv (\\<delta> y)", "proof (cases \"x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)\n 2. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)", "case False"], ["proof (state)\nthis:\n  x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)\n 2. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)", "hence \"x \\<in> fv (t \\<cdot> \\<delta>) \\<or> x \\<in> fv (s \\<cdot> \\<delta>)\""], ["proof (prove)\nusing this:\n  x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (1 subgoal):\n 1. x \\<in> fv (t \\<cdot> \\<delta>) \\<or> x \\<in> fv (s \\<cdot> \\<delta>)", "using f Cons.prems"], ["proof (prove)\nusing this:\n  x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n  f = (t, s)\n  x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n           (f # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n\ngoal (1 subgoal):\n 1. x \\<in> fv (t \\<cdot> \\<delta>) \\<or> x \\<in> fv (s \\<cdot> \\<delta>)", "by (simp add: subst_apply_pairs_def)"], ["proof (state)\nthis:\n  x \\<in> fv (t \\<cdot> \\<delta>) \\<or> x \\<in> fv (s \\<cdot> \\<delta>)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)\n 2. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)", "hence \"(\\<exists>y \\<in> fv t. x \\<in> fv (\\<delta> y)) \\<or> (\\<exists>y \\<in> fv s. x \\<in> fv (\\<delta> y))\""], ["proof (prove)\nusing this:\n  x \\<in> fv (t \\<cdot> \\<delta>) \\<or> x \\<in> fv (s \\<cdot> \\<delta>)\n\ngoal (1 subgoal):\n 1. (\\<exists>y\\<in>fv t. x \\<in> fv (\\<delta> y)) \\<or>\n    (\\<exists>y\\<in>fv s. x \\<in> fv (\\<delta> y))", "by (metis fv_subst_obtain_var)"], ["proof (state)\nthis:\n  (\\<exists>y\\<in>fv t. x \\<in> fv (\\<delta> y)) \\<or>\n  (\\<exists>y\\<in>fv s. x \\<in> fv (\\<delta> y))\n\ngoal (2 subgoals):\n 1. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)\n 2. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<notin> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)", "thus ?thesis"], ["proof (prove)\nusing this:\n  (\\<exists>y\\<in>fv t. x \\<in> fv (\\<delta> y)) \\<or>\n  (\\<exists>y\\<in>fv s. x \\<in> fv (\\<delta> y))\n\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F).\n       x \\<in> fv (\\<delta> y)", "using f"], ["proof (prove)\nusing this:\n  (\\<exists>y\\<in>fv t. x \\<in> fv (\\<delta> y)) \\<or>\n  (\\<exists>y\\<in>fv s. x \\<in> fv (\\<delta> y))\n  f = (t, s)\n\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F).\n       x \\<in> fv (\\<delta> y)", "by (auto simp add: subst_apply_pairs_def)"], ["proof (state)\nthis:\n  \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F).\n     x \\<in> fv (\\<delta> y)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                      (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                       \\<delta>) \\<Longrightarrow>\n             \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F.\n                x \\<in> fv (\\<delta> y);\n     x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n               \\<delta>)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n(f # F).\n                         x \\<in> fv (\\<delta> y)", "qed (auto simp add: Cons.IH)"], ["proof (state)\nthis:\n  \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (f # F).\n     x \\<in> fv (\\<delta> y)\n\ngoal (1 subgoal):\n 1. x \\<in> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n             ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n              \\<delta>) \\<Longrightarrow>\n    \\<exists>y\\<in>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [].\n       x \\<in> fv (\\<delta> y)", "qed (simp add: subst_apply_pairs_def)"], ["", "lemma pair_subst_ident[intro]: \"(fv t \\<union> fv t') \\<inter> subst_domain \\<theta> = {} \\<Longrightarrow> (t,t') \\<cdot>\\<^sub>p \\<theta> = (t,t')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (fv t \\<union> fv t') \\<inter> subst_domain \\<theta> =\n    {} \\<Longrightarrow>\n    (t, t') \\<cdot>\\<^sub>p \\<theta> = (t, t')", "by auto"], ["", "lemma pairs_substI[intro]:\n  assumes \"subst_domain \\<theta> \\<inter> (\\<Union>(s,t) \\<in> M. fv s \\<union> fv t) = {}\"\n  shows \"M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "fix m"], ["proof (state)\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "assume M: \"m \\<in> M\""], ["proof (state)\nthis:\n  m \\<in> M\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "then"], ["proof (chain)\npicking this:\n  m \\<in> M", "obtain s t where m: \"m = (s,t)\""], ["proof (prove)\nusing this:\n  m \\<in> M\n\ngoal (1 subgoal):\n 1. (\\<And>s t. m = (s, t) \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis surj_pair)"], ["proof (state)\nthis:\n  m = (s, t)\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "hence \"(fv s \\<union> fv t) \\<inter> subst_domain \\<theta> = {}\""], ["proof (prove)\nusing this:\n  m = (s, t)\n\ngoal (1 subgoal):\n 1. (fv s \\<union> fv t) \\<inter> subst_domain \\<theta> = {}", "using assms M"], ["proof (prove)\nusing this:\n  m = (s, t)\n  subst_domain \\<theta> \\<inter>\n  \\<Union> (fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r ` M) =\n  {}\n  m \\<in> M\n\ngoal (1 subgoal):\n 1. (fv s \\<union> fv t) \\<inter> subst_domain \\<theta> = {}", "by auto"], ["proof (state)\nthis:\n  (fv s \\<union> fv t) \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "hence \"m \\<cdot>\\<^sub>p \\<theta> = m\""], ["proof (prove)\nusing this:\n  (fv s \\<union> fv t) \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. m \\<cdot>\\<^sub>p \\<theta> = m", "using m"], ["proof (prove)\nusing this:\n  (fv s \\<union> fv t) \\<inter> subst_domain \\<theta> = {}\n  m = (s, t)\n\ngoal (1 subgoal):\n 1. m \\<cdot>\\<^sub>p \\<theta> = m", "by auto"], ["proof (state)\nthis:\n  m \\<cdot>\\<^sub>p \\<theta> = m\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "}"], ["proof (state)\nthis:\n  ?m2 \\<in> M \\<Longrightarrow> ?m2 \\<cdot>\\<^sub>p \\<theta> = ?m2\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "thus ?thesis"], ["proof (prove)\nusing this:\n  ?m2 \\<in> M \\<Longrightarrow> ?m2 \\<cdot>\\<^sub>p \\<theta> = ?m2\n\ngoal (1 subgoal):\n 1. M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M", "by (simp add: image_cong)"], ["proof (state)\nthis:\n  M \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> = M\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst: \"fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` (fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F)", "proof (induction F)"], ["proof (state)\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [])\n 2. \\<And>a F.\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<theta> `\n         fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) \\<Longrightarrow>\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F))", "case (Cons g G)"], ["proof (state)\nthis:\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G)\n\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [])\n 2. \\<And>a F.\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<theta> `\n         fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) \\<Longrightarrow>\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F))", "obtain t t' where \"g = (t,t')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t t'. g = (t, t') \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis surj_pair)"], ["proof (state)\nthis:\n  g = (t, t')\n\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [])\n 2. \\<And>a F.\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<theta> `\n         fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F) \\<Longrightarrow>\n       fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n        (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n       fv\\<^sub>s\\<^sub>e\\<^sub>t\n        (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F))", "thus ?case"], ["proof (prove)\nusing this:\n  g = (t, t')\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     (g # G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (g # G))", "using Cons.IH"], ["proof (prove)\nusing this:\n  g = (t, t')\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     (g # G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (g # G))", "by (simp add: subst_apply_pairs_def subst_apply_fv_unfold)"], ["proof (state)\nthis:\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (g # G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (g # G))\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t\n     (\\<theta> ` fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s [])", "qed (simp add: subst_apply_pairs_def)"], ["", "lemma fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s_subst_subset:\n  assumes \"fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>) \\<subseteq> subst_domain \\<sigma>\"\n  shows  \"fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "using assms"], ["proof (prove)\nusing this:\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n  \\<subseteq> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "proof (induction F)"], ["proof (state)\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n    \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n 2. \\<And>a F.\n       \\<lbrakk>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\n                \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n                fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n                \\<subseteq> subst_domain \\<sigma> \\<union>\n                            subst_domain \\<delta>;\n        fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n        \\<subseteq> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\n                         \\<subseteq> subst_domain \\<sigma> \\<union>\n                                     subst_domain \\<delta>", "case (Cons g G)"], ["proof (state)\nthis:\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n  \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G\n  \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (g # G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n  \\<subseteq> subst_domain \\<sigma>\n\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n    \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n 2. \\<And>a F.\n       \\<lbrakk>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\n                \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n                fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n                \\<subseteq> subst_domain \\<sigma> \\<union>\n                            subst_domain \\<delta>;\n        fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n        \\<subseteq> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\n                         \\<subseteq> subst_domain \\<sigma> \\<union>\n                                     subst_domain \\<delta>", "hence IH: \"fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\""], ["proof (prove)\nusing this:\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n  \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G\n  \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (g # G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n  \\<subseteq> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "by (simp add: subst_apply_pairs_def)"], ["proof (state)\nthis:\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G\n  \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n    \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n 2. \\<And>a F.\n       \\<lbrakk>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\n                \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n                fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n                \\<subseteq> subst_domain \\<sigma> \\<union>\n                            subst_domain \\<delta>;\n        fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n        \\<subseteq> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\n                         \\<subseteq> subst_domain \\<sigma> \\<union>\n                                     subst_domain \\<delta>", "obtain t t' where g: \"g = (t,t')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t t'. g = (t, t') \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis surj_pair)"], ["proof (state)\nthis:\n  g = (t, t')\n\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n    \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n 2. \\<And>a F.\n       \\<lbrakk>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\n                \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n                fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n                \\<subseteq> subst_domain \\<sigma> \\<union>\n                            subst_domain \\<delta>;\n        fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n        \\<subseteq> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\n                         \\<subseteq> subst_domain \\<sigma> \\<union>\n                                     subst_domain \\<delta>", "hence \"fv (t \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\" \"fv (t' \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\""], ["proof (prove)\nusing this:\n  g = (t, t')\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma> &&&\n    fv (t' \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>", "using Cons.prems"], ["proof (prove)\nusing this:\n  g = (t, t')\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n   (g # G \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n  \\<subseteq> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma> &&&\n    fv (t' \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>", "by (simp_all add: subst_apply_pairs_def)"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\n  fv (t' \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\n\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n    \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n 2. \\<And>a F.\n       \\<lbrakk>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\n                \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n                fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n                \\<subseteq> subst_domain \\<sigma> \\<union>\n                            subst_domain \\<delta>;\n        fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n        \\<subseteq> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\n                         \\<subseteq> subst_domain \\<sigma> \\<union>\n                                     subst_domain \\<delta>", "hence \"fv t \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\" \"fv t' \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\""], ["proof (prove)\nusing this:\n  fv (t \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\n  fv (t' \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. fv t\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta> &&&\n    fv t' \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "using subst_apply_fv_unfold[of _ \\<delta>]"], ["proof (prove)\nusing this:\n  fv (t \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\n  fv (t' \\<cdot> \\<delta>) \\<subseteq> subst_domain \\<sigma>\n  fv (?t \\<cdot> \\<delta>) = fv\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> ` fv ?t)\n\ngoal (1 subgoal):\n 1. fv t\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta> &&&\n    fv t' \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "by force+"], ["proof (state)\nthis:\n  fv t \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n  fv t' \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n\ngoal (2 subgoals):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n    \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n 2. \\<And>a F.\n       \\<lbrakk>fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                 (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n                  \\<delta>)\n                \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n                fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F\n                \\<subseteq> subst_domain \\<sigma> \\<union>\n                            subst_domain \\<delta>;\n        fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n         (a # F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n        \\<subseteq> subst_domain \\<sigma>\\<rbrakk>\n       \\<Longrightarrow> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (a # F)\n                         \\<subseteq> subst_domain \\<sigma> \\<union>\n                                     subst_domain \\<delta>", "thus ?case"], ["proof (prove)\nusing this:\n  fv t \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n  fv t' \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (g # G)\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "using IH g"], ["proof (prove)\nusing this:\n  fv t \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n  fv t' \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s G\n  \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n  g = (t, t')\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (g # G)\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "by (simp add: subst_apply_pairs_def)"], ["proof (state)\nthis:\n  fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s (g # G)\n  \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     ([] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>)\n    \\<subseteq> subst_domain \\<sigma> \\<Longrightarrow>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s []\n    \\<subseteq> subst_domain \\<sigma> \\<union> subst_domain \\<delta>", "qed (simp add: subst_apply_pairs_def)"], ["", "lemma pairs_subst_comp: \"F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> \\<circ>\\<^sub>s \\<theta> = ((F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta>) \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n    \\<delta> \\<circ>\\<^sub>s \\<theta> =\n    (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n     \\<delta>) \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s\n    \\<theta>", "by (induct F) (auto simp add: subst_apply_pairs_def)"], ["", "lemma pairs_substI'[intro]:\n  \"subst_domain \\<theta> \\<inter> fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F = {} \\<Longrightarrow> F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta> = F\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter>\n    fv\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s F =\n    {} \\<Longrightarrow>\n    F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta> = F", "by (induct F) (force simp add: subst_apply_pairs_def)+"], ["", "lemma subst_pair_compose[simp]: \"d \\<cdot>\\<^sub>p (\\<delta> \\<circ>\\<^sub>s \\<I>) = d \\<cdot>\\<^sub>p \\<delta> \\<cdot>\\<^sub>p \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. d \\<cdot>\\<^sub>p \\<delta> \\<circ>\\<^sub>s \\<I> =\n    d \\<cdot>\\<^sub>p \\<delta> \\<cdot>\\<^sub>p \\<I>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. d \\<cdot>\\<^sub>p \\<delta> \\<circ>\\<^sub>s \\<I> =\n    d \\<cdot>\\<^sub>p \\<delta> \\<cdot>\\<^sub>p \\<I>", "obtain t s where \"d = (t,s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t s. d = (t, s) \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  d = (t, s)\n\ngoal (1 subgoal):\n 1. d \\<cdot>\\<^sub>p \\<delta> \\<circ>\\<^sub>s \\<I> =\n    d \\<cdot>\\<^sub>p \\<delta> \\<cdot>\\<^sub>p \\<I>", "thus ?thesis"], ["proof (prove)\nusing this:\n  d = (t, s)\n\ngoal (1 subgoal):\n 1. d \\<cdot>\\<^sub>p \\<delta> \\<circ>\\<^sub>s \\<I> =\n    d \\<cdot>\\<^sub>p \\<delta> \\<cdot>\\<^sub>p \\<I>", "by auto"], ["proof (state)\nthis:\n  d \\<cdot>\\<^sub>p \\<delta> \\<circ>\\<^sub>s \\<I> =\n  d \\<cdot>\\<^sub>p \\<delta> \\<cdot>\\<^sub>p \\<I>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subst_pairs_compose[simp]: \"D \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t (\\<delta> \\<circ>\\<^sub>s \\<I>) = D \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<delta> \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. D \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta> \\<circ>\\<^sub>s \\<I> =\n    D \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<delta> \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<I>", "by auto"], ["", "lemma subst_apply_pair_pair: \"(t, s) \\<cdot>\\<^sub>p \\<I> = (t \\<cdot> \\<I>, s \\<cdot> \\<I>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (t, s) \\<cdot>\\<^sub>p \\<I> = (t \\<cdot> \\<I>, s \\<cdot> \\<I>)", "by (rule prod.case)"], ["", "lemma subst_apply_pairs_nil[simp]: \"[] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> = []\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> = []", "unfolding subst_apply_pairs_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. map (\\<lambda>f. f \\<cdot>\\<^sub>p \\<delta>) [] = []", "by simp"], ["", "lemma subst_apply_pairs_singleton[simp]: \"[(t,s)] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> = [(t \\<cdot> \\<delta>,s \\<cdot> \\<delta>)]\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [(t, s)] \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<delta> =\n    [(t \\<cdot> \\<delta>, s \\<cdot> \\<delta>)]", "unfolding subst_apply_pairs_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. map (\\<lambda>f. f \\<cdot>\\<^sub>p \\<delta>) [(t, s)] =\n    [(t \\<cdot> \\<delta>, s \\<cdot> \\<delta>)]", "by simp"], ["", "lemma subst_apply_pairs_Var[iff]: \"F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s Var = F\""], ["proof (prove)\ngoal (1 subgoal):\n 1. F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s Var = F", "by (simp add: subst_apply_pairs_def)"], ["", "lemma subst_apply_pairs_pset_subst: \"set (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) = set F \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. set (F \\<cdot>\\<^sub>p\\<^sub>a\\<^sub>i\\<^sub>r\\<^sub>s \\<theta>) =\n    set F \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "unfolding subst_apply_pairs_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. set (map (\\<lambda>f. f \\<cdot>\\<^sub>p \\<theta>) F) =\n    set F \\<cdot>\\<^sub>p\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>", "by force"], ["", "subsection \\<open>Finite Substitutions\\<close>"], ["", "inductive_set fsubst::\"('a,'b) subst set\" where\n  fvar:     \"Var \\<in> fsubst\"\n| FUpdate:  \"\\<lbrakk>\\<theta> \\<in> fsubst; v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v\\<rbrakk> \\<Longrightarrow> \\<theta>(v := t) \\<in> fsubst\""], ["", "lemma finite_dom_iff_fsubst:\n  \"finite (subst_domain \\<theta>) \\<longleftrightarrow> \\<theta> \\<in> fsubst\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain \\<theta>) = (\\<theta> \\<in> fsubst)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. finite (subst_domain \\<theta>) \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<theta> \\<in> fsubst \\<Longrightarrow> finite (subst_domain \\<theta>)", "assume \"finite (subst_domain \\<theta>)\""], ["proof (state)\nthis:\n  finite (subst_domain \\<theta>)\n\ngoal (2 subgoals):\n 1. finite (subst_domain \\<theta>) \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<theta> \\<in> fsubst \\<Longrightarrow> finite (subst_domain \\<theta>)", "thus \"\\<theta> \\<in> fsubst\""], ["proof (prove)\nusing this:\n  finite (subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "proof (induction \"subst_domain \\<theta>\" arbitrary: \\<theta> rule: finite.induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>\\<theta>.\n       {} = subst_domain \\<theta> \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<And>A a \\<theta>.\n       \\<lbrakk>finite A;\n        \\<And>\\<theta>.\n           A = subst_domain \\<theta> \\<Longrightarrow>\n           \\<theta> \\<in> fsubst;\n        insert a A = subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> \\<theta> \\<in> fsubst", "case emptyI"], ["proof (state)\nthis:\n  {} = subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<And>\\<theta>.\n       {} = subst_domain \\<theta> \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<And>A a \\<theta>.\n       \\<lbrakk>finite A;\n        \\<And>\\<theta>.\n           A = subst_domain \\<theta> \\<Longrightarrow>\n           \\<theta> \\<in> fsubst;\n        insert a A = subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> \\<theta> \\<in> fsubst", "hence \"\\<theta> = Var\""], ["proof (prove)\nusing this:\n  {} = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> = Var", "using empty_dom_iff_empty_subst"], ["proof (prove)\nusing this:\n  {} = subst_domain \\<theta>\n  (subst_domain ?\\<theta> = {}) = (?\\<theta> = Var)\n\ngoal (1 subgoal):\n 1. \\<theta> = Var", "by metis"], ["proof (state)\nthis:\n  \\<theta> = Var\n\ngoal (2 subgoals):\n 1. \\<And>\\<theta>.\n       {} = subst_domain \\<theta> \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<And>A a \\<theta>.\n       \\<lbrakk>finite A;\n        \\<And>\\<theta>.\n           A = subst_domain \\<theta> \\<Longrightarrow>\n           \\<theta> \\<in> fsubst;\n        insert a A = subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> \\<theta> \\<in> fsubst", "thus ?case"], ["proof (prove)\nusing this:\n  \\<theta> = Var\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "using fvar"], ["proof (prove)\nusing this:\n  \\<theta> = Var\n  Var \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "by simp"], ["proof (state)\nthis:\n  \\<theta> \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<And>A a \\<theta>.\n       \\<lbrakk>finite A;\n        \\<And>\\<theta>.\n           A = subst_domain \\<theta> \\<Longrightarrow>\n           \\<theta> \\<in> fsubst;\n        insert a A = subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> \\<theta> \\<in> fsubst", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>A a \\<theta>.\n       \\<lbrakk>finite A;\n        \\<And>\\<theta>.\n           A = subst_domain \\<theta> \\<Longrightarrow>\n           \\<theta> \\<in> fsubst;\n        insert a A = subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> \\<theta> \\<in> fsubst", "case (insertI \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m v)"], ["proof (state)\nthis:\n  finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n  subst_domain ?\\<theta> \\<Longrightarrow>\n  ?\\<theta> \\<in> fsubst\n  insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>A a \\<theta>.\n       \\<lbrakk>finite A;\n        \\<And>\\<theta>.\n           A = subst_domain \\<theta> \\<Longrightarrow>\n           \\<theta> \\<in> fsubst;\n        insert a A = subst_domain \\<theta>\\<rbrakk>\n       \\<Longrightarrow> \\<theta> \\<in> fsubst", "thus ?case"], ["proof (prove)\nusing this:\n  finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n  subst_domain ?\\<theta> \\<Longrightarrow>\n  ?\\<theta> \\<in> fsubst\n  insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "proof (cases \"v \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "case True"], ["proof (state)\nthis:\n  v \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n\ngoal (2 subgoals):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "hence \"\\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  v \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n\ngoal (1 subgoal):\n 1. \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>", "using \\<open>insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\\<close>"], ["proof (prove)\nusing this:\n  v \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n  insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst\n 2. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "using insertI.hyps(2)"], ["proof (prove)\nusing this:\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n  subst_domain ?\\<theta> \\<Longrightarrow>\n  ?\\<theta> \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "by metis"], ["proof (state)\nthis:\n  \\<theta> \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "case False"], ["proof (state)\nthis:\n  v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "let ?\\<theta>' = \"\\<lambda>w. if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w else Var w\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "have \"subst_domain ?\\<theta>' = \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain\n     (\\<lambda>w.\n         if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n         else Var w) =\n    \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m", "using \\<open>v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<close> \\<open>insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\\<close>"], ["proof (prove)\nusing this:\n  v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n  insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. subst_domain\n     (\\<lambda>w.\n         if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n         else Var w) =\n    \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain\n   (\\<lambda>w.\n       if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n       else Var w) =\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "hence \"?\\<theta>' \\<in> fsubst\""], ["proof (prove)\nusing this:\n  subst_domain\n   (\\<lambda>w.\n       if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n       else Var w) =\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n\ngoal (1 subgoal):\n 1. (\\<lambda>w.\n        if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n        else Var w)\n    \\<in> fsubst", "using insertI.hyps(2)"], ["proof (prove)\nusing this:\n  subst_domain\n   (\\<lambda>w.\n       if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n       else Var w) =\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n  \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n  subst_domain ?\\<theta> \\<Longrightarrow>\n  ?\\<theta> \\<in> fsubst\n\ngoal (1 subgoal):\n 1. (\\<lambda>w.\n        if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n        else Var w)\n    \\<in> fsubst", "by simp"], ["proof (state)\nthis:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "moreover"], ["proof (state)\nthis:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "have \"?\\<theta>'(v := \\<theta> v) = (\\<lambda>w. if w \\<in> insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w else Var w)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>w.\n        if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n        else Var w)\n    (v := \\<theta> v) =\n    (\\<lambda>w.\n        if w \\<in> insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n        then \\<theta> w else Var w)", "by auto"], ["proof (state)\nthis:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  (v := \\<theta> v) =\n  (\\<lambda>w.\n      if w \\<in> insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "hence \"?\\<theta>'(v := \\<theta> v) = \\<theta>\""], ["proof (prove)\nusing this:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  (v := \\<theta> v) =\n  (\\<lambda>w.\n      if w \\<in> insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n\ngoal (1 subgoal):\n 1. (\\<lambda>w.\n        if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n        else Var w)\n    (v := \\<theta> v) = \\<theta>", "using \\<open>insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\\<close>"], ["proof (prove)\nusing this:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  (v := \\<theta> v) =\n  (\\<lambda>w.\n      if w \\<in> insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<lambda>w.\n        if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n        else Var w)\n    (v := \\<theta> v) = \\<theta>", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  (v := \\<theta> v) = \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>finite \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m;\n     \\<And>\\<theta>.\n        \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m =\n        subst_domain \\<theta> \\<Longrightarrow>\n        \\<theta> \\<in> fsubst;\n     insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>;\n     v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\\<rbrakk>\n    \\<Longrightarrow> \\<theta> \\<in> fsubst", "ultimately"], ["proof (chain)\npicking this:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  \\<in> fsubst\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  (v := \\<theta> v) = \\<theta>", "show ?thesis"], ["proof (prove)\nusing this:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  \\<in> fsubst\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  (v := \\<theta> v) = \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "using FUpdate[of ?\\<theta>' v \"\\<theta> v\"] False insertI.hyps(3)"], ["proof (prove)\nusing this:\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  \\<in> fsubst\n  (\\<lambda>w.\n      if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n      else Var w)\n  (v := \\<theta> v) = \\<theta>\n  \\<lbrakk>(\\<lambda>w.\n               if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m then \\<theta> w\n               else Var w)\n           \\<in> fsubst;\n   v \\<notin> subst_domain\n               (\\<lambda>w.\n                   if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n                   then \\<theta> w else Var w);\n   \\<theta> v \\<noteq> Var v\\<rbrakk>\n  \\<Longrightarrow> (\\<lambda>w.\n                        if w \\<in> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n                        then \\<theta> w else Var w)\n                    (v := \\<theta> v) \\<in> fsubst\n  v \\<notin> \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m\n  insert v \\<theta>'\\<^sub>d\\<^sub>o\\<^sub>m = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<theta> \\<in> fsubst\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<theta> \\<in> fsubst\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<theta> \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst \\<Longrightarrow> finite (subst_domain \\<theta>)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst \\<Longrightarrow> finite (subst_domain \\<theta>)", "assume \"\\<theta> \\<in> fsubst\""], ["proof (state)\nthis:\n  \\<theta> \\<in> fsubst\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> fsubst \\<Longrightarrow> finite (subst_domain \\<theta>)", "thus \"finite (subst_domain \\<theta>)\""], ["proof (prove)\nusing this:\n  \\<theta> \\<in> fsubst\n\ngoal (1 subgoal):\n 1. finite (subst_domain \\<theta>)", "by (induct \\<theta>, simp, metis subst_dom_insert_finite)"], ["proof (state)\nthis:\n  finite (subst_domain \\<theta>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma fsubst_induct[case_names fvar FUpdate, induct set: finite]:\n  assumes \"finite (subst_domain \\<delta>)\" \"P Var\"\n  and \"\\<And>\\<theta> v t. \\<lbrakk>finite (subst_domain \\<theta>); v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v; P \\<theta>\\<rbrakk> \\<Longrightarrow> P (\\<theta>(v := t))\"\n  shows \"P \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<delta>", "using assms finite_dom_iff_fsubst fsubst.induct"], ["proof (prove)\nusing this:\n  finite (subst_domain \\<delta>)\n  P Var\n  \\<lbrakk>finite (subst_domain ?\\<theta>);\n   ?v \\<notin> subst_domain ?\\<theta>; ?t \\<noteq> Var ?v;\n   P ?\\<theta>\\<rbrakk>\n  \\<Longrightarrow> P (?\\<theta>(?v := ?t))\n  finite (subst_domain ?\\<theta>) = (?\\<theta> \\<in> fsubst)\n  \\<lbrakk>?x \\<in> fsubst; ?P Var;\n   \\<And>\\<theta> v t.\n      \\<lbrakk>\\<theta> \\<in> fsubst; ?P \\<theta>;\n       v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v\\<rbrakk>\n      \\<Longrightarrow> ?P (\\<theta>(v := t))\\<rbrakk>\n  \\<Longrightarrow> ?P ?x\n\ngoal (1 subgoal):\n 1. P \\<delta>", "by metis"], ["", "lemma fun_upd_fsubst: \"s(v := t) \\<in> fsubst \\<longleftrightarrow> s \\<in> fsubst\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (s(v := t) \\<in> fsubst) = (s \\<in> fsubst)", "using subst_dom_insert_finite[of s] finite_dom_iff_fsubst"], ["proof (prove)\nusing this:\n  finite (subst_domain s) = finite (subst_domain (s(?v := ?t)))\n  finite (subst_domain ?\\<theta>) = (?\\<theta> \\<in> fsubst)\n\ngoal (1 subgoal):\n 1. (s(v := t) \\<in> fsubst) = (s \\<in> fsubst)", "by blast"], ["", "lemma finite_img_if_fsubst: \"s \\<in> fsubst \\<Longrightarrow> finite (subst_range s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> fsubst \\<Longrightarrow> finite (subst_range s)", "using finite_dom_iff_fsubst finite_subst_img_if_finite_dom'"], ["proof (prove)\nusing this:\n  finite (subst_domain ?\\<theta>) = (?\\<theta> \\<in> fsubst)\n  finite (subst_domain ?\\<sigma>) \\<Longrightarrow>\n  finite (subst_range ?\\<sigma>)\n\ngoal (1 subgoal):\n 1. s \\<in> fsubst \\<Longrightarrow> finite (subst_range s)", "by blast"], ["", "subsection \\<open>Unifiers and Most General Unifiers (MGUs)\\<close>"], ["", "abbreviation Unifier::\"('f,'v) subst \\<Rightarrow> ('f,'v) term \\<Rightarrow> ('f,'v) term \\<Rightarrow> bool\" where\n  \"Unifier \\<sigma> t u \\<equiv> (t \\<cdot> \\<sigma> = u \\<cdot> \\<sigma>)\""], ["", "abbreviation MGU::\"('f,'v) subst \\<Rightarrow> ('f,'v) term \\<Rightarrow> ('f,'v) term \\<Rightarrow> bool\" where\n  \"MGU \\<sigma> t u \\<equiv> Unifier \\<sigma> t u \\<and> (\\<forall>\\<theta>. Unifier \\<theta> t u \\<longrightarrow> \\<sigma> \\<preceq>\\<^sub>\\<circ> \\<theta>)\""], ["", "lemma MGUI[intro]:\n  shows \"\\<lbrakk>t \\<cdot> \\<sigma> = u \\<cdot> \\<sigma>; \\<And>\\<theta>::('f,'v) subst. t \\<cdot> \\<theta> = u \\<cdot> \\<theta> \\<Longrightarrow> \\<sigma> \\<preceq>\\<^sub>\\<circ> \\<theta>\\<rbrakk> \\<Longrightarrow> MGU \\<sigma> t u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Unifier \\<sigma> t u;\n     \\<And>\\<theta>.\n        Unifier \\<theta> t u \\<Longrightarrow>\n        \\<sigma> \\<preceq>\\<^sub>\\<circ> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> MGU \\<sigma> t u", "by auto"], ["", "lemma UnifierD[dest]:\n  fixes \\<sigma>::\"('f,'v) subst\" and f g::'f and X Y::\"('f,'v) term list\"\n  assumes \"Unifier \\<sigma> (Fun f X) (Fun g Y)\"\n  shows \"f = g\" \"length X = length Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f = g &&& length X = length Y", "proof -"], ["proof (state)\ngoal (2 subgoals):\n 1. f = g\n 2. length X = length Y", "from assms"], ["proof (chain)\npicking this:\n  Unifier \\<sigma> (Fun f X) (Fun g Y)", "show \"f = g\""], ["proof (prove)\nusing this:\n  Unifier \\<sigma> (Fun f X) (Fun g Y)\n\ngoal (1 subgoal):\n 1. f = g", "by auto"], ["proof (state)\nthis:\n  f = g\n\ngoal (1 subgoal):\n 1. length X = length Y", "from assms"], ["proof (chain)\npicking this:\n  Unifier \\<sigma> (Fun f X) (Fun g Y)", "have \"Fun f X \\<cdot> \\<sigma> = Fun g Y \\<cdot> \\<sigma>\""], ["proof (prove)\nusing this:\n  Unifier \\<sigma> (Fun f X) (Fun g Y)\n\ngoal (1 subgoal):\n 1. Unifier \\<sigma> (Fun f X) (Fun g Y)", "by auto"], ["proof (state)\nthis:\n  Unifier \\<sigma> (Fun f X) (Fun g Y)\n\ngoal (1 subgoal):\n 1. length X = length Y", "hence \"length (map (\\<lambda>x. x \\<cdot> \\<sigma>) X) = length (map (\\<lambda>x. x \\<cdot> \\<sigma>) Y)\""], ["proof (prove)\nusing this:\n  Unifier \\<sigma> (Fun f X) (Fun g Y)\n\ngoal (1 subgoal):\n 1. length (X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<sigma>) =\n    length (Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<sigma>)", "by auto"], ["proof (state)\nthis:\n  length (X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<sigma>) =\n  length (Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<sigma>)\n\ngoal (1 subgoal):\n 1. length X = length Y", "thus \"length X = length Y\""], ["proof (prove)\nusing this:\n  length (X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<sigma>) =\n  length (Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<sigma>)\n\ngoal (1 subgoal):\n 1. length X = length Y", "by auto"], ["proof (state)\nthis:\n  length X = length Y\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma MGUD[dest]:\n  fixes \\<sigma>::\"('f,'v) subst\" and f g::'f and X Y::\"('f,'v) term list\"\n  assumes \"MGU \\<sigma> (Fun f X) (Fun g Y)\"\n  shows \"f = g\" \"length X = length Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f = g &&& length X = length Y", "using assms"], ["proof (prove)\nusing this:\n  MGU \\<sigma> (Fun f X) (Fun g Y)\n\ngoal (1 subgoal):\n 1. f = g &&& length X = length Y", "by (auto intro!: UnifierD[of f X \\<sigma> g Y])"], ["", "lemma MGU_sym[sym]: \"MGU \\<sigma> s t \\<Longrightarrow> MGU \\<sigma> t s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU \\<sigma> s t \\<Longrightarrow> MGU \\<sigma> t s", "by auto"], ["", "lemma Unifier_sym[sym]: \"Unifier \\<sigma> s t \\<Longrightarrow> Unifier \\<sigma> t s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier \\<sigma> s t \\<Longrightarrow> Unifier \\<sigma> t s", "by auto"], ["", "lemma MGU_nil: \"MGU Var s t \\<longleftrightarrow> s = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU Var s t = (s = t)", "by fastforce"], ["", "lemma Unifier_comp: \"Unifier (\\<theta> \\<circ>\\<^sub>s \\<delta>) t u \\<Longrightarrow> Unifier \\<delta> (t \\<cdot> \\<theta>) (u \\<cdot> \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (\\<theta> \\<circ>\\<^sub>s \\<delta>) t u \\<Longrightarrow>\n    Unifier \\<delta> (t \\<cdot> \\<theta>) (u \\<cdot> \\<theta>)", "by simp"], ["", "lemma Unifier_comp': \"Unifier \\<delta> (t \\<cdot> \\<theta>) (u \\<cdot> \\<theta>) \\<Longrightarrow> Unifier (\\<theta> \\<circ>\\<^sub>s \\<delta>) t u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier \\<delta> (t \\<cdot> \\<theta>)\n     (u \\<cdot> \\<theta>) \\<Longrightarrow>\n    Unifier (\\<theta> \\<circ>\\<^sub>s \\<delta>) t u", "by simp"], ["", "lemma Unifier_excludes_subterm:\n  assumes \\<theta>: \"Unifier \\<theta> t u\"\n  shows \"\\<not>t \\<sqsubset> u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> t \\<sqsubset> u", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. t \\<sqsubset> u \\<Longrightarrow> False", "assume \"t \\<sqsubset> u\""], ["proof (state)\nthis:\n  t \\<sqsubset> u\n\ngoal (1 subgoal):\n 1. t \\<sqsubset> u \\<Longrightarrow> False", "hence \"t \\<cdot> \\<theta> \\<sqsubset> u \\<cdot> \\<theta>\""], ["proof (prove)\nusing this:\n  t \\<sqsubset> u\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> \\<sqsubset> u \\<cdot> \\<theta>", "using subst_mono_neq"], ["proof (prove)\nusing this:\n  t \\<sqsubset> u\n  ?t \\<sqsubset> ?u \\<Longrightarrow>\n  ?t \\<cdot> ?s \\<sqsubset> ?u \\<cdot> ?s\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> \\<sqsubset> u \\<cdot> \\<theta>", "by metis"], ["proof (state)\nthis:\n  t \\<cdot> \\<theta> \\<sqsubset> u \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. t \\<sqsubset> u \\<Longrightarrow> False", "hence \"t \\<cdot> \\<theta> \\<noteq> u \\<cdot> \\<theta>\""], ["proof (prove)\nusing this:\n  t \\<cdot> \\<theta> \\<sqsubset> u \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<theta> \\<noteq> u \\<cdot> \\<theta>", "by simp"], ["proof (state)\nthis:\n  t \\<cdot> \\<theta> \\<noteq> u \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. t \\<sqsubset> u \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  t \\<cdot> \\<theta> \\<noteq> u \\<cdot> \\<theta>\n\ngoal (1 subgoal):\n 1. t \\<sqsubset> u \\<Longrightarrow> False", "from \\<theta>"], ["proof (chain)\npicking this:\n  Unifier \\<theta> t u", "have \"t \\<cdot> \\<theta> = u \\<cdot> \\<theta>\""], ["proof (prove)\nusing this:\n  Unifier \\<theta> t u\n\ngoal (1 subgoal):\n 1. Unifier \\<theta> t u", "by auto"], ["proof (state)\nthis:\n  Unifier \\<theta> t u\n\ngoal (1 subgoal):\n 1. t \\<sqsubset> u \\<Longrightarrow> False", "ultimately"], ["proof (chain)\npicking this:\n  t \\<cdot> \\<theta> \\<noteq> u \\<cdot> \\<theta>\n  Unifier \\<theta> t u", "show False"], ["proof (prove)\nusing this:\n  t \\<cdot> \\<theta> \\<noteq> u \\<cdot> \\<theta>\n  Unifier \\<theta> t u\n\ngoal (1 subgoal):\n 1. False", ".."], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma MGU_is_Unifier: \"MGU \\<sigma> t u \\<Longrightarrow> Unifier \\<sigma> t u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU \\<sigma> t u \\<Longrightarrow> Unifier \\<sigma> t u", "by (rule conjunct1)"], ["", "lemma MGU_Var1:\n  assumes \"\\<not>Var v \\<sqsubset> t\"\n  shows \"MGU (Var(v := t)) (Var v) t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU (Var(v := t)) (Var v) t", "proof (intro MGUI exI)"], ["proof (state)\ngoal (2 subgoals):\n 1. Unifier (Var(v := t)) (Var v) t\n 2. \\<And>\\<theta>.\n       Unifier \\<theta> (Var v) t \\<Longrightarrow>\n       \\<theta> = Var(v := t) \\<circ>\\<^sub>s ?\\<gamma>1 \\<theta>", "show \"Var v \\<cdot> (Var(v := t)) = t \\<cdot> (Var(v := t))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (Var(v := t)) (Var v) t", "using assms subst_no_occs"], ["proof (prove)\nusing this:\n  \\<not> Var v \\<sqsubset> t\n  Var ?v \\<notin> subterms ?t \\<Longrightarrow>\n  ?t \\<cdot> Var(?v := ?s) = ?t\n\ngoal (1 subgoal):\n 1. Unifier (Var(v := t)) (Var v) t", "by fastforce"], ["proof (state)\nthis:\n  Unifier (Var(v := t)) (Var v) t\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta>.\n       Unifier \\<theta> (Var v) t \\<Longrightarrow>\n       \\<theta> = Var(v := t) \\<circ>\\<^sub>s ?\\<gamma>1 \\<theta>", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta>.\n       Unifier \\<theta> (Var v) t \\<Longrightarrow>\n       \\<theta> = Var(v := t) \\<circ>\\<^sub>s ?\\<gamma>1 \\<theta>", "fix \\<theta>::\"('a,'b) subst\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta>.\n       Unifier \\<theta> (Var v) t \\<Longrightarrow>\n       \\<theta> = Var(v := t) \\<circ>\\<^sub>s ?\\<gamma>1 \\<theta>", "assume th: \"Var v \\<cdot> \\<theta> = t \\<cdot> \\<theta>\""], ["proof (state)\nthis:\n  Unifier \\<theta> (Var v) t\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta>.\n       Unifier \\<theta> (Var v) t \\<Longrightarrow>\n       \\<theta> = Var(v := t) \\<circ>\\<^sub>s ?\\<gamma>1 \\<theta>", "show \"\\<theta> = (Var(v := t)) \\<circ>\\<^sub>s \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta> = Var(v := t) \\<circ>\\<^sub>s \\<theta>", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ta.\n       ta \\<cdot> \\<theta> = ta \\<cdot> Var(v := t) \\<circ>\\<^sub>s \\<theta>", "fix s"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ta.\n       ta \\<cdot> \\<theta> = ta \\<cdot> Var(v := t) \\<circ>\\<^sub>s \\<theta>", "show \"s \\<cdot> \\<theta> = s \\<cdot> ((Var(v := t)) \\<circ>\\<^sub>s \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<cdot> \\<theta> = s \\<cdot> Var(v := t) \\<circ>\\<^sub>s \\<theta>", "using th"], ["proof (prove)\nusing this:\n  Unifier \\<theta> (Var v) t\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<theta> = s \\<cdot> Var(v := t) \\<circ>\\<^sub>s \\<theta>", "by (induct s) auto"], ["proof (state)\nthis:\n  s \\<cdot> \\<theta> = s \\<cdot> Var(v := t) \\<circ>\\<^sub>s \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<theta> = Var(v := t) \\<circ>\\<^sub>s \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma MGU_Var2: \"v \\<notin> fv t \\<Longrightarrow> MGU (Var(v := t)) (Var v) t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> fv t \\<Longrightarrow> MGU (Var(v := t)) (Var v) t", "by (metis (no_types) MGU_Var1 vars_iff_subterm_or_eq)"], ["", "lemma MGU_Var3: \"MGU Var (Var v) (Var w) \\<longleftrightarrow> v = w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU Var (Var v) (Var w) = (v = w)", "by fastforce"], ["", "lemma MGU_Const1: \"MGU Var (Fun c []) (Fun d []) \\<longleftrightarrow> c = d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU Var (Fun c []) (Fun d []) = (c = d)", "by fastforce"], ["", "lemma MGU_Const2: \"MGU \\<theta> (Fun c []) (Fun d []) \\<Longrightarrow> c = d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU \\<theta> (Fun c []) (Fun d []) \\<Longrightarrow> c = d", "by auto"], ["", "lemma MGU_Fun:\n  assumes \"MGU \\<theta> (Fun f X) (Fun g Y)\"\n  shows \"f = g\" \"length X = length Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f = g &&& length X = length Y", "proof -"], ["proof (state)\ngoal (2 subgoals):\n 1. f = g\n 2. length X = length Y", "let ?F = \"\\<lambda>\\<theta> X. map (\\<lambda>x. x \\<cdot> \\<theta>) X\""], ["proof (state)\ngoal (2 subgoals):\n 1. f = g\n 2. length X = length Y", "from assms"], ["proof (chain)\npicking this:\n  MGU \\<theta> (Fun f X) (Fun g Y)", "have\n    \"\\<lbrakk>f = g; ?F \\<theta> X = ?F \\<theta> Y; \\<forall>\\<theta>'. f = g \\<and> ?F \\<theta>' X = ?F \\<theta>' Y \\<longrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\\<rbrakk> \\<Longrightarrow> length X = length Y\""], ["proof (prove)\nusing this:\n  MGU \\<theta> (Fun f X) (Fun g Y)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>f = g;\n     X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> =\n     Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>;\n     \\<forall>\\<theta>'.\n        f = g \\<and>\n        X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' =\n        Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n        \\<theta>' \\<longrightarrow>\n        \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\\<rbrakk>\n    \\<Longrightarrow> length X = length Y", "using map_eq_imp_length_eq"], ["proof (prove)\nusing this:\n  MGU \\<theta> (Fun f X) (Fun g Y)\n  map ?f ?xs = map ?g ?ys \\<Longrightarrow> length ?xs = length ?ys\n\ngoal (1 subgoal):\n 1. \\<lbrakk>f = g;\n     X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> =\n     Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>;\n     \\<forall>\\<theta>'.\n        f = g \\<and>\n        X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' =\n        Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t\n        \\<theta>' \\<longrightarrow>\n        \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\\<rbrakk>\n    \\<Longrightarrow> length X = length Y", "by auto"], ["proof (state)\nthis:\n  \\<lbrakk>f = g;\n   X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> =\n   Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>;\n   \\<forall>\\<theta>'.\n      f = g \\<and>\n      X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' =\n      Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' \\<longrightarrow>\n      \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\\<rbrakk>\n  \\<Longrightarrow> length X = length Y\n\ngoal (2 subgoals):\n 1. f = g\n 2. length X = length Y", "thus \"f = g\" \"length X = length Y\""], ["proof (prove)\nusing this:\n  \\<lbrakk>f = g;\n   X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> =\n   Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>;\n   \\<forall>\\<theta>'.\n      f = g \\<and>\n      X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' =\n      Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' \\<longrightarrow>\n      \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\\<rbrakk>\n  \\<Longrightarrow> length X = length Y\n\ngoal (1 subgoal):\n 1. f = g &&& length X = length Y", "using assms"], ["proof (prove)\nusing this:\n  \\<lbrakk>f = g;\n   X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta> =\n   Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>;\n   \\<forall>\\<theta>'.\n      f = g \\<and>\n      X \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' =\n      Y \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<theta>' \\<longrightarrow>\n      \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\\<rbrakk>\n  \\<Longrightarrow> length X = length Y\n  MGU \\<theta> (Fun f X) (Fun g Y)\n\ngoal (1 subgoal):\n 1. f = g &&& length X = length Y", "by auto"], ["proof (state)\nthis:\n  f = g\n  length X = length Y\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma Unifier_Fun:\n  assumes \"Unifier \\<theta> (Fun f (x#X)) (Fun g (y#Y))\"\n  shows \"Unifier \\<theta> x y\" \"Unifier \\<theta> (Fun f X) (Fun g Y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier \\<theta> x y &&& Unifier \\<theta> (Fun f X) (Fun g Y)", "using assms"], ["proof (prove)\nusing this:\n  Unifier \\<theta> (Fun f (x # X)) (Fun g (y # Y))\n\ngoal (1 subgoal):\n 1. Unifier \\<theta> x y &&& Unifier \\<theta> (Fun f X) (Fun g Y)", "by simp_all"], ["", "lemma Unifier_subst_idem_subst: \n  \"subst_idem r \\<Longrightarrow> Unifier s (t \\<cdot> r) (u \\<cdot> r) \\<Longrightarrow> Unifier (r \\<circ>\\<^sub>s s) (t \\<cdot> r) (u \\<cdot> r)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_idem r; Unifier s (t \\<cdot> r) (u \\<cdot> r)\\<rbrakk>\n    \\<Longrightarrow> Unifier (r \\<circ>\\<^sub>s s) (t \\<cdot> r)\n                       (u \\<cdot> r)", "by (metis (no_types, lifting) subst_idem_def subst_subst_compose)"], ["", "lemma subst_idem_comp:\n  \"subst_idem r \\<Longrightarrow> Unifier s (t \\<cdot> r) (u \\<cdot> r) \\<Longrightarrow> \n    (\\<And>q. Unifier q (t \\<cdot> r) (u \\<cdot> r) \\<Longrightarrow> s \\<circ>\\<^sub>s q = q) \\<Longrightarrow>\n    subst_idem (r \\<circ>\\<^sub>s s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_idem r; Unifier s (t \\<cdot> r) (u \\<cdot> r);\n     \\<And>q.\n        Unifier q (t \\<cdot> r) (u \\<cdot> r) \\<Longrightarrow>\n        s \\<circ>\\<^sub>s q = q\\<rbrakk>\n    \\<Longrightarrow> subst_idem (r \\<circ>\\<^sub>s s)", "by (frule Unifier_subst_idem_subst, blast, metis subst_idem_def subst_compose_assoc)"], ["", "lemma Unifier_mgt: \"\\<lbrakk>Unifier \\<delta> t u; \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta>\\<rbrakk> \\<Longrightarrow> Unifier \\<theta> t u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Unifier \\<delta> t u;\n     \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta>\\<rbrakk>\n    \\<Longrightarrow> Unifier \\<theta> t u", "by auto"], ["", "lemma Unifier_support: \"\\<lbrakk>Unifier \\<delta> t u; \\<delta> supports \\<theta>\\<rbrakk> \\<Longrightarrow> Unifier \\<theta> t u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Unifier \\<delta> t u; \\<delta> supports \\<theta>\\<rbrakk>\n    \\<Longrightarrow> Unifier \\<theta> t u", "using subst_supportD Unifier_mgt"], ["proof (prove)\nusing this:\n  ?\\<theta> supports ?\\<delta> \\<Longrightarrow>\n  ?\\<theta> \\<preceq>\\<^sub>\\<circ> ?\\<delta>\n  \\<lbrakk>Unifier ?\\<delta> ?t ?u;\n   ?\\<delta> \\<preceq>\\<^sub>\\<circ> ?\\<theta>\\<rbrakk>\n  \\<Longrightarrow> Unifier ?\\<theta> ?t ?u\n\ngoal (1 subgoal):\n 1. \\<lbrakk>Unifier \\<delta> t u; \\<delta> supports \\<theta>\\<rbrakk>\n    \\<Longrightarrow> Unifier \\<theta> t u", "by metis"], ["", "lemma MGU_mgt: \"\\<lbrakk>MGU \\<sigma> t u; MGU \\<delta> t u\\<rbrakk> \\<Longrightarrow> \\<sigma> \\<preceq>\\<^sub>\\<circ> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>MGU \\<sigma> t u; MGU \\<delta> t u\\<rbrakk>\n    \\<Longrightarrow> \\<sigma> \\<preceq>\\<^sub>\\<circ> \\<delta>", "by auto"], ["", "lemma Unifier_trm_fv_bound:\n  \"\\<lbrakk>Unifier s t u; v \\<in> fv t\\<rbrakk> \\<Longrightarrow> v \\<in> subst_domain s \\<union> range_vars s \\<union> fv u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Unifier s t u; v \\<in> fv t\\<rbrakk>\n    \\<Longrightarrow> v \\<in> subst_domain s \\<union> range_vars s \\<union>\n                              fv u", "proof (induction t arbitrary: s u)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x s u.\n       \\<lbrakk>Unifier s (Var x) u; v \\<in> fv (Var x)\\<rbrakk>\n       \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n                                 range_vars s \\<union>\n                                 fv u\n 2. \\<And>x1a x2 s u.\n       \\<lbrakk>\\<And>x2a s u.\n                   \\<lbrakk>x2a \\<in> set x2; Unifier s x2a u;\n                    v \\<in> fv x2a\\<rbrakk>\n                   \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n       range_vars s \\<union>\n       fv u;\n        Unifier s (Fun x1a x2) u; v \\<in> fv (Fun x1a x2)\\<rbrakk>\n       \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n                                 range_vars s \\<union>\n                                 fv u", "case (Fun f X)"], ["proof (state)\nthis:\n  \\<lbrakk>?x2a \\<in> set X; Unifier ?s ?x2a ?u; v \\<in> fv ?x2a\\<rbrakk>\n  \\<Longrightarrow> v \\<in> subst_domain ?s \\<union> range_vars ?s \\<union>\n                            fv ?u\n  Unifier s (Fun f X) u\n  v \\<in> fv (Fun f X)\n\ngoal (2 subgoals):\n 1. \\<And>x s u.\n       \\<lbrakk>Unifier s (Var x) u; v \\<in> fv (Var x)\\<rbrakk>\n       \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n                                 range_vars s \\<union>\n                                 fv u\n 2. \\<And>x1a x2 s u.\n       \\<lbrakk>\\<And>x2a s u.\n                   \\<lbrakk>x2a \\<in> set x2; Unifier s x2a u;\n                    v \\<in> fv x2a\\<rbrakk>\n                   \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n       range_vars s \\<union>\n       fv u;\n        Unifier s (Fun x1a x2) u; v \\<in> fv (Fun x1a x2)\\<rbrakk>\n       \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n                                 range_vars s \\<union>\n                                 fv u", "hence \"v \\<in> fv (u \\<cdot> s) \\<or> v \\<in> subst_domain s\""], ["proof (prove)\nusing this:\n  \\<lbrakk>?x2a \\<in> set X; Unifier ?s ?x2a ?u; v \\<in> fv ?x2a\\<rbrakk>\n  \\<Longrightarrow> v \\<in> subst_domain ?s \\<union> range_vars ?s \\<union>\n                            fv ?u\n  Unifier s (Fun f X) u\n  v \\<in> fv (Fun f X)\n\ngoal (1 subgoal):\n 1. v \\<in> fv (u \\<cdot> s) \\<or> v \\<in> subst_domain s", "by (metis subst_not_dom_fixed)"], ["proof (state)\nthis:\n  v \\<in> fv (u \\<cdot> s) \\<or> v \\<in> subst_domain s\n\ngoal (2 subgoals):\n 1. \\<And>x s u.\n       \\<lbrakk>Unifier s (Var x) u; v \\<in> fv (Var x)\\<rbrakk>\n       \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n                                 range_vars s \\<union>\n                                 fv u\n 2. \\<And>x1a x2 s u.\n       \\<lbrakk>\\<And>x2a s u.\n                   \\<lbrakk>x2a \\<in> set x2; Unifier s x2a u;\n                    v \\<in> fv x2a\\<rbrakk>\n                   \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n       range_vars s \\<union>\n       fv u;\n        Unifier s (Fun x1a x2) u; v \\<in> fv (Fun x1a x2)\\<rbrakk>\n       \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n                                 range_vars s \\<union>\n                                 fv u", "thus ?case"], ["proof (prove)\nusing this:\n  v \\<in> fv (u \\<cdot> s) \\<or> v \\<in> subst_domain s\n\ngoal (1 subgoal):\n 1. v \\<in> subst_domain s \\<union> range_vars s \\<union> fv u", "by (metis (no_types) Un_iff contra_subsetD subst_sends_fv_to_img)"], ["proof (state)\nthis:\n  v \\<in> subst_domain s \\<union> range_vars s \\<union> fv u\n\ngoal (1 subgoal):\n 1. \\<And>x s u.\n       \\<lbrakk>Unifier s (Var x) u; v \\<in> fv (Var x)\\<rbrakk>\n       \\<Longrightarrow> v \\<in> subst_domain s \\<union>\n                                 range_vars s \\<union>\n                                 fv u", "qed (metis (no_types) UnI1 UnI2 subsetCE no_var_subterm subst_sends_dom_to_img\n            subst_to_var_is_var trm_subst_ident' vars_iff_subterm_or_eq)"], ["", "lemma Unifier_rm_var: \"\\<lbrakk>Unifier \\<theta> s t; v \\<notin> fv s \\<union> fv t\\<rbrakk> \\<Longrightarrow> Unifier (rm_var v \\<theta>) s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Unifier \\<theta> s t; v \\<notin> fv s \\<union> fv t\\<rbrakk>\n    \\<Longrightarrow> Unifier (rm_var v \\<theta>) s t", "by (auto simp add: repl_invariance)"], ["", "lemma Unifier_ground_rm_vars:\n  assumes \"ground (subst_range s)\" \"Unifier (rm_vars X s) t t'\"\n  shows \"Unifier s t t'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier s t t'", "by (rule Unifier_support[OF assms(2) rm_vars_ground_supports[OF assms(1)]])"], ["", "lemma Unifier_dom_restrict:\n  assumes \"Unifier s t t'\" \"fv t \\<union> fv t' \\<subseteq> S\"\n  shows \"Unifier (rm_vars (UNIV - S) s) t t'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (rm_vars (UNIV - S) s) t t'", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Unifier (rm_vars (UNIV - S) s) t t'", "let ?s = \"rm_vars (UNIV - S) s\""], ["proof (state)\ngoal (1 subgoal):\n 1. Unifier (rm_vars (UNIV - S) s) t t'", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (rm_vars (UNIV - S) s) t t'", "using term_subst_eq_conv[of t s ?s] term_subst_eq_conv[of t' s ?s] assms"], ["proof (prove)\nusing this:\n  (t \\<cdot> s = t \\<cdot> rm_vars (UNIV - S) s) =\n  (\\<forall>x\\<in>fv t. s x = rm_vars (UNIV - S) s x)\n  (t' \\<cdot> s = t' \\<cdot> rm_vars (UNIV - S) s) =\n  (\\<forall>x\\<in>fv t'. s x = rm_vars (UNIV - S) s x)\n  Unifier s t t'\n  fv t \\<union> fv t' \\<subseteq> S\n\ngoal (1 subgoal):\n 1. Unifier (rm_vars (UNIV - S) s) t t'", "by auto"], ["proof (state)\nthis:\n  Unifier (rm_vars (UNIV - S) s) t t'\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \\<open>Well-formedness of Substitutions and Unifiers\\<close>"], ["", "inductive_set wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set::\"('a,'b) subst set\" where\n  Empty[simp]: \"Var \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\"\n| Insert[simp]:\n    \"\\<lbrakk>\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set; v \\<notin> subst_domain \\<theta>;\n      v \\<notin> range_vars \\<theta>; fv t \\<inter> (insert v (subst_domain \\<theta>)) = {}\\<rbrakk>\n      \\<Longrightarrow> \\<theta>(v := t) \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\""], ["", "definition wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t::\"('a,'b) subst \\<Rightarrow> bool\" where\n  \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<equiv> subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and> finite (subst_domain \\<theta>)\""], ["", "definition wf\\<^sub>M\\<^sub>G\\<^sub>U::\"('a,'b) subst \\<Rightarrow> ('a,'b) term \\<Rightarrow> ('a,'b) term \\<Rightarrow> bool\" where\n  \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<equiv> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<and> MGU \\<theta> s t \\<and> subst_domain \\<theta> \\<union> range_vars \\<theta> \\<subseteq> fv s \\<union> fv t\""], ["", "lemma wf_subst_subst_idem: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> subst_idem \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow>\n    subst_idem \\<theta>", "using subst_idemI[of \\<theta>]"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<Longrightarrow>\n  subst_idem \\<theta>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow>\n    subst_idem \\<theta>", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<Longrightarrow>\n  subst_idem \\<theta>\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n    finite (subst_domain \\<theta>) \\<Longrightarrow>\n    subst_idem \\<theta>", "by fast"], ["", "lemma wf_subst_properties: \"\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set = wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set) =\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<theta>\n    \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n 2. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow>\n    \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "show \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow>\n    \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n    finite (subst_domain \\<theta>) \\<Longrightarrow>\n    \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n    finite (subst_domain \\<theta>) \\<Longrightarrow>\n    \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "assume \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and> finite (subst_domain \\<theta>)\""], ["proof (state)\nthis:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n  finite (subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n    finite (subst_domain \\<theta>) \\<Longrightarrow>\n    \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "hence \"finite (subst_domain \\<theta>)\" \"subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\""], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n  finite (subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. finite (subst_domain \\<theta>) &&&\n    subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}", "by auto"], ["proof (state)\nthis:\n  finite (subst_domain \\<theta>)\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n    finite (subst_domain \\<theta>) \\<Longrightarrow>\n    \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "thus \"\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\""], ["proof (prove)\nusing this:\n  finite (subst_domain \\<theta>)\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "proof (induction \\<theta> rule: fsubst_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. subst_domain Var \\<inter> range_vars Var = {} \\<Longrightarrow>\n    Var \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "case fvar"], ["proof (state)\nthis:\n  subst_domain Var \\<inter> range_vars Var = {}\n\ngoal (2 subgoals):\n 1. subst_domain Var \\<inter> range_vars Var = {} \\<Longrightarrow>\n    Var \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "thus ?case"], ["proof (prove)\nusing this:\n  subst_domain Var \\<inter> range_vars Var = {}\n\ngoal (1 subgoal):\n 1. Var \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "by simp"], ["proof (state)\nthis:\n  Var \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "case (FUpdate \\<delta> v t)"], ["proof (state)\nthis:\n  finite (subst_domain \\<delta>)\n  v \\<notin> subst_domain \\<delta>\n  t \\<noteq> Var v\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {} \\<Longrightarrow>\n  \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  subst_domain (\\<delta>(v := t)) \\<inter> range_vars (\\<delta>(v := t)) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "have \"subst_domain \\<delta> \\<subseteq> subst_domain (\\<delta>(v := t))\" \"range_vars \\<delta> \\<subseteq> range_vars (\\<delta>(v := t))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<subseteq> subst_domain (\\<delta>(v := t)) &&&\n    range_vars \\<delta> \\<subseteq> range_vars (\\<delta>(v := t))", "using FUpdate.hyps(2,3) subst_img_update"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<delta>\n  t \\<noteq> Var v\n  \\<lbrakk>?\\<sigma> ?v = Var ?v; ?t \\<noteq> Var ?v\\<rbrakk>\n  \\<Longrightarrow> range_vars (?\\<sigma>(?v := ?t)) =\n                    range_vars ?\\<sigma> \\<union> fv ?t\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<subseteq> subst_domain (\\<delta>(v := t)) &&&\n    range_vars \\<delta> \\<subseteq> range_vars (\\<delta>(v := t))", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<delta>\n  t \\<noteq> Var v\n  \\<lbrakk>?\\<sigma> ?v = Var ?v; ?t \\<noteq> Var ?v\\<rbrakk>\n  \\<Longrightarrow> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (?\\<sigma>(?v := ?t))) =\n                    fv\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range ?\\<sigma>) \\<union>\n                    fv ?t\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<subseteq> subst_domain (\\<delta>(v := t)) &&&\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<delta>(v := t)))", "by (fastforce simp add: subst_domain_def)+"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<subseteq> subst_domain (\\<delta>(v := t))\n  range_vars \\<delta> \\<subseteq> range_vars (\\<delta>(v := t))\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "hence \"subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\""], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<subseteq> subst_domain (\\<delta>(v := t))\n  range_vars \\<delta> \\<subseteq> range_vars (\\<delta>(v := t))\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}", "using FUpdate.prems(1)"], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<subseteq> subst_domain (\\<delta>(v := t))\n  range_vars \\<delta> \\<subseteq> range_vars (\\<delta>(v := t))\n  subst_domain (\\<delta>(v := t)) \\<inter> range_vars (\\<delta>(v := t)) =\n  {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "hence \"\\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\""], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\n\ngoal (1 subgoal):\n 1. \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "using FUpdate.IH"], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {} \\<Longrightarrow>\n  \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n\ngoal (1 subgoal):\n 1. \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "by metis"], ["proof (state)\nthis:\n  \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "have *: \"range_vars (\\<delta>(v := t)) = range_vars \\<delta> \\<union> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars (\\<delta>(v := t)) = range_vars \\<delta> \\<union> fv t", "using FUpdate.hyps(2) subst_img_update[OF _ FUpdate.hyps(3)]"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<delta>\n  ?\\<sigma> v = Var v \\<Longrightarrow>\n  range_vars (?\\<sigma>(v := t)) = range_vars ?\\<sigma> \\<union> fv t\n\ngoal (1 subgoal):\n 1. range_vars (\\<delta>(v := t)) = range_vars \\<delta> \\<union> fv t", "by fastforce"], ["proof (state)\nthis:\n  range_vars (\\<delta>(v := t)) = range_vars \\<delta> \\<union> fv t\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "hence \"fv t \\<inter> insert v (subst_domain \\<delta>) = {}\""], ["proof (prove)\nusing this:\n  range_vars (\\<delta>(v := t)) = range_vars \\<delta> \\<union> fv t\n\ngoal (1 subgoal):\n 1. fv t \\<inter> insert v (subst_domain \\<delta>) = {}", "using FUpdate.prems subst_dom_update2[OF FUpdate.hyps(3)]"], ["proof (prove)\nusing this:\n  range_vars (\\<delta>(v := t)) = range_vars \\<delta> \\<union> fv t\n  subst_domain (\\<delta>(v := t)) \\<inter> range_vars (\\<delta>(v := t)) =\n  {}\n  subst_domain (?\\<sigma>(v := t)) = insert v (subst_domain ?\\<sigma>)\n\ngoal (1 subgoal):\n 1. fv t \\<inter> insert v (subst_domain \\<delta>) = {}", "by blast"], ["proof (state)\nthis:\n  fv t \\<inter> insert v (subst_domain \\<delta>) = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "moreover"], ["proof (state)\nthis:\n  fv t \\<inter> insert v (subst_domain \\<delta>) = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "have \"subst_domain (\\<delta>(v := t)) = insert v (subst_domain \\<delta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<delta>(v := t)) = insert v (subst_domain \\<delta>)", "by (meson FUpdate.hyps(3) subst_dom_update2)"], ["proof (state)\nthis:\n  subst_domain (\\<delta>(v := t)) = insert v (subst_domain \\<delta>)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "hence \"v \\<notin> range_vars \\<delta>\""], ["proof (prove)\nusing this:\n  subst_domain (\\<delta>(v := t)) = insert v (subst_domain \\<delta>)\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<delta>", "using FUpdate.prems *"], ["proof (prove)\nusing this:\n  subst_domain (\\<delta>(v := t)) = insert v (subst_domain \\<delta>)\n  subst_domain (\\<delta>(v := t)) \\<inter> range_vars (\\<delta>(v := t)) =\n  {}\n  range_vars (\\<delta>(v := t)) = range_vars \\<delta> \\<union> fv t\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<delta>", "by blast"], ["proof (state)\nthis:\n  v \\<notin> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; t \\<noteq> Var v;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> =\n        {} \\<Longrightarrow>\n        \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain (\\<theta>(v := t)) \\<inter>\n        range_vars (\\<theta>(v := t)) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> \\<theta>(v := t)\n                         \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "ultimately"], ["proof (chain)\npicking this:\n  fv t \\<inter> insert v (subst_domain \\<delta>) = {}\n  v \\<notin> range_vars \\<delta>", "show ?case"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<delta>) = {}\n  v \\<notin> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. \\<delta>(v := t) \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "using Insert[OF \\<open>\\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\\<close> \\<open>v \\<notin> subst_domain \\<delta>\\<close>]"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<delta>) = {}\n  v \\<notin> range_vars \\<delta>\n  \\<lbrakk>v \\<notin> range_vars \\<delta>;\n   fv ?t \\<inter> insert v (subst_domain \\<delta>) = {}\\<rbrakk>\n  \\<Longrightarrow> \\<delta>(v := ?t)\n                    \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n\ngoal (1 subgoal):\n 1. \\<delta>(v := t) \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set", "by metis"], ["proof (state)\nthis:\n  \\<delta>(v := t) \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow>\n  \\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n\ngoal (1 subgoal):\n 1. \\<theta>\n    \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "show \"\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta>\n    \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<theta>\n    \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set \\<Longrightarrow>\n    subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n    finite (subst_domain \\<theta>)", "proof (induction \\<theta> rule: wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set.induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. subst_domain Var \\<inter> range_vars Var = {} \\<and>\n    finite (subst_domain Var)\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "case Empty"], ["proof (state)\nthis:\n  \n\ngoal (2 subgoals):\n 1. subst_domain Var \\<inter> range_vars Var = {} \\<and>\n    finite (subst_domain Var)\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "thus ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain Var \\<inter> range_vars Var = {} \\<and>\n    finite (subst_domain Var)", "by simp"], ["proof (state)\nthis:\n  subst_domain Var \\<inter> range_vars Var = {} \\<and>\n  finite (subst_domain Var)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "case (Insert \\<sigma> v t)"], ["proof (state)\nthis:\n  \\<sigma> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  v \\<notin> subst_domain \\<sigma>\n  v \\<notin> range_vars \\<sigma>\n  fv t \\<inter> insert v (subst_domain \\<sigma>) = {}\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {} \\<and>\n  finite (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "hence 1: \"subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\""], ["proof (prove)\nusing this:\n  \\<sigma> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  v \\<notin> subst_domain \\<sigma>\n  v \\<notin> range_vars \\<sigma>\n  fv t \\<inter> insert v (subst_domain \\<sigma>) = {}\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {} \\<and>\n  finite (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "by simp"], ["proof (state)\nthis:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "hence 2: \"subst_domain (\\<sigma>(v := t)) \\<inter> range_vars \\<sigma> = {}\""], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars \\<sigma> = {}", "using Insert.hyps(3)"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n  v \\<notin> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars \\<sigma> = {}", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "have 3: \"fv t \\<inter> subst_domain (\\<sigma>(v := t)) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain (\\<sigma>(v := t)) = {}", "using Insert.hyps(4)"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<sigma>) = {}\n\ngoal (1 subgoal):\n 1. fv t \\<inter> subst_domain (\\<sigma>(v := t)) = {}", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  fv t \\<inter> subst_domain (\\<sigma>(v := t)) = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "have 4: \"\\<sigma> v = Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma> v = Var v", "using \\<open>v \\<notin> subst_domain \\<sigma>\\<close>"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<sigma> v = Var v", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<sigma> v = Var v\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "from Insert.IH"], ["proof (chain)\npicking this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {} \\<and>\n  finite (subst_domain \\<sigma>)", "have \"finite (subst_domain \\<sigma>)\""], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {} \\<and>\n  finite (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. finite (subst_domain \\<sigma>)", "by simp"], ["proof (state)\nthis:\n  finite (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "hence 5: \"finite (subst_domain (\\<sigma>(v := t)))\""], ["proof (prove)\nusing this:\n  finite (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. finite (subst_domain (\\<sigma>(v := t)))", "using subst_dom_insert_finite[of \\<sigma>]"], ["proof (prove)\nusing this:\n  finite (subst_domain \\<sigma>)\n  finite (subst_domain \\<sigma>) =\n  finite (subst_domain (\\<sigma>(?v := ?t)))\n\ngoal (1 subgoal):\n 1. finite (subst_domain (\\<sigma>(v := t)))", "by simp"], ["proof (state)\nthis:\n  finite (subst_domain (\\<sigma>(v := t)))\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "have \"subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "proof (cases \"t = Var v\")"], ["proof (state)\ngoal (2 subgoals):\n 1. t = Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}\n 2. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "case True"], ["proof (state)\nthis:\n  t = Var v\n\ngoal (2 subgoals):\n 1. t = Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}\n 2. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "hence \"range_vars (\\<sigma>(v := t)) = range_vars \\<sigma>\""], ["proof (prove)\nusing this:\n  t = Var v\n\ngoal (1 subgoal):\n 1. range_vars (\\<sigma>(v := t)) = range_vars \\<sigma>", "using 4 fun_upd_triv term.inject(1)"], ["proof (prove)\nusing this:\n  t = Var v\n  \\<sigma> v = Var v\n  ?f(?x := ?f ?x) = ?f\n  (Var ?x1.0 = Var ?y1.0) = (?x1.0 = ?y1.0)\n\ngoal (1 subgoal):\n 1. range_vars (\\<sigma>(v := t)) = range_vars \\<sigma>", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  t = Var v\n  \\<sigma> v = Var v\n  ?f(?x := ?f ?x) = ?f\n  (Var ?x1.0 = Var ?y1.0) = (?x1.0 = ?y1.0)\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<sigma>(v := t))) =\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  range_vars (\\<sigma>(v := t)) = range_vars \\<sigma>\n\ngoal (2 subgoals):\n 1. t = Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}\n 2. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "thus \"subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) = {}\""], ["proof (prove)\nusing this:\n  range_vars (\\<sigma>(v := t)) = range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "using 1 2 3"], ["proof (prove)\nusing this:\n  range_vars (\\<sigma>(v := t)) = range_vars \\<sigma>\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars \\<sigma> = {}\n  fv t \\<inter> subst_domain (\\<sigma>(v := t)) = {}\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "by auto"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n  {}\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "case False"], ["proof (state)\nthis:\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "hence \"range_vars (\\<sigma>(v := t)) = fv t \\<union> (range_vars \\<sigma>)\""], ["proof (prove)\nusing this:\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. range_vars (\\<sigma>(v := t)) = fv t \\<union> range_vars \\<sigma>", "using 4 subst_img_update[of \\<sigma> v]"], ["proof (prove)\nusing this:\n  t \\<noteq> Var v\n  \\<sigma> v = Var v\n  \\<lbrakk>\\<sigma> v = Var v; ?t \\<noteq> Var v\\<rbrakk>\n  \\<Longrightarrow> range_vars (\\<sigma>(v := ?t)) =\n                    range_vars \\<sigma> \\<union> fv ?t\n\ngoal (1 subgoal):\n 1. range_vars (\\<sigma>(v := t)) = fv t \\<union> range_vars \\<sigma>", "by auto"], ["proof (state)\nthis:\n  range_vars (\\<sigma>(v := t)) = fv t \\<union> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow>\n    subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "thus \"subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) = {}\""], ["proof (prove)\nusing this:\n  range_vars (\\<sigma>(v := t)) = fv t \\<union> range_vars \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "using 1 2 3"], ["proof (prove)\nusing this:\n  range_vars (\\<sigma>(v := t)) = fv t \\<union> range_vars \\<sigma>\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars \\<sigma> = {}\n  fv t \\<inter> subst_domain (\\<sigma>(v := t)) = {}\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {}", "by blast"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n  {}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>\\<theta>\n                \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n        subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n        finite (subst_domain \\<theta>);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> subst_domain (\\<theta>(v := t)) \\<inter>\n                         range_vars (\\<theta>(v := t)) =\n                         {} \\<and>\n                         finite (subst_domain (\\<theta>(v := t)))", "thus ?case"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n  {}\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {} \\<and>\n    finite (subst_domain (\\<sigma>(v := t)))", "using 5"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n  {}\n  finite (subst_domain (\\<sigma>(v := t)))\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n    {} \\<and>\n    finite (subst_domain (\\<sigma>(v := t)))", "by blast"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>(v := t)) \\<inter> range_vars (\\<sigma>(v := t)) =\n  {} \\<and>\n  finite (subst_domain (\\<sigma>(v := t)))\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<theta>\n  \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set \\<Longrightarrow>\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_induct[consumes 1, case_names Empty Insert]:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta>\" \"P Var\"\n  and \"\\<And>\\<theta> v t. \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>; P \\<theta>; v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n                fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n                \\<Longrightarrow> P (\\<theta>(v := t))\"\n  shows \"P \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<delta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. P \\<delta>", "from assms(1,3) wf_subst_properties"], ["proof (chain)\npicking this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta>\n  \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta>;\n   P ?\\<theta>; ?v \\<notin> subst_domain ?\\<theta>;\n   ?v \\<notin> range_vars ?\\<theta>;\n   fv ?t \\<inter> insert ?v (subst_domain ?\\<theta>) = {}\\<rbrakk>\n  \\<Longrightarrow> P (?\\<theta>(?v := ?t))\n  (?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set) =\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta>", "have\n    \"\\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\"\n    \"\\<And>\\<theta> v t. \\<lbrakk>\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set; P \\<theta>; v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n              fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n              \\<Longrightarrow> P (\\<theta>(v := t))\""], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta>\n  \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta>;\n   P ?\\<theta>; ?v \\<notin> subst_domain ?\\<theta>;\n   ?v \\<notin> range_vars ?\\<theta>;\n   fv ?t \\<inter> insert ?v (subst_domain ?\\<theta>) = {}\\<rbrakk>\n  \\<Longrightarrow> P (?\\<theta>(?v := ?t))\n  (?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set) =\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta>\n\ngoal (1 subgoal):\n 1. \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set &&&\n    (\\<And>\\<theta> v t.\n        \\<lbrakk>\\<theta>\n                 \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n         P \\<theta>; v \\<notin> subst_domain \\<theta>;\n         v \\<notin> range_vars \\<theta>;\n         fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n        \\<Longrightarrow> P (\\<theta>(v := t)))", "by blast+"], ["proof (state)\nthis:\n  \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  \\<lbrakk>?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n   P ?\\<theta>; ?v \\<notin> subst_domain ?\\<theta>;\n   ?v \\<notin> range_vars ?\\<theta>;\n   fv ?t \\<inter> insert ?v (subst_domain ?\\<theta>) = {}\\<rbrakk>\n  \\<Longrightarrow> P (?\\<theta>(?v := ?t))\n\ngoal (1 subgoal):\n 1. P \\<delta>", "thus \"P \\<delta>\""], ["proof (prove)\nusing this:\n  \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  \\<lbrakk>?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n   P ?\\<theta>; ?v \\<notin> subst_domain ?\\<theta>;\n   ?v \\<notin> range_vars ?\\<theta>;\n   fv ?t \\<inter> insert ?v (subst_domain ?\\<theta>) = {}\\<rbrakk>\n  \\<Longrightarrow> P (?\\<theta>(?v := ?t))\n\ngoal (1 subgoal):\n 1. P \\<delta>", "using wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set.induct assms(2)"], ["proof (prove)\nusing this:\n  \\<delta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  \\<lbrakk>?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n   P ?\\<theta>; ?v \\<notin> subst_domain ?\\<theta>;\n   ?v \\<notin> range_vars ?\\<theta>;\n   fv ?t \\<inter> insert ?v (subst_domain ?\\<theta>) = {}\\<rbrakk>\n  \\<Longrightarrow> P (?\\<theta>(?v := ?t))\n  \\<lbrakk>?x \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set; ?P Var;\n   \\<And>\\<theta> v t.\n      \\<lbrakk>\\<theta>\n               \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n       ?P \\<theta>; v \\<notin> subst_domain \\<theta>;\n       v \\<notin> range_vars \\<theta>;\n       fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n      \\<Longrightarrow> ?P (\\<theta>(v := t))\\<rbrakk>\n  \\<Longrightarrow> ?P ?x\n  P Var\n\ngoal (1 subgoal):\n 1. P \\<delta>", "by blast"], ["proof (state)\nthis:\n  P \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma wf_subst_fsubst: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta> \\<Longrightarrow> \\<delta> \\<in> fsubst\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta> \\<Longrightarrow>\n    \\<delta> \\<in> fsubst", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> range_vars \\<delta> = {} \\<and>\n    finite (subst_domain \\<delta>) \\<Longrightarrow>\n    \\<delta> \\<in> fsubst", "using finite_dom_iff_fsubst"], ["proof (prove)\nusing this:\n  finite (subst_domain ?\\<theta>) = (?\\<theta> \\<in> fsubst)\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> range_vars \\<delta> = {} \\<and>\n    finite (subst_domain \\<delta>) \\<Longrightarrow>\n    \\<delta> \\<in> fsubst", "by blast"], ["", "lemma wf_subst_nil: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t Var\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t Var", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain Var \\<inter> range_vars Var = {} \\<and>\n    finite (subst_domain Var)", "by simp"], ["", "lemma wf_MGU_nil: \"MGU Var s t \\<Longrightarrow> wf\\<^sub>M\\<^sub>G\\<^sub>U Var s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU Var s t \\<Longrightarrow> wf\\<^sub>M\\<^sub>G\\<^sub>U Var s t", "using wf_subst_nil subst_domain_Var range_vars_Var"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t Var\n  subst_domain Var = {}\n  range_vars Var = {}\n\ngoal (1 subgoal):\n 1. MGU Var s t \\<Longrightarrow> wf\\<^sub>M\\<^sub>G\\<^sub>U Var s t", "unfolding wf\\<^sub>M\\<^sub>G\\<^sub>U_def"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t Var\n  subst_domain Var = {}\n  range_vars Var = {}\n\ngoal (1 subgoal):\n 1. MGU Var s t \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t Var \\<and>\n    MGU Var s t \\<and>\n    subst_domain Var \\<union> range_vars Var \\<subseteq> fv s \\<union> fv t", "by fast"], ["", "lemma wf_MGU_dom_bound: \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow> subst_domain \\<theta> \\<subseteq> fv s \\<union> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow>\n    subst_domain \\<theta> \\<subseteq> fv s \\<union> fv t", "unfolding wf\\<^sub>M\\<^sub>G\\<^sub>U_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<and>\n    MGU \\<theta> s t \\<and>\n    subst_domain \\<theta> \\<union> range_vars \\<theta>\n    \\<subseteq> fv s \\<union> fv t \\<Longrightarrow>\n    subst_domain \\<theta> \\<subseteq> fv s \\<union> fv t", "by blast"], ["", "lemma wf_subst_single:\n  assumes \"v \\<notin> fv t\" \"\\<sigma> v = t\" \"\\<And>w. v \\<noteq> w \\<Longrightarrow> \\<sigma> w = Var w\"\n  shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "have *: \"subst_domain \\<sigma> = {v}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> = {v}", "by (metis subst_fv_dom_img_single(1)[OF assms])"], ["proof (state)\nthis:\n  subst_domain \\<sigma> = {v}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "have \"subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "using * assms subst_fv_dom_img_single(2)"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> = {v}\n  v \\<notin> fv t\n  \\<sigma> v = t\n  v \\<noteq> ?w \\<Longrightarrow> \\<sigma> ?w = Var ?w\n  \\<lbrakk>?v \\<notin> fv ?t; ?\\<sigma> ?v = ?t;\n   \\<And>w. ?v \\<noteq> w \\<Longrightarrow> ?\\<sigma> w = Var w\\<rbrakk>\n  \\<Longrightarrow> range_vars ?\\<sigma> = fv ?t\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "by (metis inf_bot_left insert_disjoint(1))"], ["proof (state)\nthis:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "moreover"], ["proof (state)\nthis:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "have \"finite (subst_domain \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain \\<sigma>)", "using *"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> = {v}\n\ngoal (1 subgoal):\n 1. finite (subst_domain \\<sigma>)", "by simp"], ["proof (state)\nthis:\n  finite (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n  finite (subst_domain \\<sigma>)", "show ?thesis"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n  finite (subst_domain \\<sigma>)\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "by (metis wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def)"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma wf_subst_reduction:\n  \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "assume \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s\""], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "moreover"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "have \"subst_domain (rm_var v s) \\<subseteq> subst_domain s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_var v s) \\<subseteq> subst_domain s", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (rm_var v s) \\<subseteq> subst_domain s\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "moreover"], ["proof (state)\nthis:\n  subst_domain (rm_var v s) \\<subseteq> subst_domain s\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "have \"range_vars (rm_var v s) \\<subseteq> range_vars s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars (rm_var v s) \\<subseteq> range_vars s", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (rm_var v s))\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range s)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  range_vars (rm_var v s) \\<subseteq> range_vars s\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "ultimately"], ["proof (chain)\npicking this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s\n  subst_domain (rm_var v s) \\<subseteq> subst_domain s\n  range_vars (rm_var v s) \\<subseteq> range_vars s", "have \"subst_domain (rm_var v s) \\<inter> range_vars (rm_var v s) = {}\""], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s\n  subst_domain (rm_var v s) \\<subseteq> subst_domain s\n  range_vars (rm_var v s) \\<subseteq> range_vars s\n\ngoal (1 subgoal):\n 1. subst_domain (rm_var v s) \\<inter> range_vars (rm_var v s) = {}", "by (meson compl_le_compl_iff disjoint_eq_subset_Compl subset_trans wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def)"], ["proof (state)\nthis:\n  subst_domain (rm_var v s) \\<inter> range_vars (rm_var v s) = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "moreover"], ["proof (state)\nthis:\n  subst_domain (rm_var v s) \\<inter> range_vars (rm_var v s) = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "have \"finite (subst_domain (rm_var v s))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (subst_domain (rm_var v s))", "using \\<open>subst_domain (rm_var v s) \\<subseteq> subst_domain s\\<close> \\<open>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s\\<close> rev_finite_subset"], ["proof (prove)\nusing this:\n  subst_domain (rm_var v s) \\<subseteq> subst_domain s\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s\n  \\<lbrakk>finite ?B; ?A \\<subseteq> ?B\\<rbrakk> \\<Longrightarrow> finite ?A\n\ngoal (1 subgoal):\n 1. finite (subst_domain (rm_var v s))", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\nusing this:\n  subst_domain (rm_var v s) \\<subseteq> subst_domain s\n  subst_domain s \\<inter> range_vars s = {} \\<and> finite (subst_domain s)\n  \\<lbrakk>finite ?B; ?A \\<subseteq> ?B\\<rbrakk> \\<Longrightarrow> finite ?A\n\ngoal (1 subgoal):\n 1. finite (subst_domain (rm_var v s))", "by blast"], ["proof (state)\nthis:\n  finite (subst_domain (rm_var v s))\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t s \\<Longrightarrow>\n    wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain (rm_var v s) \\<inter> range_vars (rm_var v s) = {}\n  finite (subst_domain (rm_var v s))", "show \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)\""], ["proof (prove)\nusing this:\n  subst_domain (rm_var v s) \\<inter> range_vars (rm_var v s) = {}\n  finite (subst_domain (rm_var v s))\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)", "by (metis wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def)"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (rm_var v s)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma wf_subst_compose:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>1\" \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\"\n    and \"subst_domain \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\"\n    and \"subst_domain \\<theta>1 \\<inter> range_vars \\<theta>2 = {}\"\n  shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)", "using assms"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>1\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<theta>1 \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta>1 \\<circ>\\<^sub>s \\<theta>2)", "proof (induction \\<theta>1 rule: wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n     subst_domain Var \\<inter> subst_domain \\<theta>2 = {};\n     subst_domain Var \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n    \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                       (Var \\<circ>\\<^sub>s \\<theta>2)\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "case Empty"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain Var \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain Var \\<inter> range_vars \\<theta>2 = {}\n\ngoal (2 subgoals):\n 1. \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n     subst_domain Var \\<inter> subst_domain \\<theta>2 = {};\n     subst_domain Var \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n    \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                       (Var \\<circ>\\<^sub>s \\<theta>2)\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "thus ?case"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain Var \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain Var \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (Var \\<circ>\\<^sub>s \\<theta>2)", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {} \\<and>\n  finite (subst_domain \\<theta>2)\n  subst_domain Var \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain Var \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. subst_domain (Var \\<circ>\\<^sub>s \\<theta>2) \\<inter>\n    range_vars (Var \\<circ>\\<^sub>s \\<theta>2) =\n    {} \\<and>\n    finite (subst_domain (Var \\<circ>\\<^sub>s \\<theta>2))", "by simp"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (Var \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "case (Insert \\<sigma>1 v t)"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>1\n  v \\<notin> subst_domain \\<sigma>1\n  v \\<notin> range_vars \\<sigma>1\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n  \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n   subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {};\n   subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n  \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                     (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"t \\<noteq> Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t \\<noteq> Var v", "using Insert.hyps(4)"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v", "by auto"], ["proof (state)\nthis:\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence dom1v_unfold: \"subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\""], ["proof (prove)\nusing this:\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)", "using subst_dom_update2"], ["proof (prove)\nusing this:\n  t \\<noteq> Var v\n  ?t \\<noteq> Var ?v \\<Longrightarrow>\n  subst_domain (?\\<sigma>(?v := ?t)) = insert ?v (subst_domain ?\\<sigma>)\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)", "by metis"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence doms_disj: \"subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\""], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}", "using Insert.prems(2) disjoint_insert(1)"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n  subst_domain (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  (?B \\<inter> insert ?a ?A = {}) =\n  (?a \\<notin> ?B \\<and> ?B \\<inter> ?A = {})\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "moreover"], ["proof (state)\nthis:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have dom_img_disj: \"subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}", "using Insert.hyps(2) Insert.prems(3)"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<sigma>1\n  subst_domain (\\<sigma>1(v := t)) \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}", "by (fastforce simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}", "have \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\""], ["proof (prove)\nusing this:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)", "using Insert.IH[OF \\<open>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\\<close>]"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n  \\<lbrakk>subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {};\n   subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n  \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                     (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)", "by metis"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have dom_comp_is_union: \"subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) = subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) =\n    subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2", "using subst_dom_comp_eq[OF dom_img_disj]"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) =\n  subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) =\n    subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2", "."], ["proof (state)\nthis:\n  subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) =\n  subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"v \\<notin> subst_domain \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain \\<theta>2", "using Insert.prems(2) \\<open>t \\<noteq> Var v\\<close>"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain \\<theta>2", "by (fastforce simp add: subst_domain_def)"], ["proof (state)\nthis:\n  v \\<notin> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence \"\\<theta>2 v = Var v\" \"\\<sigma>1 v = Var v\""], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<theta>2 v = Var v &&& \\<sigma>1 v = Var v", "using Insert.hyps(2)"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<theta>2\n  v \\<notin> subst_domain \\<sigma>1\n\ngoal (1 subgoal):\n 1. \\<theta>2 v = Var v &&& \\<sigma>1 v = Var v", "by (simp_all add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<theta>2 v = Var v\n  \\<sigma>1 v = Var v\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence \"(\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) v = Var v\" \"(\\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2) v = t \\<cdot> \\<theta>2\" \"((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t)) v = t\""], ["proof (prove)\nusing this:\n  \\<theta>2 v = Var v\n  \\<sigma>1 v = Var v\n\ngoal (1 subgoal):\n 1. (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) v = Var v &&&\n    (\\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2) v =\n    t \\<cdot> \\<theta>2 &&&\n    ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t)) v = t", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  \\<theta>2 v = Var v\n  \\<sigma>1 v = Var v\n\ngoal (1 subgoal):\n 1. \\<sigma>1 v \\<cdot> \\<theta>2 = Var v &&&\n    Unifier \\<theta>2 ((\\<sigma>1(v := t)) v) t &&&\n    ((\\<lambda>x. \\<sigma>1 x \\<cdot> \\<theta>2)(v := t)) v = t", "by simp_all"], ["proof (state)\nthis:\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) v = Var v\n  (\\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2) v = t \\<cdot> \\<theta>2\n  ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t)) v = t\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have fv_t2_bound: \"fv (t \\<cdot> \\<theta>2) \\<subseteq> fv t \\<union> range_vars \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<subseteq> fv t \\<union> range_vars \\<theta>2", "by (meson subst_sends_fv_to_img)"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<theta>2) \\<subseteq> fv t \\<union> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have 1: \"v \\<notin> subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)", "using \\<open>(\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) v = Var v\\<close>"], ["proof (prove)\nusing this:\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) v = Var v\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  v \\<notin> subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"insert v (subst_domain \\<sigma>1) \\<inter> range_vars \\<theta>2 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. insert v (subst_domain \\<sigma>1) \\<inter> range_vars \\<theta>2 = {}", "using Insert.prems(3) dom1v_unfold"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter> range_vars \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. insert v (subst_domain \\<sigma>1) \\<inter> range_vars \\<theta>2 = {}", "by blast"], ["proof (state)\nthis:\n  insert v (subst_domain \\<sigma>1) \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence \"v \\<notin> range_vars \\<sigma>1 \\<union> range_vars \\<theta>2\""], ["proof (prove)\nusing this:\n  insert v (subst_domain \\<sigma>1) \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<sigma>1 \\<union> range_vars \\<theta>2", "using Insert.hyps(3)"], ["proof (prove)\nusing this:\n  insert v (subst_domain \\<sigma>1) \\<inter> range_vars \\<theta>2 = {}\n  v \\<notin> range_vars \\<sigma>1\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<sigma>1 \\<union> range_vars \\<theta>2", "by blast"], ["proof (state)\nthis:\n  v \\<notin> range_vars \\<sigma>1 \\<union> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence 2: \"v \\<notin> range_vars (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\""], ["proof (prove)\nusing this:\n  v \\<notin> range_vars \\<sigma>1 \\<union> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)", "by (meson set_rev_mp subst_img_comp_subset)"], ["proof (state)\nthis:\n  v \\<notin> range_vars (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {}", "using \\<open>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\\<close>"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {}", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {} \\<and>\n  finite (subst_domain \\<theta>2)\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {}", "by simp"], ["proof (state)\nthis:\n  subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence \"fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}\""], ["proof (prove)\nusing this:\n  subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}", "using subst_dom_elim"], ["proof (prove)\nusing this:\n  subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {}\n  subst_domain ?s \\<inter> range_vars ?s = {} \\<Longrightarrow>\n  fv (?t \\<cdot> ?s) \\<inter> subst_domain ?s = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta>2 \\<inter>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) =\n  {}\n  subst_domain ?s \\<inter> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range ?s) =\n  {} \\<Longrightarrow>\n  fv (?t \\<cdot> ?s) \\<inter> subst_domain ?s = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}", "by simp"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "moreover"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"v \\<notin> range_vars \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<theta>2", "using Insert.prems(3) dom1v_unfold"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter> range_vars \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars \\<theta>2", "by blast"], ["proof (state)\nthis:\n  v \\<notin> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence \"v \\<notin> fv t \\<union> range_vars \\<theta>2\""], ["proof (prove)\nusing this:\n  v \\<notin> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t \\<union> range_vars \\<theta>2", "using Insert.hyps(4)"], ["proof (prove)\nusing this:\n  v \\<notin> range_vars \\<theta>2\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t \\<union> range_vars \\<theta>2", "by blast"], ["proof (state)\nthis:\n  v \\<notin> fv t \\<union> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "hence \"v \\<notin> fv (t \\<cdot> \\<theta>2)\""], ["proof (prove)\nusing this:\n  v \\<notin> fv t \\<union> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. v \\<notin> fv (t \\<cdot> \\<theta>2)", "using \\<open>fv (t \\<cdot> \\<theta>2) \\<subseteq> fv t \\<union> range_vars \\<theta>2\\<close>"], ["proof (prove)\nusing this:\n  v \\<notin> fv t \\<union> range_vars \\<theta>2\n  fv (t \\<cdot> \\<theta>2) \\<subseteq> fv t \\<union> range_vars \\<theta>2\n\ngoal (1 subgoal):\n 1. v \\<notin> fv (t \\<cdot> \\<theta>2)", "by blast"], ["proof (state)\nthis:\n  v \\<notin> fv (t \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "moreover"], ["proof (state)\nthis:\n  v \\<notin> fv (t \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<sigma>1 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<sigma>1 = {}", "using dom_img_disj fv_t2_bound \\<open>fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\\<close>"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n  fv (t \\<cdot> \\<theta>2) \\<subseteq> fv t \\<union> range_vars \\<theta>2\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<sigma>1 = {}", "by blast"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<sigma>1 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "ultimately"], ["proof (chain)\npicking this:\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}\n  v \\<notin> fv (t \\<cdot> \\<theta>2)\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<sigma>1 = {}", "have 3: \"fv (t \\<cdot> \\<theta>2) \\<inter> insert v (subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)) = {}\""], ["proof (prove)\nusing this:\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}\n  v \\<notin> fv (t \\<cdot> \\<theta>2)\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<sigma>1 = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<inter>\n    insert v (subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)) =\n    {}", "using dom_comp_is_union"], ["proof (prove)\nusing this:\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<theta>2 = {}\n  v \\<notin> fv (t \\<cdot> \\<theta>2)\n  fv (t \\<cdot> \\<theta>2) \\<inter> subst_domain \\<sigma>1 = {}\n  subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2) =\n  subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>2) \\<inter>\n    insert v (subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)) =\n    {}", "by blast"], ["proof (state)\nthis:\n  fv (t \\<cdot> \\<theta>2) \\<inter>\n  insert v (subst_domain (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"\\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 = (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 =\n    (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)", "using subst_comp_upd1[of \\<sigma>1 v t \\<theta>2]"], ["proof (prove)\nusing this:\n  \\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 =\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 =\n    (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)", "."], ["proof (state)\nthis:\n  \\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 =\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "moreover"], ["proof (state)\nthis:\n  \\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 =\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "have \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2))", "using \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set.Insert\"[OF _ 1 2 3] \\<open>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\\<close> wf_subst_properties"], ["proof (prove)\nusing this:\n  \\<sigma>1 \\<circ>\\<^sub>s \\<theta>2\n  \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set \\<Longrightarrow>\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)\n  \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)\n  (?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set) =\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2))", "by metis"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2))\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<theta> \\<circ>\\<^sub>s \\<theta>2);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<theta>(v := t) \\<circ>\\<^sub>s \\<theta>2)", "ultimately"], ["proof (chain)\npicking this:\n  \\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 =\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2))", "show ?case"], ["proof (prove)\nusing this:\n  \\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2 =\n  (\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2)\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   ((\\<sigma>1 \\<circ>\\<^sub>s \\<theta>2)(v := t \\<cdot> \\<theta>2))\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2)", "by presburger"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<sigma>1(v := t) \\<circ>\\<^sub>s \\<theta>2)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma wf_subst_append:\n  fixes \\<theta>1 \\<theta>2::\"('f,'v) subst\"\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>1\" \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\"\n    and \"subst_domain \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\"\n    and \"subst_domain \\<theta>1 \\<inter> range_vars \\<theta>2 = {}\"\n    and \"range_vars \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\"\n  shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<lambda>v. if \\<theta>1 v = Var v then \\<theta>2 v else \\<theta>1 v)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<lambda>v. if \\<theta>1 v = Var v then \\<theta>2 v else \\<theta>1 v)", "using assms"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>1\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<theta>1 \\<inter> range_vars \\<theta>2 = {}\n  range_vars \\<theta>1 \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<lambda>v. if \\<theta>1 v = Var v then \\<theta>2 v else \\<theta>1 v)", "proof (induction \\<theta>1 rule: wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n     subst_domain Var \\<inter> subst_domain \\<theta>2 = {};\n     subst_domain Var \\<inter> range_vars \\<theta>2 = {};\n     range_vars Var \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n    \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                       (\\<lambda>v.\n                           if Var v = Var v then \\<theta>2 v else Var v)\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "case Empty"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain Var \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain Var \\<inter> range_vars \\<theta>2 = {}\n  range_vars Var \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (2 subgoals):\n 1. \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n     subst_domain Var \\<inter> subst_domain \\<theta>2 = {};\n     subst_domain Var \\<inter> range_vars \\<theta>2 = {};\n     range_vars Var \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n    \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                       (\\<lambda>v.\n                           if Var v = Var v then \\<theta>2 v else Var v)\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "thus ?case"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain Var \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain Var \\<inter> range_vars \\<theta>2 = {}\n  range_vars Var \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<lambda>v. if Var v = Var v then \\<theta>2 v else Var v)", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta>2 \\<inter> range_vars \\<theta>2 = {} \\<and>\n  finite (subst_domain \\<theta>2)\n  subst_domain Var \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain Var \\<inter> range_vars \\<theta>2 = {}\n  range_vars Var \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. subst_domain\n     (\\<lambda>v. if Var v = Var v then \\<theta>2 v else Var v) \\<inter>\n    range_vars (\\<lambda>v. if Var v = Var v then \\<theta>2 v else Var v) =\n    {} \\<and>\n    finite\n     (subst_domain\n       (\\<lambda>v. if Var v = Var v then \\<theta>2 v else Var v))", "by simp"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<lambda>v. if Var v = Var v then \\<theta>2 v else Var v)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "case (Insert \\<sigma>1 v t)"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>1\n  v \\<notin> subst_domain \\<sigma>1\n  v \\<notin> range_vars \\<sigma>1\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n  \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n   subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {};\n   subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {};\n   range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n  \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                     (\\<lambda>v.\n                         if \\<sigma>1 v = Var v then \\<theta>2 v\n                         else \\<sigma>1 v)\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2\n  subst_domain (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) \\<inter> range_vars \\<theta>2 = {}\n  range_vars (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "let ?if = \"\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "let ?if_upd = \"\\<lambda>w. if (\\<sigma>1(v := t)) w = Var w then \\<theta>2 w else (\\<sigma>1(v := t)) w\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "from Insert.hyps(4)"], ["proof (chain)\npicking this:\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}", "have \"?if_upd = ?if(v := t)\""], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n\ngoal (1 subgoal):\n 1. (\\<lambda>w.\n        if (\\<sigma>1(v := t)) w = Var w then \\<theta>2 w\n        else (\\<sigma>1(v := t)) w) =\n    (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n    (v := t)", "by fastforce"], ["proof (state)\nthis:\n  (\\<lambda>w.\n      if (\\<sigma>1(v := t)) w = Var w then \\<theta>2 w\n      else (\\<sigma>1(v := t)) w) =\n  (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  (v := t)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "have dom_insert: \"subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)", "using Insert.hyps(4)"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "have \"\\<sigma>1 v = Var v\" \"t \\<noteq> Var v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<sigma>1 v = Var v &&& t \\<noteq> Var v", "using Insert.hyps(2,4)"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<sigma>1\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n\ngoal (1 subgoal):\n 1. \\<sigma>1 v = Var v &&& t \\<noteq> Var v", "by auto"], ["proof (state)\nthis:\n  \\<sigma>1 v = Var v\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "hence img_insert: \"range_vars (\\<sigma>1(v := t)) = range_vars \\<sigma>1 \\<union> fv t\""], ["proof (prove)\nusing this:\n  \\<sigma>1 v = Var v\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. range_vars (\\<sigma>1(v := t)) = range_vars \\<sigma>1 \\<union> fv t", "using subst_img_update"], ["proof (prove)\nusing this:\n  \\<sigma>1 v = Var v\n  t \\<noteq> Var v\n  \\<lbrakk>?\\<sigma> ?v = Var ?v; ?t \\<noteq> Var ?v\\<rbrakk>\n  \\<Longrightarrow> range_vars (?\\<sigma>(?v := ?t)) =\n                    range_vars ?\\<sigma> \\<union> fv ?t\n\ngoal (1 subgoal):\n 1. range_vars (\\<sigma>1(v := t)) = range_vars \\<sigma>1 \\<union> fv t", "by metis"], ["proof (state)\nthis:\n  range_vars (\\<sigma>1(v := t)) = range_vars \\<sigma>1 \\<union> fv t\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "from Insert.prems(2) dom_insert"], ["proof (chain)\npicking this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)", "have \"subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\""], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "moreover"], ["proof (state)\nthis:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "have \"subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}", "using Insert.prems(3) dom_insert"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter> range_vars \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "moreover"], ["proof (state)\nthis:\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "have \"range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}", "using Insert.prems(4) img_insert"], ["proof (prove)\nusing this:\n  range_vars (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  range_vars (\\<sigma>1(v := t)) = range_vars \\<sigma>1 \\<union> fv t\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}", "by blast"], ["proof (state)\nthis:\n  range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n  range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}", "have \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?if\""], ["proof (prove)\nusing this:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n  range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)", "using Insert.IH[OF Insert.prems(1)]"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {}\n  range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\n  \\<lbrakk>subst_domain \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {};\n   subst_domain \\<sigma>1 \\<inter> range_vars \\<theta>2 = {};\n   range_vars \\<sigma>1 \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n  \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                     (\\<lambda>v.\n                         if \\<sigma>1 v = Var v then \\<theta>2 v\n                         else \\<sigma>1 v)\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)", "by metis"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "have dom_union: \"subst_domain ?if = subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain\n     (\\<lambda>w.\n         if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w) =\n    subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain\n   (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w) =\n  subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "hence \"v \\<notin> subst_domain ?if\""], ["proof (prove)\nusing this:\n  subst_domain\n   (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w) =\n  subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain\n                (\\<lambda>w.\n                    if \\<sigma>1 w = Var w then \\<theta>2 w\n                    else \\<sigma>1 w)", "using Insert.hyps(2) Insert.prems(2) dom_insert"], ["proof (prove)\nusing this:\n  subst_domain\n   (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w) =\n  subst_domain \\<sigma>1 \\<union> subst_domain \\<theta>2\n  v \\<notin> subst_domain \\<sigma>1\n  subst_domain (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. v \\<notin> subst_domain\n                (\\<lambda>w.\n                    if \\<sigma>1 w = Var w then \\<theta>2 w\n                    else \\<sigma>1 w)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  v \\<notin> subst_domain\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "moreover"], ["proof (state)\nthis:\n  v \\<notin> subst_domain\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "have \"v \\<notin> range_vars ?if\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> range_vars\n                (\\<lambda>w.\n                    if \\<sigma>1 w = Var w then \\<theta>2 w\n                    else \\<sigma>1 w)", "using Insert.prems(3) Insert.hyps(3) dom_insert"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter> range_vars \\<theta>2 = {}\n  v \\<notin> range_vars \\<sigma>1\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. v \\<notin> range_vars\n                (\\<lambda>w.\n                    if \\<sigma>1 w = Var w then \\<theta>2 w\n                    else \\<sigma>1 w)", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma>1(v := t)) \\<inter>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>2) =\n  {}\n  v \\<notin> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>1)\n  subst_domain (\\<sigma>1(v := t)) = insert v (subst_domain \\<sigma>1)\n\ngoal (1 subgoal):\n 1. v \\<notin> fv\\<^sub>s\\<^sub>e\\<^sub>t\n                (subst_range\n                  (\\<lambda>w.\n                      if \\<sigma>1 w = Var w then \\<theta>2 w\n                      else \\<sigma>1 w))", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  v \\<notin> range_vars\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "moreover"], ["proof (state)\nthis:\n  v \\<notin> range_vars\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "have \"fv t \\<inter> insert v (subst_domain ?if) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv t \\<inter>\n    insert v\n     (subst_domain\n       (\\<lambda>w.\n           if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)) =\n    {}", "using Insert.hyps(4) Insert.prems(4) img_insert"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n  range_vars (\\<sigma>1(v := t)) \\<inter> subst_domain \\<theta>2 = {}\n  range_vars (\\<sigma>1(v := t)) = range_vars \\<sigma>1 \\<union> fv t\n\ngoal (1 subgoal):\n 1. fv t \\<inter>\n    insert v\n     (subst_domain\n       (\\<lambda>w.\n           if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)) =\n    {}", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert v (subst_domain \\<sigma>1) = {}\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<sigma>1(v := t))) \\<inter>\n  subst_domain \\<theta>2 =\n  {}\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (\\<sigma>1(v := t))) =\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<sigma>1) \\<union> fv t\n\ngoal (1 subgoal):\n 1. fv t \\<inter>\n    insert v\n     (subst_domain\n       (\\<lambda>w.\n           if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)) =\n    {}", "by (fastforce simp add: subst_domain_def)"], ["proof (state)\nthis:\n  fv t \\<inter>\n  insert v\n   (subst_domain\n     (\\<lambda>w.\n         if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n         subst_domain \\<theta> \\<inter> subst_domain \\<theta>2 = {};\n         subst_domain \\<theta> \\<inter> range_vars \\<theta>2 = {};\n         range_vars \\<theta> \\<inter> subst_domain \\<theta>2 = {}\\<rbrakk>\n        \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                           (\\<lambda>v.\n                               if \\<theta> v = Var v then \\<theta>2 v\n                               else \\<theta> v);\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {};\n        wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>2;\n        subst_domain (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {};\n        subst_domain (\\<theta>(v := t)) \\<inter> range_vars \\<theta>2 = {};\n        range_vars (\\<theta>(v := t)) \\<inter> subst_domain \\<theta>2 =\n        {}\\<rbrakk>\n       \\<Longrightarrow> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n                          (\\<lambda>va.\n                              if (\\<theta>(v := t)) va = Var va\n                              then \\<theta>2 va else (\\<theta>(v := t)) va)", "ultimately"], ["proof (chain)\npicking this:\n  v \\<notin> subst_domain\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  v \\<notin> range_vars\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  fv t \\<inter>\n  insert v\n   (subst_domain\n     (\\<lambda>w.\n         if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)) =\n  {}", "show ?case"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  v \\<notin> range_vars\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  fv t \\<inter>\n  insert v\n   (subst_domain\n     (\\<lambda>w.\n         if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)) =\n  {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<lambda>va.\n         if (\\<sigma>1(v := t)) va = Var va then \\<theta>2 va\n         else (\\<sigma>1(v := t)) va)", "using wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set.Insert \\<open>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?if\\<close> \\<open>?if_upd = ?if(v := t)\\<close> wf_subst_properties"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  v \\<notin> range_vars\n              (\\<lambda>w.\n                  if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  fv t \\<inter>\n  insert v\n   (subst_domain\n     (\\<lambda>w.\n         if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)) =\n  {}\n  \\<lbrakk>?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set;\n   ?v \\<notin> subst_domain ?\\<theta>; ?v \\<notin> range_vars ?\\<theta>;\n   fv ?t \\<inter> insert ?v (subst_domain ?\\<theta>) = {}\\<rbrakk>\n  \\<Longrightarrow> ?\\<theta>(?v := ?t)\n                    \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  (\\<lambda>w.\n      if (\\<sigma>1(v := t)) w = Var w then \\<theta>2 w\n      else (\\<sigma>1(v := t)) w) =\n  (\\<lambda>w. if \\<sigma>1 w = Var w then \\<theta>2 w else \\<sigma>1 w)\n  (v := t)\n  (?\\<theta> \\<in> wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_set) =\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<lambda>va.\n         if (\\<sigma>1(v := t)) va = Var va then \\<theta>2 va\n         else (\\<sigma>1(v := t)) va)", "by (metis (no_types, lifting))"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<lambda>va.\n       if (\\<sigma>1(v := t)) va = Var va then \\<theta>2 va\n       else (\\<sigma>1(v := t)) va)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma wf_subst_elim_append:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\" \"subst_elim \\<theta> v\" \"v \\<notin> fv t\"\n  shows \"subst_elim (\\<theta>(w := t)) v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_elim (\\<theta>(w := t)) v", "using assms"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n  subst_elim \\<theta> v\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. subst_elim (\\<theta>(w := t)) v", "proof (induction \\<theta> rule: wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>subst_elim Var v; v \\<notin> fv t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(w := t)) v\n 2. \\<And>\\<theta> va ta.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>subst_elim \\<theta> v; v \\<notin> fv t\\<rbrakk>\n        \\<Longrightarrow> subst_elim (\\<theta>(w := t)) v;\n        va \\<notin> subst_domain \\<theta>; va \\<notin> range_vars \\<theta>;\n        fv ta \\<inter> insert va (subst_domain \\<theta>) = {};\n        subst_elim (\\<theta>(va := ta)) v; v \\<notin> fv t\\<rbrakk>\n       \\<Longrightarrow> subst_elim (\\<theta>(va := ta, w := t)) v", "case (Insert \\<theta> v' t')"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n  v' \\<notin> subst_domain \\<theta>\n  v' \\<notin> range_vars \\<theta>\n  fv t' \\<inter> insert v' (subst_domain \\<theta>) = {}\n  \\<lbrakk>subst_elim \\<theta> v; v \\<notin> fv t\\<rbrakk>\n  \\<Longrightarrow> subst_elim (\\<theta>(w := t)) v\n  subst_elim (\\<theta>(v' := t')) v\n  v \\<notin> fv t\n\ngoal (2 subgoals):\n 1. \\<lbrakk>subst_elim Var v; v \\<notin> fv t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(w := t)) v\n 2. \\<And>\\<theta> va ta.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>subst_elim \\<theta> v; v \\<notin> fv t\\<rbrakk>\n        \\<Longrightarrow> subst_elim (\\<theta>(w := t)) v;\n        va \\<notin> subst_domain \\<theta>; va \\<notin> range_vars \\<theta>;\n        fv ta \\<inter> insert va (subst_domain \\<theta>) = {};\n        subst_elim (\\<theta>(va := ta)) v; v \\<notin> fv t\\<rbrakk>\n       \\<Longrightarrow> subst_elim (\\<theta>(va := ta, w := t)) v", "hence \"\\<And>q. v \\<notin> fv (Var q \\<cdot> \\<theta>(v' := t'))\""], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n  v' \\<notin> subst_domain \\<theta>\n  v' \\<notin> range_vars \\<theta>\n  fv t' \\<inter> insert v' (subst_domain \\<theta>) = {}\n  \\<lbrakk>subst_elim \\<theta> v; v \\<notin> fv t\\<rbrakk>\n  \\<Longrightarrow> subst_elim (\\<theta>(w := t)) v\n  subst_elim (\\<theta>(v' := t')) v\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. \\<And>q. v \\<notin> fv (Var q \\<cdot> \\<theta>(v' := t'))", "using subst_elimD"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n  v' \\<notin> subst_domain \\<theta>\n  v' \\<notin> range_vars \\<theta>\n  fv t' \\<inter> insert v' (subst_domain \\<theta>) = {}\n  \\<lbrakk>subst_elim \\<theta> v; v \\<notin> fv t\\<rbrakk>\n  \\<Longrightarrow> subst_elim (\\<theta>(w := t)) v\n  subst_elim (\\<theta>(v' := t')) v\n  v \\<notin> fv t\n  subst_elim ?\\<sigma> ?v \\<Longrightarrow>\n  ?v \\<notin> fv (?t \\<cdot> ?\\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<And>q. v \\<notin> fv (Var q \\<cdot> \\<theta>(v' := t'))", "by blast"], ["proof (state)\nthis:\n  v \\<notin> fv (Var ?q \\<cdot> \\<theta>(v' := t'))\n\ngoal (2 subgoals):\n 1. \\<lbrakk>subst_elim Var v; v \\<notin> fv t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(w := t)) v\n 2. \\<And>\\<theta> va ta.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>subst_elim \\<theta> v; v \\<notin> fv t\\<rbrakk>\n        \\<Longrightarrow> subst_elim (\\<theta>(w := t)) v;\n        va \\<notin> subst_domain \\<theta>; va \\<notin> range_vars \\<theta>;\n        fv ta \\<inter> insert va (subst_domain \\<theta>) = {};\n        subst_elim (\\<theta>(va := ta)) v; v \\<notin> fv t\\<rbrakk>\n       \\<Longrightarrow> subst_elim (\\<theta>(va := ta, w := t)) v", "hence \"\\<And>q. v \\<notin> fv (Var q \\<cdot> \\<theta>(v' := t', w := t))\""], ["proof (prove)\nusing this:\n  v \\<notin> fv (Var ?q \\<cdot> \\<theta>(v' := t'))\n\ngoal (1 subgoal):\n 1. \\<And>q. v \\<notin> fv (Var q \\<cdot> \\<theta>(v' := t', w := t))", "using \\<open>v \\<notin> fv t\\<close>"], ["proof (prove)\nusing this:\n  v \\<notin> fv (Var ?q \\<cdot> \\<theta>(v' := t'))\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. \\<And>q. v \\<notin> fv (Var q \\<cdot> \\<theta>(v' := t', w := t))", "by simp"], ["proof (state)\nthis:\n  v \\<notin> fv (Var ?q \\<cdot> \\<theta>(v' := t', w := t))\n\ngoal (2 subgoals):\n 1. \\<lbrakk>subst_elim Var v; v \\<notin> fv t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(w := t)) v\n 2. \\<And>\\<theta> va ta.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<lbrakk>subst_elim \\<theta> v; v \\<notin> fv t\\<rbrakk>\n        \\<Longrightarrow> subst_elim (\\<theta>(w := t)) v;\n        va \\<notin> subst_domain \\<theta>; va \\<notin> range_vars \\<theta>;\n        fv ta \\<inter> insert va (subst_domain \\<theta>) = {};\n        subst_elim (\\<theta>(va := ta)) v; v \\<notin> fv t\\<rbrakk>\n       \\<Longrightarrow> subst_elim (\\<theta>(va := ta, w := t)) v", "thus ?case"], ["proof (prove)\nusing this:\n  v \\<notin> fv (Var ?q \\<cdot> \\<theta>(v' := t', w := t))\n\ngoal (1 subgoal):\n 1. subst_elim (\\<theta>(v' := t', w := t)) v", "by (metis subst_elimI' subst_apply_term.simps(1))"], ["proof (state)\nthis:\n  subst_elim (\\<theta>(v' := t', w := t)) v\n\ngoal (1 subgoal):\n 1. \\<lbrakk>subst_elim Var v; v \\<notin> fv t\\<rbrakk>\n    \\<Longrightarrow> subst_elim (Var(w := t)) v", "qed (simp add: subst_elim_def)"], ["", "lemma wf_subst_elim_dom:\n  assumes \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\"\n  shows \"\\<forall>v \\<in> subst_domain \\<theta>. subst_elim \\<theta> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v", "using assms"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v", "proof (induction \\<theta> rule: wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "case (Insert \\<theta> w t)"], ["proof (state)\nthis:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n  w \\<notin> subst_domain \\<theta>\n  w \\<notin> range_vars \\<theta>\n  fv t \\<inter> insert w (subst_domain \\<theta>) = {}\n  \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v\n\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "have dom_insert: \"subst_domain (\\<theta>(w := t)) \\<subseteq> insert w (subst_domain \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (\\<theta>(w := t))\n    \\<subseteq> insert w (subst_domain \\<theta>)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<theta>(w := t))\n  \\<subseteq> insert w (subst_domain \\<theta>)\n\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "hence \"\\<forall>v \\<in> subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v\""], ["proof (prove)\nusing this:\n  subst_domain (\\<theta>(w := t))\n  \\<subseteq> insert w (subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v", "using Insert.IH Insert.hyps(2,4)"], ["proof (prove)\nusing this:\n  subst_domain (\\<theta>(w := t))\n  \\<subseteq> insert w (subst_domain \\<theta>)\n  \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v\n  w \\<notin> subst_domain \\<theta>\n  fv t \\<inter> insert w (subst_domain \\<theta>) = {}\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v", "by (metis Insert.hyps(1) IntI disjoint_insert(2) empty_iff wf_subst_elim_append)"], ["proof (state)\nthis:\n  \\<forall>v\\<in>subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v\n\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "moreover"], ["proof (state)\nthis:\n  \\<forall>v\\<in>subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v\n\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "have \"w \\<notin> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. w \\<notin> fv t", "using Insert.hyps(4)"], ["proof (prove)\nusing this:\n  fv t \\<inter> insert w (subst_domain \\<theta>) = {}\n\ngoal (1 subgoal):\n 1. w \\<notin> fv t", "by simp"], ["proof (state)\nthis:\n  w \\<notin> fv t\n\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "hence \"\\<And>q. w \\<notin> fv (Var q \\<cdot> \\<theta>(w := t))\""], ["proof (prove)\nusing this:\n  w \\<notin> fv t\n\ngoal (1 subgoal):\n 1. \\<And>q. w \\<notin> fv (Var q \\<cdot> \\<theta>(w := t))", "by (metis fv_simps(1) fv_in_subst_img Insert.hyps(3) contra_subsetD \n              fun_upd_def singletonD subst_apply_term.simps(1))"], ["proof (state)\nthis:\n  w \\<notin> fv (Var ?q \\<cdot> \\<theta>(w := t))\n\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "hence \"subst_elim (\\<theta>(w := t)) w\""], ["proof (prove)\nusing this:\n  w \\<notin> fv (Var ?q \\<cdot> \\<theta>(w := t))\n\ngoal (1 subgoal):\n 1. subst_elim (\\<theta>(w := t)) w", "by (metis subst_elimI')"], ["proof (state)\nthis:\n  subst_elim (\\<theta>(w := t)) w\n\ngoal (2 subgoals):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v\n 2. \\<And>\\<theta> v t.\n       \\<lbrakk>wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>;\n        \\<forall>v\\<in>subst_domain \\<theta>. subst_elim \\<theta> v;\n        v \\<notin> subst_domain \\<theta>; v \\<notin> range_vars \\<theta>;\n        fv t \\<inter> insert v (subst_domain \\<theta>) = {}\\<rbrakk>\n       \\<Longrightarrow> \\<forall>va\\<in>subst_domain (\\<theta>(v := t)).\n                            subst_elim (\\<theta>(v := t)) va", "ultimately"], ["proof (chain)\npicking this:\n  \\<forall>v\\<in>subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v\n  subst_elim (\\<theta>(w := t)) w", "show ?case"], ["proof (prove)\nusing this:\n  \\<forall>v\\<in>subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v\n  subst_elim (\\<theta>(w := t)) w\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain (\\<theta>(w := t)).\n       subst_elim (\\<theta>(w := t)) v", "using dom_insert"], ["proof (prove)\nusing this:\n  \\<forall>v\\<in>subst_domain \\<theta>. subst_elim (\\<theta>(w := t)) v\n  subst_elim (\\<theta>(w := t)) w\n  subst_domain (\\<theta>(w := t))\n  \\<subseteq> insert w (subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain (\\<theta>(w := t)).\n       subst_elim (\\<theta>(w := t)) v", "by blast"], ["proof (state)\nthis:\n  \\<forall>v\\<in>subst_domain (\\<theta>(w := t)).\n     subst_elim (\\<theta>(w := t)) v\n\ngoal (1 subgoal):\n 1. \\<forall>v\\<in>subst_domain Var. subst_elim Var v", "qed simp"], ["", "lemma wf_subst_support_iff_mgt: \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> \\<theta> supports \\<delta> \\<longleftrightarrow> \\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow>\n    (\\<theta> supports \\<delta>) =\n    (\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>)", "using subst_support_def subst_support_if_mgt_subst_idem wf_subst_subst_idem"], ["proof (prove)\nusing this:\n  (?\\<theta> supports ?\\<tau>) =\n  (?\\<tau> = ?\\<theta> \\<circ>\\<^sub>s ?\\<tau>)\n  \\<lbrakk>?\\<theta> \\<preceq>\\<^sub>\\<circ> ?\\<delta>;\n   subst_idem ?\\<theta>\\<rbrakk>\n  \\<Longrightarrow> ?\\<theta> supports ?\\<delta>\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta> \\<Longrightarrow>\n  subst_idem ?\\<theta>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow>\n    (\\<theta> supports \\<delta>) =\n    (\\<theta> \\<preceq>\\<^sub>\\<circ> \\<delta>)", "by blast"], ["", "subsection \\<open>Interpretations\\<close>"], ["", "abbreviation interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t::\"('a,'b) subst \\<Rightarrow> bool\" where\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<equiv> subst_domain \\<theta> = UNIV \\<and> ground (subst_range \\<theta>)\""], ["", "lemma interpretation_substI:\n  \"(\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow> interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "assume \"\\<And>v. fv (\\<theta> v) = {}\""], ["proof (state)\nthis:\n  fv (\\<theta> ?v) = {}\n\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "moreover"], ["proof (state)\nthis:\n  fv (\\<theta> ?v) = {}\n\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "{"], ["proof (state)\nthis:\n  fv (\\<theta> ?v) = {}\n\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "fix v"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "assume \"fv (\\<theta> v) = {}\""], ["proof (state)\nthis:\n  fv (\\<theta> v) = {}\n\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "hence \"v \\<in> subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  fv (\\<theta> v) = {}\n\ngoal (1 subgoal):\n 1. v \\<in> subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  v \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "}"], ["proof (state)\nthis:\n  fv (\\<theta> ?v2) = {} \\<Longrightarrow> ?v2 \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>v. fv (\\<theta> v) = {}) \\<Longrightarrow>\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  fv (\\<theta> ?v) = {}\n  fv (\\<theta> ?v2) = {} \\<Longrightarrow> ?v2 \\<in> subst_domain \\<theta>", "show ?thesis"], ["proof (prove)\nusing this:\n  fv (\\<theta> ?v) = {}\n  fv (\\<theta> ?v2) = {} \\<Longrightarrow> ?v2 \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "by auto"], ["proof (state)\nthis:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma interpretation_grounds[simp]:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> fv (t \\<cdot> \\<theta>) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>) = {}", "using subst_fv_dom_ground_if_ground_img[of t \\<theta>]"], ["proof (prove)\nusing this:\n  \\<lbrakk>fv t \\<subseteq> subst_domain \\<theta>;\n   ground (subst_range \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> fv (t \\<cdot> \\<theta>) = {}\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    fv (t \\<cdot> \\<theta>) = {}", "by blast"], ["", "lemma interpretation_grounds_all:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> (\\<And>v. fv (\\<theta> v) = {})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    (\\<And>v. fv (\\<theta> v) = {})", "by (metis range_vars_alt_def UNIV_I fv_in_subst_img subset_empty subst_dom_vars_in_subst)"], ["", "lemma interpretation_grounds_all':\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> ground (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    ground (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "using subst_fv_dom_ground_if_ground_img[of _ \\<theta>]"], ["proof (prove)\nusing this:\n  \\<lbrakk>fv ?t \\<subseteq> subst_domain \\<theta>;\n   ground (subst_range \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> fv (?t \\<cdot> \\<theta>) = {}\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    ground (M \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)", "by simp"], ["", "lemma interpretation_comp:\n  assumes \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\" \n  shows \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\" \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>) &&&\n    interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "proof -"], ["proof (state)\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "have \\<theta>_fv: \"fv (\\<theta> v) = {}\" for v"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<theta> v) = {}", "using interpretation_grounds_all[OF assms]"], ["proof (prove)\nusing this:\n  fv (\\<theta> ?v) = {}\n\ngoal (1 subgoal):\n 1. fv (\\<theta> v) = {}", "by simp"], ["proof (state)\nthis:\n  fv (\\<theta> ?v) = {}\n\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "hence \\<theta>_fv': \"fv (t \\<cdot> \\<theta>) = {}\" for t"], ["proof (prove)\nusing this:\n  fv (\\<theta> ?v) = {}\n\ngoal (1 subgoal):\n 1. fv (t \\<cdot> \\<theta>) = {}", "by (metis all_not_in_conv subst_elimD subst_elimI' subst_apply_term.simps(1))"], ["proof (state)\nthis:\n  fv (?t \\<cdot> \\<theta>) = {}\n\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "from assms"], ["proof (chain)\npicking this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "have \"(\\<sigma> \\<circ>\\<^sub>s \\<theta>) v \\<noteq> Var v\" for v"], ["proof (prove)\nusing this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<sigma> \\<circ>\\<^sub>s \\<theta>) v \\<noteq> Var v", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. \\<sigma> v \\<cdot> \\<theta> \\<noteq> Var v", "by (metis fv_simps(1) \\<theta>_fv' insert_not_empty)"], ["proof (state)\nthis:\n  (\\<sigma> \\<circ>\\<^sub>s \\<theta>) ?v \\<noteq> Var ?v\n\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "hence \"subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = UNIV\""], ["proof (prove)\nusing this:\n  (\\<sigma> \\<circ>\\<^sub>s \\<theta>) ?v \\<noteq> Var ?v\n\ngoal (1 subgoal):\n 1. subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = UNIV", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = UNIV\n\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "moreover"], ["proof (state)\nthis:\n  subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = UNIV\n\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "have \"fv ((\\<sigma> \\<circ>\\<^sub>s \\<theta>) v) = {}\" for v"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv ((\\<sigma> \\<circ>\\<^sub>s \\<theta>) v) = {}", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<sigma> v \\<cdot> \\<theta>) = {}", "using \\<theta>_fv'"], ["proof (prove)\nusing this:\n  fv (?t \\<cdot> \\<theta>) = {}\n\ngoal (1 subgoal):\n 1. fv (\\<sigma> v \\<cdot> \\<theta>) = {}", "by simp"], ["proof (state)\nthis:\n  fv ((\\<sigma> \\<circ>\\<^sub>s \\<theta>) ?v) = {}\n\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "hence \"ground (subst_range (\\<sigma> \\<circ>\\<^sub>s \\<theta>))\""], ["proof (prove)\nusing this:\n  fv ((\\<sigma> \\<circ>\\<^sub>s \\<theta>) ?v) = {}\n\ngoal (1 subgoal):\n 1. ground (subst_range (\\<sigma> \\<circ>\\<^sub>s \\<theta>))", "by simp"], ["proof (state)\nthis:\n  ground (subst_range (\\<sigma> \\<circ>\\<^sub>s \\<theta>))\n\ngoal (2 subgoals):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n 2. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = UNIV\n  ground (subst_range (\\<sigma> \\<circ>\\<^sub>s \\<theta>))", "show \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\""], ["proof (prove)\nusing this:\n  subst_domain (\\<sigma> \\<circ>\\<^sub>s \\<theta>) = UNIV\n  ground (subst_range (\\<sigma> \\<circ>\\<^sub>s \\<theta>))\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<sigma> \\<circ>\\<^sub>s \\<theta>)", ".."], ["proof (state)\nthis:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<sigma> \\<circ>\\<^sub>s \\<theta>)\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "from assms"], ["proof (chain)\npicking this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "have \"(\\<theta> \\<circ>\\<^sub>s \\<sigma>) v \\<noteq> Var v\" for v"], ["proof (prove)\nusing this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<sigma>) v \\<noteq> Var v", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> v \\<cdot> \\<sigma> \\<noteq> Var v", "by (metis fv_simps(1) \\<theta>_fv insert_not_empty subst_to_var_is_var)"], ["proof (state)\nthis:\n  (\\<theta> \\<circ>\\<^sub>s \\<sigma>) ?v \\<noteq> Var ?v\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "hence \"subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = UNIV\""], ["proof (prove)\nusing this:\n  (\\<theta> \\<circ>\\<^sub>s \\<sigma>) ?v \\<noteq> Var ?v\n\ngoal (1 subgoal):\n 1. subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = UNIV", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = UNIV\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "moreover"], ["proof (state)\nthis:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = UNIV\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "have \"fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) v) = {}\" for v"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) v) = {}", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (\\<theta> v \\<cdot> \\<sigma>) = {}", "by (simp add: \\<theta>_fv trm_subst_ident)"], ["proof (state)\nthis:\n  fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) ?v) = {}\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "hence \"ground (subst_range (\\<theta> \\<circ>\\<^sub>s \\<sigma>))\""], ["proof (prove)\nusing this:\n  fv ((\\<theta> \\<circ>\\<^sub>s \\<sigma>) ?v) = {}\n\ngoal (1 subgoal):\n 1. ground (subst_range (\\<theta> \\<circ>\\<^sub>s \\<sigma>))", "by simp"], ["proof (state)\nthis:\n  ground (subst_range (\\<theta> \\<circ>\\<^sub>s \\<sigma>))\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", "ultimately"], ["proof (chain)\npicking this:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = UNIV\n  ground (subst_range (\\<theta> \\<circ>\\<^sub>s \\<sigma>))", "show \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\""], ["proof (prove)\nusing this:\n  subst_domain (\\<theta> \\<circ>\\<^sub>s \\<sigma>) = UNIV\n  ground (subst_range (\\<theta> \\<circ>\\<^sub>s \\<sigma>))\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     (\\<theta> \\<circ>\\<^sub>s \\<sigma>)", ".."], ["proof (state)\nthis:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (\\<theta> \\<circ>\\<^sub>s \\<sigma>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma interpretation_subst_exists:\n  \"\\<exists>\\<I>::('f,'v) subst. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<I>.\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<I>.\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>", "obtain c::\"'f\" where \"c \\<in> UNIV\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>c. c \\<in> UNIV \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by simp"], ["proof (state)\nthis:\n  c \\<in> UNIV\n\ngoal (1 subgoal):\n 1. \\<exists>\\<I>.\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>", "then"], ["proof (chain)\npicking this:\n  c \\<in> UNIV", "obtain \\<I>::\"('f,'v) subst\" where \"\\<And>v. \\<I> v = Fun c []\""], ["proof (prove)\nusing this:\n  c \\<in> UNIV\n\ngoal (1 subgoal):\n 1. (\\<And>\\<I>.\n        (\\<And>v. \\<I> v = Fun c []) \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by simp"], ["proof (state)\nthis:\n  \\<I> ?v = Fun c []\n\ngoal (1 subgoal):\n 1. \\<exists>\\<I>.\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>", "hence \"subst_domain \\<I> = UNIV\" \"ground (subst_range \\<I>)\""], ["proof (prove)\nusing this:\n  \\<I> ?v = Fun c []\n\ngoal (1 subgoal):\n 1. subst_domain \\<I> = UNIV &&& ground (subst_range \\<I>)", "by (simp_all add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain \\<I> = UNIV\n  ground (subst_range \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<I>.\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>", "thus ?thesis"], ["proof (prove)\nusing this:\n  subst_domain \\<I> = UNIV\n  ground (subst_range \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<I>.\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>", "by auto"], ["proof (state)\nthis:\n  \\<exists>\\<I>. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma interpretation_subst_exists':\n  \"\\<exists>\\<theta>::('f,'v) subst. subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "obtain \\<I>::\"('f,'v) subst\" where \\<I>: \"subst_domain \\<I> = UNIV\" \"ground (subst_range \\<I>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>\\<I>.\n        \\<lbrakk>subst_domain \\<I> = UNIV;\n         ground (subst_range \\<I>)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using interpretation_subst_exists"], ["proof (prove)\nusing this:\n  \\<exists>\\<I>. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<I>.\n        \\<lbrakk>subst_domain \\<I> = UNIV;\n         ground (subst_range \\<I>)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  subst_domain \\<I> = UNIV\n  ground (subst_range \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "let ?\\<theta> = \"rm_vars (UNIV - X) \\<I>\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "have 1: \"subst_domain ?\\<theta> = X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (rm_vars (UNIV - X) \\<I>) = X", "using \\<I>"], ["proof (prove)\nusing this:\n  subst_domain \\<I> = UNIV\n  ground (subst_range \\<I>)\n\ngoal (1 subgoal):\n 1. subst_domain (rm_vars (UNIV - X) \\<I>) = X", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (rm_vars (UNIV - X) \\<I>) = X\n\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "hence 2: \"ground (subst_range ?\\<theta>)\""], ["proof (prove)\nusing this:\n  subst_domain (rm_vars (UNIV - X) \\<I>) = X\n\ngoal (1 subgoal):\n 1. ground (subst_range (rm_vars (UNIV - X) \\<I>))", "using \\<I>"], ["proof (prove)\nusing this:\n  subst_domain (rm_vars (UNIV - X) \\<I>) = X\n  subst_domain \\<I> = UNIV\n  ground (subst_range \\<I>)\n\ngoal (1 subgoal):\n 1. ground (subst_range (rm_vars (UNIV - X) \\<I>))", "by force"], ["proof (state)\nthis:\n  ground (subst_range (rm_vars (UNIV - X) \\<I>))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "using 1 2"], ["proof (prove)\nusing this:\n  subst_domain (rm_vars (UNIV - X) \\<I>) = X\n  ground (subst_range (rm_vars (UNIV - X) \\<I>))\n\ngoal (1 subgoal):\n 1. \\<exists>\\<theta>.\n       subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)", "by blast"], ["proof (state)\nthis:\n  \\<exists>\\<theta>.\n     subst_domain \\<theta> = X \\<and> ground (subst_range \\<theta>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma interpretation_subst_idem:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<Longrightarrow> subst_idem \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    subst_idem \\<theta>", "unfolding subst_idem_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    \\<theta> \\<circ>\\<^sub>s \\<theta> = \\<theta>", "using interpretation_grounds_all[of \\<theta>] trm_subst_ident subst_eq_if_eq_vars"], ["proof (prove)\nusing this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   \\<theta> \\<Longrightarrow>\n  fv (\\<theta> ?v) = {}\n  fv ?t \\<inter> subst_domain ?\\<theta> = {} \\<Longrightarrow>\n  ?t \\<cdot> ?\\<theta> = ?t\n  (\\<And>v.\n      Var v \\<cdot> ?\\<theta> = Var v \\<cdot> ?\\<sigma>) \\<Longrightarrow>\n  ?\\<theta> = ?\\<sigma>\n\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<theta> \\<Longrightarrow>\n    \\<theta> \\<circ>\\<^sub>s \\<theta> = \\<theta>", "by fastforce"], ["", "lemma subst_idem_comp_upd_eq:\n  assumes \"v \\<notin> subst_domain \\<I>\" \"subst_idem \\<theta>\"\n  shows \"\\<I> \\<circ>\\<^sub>s \\<theta> = \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "from assms(1)"], ["proof (chain)\npicking this:\n  v \\<notin> subst_domain \\<I>", "have \"(\\<I> \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\""], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  v \\<notin> subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. \\<I> v \\<cdot> \\<theta> = \\<theta> v", "by auto"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "moreover"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "have \"\\<And>w. w \\<noteq> v \\<Longrightarrow> (\\<I> \\<circ>\\<^sub>s \\<theta>) w = (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>w.\n       w \\<noteq> v \\<Longrightarrow>\n       (\\<I> \\<circ>\\<^sub>s \\<theta>) w =\n       (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) w", "unfolding subst_compose_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>w.\n       w \\<noteq> v \\<Longrightarrow>\n       Unifier \\<theta> (\\<I> w) ((\\<I>(v := \\<theta> v)) w)", "by auto"], ["proof (state)\nthis:\n  ?w \\<noteq> v \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) ?w =\n  (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) ?w\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "moreover"], ["proof (state)\nthis:\n  ?w \\<noteq> v \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) ?w =\n  (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) ?w\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "have \"(\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v", "using assms(2)"], ["proof (prove)\nusing this:\n  subst_idem \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v", "unfolding subst_idem_def subst_compose_def"], ["proof (prove)\nusing this:\n  (\\<lambda>x. \\<theta> x \\<cdot> \\<theta>) = \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<I>(v := \\<theta> v)) v \\<cdot> \\<theta> = \\<theta> v", "by (metis fun_upd_same)"], ["proof (state)\nthis:\n  (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\n  ?w \\<noteq> v \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) ?w =\n  (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) ?w\n  (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v", "show ?thesis"], ["proof (prove)\nusing this:\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\n  ?w \\<noteq> v \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<theta>) ?w =\n  (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) ?w\n  (\\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>) v = \\<theta> v\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<theta> =\n    \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>", "by (metis fun_upd_same fun_upd_triv subst_comp_upd1)"], ["proof (state)\nthis:\n  \\<I> \\<circ>\\<^sub>s \\<theta> =\n  \\<I>(v := \\<theta> v) \\<circ>\\<^sub>s \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma interpretation_dom_img_disjoint:\n  \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I> \\<Longrightarrow> subst_domain \\<I> \\<inter> range_vars \\<I> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<I> \\<Longrightarrow>\n    subst_domain \\<I> \\<inter> range_vars \\<I> = {}", "unfolding range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n     \\<I> \\<Longrightarrow>\n    subst_domain \\<I> \\<inter>\n    fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<I>) =\n    {}", "by auto"], ["", "subsection \\<open>Basic Properties of MGUs\\<close>"], ["", "lemma MGU_is_mgu_singleton: \"MGU \\<theta> t u = is_mgu \\<theta> {(t,u)}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU \\<theta> t u = is_mgu \\<theta> {(t, u)}", "unfolding is_mgu_def unifiers_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. MGU \\<theta> t u =\n    (\\<theta>\n     \\<in> {\\<sigma>.\n            \\<forall>p\\<in>{(t, u)}.\n               Unifier \\<sigma> (fst p) (snd p)} \\<and>\n     (\\<forall>\\<tau>\n               \\<in>{\\<sigma>.\n                     \\<forall>p\\<in>{(t, u)}.\n                        Unifier \\<sigma> (fst p) (snd p)}.\n         \\<theta> \\<preceq>\\<^sub>\\<circ> \\<tau>))", "by auto"], ["", "lemma Unifier_in_unifiers_singleton: \"Unifier \\<theta> s t \\<longleftrightarrow> \\<theta> \\<in> unifiers {(s,t)}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier \\<theta> s t = (\\<theta> \\<in> unifiers {(s, t)})", "unfolding unifiers_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier \\<theta> s t =\n    (\\<theta>\n     \\<in> {\\<sigma>.\n            \\<forall>p\\<in>{(s, t)}. Unifier \\<sigma> (fst p) (snd p)})", "by auto"], ["", "lemma subst_list_singleton_fv_subset:\n  \"(\\<Union>x \\<in> set (subst_list (subst v t) E). fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union> (\\<Union>x \\<in> set E. fv (fst x) \\<union> fv (snd x))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))", "proof (induction E)"], ["proof (state)\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "case (Cons x E)"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "let ?fvs = \"\\<lambda>L. \\<Union>x \\<in> set L. fv (fst x) \\<union> fv (snd x)\""], ["proof (state)\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "let ?fvx = \"fv (fst x) \\<union> fv (snd x)\""], ["proof (state)\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "let ?fvxsubst = \"fv (fst x \\<cdot> Var(v := t)) \\<union> fv (snd x \\<cdot> Var(v := t))\""], ["proof (state)\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "have \"?fvs (subst_list (subst v t) (x#E)) = ?fvxsubst \\<union> ?fvs (subst_list (subst v t) E)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n        fv (fst x) \\<union> fv (snd x)) =\n    fv (fst x \\<cdot> Var(v := t)) \\<union>\n    fv (snd x \\<cdot> Var(v := t)) \\<union>\n    (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x))", "unfolding subst_list_def subst_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (map (\\<lambda>p.\n                                (fst p \\<cdot> Var(v := t),\n                                 snd p \\<cdot> Var(v := t)))\n                         (x # E)).\n        fv (fst x) \\<union> fv (snd x)) =\n    fv (fst x \\<cdot> Var(v := t)) \\<union>\n    fv (snd x \\<cdot> Var(v := t)) \\<union>\n    (\\<Union>x\\<in>set (map (\\<lambda>p.\n                                (fst p \\<cdot> Var(v := t),\n                                 snd p \\<cdot> Var(v := t)))\n                         E).\n        fv (fst x) \\<union> fv (snd x))", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x \\<cdot> Var(v := t)) \\<union>\n  fv (snd x \\<cdot> Var(v := t)) \\<union>\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "hence \"?fvs (subst_list (subst v t) (x#E)) \\<subseteq> ?fvxsubst \\<union> fv t \\<union> ?fvs E\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x \\<cdot> Var(v := t)) \\<union>\n  fv (snd x \\<cdot> Var(v := t)) \\<union>\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv (fst x \\<cdot> Var(v := t)) \\<union>\n                fv (snd x \\<cdot> Var(v := t)) \\<union>\n                fv t \\<union>\n                (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))", "using Cons.IH"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x \\<cdot> Var(v := t)) \\<union>\n  fv (snd x \\<cdot> Var(v := t)) \\<union>\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv (fst x \\<cdot> Var(v := t)) \\<union>\n                fv (snd x \\<cdot> Var(v := t)) \\<union>\n                fv t \\<union>\n                (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))", "by blast"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (fst x \\<cdot> Var(v := t)) \\<union>\n              fv (snd x \\<cdot> Var(v := t)) \\<union>\n              fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "moreover"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (fst x \\<cdot> Var(v := t)) \\<union>\n              fv (snd x \\<cdot> Var(v := t)) \\<union>\n              fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "have \"?fvs (x#E) = ?fvx \\<union> ?fvs E\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x)) =\n    fv (fst x) \\<union> fv (snd x) \\<union>\n    (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x) \\<union> fv (snd x) \\<union>\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "moreover"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x) \\<union> fv (snd x) \\<union>\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "have \"?fvxsubst \\<subseteq> ?fvx \\<union> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (fst x \\<cdot> Var(v := t)) \\<union> fv (snd x \\<cdot> Var(v := t))\n    \\<subseteq> fv (fst x) \\<union> fv (snd x) \\<union> fv t", "using subst_fv_bound_singleton[of _ v t]"], ["proof (prove)\nusing this:\n  fv (?t \\<cdot> Var(v := t)) \\<subseteq> fv ?t \\<union> fv t\n\ngoal (1 subgoal):\n 1. fv (fst x \\<cdot> Var(v := t)) \\<union> fv (snd x \\<cdot> Var(v := t))\n    \\<subseteq> fv (fst x) \\<union> fv (snd x) \\<union> fv t", "by blast"], ["proof (state)\nthis:\n  fv (fst x \\<cdot> Var(v := t)) \\<union> fv (snd x \\<cdot> Var(v := t))\n  \\<subseteq> fv (fst x) \\<union> fv (snd x) \\<union> fv t\n\ngoal (2 subgoals):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))\n 2. \\<And>a E.\n       (\\<Union>x\\<in>set (subst_list (subst v t) E).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set E.\n                       fv (fst x) \\<union> fv (snd x)) \\<Longrightarrow>\n       (\\<Union>x\\<in>set (subst_list (subst v t) (a # E)).\n           fv (fst x) \\<union> fv (snd x))\n       \\<subseteq> fv t \\<union>\n                   (\\<Union>x\\<in>set (a # E).\n                       fv (fst x) \\<union> fv (snd x))", "ultimately"], ["proof (chain)\npicking this:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (fst x \\<cdot> Var(v := t)) \\<union>\n              fv (snd x \\<cdot> Var(v := t)) \\<union>\n              fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x) \\<union> fv (snd x) \\<union>\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  fv (fst x \\<cdot> Var(v := t)) \\<union> fv (snd x \\<cdot> Var(v := t))\n  \\<subseteq> fv (fst x) \\<union> fv (snd x) \\<union> fv t", "show ?case"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (fst x \\<cdot> Var(v := t)) \\<union>\n              fv (snd x \\<cdot> Var(v := t)) \\<union>\n              fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x) \\<union> fv (snd x) \\<union>\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  fv (fst x \\<cdot> Var(v := t)) \\<union> fv (snd x \\<cdot> Var(v := t))\n  \\<subseteq> fv (fst x) \\<union> fv (snd x) \\<union> fv t\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x))", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (fst x \\<cdot> Var(v := t)) \\<union>\n              fv (snd x \\<cdot> Var(v := t)) \\<union>\n              fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x)) =\n  fv (fst x) \\<union> fv (snd x) \\<union>\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  fv (fst x \\<cdot> Var(v := t)) \\<union> fv (snd x \\<cdot> Var(v := t))\n  \\<subseteq> fv (fst x) \\<union> fv (snd x) \\<union> fv t\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x))", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) (x # E)).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv t \\<union>\n              (\\<Union>x\\<in>set (x # E). fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) []).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x))", "qed (simp add: subst_list_def)"], ["", "lemma subst_of_dom_subset: \"subst_domain (subst_of L) \\<subseteq> set (map fst L)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain (subst_of L) \\<subseteq> set (map fst L)", "proof (induction L rule: List.rev_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. subst_domain (subst_of []) \\<subseteq> set (map fst [])\n 2. \\<And>x xs.\n       subst_domain (subst_of xs)\n       \\<subseteq> set (map fst xs) \\<Longrightarrow>\n       subst_domain (subst_of (xs @ [x]))\n       \\<subseteq> set (map fst (xs @ [x]))", "case (snoc x L)"], ["proof (state)\nthis:\n  subst_domain (subst_of L) \\<subseteq> set (map fst L)\n\ngoal (2 subgoals):\n 1. subst_domain (subst_of []) \\<subseteq> set (map fst [])\n 2. \\<And>x xs.\n       subst_domain (subst_of xs)\n       \\<subseteq> set (map fst xs) \\<Longrightarrow>\n       subst_domain (subst_of (xs @ [x]))\n       \\<subseteq> set (map fst (xs @ [x]))", "then"], ["proof (chain)\npicking this:\n  subst_domain (subst_of L) \\<subseteq> set (map fst L)", "obtain v t where x: \"x = (v,t)\""], ["proof (prove)\nusing this:\n  subst_domain (subst_of L) \\<subseteq> set (map fst L)\n\ngoal (1 subgoal):\n 1. (\\<And>v t. x = (v, t) \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis surj_pair)"], ["proof (state)\nthis:\n  x = (v, t)\n\ngoal (2 subgoals):\n 1. subst_domain (subst_of []) \\<subseteq> set (map fst [])\n 2. \\<And>x xs.\n       subst_domain (subst_of xs)\n       \\<subseteq> set (map fst xs) \\<Longrightarrow>\n       subst_domain (subst_of (xs @ [x]))\n       \\<subseteq> set (map fst (xs @ [x]))", "hence \"subst_of (L@[x]) = Var(v := t) \\<circ>\\<^sub>s subst_of L\""], ["proof (prove)\nusing this:\n  x = (v, t)\n\ngoal (1 subgoal):\n 1. subst_of (L @ [x]) = Var(v := t) \\<circ>\\<^sub>s subst_of L", "unfolding subst_of_def subst_def"], ["proof (prove)\nusing this:\n  x = (v, t)\n\ngoal (1 subgoal):\n 1. foldr (\\<lambda>(x, t) \\<sigma>. \\<sigma> \\<circ>\\<^sub>s Var(x := t))\n     (L @ [x]) Var =\n    Var(v := t) \\<circ>\\<^sub>s\n    foldr (\\<lambda>(x, t) \\<sigma>. \\<sigma> \\<circ>\\<^sub>s Var(x := t)) L\n     Var", "by (induct L) auto"], ["proof (state)\nthis:\n  subst_of (L @ [x]) = Var(v := t) \\<circ>\\<^sub>s subst_of L\n\ngoal (2 subgoals):\n 1. subst_domain (subst_of []) \\<subseteq> set (map fst [])\n 2. \\<And>x xs.\n       subst_domain (subst_of xs)\n       \\<subseteq> set (map fst xs) \\<Longrightarrow>\n       subst_domain (subst_of (xs @ [x]))\n       \\<subseteq> set (map fst (xs @ [x]))", "hence \"subst_domain (subst_of (L@[x])) \\<subseteq> insert v (subst_domain (subst_of L))\""], ["proof (prove)\nusing this:\n  subst_of (L @ [x]) = Var(v := t) \\<circ>\\<^sub>s subst_of L\n\ngoal (1 subgoal):\n 1. subst_domain (subst_of (L @ [x]))\n    \\<subseteq> insert v (subst_domain (subst_of L))", "using x subst_domain_compose[of \"Var(v := t)\" \"subst_of L\"]"], ["proof (prove)\nusing this:\n  subst_of (L @ [x]) = Var(v := t) \\<circ>\\<^sub>s subst_of L\n  x = (v, t)\n  subst_domain (Var(v := t) \\<circ>\\<^sub>s subst_of L)\n  \\<subseteq> subst_domain (Var(v := t)) \\<union> subst_domain (subst_of L)\n\ngoal (1 subgoal):\n 1. subst_domain (subst_of (L @ [x]))\n    \\<subseteq> insert v (subst_domain (subst_of L))", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain (subst_of (L @ [x]))\n  \\<subseteq> insert v (subst_domain (subst_of L))\n\ngoal (2 subgoals):\n 1. subst_domain (subst_of []) \\<subseteq> set (map fst [])\n 2. \\<And>x xs.\n       subst_domain (subst_of xs)\n       \\<subseteq> set (map fst xs) \\<Longrightarrow>\n       subst_domain (subst_of (xs @ [x]))\n       \\<subseteq> set (map fst (xs @ [x]))", "thus ?case"], ["proof (prove)\nusing this:\n  subst_domain (subst_of (L @ [x]))\n  \\<subseteq> insert v (subst_domain (subst_of L))\n\ngoal (1 subgoal):\n 1. subst_domain (subst_of (L @ [x])) \\<subseteq> set (map fst (L @ [x]))", "using snoc.IH x"], ["proof (prove)\nusing this:\n  subst_domain (subst_of (L @ [x]))\n  \\<subseteq> insert v (subst_domain (subst_of L))\n  subst_domain (subst_of L) \\<subseteq> set (map fst L)\n  x = (v, t)\n\ngoal (1 subgoal):\n 1. subst_domain (subst_of (L @ [x])) \\<subseteq> set (map fst (L @ [x]))", "by auto"], ["proof (state)\nthis:\n  subst_domain (subst_of (L @ [x])) \\<subseteq> set (map fst (L @ [x]))\n\ngoal (1 subgoal):\n 1. subst_domain (subst_of []) \\<subseteq> set (map fst [])", "qed simp"], ["", "lemma wf_MGU_is_imgu_singleton: \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow> is_imgu \\<theta> {(s,t)}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow>\n    is_imgu \\<theta> {(s, t)}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow>\n    is_imgu \\<theta> {(s, t)}", "assume 1: \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t\""], ["proof (state)\nthis:\n  wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t\n\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow>\n    is_imgu \\<theta> {(s, t)}", "have 2: \"subst_idem \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_idem \\<theta>", "by (metis wf_subst_subst_idem 1 wf\\<^sub>M\\<^sub>G\\<^sub>U_def)"], ["proof (state)\nthis:\n  subst_idem \\<theta>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow>\n    is_imgu \\<theta> {(s, t)}", "have 3: \"\\<forall>\\<theta>' \\<in> unifiers {(s,t)}. \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\" \"\\<theta> \\<in> unifiers {(s,t)}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>\\<theta>'\\<in>unifiers {(s, t)}.\n       \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>' &&&\n    \\<theta> \\<in> unifiers {(s, t)}", "by (metis 1 Unifier_in_unifiers_singleton wf\\<^sub>M\\<^sub>G\\<^sub>U_def)+"], ["proof (state)\nthis:\n  \\<forall>\\<theta>'\\<in>unifiers {(s, t)}.\n     \\<theta> \\<preceq>\\<^sub>\\<circ> \\<theta>'\n  \\<theta> \\<in> unifiers {(s, t)}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow>\n    is_imgu \\<theta> {(s, t)}", "have \"\\<forall>\\<tau> \\<in> unifiers {(s,t)}. \\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>\\<tau>\\<in>unifiers {(s, t)}.\n       \\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>", "by (metis 2 3 subst_idem_def subst_compose_assoc)"], ["proof (state)\nthis:\n  \\<forall>\\<tau>\\<in>unifiers {(s, t)}.\n     \\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t \\<Longrightarrow>\n    is_imgu \\<theta> {(s, t)}", "thus \"is_imgu \\<theta> {(s,t)}\""], ["proof (prove)\nusing this:\n  \\<forall>\\<tau>\\<in>unifiers {(s, t)}.\n     \\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>\n\ngoal (1 subgoal):\n 1. is_imgu \\<theta> {(s, t)}", "by (metis is_imgu_def \\<open>\\<theta> \\<in> unifiers {(s,t)}\\<close>)"], ["proof (state)\nthis:\n  is_imgu \\<theta> {(s, t)}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_subst_range_vars:\n  assumes \"mgu s t = Some \\<sigma>\" shows \"range_vars \\<sigma> \\<subseteq> vars_term s \\<union> vars_term t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. range_vars \\<sigma> \\<subseteq> fv s \\<union> fv t", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. range_vars \\<sigma> \\<subseteq> fv s \\<union> fv t", "obtain xs where *: \"Unification.unify [(s, t)] [] = Some xs\" and [simp]: \"subst_of xs = \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>xs.\n        \\<lbrakk>unify [(s, t)] [] = Some xs;\n         subst_of xs = \\<sigma>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using assms"], ["proof (prove)\nusing this:\n  mgu s t = Some \\<sigma>\n\ngoal (1 subgoal):\n 1. (\\<And>xs.\n        \\<lbrakk>unify [(s, t)] [] = Some xs;\n         subst_of xs = \\<sigma>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (simp split: option.splits)"], ["proof (state)\nthis:\n  unify [(s, t)] [] = Some xs\n  subst_of xs = \\<sigma>\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> \\<subseteq> fv s \\<union> fv t", "from unify_Some_UNIF [OF *]"], ["proof (chain)\npicking this:\n  \\<exists>ds ss.\n     xs = ds @ [] \\<and>\n     subst_of ds = compose ss \\<and> UNIF ss (mset [(s, t)]) {#}", "obtain ss\n    where \"compose ss = \\<sigma>\" and \"UNIF ss {#(s, t)#} {#}\""], ["proof (prove)\nusing this:\n  \\<exists>ds ss.\n     xs = ds @ [] \\<and>\n     subst_of ds = compose ss \\<and> UNIF ss (mset [(s, t)]) {#}\n\ngoal (1 subgoal):\n 1. (\\<And>ss.\n        \\<lbrakk>compose ss = \\<sigma>; UNIF ss {#(s, t)#} {#}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  compose ss = \\<sigma>\n  UNIF ss {#(s, t)#} {#}\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> \\<subseteq> fv s \\<union> fv t", "with UNIF_range_vars_subset [of ss \"{#(s, t)#}\" \"{#}\"]"], ["proof (chain)\npicking this:\n  UNIF ss {#(s, t)#} {#} \\<Longrightarrow>\n  range_vars (compose ss) \\<subseteq> vars_mset {#(s, t)#}\n  compose ss = \\<sigma>\n  UNIF ss {#(s, t)#} {#}", "show ?thesis"], ["proof (prove)\nusing this:\n  UNIF ss {#(s, t)#} {#} \\<Longrightarrow>\n  range_vars (compose ss) \\<subseteq> vars_mset {#(s, t)#}\n  compose ss = \\<sigma>\n  UNIF ss {#(s, t)#} {#}\n\ngoal (1 subgoal):\n 1. range_vars \\<sigma> \\<subseteq> fv s \\<union> fv t", "by (metis vars_mset_singleton fst_conv snd_conv)"], ["proof (state)\nthis:\n  range_vars \\<sigma> \\<subseteq> fv s \\<union> fv t\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_subst_domain_range_vars_disjoint:\n  assumes \"mgu s t = Some \\<sigma>\" shows \"subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "have \"is_imgu \\<sigma> {(s, t)}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. is_imgu \\<sigma> {(s, t)}", "using assms mgu_sound"], ["proof (prove)\nusing this:\n  mgu s t = Some \\<sigma>\n  mgu ?s ?t = Some ?\\<sigma> \\<Longrightarrow> is_imgu ?\\<sigma> {(?s, ?t)}\n\ngoal (1 subgoal):\n 1. is_imgu \\<sigma> {(s, t)}", "by simp"], ["proof (state)\nthis:\n  is_imgu \\<sigma> {(s, t)}\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "hence \"\\<sigma> = \\<sigma> \\<circ>\\<^sub>s \\<sigma>\""], ["proof (prove)\nusing this:\n  is_imgu \\<sigma> {(s, t)}\n\ngoal (1 subgoal):\n 1. \\<sigma> = \\<sigma> \\<circ>\\<^sub>s \\<sigma>", "unfolding is_imgu_def"], ["proof (prove)\nusing this:\n  \\<sigma> \\<in> unifiers {(s, t)} \\<and>\n  (\\<forall>\\<tau>\\<in>unifiers {(s, t)}.\n      \\<tau> = \\<sigma> \\<circ>\\<^sub>s \\<tau>)\n\ngoal (1 subgoal):\n 1. \\<sigma> = \\<sigma> \\<circ>\\<^sub>s \\<sigma>", "by blast"], ["proof (state)\nthis:\n  \\<sigma> = \\<sigma> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<sigma> = \\<sigma> \\<circ>\\<^sub>s \\<sigma>\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}", "by (metis subst_idemp_iff)"], ["proof (state)\nthis:\n  subst_domain \\<sigma> \\<inter> range_vars \\<sigma> = {}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_same_empty: \"mgu (t::('a,'b) term) t = Some Var\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "fix E::\"('a,'b) equation list\" and U::\"('b \\<times> ('a,'b) term) list\""], ["proof (state)\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "assume \"\\<forall>(s,t) \\<in> set E. s = t\""], ["proof (state)\nthis:\n  \\<forall>(s, t)\\<in>set E. s = t\n\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "hence \"Unification.unify E U = Some U\""], ["proof (prove)\nusing this:\n  \\<forall>(s, t)\\<in>set E. s = t\n\ngoal (1 subgoal):\n 1. unify E U = Some U", "proof (induction E U rule: Unification.unify.induct)"], ["proof (state)\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "case (2 f S g T E U)"], ["proof (state)\nthis:\n  \\<lbrakk>decompose (Fun f S) (Fun g T) = Some ?x2.0;\n   \\<forall>a\\<in>set (?x2.0 @ E).\n      case a of (a, b) \\<Rightarrow> a = b\\<rbrakk>\n  \\<Longrightarrow> unify (?x2.0 @ E) U = Some U\n  \\<forall>a\\<in>set ((Fun f S, Fun g T) # E).\n     case a of (a, b) \\<Rightarrow> a = b\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "hence *: \"f = g\" \"S = T\""], ["proof (prove)\nusing this:\n  \\<lbrakk>decompose (Fun f S) (Fun g T) = Some ?x2.0;\n   \\<forall>a\\<in>set (?x2.0 @ E).\n      case a of (a, b) \\<Rightarrow> a = b\\<rbrakk>\n  \\<Longrightarrow> unify (?x2.0 @ E) U = Some U\n  \\<forall>a\\<in>set ((Fun f S, Fun g T) # E).\n     case a of (a, b) \\<Rightarrow> a = b\n\ngoal (1 subgoal):\n 1. f = g &&& S = T", "by auto"], ["proof (state)\nthis:\n  f = g\n  S = T\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "moreover"], ["proof (state)\nthis:\n  f = g\n  S = T\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "have \"\\<forall>(s,t) \\<in> set (zip T T). s = t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>(s, t)\\<in>set (zip T T). s = t", "by (induct T) auto"], ["proof (state)\nthis:\n  \\<forall>(s, t)\\<in>set (zip T T). s = t\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "hence \"\\<forall>(s,t) \\<in> set (zip T T@E). s = t\""], ["proof (prove)\nusing this:\n  \\<forall>(s, t)\\<in>set (zip T T). s = t\n\ngoal (1 subgoal):\n 1. \\<forall>(s, t)\\<in>set (zip T T @ E). s = t", "using \"2.prems\"(1)"], ["proof (prove)\nusing this:\n  \\<forall>(s, t)\\<in>set (zip T T). s = t\n  \\<forall>a\\<in>set ((Fun f S, Fun g T) # E).\n     case a of (a, b) \\<Rightarrow> a = b\n\ngoal (1 subgoal):\n 1. \\<forall>(s, t)\\<in>set (zip T T @ E). s = t", "by auto"], ["proof (state)\nthis:\n  \\<forall>(s, t)\\<in>set (zip T T @ E). s = t\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "moreover"], ["proof (state)\nthis:\n  \\<forall>(s, t)\\<in>set (zip T T @ E). s = t\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "have \"zip_option S T = Some (zip S T)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. zip_option S T = Some (zip S T)", "using \\<open>S = T\\<close>"], ["proof (prove)\nusing this:\n  S = T\n\ngoal (1 subgoal):\n 1. zip_option S T = Some (zip S T)", "by auto"], ["proof (state)\nthis:\n  zip_option S T = Some (zip S T)\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "hence **: \"decompose (Fun f S) (Fun g T) = Some (zip S T)\""], ["proof (prove)\nusing this:\n  zip_option S T = Some (zip S T)\n\ngoal (1 subgoal):\n 1. decompose (Fun f S) (Fun g T) = Some (zip S T)", "using \\<open>f = g\\<close>"], ["proof (prove)\nusing this:\n  zip_option S T = Some (zip S T)\n  f = g\n\ngoal (1 subgoal):\n 1. decompose (Fun f S) (Fun g T) = Some (zip S T)", "unfolding decompose_def"], ["proof (prove)\nusing this:\n  zip_option S T = Some (zip S T)\n  f = g\n\ngoal (1 subgoal):\n 1. (case (Fun f S, Fun g T) of (Var x, b) \\<Rightarrow> Map.empty x\n     | (Fun f ss, Var x) \\<Rightarrow> Map.empty x\n     | (Fun f ss, Fun g ts) \\<Rightarrow>\n         if f = g then zip_option ss ts else None) =\n    Some (zip S T)", "by auto"], ["proof (state)\nthis:\n  decompose (Fun f S) (Fun g T) = Some (zip S T)\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "ultimately"], ["proof (chain)\npicking this:\n  f = g\n  S = T\n  \\<forall>(s, t)\\<in>set (zip T T @ E). s = t\n  decompose (Fun f S) (Fun g T) = Some (zip S T)", "have \"Unification.unify (zip S T@E) U = Some U\""], ["proof (prove)\nusing this:\n  f = g\n  S = T\n  \\<forall>(s, t)\\<in>set (zip T T @ E). s = t\n  decompose (Fun f S) (Fun g T) = Some (zip S T)\n\ngoal (1 subgoal):\n 1. unify (zip S T @ E) U = Some U", "using \"2.IH\" *"], ["proof (prove)\nusing this:\n  f = g\n  S = T\n  \\<forall>(s, t)\\<in>set (zip T T @ E). s = t\n  decompose (Fun f S) (Fun g T) = Some (zip S T)\n  \\<lbrakk>decompose (Fun f S) (Fun g T) = Some ?x2.0;\n   \\<forall>a\\<in>set (?x2.0 @ E).\n      case a of (a, b) \\<Rightarrow> a = b\\<rbrakk>\n  \\<Longrightarrow> unify (?x2.0 @ E) U = Some U\n  f = g\n  S = T\n\ngoal (1 subgoal):\n 1. unify (zip S T @ E) U = Some U", "by auto"], ["proof (state)\nthis:\n  unify (zip S T @ E) U = Some U\n\ngoal (4 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>f ss g ts E bs.\n       \\<lbrakk>\\<And>x2.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    \\<forall>(x, y)\\<in>set (x2 @ E). x = y\\<rbrakk>\n                   \\<Longrightarrow> unify (x2 @ E) bs = Some bs;\n        \\<forall>(x, y)\\<in>set ((Fun f ss, Fun g ts) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun f ss, Fun g ts) # E) bs = Some bs\n 3. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 4. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "thus ?case"], ["proof (prove)\nusing this:\n  unify (zip S T @ E) U = Some U\n\ngoal (1 subgoal):\n 1. unify ((Fun f S, Fun g T) # E) U = Some U", "using **"], ["proof (prove)\nusing this:\n  unify (zip S T @ E) U = Some U\n  decompose (Fun f S) (Fun g T) = Some (zip S T)\n\ngoal (1 subgoal):\n 1. unify ((Fun f S, Fun g T) # E) U = Some U", "by auto"], ["proof (state)\nthis:\n  unify ((Fun f S, Fun g T) # E) U = Some U\n\ngoal (3 subgoals):\n 1. \\<And>bs.\n       \\<forall>(x, y)\\<in>set []. x = y \\<Longrightarrow>\n       unify [] bs = Some bs\n 2. \\<And>x t E bs.\n       \\<lbrakk>\\<lbrakk>t = Var x;\n                 \\<forall>(x, y)\\<in>set E. x = y\\<rbrakk>\n                \\<Longrightarrow> unify E bs = Some bs;\n        \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n         \\<forall>(x, y)\\<in>set (subst_list (subst x t) E). x = y\\<rbrakk>\n        \\<Longrightarrow> unify (subst_list (subst x t) E) ((x, t) # bs) =\n                          Some ((x, t) # bs);\n        \\<forall>(x, y)\\<in>set ((Var x, t) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Var x, t) # E) bs = Some bs\n 3. \\<And>v va x E bs.\n       \\<lbrakk>\\<lbrakk>x \\<notin> fv (Fun v va);\n                 \\<forall>(x, y)\n                          \\<in>set (subst_list (subst x (Fun v va)) E).\n                    x = y\\<rbrakk>\n                \\<Longrightarrow> unify (subst_list (subst x (Fun v va)) E)\n                                   ((x, Fun v va) # bs) =\n                                  Some ((x, Fun v va) # bs);\n        \\<forall>(x, y)\\<in>set ((Fun v va, Var x) # E). x = y\\<rbrakk>\n       \\<Longrightarrow> unify ((Fun v va, Var x) # E) bs = Some bs", "qed auto"], ["proof (state)\nthis:\n  unify E U = Some U\n\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "}"], ["proof (state)\nthis:\n  \\<forall>(s, t)\\<in>set ?E2. s = t \\<Longrightarrow>\n  unify ?E2 ?U2 = Some ?U2\n\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "hence \"Unification.unify [(t,t)] [] = Some []\""], ["proof (prove)\nusing this:\n  \\<forall>(s, t)\\<in>set ?E2. s = t \\<Longrightarrow>\n  unify ?E2 ?U2 = Some ?U2\n\ngoal (1 subgoal):\n 1. unify [(t, t)] [] = Some []", "by auto"], ["proof (state)\nthis:\n  unify [(t, t)] [] = Some []\n\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "thus ?thesis"], ["proof (prove)\nusing this:\n  unify [(t, t)] [] = Some []\n\ngoal (1 subgoal):\n 1. mgu t t = Some Var", "by auto"], ["proof (state)\nthis:\n  mgu t t = Some Var\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_var: assumes \"x \\<notin> fv t\" shows \"mgu (Var x) t = Some (Var(x := t))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mgu (Var x) t = Some (Var(x := t))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. mgu (Var x) t = Some (Var(x := t))", "have \"unify [(Var x,t)] [] = Some [(x,t)]\""], ["proof (prove)\ngoal (1 subgoal):\n 1. unify [(Var x, t)] [] = Some [(x, t)]", "using assms"], ["proof (prove)\nusing this:\n  x \\<notin> fv t\n\ngoal (1 subgoal):\n 1. unify [(Var x, t)] [] = Some [(x, t)]", "by (auto simp add: subst_list_def)"], ["proof (state)\nthis:\n  unify [(Var x, t)] [] = Some [(x, t)]\n\ngoal (1 subgoal):\n 1. mgu (Var x) t = Some (Var(x := t))", "moreover"], ["proof (state)\nthis:\n  unify [(Var x, t)] [] = Some [(x, t)]\n\ngoal (1 subgoal):\n 1. mgu (Var x) t = Some (Var(x := t))", "have \"subst_of [(x,t)] = Var(x := t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_of [(x, t)] = Var(x := t)", "unfolding subst_of_def subst_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. foldr (\\<lambda>(x, t) \\<sigma>. \\<sigma> \\<circ>\\<^sub>s Var(x := t))\n     [(x, t)] Var =\n    Var(x := t)", "by simp"], ["proof (state)\nthis:\n  subst_of [(x, t)] = Var(x := t)\n\ngoal (1 subgoal):\n 1. mgu (Var x) t = Some (Var(x := t))", "ultimately"], ["proof (chain)\npicking this:\n  unify [(Var x, t)] [] = Some [(x, t)]\n  subst_of [(x, t)] = Var(x := t)", "show ?thesis"], ["proof (prove)\nusing this:\n  unify [(Var x, t)] [] = Some [(x, t)]\n  subst_of [(x, t)] = Var(x := t)\n\ngoal (1 subgoal):\n 1. mgu (Var x) t = Some (Var(x := t))", "by simp"], ["proof (state)\nthis:\n  mgu (Var x) t = Some (Var(x := t))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_gives_wellformed_subst:\n  assumes \"mgu s t = Some \\<theta>\" shows \"wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "using mgu_finite_subst_domain[OF assms] mgu_subst_domain_range_vars_disjoint[OF assms]"], ["proof (prove)\nusing this:\n  finite (subst_domain \\<theta>)\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>", "unfolding wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def"], ["proof (prove)\nusing this:\n  finite (subst_domain \\<theta>)\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n    finite (subst_domain \\<theta>)", "by auto"], ["", "lemma mgu_gives_wellformed_MGU:\n  assumes \"mgu s t = Some \\<theta>\" shows \"wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t", "using mgu_subst_domain[OF assms] mgu_sound[OF assms] mgu_subst_range_vars [OF assms]\n      MGU_is_mgu_singleton[of s \\<theta> t] is_imgu_imp_is_mgu[of \\<theta> \"{(s,t)}\"]\n      mgu_gives_wellformed_subst[OF assms]"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<subseteq> fv s \\<union> fv t\n  is_imgu \\<theta> {(s, t)}\n  range_vars \\<theta> \\<subseteq> fv s \\<union> fv t\n  MGU \\<theta> s t = is_mgu \\<theta> {(s, t)}\n  is_imgu \\<theta> {(s, t)} \\<Longrightarrow> is_mgu \\<theta> {(s, t)}\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>M\\<^sub>G\\<^sub>U \\<theta> s t", "unfolding wf\\<^sub>M\\<^sub>G\\<^sub>U_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<subseteq> fv s \\<union> fv t\n  is_imgu \\<theta> {(s, t)}\n  range_vars \\<theta> \\<subseteq> fv s \\<union> fv t\n  MGU \\<theta> s t = is_mgu \\<theta> {(s, t)}\n  is_imgu \\<theta> {(s, t)} \\<Longrightarrow> is_mgu \\<theta> {(s, t)}\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta> \\<and>\n    MGU \\<theta> s t \\<and>\n    subst_domain \\<theta> \\<union> range_vars \\<theta>\n    \\<subseteq> fv s \\<union> fv t", "by blast"], ["", "lemma mgu_vars_bounded[dest?]:\n  \"mgu M N = Some \\<sigma> \\<Longrightarrow> subst_domain \\<sigma> \\<union> range_vars \\<sigma> \\<subseteq> fv M \\<union> fv N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mgu M N = Some \\<sigma> \\<Longrightarrow>\n    subst_domain \\<sigma> \\<union> range_vars \\<sigma>\n    \\<subseteq> fv M \\<union> fv N", "using mgu_gives_wellformed_MGU"], ["proof (prove)\nusing this:\n  mgu ?s ?t = Some ?\\<theta> \\<Longrightarrow>\n  wf\\<^sub>M\\<^sub>G\\<^sub>U ?\\<theta> ?s ?t\n\ngoal (1 subgoal):\n 1. mgu M N = Some \\<sigma> \\<Longrightarrow>\n    subst_domain \\<sigma> \\<union> range_vars \\<sigma>\n    \\<subseteq> fv M \\<union> fv N", "unfolding wf\\<^sub>M\\<^sub>G\\<^sub>U_def"], ["proof (prove)\nusing this:\n  mgu ?s ?t = Some ?\\<theta> \\<Longrightarrow>\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t ?\\<theta> \\<and>\n  MGU ?\\<theta> ?s ?t \\<and>\n  subst_domain ?\\<theta> \\<union> range_vars ?\\<theta>\n  \\<subseteq> fv ?s \\<union> fv ?t\n\ngoal (1 subgoal):\n 1. mgu M N = Some \\<sigma> \\<Longrightarrow>\n    subst_domain \\<sigma> \\<union> range_vars \\<sigma>\n    \\<subseteq> fv M \\<union> fv N", "by blast"], ["", "lemma mgu_gives_subst_idem: \"mgu s t = Some \\<theta> \\<Longrightarrow> subst_idem \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mgu s t = Some \\<theta> \\<Longrightarrow> subst_idem \\<theta>", "using mgu_sound[of s t \\<theta>]"], ["proof (prove)\nusing this:\n  mgu s t = Some \\<theta> \\<Longrightarrow> is_imgu \\<theta> {(s, t)}\n\ngoal (1 subgoal):\n 1. mgu s t = Some \\<theta> \\<Longrightarrow> subst_idem \\<theta>", "unfolding is_imgu_def subst_idem_def"], ["proof (prove)\nusing this:\n  mgu s t = Some \\<theta> \\<Longrightarrow>\n  \\<theta> \\<in> unifiers {(s, t)} \\<and>\n  (\\<forall>\\<tau>\\<in>unifiers {(s, t)}.\n      \\<tau> = \\<theta> \\<circ>\\<^sub>s \\<tau>)\n\ngoal (1 subgoal):\n 1. mgu s t = Some \\<theta> \\<Longrightarrow>\n    \\<theta> \\<circ>\\<^sub>s \\<theta> = \\<theta>", "by auto"], ["", "lemma mgu_always_unifies: \"Unifier \\<theta> M N \\<Longrightarrow> \\<exists>\\<delta>. mgu M N = Some \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier \\<theta> M N \\<Longrightarrow>\n    \\<exists>\\<delta>. mgu M N = Some \\<delta>", "using mgu_complete Unifier_in_unifiers_singleton"], ["proof (prove)\nusing this:\n  mgu ?s ?t = None \\<Longrightarrow> unifiers {(?s, ?t)} = {}\n  Unifier ?\\<theta> ?s ?t = (?\\<theta> \\<in> unifiers {(?s, ?t)})\n\ngoal (1 subgoal):\n 1. Unifier \\<theta> M N \\<Longrightarrow>\n    \\<exists>\\<delta>. mgu M N = Some \\<delta>", "by blast"], ["", "lemma mgu_gives_MGU: \"mgu s t = Some \\<theta> \\<Longrightarrow> MGU \\<theta> s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mgu s t = Some \\<theta> \\<Longrightarrow> MGU \\<theta> s t", "using mgu_sound[of s t \\<theta>, THEN is_imgu_imp_is_mgu] MGU_is_mgu_singleton"], ["proof (prove)\nusing this:\n  mgu s t = Some \\<theta> \\<Longrightarrow> is_mgu \\<theta> {(s, t)}\n  MGU ?\\<theta> ?t ?u = is_mgu ?\\<theta> {(?t, ?u)}\n\ngoal (1 subgoal):\n 1. mgu s t = Some \\<theta> \\<Longrightarrow> MGU \\<theta> s t", "by metis"], ["", "lemma mgu_eliminates[dest?]:\n  assumes \"mgu M N = Some \\<sigma>\"\n  shows \"(\\<exists>v \\<in> fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or> \\<sigma> = Var\"\n  (is \"?P M N \\<sigma>\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "proof (cases \"\\<sigma> = Var\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<sigma> = Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var\n 2. \\<sigma> \\<noteq> Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "case False"], ["proof (state)\nthis:\n  \\<sigma> \\<noteq> Var\n\ngoal (2 subgoals):\n 1. \\<sigma> = Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var\n 2. \\<sigma> \\<noteq> Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "then"], ["proof (chain)\npicking this:\n  \\<sigma> \\<noteq> Var", "obtain v where v: \"v \\<in> subst_domain \\<sigma>\""], ["proof (prove)\nusing this:\n  \\<sigma> \\<noteq> Var\n\ngoal (1 subgoal):\n 1. (\\<And>v.\n        v \\<in> subst_domain \\<sigma> \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  v \\<in> subst_domain \\<sigma>\n\ngoal (2 subgoals):\n 1. \\<sigma> = Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var\n 2. \\<sigma> \\<noteq> Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "hence \"v \\<in> fv M \\<union> fv N\""], ["proof (prove)\nusing this:\n  v \\<in> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. v \\<in> fv M \\<union> fv N", "using mgu_vars_bounded[OF assms]"], ["proof (prove)\nusing this:\n  v \\<in> subst_domain \\<sigma>\n  subst_domain \\<sigma> \\<union> range_vars \\<sigma>\n  \\<subseteq> fv M \\<union> fv N\n\ngoal (1 subgoal):\n 1. v \\<in> fv M \\<union> fv N", "by blast"], ["proof (state)\nthis:\n  v \\<in> fv M \\<union> fv N\n\ngoal (2 subgoals):\n 1. \\<sigma> = Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var\n 2. \\<sigma> \\<noteq> Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "thus ?thesis"], ["proof (prove)\nusing this:\n  v \\<in> fv M \\<union> fv N\n\ngoal (1 subgoal):\n 1. (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "using wf_subst_elim_dom[OF mgu_gives_wellformed_subst[OF assms]] v"], ["proof (prove)\nusing this:\n  v \\<in> fv M \\<union> fv N\n  \\<forall>v\\<in>subst_domain \\<sigma>. subst_elim \\<sigma> v\n  v \\<in> subst_domain \\<sigma>\n\ngoal (1 subgoal):\n 1. (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "by blast"], ["proof (state)\nthis:\n  (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n  \\<sigma> = Var\n\ngoal (1 subgoal):\n 1. \\<sigma> = Var \\<Longrightarrow>\n    (\\<exists>v\\<in>fv M \\<union> fv N. subst_elim \\<sigma> v) \\<or>\n    \\<sigma> = Var", "qed simp"], ["", "lemma mgu_eliminates_dom:\n  assumes \"mgu x y = Some \\<theta>\" \"v \\<in> subst_domain \\<theta>\"\n  shows \"subst_elim \\<theta> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_elim \\<theta> v", "using mgu_gives_wellformed_subst[OF assms(1)]"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. subst_elim \\<theta> v", "unfolding wf\\<^sub>M\\<^sub>G\\<^sub>U_def wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def subst_elim_def"], ["proof (prove)\nusing this:\n  subst_domain \\<theta> \\<inter> range_vars \\<theta> = {} \\<and>\n  finite (subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<forall>t. v \\<notin> fv (t \\<cdot> \\<theta>)", "by (metis disjoint_iff_not_equal subst_dom_elim assms(2))"], ["", "lemma unify_list_distinct:\n  assumes \"Unification.unify E B = Some U\" \"distinct (map fst B)\"\n  and \"(\\<Union>x \\<in> set E. fv (fst x) \\<union> fv (snd x)) \\<inter> set (map fst B) = {}\"\n  shows \"distinct (map fst U)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. distinct (map fst U)", "using assms"], ["proof (prove)\nusing this:\n  unify E B = Some U\n  distinct (map fst B)\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "proof (induction E B arbitrary: U rule: Unification.unify.induct)"], ["proof (state)\ngoal (4 subgoals):\n 1. \\<And>bs U.\n       \\<lbrakk>unify [] bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 4. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "case 1"], ["proof (state)\nthis:\n  unify [] bs_ = Some U\n  distinct (map fst bs_)\n  (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst bs_) =\n  {}\n\ngoal (4 subgoals):\n 1. \\<And>bs U.\n       \\<lbrakk>unify [] bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 4. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "thus ?case"], ["proof (prove)\nusing this:\n  unify [] bs_ = Some U\n  distinct (map fst bs_)\n  (\\<Union>x\\<in>set []. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst bs_) =\n  {}\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "by simp"], ["proof (state)\nthis:\n  distinct (map fst U)\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "next"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "case (2 f X g Y E B U)"], ["proof (state)\nthis:\n  \\<lbrakk>decompose (Fun f X) (Fun g Y) = Some ?x2.0;\n   unify (?x2.0 @ E) B = Some ?U; distinct (map fst B);\n   (\\<Union>x\\<in>set (?x2.0 @ E). fv (fst x) \\<union> fv (snd x)) \\<inter>\n   set (map fst B) =\n   {}\\<rbrakk>\n  \\<Longrightarrow> distinct (map fst ?U)\n  unify ((Fun f X, Fun g Y) # E) B = Some U\n  distinct (map fst B)\n  (\\<Union>x\\<in>set ((Fun f X, Fun g Y) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "let ?fvs = \"\\<lambda>L. \\<Union>x \\<in> set L. fv (fst x) \\<union> fv (snd x)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "from \"2.prems\"(1)"], ["proof (chain)\npicking this:\n  unify ((Fun f X, Fun g Y) # E) B = Some U", "obtain E' where *: \"decompose (Fun f X) (Fun g Y) = Some E'\"\n    and [simp]: \"f = g\" \"length X = length Y\" \"E' = zip X Y\"\n    and **: \"Unification.unify (E'@E) B = Some U\""], ["proof (prove)\nusing this:\n  unify ((Fun f X, Fun g Y) # E) B = Some U\n\ngoal (1 subgoal):\n 1. (\\<And>E'.\n        \\<lbrakk>decompose (Fun f X) (Fun g Y) = Some E'; f = g;\n         length X = length Y; E' = zip X Y;\n         unify (E' @ E) B = Some U\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto split: option.splits)"], ["proof (state)\nthis:\n  decompose (Fun f X) (Fun g Y) = Some E'\n  f = g\n  length X = length Y\n  E' = zip X Y\n  unify (E' @ E) B = Some U\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "hence \"\\<And>t t'. (t,t') \\<in> set E' \\<Longrightarrow> fv t \\<subseteq> fv (Fun f X) \\<and> fv t' \\<subseteq> fv (Fun g Y)\""], ["proof (prove)\nusing this:\n  decompose (Fun f X) (Fun g Y) = Some E'\n  f = g\n  length X = length Y\n  E' = zip X Y\n  unify (E' @ E) B = Some U\n\ngoal (1 subgoal):\n 1. \\<And>t t'.\n       (t, t') \\<in> set E' \\<Longrightarrow>\n       fv t \\<subseteq> fv (Fun f X) \\<and> fv t' \\<subseteq> fv (Fun g Y)", "by (metis zip_arg_subterm subtermeq_vars_subset)"], ["proof (state)\nthis:\n  (?t1, ?t'1) \\<in> set E' \\<Longrightarrow>\n  fv ?t1 \\<subseteq> fv (Fun f X) \\<and> fv ?t'1 \\<subseteq> fv (Fun g Y)\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "hence \"?fvs E' \\<subseteq> fv (Fun f X) \\<union> fv (Fun g Y)\""], ["proof (prove)\nusing this:\n  (?t1, ?t'1) \\<in> set E' \\<Longrightarrow>\n  fv ?t1 \\<subseteq> fv (Fun f X) \\<and> fv ?t'1 \\<subseteq> fv (Fun g Y)\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv (Fun f X) \\<union> fv (Fun g Y)", "by fastforce"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (Fun f X) \\<union> fv (Fun g Y)\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "moreover"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (Fun f X) \\<union> fv (Fun g Y)\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "have \"fv (Fun f X) \\<inter> set (map fst B) = {}\" \"fv (Fun g Y) \\<inter> set (map fst B) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (Fun f X) \\<inter> set (map fst B) = {} &&&\n    fv (Fun g Y) \\<inter> set (map fst B) = {}", "using \"2.prems\"(3)"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set ((Fun f X, Fun g Y) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. fv (Fun f X) \\<inter> set (map fst B) = {} &&&\n    fv (Fun g Y) \\<inter> set (map fst B) = {}", "by auto"], ["proof (state)\nthis:\n  fv (Fun f X) \\<inter> set (map fst B) = {}\n  fv (Fun g Y) \\<inter> set (map fst B) = {}\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "ultimately"], ["proof (chain)\npicking this:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (Fun f X) \\<union> fv (Fun g Y)\n  fv (Fun f X) \\<inter> set (map fst B) = {}\n  fv (Fun g Y) \\<inter> set (map fst B) = {}", "have \"?fvs E' \\<inter> set (map fst B) = {}\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (Fun f X) \\<union> fv (Fun g Y)\n  fv (Fun f X) \\<inter> set (map fst B) = {}\n  fv (Fun g Y) \\<inter> set (map fst B) = {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "by blast"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "moreover"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "have \"?fvs E \\<inter> set (map fst B) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "using \"2.prems\"(3)"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set ((Fun f X, Fun g Y) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "ultimately"], ["proof (chain)\npicking this:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}", "have \"?fvs (E'@E) \\<inter> set (map fst B) = {}\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set E'. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (E' @ E). fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (E' @ E). fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U; distinct (map fst bs);\n                    (\\<Union>x\\<in>set (x2 @ E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun f ss, Fun g ts) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "thus ?case"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (E' @ E). fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "using \"2.IH\"[OF * ** \"2.prems\"(2)]"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (E' @ E). fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n  (\\<Union>x\\<in>set (E' @ E). fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {} \\<Longrightarrow>\n  distinct (map fst U)\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "by metis"], ["proof (state)\nthis:\n  distinct (map fst U)\n\ngoal (2 subgoals):\n 1. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "case (3 v t E B)"], ["proof (state)\nthis:\n  \\<lbrakk>t = Var v; unify E B = Some ?U; distinct (map fst B);\n   (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n   set (map fst B) =\n   {}\\<rbrakk>\n  \\<Longrightarrow> distinct (map fst ?U)\n  \\<lbrakk>t \\<noteq> Var v; v \\<notin> fv t;\n   unify (subst_list (subst v t) E) ((v, t) # B) = Some ?U;\n   distinct (map fst ((v, t) # B));\n   (\\<Union>x\\<in>set (subst_list (subst v t) E).\n       fv (fst x) \\<union> fv (snd x)) \\<inter>\n   set (map fst ((v, t) # B)) =\n   {}\\<rbrakk>\n  \\<Longrightarrow> distinct (map fst ?U)\n  unify ((Var v, t) # E) B = Some U\n  distinct (map fst B)\n  (\\<Union>x\\<in>set ((Var v, t) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (2 subgoals):\n 1. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "let ?fvs = \"\\<lambda>L. \\<Union>x \\<in> set L. fv (fst x) \\<union> fv (snd x)\""], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "let ?E' = \"subst_list (subst v t) E\""], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "from \"3.prems\"(3)"], ["proof (chain)\npicking this:\n  (\\<Union>x\\<in>set ((Var v, t) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}", "have \"v \\<notin> set (map fst B)\" \"fv t \\<inter> set (map fst B) = {}\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set ((Var v, t) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. v \\<notin> set (map fst B) &&& fv t \\<inter> set (map fst B) = {}", "by force+"], ["proof (state)\nthis:\n  v \\<notin> set (map fst B)\n  fv t \\<inter> set (map fst B) = {}\n\ngoal (2 subgoals):\n 1. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "hence *: \"distinct (map fst ((v, t)#B))\""], ["proof (prove)\nusing this:\n  v \\<notin> set (map fst B)\n  fv t \\<inter> set (map fst B) = {}\n\ngoal (1 subgoal):\n 1. distinct (map fst ((v, t) # B))", "using \"3.prems\"(2)"], ["proof (prove)\nusing this:\n  v \\<notin> set (map fst B)\n  fv t \\<inter> set (map fst B) = {}\n  distinct (map fst B)\n\ngoal (1 subgoal):\n 1. distinct (map fst ((v, t) # B))", "by auto"], ["proof (state)\nthis:\n  distinct (map fst ((v, t) # B))\n\ngoal (2 subgoals):\n 1. \\<And>x t E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>t = Var x; unify E bs = Some U;\n                    distinct (map fst bs);\n                    (\\<Union>x\\<in>set E.\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst bs) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        \\<And>U.\n           \\<lbrakk>t \\<noteq> Var x; x \\<notin> fv t;\n            unify (subst_list (subst x t) E) ((x, t) # bs) = Some U;\n            distinct (map fst ((x, t) # bs));\n            (\\<Union>x\\<in>set (subst_list (subst x t) E).\n                fv (fst x) \\<union> fv (snd x)) \\<inter>\n            set (map fst ((x, t) # bs)) =\n            {}\\<rbrakk>\n           \\<Longrightarrow> distinct (map fst U);\n        unify ((Var x, t) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Var x, t) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. distinct (map fst U)", "proof (cases \"t = Var v\")"], ["proof (state)\ngoal (2 subgoals):\n 1. t = Var v \\<Longrightarrow> distinct (map fst U)\n 2. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "case True"], ["proof (state)\nthis:\n  t = Var v\n\ngoal (2 subgoals):\n 1. t = Var v \\<Longrightarrow> distinct (map fst U)\n 2. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "thus ?thesis"], ["proof (prove)\nusing this:\n  t = Var v\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "using \"3.prems\" \"3.IH\"(1)"], ["proof (prove)\nusing this:\n  t = Var v\n  unify ((Var v, t) # E) B = Some U\n  distinct (map fst B)\n  (\\<Union>x\\<in>set ((Var v, t) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n  \\<lbrakk>t = Var v; unify E B = Some ?U; distinct (map fst B);\n   (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n   set (map fst B) =\n   {}\\<rbrakk>\n  \\<Longrightarrow> distinct (map fst ?U)\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "by auto"], ["proof (state)\nthis:\n  distinct (map fst U)\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "case False"], ["proof (state)\nthis:\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "hence \"v \\<notin> fv t\""], ["proof (prove)\nusing this:\n  t \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t", "using \"3.prems\"(1)"], ["proof (prove)\nusing this:\n  t \\<noteq> Var v\n  unify ((Var v, t) # E) B = Some U\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t", "by auto"], ["proof (state)\nthis:\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "hence \"Unification.unify (subst_list (subst v t) E) ((v, t)#B) = Some U\""], ["proof (prove)\nusing this:\n  v \\<notin> fv t\n\ngoal (1 subgoal):\n 1. unify (subst_list (subst v t) E) ((v, t) # B) = Some U", "using \\<open>t \\<noteq> Var v\\<close> \"3.prems\"(1)"], ["proof (prove)\nusing this:\n  v \\<notin> fv t\n  t \\<noteq> Var v\n  unify ((Var v, t) # E) B = Some U\n\ngoal (1 subgoal):\n 1. unify (subst_list (subst v t) E) ((v, t) # B) = Some U", "by auto"], ["proof (state)\nthis:\n  unify (subst_list (subst v t) E) ((v, t) # B) = Some U\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "moreover"], ["proof (state)\nthis:\n  unify (subst_list (subst v t) E) ((v, t) # B) = Some U\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "have \"?fvs ?E' \\<inter> set (map fst ((v, t)#B)) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, t) # B)) =\n    {}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, t) # B)) =\n    {}", "have \"v \\<notin> ?fvs ?E'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v t) E).\n                   fv (fst x) \\<union> fv (snd x))", "unfolding subst_list_def subst_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> (\\<Union>x\\<in>set (map (\\<lambda>p.\n     (fst p \\<cdot> Var(v := t), snd p \\<cdot> Var(v := t)))\n                                    E).\n                   fv (fst x) \\<union> fv (snd x))", "by (simp add: \\<open>v \\<notin> fv t\\<close> subst_remove_var)"], ["proof (state)\nthis:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v t) E).\n                 fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, t) # B)) =\n    {}", "moreover"], ["proof (state)\nthis:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v t) E).\n                 fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, t) # B)) =\n    {}", "have \"?fvs ?E' \\<subseteq> fv t \\<union> ?fvs E\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv t \\<union>\n                (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))", "by (metis subst_list_singleton_fv_subset)"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, t) # B)) =\n    {}", "hence \"?fvs ?E' \\<inter> set (map fst B) = {}\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "using \"3.prems\"(3)"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv t \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set ((Var v, t) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, t) # B)) =\n    {}", "ultimately"], ["proof (chain)\npicking this:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v t) E).\n                 fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}", "show ?thesis"], ["proof (prove)\nusing this:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v t) E).\n                 fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v t) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, t) # B)) =\n    {}", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst ((v, t) # B)) =\n  {}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst ((v, t) # B)) =\n  {}\n\ngoal (1 subgoal):\n 1. t \\<noteq> Var v \\<Longrightarrow> distinct (map fst U)", "ultimately"], ["proof (chain)\npicking this:\n  unify (subst_list (subst v t) E) ((v, t) # B) = Some U\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst ((v, t) # B)) =\n  {}", "show ?thesis"], ["proof (prove)\nusing this:\n  unify (subst_list (subst v t) E) ((v, t) # B) = Some U\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst ((v, t) # B)) =\n  {}\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "using \"3.IH\"(2)[OF \\<open>t \\<noteq> Var v\\<close> \\<open>v \\<notin> fv t\\<close> _ *]"], ["proof (prove)\nusing this:\n  unify (subst_list (subst v t) E) ((v, t) # B) = Some U\n  (\\<Union>x\\<in>set (subst_list (subst v t) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst ((v, t) # B)) =\n  {}\n  \\<lbrakk>unify (subst_list (subst v t) E) ((v, t) # B) = Some ?U;\n   (\\<Union>x\\<in>set (subst_list (subst v t) E).\n       fv (fst x) \\<union> fv (snd x)) \\<inter>\n   set (map fst ((v, t) # B)) =\n   {}\\<rbrakk>\n  \\<Longrightarrow> distinct (map fst ?U)\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "by metis"], ["proof (state)\nthis:\n  distinct (map fst U)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  distinct (map fst U)\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "case (4 f X v E B U)"], ["proof (state)\nthis:\n  \\<lbrakk>v \\<notin> fv (Fun f X);\n   unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) = Some ?U;\n   distinct (map fst ((v, Fun f X) # B));\n   (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n       fv (fst x) \\<union> fv (snd x)) \\<inter>\n   set (map fst ((v, Fun f X) # B)) =\n   {}\\<rbrakk>\n  \\<Longrightarrow> distinct (map fst ?U)\n  unify ((Fun f X, Var v) # E) B = Some U\n  distinct (map fst B)\n  (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "let ?fvs = \"\\<lambda>L. \\<Union>x \\<in> set L. fv (fst x) \\<union> fv (snd x)\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "let ?E' = \"subst_list (subst v (Fun f X)) E\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "have *: \"?fvs E \\<inter> set (map fst B) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "using \"4.prems\"(3)"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "from \"4.prems\"(1)"], ["proof (chain)\npicking this:\n  unify ((Fun f X, Var v) # E) B = Some U", "have \"v \\<notin> fv (Fun f X)\""], ["proof (prove)\nusing this:\n  unify ((Fun f X, Var v) # E) B = Some U\n\ngoal (1 subgoal):\n 1. v \\<notin> fv (Fun f X)", "by force"], ["proof (state)\nthis:\n  v \\<notin> fv (Fun f X)\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "from \"4.prems\"(3)"], ["proof (chain)\npicking this:\n  (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}", "have **: \"v \\<notin> set (map fst B)\" \"fv (Fun f X) \\<inter> set (map fst B) = {}\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. v \\<notin> set (map fst B) &&&\n    fv (Fun f X) \\<inter> set (map fst B) = {}", "by force+"], ["proof (state)\nthis:\n  v \\<notin> set (map fst B)\n  fv (Fun f X) \\<inter> set (map fst B) = {}\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "hence ***: \"distinct (map fst ((v, Fun f X)#B))\""], ["proof (prove)\nusing this:\n  v \\<notin> set (map fst B)\n  fv (Fun f X) \\<inter> set (map fst B) = {}\n\ngoal (1 subgoal):\n 1. distinct (map fst ((v, Fun f X) # B))", "using \"4.prems\"(2)"], ["proof (prove)\nusing this:\n  v \\<notin> set (map fst B)\n  fv (Fun f X) \\<inter> set (map fst B) = {}\n  distinct (map fst B)\n\ngoal (1 subgoal):\n 1. distinct (map fst ((v, Fun f X) # B))", "by auto"], ["proof (state)\nthis:\n  distinct (map fst ((v, Fun f X) # B))\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "from \"4.prems\"(3)"], ["proof (chain)\npicking this:\n  (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}", "have ****: \"?fvs ?E' \\<inter> set (map fst ((v, Fun f X)#B)) = {}\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, Fun f X) # B)) =\n    {}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {} \\<Longrightarrow>\n    (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, Fun f X) # B)) =\n    {}", "have \"v \\<notin> ?fvs ?E'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n                   fv (fst x) \\<union> fv (snd x))", "unfolding subst_list_def subst_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> (\\<Union>x\\<in>set (map (\\<lambda>p.\n     (fst p \\<cdot> Var(v := Fun f X), snd p \\<cdot> Var(v := Fun f X)))\n                                    E).\n                   fv (fst x) \\<union> fv (snd x))", "using \\<open>v \\<notin> fv (Fun f X)\\<close> subst_remove_var[of v \"Fun f X\"]"], ["proof (prove)\nusing this:\n  v \\<notin> fv (Fun f X)\n  v \\<notin> fv (Fun f X) \\<Longrightarrow>\n  v \\<notin> fv (?t \\<cdot> Var(v := Fun f X))\n\ngoal (1 subgoal):\n 1. v \\<notin> (\\<Union>x\\<in>set (map (\\<lambda>p.\n     (fst p \\<cdot> Var(v := Fun f X), snd p \\<cdot> Var(v := Fun f X)))\n                                    E).\n                   fv (fst x) \\<union> fv (snd x))", "by simp"], ["proof (state)\nthis:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n                 fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {} \\<Longrightarrow>\n    (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, Fun f X) # B)) =\n    {}", "moreover"], ["proof (state)\nthis:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n                 fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {} \\<Longrightarrow>\n    (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, Fun f X) # B)) =\n    {}", "have \"?fvs ?E' \\<subseteq> fv (Fun f X) \\<union> ?fvs E\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x))\n    \\<subseteq> fv (Fun f X) \\<union>\n                (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))", "by (metis subst_list_singleton_fv_subset)"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (Fun f X) \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {} \\<Longrightarrow>\n    (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, Fun f X) # B)) =\n    {}", "hence \"?fvs ?E' \\<inter> set (map fst B) = {}\""], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (Fun f X) \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "using * **"], ["proof (prove)\nusing this:\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x))\n  \\<subseteq> fv (Fun f X) \\<union>\n              (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set E. fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n  v \\<notin> set (map fst B)\n  fv (Fun f X) \\<inter> set (map fst B) = {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {}", "by blast"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set ((Fun f X, Var v) # E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst B) =\n    {} \\<Longrightarrow>\n    (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, Fun f X) # B)) =\n    {}", "ultimately"], ["proof (chain)\npicking this:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n                 fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}", "show ?thesis"], ["proof (prove)\nusing this:\n  v \\<notin> (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n                 fv (fst x) \\<union> fv (snd x))\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst B) =\n  {}\n\ngoal (1 subgoal):\n 1. (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n        fv (fst x) \\<union> fv (snd x)) \\<inter>\n    set (map fst ((v, Fun f X) # B)) =\n    {}", "by auto"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst ((v, Fun f X) # B)) =\n  {}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (\\<Union>x\\<in>set (subst_list (subst v (Fun f X)) E).\n      fv (fst x) \\<union> fv (snd x)) \\<inter>\n  set (map fst ((v, Fun f X) # B)) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "have \"Unification.unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) = Some U\""], ["proof (prove)\ngoal (1 subgoal):\n 1. unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) = Some U", "using \\<open>v \\<notin> fv (Fun f X)\\<close> \"4.prems\"(1)"], ["proof (prove)\nusing this:\n  v \\<notin> fv (Fun f X)\n  unify ((Fun f X, Var v) # E) B = Some U\n\ngoal (1 subgoal):\n 1. unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) = Some U", "by auto"], ["proof (state)\nthis:\n  unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) = Some U\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    distinct (map fst ((x, Fun v va) # bs));\n                    (\\<Union>x\\<in>set (subst_list (subst x (Fun v va)) E).\n                        fv (fst x) \\<union> fv (snd x)) \\<inter>\n                    set (map fst ((x, Fun v va) # bs)) =\n                    {}\\<rbrakk>\n                   \\<Longrightarrow> distinct (map fst U);\n        unify ((Fun v va, Var x) # E) bs = Some U; distinct (map fst bs);\n        (\\<Union>x\\<in>set ((Fun v va, Var x) # E).\n            fv (fst x) \\<union> fv (snd x)) \\<inter>\n        set (map fst bs) =\n        {}\\<rbrakk>\n       \\<Longrightarrow> distinct (map fst U)", "thus ?case"], ["proof (prove)\nusing this:\n  unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) = Some U\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "using \"4.IH\"[OF \\<open>v \\<notin> fv (Fun f X)\\<close> _ *** ****]"], ["proof (prove)\nusing this:\n  unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) = Some U\n  unify (subst_list (subst v (Fun f X)) E) ((v, Fun f X) # B) =\n  Some ?U \\<Longrightarrow>\n  distinct (map fst ?U)\n\ngoal (1 subgoal):\n 1. distinct (map fst U)", "by metis"], ["proof (state)\nthis:\n  distinct (map fst U)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_None_is_subst_neq:\n  fixes s t::\"('a,'b) term\" and \\<delta>::\"('a,'b) subst\"\n  assumes \"mgu s t = None\"\n  shows \"s \\<cdot> \\<delta> \\<noteq> t \\<cdot> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<noteq> t \\<cdot> \\<delta>", "using assms mgu_always_unifies"], ["proof (prove)\nusing this:\n  mgu s t = None\n  Unifier ?\\<theta> ?M ?N \\<Longrightarrow>\n  \\<exists>\\<delta>. mgu ?M ?N = Some \\<delta>\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<noteq> t \\<cdot> \\<delta>", "by force"], ["", "lemma mgu_None_if_neq_ground:\n  assumes \"t \\<noteq> t'\" \"fv t = {}\" \"fv t' = {}\"\n  shows \"mgu t t' = None\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mgu t t' = None", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. mgu t t' \\<noteq> None \\<Longrightarrow> False", "assume \"mgu t t' \\<noteq> None\""], ["proof (state)\nthis:\n  mgu t t' \\<noteq> None\n\ngoal (1 subgoal):\n 1. mgu t t' \\<noteq> None \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  mgu t t' \\<noteq> None", "obtain \\<delta> where \\<delta>: \"mgu t t' = Some \\<delta>\""], ["proof (prove)\nusing this:\n  mgu t t' \\<noteq> None\n\ngoal (1 subgoal):\n 1. (\\<And>\\<delta>.\n        mgu t t' = Some \\<delta> \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  mgu t t' = Some \\<delta>\n\ngoal (1 subgoal):\n 1. mgu t t' \\<noteq> None \\<Longrightarrow> False", "hence \"t \\<cdot> \\<delta> = t\" \"t' \\<cdot> \\<delta> = t'\""], ["proof (prove)\nusing this:\n  mgu t t' = Some \\<delta>\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<delta> = t &&& t' \\<cdot> \\<delta> = t'", "using assms subst_ground_ident"], ["proof (prove)\nusing this:\n  mgu t t' = Some \\<delta>\n  t \\<noteq> t'\n  fv t = {}\n  fv t' = {}\n  fv ?t = {} \\<Longrightarrow> ?t \\<cdot> ?s = ?t\n\ngoal (1 subgoal):\n 1. t \\<cdot> \\<delta> = t &&& t' \\<cdot> \\<delta> = t'", "by auto"], ["proof (state)\nthis:\n  t \\<cdot> \\<delta> = t\n  t' \\<cdot> \\<delta> = t'\n\ngoal (1 subgoal):\n 1. mgu t t' \\<noteq> None \\<Longrightarrow> False", "thus False"], ["proof (prove)\nusing this:\n  t \\<cdot> \\<delta> = t\n  t' \\<cdot> \\<delta> = t'\n\ngoal (1 subgoal):\n 1. False", "using assms(1) MGU_is_Unifier[OF mgu_gives_MGU[OF \\<delta>]]"], ["proof (prove)\nusing this:\n  t \\<cdot> \\<delta> = t\n  t' \\<cdot> \\<delta> = t'\n  t \\<noteq> t'\n  Unifier \\<delta> t t'\n\ngoal (1 subgoal):\n 1. False", "by auto"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_None_commutes:\n  \"mgu s t = None \\<Longrightarrow> mgu t s = None\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mgu s t = None \\<Longrightarrow> mgu t s = None", "using mgu_complete[of s t]\n      Unifier_in_unifiers_singleton[of s _ t]\n      Unifier_sym[of t _ s]\n      Unifier_in_unifiers_singleton[of t _ s]\n      mgu_sound[of t s]"], ["proof (prove)\nusing this:\n  mgu s t = None \\<Longrightarrow> unifiers {(s, t)} = {}\n  Unifier ?\\<theta> s t = (?\\<theta> \\<in> unifiers {(s, t)})\n  Unifier ?\\<sigma> t s \\<Longrightarrow> Unifier ?\\<sigma> s t\n  Unifier ?\\<theta> t s = (?\\<theta> \\<in> unifiers {(t, s)})\n  mgu t s = Some ?\\<sigma> \\<Longrightarrow> is_imgu ?\\<sigma> {(t, s)}\n\ngoal (1 subgoal):\n 1. mgu s t = None \\<Longrightarrow> mgu t s = None", "unfolding is_imgu_def"], ["proof (prove)\nusing this:\n  mgu s t = None \\<Longrightarrow> unifiers {(s, t)} = {}\n  Unifier ?\\<theta> s t = (?\\<theta> \\<in> unifiers {(s, t)})\n  Unifier ?\\<sigma> t s \\<Longrightarrow> Unifier ?\\<sigma> s t\n  Unifier ?\\<theta> t s = (?\\<theta> \\<in> unifiers {(t, s)})\n  mgu t s = Some ?\\<sigma> \\<Longrightarrow>\n  ?\\<sigma> \\<in> unifiers {(t, s)} \\<and>\n  (\\<forall>\\<tau>\\<in>unifiers {(t, s)}.\n      \\<tau> = ?\\<sigma> \\<circ>\\<^sub>s \\<tau>)\n\ngoal (1 subgoal):\n 1. mgu s t = None \\<Longrightarrow> mgu t s = None", "by fastforce"], ["", "lemma mgu_img_subterm_subst:\n  fixes \\<delta>::\"('f,'v) subst\" and s t u::\"('f,'v) term\"\n  assumes \"mgu s t = Some \\<delta>\" \"u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) - range Var\"\n  shows \"u \\<in> ((subterms s \\<union> subterms t) - range Var) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define subterms_tuples::\"('f,'v) equation list \\<Rightarrow> ('f,'v) terms\" where subtt_def:\n    \"subterms_tuples \\<equiv> \\<lambda>E. subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) \\<union> subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)\""], ["proof (state)\nthis:\n  subterms_tuples \\<equiv>\n  \\<lambda>E.\n     subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) \\<union>\n     subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define subterms_img::\"('f,'v) subst \\<Rightarrow> ('f,'v) terms\" where subti_def:\n    \"subterms_img \\<equiv> \\<lambda>d. subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range d)\""], ["proof (state)\nthis:\n  subterms_img \\<equiv>\n  \\<lambda>d. subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range d)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define d where \"d \\<equiv> \\<lambda>v t. subst v t::('f,'v) subst\""], ["proof (state)\nthis:\n  d \\<equiv> subst\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define V where \"V \\<equiv> range Var::('f,'v) terms\""], ["proof (state)\nthis:\n  V \\<equiv> range Var\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define R where \"R \\<equiv> \\<lambda>d::('f,'v) subst. ((subterms s \\<union> subterms t) - V) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d\""], ["proof (state)\nthis:\n  R \\<equiv>\n  (\\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t) (subterms s \\<union> subterms t - V)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define M where \"M \\<equiv> \\<lambda>E d. subterms_tuples E \\<union> subterms_img d\""], ["proof (state)\nthis:\n  M \\<equiv> \\<lambda>E d. subterms_tuples E \\<union> subterms_img d\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define Q where \"Q \\<equiv> (\\<lambda>E d. M E d - V \\<subseteq> R d - V)\""], ["proof (state)\nthis:\n  Q \\<equiv> \\<lambda>E d. M E d - V \\<subseteq> R d - V\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "define Q' where \"Q' \\<equiv> (\\<lambda>E d d'. (M E d - V) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d' \\<subseteq> (R d - V) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t (d'::('f,'v) subst))\""], ["proof (state)\nthis:\n  Q' \\<equiv>\n  \\<lambda>E d d'.\n     M E d - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d'\n     \\<subseteq> R d - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d'\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "have Q_subst: \"Q (subst_list (subst v t') E) (subst_of ((v, t')#B))\" \n    when v_fv: \"v \\<notin> fv t'\" and Q_assm: \"Q ((Var v, t')#E) (subst_of B)\"\n    for v t' E B"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "define E' where \"E' \\<equiv> subst_list (subst v t') E\""], ["proof (state)\nthis:\n  E' \\<equiv> subst_list (subst v t') E\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "define B' where \"B' \\<equiv> subst_of ((v, t')#B)\""], ["proof (state)\nthis:\n  B' \\<equiv> subst_of ((v, t') # B)\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have E': \"E' = subst_list (d v t') E\"\n        and B': \"B' = subst_of B \\<circ>\\<^sub>s d v t'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. E' = subst_list (d v t') E &&& B' = subst_of B \\<circ>\\<^sub>s d v t'", "using subst_of_simps(3)[of \"(v, t')\"]"], ["proof (prove)\nusing this:\n  subst_of ((v, t') # ?ss) =\n  subst_of ?ss \\<circ>\\<^sub>s subst (fst (v, t')) (snd (v, t'))\n\ngoal (1 subgoal):\n 1. E' = subst_list (d v t') E &&& B' = subst_of B \\<circ>\\<^sub>s d v t'", "unfolding subst_def E'_def B'_def d_def"], ["proof (prove)\nusing this:\n  subst_of ((v, t') # ?ss) =\n  subst_of ?ss \\<circ>\\<^sub>s Var(fst (v, t') := snd (v, t'))\n\ngoal (1 subgoal):\n 1. subst_list (Var(v := t')) E = subst_list (Var(v := t')) E &&&\n    subst_of ((v, t') # B) = subst_of B \\<circ>\\<^sub>s Var(v := t')", "by simp_all"], ["proof (state)\nthis:\n  E' = subst_list (d v t') E\n  B' = subst_of B \\<circ>\\<^sub>s d v t'\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have vt_img_subt: \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) = subterms t'\"\n         and vt_dom: \"subst_domain (d v t') = {v}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) =\n    subterms t' &&&\n    subst_domain (d v t') = {v}", "using v_fv"], ["proof (prove)\nusing this:\n  v \\<notin> fv t'\n\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) =\n    subterms t' &&&\n    subst_domain (d v t') = {v}", "by (auto simp add: subst_domain_def d_def subst_def)"], ["proof (state)\nthis:\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) = subterms t'\n  subst_domain (d v t') = {v}\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have *: \"subterms u1 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E)\" \"subterms u2 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)\"\n      when \"(u1,u2) \\<in> set E\" for u1 u2"], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms u1\n    \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) &&&\n    subterms u2 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)", "using that"], ["proof (prove)\nusing this:\n  (u1, u2) \\<in> set E\n\ngoal (1 subgoal):\n 1. subterms u1\n    \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) &&&\n    subterms u2 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)", "by auto"], ["proof (state)\nthis:\n  (?u1.0, ?u2.0) \\<in> set E \\<Longrightarrow>\n  subterms ?u1.0 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E)\n  (?u1.0, ?u2.0) \\<in> set E \\<Longrightarrow>\n  subterms ?u2.0 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have **: \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (d v t' ` (fv u \\<inter> subst_domain (d v t'))) \\<subseteq> subterms t'\"\n      for u::\"('f,'v) term\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (d v t' ` (fv u \\<inter> subst_domain (d v t')))\n    \\<subseteq> subterms t'", "using vt_dom"], ["proof (prove)\nusing this:\n  subst_domain (d v t') = {v}\n\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (d v t' ` (fv u \\<inter> subst_domain (d v t')))\n    \\<subseteq> subterms t'", "unfolding d_def"], ["proof (prove)\nusing this:\n  subst_domain (subst v t') = {v}\n\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (subst v t' ` (fv u \\<inter> subst_domain (subst v t')))\n    \\<subseteq> subterms t'", "by force"], ["proof (state)\nthis:\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv ?u \\<inter> subst_domain (d v t')))\n  \\<subseteq> subterms t'\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have 1: \"subterms_tuples E' - V \\<subseteq> (subterms t' - V) \\<union> (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')\"\n      (is \"?A \\<subseteq> ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms_tuples E' - V\n    \\<subseteq> subterms t' - V \\<union>\n                (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 d v t')", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples E' - V \\<Longrightarrow>\n       x \\<in> subterms t' - V \\<union>\n               (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t')", "fix u"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples E' - V \\<Longrightarrow>\n       x \\<in> subterms t' - V \\<union>\n               (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t')", "assume \"u \\<in> ?A\""], ["proof (state)\nthis:\n  u \\<in> subterms_tuples E' - V\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples E' - V \\<Longrightarrow>\n       x \\<in> subterms t' - V \\<union>\n               (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t')", "then"], ["proof (chain)\npicking this:\n  u \\<in> subterms_tuples E' - V", "obtain u1 u2 where u12:\n          \"(u1,u2) \\<in> set E\"\n          \"u \\<in> (subterms (u1 \\<cdot> (d v t')) - V) \\<union> (subterms (u2 \\<cdot> (d v t')) - V)\""], ["proof (prove)\nusing this:\n  u \\<in> subterms_tuples E' - V\n\ngoal (1 subgoal):\n 1. (\\<And>u1 u2.\n        \\<lbrakk>(u1, u2) \\<in> set E;\n         u \\<in> subterms (u1 \\<cdot> d v t') - V \\<union>\n                 (subterms (u2 \\<cdot> d v t') - V)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding subtt_def subst_list_def E'_def d_def"], ["proof (prove)\nusing this:\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n           (fst `\n            set (map (\\<lambda>p.\n                         (fst p \\<cdot> subst v t',\n                          snd p \\<cdot> subst v t'))\n                  E)) \\<union>\n          subterms\\<^sub>s\\<^sub>e\\<^sub>t\n           (snd `\n            set (map (\\<lambda>p.\n                         (fst p \\<cdot> subst v t',\n                          snd p \\<cdot> subst v t'))\n                  E)) -\n          V\n\ngoal (1 subgoal):\n 1. (\\<And>u1 u2.\n        \\<lbrakk>(u1, u2) \\<in> set E;\n         u \\<in> subterms (u1 \\<cdot> subst v t') - V \\<union>\n                 (subterms (u2 \\<cdot> subst v t') - V)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  (u1, u2) \\<in> set E\n  u \\<in> subterms (u1 \\<cdot> d v t') - V \\<union>\n          (subterms (u2 \\<cdot> d v t') - V)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples E' - V \\<Longrightarrow>\n       x \\<in> subterms t' - V \\<union>\n               (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t')", "hence \"u \\<in> (subterms t' - V) \\<union> (((subterms_tuples E) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)\""], ["proof (prove)\nusing this:\n  (u1, u2) \\<in> set E\n  u \\<in> subterms (u1 \\<cdot> d v t') - V \\<union>\n          (subterms (u2 \\<cdot> d v t') - V)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms t' - V \\<union>\n            ((subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)", "using subterms_subst[of u1 \"d v t'\"] subterms_subst[of u2 \"d v t'\"]\n              *[OF u12(1)] **[of u1] **[of u2]"], ["proof (prove)\nusing this:\n  (u1, u2) \\<in> set E\n  u \\<in> subterms (u1 \\<cdot> d v t') - V \\<union>\n          (subterms (u2 \\<cdot> d v t') - V)\n  subterms (u1 \\<cdot> d v t') =\n  (subterms u1 \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u1 \\<inter> subst_domain (d v t')))\n  subterms (u2 \\<cdot> d v t') =\n  (subterms u2 \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u2 \\<inter> subst_domain (d v t')))\n  subterms u1 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E)\n  subterms u2 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u1 \\<inter> subst_domain (d v t')))\n  \\<subseteq> subterms t'\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u2 \\<inter> subst_domain (d v t')))\n  \\<subseteq> subterms t'\n\ngoal (1 subgoal):\n 1. u \\<in> subterms t' - V \\<union>\n            ((subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)", "unfolding subtt_def subst_list_def"], ["proof (prove)\nusing this:\n  (u1, u2) \\<in> set E\n  u \\<in> subterms (u1 \\<cdot> d v t') - V \\<union>\n          (subterms (u2 \\<cdot> d v t') - V)\n  subterms (u1 \\<cdot> d v t') =\n  (subterms u1 \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u1 \\<inter> subst_domain (d v t')))\n  subterms (u2 \\<cdot> d v t') =\n  (subterms u2 \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u2 \\<inter> subst_domain (d v t')))\n  subterms u1 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E)\n  subterms u2 \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E)\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u1 \\<inter> subst_domain (d v t')))\n  \\<subseteq> subterms t'\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (d v t' ` (fv u2 \\<inter> subst_domain (d v t')))\n  \\<subseteq> subterms t'\n\ngoal (1 subgoal):\n 1. u \\<in> subterms t' - V \\<union>\n            ((subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) \\<union>\n              subterms\\<^sub>s\\<^sub>e\\<^sub>t\n               (snd ` set E) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              d v t') -\n             V)", "by auto"], ["proof (state)\nthis:\n  u \\<in> subterms t' - V \\<union>\n          ((subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples E' - V \\<Longrightarrow>\n       x \\<in> subterms t' - V \\<union>\n               (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t')", "moreover"], ["proof (state)\nthis:\n  u \\<in> subterms t' - V \\<union>\n          ((subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples E' - V \\<Longrightarrow>\n       x \\<in> subterms t' - V \\<union>\n               (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t')", "have\n          \"(subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V \\<subseteq>\n           (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') \\<union> {t'}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V\n    \\<subseteq> (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 d v t') \\<union>\n                {t'}", "unfolding subst_def subtt_def V_def d_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) \\<union>\n     subterms\\<^sub>s\\<^sub>e\\<^sub>t\n      (snd ` set E) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n     Var(v := t')) -\n    range Var\n    \\<subseteq> (subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) \\<union>\n                 subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E) -\n                 range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 Var(v := t')) \\<union>\n                {t'}", "by force"], ["proof (state)\nthis:\n  (subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V\n  \\<subseteq> (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t') \\<union>\n              {t'}\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples E' - V \\<Longrightarrow>\n       x \\<in> subterms t' - V \\<union>\n               (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t')", "ultimately"], ["proof (chain)\npicking this:\n  u \\<in> subterms t' - V \\<union>\n          ((subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)\n  (subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V\n  \\<subseteq> (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t') \\<union>\n              {t'}", "show \"u \\<in> ?B\""], ["proof (prove)\nusing this:\n  u \\<in> subterms t' - V \\<union>\n          ((subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)\n  (subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V\n  \\<subseteq> (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t') \\<union>\n              {t'}\n\ngoal (1 subgoal):\n 1. u \\<in> subterms t' - V \\<union>\n            (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')", "using u12 v_fv"], ["proof (prove)\nusing this:\n  u \\<in> subterms t' - V \\<union>\n          ((subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V)\n  (subterms_tuples E \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t') - V\n  \\<subseteq> (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t') \\<union>\n              {t'}\n  (u1, u2) \\<in> set E\n  u \\<in> subterms (u1 \\<cdot> d v t') - V \\<union>\n          (subterms (u2 \\<cdot> d v t') - V)\n  v \\<notin> fv t'\n\ngoal (1 subgoal):\n 1. u \\<in> subterms t' - V \\<union>\n            (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')", "by auto"], ["proof (state)\nthis:\n  u \\<in> subterms t' - V \\<union>\n          (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  subterms_tuples E' - V\n  \\<subseteq> subterms t' - V \\<union>\n              (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have 2: \"subterms_img B' - V \\<subseteq>\n             (subterms t' - V) \\<union> (subterms_img (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms_img B' - V\n    \\<subseteq> subterms t' - V \\<union>\n                (subterms_img (subst_of B) -\n                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 d v t')", "using B' vt_img_subt subst_img_comp_subset'''[of \"subst_of B\" \"d v t'\"]"], ["proof (prove)\nusing this:\n  B' = subst_of B \\<circ>\\<^sub>s d v t'\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) = subterms t'\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (subst_range (subst_of B \\<circ>\\<^sub>s d v t')) -\n  range Var\n  \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) -\n              range Var \\<union>\n              (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of B)) -\n               range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t')\n\ngoal (1 subgoal):\n 1. subterms_img B' - V\n    \\<subseteq> subterms t' - V \\<union>\n                (subterms_img (subst_of B) -\n                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 d v t')", "unfolding subti_def subst_def V_def"], ["proof (prove)\nusing this:\n  B' = subst_of B \\<circ>\\<^sub>s d v t'\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) = subterms t'\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (subst_range (subst_of B \\<circ>\\<^sub>s d v t')) -\n  range Var\n  \\<subseteq> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (d v t')) -\n              range Var \\<union>\n              (subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of B)) -\n               range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t')\n\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range B') - range Var\n    \\<subseteq> subterms t' - range Var \\<union>\n                (subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                  (subst_range (subst_of B)) -\n                 range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 d v t')", "by argo"], ["proof (state)\nthis:\n  subterms_img B' - V\n  \\<subseteq> subterms t' - V \\<union>\n              (subterms_img (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t')\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have 3: \"subterms_tuples ((Var v, t')#E) - V = (subterms t' - V) \\<union> (subterms_tuples E - V)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms_tuples ((Var v, t') # E) - V =\n    subterms t' - V \\<union> (subterms_tuples E - V)", "by (auto simp add: subst_def subtt_def V_def)"], ["proof (state)\nthis:\n  subterms_tuples ((Var v, t') # E) - V =\n  subterms t' - V \\<union> (subterms_tuples E - V)\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have \"fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t' - V) \\<inter> subst_domain (d v t') = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t' - V) \\<inter>\n    subst_domain (d v t') =\n    {}", "using v_fv vt_dom fv_subterms[of t']"], ["proof (prove)\nusing this:\n  v \\<notin> fv t'\n  subst_domain (d v t') = {v}\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t') = fv t'\n\ngoal (1 subgoal):\n 1. fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t' - V) \\<inter>\n    subst_domain (d v t') =\n    {}", "by fastforce"], ["proof (state)\nthis:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t' - V) \\<inter>\n  subst_domain (d v t') =\n  {}\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "hence 4: \"subterms t' - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' = subterms t' - V\""], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t' - V) \\<inter>\n  subst_domain (d v t') =\n  {}\n\ngoal (1 subgoal):\n 1. subterms t' - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' = subterms t' - V", "using set_subst_ident[of \"subterms t' - range Var\" \"d v t'\"]"], ["proof (prove)\nusing this:\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t' - V) \\<inter>\n  subst_domain (d v t') =\n  {}\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms t' - range Var) \\<inter>\n  subst_domain (d v t') =\n  {} \\<Longrightarrow>\n  subterms t' - range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' =\n  subterms t' - range Var\n\ngoal (1 subgoal):\n 1. subterms t' - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' = subterms t' - V", "by (simp add: V_def)"], ["proof (state)\nthis:\n  subterms t' - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' = subterms t' - V\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have \"M E' B' - V \\<subseteq> M ((Var v, t')#E) (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M E' B' - V\n    \\<subseteq> M ((Var v, t') # E) (subst_of B) -\n                V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t'", "using 1 2 3 4"], ["proof (prove)\nusing this:\n  subterms_tuples E' - V\n  \\<subseteq> subterms t' - V \\<union>\n              (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')\n  subterms_img B' - V\n  \\<subseteq> subterms t' - V \\<union>\n              (subterms_img (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t')\n  subterms_tuples ((Var v, t') # E) - V =\n  subterms t' - V \\<union> (subterms_tuples E - V)\n  subterms t' - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' = subterms t' - V\n\ngoal (1 subgoal):\n 1. M E' B' - V\n    \\<subseteq> M ((Var v, t') # E) (subst_of B) -\n                V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t'", "unfolding M_def"], ["proof (prove)\nusing this:\n  subterms_tuples E' - V\n  \\<subseteq> subterms t' - V \\<union>\n              (subterms_tuples E - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t')\n  subterms_img B' - V\n  \\<subseteq> subterms t' - V \\<union>\n              (subterms_img (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               d v t')\n  subterms_tuples ((Var v, t') # E) - V =\n  subterms t' - V \\<union> (subterms_tuples E - V)\n  subterms t' - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' = subterms t' - V\n\ngoal (1 subgoal):\n 1. subterms_tuples E' \\<union> subterms_img B' - V\n    \\<subseteq> subterms_tuples ((Var v, t') # E) \\<union>\n                subterms_img (subst_of B) -\n                V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                d v t'", "by blast"], ["proof (state)\nthis:\n  M E' B' - V\n  \\<subseteq> M ((Var v, t') # E) (subst_of B) -\n              V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              d v t'\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "moreover"], ["proof (state)\nthis:\n  M E' B' - V\n  \\<subseteq> M ((Var v, t') # E) (subst_of B) -\n              V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              d v t'\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have \"Q' ((Var v, t')#E) (subst_of B) (d v t')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Q' ((Var v, t') # E) (subst_of B) (d v t')", "using Q_assm"], ["proof (prove)\nusing this:\n  Q ((Var v, t') # E) (subst_of B)\n\ngoal (1 subgoal):\n 1. Q' ((Var v, t') # E) (subst_of B) (d v t')", "unfolding Q_def Q'_def"], ["proof (prove)\nusing this:\n  M ((Var v, t') # E) (subst_of B) - V \\<subseteq> R (subst_of B) - V\n\ngoal (1 subgoal):\n 1. M ((Var v, t') # E) (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    d v t'\n    \\<subseteq> R (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t'", "by auto"], ["proof (state)\nthis:\n  Q' ((Var v, t') # E) (subst_of B) (d v t')\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "moreover"], ["proof (state)\nthis:\n  Q' ((Var v, t') # E) (subst_of B) (d v t')\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "have \"R (subst_of B) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' = R (subst_of ((v,t')#B))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. R (subst_of B) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' =\n    R (subst_of ((v, t') # B))", "unfolding R_def d_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    subst_of B \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    subst v t' =\n    subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n    subst_of ((v, t') # B)", "by auto"], ["proof (state)\nthis:\n  R (subst_of B) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' =\n  R (subst_of ((v, t') # B))\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "ultimately"], ["proof (chain)\npicking this:\n  M E' B' - V\n  \\<subseteq> M ((Var v, t') # E) (subst_of B) -\n              V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              d v t'\n  Q' ((Var v, t') # E) (subst_of B) (d v t')\n  R (subst_of B) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' =\n  R (subst_of ((v, t') # B))", "have\n      \"M (subst_list (d v t') E) (subst_of ((v, t')#B)) - V \\<subseteq> R (subst_of ((v, t')#B)) - V\""], ["proof (prove)\nusing this:\n  M E' B' - V\n  \\<subseteq> M ((Var v, t') # E) (subst_of B) -\n              V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              d v t'\n  Q' ((Var v, t') # E) (subst_of B) (d v t')\n  R (subst_of B) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t d v t' =\n  R (subst_of ((v, t') # B))\n\ngoal (1 subgoal):\n 1. M (subst_list (d v t') E) (subst_of ((v, t') # B)) - V\n    \\<subseteq> R (subst_of ((v, t') # B)) - V", "unfolding Q'_def E'_def B'_def d_def"], ["proof (prove)\nusing this:\n  M (subst_list (subst v t') E) (subst_of ((v, t') # B)) - V\n  \\<subseteq> M ((Var v, t') # E) (subst_of B) -\n              V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n              subst v t'\n  M ((Var v, t') # E) (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst v t'\n  \\<subseteq> R (subst_of B) - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t subst v t'\n  R (subst_of B) \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t subst v t' =\n  R (subst_of ((v, t') # B))\n\ngoal (1 subgoal):\n 1. M (subst_list (subst v t') E) (subst_of ((v, t') # B)) - V\n    \\<subseteq> R (subst_of ((v, t') # B)) - V", "by blast"], ["proof (state)\nthis:\n  M (subst_list (d v t') E) (subst_of ((v, t') # B)) - V\n  \\<subseteq> R (subst_of ((v, t') # B)) - V\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "thus ?thesis"], ["proof (prove)\nusing this:\n  M (subst_list (d v t') E) (subst_of ((v, t') # B)) - V\n  \\<subseteq> R (subst_of ((v, t') # B)) - V\n\ngoal (1 subgoal):\n 1. Q (subst_list (subst v t') E) (subst_of ((v, t') # B))", "unfolding Q_def M_def R_def d_def"], ["proof (prove)\nusing this:\n  subterms_tuples (subst_list (subst v t') E) \\<union>\n  subterms_img (subst_of ((v, t') # B)) -\n  V\n  \\<subseteq> (subterms s \\<union> subterms t -\n               V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n               subst_of ((v, t') # B)) -\n              V\n\ngoal (1 subgoal):\n 1. subterms_tuples (subst_list (subst v t') E) \\<union>\n    subterms_img (subst_of ((v, t') # B)) -\n    V\n    \\<subseteq> (subterms s \\<union> subterms t -\n                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 subst_of ((v, t') # B)) -\n                V", "by blast"], ["proof (state)\nthis:\n  Q (subst_list (subst v t') E) (subst_of ((v, t') # B))\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<lbrakk>?v \\<notin> fv ?t'; Q ((Var ?v, ?t') # ?E) (subst_of ?B)\\<rbrakk>\n  \\<Longrightarrow> Q (subst_list (subst ?v ?t') ?E)\n                     (subst_of ((?v, ?t') # ?B))\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "have \"u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t subst_of U\"\n    when assms':\n      \"unify E B = Some U\"\n      \"u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\"\n      \"Q E (subst_of B)\"\n    for E B U and T::\"('f,'v) term list\""], ["proof (prove)\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "using assms'"], ["proof (prove)\nusing this:\n  unify E B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q E (subst_of B)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "proof (induction E B arbitrary: U rule: Unification.unify.induct)"], ["proof (state)\ngoal (4 subgoals):\n 1. \\<And>bs U.\n       \\<lbrakk>unify [] bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q [] (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 4. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "case (1 B)"], ["proof (state)\nthis:\n  unify [] B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q [] (subst_of B)\n\ngoal (4 subgoals):\n 1. \\<And>bs U.\n       \\<lbrakk>unify [] bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q [] (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 4. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "thus ?case"], ["proof (prove)\nusing this:\n  unify [] B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q [] (subst_of B)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "by (auto simp add: Q_def M_def R_def subti_def)"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          subst_of U\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "next"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "case (2 g X h Y E B U)"], ["proof (state)\nthis:\n  \\<lbrakk>decompose (Fun g X) (Fun h Y) = Some ?x2.0;\n   unify (?x2.0 @ E) B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q (?x2.0 @ E) (subst_of B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  unify ((Fun g X, Fun h Y) # E) B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q ((Fun g X, Fun h Y) # E) (subst_of B)\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "from \"2.prems\"(1)"], ["proof (chain)\npicking this:\n  unify ((Fun g X, Fun h Y) # E) B = Some U", "obtain E' where E':\n        \"decompose (Fun g X) (Fun h Y) = Some E'\"\n        \"g = h\" \"length X = length Y\" \"E' = zip X Y\"\n        \"Unification.unify (E'@E) B = Some U\""], ["proof (prove)\nusing this:\n  unify ((Fun g X, Fun h Y) # E) B = Some U\n\ngoal (1 subgoal):\n 1. (\\<And>E'.\n        \\<lbrakk>decompose (Fun g X) (Fun h Y) = Some E'; g = h;\n         length X = length Y; E' = zip X Y;\n         unify (E' @ E) B = Some U\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto split: option.splits)"], ["proof (state)\nthis:\n  decompose (Fun g X) (Fun h Y) = Some E'\n  g = h\n  length X = length Y\n  E' = zip X Y\n  unify (E' @ E) B = Some U\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "moreover"], ["proof (state)\nthis:\n  decompose (Fun g X) (Fun h Y) = Some E'\n  g = h\n  length X = length Y\n  E' = zip X Y\n  unify (E' @ E) B = Some U\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "have \"subterms_tuples (E'@E) \\<subseteq> subterms_tuples ((Fun g X, Fun h Y)#E)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms_tuples (E' @ E)\n    \\<subseteq> subterms_tuples ((Fun g X, Fun h Y) # E)", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples (E' @ E) \\<Longrightarrow>\n       x \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "fix u"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples (E' @ E) \\<Longrightarrow>\n       x \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "assume \"u \\<in> subterms_tuples (E'@E)\""], ["proof (state)\nthis:\n  u \\<in> subterms_tuples (E' @ E)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples (E' @ E) \\<Longrightarrow>\n       x \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "then"], ["proof (chain)\npicking this:\n  u \\<in> subterms_tuples (E' @ E)", "obtain u1 u2 where u12: \"(u1,u2) \\<in> set (E'@E)\" \"u \\<in> subterms u1 \\<union> subterms u2\""], ["proof (prove)\nusing this:\n  u \\<in> subterms_tuples (E' @ E)\n\ngoal (1 subgoal):\n 1. (\\<And>u1 u2.\n        \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n         u \\<in> subterms u1 \\<union> subterms u2\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding subtt_def"], ["proof (prove)\nusing this:\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set (E' @ E)) \\<union>\n          subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set (E' @ E))\n\ngoal (1 subgoal):\n 1. (\\<And>u1 u2.\n        \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n         u \\<in> subterms u1 \\<union> subterms u2\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by fastforce"], ["proof (state)\nthis:\n  (u1, u2) \\<in> set (E' @ E)\n  u \\<in> subterms u1 \\<union> subterms u2\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subterms_tuples (E' @ E) \\<Longrightarrow>\n       x \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "thus \"u \\<in> subterms_tuples ((Fun g X, Fun h Y)#E)\""], ["proof (prove)\nusing this:\n  (u1, u2) \\<in> set (E' @ E)\n  u \\<in> subterms u1 \\<union> subterms u2\n\ngoal (1 subgoal):\n 1. u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "proof (cases \"(u1,u2) \\<in> set E'\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<in> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)\n 2. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<notin> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "case True"], ["proof (state)\nthis:\n  (u1, u2) \\<in> set E'\n\ngoal (2 subgoals):\n 1. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<in> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)\n 2. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<notin> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "hence \"subterms u1 \\<subseteq> subterms (Fun g X)\" \"subterms u2 \\<subseteq> subterms (Fun h Y)\""], ["proof (prove)\nusing this:\n  (u1, u2) \\<in> set E'\n\ngoal (1 subgoal):\n 1. subterms u1 \\<subseteq> subterms (Fun g X) &&&\n    subterms u2 \\<subseteq> subterms (Fun h Y)", "using E'(4) subterms_subset params_subterms subsetCE"], ["proof (prove)\nusing this:\n  (u1, u2) \\<in> set E'\n  E' = zip X Y\n  ?t' \\<sqsubseteq> ?t \\<Longrightarrow>\n  subterms ?t' \\<subseteq> subterms ?t\n  set ?X \\<subseteq> subterms (Fun ?f ?X)\n  \\<lbrakk>?A \\<subseteq> ?B; ?c \\<notin> ?A \\<Longrightarrow> ?P;\n   ?c \\<in> ?B \\<Longrightarrow> ?P\\<rbrakk>\n  \\<Longrightarrow> ?P\n\ngoal (1 subgoal):\n 1. subterms u1 \\<subseteq> subterms (Fun g X) &&&\n    subterms u2 \\<subseteq> subterms (Fun h Y)", "by (metis set_zip_leftD, metis set_zip_rightD)"], ["proof (state)\nthis:\n  subterms u1 \\<subseteq> subterms (Fun g X)\n  subterms u2 \\<subseteq> subterms (Fun h Y)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<in> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)\n 2. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<notin> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "thus ?thesis"], ["proof (prove)\nusing this:\n  subterms u1 \\<subseteq> subterms (Fun g X)\n  subterms u2 \\<subseteq> subterms (Fun h Y)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "using u12"], ["proof (prove)\nusing this:\n  subterms u1 \\<subseteq> subterms (Fun g X)\n  subterms u2 \\<subseteq> subterms (Fun h Y)\n  (u1, u2) \\<in> set (E' @ E)\n  u \\<in> subterms u1 \\<union> subterms u2\n\ngoal (1 subgoal):\n 1. u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "unfolding subtt_def"], ["proof (prove)\nusing this:\n  subterms u1 \\<subseteq> subterms (Fun g X)\n  subterms u2 \\<subseteq> subterms (Fun h Y)\n  (u1, u2) \\<in> set (E' @ E)\n  u \\<in> subterms u1 \\<union> subterms u2\n\ngoal (1 subgoal):\n 1. u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (fst ` set ((Fun g X, Fun h Y) # E)) \\<union>\n            subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (snd ` set ((Fun g X, Fun h Y) # E))", "by auto"], ["proof (state)\nthis:\n  u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<notin> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<notin> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "case False"], ["proof (state)\nthis:\n  (u1, u2) \\<notin> set E'\n\ngoal (1 subgoal):\n 1. \\<lbrakk>(u1, u2) \\<in> set (E' @ E);\n     u \\<in> subterms u1 \\<union> subterms u2;\n     (u1, u2) \\<notin> set E'\\<rbrakk>\n    \\<Longrightarrow> u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "thus ?thesis"], ["proof (prove)\nusing this:\n  (u1, u2) \\<notin> set E'\n\ngoal (1 subgoal):\n 1. u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "using u12"], ["proof (prove)\nusing this:\n  (u1, u2) \\<notin> set E'\n  (u1, u2) \\<in> set (E' @ E)\n  u \\<in> subterms u1 \\<union> subterms u2\n\ngoal (1 subgoal):\n 1. u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)", "unfolding subtt_def"], ["proof (prove)\nusing this:\n  (u1, u2) \\<notin> set E'\n  (u1, u2) \\<in> set (E' @ E)\n  u \\<in> subterms u1 \\<union> subterms u2\n\ngoal (1 subgoal):\n 1. u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (fst ` set ((Fun g X, Fun h Y) # E)) \\<union>\n            subterms\\<^sub>s\\<^sub>e\\<^sub>t\n             (snd ` set ((Fun g X, Fun h Y) # E))", "by fastforce"], ["proof (state)\nthis:\n  u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  u \\<in> subterms_tuples ((Fun g X, Fun h Y) # E)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  subterms_tuples (E' @ E)\n  \\<subseteq> subterms_tuples ((Fun g X, Fun h Y) # E)\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "hence \"Q (E'@E) (subst_of B)\""], ["proof (prove)\nusing this:\n  subterms_tuples (E' @ E)\n  \\<subseteq> subterms_tuples ((Fun g X, Fun h Y) # E)\n\ngoal (1 subgoal):\n 1. Q (E' @ E) (subst_of B)", "using \"2.prems\"(3)"], ["proof (prove)\nusing this:\n  subterms_tuples (E' @ E)\n  \\<subseteq> subterms_tuples ((Fun g X, Fun h Y) # E)\n  Q ((Fun g X, Fun h Y) # E) (subst_of B)\n\ngoal (1 subgoal):\n 1. Q (E' @ E) (subst_of B)", "unfolding Q_def M_def"], ["proof (prove)\nusing this:\n  subterms_tuples (E' @ E)\n  \\<subseteq> subterms_tuples ((Fun g X, Fun h Y) # E)\n  subterms_tuples ((Fun g X, Fun h Y) # E) \\<union>\n  subterms_img (subst_of B) -\n  V\n  \\<subseteq> R (subst_of B) - V\n\ngoal (1 subgoal):\n 1. subterms_tuples (E' @ E) \\<union> subterms_img (subst_of B) - V\n    \\<subseteq> R (subst_of B) - V", "by blast"], ["proof (state)\nthis:\n  Q (E' @ E) (subst_of B)\n\ngoal (3 subgoals):\n 1. \\<And>f ss g ts E bs U.\n       \\<lbrakk>\\<And>x2 U.\n                   \\<lbrakk>decompose (Fun f ss) (Fun g ts) = Some x2;\n                    unify (x2 @ E) bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (x2 @ E) (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun f ss, Fun g ts) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun f ss, Fun g ts) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 3. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "ultimately"], ["proof (chain)\npicking this:\n  decompose (Fun g X) (Fun h Y) = Some E'\n  g = h\n  length X = length Y\n  E' = zip X Y\n  unify (E' @ E) B = Some U\n  Q (E' @ E) (subst_of B)", "show ?case"], ["proof (prove)\nusing this:\n  decompose (Fun g X) (Fun h Y) = Some E'\n  g = h\n  length X = length Y\n  E' = zip X Y\n  unify (E' @ E) B = Some U\n  Q (E' @ E) (subst_of B)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "using \"2.IH\"[of E' U] \"2.prems\""], ["proof (prove)\nusing this:\n  decompose (Fun g X) (Fun h Y) = Some E'\n  g = h\n  length X = length Y\n  E' = zip X Y\n  unify (E' @ E) B = Some U\n  Q (E' @ E) (subst_of B)\n  \\<lbrakk>decompose (Fun g X) (Fun h Y) = Some E';\n   unify (E' @ E) B = Some U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V;\n   Q (E' @ E) (subst_of B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of U\n  unify ((Fun g X, Fun h Y) # E) B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q ((Fun g X, Fun h Y) # E) (subst_of B)\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "by meson"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          subst_of U\n\ngoal (2 subgoals):\n 1. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "case (3 v t' E B)"], ["proof (state)\nthis:\n  \\<lbrakk>t' = Var v; unify E B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q E (subst_of B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  \\<lbrakk>t' \\<noteq> Var v; v \\<notin> fv t';\n   unify (subst_list (subst v t') E) ((v, t') # B) = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q (subst_list (subst v t') E) (subst_of ((v, t') # B))\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  unify ((Var v, t') # E) B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q ((Var v, t') # E) (subst_of B)\n\ngoal (2 subgoals):\n 1. \\<And>x ta E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>ta = Var x; unify E bs = Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q E (subst_of bs)\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        \\<And>U.\n           \\<lbrakk>ta \\<noteq> Var x; x \\<notin> fv ta;\n            unify (subst_list (subst x ta) E) ((x, ta) # bs) = Some U;\n            u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                     (subst_range (subst_of U)) -\n                    V;\n            Q (subst_list (subst x ta) E) (subst_of ((x, ta) # bs))\\<rbrakk>\n           \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                     V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                     subst_of U;\n        unify ((Var x, ta) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Var x, ta) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U\n 2. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "proof (cases \"t' = Var v\")"], ["proof (state)\ngoal (2 subgoals):\n 1. t' = Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U\n 2. t' \\<noteq> Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "case True"], ["proof (state)\nthis:\n  t' = Var v\n\ngoal (2 subgoals):\n 1. t' = Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U\n 2. t' \\<noteq> Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "thus ?thesis"], ["proof (prove)\nusing this:\n  t' = Var v\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "using \"3.prems\" \"3.IH\"(1)"], ["proof (prove)\nusing this:\n  t' = Var v\n  unify ((Var v, t') # E) B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q ((Var v, t') # E) (subst_of B)\n  \\<lbrakk>t' = Var v; unify E B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q E (subst_of B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "unfolding Q_def M_def V_def subtt_def"], ["proof (prove)\nusing this:\n  t' = Var v\n  unify ((Var v, t') # E) B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) -\n          range Var\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set ((Var v, t') # E)) \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set ((Var v, t') # E)) \\<union>\n  subterms_img (subst_of B) -\n  range Var\n  \\<subseteq> R (subst_of B) - range Var\n  \\<lbrakk>t' = Var v; unify E B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) -\n           range Var;\n   subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set E) \\<union>\n   subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set E) \\<union>\n   subterms_img (subst_of B) -\n   range Var\n   \\<subseteq> R (subst_of B) - range Var\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "by auto"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          subst_of U\n\ngoal (1 subgoal):\n 1. t' \\<noteq> Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. t' \\<noteq> Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "case False"], ["proof (state)\nthis:\n  t' \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. t' \\<noteq> Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "hence 1: \"v \\<notin> fv t'\""], ["proof (prove)\nusing this:\n  t' \\<noteq> Var v\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t'", "using \"3.prems\"(1)"], ["proof (prove)\nusing this:\n  t' \\<noteq> Var v\n  unify ((Var v, t') # E) B = Some U\n\ngoal (1 subgoal):\n 1. v \\<notin> fv t'", "by auto"], ["proof (state)\nthis:\n  v \\<notin> fv t'\n\ngoal (1 subgoal):\n 1. t' \\<noteq> Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "hence \"unify (subst_list (subst v t') E) ((v, t')#B) = Some U\""], ["proof (prove)\nusing this:\n  v \\<notin> fv t'\n\ngoal (1 subgoal):\n 1. unify (subst_list (subst v t') E) ((v, t') # B) = Some U", "using False \"3.prems\"(1)"], ["proof (prove)\nusing this:\n  v \\<notin> fv t'\n  t' \\<noteq> Var v\n  unify ((Var v, t') # E) B = Some U\n\ngoal (1 subgoal):\n 1. unify (subst_list (subst v t') E) ((v, t') # B) = Some U", "by auto"], ["proof (state)\nthis:\n  unify (subst_list (subst v t') E) ((v, t') # B) = Some U\n\ngoal (1 subgoal):\n 1. t' \\<noteq> Var v \\<Longrightarrow>\n    u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "thus ?thesis"], ["proof (prove)\nusing this:\n  unify (subst_list (subst v t') E) ((v, t') # B) = Some U\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "using Q_subst[OF 1 \"3.prems\"(3)]\n              \"3.IH\"(2)[OF False 1 _ \"3.prems\"(2)]"], ["proof (prove)\nusing this:\n  unify (subst_list (subst v t') E) ((v, t') # B) = Some U\n  Q (subst_list (subst v t') E) (subst_of ((v, t') # B))\n  \\<lbrakk>unify (subst_list (subst v t') E) ((v, t') # B) = Some U;\n   Q (subst_list (subst v t') E) (subst_of ((v, t') # B))\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of U\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "by metis"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          subst_of U\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          subst_of U\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "case (4 g X v E B U)"], ["proof (state)\nthis:\n  \\<lbrakk>v \\<notin> fv (Fun g X);\n   unify (subst_list (subst v (Fun g X)) E) ((v, Fun g X) # B) = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q (subst_list (subst v (Fun g X)) E)\n    (subst_of ((v, Fun g X) # B))\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  unify ((Fun g X, Var v) # E) B = Some U\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of U)) - V\n  Q ((Fun g X, Var v) # E) (subst_of B)\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "have 1: \"v \\<notin> fv (Fun g X)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<notin> fv (Fun g X)", "using \"4.prems\"(1) not_None_eq"], ["proof (prove)\nusing this:\n  unify ((Fun g X, Var v) # E) B = Some U\n  (?x \\<noteq> None) = (\\<exists>y. ?x = Some y)\n\ngoal (1 subgoal):\n 1. v \\<notin> fv (Fun g X)", "by fastforce"], ["proof (state)\nthis:\n  v \\<notin> fv (Fun g X)\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "hence 2: \"unify (subst_list (subst v (Fun g X)) E) ((v, Fun g X)#B) = Some U\""], ["proof (prove)\nusing this:\n  v \\<notin> fv (Fun g X)\n\ngoal (1 subgoal):\n 1. unify (subst_list (subst v (Fun g X)) E) ((v, Fun g X) # B) = Some U", "using \"4.prems\"(1)"], ["proof (prove)\nusing this:\n  v \\<notin> fv (Fun g X)\n  unify ((Fun g X, Var v) # E) B = Some U\n\ngoal (1 subgoal):\n 1. unify (subst_list (subst v (Fun g X)) E) ((v, Fun g X) # B) = Some U", "by auto"], ["proof (state)\nthis:\n  unify (subst_list (subst v (Fun g X)) E) ((v, Fun g X) # B) = Some U\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "have 3: \"Q ((Var v, Fun g X)#E) (subst_of B)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Q ((Var v, Fun g X) # E) (subst_of B)", "using \"4.prems\"(3)"], ["proof (prove)\nusing this:\n  Q ((Fun g X, Var v) # E) (subst_of B)\n\ngoal (1 subgoal):\n 1. Q ((Var v, Fun g X) # E) (subst_of B)", "unfolding Q_def M_def subtt_def"], ["proof (prove)\nusing this:\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (fst ` set ((Fun g X, Var v) # E)) \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (snd ` set ((Fun g X, Var v) # E)) \\<union>\n  subterms_img (subst_of B) -\n  V\n  \\<subseteq> R (subst_of B) - V\n\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (fst ` set ((Var v, Fun g X) # E)) \\<union>\n    subterms\\<^sub>s\\<^sub>e\\<^sub>t\n     (snd ` set ((Var v, Fun g X) # E)) \\<union>\n    subterms_img (subst_of B) -\n    V\n    \\<subseteq> R (subst_of B) - V", "by auto"], ["proof (state)\nthis:\n  Q ((Var v, Fun g X) # E) (subst_of B)\n\ngoal (1 subgoal):\n 1. \\<And>v va x E bs U.\n       \\<lbrakk>\\<And>U.\n                   \\<lbrakk>x \\<notin> fv (Fun v va);\n                    unify (subst_list (subst x (Fun v va)) E)\n                     ((x, Fun v va) # bs) =\n                    Some U;\n                    u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                             (subst_range (subst_of U)) -\n                            V;\n                    Q (subst_list (subst x (Fun v va)) E)\n                     (subst_of ((x, Fun v va) # bs))\\<rbrakk>\n                   \\<Longrightarrow> u \\<in> subterms s \\<union>\n       subterms t -\n       V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n       subst_of U;\n        unify ((Fun v va, Var x) # E) bs = Some U;\n        u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t\n                 (subst_range (subst_of U)) -\n                V;\n        Q ((Fun v va, Var x) # E) (subst_of bs)\\<rbrakk>\n       \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                                 subst_of U", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "using Q_subst[OF 1 3] \"4.IH\"[OF 1 2 \"4.prems\"(2)]"], ["proof (prove)\nusing this:\n  Q (subst_list (subst v (Fun g X)) E) (subst_of ((v, Fun g X) # B))\n  Q (subst_list (subst v (Fun g X)) E)\n   (subst_of ((v, Fun g X) # B)) \\<Longrightarrow>\n  u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          subst_of U\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            subst_of U", "by metis"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          subst_of U\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<lbrakk>unify ?E ?B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q ?E (subst_of ?B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "moreover"], ["proof (state)\nthis:\n  \\<lbrakk>unify ?E ?B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q ?E (subst_of ?B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "obtain D where \"unify [(s, t)] [] = Some D\" \"\\<delta> = subst_of D\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>D.\n        \\<lbrakk>unify [(s, t)] [] = Some D; \\<delta> = subst_of D\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using assms(1)"], ["proof (prove)\nusing this:\n  mgu s t = Some \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<And>D.\n        \\<lbrakk>unify [(s, t)] [] = Some D; \\<delta> = subst_of D\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto split: option.splits)"], ["proof (state)\nthis:\n  unify [(s, t)] [] = Some D\n  \\<delta> = subst_of D\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "moreover"], ["proof (state)\nthis:\n  unify [(s, t)] [] = Some D\n  \\<delta> = subst_of D\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "have \"Q [(s,t)] (subst_of [])\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Q [(s, t)] (subst_of [])", "unfolding Q_def M_def R_def subtt_def subti_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. subterms\\<^sub>s\\<^sub>e\\<^sub>t (fst ` set [(s, t)]) \\<union>\n    subterms\\<^sub>s\\<^sub>e\\<^sub>t (snd ` set [(s, t)]) \\<union>\n    subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of [])) -\n    V\n    \\<subseteq> (subterms s \\<union> subterms t -\n                 V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                 subst_of []) -\n                V", "by force"], ["proof (state)\nthis:\n  Q [(s, t)] (subst_of [])\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "ultimately"], ["proof (chain)\npicking this:\n  \\<lbrakk>unify ?E ?B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q ?E (subst_of ?B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  unify [(s, t)] [] = Some D\n  \\<delta> = subst_of D\n  Q [(s, t)] (subst_of [])", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<lbrakk>unify ?E ?B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q ?E (subst_of ?B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  unify [(s, t)] [] = Some D\n  \\<delta> = subst_of D\n  Q [(s, t)] (subst_of [])\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "using assms(2)"], ["proof (prove)\nusing this:\n  \\<lbrakk>unify ?E ?B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) - V;\n   Q ?E (subst_of ?B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            V \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  unify [(s, t)] [] = Some D\n  \\<delta> = subst_of D\n  Q [(s, t)] (subst_of [])\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) -\n          range Var\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "unfolding V_def"], ["proof (prove)\nusing this:\n  \\<lbrakk>unify ?E ?B = Some ?U;\n   u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range (subst_of ?U)) -\n           range Var;\n   Q ?E (subst_of ?B)\\<rbrakk>\n  \\<Longrightarrow> u \\<in> subterms s \\<union> subterms t -\n                            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n                            subst_of ?U\n  unify [(s, t)] [] = Some D\n  \\<delta> = subst_of D\n  Q [(s, t)] (subst_of [])\n  u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) -\n          range Var\n\ngoal (1 subgoal):\n 1. u \\<in> subterms s \\<union> subterms t -\n            range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n            \\<delta>", "by auto"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t -\n          range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_img_consts:\n  fixes \\<delta>::\"('f,'v) subst\" and s t::\"('f,'v) term\" and c::'f and z::'v\n  assumes \"mgu s t = Some \\<delta>\" \"Fun c [] \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)\"\n  shows \"Fun c [] \\<in> subterms s \\<union> subterms t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun c [] \\<in> subterms s \\<union> subterms t", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Fun c [] \\<in> subterms s \\<union> subterms t", "obtain u where \"u \\<in> (subterms s \\<union> subterms t) - range Var\" \"u \\<cdot> \\<delta> = Fun c []\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>u \\<in> subterms s \\<union> subterms t - range Var;\n         u \\<cdot> \\<delta> = Fun c []\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using mgu_img_subterm_subst[OF assms(1), of \"Fun c []\"] assms(2)"], ["proof (prove)\nusing this:\n  Fun c []\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) -\n        range Var \\<Longrightarrow>\n  Fun c []\n  \\<in> subterms s \\<union> subterms t -\n        range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<delta>\n  Fun c [] \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t subst_range \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>u \\<in> subterms s \\<union> subterms t - range Var;\n         u \\<cdot> \\<delta> = Fun c []\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by force"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - range Var\n  u \\<cdot> \\<delta> = Fun c []\n\ngoal (1 subgoal):\n 1. Fun c [] \\<in> subterms s \\<union> subterms t", "thus ?thesis"], ["proof (prove)\nusing this:\n  u \\<in> subterms s \\<union> subterms t - range Var\n  u \\<cdot> \\<delta> = Fun c []\n\ngoal (1 subgoal):\n 1. Fun c [] \\<in> subterms s \\<union> subterms t", "by (cases u) auto"], ["proof (state)\nthis:\n  Fun c [] \\<in> subterms s \\<union> subterms t\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mgu_img_consts':\n  fixes \\<delta>::\"('f,'v) subst\" and s t::\"('f,'v) term\" and c::'f and z::'v\n  assumes \"mgu s t = Some \\<delta>\" \"\\<delta> z = Fun c []\"\n  shows \"Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t", "using mgu_img_consts[OF assms(1)] assms(2)"], ["proof (prove)\nusing this:\n  Fun ?c [] \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<delta> \\<Longrightarrow>\n  Fun ?c [] \\<in> subterms s \\<union> subterms t\n  \\<delta> z = Fun c []\n\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t", "by (metis Un_iff in_subterms_Union subst_imgI term.distinct(1))"], ["", "lemma mgu_img_composed_var_term:\n  fixes \\<delta>::\"('f,'v) subst\" and s t::\"('f,'v) term\" and f::'f and Z::\"'v list\"\n  assumes \"mgu s t = Some \\<delta>\" \"Fun f (map Var Z) \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)\"\n  shows \"\\<exists>Z'. map \\<delta> Z' = map Var Z \\<and> Fun f (map Var Z') \\<in> subterms s \\<union> subterms t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "obtain u where u: \"u \\<in> (subterms s \\<union> subterms t) - range Var\" \"u \\<cdot> \\<delta> = Fun f (map Var Z)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>u \\<in> subterms s \\<union> subterms t - range Var;\n         u \\<cdot> \\<delta> = Fun f (map Var Z)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using mgu_img_subterm_subst[OF assms(1), of \"Fun f (map Var Z)\"] assms(2)"], ["proof (prove)\nusing this:\n  Fun f (map Var Z)\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) -\n        range Var \\<Longrightarrow>\n  Fun f (map Var Z)\n  \\<in> subterms s \\<union> subterms t -\n        range Var \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<delta>\n  Fun f (map Var Z) \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>u \\<in> subterms s \\<union> subterms t - range Var;\n         u \\<cdot> \\<delta> = Fun f (map Var Z)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by fastforce"], ["proof (state)\nthis:\n  u \\<in> subterms s \\<union> subterms t - range Var\n  u \\<cdot> \\<delta> = Fun f (map Var Z)\n\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "then"], ["proof (chain)\npicking this:\n  u \\<in> subterms s \\<union> subterms t - range Var\n  u \\<cdot> \\<delta> = Fun f (map Var Z)", "obtain T where T: \"u = Fun f T\" \"map (\\<lambda>t. t \\<cdot> \\<delta>) T = map Var Z\""], ["proof (prove)\nusing this:\n  u \\<in> subterms s \\<union> subterms t - range Var\n  u \\<cdot> \\<delta> = Fun f (map Var Z)\n\ngoal (1 subgoal):\n 1. (\\<And>T.\n        \\<lbrakk>u = Fun f T;\n         T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> =\n         map Var Z\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (cases u) auto"], ["proof (state)\nthis:\n  u = Fun f T\n  T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> = map Var Z\n\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "have \"\\<forall>t \\<in> set T. \\<exists>x. t = Var x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>set T. \\<exists>x. t = Var x", "using T(2)"], ["proof (prove)\nusing this:\n  T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> = map Var Z\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>set T. \\<exists>x. t = Var x", "by (induct T arbitrary: Z) auto"], ["proof (state)\nthis:\n  \\<forall>t\\<in>set T. \\<exists>x. t = Var x\n\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "then"], ["proof (chain)\npicking this:\n  \\<forall>t\\<in>set T. \\<exists>x. t = Var x", "obtain Z' where Z': \"map Var Z' = T\""], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>set T. \\<exists>x. t = Var x\n\ngoal (1 subgoal):\n 1. (\\<And>Z'. map Var Z' = T \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis ex_map_conv)"], ["proof (state)\nthis:\n  map Var Z' = T\n\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "hence \"map \\<delta> Z' = map Var Z\""], ["proof (prove)\nusing this:\n  map Var Z' = T\n\ngoal (1 subgoal):\n 1. map \\<delta> Z' = map Var Z", "using T(2)"], ["proof (prove)\nusing this:\n  map Var Z' = T\n  T \\<cdot>\\<^sub>l\\<^sub>i\\<^sub>s\\<^sub>t \\<delta> = map Var Z\n\ngoal (1 subgoal):\n 1. map \\<delta> Z' = map Var Z", "by (induct Z' arbitrary: T Z) auto"], ["proof (state)\nthis:\n  map \\<delta> Z' = map Var Z\n\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "thus ?thesis"], ["proof (prove)\nusing this:\n  map \\<delta> Z' = map Var Z\n\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "using u(1) T(1) Z'"], ["proof (prove)\nusing this:\n  map \\<delta> Z' = map Var Z\n  u \\<in> subterms s \\<union> subterms t - range Var\n  u = Fun f T\n  map Var Z' = T\n\ngoal (1 subgoal):\n 1. \\<exists>Z'.\n       map \\<delta> Z' = map Var Z \\<and>\n       Fun f (map Var Z') \\<in> subterms s \\<union> subterms t", "by auto"], ["proof (state)\nthis:\n  \\<exists>Z'.\n     map \\<delta> Z' = map Var Z \\<and>\n     Fun f (map Var Z') \\<in> subterms s \\<union> subterms t\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \\<open>Lemmata: The \"Inequality Lemmata\"\\<close>"], ["", "text \\<open>Subterm injectivity (a stronger injectivity property)\\<close>"], ["", "definition subterm_inj_on where\n  \"subterm_inj_on f A \\<equiv> \\<forall>x\\<in>A. \\<forall>y\\<in>A. (\\<exists>v. v \\<sqsubseteq> f x \\<and> v \\<sqsubseteq> f y) \\<longrightarrow> x = y\""], ["", "lemma subterm_inj_on_imp_inj_on: \"subterm_inj_on f A \\<Longrightarrow> inj_on f A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterm_inj_on f A \\<Longrightarrow> inj_on f A", "unfolding subterm_inj_on_def inj_on_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>x\\<in>A.\n       \\<forall>y\\<in>A.\n          (\\<exists>v.\n              v \\<sqsubseteq> f x \\<and>\n              v \\<sqsubseteq> f y) \\<longrightarrow>\n          x = y \\<Longrightarrow>\n    \\<forall>x\\<in>A. \\<forall>y\\<in>A. f x = f y \\<longrightarrow> x = y", "by fastforce"], ["", "lemma subst_inj_on_is_bij_betw:\n  \"inj_on \\<theta> (subst_domain \\<theta>) = bij_betw \\<theta> (subst_domain \\<theta>) (subst_range \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inj_on \\<theta> (subst_domain \\<theta>) =\n    bij_betw \\<theta> (subst_domain \\<theta>) (subst_range \\<theta>)", "unfolding inj_on_def bij_betw_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<forall>x\\<in>subst_domain \\<theta>.\n        \\<forall>y\\<in>subst_domain \\<theta>.\n           \\<theta> x = \\<theta> y \\<longrightarrow> x = y) =\n    ((\\<forall>x\\<in>subst_domain \\<theta>.\n         \\<forall>y\\<in>subst_domain \\<theta>.\n            \\<theta> x = \\<theta> y \\<longrightarrow> x = y) \\<and>\n     \\<theta> ` subst_domain \\<theta> = subst_range \\<theta>)", "by auto"], ["", "lemma subterm_inj_on_alt_def:\n    \"subterm_inj_on f A \\<longleftrightarrow>\n     (inj_on f A \\<and> (\\<forall>s \\<in> f`A. \\<forall>u \\<in> f`A. (\\<exists>v. v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow> s = u))\"\n    (is \"?A \\<longleftrightarrow> ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. subterm_inj_on f A =\n    (inj_on f A \\<and>\n     (\\<forall>s\\<in>f ` A.\n         \\<forall>u\\<in>f ` A.\n            (\\<exists>v.\n                v \\<sqsubseteq> s \\<and>\n                v \\<sqsubseteq> u) \\<longrightarrow>\n            s = u))", "unfolding subterm_inj_on_def inj_on_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<forall>x\\<in>A.\n        \\<forall>y\\<in>A.\n           (\\<exists>v.\n               v \\<sqsubseteq> f x \\<and>\n               v \\<sqsubseteq> f y) \\<longrightarrow>\n           x = y) =\n    ((\\<forall>x\\<in>A.\n         \\<forall>y\\<in>A. f x = f y \\<longrightarrow> x = y) \\<and>\n     (\\<forall>s\\<in>f ` A.\n         \\<forall>u\\<in>f ` A.\n            (\\<exists>v.\n                v \\<sqsubseteq> s \\<and>\n                v \\<sqsubseteq> u) \\<longrightarrow>\n            s = u))", "by fastforce"], ["", "lemma subterm_inj_on_alt_def':\n    \"subterm_inj_on \\<theta> (subst_domain \\<theta>) \\<longleftrightarrow>\n     (inj_on \\<theta> (subst_domain \\<theta>) \\<and>\n      (\\<forall>s \\<in> subst_range \\<theta>. \\<forall>u \\<in> subst_range \\<theta>. (\\<exists>v. v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow> s = u))\"\n    (is \"?A \\<longleftrightarrow> ?B\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. subterm_inj_on \\<theta> (subst_domain \\<theta>) =\n    (inj_on \\<theta> (subst_domain \\<theta>) \\<and>\n     (\\<forall>s\\<in>subst_range \\<theta>.\n         \\<forall>u\\<in>subst_range \\<theta>.\n            (\\<exists>v.\n                v \\<sqsubseteq> s \\<and>\n                v \\<sqsubseteq> u) \\<longrightarrow>\n            s = u))", "by (metis subterm_inj_on_alt_def subst_range.simps)"], ["", "lemma subterm_inj_on_subset:\n  assumes \"subterm_inj_on f A\"\n    and \"B \\<subseteq> A\"\n  shows \"subterm_inj_on f B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subterm_inj_on f B", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. subterm_inj_on f B", "have \"inj_on f A\" \"\\<forall>s\\<in>f ` A. \\<forall>u\\<in>f ` A. (\\<exists>v. v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow> s = u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inj_on f A &&&\n    \\<forall>s\\<in>f ` A.\n       \\<forall>u\\<in>f ` A.\n          (\\<exists>v.\n              v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n          s = u", "using subterm_inj_on_alt_def[of f A] assms(1)"], ["proof (prove)\nusing this:\n  subterm_inj_on f A =\n  (inj_on f A \\<and>\n   (\\<forall>s\\<in>f ` A.\n       \\<forall>u\\<in>f ` A.\n          (\\<exists>v.\n              v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n          s = u))\n  subterm_inj_on f A\n\ngoal (1 subgoal):\n 1. inj_on f A &&&\n    \\<forall>s\\<in>f ` A.\n       \\<forall>u\\<in>f ` A.\n          (\\<exists>v.\n              v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n          s = u", "by auto"], ["proof (state)\nthis:\n  inj_on f A\n  \\<forall>s\\<in>f ` A.\n     \\<forall>u\\<in>f ` A.\n        (\\<exists>v.\n            v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n        s = u\n\ngoal (1 subgoal):\n 1. subterm_inj_on f B", "moreover"], ["proof (state)\nthis:\n  inj_on f A\n  \\<forall>s\\<in>f ` A.\n     \\<forall>u\\<in>f ` A.\n        (\\<exists>v.\n            v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n        s = u\n\ngoal (1 subgoal):\n 1. subterm_inj_on f B", "have \"f ` B \\<subseteq> f ` A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f ` B \\<subseteq> f ` A", "using assms(2)"], ["proof (prove)\nusing this:\n  B \\<subseteq> A\n\ngoal (1 subgoal):\n 1. f ` B \\<subseteq> f ` A", "by auto"], ["proof (state)\nthis:\n  f ` B \\<subseteq> f ` A\n\ngoal (1 subgoal):\n 1. subterm_inj_on f B", "ultimately"], ["proof (chain)\npicking this:\n  inj_on f A\n  \\<forall>s\\<in>f ` A.\n     \\<forall>u\\<in>f ` A.\n        (\\<exists>v.\n            v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n        s = u\n  f ` B \\<subseteq> f ` A", "have \"inj_on f B\" \"\\<forall>s\\<in>f ` B. \\<forall>u\\<in>f ` B. (\\<exists>v. v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow> s = u\""], ["proof (prove)\nusing this:\n  inj_on f A\n  \\<forall>s\\<in>f ` A.\n     \\<forall>u\\<in>f ` A.\n        (\\<exists>v.\n            v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n        s = u\n  f ` B \\<subseteq> f ` A\n\ngoal (1 subgoal):\n 1. inj_on f B &&&\n    \\<forall>s\\<in>f ` B.\n       \\<forall>u\\<in>f ` B.\n          (\\<exists>v.\n              v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n          s = u", "using inj_on_subset[of f A] assms(2)"], ["proof (prove)\nusing this:\n  inj_on f A\n  \\<forall>s\\<in>f ` A.\n     \\<forall>u\\<in>f ` A.\n        (\\<exists>v.\n            v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n        s = u\n  f ` B \\<subseteq> f ` A\n  \\<lbrakk>inj_on f A; ?B \\<subseteq> A\\<rbrakk>\n  \\<Longrightarrow> inj_on f ?B\n  B \\<subseteq> A\n\ngoal (1 subgoal):\n 1. inj_on f B &&&\n    \\<forall>s\\<in>f ` B.\n       \\<forall>u\\<in>f ` B.\n          (\\<exists>v.\n              v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n          s = u", "by blast+"], ["proof (state)\nthis:\n  inj_on f B\n  \\<forall>s\\<in>f ` B.\n     \\<forall>u\\<in>f ` B.\n        (\\<exists>v.\n            v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n        s = u\n\ngoal (1 subgoal):\n 1. subterm_inj_on f B", "thus ?thesis"], ["proof (prove)\nusing this:\n  inj_on f B\n  \\<forall>s\\<in>f ` B.\n     \\<forall>u\\<in>f ` B.\n        (\\<exists>v.\n            v \\<sqsubseteq> s \\<and> v \\<sqsubseteq> u) \\<longrightarrow>\n        s = u\n\ngoal (1 subgoal):\n 1. subterm_inj_on f B", "by (metis subterm_inj_on_alt_def)"], ["proof (state)\nthis:\n  subterm_inj_on f B\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma inj_subst_unif_consts:\n  fixes \\<I> \\<theta> \\<sigma>::\"('f,'v) subst\" and s t::\"('f,'v) term\"\n  assumes \\<theta>: \"subterm_inj_on \\<theta> (subst_domain \\<theta>)\" \"\\<forall>x \\<in> (fv s \\<union> fv t) - X. \\<exists>c. \\<theta> x = Fun c []\"\n             \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter> (subterms s \\<union> subterms t) = {}\" \"ground (subst_range \\<theta>)\"\n             \"subst_domain \\<theta> \\<inter> X = {}\"\n  and \\<I>: \"ground (subst_range \\<I>)\" \"subst_domain \\<I> = subst_domain \\<theta>\"\n  and unif: \"Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\"\n  shows \"\\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "let ?xs = \"subst_domain \\<theta>\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "let ?ys = \"(fv s \\<union> fv t) - ?xs\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have \"\\<exists>\\<delta>::('f,'v) subst. s \\<cdot> \\<delta> = t \\<cdot> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> s t", "by (metis subst_subst_compose unif)"], ["proof (state)\nthis:\n  \\<exists>\\<delta>. Unifier \\<delta> s t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "then"], ["proof (chain)\npicking this:\n  \\<exists>\\<delta>. Unifier \\<delta> s t", "obtain \\<delta>::\"('f,'v) subst\" where \\<delta>: \"mgu s t = Some \\<delta>\""], ["proof (prove)\nusing this:\n  \\<exists>\\<delta>. Unifier \\<delta> s t\n\ngoal (1 subgoal):\n 1. (\\<And>\\<delta>.\n        mgu s t = Some \\<delta> \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using mgu_always_unifies"], ["proof (prove)\nusing this:\n  \\<exists>\\<delta>. Unifier \\<delta> s t\n  Unifier ?\\<theta> ?M ?N \\<Longrightarrow>\n  \\<exists>\\<delta>. mgu ?M ?N = Some \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<delta>.\n        mgu s t = Some \\<delta> \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  mgu s t = Some \\<delta>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 1: \"\\<exists>\\<sigma>::('f,'v) subst. s \\<cdot> \\<theta> \\<cdot> \\<sigma> = t \\<cdot> \\<theta> \\<cdot> \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)", "by (metis unif)"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 2: \"\\<And>\\<gamma>::('f,'v) subst. s \\<cdot> \\<theta> \\<cdot> \\<gamma> = t \\<cdot> \\<theta> \\<cdot> \\<gamma> \\<Longrightarrow> \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<gamma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>\\<gamma>.\n       Unifier \\<gamma> (s \\<cdot> \\<theta>)\n        (t \\<cdot> \\<theta>) \\<Longrightarrow>\n       \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<gamma>", "using mgu_gives_MGU[OF \\<delta>]"], ["proof (prove)\nusing this:\n  MGU \\<delta> s t\n\ngoal (1 subgoal):\n 1. \\<And>\\<gamma>.\n       Unifier \\<gamma> (s \\<cdot> \\<theta>)\n        (t \\<cdot> \\<theta>) \\<Longrightarrow>\n       \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<gamma>", "by simp"], ["proof (state)\nthis:\n  Unifier ?\\<gamma> (s \\<cdot> \\<theta>)\n   (t \\<cdot> \\<theta>) \\<Longrightarrow>\n  \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s ?\\<gamma>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 3: \"\\<And>(z::'v) (c::'f). \\<delta> z = Fun c [] \\<Longrightarrow> Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>z c.\n       \\<delta> z = Fun c [] \\<Longrightarrow>\n       Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t", "by (rule mgu_img_consts'[OF \\<delta>])"], ["proof (state)\nthis:\n  \\<delta> ?z = Fun ?c [] \\<Longrightarrow>\n  Fun ?c [] \\<sqsubseteq> s \\<or> Fun ?c [] \\<sqsubseteq> t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 4: \"subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}", "by (metis mgu_gives_wellformed_subst[OF \\<delta>] wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def)"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 5: \"subst_domain \\<delta> \\<union> range_vars \\<delta> \\<subseteq> fv s \\<union> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<union> range_vars \\<delta>\n    \\<subseteq> fv s \\<union> fv t", "by (metis mgu_gives_wellformed_MGU[OF \\<delta>] wf\\<^sub>M\\<^sub>G\\<^sub>U_def)"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "{"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "fix x and \\<gamma>::\"('f,'v) subst\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "assume \"x \\<in> subst_domain \\<theta>\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "hence \"(\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x", "using \\<theta>(4) ident_comp_subst_trm_if_disj[of \\<gamma> \\<theta>]"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  ground (subst_range \\<theta>)\n  \\<lbrakk>subst_domain \\<gamma> \\<inter> range_vars \\<theta> = {};\n   ?v \\<in> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<theta> \\<circ>\\<^sub>s \\<gamma>) ?v = \\<theta> ?v\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  ground (subst_range \\<theta>)\n  \\<lbrakk>subst_domain \\<gamma> \\<inter>\n           fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) =\n           {};\n   ?v \\<in> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<theta> \\<circ>\\<^sub>s \\<gamma>) ?v = \\<theta> ?v\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x", "by fast"], ["proof (state)\nthis:\n  (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "}"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "then"], ["proof (chain)\npicking this:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2", "obtain \\<tau>::\"('f,'v) subst\" where \\<tau>: \"\\<forall>x \\<in> subst_domain \\<theta>. \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\""], ["proof (prove)\nusing this:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2\n\ngoal (1 subgoal):\n 1. (\\<And>\\<tau>.\n        \\<forall>x\\<in>subst_domain \\<theta>.\n           \\<theta> x =\n           (\\<delta> \\<circ>\\<^sub>s \\<tau>) x \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "using 1 2"], ["proof (prove)\nusing this:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\n  Unifier ?\\<gamma> (s \\<cdot> \\<theta>)\n   (t \\<cdot> \\<theta>) \\<Longrightarrow>\n  \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s ?\\<gamma>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<tau>.\n        \\<forall>x\\<in>subst_domain \\<theta>.\n           \\<theta> x =\n           (\\<delta> \\<circ>\\<^sub>s \\<tau>) x \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have *: \"\\<And>x. x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta> \\<Longrightarrow> \\<exists>y \\<in> ?ys. \\<delta> x = Var y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "assume \"x \\<in> subst_domain \\<delta> \\<inter> ?xs\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "hence x: \"x \\<in> subst_domain \\<delta>\" \"x \\<in> subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. x \\<in> subst_domain \\<delta> &&& x \\<in> subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "then"], ["proof (chain)\npicking this:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>", "obtain c where c: \"\\<theta> x = Fun c []\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        \\<theta> x = Fun c [] \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using \\<theta>(2,5) 5"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n  \\<forall>x\\<in>fv s \\<union> fv t - X. \\<exists>c. \\<theta> x = Fun c []\n  subst_domain \\<theta> \\<inter> X = {}\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        \\<theta> x = Fun c [] \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  \\<theta> x = Fun c []\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "hence *: \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\""], ["proof (prove)\nusing this:\n  \\<theta> x = Fun c []\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []", "using \\<tau> x"], ["proof (prove)\nusing this:\n  \\<theta> x = Fun c []\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []", "by fastforce"], ["proof (state)\nthis:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "hence **: \"x \\<in> subst_domain (\\<delta> \\<circ>\\<^sub>s \\<tau>)\" \"Fun c [] \\<in> subst_range (\\<delta> \\<circ>\\<^sub>s \\<tau>)\""], ["proof (prove)\nusing this:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n\ngoal (1 subgoal):\n 1. x \\<in> subst_domain (\\<delta> \\<circ>\\<^sub>s \\<tau>) &&&\n    Fun c [] \\<in> subst_range (\\<delta> \\<circ>\\<^sub>s \\<tau>)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  x \\<in> subst_domain (\\<delta> \\<circ>\\<^sub>s \\<tau>)\n  Fun c [] \\<in> subst_range (\\<delta> \\<circ>\\<^sub>s \\<tau>)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "have \"\\<delta> x = Fun c [] \\<or> (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<delta> x = Fun c [] \\<or>\n    (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])", "by (rule subst_img_comp_subset_const'[OF *])"], ["proof (state)\nthis:\n  \\<delta> x = Fun c [] \\<or>\n  (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "moreover"], ["proof (state)\nthis:\n  \\<delta> x = Fun c [] \\<or>\n  (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "have \"\\<delta> x \\<noteq> Fun c []\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<delta> x \\<noteq> Fun c []", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow> False", "assume \"\\<not>\\<delta> x \\<noteq> Fun c []\""], ["proof (state)\nthis:\n  \\<not> \\<delta> x \\<noteq> Fun c []\n\ngoal (1 subgoal):\n 1. \\<not> \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow> False", "hence \"Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\""], ["proof (prove)\nusing this:\n  \\<not> \\<delta> x \\<noteq> Fun c []\n\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t", "using 3"], ["proof (prove)\nusing this:\n  \\<not> \\<delta> x \\<noteq> Fun c []\n  \\<delta> ?z = Fun ?c [] \\<Longrightarrow>\n  Fun ?c [] \\<sqsubseteq> s \\<or> Fun ?c [] \\<sqsubseteq> t\n\ngoal (1 subgoal):\n 1. Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t", "by metis"], ["proof (state)\nthis:\n  Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\n\ngoal (1 subgoal):\n 1. \\<not> \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\n\ngoal (1 subgoal):\n 1. \\<not> \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow> False", "have \"\\<forall>u \\<in> subst_range \\<theta>. u \\<notin> subterms s \\<union> subterms t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>u\\<in>subst_range \\<theta>.\n       u \\<notin> subterms s \\<union> subterms t", "using \\<theta>(3)"], ["proof (prove)\nusing this:\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter>\n  (subterms s \\<union> subterms t) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<forall>u\\<in>subst_range \\<theta>.\n       u \\<notin> subterms s \\<union> subterms t", "by force"], ["proof (state)\nthis:\n  \\<forall>u\\<in>subst_range \\<theta>.\n     u \\<notin> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. \\<not> \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow> False", "hence \"Fun c [] \\<notin> subterms s \\<union> subterms t\""], ["proof (prove)\nusing this:\n  \\<forall>u\\<in>subst_range \\<theta>.\n     u \\<notin> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. Fun c [] \\<notin> subterms s \\<union> subterms t", "by (metis c \\<open>ground (subst_range \\<theta>)\\<close>x(2) ground_subst_dom_iff_img)"], ["proof (state)\nthis:\n  Fun c [] \\<notin> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. \\<not> \\<delta> x \\<noteq> Fun c [] \\<Longrightarrow> False", "ultimately"], ["proof (chain)\npicking this:\n  Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\n  Fun c [] \\<notin> subterms s \\<union> subterms t", "show False"], ["proof (prove)\nusing this:\n  Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\n  Fun c [] \\<notin> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. False", "by auto"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<delta> x \\<noteq> Fun c []\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "moreover"], ["proof (state)\nthis:\n  \\<delta> x \\<noteq> Fun c []\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "have \"\\<forall>x' \\<in> subst_domain \\<theta>. \\<delta> x \\<noteq> Var x'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>x'\\<in>subst_domain \\<theta>. \\<delta> x \\<noteq> Var x'", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "assume \"\\<not>(\\<forall>x' \\<in> subst_domain \\<theta>. \\<delta> x \\<noteq> Var x')\""], ["proof (state)\nthis:\n  \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>. \\<delta> x \\<noteq> Var x')\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "then"], ["proof (chain)\npicking this:\n  \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>. \\<delta> x \\<noteq> Var x')", "obtain x' where x': \"x' \\<in> subst_domain \\<theta>\" \"\\<delta> x = Var x'\""], ["proof (prove)\nusing this:\n  \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>. \\<delta> x \\<noteq> Var x')\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>x' \\<in> subst_domain \\<theta>;\n         \\<delta> x = Var x'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  x' \\<in> subst_domain \\<theta>\n  \\<delta> x = Var x'\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "hence \"\\<tau> x' = Fun c []\" \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\""], ["proof (prove)\nusing this:\n  x' \\<in> subst_domain \\<theta>\n  \\<delta> x = Var x'\n\ngoal (1 subgoal):\n 1. \\<tau> x' = Fun c [] &&& (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []", "using *"], ["proof (prove)\nusing this:\n  x' \\<in> subst_domain \\<theta>\n  \\<delta> x = Var x'\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n\ngoal (1 subgoal):\n 1. \\<tau> x' = Fun c [] &&& (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  x' \\<in> subst_domain \\<theta>\n  \\<delta> x = Var x'\n  \\<delta> x \\<cdot> \\<tau> = Fun c []\n\ngoal (1 subgoal):\n 1. \\<tau> x' = Fun c [] &&& \\<delta> x \\<cdot> \\<tau> = Fun c []", "by auto"], ["proof (state)\nthis:\n  \\<tau> x' = Fun c []\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "moreover"], ["proof (state)\nthis:\n  \\<tau> x' = Fun c []\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "have \"x \\<noteq> x'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<noteq> x'", "using x(1) x'(2) 4"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n  \\<delta> x = Var x'\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\n\ngoal (1 subgoal):\n 1. x \\<noteq> x'", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  x \\<noteq> x'\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "moreover"], ["proof (state)\nthis:\n  x \\<noteq> x'\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "have \"x' \\<notin> subst_domain \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x' \\<notin> subst_domain \\<delta>", "using x'(2) mgu_eliminates_dom[OF \\<delta>]"], ["proof (prove)\nusing this:\n  \\<delta> x = Var x'\n  ?v \\<in> subst_domain \\<delta> \\<Longrightarrow> subst_elim \\<delta> ?v\n\ngoal (1 subgoal):\n 1. x' \\<notin> subst_domain \\<delta>", "by (metis (no_types) subst_elim_def subst_apply_term.simps(1) vars_iff_subterm_or_eq)"], ["proof (state)\nthis:\n  x' \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "moreover"], ["proof (state)\nthis:\n  x' \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "have \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x = \\<theta> x\" \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x' = \\<theta> x'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = \\<theta> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' = \\<theta> x'", "using \\<tau> x(2) x'(1)"], ["proof (prove)\nusing this:\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  x \\<in> subst_domain \\<theta>\n  x' \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = \\<theta> x &&&\n    (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' = \\<theta> x'", "by auto"], ["proof (state)\nthis:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = \\<theta> x\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' = \\<theta> x'\n\ngoal (1 subgoal):\n 1. \\<not> (\\<forall>x'\\<in>subst_domain \\<theta>.\n               \\<delta> x \\<noteq> Var x') \\<Longrightarrow>\n    False", "ultimately"], ["proof (chain)\npicking this:\n  \\<tau> x' = Fun c []\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n  x \\<noteq> x'\n  x' \\<notin> subst_domain \\<delta>\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = \\<theta> x\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' = \\<theta> x'", "show False"], ["proof (prove)\nusing this:\n  \\<tau> x' = Fun c []\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n  x \\<noteq> x'\n  x' \\<notin> subst_domain \\<delta>\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = \\<theta> x\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' = \\<theta> x'\n\ngoal (1 subgoal):\n 1. False", "using subterm_inj_on_imp_inj_on[OF \\<theta>(1)] *"], ["proof (prove)\nusing this:\n  \\<tau> x' = Fun c []\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n  x \\<noteq> x'\n  x' \\<notin> subst_domain \\<delta>\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = \\<theta> x\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' = \\<theta> x'\n  inj_on \\<theta> (subst_domain \\<theta>)\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = Fun c []\n\ngoal (1 subgoal):\n 1. False", "by (simp add: inj_on_def subst_compose_def x'(2) subst_domain_def)"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>x'\\<in>subst_domain \\<theta>. \\<delta> x \\<noteq> Var x'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "ultimately"], ["proof (chain)\npicking this:\n  \\<delta> x = Fun c [] \\<or>\n  (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n  \\<delta> x \\<noteq> Fun c []\n  \\<forall>x'\\<in>subst_domain \\<theta>. \\<delta> x \\<noteq> Var x'", "show \"\\<exists>y \\<in> ?ys. \\<delta> x = Var y\""], ["proof (prove)\nusing this:\n  \\<delta> x = Fun c [] \\<or>\n  (\\<exists>z. \\<delta> x = Var z \\<and> \\<tau> z = Fun c [])\n  \\<delta> x \\<noteq> Fun c []\n  \\<forall>x'\\<in>subst_domain \\<theta>. \\<delta> x \\<noteq> Var x'\n\ngoal (1 subgoal):\n 1. \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n       \\<delta> x = Var y", "by (metis 5 x(2) subtermeqI' vars_iff_subtermeq DiffI Un_iff subst_fv_imgI sup.orderE)"], ["proof (state)\nthis:\n  \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n     \\<delta> x = Var y\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  ?x \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n     \\<delta> ?x = Var y\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have **: \"inj_on \\<delta> (subst_domain \\<delta> \\<inter> ?xs)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inj_on \\<delta> (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)", "proof (intro inj_onI)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "fix x y"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "assume *:\n      \"x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\" \"y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\" \"\\<delta> x = \\<delta> y\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "hence \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x =\n    (\\<delta> \\<circ>\\<^sub>s \\<tau>) y", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. Unifier \\<tau> (\\<delta> x) (\\<delta> y)", "by auto"], ["proof (state)\nthis:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "hence \"\\<theta> x = \\<theta> y\""], ["proof (prove)\nusing this:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\n\ngoal (1 subgoal):\n 1. \\<theta> x = \\<theta> y", "using \\<tau> *"], ["proof (prove)\nusing this:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. \\<theta> x = \\<theta> y", "by auto"], ["proof (state)\nthis:\n  \\<theta> x = \\<theta> y\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "thus \"x = y\""], ["proof (prove)\nusing this:\n  \\<theta> x = \\<theta> y\n\ngoal (1 subgoal):\n 1. x = y", "using inj_onD[OF subterm_inj_on_imp_inj_on[OF \\<theta>(1)]] *(1,2)"], ["proof (prove)\nusing this:\n  \\<theta> x = \\<theta> y\n  \\<lbrakk>\\<theta> ?x = \\<theta> ?y; ?x \\<in> subst_domain \\<theta>;\n   ?y \\<in> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> ?x = ?y\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. x = y", "by simp"], ["proof (state)\nthis:\n  x = y\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  inj_on \\<delta> (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "define \\<alpha> where \"\\<alpha> = (\\<lambda>y'. if Var y' \\<in> \\<delta> ` (subst_domain \\<delta> \\<inter> ?xs)\n                            then Var ((inv_into (subst_domain \\<delta> \\<inter> ?xs) \\<delta>) (Var y'))\n                            else Var y'::('f,'v) term)\""], ["proof (state)\nthis:\n  \\<alpha> =\n  (\\<lambda>y'.\n      if Var y'\n         \\<in> \\<delta> `\n               (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n      then Var (inv_into\n                 (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n                 \\<delta> (Var y'))\n      else Var y')\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have a1: \"Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t", "using mgu_gives_MGU[OF \\<delta>]"], ["proof (prove)\nusing this:\n  MGU \\<delta> s t\n\ngoal (1 subgoal):\n 1. Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t", "by auto"], ["proof (state)\nthis:\n  Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "define \\<delta>' where \"\\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\""], ["proof (state)\nthis:\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have d1: \"subst_domain \\<delta>' \\<subseteq> ?ys\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta>'\n    \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "fix z"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "assume z: \"z \\<in> subst_domain \\<delta>'\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "have \"z \\<in> ?xs \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    z \\<notin> subst_domain \\<delta>'", "proof (cases \"z \\<in> subst_domain \\<delta>\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "case True"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "moreover"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "assume \"z \\<in> ?xs\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "ultimately"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<delta>\n  z \\<in> subst_domain \\<theta>", "have z_in: \"z \\<in> subst_domain \\<delta> \\<inter> ?xs\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<delta>\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>", "by simp"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "then"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>", "obtain y where y: \"\\<delta> z = Var y\" \"y \\<in> ?ys\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>y.\n        \\<lbrakk>\\<delta> z = Var y;\n         y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using *"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  ?x \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n     \\<delta> ?x = Var y\n\ngoal (1 subgoal):\n 1. (\\<And>y.\n        \\<lbrakk>\\<delta> z = Var y;\n         y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  \\<delta> z = Var y\n  y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<alpha> y = Var ((inv_into (subst_domain \\<delta> \\<inter> ?xs) \\<delta>) (Var y))\""], ["proof (prove)\nusing this:\n  \\<delta> z = Var y\n  y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<alpha> y =\n    Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n          \\<delta> (Var y))", "using \\<alpha>_def z_in"], ["proof (prove)\nusing this:\n  \\<delta> z = Var y\n  y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n  \\<alpha> =\n  (\\<lambda>y'.\n      if Var y'\n         \\<in> \\<delta> `\n               (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n      then Var (inv_into\n                 (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n                 \\<delta> (Var y'))\n      else Var y')\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<alpha> y =\n    Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n          \\<delta> (Var y))", "by simp"], ["proof (state)\nthis:\n  \\<alpha> y =\n  Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n        \\<delta> (Var y))\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<alpha> y = Var z\""], ["proof (prove)\nusing this:\n  \\<alpha> y =\n  Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n        \\<delta> (Var y))\n\ngoal (1 subgoal):\n 1. \\<alpha> y = Var z", "by (metis y(1) z_in ** inv_into_f_eq)"], ["proof (state)\nthis:\n  \\<alpha> y = Var z\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<delta>' z = Var z\""], ["proof (prove)\nusing this:\n  \\<alpha> y = Var z\n\ngoal (1 subgoal):\n 1. \\<delta>' z = Var z", "using \\<delta>'_def y(1) subst_compose_def[of \\<delta> \\<alpha>]"], ["proof (prove)\nusing this:\n  \\<alpha> y = Var z\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n  \\<delta> z = Var y\n  \\<delta> \\<circ>\\<^sub>s \\<alpha> =\n  (\\<lambda>x. \\<delta> x \\<cdot> \\<alpha>)\n\ngoal (1 subgoal):\n 1. \\<delta>' z = Var z", "by simp"], ["proof (state)\nthis:\n  \\<delta>' z = Var z\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "case False"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<delta> z = Var z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<delta> z = Var z", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<delta> z = Var z\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "moreover"], ["proof (state)\nthis:\n  \\<delta> z = Var z\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "assume \"z \\<in> ?xs\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<alpha> z = Var z\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<alpha> z = Var z", "using \\<alpha>_def *"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n  \\<alpha> =\n  (\\<lambda>y'.\n      if Var y'\n         \\<in> \\<delta> `\n               (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n      then Var (inv_into\n                 (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n                 \\<delta> (Var y'))\n      else Var y')\n  ?x \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n     \\<delta> ?x = Var y\n\ngoal (1 subgoal):\n 1. \\<alpha> z = Var z", "by force"], ["proof (state)\nthis:\n  \\<alpha> z = Var z\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "ultimately"], ["proof (chain)\npicking this:\n  \\<delta> z = Var z\n  \\<alpha> z = Var z", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<delta> z = Var z\n  \\<alpha> z = Var z\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "using \\<delta>'_def subst_compose_def[of \\<delta> \\<alpha>]"], ["proof (prove)\nusing this:\n  \\<delta> z = Var z\n  \\<alpha> z = Var z\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n  \\<delta> \\<circ>\\<^sub>s \\<alpha> =\n  (\\<lambda>x. \\<delta> x \\<cdot> \\<alpha>)\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "moreover"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "have \"subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>", "unfolding \\<delta>'_def \\<alpha>_def range_vars_alt_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain\n     (\\<lambda>y'.\n         if Var y'\n            \\<in> \\<delta> `\n                  (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n         then Var (inv_into\n                    (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n                    \\<delta> (Var y'))\n         else Var y')\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)", "by (auto simp add: subst_domain_def)"], ["proof (state)\nthis:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "hence \"subst_domain \\<delta>' \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\""], ["proof (prove)\nusing this:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta>'\n    \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "using subst_domain_compose[of \\<delta> \\<alpha>]"], ["proof (prove)\nusing this:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n  subst_domain (\\<delta> \\<circ>\\<^sub>s \\<alpha>)\n  \\<subseteq> subst_domain \\<delta> \\<union> subst_domain \\<alpha>\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta>'\n    \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "unfolding \\<delta>'_def"], ["proof (prove)\nusing this:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n  subst_domain (\\<delta> \\<circ>\\<^sub>s \\<alpha>)\n  \\<subseteq> subst_domain \\<delta> \\<union> subst_domain \\<alpha>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<delta> \\<circ>\\<^sub>s \\<alpha>)\n    \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "show \"z \\<in> ?ys\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. z \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "using 5 z"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n  z \\<in> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. z \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  subst_domain \\<delta>'\n  \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have d2: \"Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t", "using a1 \\<delta>'_def"], ["proof (prove)\nusing this:\n  Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n\ngoal (1 subgoal):\n 1. Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t", "by auto"], ["proof (state)\nthis:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have d3: \"\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> = \\<delta>' \\<circ>\\<^sub>s \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "fix z::'v"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "assume z: \"z \\<in> ?xs\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "then"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<theta>", "obtain u where u: \"\\<I> z = u\" \"fv u = {}\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>\\<I> z = u; fv u = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using \\<I>"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n  ground (subst_range \\<I>)\n  subst_domain \\<I> = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>\\<I> z = u; fv u = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  \\<I> z = u\n  fv u = {}\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\""], ["proof (prove)\nusing this:\n  \\<I> z = u\n  fv u = {}\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "by (simp add: subst_compose subst_ground_ident)"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "moreover"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "have \"z \\<notin> subst_domain \\<delta>'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "using d1 z"], ["proof (prove)\nusing this:\n  subst_domain \\<delta>'\n  \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "by auto"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"\\<delta>' z = Var z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<delta>' z = Var z", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\""], ["proof (prove)\nusing this:\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "using u(1)"], ["proof (prove)\nusing this:\n  \\<delta>' z = Var z\n  \\<I> z = u\n\ngoal (1 subgoal):\n 1. (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "by (simp add: subst_compose)"], ["proof (state)\nthis:\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "ultimately"], ["proof (chain)\npicking this:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "have \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\""], ["proof (prove)\nusing this:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n    (\\<delta>' \\<circ>\\<^sub>s \\<I>) z", "by metis"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "}"], ["proof (state)\nthis:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "moreover"], ["proof (state)\nthis:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "{"], ["proof (state)\nthis:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "fix z::'v"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "assume \"z \\<in> ?ys\""], ["proof (state)\nthis:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"z \\<notin> subst_domain \\<I>\""], ["proof (prove)\nusing this:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<I>", "using \\<I>(2)"], ["proof (prove)\nusing this:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n  subst_domain \\<I> = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<I>", "by auto"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n    (\\<delta>' \\<circ>\\<^sub>s \\<I>) z", "by (simp add: subst_compose subst_domain_def)"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "}"], ["proof (state)\nthis:\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "moreover"], ["proof (state)\nthis:\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "{"], ["proof (state)\nthis:\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "fix z::'v"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "assume \"z \\<notin> ?xs\" \"z \\<notin> ?ys\""], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<theta>\n  z \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"\\<I> z = Var z\" \"\\<delta>' z = Var z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<theta>\n  z \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> z = Var z &&& \\<delta>' z = Var z", "using \\<I>(2) d1"], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<theta>\n  z \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n  subst_domain \\<I> = subst_domain \\<theta>\n  subst_domain \\<delta>'\n  \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> z = Var z &&& \\<delta>' z = Var z", "by blast+"], ["proof (state)\nthis:\n  \\<I> z = Var z\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\""], ["proof (prove)\nusing this:\n  \\<I> z = Var z\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n    (\\<delta>' \\<circ>\\<^sub>s \\<I>) z", "by (simp add: subst_compose)"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "}"], ["proof (state)\nthis:\n  \\<lbrakk>?z2 \\<notin> subst_domain \\<theta>;\n   ?z2 \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>)\n                     ?z2 =\n                    (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "ultimately"], ["proof (chain)\npicking this:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  \\<lbrakk>?z2 \\<notin> subst_domain \\<theta>;\n   ?z2 \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>)\n                     ?z2 =\n                    (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2", "show ?thesis"], ["proof (prove)\nusing this:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  \\<lbrakk>?z2 \\<notin> subst_domain \\<theta>;\n   ?z2 \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>)\n                     ?z2 =\n                    (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "by auto"], ["proof (state)\nthis:\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "from d2 d3"], ["proof (chain)\npicking this:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>", "have \"Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\""], ["proof (prove)\nusing this:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>\n\ngoal (1 subgoal):\n 1. Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>)\n     (t \\<cdot> \\<I>)", "by (metis subst_subst_compose)"], ["proof (state)\nthis:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "by metis"], ["proof (state)\nthis:\n  \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma inj_subst_unif_comp_terms:\n  fixes \\<I> \\<theta> \\<sigma>::\"('f,'v) subst\" and s t::\"('f,'v) term\"\n  assumes \\<theta>: \"subterm_inj_on \\<theta> (subst_domain \\<theta>)\" \"ground (subst_range \\<theta>)\"\n             \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter> (subterms s \\<union> subterms t) = {}\"\n             \"(fv s \\<union> fv t) - subst_domain \\<theta> \\<subseteq> X\"\n  and tfr: \"\\<forall>f U. Fun f U \\<in> subterms s \\<union> subterms t \\<longrightarrow> U = [] \\<or> (\\<exists>u \\<in> set U. u \\<notin> Var ` X)\"\n  and \\<I>: \"ground (subst_range \\<I>)\" \"subst_domain \\<I> = subst_domain \\<theta>\"\n  and unif: \"Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\"\n  shows \"\\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "let ?xs = \"subst_domain \\<theta>\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "let ?ys = \"(fv s \\<union> fv t) - ?xs\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have \"ground (subst_range \\<theta>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>)", "using \\<theta>(2)"], ["proof (prove)\nusing this:\n  ground (subst_range \\<theta>)\n\ngoal (1 subgoal):\n 1. ground (subst_range \\<theta>)", "by auto"], ["proof (state)\nthis:\n  ground (subst_range \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have \"\\<exists>\\<delta>::('f,'v) subst. s \\<cdot> \\<delta> = t \\<cdot> \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> s t", "by (metis subst_subst_compose unif)"], ["proof (state)\nthis:\n  \\<exists>\\<delta>. Unifier \\<delta> s t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "then"], ["proof (chain)\npicking this:\n  \\<exists>\\<delta>. Unifier \\<delta> s t", "obtain \\<delta>::\"('f,'v) subst\" where \\<delta>: \"mgu s t = Some \\<delta>\""], ["proof (prove)\nusing this:\n  \\<exists>\\<delta>. Unifier \\<delta> s t\n\ngoal (1 subgoal):\n 1. (\\<And>\\<delta>.\n        mgu s t = Some \\<delta> \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using mgu_always_unifies"], ["proof (prove)\nusing this:\n  \\<exists>\\<delta>. Unifier \\<delta> s t\n  Unifier ?\\<theta> ?M ?N \\<Longrightarrow>\n  \\<exists>\\<delta>. mgu ?M ?N = Some \\<delta>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<delta>.\n        mgu s t = Some \\<delta> \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  mgu s t = Some \\<delta>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 1: \"\\<exists>\\<sigma>::('f,'v) subst. s \\<cdot> \\<theta> \\<cdot> \\<sigma> = t \\<cdot> \\<theta> \\<cdot> \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)", "by (metis unif)"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 2: \"\\<And>\\<gamma>::('f,'v) subst. s \\<cdot> \\<theta> \\<cdot> \\<gamma> = t \\<cdot> \\<theta> \\<cdot> \\<gamma> \\<Longrightarrow> \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<gamma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>\\<gamma>.\n       Unifier \\<gamma> (s \\<cdot> \\<theta>)\n        (t \\<cdot> \\<theta>) \\<Longrightarrow>\n       \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<gamma>", "using mgu_gives_MGU[OF \\<delta>]"], ["proof (prove)\nusing this:\n  MGU \\<delta> s t\n\ngoal (1 subgoal):\n 1. \\<And>\\<gamma>.\n       Unifier \\<gamma> (s \\<cdot> \\<theta>)\n        (t \\<cdot> \\<theta>) \\<Longrightarrow>\n       \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s \\<gamma>", "by simp"], ["proof (state)\nthis:\n  Unifier ?\\<gamma> (s \\<cdot> \\<theta>)\n   (t \\<cdot> \\<theta>) \\<Longrightarrow>\n  \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s ?\\<gamma>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 3: \"\\<And>(z::'v) (c::'f).  Fun c [] \\<sqsubseteq> \\<delta> z \\<Longrightarrow> Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>z c.\n       Fun c [] \\<sqsubseteq> \\<delta> z \\<Longrightarrow>\n       Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t", "using mgu_img_consts[OF \\<delta>]"], ["proof (prove)\nusing this:\n  Fun ?c [] \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<delta> \\<Longrightarrow>\n  Fun ?c [] \\<in> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. \\<And>z c.\n       Fun c [] \\<sqsubseteq> \\<delta> z \\<Longrightarrow>\n       Fun c [] \\<sqsubseteq> s \\<or> Fun c [] \\<sqsubseteq> t", "by force"], ["proof (state)\nthis:\n  Fun ?c [] \\<sqsubseteq> \\<delta> ?z \\<Longrightarrow>\n  Fun ?c [] \\<sqsubseteq> s \\<or> Fun ?c [] \\<sqsubseteq> t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 4: \"subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}", "using mgu_gives_wellformed_subst[OF \\<delta>]"], ["proof (prove)\nusing this:\n  wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<delta>\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}", "by (metis wf\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t_def)"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have 5: \"subst_domain \\<delta> \\<union> range_vars \\<delta> \\<subseteq> fv s \\<union> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<union> range_vars \\<delta>\n    \\<subseteq> fv s \\<union> fv t", "using mgu_gives_wellformed_MGU[OF \\<delta>]"], ["proof (prove)\nusing this:\n  wf\\<^sub>M\\<^sub>G\\<^sub>U \\<delta> s t\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<union> range_vars \\<delta>\n    \\<subseteq> fv s \\<union> fv t", "by (metis wf\\<^sub>M\\<^sub>G\\<^sub>U_def)"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "{"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "fix x and \\<gamma>::\"('f,'v) subst\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "assume \"x \\<in> subst_domain \\<theta>\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "hence \"(\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x", "using \\<open>ground (subst_range \\<theta>)\\<close> ident_comp_subst_trm_if_disj[of \\<gamma> \\<theta> x]"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  ground (subst_range \\<theta>)\n  \\<lbrakk>subst_domain \\<gamma> \\<inter> range_vars \\<theta> = {};\n   x \\<in> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  ground (subst_range \\<theta>)\n  \\<lbrakk>subst_domain \\<gamma> \\<inter>\n           fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) =\n           {};\n   x \\<in> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x\n\ngoal (1 subgoal):\n 1. (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x", "by blast"], ["proof (state)\nthis:\n  (\\<theta> \\<circ>\\<^sub>s \\<gamma>) x = \\<theta> x\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "}"], ["proof (state)\nthis:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "then"], ["proof (chain)\npicking this:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2", "obtain \\<tau>::\"('f,'v) subst\" where \\<tau>: \"\\<forall>x \\<in> subst_domain \\<theta>. \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\""], ["proof (prove)\nusing this:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2\n\ngoal (1 subgoal):\n 1. (\\<And>\\<tau>.\n        \\<forall>x\\<in>subst_domain \\<theta>.\n           \\<theta> x =\n           (\\<delta> \\<circ>\\<^sub>s \\<tau>) x \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "using 1 2"], ["proof (prove)\nusing this:\n  ?x2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<theta> \\<circ>\\<^sub>s ?\\<gamma>2) ?x2 = \\<theta> ?x2\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\n  Unifier ?\\<gamma> (s \\<cdot> \\<theta>)\n   (t \\<cdot> \\<theta>) \\<Longrightarrow>\n  \\<delta> \\<preceq>\\<^sub>\\<circ> \\<theta> \\<circ>\\<^sub>s ?\\<gamma>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<tau>.\n        \\<forall>x\\<in>subst_domain \\<theta>.\n           \\<theta> x =\n           (\\<delta> \\<circ>\\<^sub>s \\<tau>) x \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have ***: \"\\<And>x. x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta> \\<Longrightarrow> fv (\\<delta> x) \\<subseteq> ?ys\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       fv (\\<delta> x)\n       \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       fv (\\<delta> x)\n       \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       fv (\\<delta> x)\n       \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "assume \"x \\<in> subst_domain \\<delta> \\<inter> ?xs\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       fv (\\<delta> x)\n       \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "hence x: \"x \\<in> subst_domain \\<delta>\" \"x \\<in> subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. x \\<in> subst_domain \\<delta> &&& x \\<in> subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       fv (\\<delta> x)\n       \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "moreover"], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       fv (\\<delta> x)\n       \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "have \"\\<not>(\\<exists>x' \\<in> ?xs. x' \\<in> fv (\\<delta> x))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>. x' \\<in> fv (\\<delta> x))", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                      x' \\<in> fv (\\<delta> x)) \\<Longrightarrow>\n    False", "assume \"\\<not>\\<not>(\\<exists>x' \\<in> ?xs. x' \\<in> fv (\\<delta> x))\""], ["proof (state)\nthis:\n  \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                    x' \\<in> fv (\\<delta> x))\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                      x' \\<in> fv (\\<delta> x)) \\<Longrightarrow>\n    False", "then"], ["proof (chain)\npicking this:\n  \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                    x' \\<in> fv (\\<delta> x))", "obtain x' where x': \"x' \\<in> fv (\\<delta> x)\" \"x' \\<in> ?xs\""], ["proof (prove)\nusing this:\n  \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                    x' \\<in> fv (\\<delta> x))\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>x' \\<in> fv (\\<delta> x);\n         x' \\<in> subst_domain \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by metis"], ["proof (state)\nthis:\n  x' \\<in> fv (\\<delta> x)\n  x' \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                      x' \\<in> fv (\\<delta> x)) \\<Longrightarrow>\n    False", "have \"x \\<noteq> x'\" \"x' \\<notin> subst_domain \\<delta>\" \"\\<delta> x' = Var x'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<noteq> x' &&&\n    x' \\<notin> subst_domain \\<delta> &&& \\<delta> x' = Var x'", "using 4 x(1) x'(1)"], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<inter> range_vars \\<delta> = {}\n  x \\<in> subst_domain \\<delta>\n  x' \\<in> fv (\\<delta> x)\n\ngoal (1 subgoal):\n 1. x \\<noteq> x' &&&\n    x' \\<notin> subst_domain \\<delta> &&& \\<delta> x' = Var x'", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  subst_domain \\<delta> \\<inter>\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>) =\n  {}\n  x \\<in> subst_domain \\<delta>\n  x' \\<in> fv (\\<delta> x)\n\ngoal (1 subgoal):\n 1. x \\<noteq> x' &&&\n    x' \\<notin> subst_domain \\<delta> &&& \\<delta> x' = Var x'", "by auto"], ["proof (state)\nthis:\n  x \\<noteq> x'\n  x' \\<notin> subst_domain \\<delta>\n  \\<delta> x' = Var x'\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                      x' \\<in> fv (\\<delta> x)) \\<Longrightarrow>\n    False", "hence \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x' \\<sqsubseteq> (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\" \"\\<tau> x' = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x'\""], ["proof (prove)\nusing this:\n  x \\<noteq> x'\n  x' \\<notin> subst_domain \\<delta>\n  \\<delta> x' = Var x'\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' \\<sqsubseteq>\n    (\\<delta> \\<circ>\\<^sub>s \\<tau>) x &&&\n    \\<tau> x' = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x'", "using \\<tau> x(2) x'(2)"], ["proof (prove)\nusing this:\n  x \\<noteq> x'\n  x' \\<notin> subst_domain \\<delta>\n  \\<delta> x' = Var x'\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  x \\<in> subst_domain \\<theta>\n  x' \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' \\<sqsubseteq>\n    (\\<delta> \\<circ>\\<^sub>s \\<tau>) x &&&\n    \\<tau> x' = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x'", "by (metis subst_compose subst_mono vars_iff_subtermeq x'(1),\n            metis subst_apply_term.simps(1) subst_compose_def)"], ["proof (state)\nthis:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' \\<sqsubseteq>\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  \\<tau> x' = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x'\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                      x' \\<in> fv (\\<delta> x)) \\<Longrightarrow>\n    False", "hence \"\\<theta> x' \\<sqsubseteq> \\<theta> x\""], ["proof (prove)\nusing this:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' \\<sqsubseteq>\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  \\<tau> x' = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x'\n\ngoal (1 subgoal):\n 1. \\<theta> x' \\<sqsubseteq> \\<theta> x", "using \\<tau> x(2) x'(2)"], ["proof (prove)\nusing this:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x' \\<sqsubseteq>\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  \\<tau> x' = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x'\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  x \\<in> subst_domain \\<theta>\n  x' \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> x' \\<sqsubseteq> \\<theta> x", "by auto"], ["proof (state)\nthis:\n  \\<theta> x' \\<sqsubseteq> \\<theta> x\n\ngoal (1 subgoal):\n 1. \\<not> \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>.\n                      x' \\<in> fv (\\<delta> x)) \\<Longrightarrow>\n    False", "thus False"], ["proof (prove)\nusing this:\n  \\<theta> x' \\<sqsubseteq> \\<theta> x\n\ngoal (1 subgoal):\n 1. False", "using \\<theta>(1) x'(2) x(2) \\<open>x \\<noteq> x'\\<close>"], ["proof (prove)\nusing this:\n  \\<theta> x' \\<sqsubseteq> \\<theta> x\n  subterm_inj_on \\<theta> (subst_domain \\<theta>)\n  x' \\<in> subst_domain \\<theta>\n  x \\<in> subst_domain \\<theta>\n  x \\<noteq> x'\n\ngoal (1 subgoal):\n 1. False", "unfolding subterm_inj_on_def"], ["proof (prove)\nusing this:\n  \\<theta> x' \\<sqsubseteq> \\<theta> x\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<forall>y\\<in>subst_domain \\<theta>.\n        (\\<exists>v.\n            v \\<sqsubseteq> \\<theta> x \\<and>\n            v \\<sqsubseteq> \\<theta> y) \\<longrightarrow>\n        x = y\n  x' \\<in> subst_domain \\<theta>\n  x \\<in> subst_domain \\<theta>\n  x \\<noteq> x'\n\ngoal (1 subgoal):\n 1. False", "by (meson subtermeqI')"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>. x' \\<in> fv (\\<delta> x))\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       fv (\\<delta> x)\n       \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n  \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>. x' \\<in> fv (\\<delta> x))", "show \"fv (\\<delta> x) \\<subseteq> ?ys\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n  \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>. x' \\<in> fv (\\<delta> x))\n\ngoal (1 subgoal):\n 1. fv (\\<delta> x) \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "using 5 subst_dom_vars_in_subst[of x \\<delta>] subst_fv_imgI[of \\<delta> x]"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta>\n  x \\<in> subst_domain \\<theta>\n  \\<not> (\\<exists>x'\\<in>subst_domain \\<theta>. x' \\<in> fv (\\<delta> x))\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n  x \\<in> subst_domain \\<delta> \\<Longrightarrow> \\<delta> x \\<noteq> Var x\n  \\<delta> x \\<noteq> Var x \\<Longrightarrow>\n  fv (\\<delta> x) \\<subseteq> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. fv (\\<delta> x) \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "by blast"], ["proof (state)\nthis:\n  fv (\\<delta> x) \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  ?x \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  fv (\\<delta> ?x) \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have **: \"inj_on \\<delta> (subst_domain \\<delta> \\<inter> ?xs)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inj_on \\<delta> (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)", "proof (intro inj_onI)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "fix x y"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "assume *:\n      \"x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\" \"y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\" \"\\<delta> x = \\<delta> y\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "hence \"(\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. (\\<delta> \\<circ>\\<^sub>s \\<tau>) x =\n    (\\<delta> \\<circ>\\<^sub>s \\<tau>) y", "unfolding subst_compose_def"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. Unifier \\<tau> (\\<delta> x) (\\<delta> y)", "by auto"], ["proof (state)\nthis:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "hence \"\\<theta> x = \\<theta> y\""], ["proof (prove)\nusing this:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\n\ngoal (1 subgoal):\n 1. \\<theta> x = \\<theta> y", "using \\<tau> *"], ["proof (prove)\nusing this:\n  (\\<delta> \\<circ>\\<^sub>s \\<tau>) x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) y\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<delta> x = \\<delta> y\n\ngoal (1 subgoal):\n 1. \\<theta> x = \\<theta> y", "by auto"], ["proof (state)\nthis:\n  \\<theta> x = \\<theta> y\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>;\n        \\<delta> x = \\<delta> y\\<rbrakk>\n       \\<Longrightarrow> x = y", "thus \"x = y\""], ["proof (prove)\nusing this:\n  \\<theta> x = \\<theta> y\n\ngoal (1 subgoal):\n 1. x = y", "using inj_onD[OF subterm_inj_on_imp_inj_on[OF \\<theta>(1)]] *(1,2)"], ["proof (prove)\nusing this:\n  \\<theta> x = \\<theta> y\n  \\<lbrakk>\\<theta> ?x = \\<theta> ?y; ?x \\<in> subst_domain \\<theta>;\n   ?y \\<in> subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> ?x = ?y\n  x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  y \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. x = y", "by simp"], ["proof (state)\nthis:\n  x = y\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  inj_on \\<delta> (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have *: \"\\<And>x. x \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta> \\<Longrightarrow> \\<exists>y \\<in> ?ys. \\<delta> x = Var y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta> \\<inter>\n               subst_domain \\<theta> \\<Longrightarrow>\n       \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n          \\<delta> x = Var y", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "fix xi"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "assume xi_assms: \"xi \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\" \"\\<not>(\\<exists>y \\<in> ?ys. \\<delta> xi = Var y)\""], ["proof (state)\nthis:\n  xi \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n             \\<delta> xi = Var y)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "hence xi_\\<theta>: \"xi \\<in> subst_domain \\<theta>\" and \\<delta>_xi_comp: \"\\<not>(\\<exists>y. \\<delta> xi = Var y)\""], ["proof (prove)\nusing this:\n  xi \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n             \\<delta> xi = Var y)\n\ngoal (1 subgoal):\n 1. xi \\<in> subst_domain \\<theta> &&& \\<nexists>y. \\<delta> xi = Var y", "using ***[of xi] 5"], ["proof (prove)\nusing this:\n  xi \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n             \\<delta> xi = Var y)\n  xi \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  fv (\\<delta> xi) \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. xi \\<in> subst_domain \\<theta> &&& \\<nexists>y. \\<delta> xi = Var y", "by auto"], ["proof (state)\nthis:\n  xi \\<in> subst_domain \\<theta>\n  \\<nexists>y. \\<delta> xi = Var y\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  xi \\<in> subst_domain \\<theta>\n  \\<nexists>y. \\<delta> xi = Var y", "obtain f T where f: \"\\<delta> xi = Fun f T\""], ["proof (prove)\nusing this:\n  xi \\<in> subst_domain \\<theta>\n  \\<nexists>y. \\<delta> xi = Var y\n\ngoal (1 subgoal):\n 1. (\\<And>f T.\n        \\<delta> xi = Fun f T \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (cases \"\\<delta> xi\") moura"], ["proof (state)\nthis:\n  \\<delta> xi = Fun f T\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "have \"\\<exists>g Y'. Y' \\<noteq> [] \\<and> Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and> set Y' \\<subseteq> ?ys\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "have \"\\<forall>c. Fun c [] \\<sqsubseteq> \\<delta> xi \\<longrightarrow> Fun c [] \\<sqsubseteq> \\<theta> xi\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>c.\n       Fun c [] \\<sqsubseteq> \\<delta> xi \\<longrightarrow>\n       Fun c [] \\<sqsubseteq> \\<theta> xi", "using \\<tau> xi_\\<theta>"], ["proof (prove)\nusing this:\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  xi \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<forall>c.\n       Fun c [] \\<sqsubseteq> \\<delta> xi \\<longrightarrow>\n       Fun c [] \\<sqsubseteq> \\<theta> xi", "by (metis const_subterm_subst subst_compose)"], ["proof (state)\nthis:\n  \\<forall>c.\n     Fun c [] \\<sqsubseteq> \\<delta> xi \\<longrightarrow>\n     Fun c [] \\<sqsubseteq> \\<theta> xi\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "hence 1: \"\\<forall>c. \\<not>(Fun c [] \\<sqsubseteq> \\<delta> xi)\""], ["proof (prove)\nusing this:\n  \\<forall>c.\n     Fun c [] \\<sqsubseteq> \\<delta> xi \\<longrightarrow>\n     Fun c [] \\<sqsubseteq> \\<theta> xi\n\ngoal (1 subgoal):\n 1. \\<forall>c. Fun c [] \\<notin> subterms (\\<delta> xi)", "using 3[of _ xi] xi_\\<theta> \\<theta>(3)"], ["proof (prove)\nusing this:\n  \\<forall>c.\n     Fun c [] \\<sqsubseteq> \\<delta> xi \\<longrightarrow>\n     Fun c [] \\<sqsubseteq> \\<theta> xi\n  Fun ?c [] \\<sqsubseteq> \\<delta> xi \\<Longrightarrow>\n  Fun ?c [] \\<sqsubseteq> s \\<or> Fun ?c [] \\<sqsubseteq> t\n  xi \\<in> subst_domain \\<theta>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter>\n  (subterms s \\<union> subterms t) =\n  {}\n\ngoal (1 subgoal):\n 1. \\<forall>c. Fun c [] \\<notin> subterms (\\<delta> xi)", "by auto"], ["proof (state)\nthis:\n  \\<forall>c. Fun c [] \\<notin> subterms (\\<delta> xi)\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "have \"\\<not>(\\<exists>x. \\<delta> xi = Var x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<nexists>x. \\<delta> xi = Var x", "using f"], ["proof (prove)\nusing this:\n  \\<delta> xi = Fun f T\n\ngoal (1 subgoal):\n 1. \\<nexists>x. \\<delta> xi = Var x", "by auto"], ["proof (state)\nthis:\n  \\<nexists>x. \\<delta> xi = Var x\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "hence \"\\<exists>g S. Fun g S \\<sqsubseteq> \\<delta> xi \\<and> (\\<forall>s \\<in> set S. (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x))\""], ["proof (prove)\nusing this:\n  \\<nexists>x. \\<delta> xi = Var x\n\ngoal (1 subgoal):\n 1. \\<exists>g S.\n       Fun g S \\<sqsubseteq> \\<delta> xi \\<and>\n       (\\<forall>s\\<in>set S.\n           (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x))", "using nonvar_term_has_composed_shallow_term[of \"\\<delta> xi\"]"], ["proof (prove)\nusing this:\n  \\<nexists>x. \\<delta> xi = Var x\n  \\<nexists>x. \\<delta> xi = Var x \\<Longrightarrow>\n  \\<exists>f T.\n     Fun f T \\<sqsubseteq> \\<delta> xi \\<and>\n     (\\<forall>s\\<in>set T.\n         (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x))\n\ngoal (1 subgoal):\n 1. \\<exists>g S.\n       Fun g S \\<sqsubseteq> \\<delta> xi \\<and>\n       (\\<forall>s\\<in>set S.\n           (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x))", "by auto"], ["proof (state)\nthis:\n  \\<exists>g S.\n     Fun g S \\<sqsubseteq> \\<delta> xi \\<and>\n     (\\<forall>s\\<in>set S.\n         (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x))\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "then"], ["proof (chain)\npicking this:\n  \\<exists>g S.\n     Fun g S \\<sqsubseteq> \\<delta> xi \\<and>\n     (\\<forall>s\\<in>set S.\n         (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x))", "obtain g S where gS: \"Fun g S \\<sqsubseteq> \\<delta> xi\" \"\\<forall>s \\<in> set S. (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x)\""], ["proof (prove)\nusing this:\n  \\<exists>g S.\n     Fun g S \\<sqsubseteq> \\<delta> xi \\<and>\n     (\\<forall>s\\<in>set S.\n         (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x))\n\ngoal (1 subgoal):\n 1. (\\<And>g S.\n        \\<lbrakk>Fun g S \\<sqsubseteq> \\<delta> xi;\n         \\<forall>s\\<in>set S.\n            (\\<exists>c. s = Fun c []) \\<or>\n            (\\<exists>x. s = Var x)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  Fun g S \\<sqsubseteq> \\<delta> xi\n  \\<forall>s\\<in>set S.\n     (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x)\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "have \"\\<forall>s \\<in> set S. \\<exists>x. s = Var x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>s\\<in>set S. \\<exists>x. s = Var x", "using 1 term.order_trans gS"], ["proof (prove)\nusing this:\n  \\<forall>c. Fun c [] \\<notin> subterms (\\<delta> xi)\n  \\<lbrakk>?x \\<sqsubseteq> ?y; ?y \\<sqsubseteq> ?z\\<rbrakk>\n  \\<Longrightarrow> ?x \\<sqsubseteq> ?z\n  Fun g S \\<sqsubseteq> \\<delta> xi\n  \\<forall>s\\<in>set S.\n     (\\<exists>c. s = Fun c []) \\<or> (\\<exists>x. s = Var x)\n\ngoal (1 subgoal):\n 1. \\<forall>s\\<in>set S. \\<exists>x. s = Var x", "by (metis (no_types, lifting) UN_I term.order_refl subsetCE subterms.simps(2) sup_ge2)"], ["proof (state)\nthis:\n  \\<forall>s\\<in>set S. \\<exists>x. s = Var x\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "then"], ["proof (chain)\npicking this:\n  \\<forall>s\\<in>set S. \\<exists>x. s = Var x", "obtain S' where 2: \"map Var S' = S\""], ["proof (prove)\nusing this:\n  \\<forall>s\\<in>set S. \\<exists>x. s = Var x\n\ngoal (1 subgoal):\n 1. (\\<And>S'. map Var S' = S \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis ex_map_conv)"], ["proof (state)\nthis:\n  map Var S' = S\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "have \"S \\<noteq> []\""], ["proof (prove)\ngoal (1 subgoal):\n 1. S \\<noteq> []", "using 1 term.order_trans[OF _ gS(1)]"], ["proof (prove)\nusing this:\n  \\<forall>c. Fun c [] \\<notin> subterms (\\<delta> xi)\n  ?x \\<sqsubseteq> Fun g S \\<Longrightarrow> ?x \\<sqsubseteq> \\<delta> xi\n\ngoal (1 subgoal):\n 1. S \\<noteq> []", "by fastforce"], ["proof (state)\nthis:\n  S \\<noteq> []\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "hence 3: \"S' \\<noteq> []\" \"Fun g (map Var S') \\<sqsubseteq> \\<delta> xi\""], ["proof (prove)\nusing this:\n  S \\<noteq> []\n\ngoal (1 subgoal):\n 1. S' \\<noteq> [] &&& Fun g (map Var S') \\<sqsubseteq> \\<delta> xi", "using gS(1) 2"], ["proof (prove)\nusing this:\n  S \\<noteq> []\n  Fun g S \\<sqsubseteq> \\<delta> xi\n  map Var S' = S\n\ngoal (1 subgoal):\n 1. S' \\<noteq> [] &&& Fun g (map Var S') \\<sqsubseteq> \\<delta> xi", "by auto"], ["proof (state)\nthis:\n  S' \\<noteq> []\n  Fun g (map Var S') \\<sqsubseteq> \\<delta> xi\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "have \"set S' \\<subseteq> fv (Fun g (map Var S'))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. set S' \\<subseteq> fv (Fun g (map Var S'))", "by simp"], ["proof (state)\nthis:\n  set S' \\<subseteq> fv (Fun g (map Var S'))\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "hence 4: \"set S' \\<subseteq> fv (\\<delta> xi)\""], ["proof (prove)\nusing this:\n  set S' \\<subseteq> fv (Fun g (map Var S'))\n\ngoal (1 subgoal):\n 1. set S' \\<subseteq> fv (\\<delta> xi)", "using 3(2) fv_subterms"], ["proof (prove)\nusing this:\n  set S' \\<subseteq> fv (Fun g (map Var S'))\n  Fun g (map Var S') \\<sqsubseteq> \\<delta> xi\n  fv\\<^sub>s\\<^sub>e\\<^sub>t (subterms ?t) = fv ?t\n\ngoal (1 subgoal):\n 1. set S' \\<subseteq> fv (\\<delta> xi)", "by force"], ["proof (state)\nthis:\n  set S' \\<subseteq> fv (\\<delta> xi)\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "using ***[OF xi_assms(1)] 2 3 4"], ["proof (prove)\nusing this:\n  fv (\\<delta> xi) \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n  map Var S' = S\n  S' \\<noteq> []\n  Fun g (map Var S') \\<sqsubseteq> \\<delta> xi\n  set S' \\<subseteq> fv (\\<delta> xi)\n\ngoal (1 subgoal):\n 1. \\<exists>g Y'.\n       Y' \\<noteq> [] \\<and>\n       Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n       set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "by auto"], ["proof (state)\nthis:\n  \\<exists>g Y'.\n     Y' \\<noteq> [] \\<and>\n     Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n     set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<exists>g Y'.\n     Y' \\<noteq> [] \\<and>\n     Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n     set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  \\<exists>g Y'.\n     Y' \\<noteq> [] \\<and>\n     Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n     set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "obtain g Y' where g: \"Y' \\<noteq> []\" \"Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi\" \"set Y' \\<subseteq> ?ys\""], ["proof (prove)\nusing this:\n  \\<exists>g Y'.\n     Y' \\<noteq> [] \\<and>\n     Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi \\<and>\n     set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>Y' g.\n        \\<lbrakk>Y' \\<noteq> [];\n         Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi;\n         set Y'\n         \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  Y' \\<noteq> []\n  Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi\n  set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  Y' \\<noteq> []\n  Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi\n  set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "obtain X where X: \"map \\<delta> X = map Var Y'\" \"Fun g (map Var X) \\<in> subterms s \\<union> subterms t\""], ["proof (prove)\nusing this:\n  Y' \\<noteq> []\n  Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi\n  set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>X.\n        \\<lbrakk>map \\<delta> X = map Var Y';\n         Fun g (map Var X) \\<in> subterms s \\<union> subterms t\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using mgu_img_composed_var_term[OF \\<delta>, of g Y']"], ["proof (prove)\nusing this:\n  Y' \\<noteq> []\n  Fun g (map Var Y') \\<sqsubseteq> \\<delta> xi\n  set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n  Fun g (map Var Y') \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<delta> \\<Longrightarrow>\n  \\<exists>Z'.\n     map \\<delta> Z' = map Var Y' \\<and>\n     Fun g (map Var Z') \\<in> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. (\\<And>X.\n        \\<lbrakk>map \\<delta> X = map Var Y';\n         Fun g (map Var X) \\<in> subterms s \\<union> subterms t\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by force"], ["proof (state)\nthis:\n  map \\<delta> X = map Var Y'\n  Fun g (map Var X) \\<in> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "hence \"\\<exists>(u::('f,'v) term) \\<in> set (map Var X). u \\<notin> Var ` ?ys\""], ["proof (prove)\nusing this:\n  map \\<delta> X = map Var Y'\n  Fun g (map Var X) \\<in> subterms s \\<union> subterms t\n\ngoal (1 subgoal):\n 1. \\<exists>u\\<in>set (map Var X).\n       u \\<notin> Var ` (fv s \\<union> fv t - subst_domain \\<theta>)", "using \\<theta>(4) tfr g(1)"], ["proof (prove)\nusing this:\n  map \\<delta> X = map Var Y'\n  Fun g (map Var X) \\<in> subterms s \\<union> subterms t\n  fv s \\<union> fv t - subst_domain \\<theta> \\<subseteq> X\n  \\<forall>f U.\n     Fun f U \\<in> subterms s \\<union> subterms t \\<longrightarrow>\n     U = [] \\<or> (\\<exists>u\\<in>set U. u \\<notin> Var ` X)\n  Y' \\<noteq> []\n\ngoal (1 subgoal):\n 1. \\<exists>u\\<in>set (map Var X).\n       u \\<notin> Var ` (fv s \\<union> fv t - subst_domain \\<theta>)", "by fastforce"], ["proof (state)\nthis:\n  \\<exists>u\\<in>set (map Var X).\n     u \\<notin> Var ` (fv s \\<union> fv t - subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  \\<exists>u\\<in>set (map Var X).\n     u \\<notin> Var ` (fv s \\<union> fv t - subst_domain \\<theta>)", "obtain j where j: \"j < length X\" \"X ! j \\<notin> ?ys\""], ["proof (prove)\nusing this:\n  \\<exists>u\\<in>set (map Var X).\n     u \\<notin> Var ` (fv s \\<union> fv t - subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. (\\<And>j.\n        \\<lbrakk>j < length X;\n         X ! j \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis image_iff[of _ Var \"fv s \\<union> fv t - subst_domain \\<theta>\"] nth_map[of _ X Var]\n                in_set_conv_nth[of _ \"map Var X\"] length_map[of Var X])"], ["proof (state)\nthis:\n  j < length X\n  X ! j \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "define yj' where yj': \"yj' \\<equiv> Y' ! j\""], ["proof (state)\nthis:\n  yj' \\<equiv> Y' ! j\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "define xj where xj: \"xj \\<equiv> X ! j\""], ["proof (state)\nthis:\n  xj \\<equiv> X ! j\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "have \"xj \\<in> fv s \\<union> fv t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. xj \\<in> fv s \\<union> fv t", "using j X(1) g(3) 5 xj yj'"], ["proof (prove)\nusing this:\n  j < length X\n  X ! j \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n  map \\<delta> X = map Var Y'\n  set Y' \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n  xj \\<equiv> X ! j\n  yj' \\<equiv> Y' ! j\n\ngoal (1 subgoal):\n 1. xj \\<in> fv s \\<union> fv t", "by (metis length_map nth_map term.simps(1) in_set_conv_nth le_supE subsetCE subst_domI)"], ["proof (state)\nthis:\n  xj \\<in> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "hence xj_\\<theta>: \"xj \\<in> subst_domain \\<theta>\""], ["proof (prove)\nusing this:\n  xj \\<in> fv s \\<union> fv t\n\ngoal (1 subgoal):\n 1. xj \\<in> subst_domain \\<theta>", "using j"], ["proof (prove)\nusing this:\n  xj \\<in> fv s \\<union> fv t\n  j < length X\n  X ! j \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. xj \\<in> subst_domain \\<theta>", "unfolding xj"], ["proof (prove)\nusing this:\n  X ! j \\<in> fv s \\<union> fv t\n  j < length X\n  X ! j \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. X ! j \\<in> subst_domain \\<theta>", "by simp"], ["proof (state)\nthis:\n  xj \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "have len: \"length X = length Y'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. length X = length Y'", "by (rule map_eq_imp_length_eq[OF X(1)])"], ["proof (state)\nthis:\n  length X = length Y'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "have \"Var yj' \\<sqsubseteq> \\<delta> xi\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Var yj' \\<sqsubseteq> \\<delta> xi", "using term.order_trans[OF _ g(2)] j(1) len"], ["proof (prove)\nusing this:\n  ?x \\<sqsubseteq> Fun g (map Var Y') \\<Longrightarrow>\n  ?x \\<sqsubseteq> \\<delta> xi\n  j < length X\n  length X = length Y'\n\ngoal (1 subgoal):\n 1. Var yj' \\<sqsubseteq> \\<delta> xi", "unfolding yj'"], ["proof (prove)\nusing this:\n  ?x \\<sqsubseteq> Fun g (map Var Y') \\<Longrightarrow>\n  ?x \\<sqsubseteq> \\<delta> xi\n  j < length X\n  length X = length Y'\n\ngoal (1 subgoal):\n 1. Var (Y' ! j) \\<sqsubseteq> \\<delta> xi", "by auto"], ["proof (state)\nthis:\n  Var yj' \\<sqsubseteq> \\<delta> xi\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "hence \"\\<tau> yj' \\<sqsubseteq> \\<theta> xi\""], ["proof (prove)\nusing this:\n  Var yj' \\<sqsubseteq> \\<delta> xi\n\ngoal (1 subgoal):\n 1. \\<tau> yj' \\<sqsubseteq> \\<theta> xi", "using \\<tau> xi_\\<theta>"], ["proof (prove)\nusing this:\n  Var yj' \\<sqsubseteq> \\<delta> xi\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  xi \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<tau> yj' \\<sqsubseteq> \\<theta> xi", "by (metis subst_apply_term.simps(1) subst_compose_def subst_mono)"], ["proof (state)\nthis:\n  \\<tau> yj' \\<sqsubseteq> \\<theta> xi\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  \\<tau> yj' \\<sqsubseteq> \\<theta> xi\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "have \\<delta>_xj_var: \"Var yj' = \\<delta> xj\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Var yj' = \\<delta> xj", "using X(1) len j(1) nth_map"], ["proof (prove)\nusing this:\n  map \\<delta> X = map Var Y'\n  length X = length Y'\n  j < length X\n  ?n < length ?xs \\<Longrightarrow> map ?f ?xs ! ?n = ?f (?xs ! ?n)\n\ngoal (1 subgoal):\n 1. Var yj' = \\<delta> xj", "unfolding xj yj'"], ["proof (prove)\nusing this:\n  map \\<delta> X = map Var Y'\n  length X = length Y'\n  j < length X\n  ?n < length ?xs \\<Longrightarrow> map ?f ?xs ! ?n = ?f (?xs ! ?n)\n\ngoal (1 subgoal):\n 1. Var (Y' ! j) = \\<delta> (X ! j)", "by metis"], ["proof (state)\nthis:\n  Var yj' = \\<delta> xj\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "hence \"\\<tau> yj' = \\<theta> xj\""], ["proof (prove)\nusing this:\n  Var yj' = \\<delta> xj\n\ngoal (1 subgoal):\n 1. \\<tau> yj' = \\<theta> xj", "using \\<tau> xj_\\<theta>"], ["proof (prove)\nusing this:\n  Var yj' = \\<delta> xj\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<theta> x = (\\<delta> \\<circ>\\<^sub>s \\<tau>) x\n  xj \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<tau> yj' = \\<theta> xj", "by (metis subst_apply_term.simps(1) subst_compose_def)"], ["proof (state)\nthis:\n  \\<tau> yj' = \\<theta> xj\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  \\<tau> yj' = \\<theta> xj\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "have \"xi \\<noteq> xj\""], ["proof (prove)\ngoal (1 subgoal):\n 1. xi \\<noteq> xj", "using \\<delta>_xi_comp \\<delta>_xj_var"], ["proof (prove)\nusing this:\n  \\<nexists>y. \\<delta> xi = Var y\n  Var yj' = \\<delta> xj\n\ngoal (1 subgoal):\n 1. xi \\<noteq> xj", "by auto"], ["proof (state)\nthis:\n  xi \\<noteq> xj\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       \\<lbrakk>x \\<in> subst_domain \\<delta> \\<inter>\n                        subst_domain \\<theta>;\n        \\<not> (\\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n                   \\<delta> x = Var y)\\<rbrakk>\n       \\<Longrightarrow> False", "ultimately"], ["proof (chain)\npicking this:\n  \\<tau> yj' \\<sqsubseteq> \\<theta> xi\n  \\<tau> yj' = \\<theta> xj\n  xi \\<noteq> xj", "show False"], ["proof (prove)\nusing this:\n  \\<tau> yj' \\<sqsubseteq> \\<theta> xi\n  \\<tau> yj' = \\<theta> xj\n  xi \\<noteq> xj\n\ngoal (1 subgoal):\n 1. False", "using \\<theta>(1) xi_\\<theta> xj_\\<theta>"], ["proof (prove)\nusing this:\n  \\<tau> yj' \\<sqsubseteq> \\<theta> xi\n  \\<tau> yj' = \\<theta> xj\n  xi \\<noteq> xj\n  subterm_inj_on \\<theta> (subst_domain \\<theta>)\n  xi \\<in> subst_domain \\<theta>\n  xj \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. False", "unfolding subterm_inj_on_def"], ["proof (prove)\nusing this:\n  \\<tau> yj' \\<sqsubseteq> \\<theta> xi\n  \\<tau> yj' = \\<theta> xj\n  xi \\<noteq> xj\n  \\<forall>x\\<in>subst_domain \\<theta>.\n     \\<forall>y\\<in>subst_domain \\<theta>.\n        (\\<exists>v.\n            v \\<sqsubseteq> \\<theta> x \\<and>\n            v \\<sqsubseteq> \\<theta> y) \\<longrightarrow>\n        x = y\n  xi \\<in> subst_domain \\<theta>\n  xj \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. False", "by blast"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  ?x \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n     \\<delta> ?x = Var y\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "define \\<alpha> where \"\\<alpha> = (\\<lambda>y'. if Var y' \\<in> \\<delta> ` (subst_domain \\<delta> \\<inter> ?xs)\n                            then Var ((inv_into (subst_domain \\<delta> \\<inter> ?xs) \\<delta>) (Var y'))\n                            else Var y'::('f,'v) term)\""], ["proof (state)\nthis:\n  \\<alpha> =\n  (\\<lambda>y'.\n      if Var y'\n         \\<in> \\<delta> `\n               (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n      then Var (inv_into\n                 (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n                 \\<delta> (Var y'))\n      else Var y')\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have a1: \"Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t", "using mgu_gives_MGU[OF \\<delta>]"], ["proof (prove)\nusing this:\n  MGU \\<delta> s t\n\ngoal (1 subgoal):\n 1. Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t", "by auto"], ["proof (state)\nthis:\n  Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "define \\<delta>' where \"\\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\""], ["proof (state)\nthis:\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have d1: \"subst_domain \\<delta>' \\<subseteq> ?ys\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta>'\n    \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "fix z"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "assume z: \"z \\<in> subst_domain \\<delta>'\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "have \"z \\<in> ?xs \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n    z \\<notin> subst_domain \\<delta>'", "proof (cases \"z \\<in> subst_domain \\<delta>\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "case True"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "moreover"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "assume \"z \\<in> ?xs\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "ultimately"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<delta>\n  z \\<in> subst_domain \\<theta>", "have z_in: \"z \\<in> subst_domain \\<delta> \\<inter> ?xs\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<delta>\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>", "by simp"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "then"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>", "obtain y where y: \"\\<delta> z = Var y\" \"y \\<in> ?ys\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>y.\n        \\<lbrakk>\\<delta> z = Var y;\n         y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using *"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n  ?x \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n     \\<delta> ?x = Var y\n\ngoal (1 subgoal):\n 1. (\\<And>y.\n        \\<lbrakk>\\<delta> z = Var y;\n         y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  \\<delta> z = Var y\n  y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<alpha> y = Var ((inv_into (subst_domain \\<delta> \\<inter> ?xs) \\<delta>) (Var y))\""], ["proof (prove)\nusing this:\n  \\<delta> z = Var y\n  y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<alpha> y =\n    Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n          \\<delta> (Var y))", "using \\<alpha>_def z_in"], ["proof (prove)\nusing this:\n  \\<delta> z = Var y\n  y \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n  \\<alpha> =\n  (\\<lambda>y'.\n      if Var y'\n         \\<in> \\<delta> `\n               (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n      then Var (inv_into\n                 (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n                 \\<delta> (Var y'))\n      else Var y')\n  z \\<in> subst_domain \\<delta> \\<inter> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<alpha> y =\n    Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n          \\<delta> (Var y))", "by simp"], ["proof (state)\nthis:\n  \\<alpha> y =\n  Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n        \\<delta> (Var y))\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<alpha> y = Var z\""], ["proof (prove)\nusing this:\n  \\<alpha> y =\n  Var (inv_into (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n        \\<delta> (Var y))\n\ngoal (1 subgoal):\n 1. \\<alpha> y = Var z", "by (metis y(1) z_in ** inv_into_f_eq)"], ["proof (state)\nthis:\n  \\<alpha> y = Var z\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<delta>' z = Var z\""], ["proof (prove)\nusing this:\n  \\<alpha> y = Var z\n\ngoal (1 subgoal):\n 1. \\<delta>' z = Var z", "using \\<delta>'_def y(1) subst_compose_def[of \\<delta> \\<alpha>]"], ["proof (prove)\nusing this:\n  \\<alpha> y = Var z\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n  \\<delta> z = Var y\n  \\<delta> \\<circ>\\<^sub>s \\<alpha> =\n  (\\<lambda>x. \\<delta> x \\<cdot> \\<alpha>)\n\ngoal (1 subgoal):\n 1. \\<delta>' z = Var z", "by simp"], ["proof (state)\nthis:\n  \\<delta>' z = Var z\n\ngoal (2 subgoals):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<in> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'\n 2. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "case False"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<delta> z = Var z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<delta>\n\ngoal (1 subgoal):\n 1. \\<delta> z = Var z", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<delta> z = Var z\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "moreover"], ["proof (state)\nthis:\n  \\<delta> z = Var z\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "assume \"z \\<in> ?xs\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "hence \"\\<alpha> z = Var z\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<alpha> z = Var z", "using \\<alpha>_def *"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n  \\<alpha> =\n  (\\<lambda>y'.\n      if Var y'\n         \\<in> \\<delta> `\n               (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n      then Var (inv_into\n                 (subst_domain \\<delta> \\<inter> subst_domain \\<theta>)\n                 \\<delta> (Var y'))\n      else Var y')\n  ?x \\<in> subst_domain \\<delta> \\<inter>\n           subst_domain \\<theta> \\<Longrightarrow>\n  \\<exists>y\\<in>fv s \\<union> fv t - subst_domain \\<theta>.\n     \\<delta> ?x = Var y\n\ngoal (1 subgoal):\n 1. \\<alpha> z = Var z", "by force"], ["proof (state)\nthis:\n  \\<alpha> z = Var z\n\ngoal (1 subgoal):\n 1. \\<lbrakk>z \\<in> subst_domain \\<theta>;\n     z \\<notin> subst_domain \\<delta>\\<rbrakk>\n    \\<Longrightarrow> z \\<notin> subst_domain \\<delta>'", "ultimately"], ["proof (chain)\npicking this:\n  \\<delta> z = Var z\n  \\<alpha> z = Var z", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<delta> z = Var z\n  \\<alpha> z = Var z\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "using \\<delta>'_def subst_compose_def[of \\<delta> \\<alpha>]"], ["proof (prove)\nusing this:\n  \\<delta> z = Var z\n  \\<alpha> z = Var z\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n  \\<delta> \\<circ>\\<^sub>s \\<alpha> =\n  (\\<lambda>x. \\<delta> x \\<cdot> \\<alpha>)\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "moreover"], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "have \"subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>", "unfolding \\<delta>'_def \\<alpha>_def range_vars_alt_def subst_domain_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. {x. (if Var x\n            \\<in> \\<delta> `\n                  ({x. \\<delta> x \\<noteq> Var x} \\<inter>\n                   {x. \\<theta> x \\<noteq> Var x})\n         then Var (inv_into\n                    ({x. \\<delta> x \\<noteq> Var x} \\<inter>\n                     {x. \\<theta> x \\<noteq> Var x})\n                    \\<delta> (Var x))\n         else Var x) \\<noteq>\n        Var x}\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<delta>)", "by auto"], ["proof (state)\nthis:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "hence \"subst_domain \\<delta>' \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\""], ["proof (prove)\nusing this:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta>'\n    \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "using subst_domain_compose[of \\<delta> \\<alpha>]"], ["proof (prove)\nusing this:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n  subst_domain (\\<delta> \\<circ>\\<^sub>s \\<alpha>)\n  \\<subseteq> subst_domain \\<delta> \\<union> subst_domain \\<alpha>\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta>'\n    \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "unfolding \\<delta>'_def"], ["proof (prove)\nusing this:\n  subst_domain \\<alpha> \\<subseteq> range_vars \\<delta>\n  subst_domain (\\<delta> \\<circ>\\<^sub>s \\<alpha>)\n  \\<subseteq> subst_domain \\<delta> \\<union> subst_domain \\<alpha>\n\ngoal (1 subgoal):\n 1. subst_domain (\\<delta> \\<circ>\\<^sub>s \\<alpha>)\n    \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "by blast"], ["proof (state)\nthis:\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<delta>' \\<Longrightarrow>\n       x \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>", "show \"z \\<in> ?ys\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\n\ngoal (1 subgoal):\n 1. z \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "using 5 z"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  z \\<notin> subst_domain \\<delta>'\n  subst_domain \\<delta>'\n  \\<subseteq> subst_domain \\<delta> \\<union> range_vars \\<delta>\n  subst_domain \\<delta> \\<union> range_vars \\<delta>\n  \\<subseteq> fv s \\<union> fv t\n  z \\<in> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. z \\<in> fv s \\<union> fv t - subst_domain \\<theta>", "by blast"], ["proof (state)\nthis:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  subst_domain \\<delta>'\n  \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have d2: \"Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t", "using a1 \\<delta>'_def"], ["proof (prove)\nusing this:\n  Unifier (\\<delta> \\<circ>\\<^sub>s \\<alpha>) s t\n  \\<delta>' = \\<delta> \\<circ>\\<^sub>s \\<alpha>\n\ngoal (1 subgoal):\n 1. Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t", "by auto"], ["proof (state)\nthis:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "have d3: \"\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> = \\<delta>' \\<circ>\\<^sub>s \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "fix z::'v"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "assume z: \"z \\<in> ?xs\""], ["proof (state)\nthis:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "then"], ["proof (chain)\npicking this:\n  z \\<in> subst_domain \\<theta>", "obtain u where u: \"\\<I> z = u\" \"fv u = {}\""], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>\\<I> z = u; fv u = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using \\<I>"], ["proof (prove)\nusing this:\n  z \\<in> subst_domain \\<theta>\n  ground (subst_range \\<I>)\n  subst_domain \\<I> = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>\\<I> z = u; fv u = {}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  \\<I> z = u\n  fv u = {}\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\""], ["proof (prove)\nusing this:\n  \\<I> z = u\n  fv u = {}\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "by (simp add: subst_compose subst_ground_ident)"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "moreover"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "have \"z \\<notin> subst_domain \\<delta>'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "using d1 z"], ["proof (prove)\nusing this:\n  subst_domain \\<delta>'\n  \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n  z \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<delta>'", "by auto"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"\\<delta>' z = Var z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<delta>'\n\ngoal (1 subgoal):\n 1. \\<delta>' z = Var z", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\""], ["proof (prove)\nusing this:\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "using u(1)"], ["proof (prove)\nusing this:\n  \\<delta>' z = Var z\n  \\<I> z = u\n\ngoal (1 subgoal):\n 1. (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "by (simp add: subst_compose)"], ["proof (state)\nthis:\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "ultimately"], ["proof (chain)\npicking this:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u", "have \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\""], ["proof (prove)\nusing this:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z = u\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n    (\\<delta>' \\<circ>\\<^sub>s \\<I>) z", "by metis"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "}"], ["proof (state)\nthis:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "moreover"], ["proof (state)\nthis:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "{"], ["proof (state)\nthis:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "fix z::'v"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "assume \"z \\<in> ?ys\""], ["proof (state)\nthis:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"z \\<notin> subst_domain \\<I>\""], ["proof (prove)\nusing this:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<I>", "using \\<I>(2)"], ["proof (prove)\nusing this:\n  z \\<in> fv s \\<union> fv t - subst_domain \\<theta>\n  subst_domain \\<I> = subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. z \\<notin> subst_domain \\<I>", "by auto"], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n    (\\<delta>' \\<circ>\\<^sub>s \\<I>) z", "by (simp add: subst_compose subst_domain_def)"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "}"], ["proof (state)\nthis:\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "moreover"], ["proof (state)\nthis:\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "{"], ["proof (state)\nthis:\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "fix z::'v"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "assume \"z \\<notin> ?xs\" \"z \\<notin> ?ys\""], ["proof (state)\nthis:\n  z \\<notin> subst_domain \\<theta>\n  z \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"\\<I> z = Var z\" \"\\<delta>' z = Var z\""], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<theta>\n  z \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> z = Var z &&& \\<delta>' z = Var z", "using \\<I>(2) d1"], ["proof (prove)\nusing this:\n  z \\<notin> subst_domain \\<theta>\n  z \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\n  subst_domain \\<I> = subst_domain \\<theta>\n  subst_domain \\<delta>'\n  \\<subseteq> fv s \\<union> fv t - subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<I> z = Var z &&& \\<delta>' z = Var z", "by blast+"], ["proof (state)\nthis:\n  \\<I> z = Var z\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "hence \"(\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z = (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\""], ["proof (prove)\nusing this:\n  \\<I> z = Var z\n  \\<delta>' z = Var z\n\ngoal (1 subgoal):\n 1. (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n    (\\<delta>' \\<circ>\\<^sub>s \\<I>) z", "by (simp add: subst_compose)"], ["proof (state)\nthis:\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) z =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) z\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "}"], ["proof (state)\nthis:\n  \\<lbrakk>?z2 \\<notin> subst_domain \\<theta>;\n   ?z2 \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>)\n                     ?z2 =\n                    (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "ultimately"], ["proof (chain)\npicking this:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  \\<lbrakk>?z2 \\<notin> subst_domain \\<theta>;\n   ?z2 \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>)\n                     ?z2 =\n                    (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2", "show ?thesis"], ["proof (prove)\nusing this:\n  ?z2 \\<in> subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  ?z2 \\<in> fv s \\<union> fv t - subst_domain \\<theta> \\<Longrightarrow>\n  (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2 =\n  (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n  \\<lbrakk>?z2 \\<notin> subst_domain \\<theta>;\n   ?z2 \\<notin> fv s \\<union> fv t - subst_domain \\<theta>\\<rbrakk>\n  \\<Longrightarrow> (\\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I>)\n                     ?z2 =\n                    (\\<delta>' \\<circ>\\<^sub>s \\<I>) ?z2\n\ngoal (1 subgoal):\n 1. \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n    \\<delta>' \\<circ>\\<^sub>s \\<I>", "by auto"], ["proof (state)\nthis:\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "from d2 d3"], ["proof (chain)\npicking this:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>", "have \"Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\""], ["proof (prove)\nusing this:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) s t\n  \\<I> \\<circ>\\<^sub>s \\<delta>' \\<circ>\\<^sub>s \\<I> =\n  \\<delta>' \\<circ>\\<^sub>s \\<I>\n\ngoal (1 subgoal):\n 1. Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>)\n     (t \\<cdot> \\<I>)", "by (metis subst_subst_compose)"], ["proof (state)\nthis:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "thus ?thesis"], ["proof (prove)\nusing this:\n  Unifier (\\<delta>' \\<circ>\\<^sub>s \\<I>) (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "by metis"], ["proof (state)\nthis:\n  \\<exists>\\<delta>. Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal:\nNo subgoals!", "qed"], ["", "context\nbegin"], ["", "private"], ["", "lemma sat_ineq_subterm_inj_subst_aux:\n  fixes \\<I>::\"('f,'v) subst\"\n  assumes \"Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\" \"ground (subst_range \\<I>)\"\n          \"(fv s \\<union> fv t) - X \\<subseteq> subst_domain \\<I>\" \"subst_domain \\<I> \\<inter> X = {}\"\n  shows \"\\<exists>\\<delta>::('f,'v) subst. subst_domain \\<delta> = X \\<and> ground (subst_range \\<delta>) \\<and> s \\<cdot> \\<delta> \\<cdot> \\<I> = t \\<cdot> \\<delta> \\<cdot> \\<I>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "have \"\\<exists>\\<sigma>. Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and> interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "obtain \\<I>'::\"('f,'v) subst\" where *: \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>\\<I>'.\n        interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n         \\<I>' \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "using interpretation_subst_exists"], ["proof (prove)\nusing this:\n  \\<exists>\\<I>. interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<I>'.\n        interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n         \\<I>' \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by metis"], ["proof (state)\nthis:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "hence \"Unifier (\\<sigma> \\<circ>\\<^sub>s \\<I>') (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\""], ["proof (prove)\nusing this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>'\n\ngoal (1 subgoal):\n 1. Unifier (\\<sigma> \\<circ>\\<^sub>s \\<I>') (s \\<cdot> \\<I>)\n     (t \\<cdot> \\<I>)", "using assms(1)"], ["proof (prove)\nusing this:\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>'\n  Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. Unifier (\\<sigma> \\<circ>\\<^sub>s \\<I>') (s \\<cdot> \\<I>)\n     (t \\<cdot> \\<I>)", "by simp"], ["proof (state)\nthis:\n  Unifier (\\<sigma> \\<circ>\\<^sub>s \\<I>') (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "thus ?thesis"], ["proof (prove)\nusing this:\n  Unifier (\\<sigma> \\<circ>\\<^sub>s \\<I>') (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "using * interpretation_comp"], ["proof (prove)\nusing this:\n  Unifier (\\<sigma> \\<circ>\\<^sub>s \\<I>') (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<I>'\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   ?\\<theta> \\<Longrightarrow>\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (?\\<sigma> \\<circ>\\<^sub>s ?\\<theta>)\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   ?\\<theta> \\<Longrightarrow>\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n   (?\\<theta> \\<circ>\\<^sub>s ?\\<sigma>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<sigma>.\n       Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n       interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "by blast"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n     interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n     interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "then"], ["proof (chain)\npicking this:\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n     interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>", "obtain \\<sigma>' where \\<sigma>': \"Unifier \\<sigma>' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\" \"interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>'\""], ["proof (prove)\nusing this:\n  \\<exists>\\<sigma>.\n     Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>) \\<and>\n     interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>\n\ngoal (1 subgoal):\n 1. (\\<And>\\<sigma>'.\n        \\<lbrakk>Unifier \\<sigma>' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>);\n         interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t\n          \\<sigma>'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  Unifier \\<sigma>' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "define \\<sigma>'' where \"\\<sigma>'' = rm_vars (UNIV - X) \\<sigma>'\""], ["proof (state)\nthis:\n  \\<sigma>'' = rm_vars (UNIV - X) \\<sigma>'\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "have *: \"fv (s \\<cdot> \\<I>) \\<subseteq> X\" \"fv (t \\<cdot> \\<I>) \\<subseteq> X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fv (s \\<cdot> \\<I>) \\<subseteq> X &&& fv (t \\<cdot> \\<I>) \\<subseteq> X", "using assms(2,3) subst_fv_unfold_ground_img[of \\<I>]"], ["proof (prove)\nusing this:\n  ground (subst_range \\<I>)\n  fv s \\<union> fv t - X \\<subseteq> subst_domain \\<I>\n  range_vars \\<I> = {} \\<Longrightarrow>\n  fv (?t \\<cdot> \\<I>) = fv ?t - subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. fv (s \\<cdot> \\<I>) \\<subseteq> X &&& fv (t \\<cdot> \\<I>) \\<subseteq> X", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  ground (subst_range \\<I>)\n  fv s \\<union> fv t - X \\<subseteq> subst_domain \\<I>\n  ground (subst_range \\<I>) \\<Longrightarrow>\n  fv (?t \\<cdot> \\<I>) = fv ?t - subst_domain \\<I>\n\ngoal (1 subgoal):\n 1. fv (s \\<cdot> \\<I>) \\<subseteq> X &&& fv (t \\<cdot> \\<I>) \\<subseteq> X", "by (simp_all add: Diff_subset_conv Un_commute)"], ["proof (state)\nthis:\n  fv (s \\<cdot> \\<I>) \\<subseteq> X\n  fv (t \\<cdot> \\<I>) \\<subseteq> X\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "hence **: \"subst_domain \\<sigma>'' = X\" \"ground (subst_range \\<sigma>'')\""], ["proof (prove)\nusing this:\n  fv (s \\<cdot> \\<I>) \\<subseteq> X\n  fv (t \\<cdot> \\<I>) \\<subseteq> X\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>'' = X &&& ground (subst_range \\<sigma>'')", "using rm_vars_img_subset[of \"UNIV - X\" \\<sigma>'] rm_vars_dom[of \"UNIV - X\" \\<sigma>'] \\<sigma>'(2)"], ["proof (prove)\nusing this:\n  fv (s \\<cdot> \\<I>) \\<subseteq> X\n  fv (t \\<cdot> \\<I>) \\<subseteq> X\n  subst_range (rm_vars (UNIV - X) \\<sigma>')\n  \\<subseteq> subst_range \\<sigma>'\n  subst_domain (rm_vars (UNIV - X) \\<sigma>') =\n  subst_domain \\<sigma>' - (UNIV - X)\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>'\n\ngoal (1 subgoal):\n 1. subst_domain \\<sigma>'' = X &&& ground (subst_range \\<sigma>'')", "unfolding \\<sigma>''_def"], ["proof (prove)\nusing this:\n  fv (s \\<cdot> \\<I>) \\<subseteq> X\n  fv (t \\<cdot> \\<I>) \\<subseteq> X\n  subst_range (rm_vars (UNIV - X) \\<sigma>')\n  \\<subseteq> subst_range \\<sigma>'\n  subst_domain (rm_vars (UNIV - X) \\<sigma>') =\n  subst_domain \\<sigma>' - (UNIV - X)\n  interpretation\\<^sub>s\\<^sub>u\\<^sub>b\\<^sub>s\\<^sub>t \\<sigma>'\n\ngoal (1 subgoal):\n 1. subst_domain (rm_vars (UNIV - X) \\<sigma>') = X &&&\n    ground (subst_range (rm_vars (UNIV - X) \\<sigma>'))", "by auto"], ["proof (state)\nthis:\n  subst_domain \\<sigma>'' = X\n  ground (subst_range \\<sigma>'')\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "hence \"\\<And>t. t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = t \\<cdot> \\<sigma>'' \\<cdot> \\<I>\""], ["proof (prove)\nusing this:\n  subst_domain \\<sigma>'' = X\n  ground (subst_range \\<sigma>'')\n\ngoal (1 subgoal):\n 1. \\<And>t.\n       t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = t \\<cdot> \\<sigma>'' \\<cdot> \\<I>", "using subst_eq_if_disjoint_vars_ground[OF _ _ assms(2)] assms(4)"], ["proof (prove)\nusing this:\n  subst_domain \\<sigma>'' = X\n  ground (subst_range \\<sigma>'')\n  \\<lbrakk>subst_domain \\<I> \\<inter> subst_domain ?\\<xi> = {};\n   ground (subst_range ?\\<xi>)\\<rbrakk>\n  \\<Longrightarrow> ?t \\<cdot> \\<I> \\<cdot> ?\\<xi> =\n                    ?t \\<cdot> ?\\<xi> \\<cdot> \\<I>\n  subst_domain \\<I> \\<inter> X = {}\n\ngoal (1 subgoal):\n 1. \\<And>t.\n       t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = t \\<cdot> \\<sigma>'' \\<cdot> \\<I>", "by blast"], ["proof (state)\nthis:\n  ?t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = ?t \\<cdot> \\<sigma>'' \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "moreover"], ["proof (state)\nthis:\n  ?t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = ?t \\<cdot> \\<sigma>'' \\<cdot> \\<I>\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "have \"Unifier \\<sigma>'' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Unifier \\<sigma>'' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "using Unifier_dom_restrict[OF \\<sigma>'(1)] \\<sigma>''_def *"], ["proof (prove)\nusing this:\n  fv (s \\<cdot> \\<I>) \\<union> fv (t \\<cdot> \\<I>)\n  \\<subseteq> ?S \\<Longrightarrow>\n  Unifier (rm_vars (UNIV - ?S) \\<sigma>') (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n  \\<sigma>'' = rm_vars (UNIV - X) \\<sigma>'\n  fv (s \\<cdot> \\<I>) \\<subseteq> X\n  fv (t \\<cdot> \\<I>) \\<subseteq> X\n\ngoal (1 subgoal):\n 1. Unifier \\<sigma>'' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "by blast"], ["proof (state)\nthis:\n  Unifier \\<sigma>'' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "ultimately"], ["proof (chain)\npicking this:\n  ?t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = ?t \\<cdot> \\<sigma>'' \\<cdot> \\<I>\n  Unifier \\<sigma>'' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)", "show ?thesis"], ["proof (prove)\nusing this:\n  ?t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = ?t \\<cdot> \\<sigma>'' \\<cdot> \\<I>\n  Unifier \\<sigma>'' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "using **"], ["proof (prove)\nusing this:\n  ?t \\<cdot> \\<I> \\<cdot> \\<sigma>'' = ?t \\<cdot> \\<sigma>'' \\<cdot> \\<I>\n  Unifier \\<sigma>'' (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n  subst_domain \\<sigma>'' = X\n  ground (subst_range \\<sigma>'')\n\ngoal (1 subgoal):\n 1. \\<exists>\\<delta>.\n       subst_domain \\<delta> = X \\<and>\n       ground (subst_range \\<delta>) \\<and>\n       Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)", "by auto"], ["proof (state)\nthis:\n  \\<exists>\\<delta>.\n     subst_domain \\<delta> = X \\<and>\n     ground (subst_range \\<delta>) \\<and>\n     Unifier \\<I> (s \\<cdot> \\<delta>) (t \\<cdot> \\<delta>)\n\ngoal:\nNo subgoals!", "qed"], ["", "text \\<open>\n  The \"inequality lemma\": This lemma gives sufficient syntactic conditions for finding substitutions\n  \\<open>\\<theta>\\<close> under which terms \\<open>s\\<close> and \\<open>t\\<close> are not unifiable.\n\n  This is useful later when establishing the typing results since we there want to find well-typed\n  solutions to inequality constraints / \"negative checks\" constraints, and this lemma gives\n  conditions for protocols under which such constraints are well-typed satisfiable if satisfiable.\n\\<close>"], ["", "lemma sat_ineq_subterm_inj_subst:\n  fixes \\<theta> \\<I> \\<delta>::\"('f,'v) subst\"\n  assumes \\<theta>: \"subterm_inj_on \\<theta> (subst_domain \\<theta>)\"\n             \"ground (subst_range \\<theta>)\"\n             \"subst_domain \\<theta> \\<inter> X = {}\"\n             \"subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<inter> (subterms s \\<union> subterms t) = {}\"\n             \"(fv s \\<union> fv t) - subst_domain \\<theta> \\<subseteq> X\"\n  and tfr: \"(\\<forall>x \\<in> (fv s \\<union> fv t) - X. \\<exists>c. \\<theta> x = Fun c []) \\<or>\n            (\\<forall>f U. Fun f U \\<in> subterms s \\<union> subterms t \\<longrightarrow> U = [] \\<or> (\\<exists>u \\<in> set U. u \\<notin> Var ` X))\"\n  and \\<I>: \"\\<forall>\\<delta>::('f,'v) subst. subst_domain \\<delta> = X \\<and> ground (subst_range \\<delta>) \\<longrightarrow> s \\<cdot> \\<delta> \\<cdot> \\<I> \\<noteq> t \\<cdot> \\<delta> \\<cdot> \\<I>\"\n         \"(fv s \\<union> fv t) - X \\<subseteq> subst_domain \\<I>\" \"subst_domain \\<I> \\<inter> X = {}\" \"ground (subst_range \\<I>)\"\n         \"subst_domain \\<I> = subst_domain \\<theta>\"\n  and \\<delta>: \"subst_domain \\<delta> = X\" \"ground (subst_range \\<delta>)\"\n  shows \"s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq> t \\<cdot> \\<delta> \\<cdot> \\<theta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "have \"\\<forall>\\<sigma>. \\<not>Unifier \\<sigma> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>\\<sigma>.\n       s \\<cdot> \\<I> \\<cdot> \\<sigma> \\<noteq>\n       t \\<cdot> \\<I> \\<cdot> \\<sigma>", "by (metis \\<I>(1) sat_ineq_subterm_inj_subst_aux[OF _ \\<I>(4,2,3)])"], ["proof (state)\nthis:\n  \\<forall>\\<sigma>.\n     s \\<cdot> \\<I> \\<cdot> \\<sigma> \\<noteq>\n     t \\<cdot> \\<I> \\<cdot> \\<sigma>\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "hence \"\\<not>Unifier \\<delta> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\""], ["proof (prove)\nusing this:\n  \\<forall>\\<sigma>.\n     s \\<cdot> \\<I> \\<cdot> \\<sigma> \\<noteq>\n     t \\<cdot> \\<I> \\<cdot> \\<sigma>\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<theta> \\<cdot> \\<delta> \\<noteq>\n    t \\<cdot> \\<theta> \\<cdot> \\<delta>", "using inj_subst_unif_consts[OF \\<theta>(1) _ \\<theta>(4,2,3) \\<I>(4,5)]\n          inj_subst_unif_comp_terms[OF \\<theta>(1,2,4,5) _ \\<I>(4,5)]\n          tfr"], ["proof (prove)\nusing this:\n  \\<forall>\\<sigma>.\n     s \\<cdot> \\<I> \\<cdot> \\<sigma> \\<noteq>\n     t \\<cdot> \\<I> \\<cdot> \\<sigma>\n  \\<lbrakk>\\<forall>x\\<in>fv s \\<union> fv t - X.\n              \\<exists>c. \\<theta> x = Fun c [];\n   Unifier ?\\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> \\<exists>\\<delta>.\n                       Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n  \\<lbrakk>\\<forall>f U.\n              Fun f U \\<in> subterms s \\<union> subterms t \\<longrightarrow>\n              U = [] \\<or> (\\<exists>u\\<in>set U. u \\<notin> Var ` X);\n   Unifier ?\\<sigma> (s \\<cdot> \\<theta>) (t \\<cdot> \\<theta>)\\<rbrakk>\n  \\<Longrightarrow> \\<exists>\\<delta>.\n                       Unifier \\<delta> (s \\<cdot> \\<I>) (t \\<cdot> \\<I>)\n  (\\<forall>x\\<in>fv s \\<union> fv t - X.\n      \\<exists>c. \\<theta> x = Fun c []) \\<or>\n  (\\<forall>f U.\n      Fun f U \\<in> subterms s \\<union> subterms t \\<longrightarrow>\n      U = [] \\<or> (\\<exists>u\\<in>set U. u \\<notin> Var ` X))\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<theta> \\<cdot> \\<delta> \\<noteq>\n    t \\<cdot> \\<theta> \\<cdot> \\<delta>", "by metis"], ["proof (state)\nthis:\n  s \\<cdot> \\<theta> \\<cdot> \\<delta> \\<noteq>\n  t \\<cdot> \\<theta> \\<cdot> \\<delta>\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "moreover"], ["proof (state)\nthis:\n  s \\<cdot> \\<theta> \\<cdot> \\<delta> \\<noteq>\n  t \\<cdot> \\<theta> \\<cdot> \\<delta>\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "have \"subst_domain \\<delta> \\<inter> subst_domain \\<theta> = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> subst_domain \\<theta> = {}", "using \\<theta>(2,3) \\<delta>(1)"], ["proof (prove)\nusing this:\n  ground (subst_range \\<theta>)\n  subst_domain \\<theta> \\<inter> X = {}\n  subst_domain \\<delta> = X\n\ngoal (1 subgoal):\n 1. subst_domain \\<delta> \\<inter> subst_domain \\<theta> = {}", "by auto"], ["proof (state)\nthis:\n  subst_domain \\<delta> \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "ultimately"], ["proof (chain)\npicking this:\n  s \\<cdot> \\<theta> \\<cdot> \\<delta> \\<noteq>\n  t \\<cdot> \\<theta> \\<cdot> \\<delta>\n  subst_domain \\<delta> \\<inter> subst_domain \\<theta> = {}", "show ?thesis"], ["proof (prove)\nusing this:\n  s \\<cdot> \\<theta> \\<cdot> \\<delta> \\<noteq>\n  t \\<cdot> \\<theta> \\<cdot> \\<delta>\n  subst_domain \\<delta> \\<inter> subst_domain \\<theta> = {}\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "using \\<delta> subst_eq_if_disjoint_vars_ground[OF _ \\<theta>(2) \\<delta>(2)]"], ["proof (prove)\nusing this:\n  s \\<cdot> \\<theta> \\<cdot> \\<delta> \\<noteq>\n  t \\<cdot> \\<theta> \\<cdot> \\<delta>\n  subst_domain \\<delta> \\<inter> subst_domain \\<theta> = {}\n  subst_domain \\<delta> = X\n  ground (subst_range \\<delta>)\n  subst_domain \\<delta> \\<inter> subst_domain \\<theta> =\n  {} \\<Longrightarrow>\n  ?t \\<cdot> \\<delta> \\<cdot> \\<theta> =\n  ?t \\<cdot> \\<theta> \\<cdot> \\<delta>\n\ngoal (1 subgoal):\n 1. s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n    t \\<cdot> \\<delta> \\<cdot> \\<theta>", "by metis"], ["proof (state)\nthis:\n  s \\<cdot> \\<delta> \\<cdot> \\<theta> \\<noteq>\n  t \\<cdot> \\<delta> \\<cdot> \\<theta>\n\ngoal:\nNo subgoals!", "qed"], ["", "end"], ["", "lemma ineq_subterm_inj_cond_subst:\n  assumes \"X \\<inter> range_vars \\<theta> = {}\"\n  and \"\\<forall>f T. Fun f T \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<longrightarrow> T = [] \\<or> (\\<exists>u \\<in> set T. u \\<notin> Var`X)\"\n  shows \"\\<forall>f T. Fun f T \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<longrightarrow> T = [] \\<or> (\\<exists>u \\<in> set T. u \\<notin> Var`X)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "proof (intro allI impI)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "let ?M = \"\\<lambda>S. subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "let ?N = \"\\<lambda>S. subterms\\<^sub>s\\<^sub>e\\<^sub>t (\\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>))\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "fix f T"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "assume \"Fun f T \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>)\""], ["proof (state)\nthis:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "hence 1: \"Fun f T \\<in> ?M S \\<or> Fun f T \\<in> ?N S\""], ["proof (prove)\nusing this:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<theta> \\<or>\n    Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>)", "using subterms_subst[of _ \\<theta>]"], ["proof (prove)\nusing this:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>\n  subterms (?t \\<cdot> \\<theta>) =\n  (subterms ?t \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta>) \\<union>\n  subterms\\<^sub>s\\<^sub>e\\<^sub>t\n   (\\<theta> ` (fv ?t \\<inter> subst_domain \\<theta>))\n\ngoal (1 subgoal):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<theta> \\<or>\n    Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>)", "by auto"], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta> \\<or>\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  \\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "have 2: \"Fun f T \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) \\<Longrightarrow> \\<forall>u \\<in> set T. u \\<notin> Var`X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    subst_range \\<theta> \\<Longrightarrow>\n    \\<forall>u\\<in>set T. u \\<notin> Var ` X", "using fv_subset_subterms[of \"Fun f T\" \"subst_range \\<theta>\"] assms(1)"], ["proof (prove)\nusing this:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<theta> \\<Longrightarrow>\n  fv (Fun f T) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    subst_range \\<theta> \\<Longrightarrow>\n    \\<forall>u\\<in>set T. u \\<notin> Var ` X", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<theta> \\<Longrightarrow>\n  fv (Fun f T) \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)\n  X \\<inter> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>) = {}\n\ngoal (1 subgoal):\n 1. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    subst_range \\<theta> \\<Longrightarrow>\n    \\<forall>u\\<in>set T. u \\<notin> Var ` X", "by force"], ["proof (state)\nthis:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<theta> \\<Longrightarrow>\n  \\<forall>u\\<in>set T. u \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "have 3: \"\\<forall>x \\<in> subst_domain \\<theta>. \\<theta> x \\<notin> Var`X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>x\\<in>subst_domain \\<theta>. \\<theta> x \\<notin> Var ` X", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n       \\<theta> x \\<notin> Var ` X", "fix x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n       \\<theta> x \\<notin> Var ` X", "assume \"x \\<in> subst_domain \\<theta>\""], ["proof (state)\nthis:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n       \\<theta> x \\<notin> Var ` X", "hence \"fv (\\<theta> x) \\<subseteq> range_vars \\<theta>\""], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x) \\<subseteq> range_vars \\<theta>", "using subst_dom_vars_in_subst subst_fv_imgI"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  ?v \\<in> subst_domain ?s \\<Longrightarrow> ?s ?v \\<noteq> Var ?v\n  ?\\<sigma> ?v \\<noteq> Var ?v \\<Longrightarrow>\n  fv (?\\<sigma> ?v) \\<subseteq> range_vars ?\\<sigma>\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x) \\<subseteq> range_vars \\<theta>", "unfolding range_vars_alt_def"], ["proof (prove)\nusing this:\n  x \\<in> subst_domain \\<theta>\n  ?v \\<in> subst_domain ?s \\<Longrightarrow> ?s ?v \\<noteq> Var ?v\n  ?\\<sigma> ?v \\<noteq> Var ?v \\<Longrightarrow>\n  fv (?\\<sigma> ?v)\n  \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range ?\\<sigma>)\n\ngoal (1 subgoal):\n 1. fv (\\<theta> x)\n    \\<subseteq> fv\\<^sub>s\\<^sub>e\\<^sub>t (subst_range \\<theta>)", "by auto"], ["proof (state)\nthis:\n  fv (\\<theta> x) \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> subst_domain \\<theta> \\<Longrightarrow>\n       \\<theta> x \\<notin> Var ` X", "thus \"\\<theta> x \\<notin> Var`X\""], ["proof (prove)\nusing this:\n  fv (\\<theta> x) \\<subseteq> range_vars \\<theta>\n\ngoal (1 subgoal):\n 1. \\<theta> x \\<notin> Var ` X", "using assms(1)"], ["proof (prove)\nusing this:\n  fv (\\<theta> x) \\<subseteq> range_vars \\<theta>\n  X \\<inter> range_vars \\<theta> = {}\n\ngoal (1 subgoal):\n 1. \\<theta> x \\<notin> Var ` X", "by auto"], ["proof (state)\nthis:\n  \\<theta> x \\<notin> Var ` X\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>x\\<in>subst_domain \\<theta>. \\<theta> x \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. \\<And>f T.\n       Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n       S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t \\<theta> \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)", "show \"T = [] \\<or> (\\<exists>s \\<in> set T. s \\<notin> Var`X)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "using 1"], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta> \\<or>\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  \\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<theta> \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> `\n    (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter>\n     subst_domain \\<theta>) \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "assume \"Fun f T \\<in> ?M S\""], ["proof (state)\nthis:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>\n\ngoal (2 subgoals):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<theta> \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> `\n    (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter>\n     subst_domain \\<theta>) \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "then"], ["proof (chain)\npicking this:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>", "obtain u where u: \"u \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S\" \"u \\<cdot> \\<theta> = Fun f T\""], ["proof (prove)\nusing this:\n  Fun f T\n  \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n        \\<theta>\n\ngoal (1 subgoal):\n 1. (\\<And>u.\n        \\<lbrakk>u \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t S;\n         u \\<cdot> \\<theta> = Fun f T\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by fastforce"], ["proof (state)\nthis:\n  u \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t S\n  u \\<cdot> \\<theta> = Fun f T\n\ngoal (2 subgoals):\n 1. Fun f T\n    \\<in> subterms\\<^sub>s\\<^sub>e\\<^sub>t S \\<cdot>\\<^sub>s\\<^sub>e\\<^sub>t\n          \\<theta> \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> `\n    (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter>\n     subst_domain \\<theta>) \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "proof (cases u)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x1.\n       u = Var x1 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "case (Var x)"], ["proof (state)\nthis:\n  u = Var x\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       u = Var x1 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "hence \"Fun f T \\<in> subst_range \\<theta>\""], ["proof (prove)\nusing this:\n  u = Var x\n\ngoal (1 subgoal):\n 1. Fun f T \\<in> subst_range \\<theta>", "using u(2)"], ["proof (prove)\nusing this:\n  u = Var x\n  u \\<cdot> \\<theta> = Fun f T\n\ngoal (1 subgoal):\n 1. Fun f T \\<in> subst_range \\<theta>", "by (simp add: subst_domain_def)"], ["proof (state)\nthis:\n  Fun f T \\<in> subst_range \\<theta>\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       u = Var x1 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "hence \"\\<forall>u \\<in> set T. u \\<notin> Var`X\""], ["proof (prove)\nusing this:\n  Fun f T \\<in> subst_range \\<theta>\n\ngoal (1 subgoal):\n 1. \\<forall>u\\<in>set T. u \\<notin> Var ` X", "using 2"], ["proof (prove)\nusing this:\n  Fun f T \\<in> subst_range \\<theta>\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<theta> \\<Longrightarrow>\n  \\<forall>u\\<in>set T. u \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. \\<forall>u\\<in>set T. u \\<notin> Var ` X", "by force"], ["proof (state)\nthis:\n  \\<forall>u\\<in>set T. u \\<notin> Var ` X\n\ngoal (2 subgoals):\n 1. \\<And>x1.\n       u = Var x1 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<forall>u\\<in>set T. u \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "by auto"], ["proof (state)\nthis:\n  T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "case (Fun g S)"], ["proof (state)\nthis:\n  u = Fun g S\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "hence \"S = [] \\<or> (\\<exists>u \\<in> set S. u \\<notin> Var`X)\""], ["proof (prove)\nusing this:\n  u = Fun g S\n\ngoal (1 subgoal):\n 1. S = [] \\<or> (\\<exists>u\\<in>set S. u \\<notin> Var ` X)", "using assms(2) u(1)"], ["proof (prove)\nusing this:\n  u = Fun g S\n  \\<forall>f T.\n     Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t S \\<longrightarrow>\n     T = [] \\<or> (\\<exists>u\\<in>set T. u \\<notin> Var ` X)\n  u \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t S\n\ngoal (1 subgoal):\n 1. S = [] \\<or> (\\<exists>u\\<in>set S. u \\<notin> Var ` X)", "by metis"], ["proof (state)\nthis:\n  S = [] \\<or> (\\<exists>u\\<in>set S. u \\<notin> Var ` X)\n\ngoal (1 subgoal):\n 1. \\<And>x21 x22.\n       u = Fun x21 x22 \\<Longrightarrow>\n       T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "thus ?thesis"], ["proof (prove)\nusing this:\n  S = [] \\<or> (\\<exists>u\\<in>set S. u \\<notin> Var ` X)\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. S = [] \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. \\<exists>u\\<in>set S. u \\<notin> Var ` X \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "assume \"S = []\""], ["proof (state)\nthis:\n  S = []\n\ngoal (2 subgoals):\n 1. S = [] \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n 2. \\<exists>u\\<in>set S. u \\<notin> Var ` X \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "thus ?thesis"], ["proof (prove)\nusing this:\n  S = []\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "using u(2) Fun"], ["proof (prove)\nusing this:\n  S = []\n  u \\<cdot> \\<theta> = Fun f T\n  u = Fun g S\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "by simp"], ["proof (state)\nthis:\n  T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n\ngoal (1 subgoal):\n 1. \\<exists>u\\<in>set S. u \\<notin> Var ` X \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<exists>u\\<in>set S. u \\<notin> Var ` X \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "assume \"\\<exists>u \\<in> set S. u \\<notin> Var`X\""], ["proof (state)\nthis:\n  \\<exists>u\\<in>set S. u \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. \\<exists>u\\<in>set S. u \\<notin> Var ` X \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "then"], ["proof (chain)\npicking this:\n  \\<exists>u\\<in>set S. u \\<notin> Var ` X", "obtain u' where u': \"u' \\<in> set S\" \"u' \\<notin> Var`X\""], ["proof (prove)\nusing this:\n  \\<exists>u\\<in>set S. u \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. (\\<And>u'.\n        \\<lbrakk>u' \\<in> set S; u' \\<notin> Var ` X\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by moura"], ["proof (state)\nthis:\n  u' \\<in> set S\n  u' \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. \\<exists>u\\<in>set S. u \\<notin> Var ` X \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "hence \"u' \\<cdot> \\<theta> \\<in> set T\""], ["proof (prove)\nusing this:\n  u' \\<in> set S\n  u' \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. u' \\<cdot> \\<theta> \\<in> set T", "using u(2) Fun"], ["proof (prove)\nusing this:\n  u' \\<in> set S\n  u' \\<notin> Var ` X\n  u \\<cdot> \\<theta> = Fun f T\n  u = Fun g S\n\ngoal (1 subgoal):\n 1. u' \\<cdot> \\<theta> \\<in> set T", "by auto"], ["proof (state)\nthis:\n  u' \\<cdot> \\<theta> \\<in> set T\n\ngoal (1 subgoal):\n 1. \\<exists>u\\<in>set S. u \\<notin> Var ` X \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "thus ?thesis"], ["proof (prove)\nusing this:\n  u' \\<cdot> \\<theta> \\<in> set T\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "using u'(2) 3"], ["proof (prove)\nusing this:\n  u' \\<cdot> \\<theta> \\<in> set T\n  u' \\<notin> Var ` X\n  \\<forall>x\\<in>subst_domain \\<theta>. \\<theta> x \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "by (cases u') force+"], ["proof (state)\nthis:\n  T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n\ngoal (1 subgoal):\n 1. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> `\n    (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter>\n     subst_domain \\<theta>) \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> `\n    (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter>\n     subst_domain \\<theta>) \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "assume \"Fun f T \\<in> ?N S\""], ["proof (state)\nthis:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  \\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n    \\<theta> `\n    (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter>\n     subst_domain \\<theta>) \\<Longrightarrow>\n    T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "thus ?thesis"], ["proof (prove)\nusing this:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  \\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>)\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "using 2"], ["proof (prove)\nusing this:\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  \\<theta> ` (fv\\<^sub>s\\<^sub>e\\<^sub>t S \\<inter> subst_domain \\<theta>)\n  Fun f T \\<sqsubseteq>\\<^sub>s\\<^sub>e\\<^sub>t\n  subst_range \\<theta> \\<Longrightarrow>\n  \\<forall>u\\<in>set T. u \\<notin> Var ` X\n\ngoal (1 subgoal):\n 1. T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)", "by force"], ["proof (state)\nthis:\n  T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  T = [] \\<or> (\\<exists>s\\<in>set T. s \\<notin> Var ` X)\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \\<open>Lemmata: Sufficient Conditions for Term Matching\\<close>"], ["", "text \\<open>Injective substitutions from variables to variables are invertible\\<close>"], ["", "definition subst_var_inv where\n  \"subst_var_inv \\<delta> X \\<equiv> (\\<lambda>x. if Var x \\<in> \\<delta> ` X then Var ((inv_into X \\<delta>) (Var x)) else Var x)\""], ["", "lemma inj_var_ran_subst_is_invertible:\n  assumes \\<delta>_inj_on_t: \"inj_on \\<delta> (fv t)\"\n    and \\<delta>_var_on_t: \"\\<delta> ` fv t \\<subseteq> range Var\"\n  shows \"t = t \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t = t \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. t = t \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)", "have \"\\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x\" when x: \"x \\<in> fv t\" for x"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x", "obtain y where y: \"\\<delta> x = Var y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>y. \\<delta> x = Var y \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using x \\<delta>_var_on_t"], ["proof (prove)\nusing this:\n  x \\<in> fv t\n  \\<delta> ` fv t \\<subseteq> range Var\n\ngoal (1 subgoal):\n 1. (\\<And>y. \\<delta> x = Var y \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  \\<delta> x = Var y\n\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x", "hence \"Var y \\<in> \\<delta> ` (fv t)\""], ["proof (prove)\nusing this:\n  \\<delta> x = Var y\n\ngoal (1 subgoal):\n 1. Var y \\<in> \\<delta> ` fv t", "using x"], ["proof (prove)\nusing this:\n  \\<delta> x = Var y\n  x \\<in> fv t\n\ngoal (1 subgoal):\n 1. Var y \\<in> \\<delta> ` fv t", "by simp"], ["proof (state)\nthis:\n  Var y \\<in> \\<delta> ` fv t\n\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x", "thus ?thesis"], ["proof (prove)\nusing this:\n  Var y \\<in> \\<delta> ` fv t\n\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x", "using y inv_into_f_eq[OF \\<delta>_inj_on_t x y]"], ["proof (prove)\nusing this:\n  Var y \\<in> \\<delta> ` fv t\n  \\<delta> x = Var y\n  inv_into (fv t) \\<delta> (Var y) = x\n\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x", "unfolding subst_var_inv_def"], ["proof (prove)\nusing this:\n  Var y \\<in> \\<delta> ` fv t\n  \\<delta> x = Var y\n  inv_into (fv t) \\<delta> (Var y) = x\n\ngoal (1 subgoal):\n 1. \\<delta> x \\<cdot>\n    (\\<lambda>x.\n        if Var x \\<in> \\<delta> ` fv t\n        then Var (inv_into (fv t) \\<delta> (Var x)) else Var x) =\n    Var x", "by simp"], ["proof (state)\nthis:\n  \\<delta> x \\<cdot> subst_var_inv \\<delta> (fv t) = Var x\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  ?x \\<in> fv t \\<Longrightarrow>\n  \\<delta> ?x \\<cdot> subst_var_inv \\<delta> (fv t) = Var ?x\n\ngoal (1 subgoal):\n 1. t = t \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)", "thus ?thesis"], ["proof (prove)\nusing this:\n  ?x \\<in> fv t \\<Longrightarrow>\n  \\<delta> ?x \\<cdot> subst_var_inv \\<delta> (fv t) = Var ?x\n\ngoal (1 subgoal):\n 1. t = t \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)", "by (simp add: subst_compose_def trm_subst_ident'')"], ["proof (state)\nthis:\n  t = t \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)\n\ngoal:\nNo subgoals!", "qed"], ["", "text \\<open>Sufficient conditions for matching unifiable terms\\<close>"], ["", "lemma inj_var_ran_unifiable_has_subst_match:\n  assumes \"t \\<cdot> \\<delta> = s \\<cdot> \\<delta>\" \"inj_on \\<delta> (fv t)\" \"\\<delta> ` fv t \\<subseteq> range Var\"\n  shows \"t = s \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. t = s \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)", "using assms inj_var_ran_subst_is_invertible"], ["proof (prove)\nusing this:\n  Unifier \\<delta> t s\n  inj_on \\<delta> (fv t)\n  \\<delta> ` fv t \\<subseteq> range Var\n  \\<lbrakk>inj_on ?\\<delta> (fv ?t);\n   ?\\<delta> ` fv ?t \\<subseteq> range Var\\<rbrakk>\n  \\<Longrightarrow> ?t =\n                    ?t \\<cdot>\n                    ?\\<delta> \\<circ>\\<^sub>s\n                    subst_var_inv ?\\<delta> (fv ?t)\n\ngoal (1 subgoal):\n 1. t = s \\<cdot> \\<delta> \\<circ>\\<^sub>s subst_var_inv \\<delta> (fv t)", "by fastforce"], ["", "end"]]}