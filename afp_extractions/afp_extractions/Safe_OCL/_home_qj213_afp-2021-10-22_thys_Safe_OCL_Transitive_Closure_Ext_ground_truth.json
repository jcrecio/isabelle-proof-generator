{"file_name": "/home/qj213/afp-2021-10-22/thys/Safe_OCL/Transitive_Closure_Ext.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Safe_OCL", "problem_names": ["lemma rtranclp_eq_rtranclp [iff]:\n  \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* = P\\<^sup>*\\<^sup>*\"", "lemma tranclp_eq_rtranclp [iff]:\n  \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ = P\\<^sup>*\\<^sup>*\"", "lemma rtranclp_eq_rtranclp' [iff]:\n  \"(\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* = P\\<^sup>*\\<^sup>*\"", "lemma tranclp_tranclp_to_tranclp_r:\n  assumes \"(\\<And>x y z. R\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> R y z \\<Longrightarrow> P x \\<Longrightarrow> P z \\<Longrightarrow> P y)\"\n  assumes \"R\\<^sup>+\\<^sup>+ x y\" and \"R\\<^sup>+\\<^sup>+ y z\"\n  assumes \"P x\" and \"P z\"\n  shows \"P y\"", "lemma preserve_tranclp:\n  assumes \"\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)\"\n  assumes \"R\\<^sup>+\\<^sup>+ x y\"\n  shows \"S\\<^sup>+\\<^sup>+ (f x) (f y)\"", "lemma preserve_rtranclp:\n  \"(\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)) \\<Longrightarrow>\n   R\\<^sup>*\\<^sup>* x y \\<Longrightarrow> S\\<^sup>*\\<^sup>* (f x) (f y)\"", "lemma preserve_rtranclp':\n  \"(\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)) \\<Longrightarrow>\n   (\\<And>y. S (f y) (g y)) \\<Longrightarrow>\n   R\\<^sup>*\\<^sup>* x y \\<Longrightarrow> S\\<^sup>*\\<^sup>* (f x) (g y)\"", "lemma preserve_rtranclp'':\n  \"(\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)) \\<Longrightarrow>\n   (\\<And>y. S (f y) (g y)) \\<Longrightarrow>\n   R\\<^sup>*\\<^sup>* x y \\<Longrightarrow> S\\<^sup>+\\<^sup>+ (f x) (g y)\"", "lemma reflect_tranclp:\n  assumes refl_f: \"\\<And>x y. S (f x) (f y) \\<Longrightarrow> R x y\"\n  assumes bij_f: \"bij_on_trancl S f\"\n  assumes prem: \"S\\<^sup>+\\<^sup>+ (f x) (f y)\"\n  shows \"R\\<^sup>+\\<^sup>+ x y\"", "lemma reflect_rtranclp:\n  \"(\\<And>x y. S (f x) (f y) \\<Longrightarrow> R x y) \\<Longrightarrow>\n   bij_on_trancl S f \\<Longrightarrow>\n   S\\<^sup>*\\<^sup>* (f x) (f y) \\<Longrightarrow> R\\<^sup>*\\<^sup>* x y\""], "translations": [["", "lemma rtranclp_eq_rtranclp [iff]:\n  \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* = P\\<^sup>*\\<^sup>*\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* = P\\<^sup>*\\<^sup>*", "proof (intro ext iffI)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x xa", "fix x y"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x xa", "have \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow> P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n    P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y", "by (rule mono_rtranclp) simp"], ["proof (state)\nthis:\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n  P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y\n\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x xa", "thus \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<Longrightarrow> P\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\nusing this:\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n  P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n    P\\<^sup>*\\<^sup>* x y", "by simp"], ["proof (state)\nthis:\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n  P\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x xa", "show \"P\\<^sup>*\\<^sup>* x y \\<Longrightarrow> (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n    (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y", "by (metis (no_types, lifting) mono_rtranclp)"], ["proof (state)\nthis:\n  P\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma tranclp_eq_rtranclp [iff]:\n  \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ = P\\<^sup>*\\<^sup>*\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ = P\\<^sup>*\\<^sup>*", "proof (intro ext iffI)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x xa", "fix x y"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x xa", "have \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow> P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n    P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y", "by (rule mono_rtranclp) simp"], ["proof (state)\nthis:\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n  P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y\n\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x xa", "thus \"(\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> P\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\nusing this:\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n  P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x y \\<Longrightarrow>\n    P\\<^sup>*\\<^sup>* x y", "using tranclp_into_rtranclp"], ["proof (prove)\nusing this:\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n  P\\<^sup>=\\<^sup>=\\<^sup>*\\<^sup>* x y\n  ?r\\<^sup>+\\<^sup>+ ?a ?b \\<Longrightarrow> ?r\\<^sup>*\\<^sup>* ?a ?b\n\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x y \\<Longrightarrow>\n    P\\<^sup>*\\<^sup>* x y", "by force"], ["proof (state)\nthis:\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x y \\<Longrightarrow>\n  P\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x xa", "show \"P\\<^sup>*\\<^sup>* x y \\<Longrightarrow> (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n    (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x y", "by (metis (mono_tags, lifting) mono_rtranclp rtranclpD tranclp.r_into_trancl)"], ["proof (state)\nthis:\n  P\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n  (\\<lambda>x y. P x y \\<or> x = y)\\<^sup>+\\<^sup>+ x y\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma rtranclp_eq_rtranclp' [iff]:\n  \"(\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* = P\\<^sup>*\\<^sup>*\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* =\n    P\\<^sup>*\\<^sup>*", "proof (intro ext iffI)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x xa", "fix x y"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x xa.\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x\n        xa \\<Longrightarrow>\n       P\\<^sup>*\\<^sup>* x xa\n 2. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x xa", "show \"(\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y \\<Longrightarrow> P\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x\n     y \\<Longrightarrow>\n    P\\<^sup>*\\<^sup>* x y", "by (metis (no_types, lifting) mono_rtranclp)"], ["proof (state)\nthis:\n  (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x\n   y \\<Longrightarrow>\n  P\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x xa", "assume \"P\\<^sup>*\\<^sup>* x y\""], ["proof (state)\nthis:\n  P\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x xa", "hence \"(inf P (\\<noteq>))\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\nusing this:\n  P\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. (inf P (\\<noteq>))\\<^sup>*\\<^sup>* x y", "by (simp add: rtranclp_r_diff_Id)"], ["proof (state)\nthis:\n  (inf P (\\<noteq>))\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x xa", "also"], ["proof (state)\nthis:\n  (inf P (\\<noteq>))\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x xa", "have \"(inf P (\\<noteq>))\\<^sup>*\\<^sup>* x y \\<longrightarrow> (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (inf P (\\<noteq>))\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n    (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y", "by (rule mono_rtranclp) simp"], ["proof (state)\nthis:\n  (inf P (\\<noteq>))\\<^sup>*\\<^sup>* x y \\<longrightarrow>\n  (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. \\<And>x xa.\n       P\\<^sup>*\\<^sup>* x xa \\<Longrightarrow>\n       (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x xa", "finally"], ["proof (chain)\npicking this:\n  (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y", "show \"P\\<^sup>*\\<^sup>* x y \\<Longrightarrow> (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\nusing this:\n  (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y\n\ngoal (1 subgoal):\n 1. P\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n    (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y", "by simp"], ["proof (state)\nthis:\n  P\\<^sup>*\\<^sup>* x y \\<Longrightarrow>\n  (\\<lambda>x y. P x y \\<and> x \\<noteq> y)\\<^sup>*\\<^sup>* x y\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma tranclp_tranclp_to_tranclp_r:\n  assumes \"(\\<And>x y z. R\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> R y z \\<Longrightarrow> P x \\<Longrightarrow> P z \\<Longrightarrow> P y)\"\n  assumes \"R\\<^sup>+\\<^sup>+ x y\" and \"R\\<^sup>+\\<^sup>+ y z\"\n  assumes \"P x\" and \"P z\"\n  shows \"P y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P y", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. P y", "have \"(\\<And>x y z. R\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> R y z \\<Longrightarrow> P x \\<Longrightarrow> P z \\<Longrightarrow> P y) \\<Longrightarrow>\n         R\\<^sup>+\\<^sup>+ y z \\<Longrightarrow> R\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> P x \\<longrightarrow> P z \\<longrightarrow> P y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y z.\n                \\<lbrakk>R\\<^sup>+\\<^sup>+ x y; R y z; P x; P z\\<rbrakk>\n                \\<Longrightarrow> P y;\n     R\\<^sup>+\\<^sup>+ y z; R\\<^sup>+\\<^sup>+ x y\\<rbrakk>\n    \\<Longrightarrow> P x \\<longrightarrow> P z \\<longrightarrow> P y", "by (erule tranclp_induct, auto) (meson tranclp_trans)"], ["proof (state)\nthis:\n  \\<lbrakk>\\<And>x y z.\n              \\<lbrakk>R\\<^sup>+\\<^sup>+ x y; R y z; P x; P z\\<rbrakk>\n              \\<Longrightarrow> P y;\n   R\\<^sup>+\\<^sup>+ y z; R\\<^sup>+\\<^sup>+ x y\\<rbrakk>\n  \\<Longrightarrow> P x \\<longrightarrow> P z \\<longrightarrow> P y\n\ngoal (1 subgoal):\n 1. P y", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>x y z.\n              \\<lbrakk>R\\<^sup>+\\<^sup>+ x y; R y z; P x; P z\\<rbrakk>\n              \\<Longrightarrow> P y;\n   R\\<^sup>+\\<^sup>+ y z; R\\<^sup>+\\<^sup>+ x y\\<rbrakk>\n  \\<Longrightarrow> P x \\<longrightarrow> P z \\<longrightarrow> P y\n\ngoal (1 subgoal):\n 1. P y", "using assms"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>x y z.\n              \\<lbrakk>R\\<^sup>+\\<^sup>+ x y; R y z; P x; P z\\<rbrakk>\n              \\<Longrightarrow> P y;\n   R\\<^sup>+\\<^sup>+ y z; R\\<^sup>+\\<^sup>+ x y\\<rbrakk>\n  \\<Longrightarrow> P x \\<longrightarrow> P z \\<longrightarrow> P y\n  \\<lbrakk>R\\<^sup>+\\<^sup>+ ?x ?y; R ?y ?z; P ?x; P ?z\\<rbrakk>\n  \\<Longrightarrow> P ?y\n  R\\<^sup>+\\<^sup>+ x y\n  R\\<^sup>+\\<^sup>+ y z\n  P x\n  P z\n\ngoal (1 subgoal):\n 1. P y", "by auto"], ["proof (state)\nthis:\n  P y\n\ngoal:\nNo subgoals!", "qed"], ["", "(*** Transitive Closure Preservation & Reflection ***************************)"], ["", "subsection \\<open>Transitive Closure Preservation\\<close>"], ["", "text \\<open>\n  A function @{text f} preserves @{text \"R\\<^sup>+\\<^sup>+\"} if it preserves @{text R}.\\<close>"], ["", "text \\<open>\n  The proof was derived from the accepted answer on the website\n  Stack Overflow that is available at\n  @{url \"https://stackoverflow.com/a/52573551/632199\"}\n  and provided with the permission of the author of the answer.\\<close>"], ["", "lemma preserve_tranclp:\n  assumes \"\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)\"\n  assumes \"R\\<^sup>+\\<^sup>+ x y\"\n  shows \"S\\<^sup>+\\<^sup>+ (f x) (f y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "define P where P: \"P = (\\<lambda>x y. S\\<^sup>+\\<^sup>+ (f x) (f y))\""], ["proof (state)\nthis:\n  P = (\\<lambda>x y. S\\<^sup>+\\<^sup>+ (f x) (f y))\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "define r where r: \"r = (\\<lambda>x y. S (f x) (f y))\""], ["proof (state)\nthis:\n  r = (\\<lambda>x y. S (f x) (f y))\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "have \"r\\<^sup>+\\<^sup>+ x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. r\\<^sup>+\\<^sup>+ x y", "by (insert assms r; erule tranclp_trans_induct; auto)"], ["proof (state)\nthis:\n  r\\<^sup>+\\<^sup>+ x y\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "moreover"], ["proof (state)\nthis:\n  r\\<^sup>+\\<^sup>+ x y\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "have \"\\<And>x y. r x y \\<Longrightarrow> P x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x y. r x y \\<Longrightarrow> P x y", "unfolding P r"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x y. S (f x) (f y) \\<Longrightarrow> S\\<^sup>+\\<^sup>+ (f x) (f y)", "by simp"], ["proof (state)\nthis:\n  r ?x ?y \\<Longrightarrow> P ?x ?y\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "moreover"], ["proof (state)\nthis:\n  r ?x ?y \\<Longrightarrow> P ?x ?y\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "have \"\\<And>x y z. r\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> P x y \\<Longrightarrow> r\\<^sup>+\\<^sup>+ y z \\<Longrightarrow> P y z \\<Longrightarrow> P x z\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x y z.\n       \\<lbrakk>r\\<^sup>+\\<^sup>+ x y; P x y; r\\<^sup>+\\<^sup>+ y z;\n        P y z\\<rbrakk>\n       \\<Longrightarrow> P x z", "unfolding P"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x y z.\n       \\<lbrakk>r\\<^sup>+\\<^sup>+ x y; S\\<^sup>+\\<^sup>+ (f x) (f y);\n        r\\<^sup>+\\<^sup>+ y z; S\\<^sup>+\\<^sup>+ (f y) (f z)\\<rbrakk>\n       \\<Longrightarrow> S\\<^sup>+\\<^sup>+ (f x) (f z)", "by auto"], ["proof (state)\nthis:\n  \\<lbrakk>r\\<^sup>+\\<^sup>+ ?x ?y; P ?x ?y; r\\<^sup>+\\<^sup>+ ?y ?z;\n   P ?y ?z\\<rbrakk>\n  \\<Longrightarrow> P ?x ?z\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "ultimately"], ["proof (chain)\npicking this:\n  r\\<^sup>+\\<^sup>+ x y\n  r ?x ?y \\<Longrightarrow> P ?x ?y\n  \\<lbrakk>r\\<^sup>+\\<^sup>+ ?x ?y; P ?x ?y; r\\<^sup>+\\<^sup>+ ?y ?z;\n   P ?y ?z\\<rbrakk>\n  \\<Longrightarrow> P ?x ?z", "have \"P x y\""], ["proof (prove)\nusing this:\n  r\\<^sup>+\\<^sup>+ x y\n  r ?x ?y \\<Longrightarrow> P ?x ?y\n  \\<lbrakk>r\\<^sup>+\\<^sup>+ ?x ?y; P ?x ?y; r\\<^sup>+\\<^sup>+ ?y ?z;\n   P ?y ?z\\<rbrakk>\n  \\<Longrightarrow> P ?x ?z\n\ngoal (1 subgoal):\n 1. P x y", "by (rule tranclp_trans_induct)"], ["proof (state)\nthis:\n  P x y\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "with P"], ["proof (chain)\npicking this:\n  P = (\\<lambda>x y. S\\<^sup>+\\<^sup>+ (f x) (f y))\n  P x y", "show ?thesis"], ["proof (prove)\nusing this:\n  P = (\\<lambda>x y. S\\<^sup>+\\<^sup>+ (f x) (f y))\n  P x y\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "by simp"], ["proof (state)\nthis:\n  S\\<^sup>+\\<^sup>+ (f x) (f y)\n\ngoal:\nNo subgoals!", "qed"], ["", "text \\<open>\n  A function @{text f} preserves @{text \"R\\<^sup>*\\<^sup>*\"} if it preserves @{text R}.\\<close>"], ["", "lemma preserve_rtranclp:\n  \"(\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)) \\<Longrightarrow>\n   R\\<^sup>*\\<^sup>* x y \\<Longrightarrow> S\\<^sup>*\\<^sup>* (f x) (f y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y);\n     R\\<^sup>*\\<^sup>* x y\\<rbrakk>\n    \\<Longrightarrow> S\\<^sup>*\\<^sup>* (f x) (f y)", "unfolding Nitpick.rtranclp_unfold"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y);\n     x = y \\<or> R\\<^sup>+\\<^sup>+ x y\\<rbrakk>\n    \\<Longrightarrow> f x = f y \\<or> S\\<^sup>+\\<^sup>+ (f x) (f y)", "by (metis preserve_tranclp)"], ["", "text \\<open>\n  If one needs to prove that @{text \"(f x)\"} and @{text \"(g y)\"}\n  are related through @{text \"S\\<^sup>*\\<^sup>*\"} then one can use the previous\n  lemma and add a one more step from @{text \"(f y)\"} to @{text \"(g y)\"}.\\<close>"], ["", "lemma preserve_rtranclp':\n  \"(\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)) \\<Longrightarrow>\n   (\\<And>y. S (f y) (g y)) \\<Longrightarrow>\n   R\\<^sup>*\\<^sup>* x y \\<Longrightarrow> S\\<^sup>*\\<^sup>* (f x) (g y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y);\n     \\<And>y. S (f y) (g y); R\\<^sup>*\\<^sup>* x y\\<rbrakk>\n    \\<Longrightarrow> S\\<^sup>*\\<^sup>* (f x) (g y)", "by (metis preserve_rtranclp rtranclp.rtrancl_into_rtrancl)"], ["", "lemma preserve_rtranclp'':\n  \"(\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y)) \\<Longrightarrow>\n   (\\<And>y. S (f y) (g y)) \\<Longrightarrow>\n   R\\<^sup>*\\<^sup>* x y \\<Longrightarrow> S\\<^sup>+\\<^sup>+ (f x) (g y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y);\n     \\<And>y. S (f y) (g y); R\\<^sup>*\\<^sup>* x y\\<rbrakk>\n    \\<Longrightarrow> S\\<^sup>+\\<^sup>+ (f x) (g y)", "apply (rule_tac ?b=\"f y\" in rtranclp_into_tranclp1, auto)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y. R x y \\<Longrightarrow> S (f x) (f y);\n     \\<And>y. S (f y) (g y); R\\<^sup>*\\<^sup>* x y\\<rbrakk>\n    \\<Longrightarrow> S\\<^sup>*\\<^sup>* (f x) (f y)", "by (rule preserve_rtranclp, auto)"], ["", "subsection \\<open>Transitive Closure Reflection\\<close>"], ["", "text \\<open>\n  A function @{text f} reflects @{text \"S\\<^sup>+\\<^sup>+\"} if it reflects\n  @{text S} and is bijective on @{text \"S\\<^sup>+\\<^sup>+\"}.\\<close>"], ["", "text \\<open>\n  The proof was derived from the accepted answer on the website\n  Stack Overflow that is available at\n  @{url \"https://stackoverflow.com/a/52573551/632199\"}\n  and provided with the permission of the author of the answer.\\<close>"], ["", "lemma reflect_tranclp:\n  assumes refl_f: \"\\<And>x y. S (f x) (f y) \\<Longrightarrow> R x y\"\n  assumes bij_f: \"bij_on_trancl S f\"\n  assumes prem: \"S\\<^sup>+\\<^sup>+ (f x) (f y)\"\n  shows \"R\\<^sup>+\\<^sup>+ x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "define B where B: \"B = range f\""], ["proof (state)\nthis:\n  B = range f\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "define g where g: \"g = the_inv_into UNIV f\""], ["proof (state)\nthis:\n  g = the_inv f\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "define gr where gr: \"gr = restrict g B\""], ["proof (state)\nthis:\n  gr = restrict g B\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "define P where P: \"P = (\\<lambda>x y. x \\<in> B \\<longrightarrow> y \\<in> B \\<longrightarrow> R\\<^sup>+\\<^sup>+ (gr x) (gr y))\""], ["proof (state)\nthis:\n  P =\n  (\\<lambda>x y.\n      x \\<in> B \\<longrightarrow>\n      y \\<in> B \\<longrightarrow> R\\<^sup>+\\<^sup>+ (gr x) (gr y))\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "from prem"], ["proof (chain)\npicking this:\n  S\\<^sup>+\\<^sup>+ (f x) (f y)", "have major: \"S\\<^sup>+\\<^sup>+ (f x) (f y)\""], ["proof (prove)\nusing this:\n  S\\<^sup>+\\<^sup>+ (f x) (f y)\n\ngoal (1 subgoal):\n 1. S\\<^sup>+\\<^sup>+ (f x) (f y)", "by blast"], ["proof (state)\nthis:\n  S\\<^sup>+\\<^sup>+ (f x) (f y)\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "from refl_f bij_f"], ["proof (chain)\npicking this:\n  S (f ?x) (f ?y) \\<Longrightarrow> R ?x ?y\n  bij_on_trancl S f", "have cases_1: \"\\<And>x y. S x y \\<Longrightarrow> P x y\""], ["proof (prove)\nusing this:\n  S (f ?x) (f ?y) \\<Longrightarrow> R ?x ?y\n  bij_on_trancl S f\n\ngoal (1 subgoal):\n 1. \\<And>x y. S x y \\<Longrightarrow> P x y", "unfolding B P g gr"], ["proof (prove)\nusing this:\n  S (f ?x) (f ?y) \\<Longrightarrow> R ?x ?y\n  bij_on_trancl S f\n\ngoal (1 subgoal):\n 1. \\<And>x y.\n       S x y \\<Longrightarrow>\n       x \\<in> range f \\<longrightarrow>\n       y \\<in> range f \\<longrightarrow>\n       R\\<^sup>+\\<^sup>+ (restrict (the_inv f) (range f) x)\n        (restrict (the_inv f) (range f) y)", "by (simp add: f_the_inv_into_f tranclp.r_into_trancl)"], ["proof (state)\nthis:\n  S ?x ?y \\<Longrightarrow> P ?x ?y\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "from refl_f bij_f"], ["proof (chain)\npicking this:\n  S (f ?x) (f ?y) \\<Longrightarrow> R ?x ?y\n  bij_on_trancl S f", "have \"(\\<And>x y z. S\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> S\\<^sup>+\\<^sup>+ y z \\<Longrightarrow> x \\<in> B \\<Longrightarrow> z \\<in> B \\<Longrightarrow> y \\<in> B)\""], ["proof (prove)\nusing this:\n  S (f ?x) (f ?y) \\<Longrightarrow> R ?x ?y\n  bij_on_trancl S f\n\ngoal (1 subgoal):\n 1. \\<And>x y z.\n       \\<lbrakk>S\\<^sup>+\\<^sup>+ x y; S\\<^sup>+\\<^sup>+ y z; x \\<in> B;\n        z \\<in> B\\<rbrakk>\n       \\<Longrightarrow> y \\<in> B", "unfolding B"], ["proof (prove)\nusing this:\n  S (f ?x) (f ?y) \\<Longrightarrow> R ?x ?y\n  bij_on_trancl S f\n\ngoal (1 subgoal):\n 1. \\<And>x y z.\n       \\<lbrakk>S\\<^sup>+\\<^sup>+ x y; S\\<^sup>+\\<^sup>+ y z;\n        x \\<in> range f; z \\<in> range f\\<rbrakk>\n       \\<Longrightarrow> y \\<in> range f", "by (rule_tac ?z=\"z\" in tranclp_tranclp_to_tranclp_r, auto, blast)"], ["proof (state)\nthis:\n  \\<lbrakk>S\\<^sup>+\\<^sup>+ ?x ?y; S\\<^sup>+\\<^sup>+ ?y ?z; ?x \\<in> B;\n   ?z \\<in> B\\<rbrakk>\n  \\<Longrightarrow> ?y \\<in> B\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "with P"], ["proof (chain)\npicking this:\n  P =\n  (\\<lambda>x y.\n      x \\<in> B \\<longrightarrow>\n      y \\<in> B \\<longrightarrow> R\\<^sup>+\\<^sup>+ (gr x) (gr y))\n  \\<lbrakk>S\\<^sup>+\\<^sup>+ ?x ?y; S\\<^sup>+\\<^sup>+ ?y ?z; ?x \\<in> B;\n   ?z \\<in> B\\<rbrakk>\n  \\<Longrightarrow> ?y \\<in> B", "have cases_2:\n    \"\\<And>x y z. S\\<^sup>+\\<^sup>+ x y \\<Longrightarrow> P x y \\<Longrightarrow> S\\<^sup>+\\<^sup>+ y z \\<Longrightarrow> P y z \\<Longrightarrow> P x z\""], ["proof (prove)\nusing this:\n  P =\n  (\\<lambda>x y.\n      x \\<in> B \\<longrightarrow>\n      y \\<in> B \\<longrightarrow> R\\<^sup>+\\<^sup>+ (gr x) (gr y))\n  \\<lbrakk>S\\<^sup>+\\<^sup>+ ?x ?y; S\\<^sup>+\\<^sup>+ ?y ?z; ?x \\<in> B;\n   ?z \\<in> B\\<rbrakk>\n  \\<Longrightarrow> ?y \\<in> B\n\ngoal (1 subgoal):\n 1. \\<And>x y z.\n       \\<lbrakk>S\\<^sup>+\\<^sup>+ x y; P x y; S\\<^sup>+\\<^sup>+ y z;\n        P y z\\<rbrakk>\n       \\<Longrightarrow> P x z", "unfolding B"], ["proof (prove)\nusing this:\n  P =\n  (\\<lambda>x y.\n      x \\<in> range f \\<longrightarrow>\n      y \\<in> range f \\<longrightarrow> R\\<^sup>+\\<^sup>+ (gr x) (gr y))\n  \\<lbrakk>S\\<^sup>+\\<^sup>+ ?x ?y; S\\<^sup>+\\<^sup>+ ?y ?z;\n   ?x \\<in> range f; ?z \\<in> range f\\<rbrakk>\n  \\<Longrightarrow> ?y \\<in> range f\n\ngoal (1 subgoal):\n 1. \\<And>x y z.\n       \\<lbrakk>S\\<^sup>+\\<^sup>+ x y; P x y; S\\<^sup>+\\<^sup>+ y z;\n        P y z\\<rbrakk>\n       \\<Longrightarrow> P x z", "by auto"], ["proof (state)\nthis:\n  \\<lbrakk>S\\<^sup>+\\<^sup>+ ?x ?y; P ?x ?y; S\\<^sup>+\\<^sup>+ ?y ?z;\n   P ?y ?z\\<rbrakk>\n  \\<Longrightarrow> P ?x ?z\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "from major cases_1 cases_2"], ["proof (chain)\npicking this:\n  S\\<^sup>+\\<^sup>+ (f x) (f y)\n  S ?x ?y \\<Longrightarrow> P ?x ?y\n  \\<lbrakk>S\\<^sup>+\\<^sup>+ ?x ?y; P ?x ?y; S\\<^sup>+\\<^sup>+ ?y ?z;\n   P ?y ?z\\<rbrakk>\n  \\<Longrightarrow> P ?x ?z", "have \"P (f x) (f y)\""], ["proof (prove)\nusing this:\n  S\\<^sup>+\\<^sup>+ (f x) (f y)\n  S ?x ?y \\<Longrightarrow> P ?x ?y\n  \\<lbrakk>S\\<^sup>+\\<^sup>+ ?x ?y; P ?x ?y; S\\<^sup>+\\<^sup>+ ?y ?z;\n   P ?y ?z\\<rbrakk>\n  \\<Longrightarrow> P ?x ?z\n\ngoal (1 subgoal):\n 1. P (f x) (f y)", "by (rule tranclp_trans_induct)"], ["proof (state)\nthis:\n  P (f x) (f y)\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "with bij_f"], ["proof (chain)\npicking this:\n  bij_on_trancl S f\n  P (f x) (f y)", "show ?thesis"], ["proof (prove)\nusing this:\n  bij_on_trancl S f\n  P (f x) (f y)\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "unfolding P B g gr"], ["proof (prove)\nusing this:\n  bij_on_trancl S f\n  f x \\<in> range f \\<longrightarrow>\n  f y \\<in> range f \\<longrightarrow>\n  R\\<^sup>+\\<^sup>+ (restrict (the_inv f) (range f) (f x))\n   (restrict (the_inv f) (range f) (f y))\n\ngoal (1 subgoal):\n 1. R\\<^sup>+\\<^sup>+ x y", "by (simp add: the_inv_f_f)"], ["proof (state)\nthis:\n  R\\<^sup>+\\<^sup>+ x y\n\ngoal:\nNo subgoals!", "qed"], ["", "text \\<open>\n  A function @{text f} reflects @{text \"S\\<^sup>*\\<^sup>*\"} if it reflects\n  @{text S} and is bijective on @{text \"S\\<^sup>+\\<^sup>+\"}.\\<close>"], ["", "lemma reflect_rtranclp:\n  \"(\\<And>x y. S (f x) (f y) \\<Longrightarrow> R x y) \\<Longrightarrow>\n   bij_on_trancl S f \\<Longrightarrow>\n   S\\<^sup>*\\<^sup>* (f x) (f y) \\<Longrightarrow> R\\<^sup>*\\<^sup>* x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y. S (f x) (f y) \\<Longrightarrow> R x y;\n     bij_on_trancl S f; S\\<^sup>*\\<^sup>* (f x) (f y)\\<rbrakk>\n    \\<Longrightarrow> R\\<^sup>*\\<^sup>* x y", "unfolding Nitpick.rtranclp_unfold"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>x y. S (f x) (f y) \\<Longrightarrow> R x y;\n     bij_on_trancl S f;\n     f x = f y \\<or> S\\<^sup>+\\<^sup>+ (f x) (f y)\\<rbrakk>\n    \\<Longrightarrow> x = y \\<or> R\\<^sup>+\\<^sup>+ x y", "by (metis (full_types) injD reflect_tranclp)"], ["", "end"]]}