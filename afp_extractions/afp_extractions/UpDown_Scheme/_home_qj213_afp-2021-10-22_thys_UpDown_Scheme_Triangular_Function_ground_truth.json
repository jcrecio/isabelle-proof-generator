{"file_name": "/home/qj213/afp-2021-10-22/thys/UpDown_Scheme/Triangular_Function.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/UpDown_Scheme", "problem_names": ["lemma continuous_on_max[continuous_intros]:\n  fixes f :: \"_ \\<Rightarrow> 'a::linorder_topology\"\n  shows \"continuous_on S f \\<Longrightarrow> continuous_on S g \\<Longrightarrow> continuous_on S (\\<lambda>x. max (f x) (g x))\"", "lemma measurable_\\<phi>[measurable]: \"\\<phi> p \\<in> borel_measurable borel\"", "lemma \\<phi>_nonneg: \"0 \\<le> \\<phi> p x\"", "lemma \\<phi>_zero_iff:\n  \"\\<phi> (l,i) x = 0 \\<longleftrightarrow> x \\<notin> {real_of_int (i - 1) / 2^(l + 1) <..< real_of_int (i + 1) / 2^(l + 1)}\"", "lemma \\<phi>_zero: \"x \\<notin> {real_of_int (i - 1) / 2^(l + 1) <..< real_of_int (i + 1) / 2^(l + 1)} \\<Longrightarrow> \\<phi> (l,i) x = 0\"", "lemma \\<phi>_eq_0: assumes x: \"x < 0 \\<or> 1 < x\" and i: \"0 < i\" \"i < 2^Suc l\" shows \"\\<phi> (l, i) x = 0\"", "lemma ix_lt: \"p \\<in> sparsegrid dm lm \\<Longrightarrow> d < dm \\<Longrightarrow> ix p d < 2^(lv p d + 1)\"", "lemma ix_gt: \"p \\<in> sparsegrid dm lm \\<Longrightarrow> d < dm \\<Longrightarrow> 0 < ix p d\"", "lemma \\<Phi>_eq_0: assumes x: \"\\<exists>d<length p. x d < 0 \\<or> 1 < x d\" and p: \"p \\<in> sparsegrid dm lm\" shows \"\\<Phi> p x = 0\"", "lemma \\<phi>_left_support':\n  \"x \\<in> {real_of_int (i - 1) / 2^(l + 1) .. real_of_int i / 2^(l + 1)} \\<Longrightarrow> \\<phi> (l,i) x = 1 + x * 2^(l + 1) - real_of_int i\"", "lemma \\<phi>_left_support: \"x \\<in> {-1 .. 0::real} \\<Longrightarrow> \\<phi> (l,i) ((x + real_of_int i) / 2^(l + 1)) = 1 + x\"", "lemma \\<phi>_right_support':\n  \"x \\<in> {real_of_int i / 2^(l + 1) .. real_of_int (i + 1) / 2^(l + 1)} \\<Longrightarrow> \\<phi> (l,i) x = 1 - x * 2^(l + 1) + real_of_int i\"", "lemma \\<phi>_right_support: \n  \"x \\<in> {0 .. 1::real} \\<Longrightarrow> \\<phi> (l,i) ((x + real i) / 2^(l + 1)) = 1 - x\"", "lemma integrable_\\<phi>: \"integrable lborel (\\<phi> p)\"", "lemma integrable_\\<phi>2: \"integrable lborel (\\<lambda>x. \\<phi> p x * \\<phi> q x)\"", "lemma l2_\\<phi>I_DERIV:\n  assumes n: \"\\<And> x. x \\<in> { (real_of_int i' - 1) / 2^(l' + 1) .. real_of_int i' / 2^(l' + 1) } \\<Longrightarrow>\n    DERIV \\<Phi>_n x :> (\\<phi> (l', i') x * \\<phi> (l, i) x)\" (is \"\\<And> x. x \\<in> {?a..?b} \\<Longrightarrow> DERIV _ _ :> ?P x\")\n    and p: \"\\<And> x. x \\<in> { real_of_int i' / 2^(l' + 1) .. (real_of_int i' + 1) / 2^(l' + 1) } \\<Longrightarrow>\n    DERIV \\<Phi>_p x :> (\\<phi> (l', i') x * \\<phi> (l, i) x)\" (is \"\\<And> x. x \\<in> {?b..?c} \\<Longrightarrow> _\")\n  shows \"l2_\\<phi> (l', i') (l, i) = (\\<Phi>_n ?b - \\<Phi>_n ?a) + (\\<Phi>_p ?c - \\<Phi>_p ?b)\"", "lemma l2_eq: \"length a = length b \\<Longrightarrow> l2 a b = (\\<Prod>d<length a. l2_\\<phi> (a!d) (b!d))\"", "lemma l2_when_disjoint:\n  assumes \"l \\<le> l'\"\n  defines \"d == l' - l\"\n  assumes \"(i + 1) * 2^d < i' \\<or> i' < (i - 1) * 2^d\" (is \"?right \\<or> ?left\")\n  shows \"l2_\\<phi> (l', i') (l, i) = 0\"", "lemma l2_commutative: \"l2_\\<phi> p q = l2_\\<phi> q p\"", "lemma l2_when_same: \"l2_\\<phi> (l, i) (l, i) = 1/3 / 2^l\"", "lemma l2_when_left_child:\n  assumes \"l < l'\"\n  and i'_bot: \"i' > (i - 1) * 2^(l' - l)\"\n  and i'_top: \"i' < i * 2^(l' - l)\"\n  shows \"l2_\\<phi> (l', i') (l, i) = (1 + real_of_int i' / 2^(l' - l) - real_of_int i) / 2^(l' + 1)\"", "lemma l2_when_right_child:\n  assumes \"l < l'\"\n  and i'_bot: \"i' > i * 2^(l' - l)\"\n  and i'_top: \"i' < (i + 1) * 2^(l' - l)\"\n  shows \"l2_\\<phi> (l', i') (l, i) = (1 - real_of_int i' / 2^(l' - l) + real_of_int i) / 2^(l' + 1)\"", "lemma level_shift: \"lc > l \\<Longrightarrow> (x :: real) / 2 ^ (lc - Suc l) = x * 2 / 2 ^ (lc - l)\"", "lemma l2_child: assumes \"d < length b\"\n  and p_grid: \"p \\<in> grid (child b dir d) ds\" (is \"p \\<in> grid ?child ds\")\n  shows \"l2_\\<phi> (p ! d) (b ! d) = (1 - real_of_int (sgn dir) * (real_of_int (ix p d) / 2^(lv p d - lv b d) - real_of_int (ix b d))) /\n                                 2^(lv p d + 1)\"", "lemma l2_same: \"l2_\\<phi> (p!d) (p!d) = 1/3 / 2^(lv p d)\"", "lemma l2_disjoint: assumes \"d < length b\" and \"p \\<in> grid b {d}\" and \"p' \\<in> grid b {d}\"\n  and \"p' \\<notin> grid p {d}\" and \"lv p' d \\<ge> lv p d\"\n  shows \"l2_\\<phi> (p' ! d) (p ! d) = 0\"", "lemma l2_down2:\n  fixes pc pd p\n  assumes \"d < length pd\"\n  assumes pc_in_grid: \"pc \\<in> grid (child pd dir d) {d}\"\n  assumes pd_is_child: \"pd = child p dir d\" (is \"pd = ?pd\")\n  shows \"l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)\"", "lemma l2_zigzag:\n  assumes \"d < length p\" and p_child: \"p = child p_p dir d\"\n  and p'_grid: \"p' \\<in> grid (child p (inv dir) d) {d}\"\n  and ps_intro: \"child p (inv dir) d = child ps dir d\" (is \"?c_p = ?c_ps\")\n  shows \"l2_\\<phi> (p' ! d) (p_p ! d) = l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2\""], "translations": [["", "lemma continuous_on_max[continuous_intros]:\n  fixes f :: \"_ \\<Rightarrow> 'a::linorder_topology\"\n  shows \"continuous_on S f \\<Longrightarrow> continuous_on S g \\<Longrightarrow> continuous_on S (\\<lambda>x. max (f x) (g x))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>continuous_on S f; continuous_on S g\\<rbrakk>\n    \\<Longrightarrow> continuous_on S (\\<lambda>x. max (f x) (g x))", "by (auto simp: continuous_on_def intro: tendsto_max)"], ["", "definition \\<phi> :: \"(nat \\<times> int) \\<Rightarrow> real \\<Rightarrow> real\" where\n  \"\\<phi> \\<equiv> (\\<lambda>(l,i) x. max 0 (1 - \\<bar> x * 2^(l + 1) - real_of_int i \\<bar>))\""], ["", "definition \\<Phi> :: \"(nat \\<times> int) list \\<Rightarrow> (nat \\<Rightarrow> real) \\<Rightarrow> real\" where\n  \"\\<Phi> p x = (\\<Prod>d<length p. \\<phi> (p ! d) (x d))\""], ["", "definition l2_\\<phi> where\n  \"l2_\\<phi> p1 p2 = (\\<integral>x. \\<phi> p1 x * \\<phi> p2 x \\<partial>lborel)\""], ["", "definition l2 where\n  \"l2 a b = (\\<integral>x. \\<Phi> a x * \\<Phi> b x \\<partial>(\\<Pi>\\<^sub>M d\\<in>{..<length a}. lborel))\""], ["", "lemma measurable_\\<phi>[measurable]: \"\\<phi> p \\<in> borel_measurable borel\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<phi> p \\<in> borel_measurable borel", "by (cases p) (simp add: \\<phi>_def)"], ["", "lemma \\<phi>_nonneg: \"0 \\<le> \\<phi> p x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> \\<phi> p x", "by (simp add: \\<phi>_def split: prod.split)"], ["", "lemma \\<phi>_zero_iff:\n  \"\\<phi> (l,i) x = 0 \\<longleftrightarrow> x \\<notin> {real_of_int (i - 1) / 2^(l + 1) <..< real_of_int (i + 1) / 2^(l + 1)}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<phi> (l, i) x = 0) =\n    (x \\<notin> {real_of_int (i - 1) /\n                 2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)})", "by (auto simp: \\<phi>_def field_simps split: split_max)"], ["", "lemma \\<phi>_zero: \"x \\<notin> {real_of_int (i - 1) / 2^(l + 1) <..< real_of_int (i + 1) / 2^(l + 1)} \\<Longrightarrow> \\<phi> (l,i) x = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<notin> {real_of_int (i - 1) /\n                2 ^\n                (l +\n                 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n    \\<phi> (l, i) x = 0", "unfolding \\<phi>_zero_iff"], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<notin> {real_of_int (i - 1) /\n                2 ^\n                (l +\n                 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n    x \\<notin> {real_of_int (i - 1) /\n                2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)}", "by simp"], ["", "lemma \\<phi>_eq_0: assumes x: \"x < 0 \\<or> 1 < x\" and i: \"0 < i\" \"i < 2^Suc l\" shows \"\\<phi> (l, i) x = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 0", "using x"], ["proof (prove)\nusing this:\n  x < 0 \\<or> 1 < x\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 0", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. x < 0 \\<Longrightarrow> \\<phi> (l, i) x = 0\n 2. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "assume \"x < 0\""], ["proof (state)\nthis:\n  x < 0\n\ngoal (2 subgoals):\n 1. x < 0 \\<Longrightarrow> \\<phi> (l, i) x = 0\n 2. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "also"], ["proof (state)\nthis:\n  x < 0\n\ngoal (2 subgoals):\n 1. x < 0 \\<Longrightarrow> \\<phi> (l, i) x = 0\n 2. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "have \"0 \\<le> real_of_int (i - 1) / 2^(l + 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> real_of_int (i - 1) / 2 ^ (l + 1)", "using i"], ["proof (prove)\nusing this:\n  0 < i\n  i < 2 ^ Suc l\n\ngoal (1 subgoal):\n 1. 0 \\<le> real_of_int (i - 1) / 2 ^ (l + 1)", "by (auto simp: field_simps)"], ["proof (state)\nthis:\n  0 \\<le> real_of_int (i - 1) / 2 ^ (l + 1)\n\ngoal (2 subgoals):\n 1. x < 0 \\<Longrightarrow> \\<phi> (l, i) x = 0\n 2. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "finally"], ["proof (chain)\npicking this:\n  x < real_of_int (i - 1) / 2 ^ (l + 1)", "show ?thesis"], ["proof (prove)\nusing this:\n  x < real_of_int (i - 1) / 2 ^ (l + 1)\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 0", "by (auto intro!: \\<phi>_zero simp: field_simps)"], ["proof (state)\nthis:\n  \\<phi> (l, i) x = 0\n\ngoal (1 subgoal):\n 1. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "have \"real_of_int (i + 1) / 2^(l + 1) \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real_of_int (i + 1) / 2 ^ (l + 1) \\<le> 1", "using i"], ["proof (prove)\nusing this:\n  0 < i\n  i < 2 ^ Suc l\n\ngoal (1 subgoal):\n 1. real_of_int (i + 1) / 2 ^ (l + 1) \\<le> 1", "by (subst divide_le_eq_1_pos) (auto simp del: of_int_add power_Suc)"], ["proof (state)\nthis:\n  real_of_int (i + 1) / 2 ^ (l + 1) \\<le> 1\n\ngoal (1 subgoal):\n 1. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "also"], ["proof (state)\nthis:\n  real_of_int (i + 1) / 2 ^ (l + 1) \\<le> 1\n\ngoal (1 subgoal):\n 1. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "assume \"1 < x\""], ["proof (state)\nthis:\n  1 < x\n\ngoal (1 subgoal):\n 1. 1 < x \\<Longrightarrow> \\<phi> (l, i) x = 0", "finally"], ["proof (chain)\npicking this:\n  real_of_int (i + 1) / 2 ^ (l + 1) < x", "show ?thesis"], ["proof (prove)\nusing this:\n  real_of_int (i + 1) / 2 ^ (l + 1) < x\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 0", "by (auto intro!: \\<phi>_zero simp: field_simps)"], ["proof (state)\nthis:\n  \\<phi> (l, i) x = 0\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma ix_lt: \"p \\<in> sparsegrid dm lm \\<Longrightarrow> d < dm \\<Longrightarrow> ix p d < 2^(lv p d + 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>p \\<in> sparsegrid dm lm; d < dm\\<rbrakk>\n    \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1)", "unfolding sparsegrid_def lgrid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>p \\<in> {p \\<in> grid (start dm) {0..<dm}. level p < lm};\n     d < dm\\<rbrakk>\n    \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1)", "using grid_estimate[of d \"start dm\" p \"{0 ..< dm}\"]"], ["proof (prove)\nusing this:\n  \\<lbrakk>d < length (start dm); p \\<in> grid (start dm) {0..<dm}\\<rbrakk>\n  \\<Longrightarrow> ix p d\n                    < (ix (start dm) d + 1) *\n                      2 ^ (lv p d - lv (start dm) d) \\<and>\n                    (ix (start dm) d - 1) * 2 ^ (lv p d - lv (start dm) d)\n                    < ix p d\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p \\<in> {p \\<in> grid (start dm) {0..<dm}. level p < lm};\n     d < dm\\<rbrakk>\n    \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1)", "by auto"], ["", "lemma ix_gt: \"p \\<in> sparsegrid dm lm \\<Longrightarrow> d < dm \\<Longrightarrow> 0 < ix p d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>p \\<in> sparsegrid dm lm; d < dm\\<rbrakk>\n    \\<Longrightarrow> 0 < ix p d", "unfolding sparsegrid_def lgrid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>p \\<in> {p \\<in> grid (start dm) {0..<dm}. level p < lm};\n     d < dm\\<rbrakk>\n    \\<Longrightarrow> 0 < ix p d", "using grid_estimate[of d \"start dm\" p \"{0 ..< dm}\"]"], ["proof (prove)\nusing this:\n  \\<lbrakk>d < length (start dm); p \\<in> grid (start dm) {0..<dm}\\<rbrakk>\n  \\<Longrightarrow> ix p d\n                    < (ix (start dm) d + 1) *\n                      2 ^ (lv p d - lv (start dm) d) \\<and>\n                    (ix (start dm) d - 1) * 2 ^ (lv p d - lv (start dm) d)\n                    < ix p d\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p \\<in> {p \\<in> grid (start dm) {0..<dm}. level p < lm};\n     d < dm\\<rbrakk>\n    \\<Longrightarrow> 0 < ix p d", "by auto"], ["", "lemma \\<Phi>_eq_0: assumes x: \"\\<exists>d<length p. x d < 0 \\<or> 1 < x d\" and p: \"p \\<in> sparsegrid dm lm\" shows \"\\<Phi> p x = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Phi> p x = 0", "unfolding \\<Phi>_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Prod>d<length p. \\<phi> (p ! d) (x d)) = 0", "proof (rule prod_zero)"], ["proof (state)\ngoal (2 subgoals):\n 1. finite {..<length p}\n 2. \\<exists>a\\<in>{..<length p}. \\<phi> (p ! a) (x a) = 0", "from x"], ["proof (chain)\npicking this:\n  \\<exists>d<length p. x d < 0 \\<or> 1 < x d", "guess d"], ["proof (prove)\nusing this:\n  \\<exists>d<length p. x d < 0 \\<or> 1 < x d\n\ngoal (1 subgoal):\n 1. thesis", ".."], ["proof (state)\nthis:\n  d < length p \\<and> (x d < 0 \\<or> 1 < x d)\n\ngoal (2 subgoals):\n 1. finite {..<length p}\n 2. \\<exists>a\\<in>{..<length p}. \\<phi> (p ! a) (x a) = 0", "with p[THEN ix_lt, of d] p[THEN ix_gt, of d] p"], ["proof (chain)\npicking this:\n  d < dm \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1)\n  d < dm \\<Longrightarrow> 0 < ix p d\n  p \\<in> sparsegrid dm lm\n  d < length p \\<and> (x d < 0 \\<or> 1 < x d)", "show \"\\<exists>a\\<in>{..<length p}. \\<phi> (p ! a) (x a) = 0\""], ["proof (prove)\nusing this:\n  d < dm \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1)\n  d < dm \\<Longrightarrow> 0 < ix p d\n  p \\<in> sparsegrid dm lm\n  d < length p \\<and> (x d < 0 \\<or> 1 < x d)\n\ngoal (1 subgoal):\n 1. \\<exists>a\\<in>{..<length p}. \\<phi> (p ! a) (x a) = 0", "apply (cases \"p!d\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a b.\n       \\<lbrakk>d < dm \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1);\n        d < dm \\<Longrightarrow> 0 < ix p d; p \\<in> sparsegrid dm lm;\n        d < length p \\<and> (x d < 0 \\<or> 1 < x d); p ! d = (a, b)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>a\\<in>{..<length p}.\n                            \\<phi> (p ! a) (x a) = 0", "apply (intro bexI[of _ d])"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b.\n       \\<lbrakk>d < dm \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1);\n        d < dm \\<Longrightarrow> 0 < ix p d; p \\<in> sparsegrid dm lm;\n        d < length p \\<and> (x d < 0 \\<or> 1 < x d); p ! d = (a, b)\\<rbrakk>\n       \\<Longrightarrow> \\<phi> (p ! d) (x d) = 0\n 2. \\<And>a b.\n       \\<lbrakk>d < dm \\<Longrightarrow> ix p d < 2 ^ (lv p d + 1);\n        d < dm \\<Longrightarrow> 0 < ix p d; p \\<in> sparsegrid dm lm;\n        d < length p \\<and> (x d < 0 \\<or> 1 < x d); p ! d = (a, b)\\<rbrakk>\n       \\<Longrightarrow> d \\<in> {..<length p}", "apply (auto intro!: \\<phi>_eq_0 simp: sparsegrid_length ix_def lv_def)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<exists>a\\<in>{..<length p}. \\<phi> (p ! a) (x a) = 0\n\ngoal (1 subgoal):\n 1. finite {..<length p}", "qed simp"], ["", "lemma \\<phi>_left_support':\n  \"x \\<in> {real_of_int (i - 1) / 2^(l + 1) .. real_of_int i / 2^(l + 1)} \\<Longrightarrow> \\<phi> (l,i) x = 1 + x * 2^(l + 1) - real_of_int i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> {real_of_int (i - 1) /\n             2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n    \\<phi> (l, i) x = 1 + x * 2 ^ (l + 1) - real_of_int i", "by (auto simp: \\<phi>_def field_simps split: split_max)"], ["", "lemma \\<phi>_left_support: \"x \\<in> {-1 .. 0::real} \\<Longrightarrow> \\<phi> (l,i) ((x + real_of_int i) / 2^(l + 1)) = 1 + x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> {- 1..0} \\<Longrightarrow>\n    \\<phi> (l, i) ((x + real_of_int i) / 2 ^ (l + 1)) = 1 + x", "by (auto simp: \\<phi>_def field_simps split: split_max)"], ["", "lemma \\<phi>_right_support':\n  \"x \\<in> {real_of_int i / 2^(l + 1) .. real_of_int (i + 1) / 2^(l + 1)} \\<Longrightarrow> \\<phi> (l,i) x = 1 - x * 2^(l + 1) + real_of_int i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> {real_of_int i /\n             2 ^\n             (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n    \\<phi> (l, i) x = 1 - x * 2 ^ (l + 1) + real_of_int i", "by (auto simp: \\<phi>_def field_simps split: split_max)"], ["", "lemma \\<phi>_right_support: \n  \"x \\<in> {0 .. 1::real} \\<Longrightarrow> \\<phi> (l,i) ((x + real i) / 2^(l + 1)) = 1 - x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> {0..1} \\<Longrightarrow>\n    \\<phi> (l, int i) ((x + real i) / 2 ^ (l + 1)) = 1 - x", "by (auto simp: \\<phi>_def field_simps split: split_max)"], ["", "lemma integrable_\\<phi>: \"integrable lborel (\\<phi> p)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. integrable lborel (\\<phi> p)", "proof (induct p)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>a b. integrable lborel (\\<phi> (a, b))", "case (Pair l i)"], ["proof (state)\nthis:\n  \n\ngoal (1 subgoal):\n 1. \\<And>a b. integrable lborel (\\<phi> (a, b))", "have \"integrable lborel (\\<lambda>x. indicator {real_of_int (i - 1) / 2^(l + 1) .. real_of_int (i + 1) / 2^(l + 1)} x *\\<^sub>R \\<phi> (l, i) x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. integrable lborel\n     (\\<lambda>x.\n         indicat_real\n          {real_of_int (i - 1) /\n           2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n          x *\\<^sub>R\n         \\<phi> (l, i) x)", "unfolding \\<phi>_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. integrable lborel\n     (\\<lambda>x.\n         indicat_real\n          {real_of_int (i - 1) /\n           2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n          x *\\<^sub>R\n         (case (l, i) of\n          (l, i) \\<Rightarrow>\n            \\<lambda>x.\n               max 0 (1 - \\<bar>x * 2 ^ (l + 1) - real_of_int i\\<bar>))\n          x)", "by (intro borel_integrable_compact) (auto intro!: continuous_intros)"], ["proof (state)\nthis:\n  integrable lborel\n   (\\<lambda>x.\n       indicat_real\n        {real_of_int (i - 1) /\n         2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n        x *\\<^sub>R\n       \\<phi> (l, i) x)\n\ngoal (1 subgoal):\n 1. \\<And>a b. integrable lborel (\\<phi> (a, b))", "then"], ["proof (chain)\npicking this:\n  integrable lborel\n   (\\<lambda>x.\n       indicat_real\n        {real_of_int (i - 1) /\n         2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n        x *\\<^sub>R\n       \\<phi> (l, i) x)", "show ?case"], ["proof (prove)\nusing this:\n  integrable lborel\n   (\\<lambda>x.\n       indicat_real\n        {real_of_int (i - 1) /\n         2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n        x *\\<^sub>R\n       \\<phi> (l, i) x)\n\ngoal (1 subgoal):\n 1. integrable lborel (\\<phi> (l, i))", "by (rule integrable_cong[THEN iffD1, rotated -1]) (auto simp: \\<phi>_zero_iff)"], ["proof (state)\nthis:\n  integrable lborel (\\<phi> (l, i))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma integrable_\\<phi>2: \"integrable lborel (\\<lambda>x. \\<phi> p x * \\<phi> q x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. integrable lborel (\\<lambda>x. \\<phi> p x * \\<phi> q x)", "proof (cases p q rule: prod.exhaust[case_product prod.exhaust])"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x1__ x2__ x1a__ x2a__.\n       \\<lbrakk>p = (x1__, x2__); q = (x1a__, x2a__)\\<rbrakk>\n       \\<Longrightarrow> integrable lborel\n                          (\\<lambda>x. \\<phi> p x * \\<phi> q x)", "case (Pair_Pair l i l' i')"], ["proof (state)\nthis:\n  p = (l, i)\n  q = (l', i')\n\ngoal (1 subgoal):\n 1. \\<And>x1__ x2__ x1a__ x2a__.\n       \\<lbrakk>p = (x1__, x2__); q = (x1a__, x2a__)\\<rbrakk>\n       \\<Longrightarrow> integrable lborel\n                          (\\<lambda>x. \\<phi> p x * \\<phi> q x)", "have \"integrable lborel\n      (\\<lambda>x. indicator {real_of_int (i - 1) / 2^(l + 1) .. real_of_int (i + 1) / 2^(l + 1)} x *\\<^sub>R (\\<phi> (l, i) x * \\<phi> (l', i') x))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. integrable lborel\n     (\\<lambda>x.\n         indicat_real\n          {real_of_int (i - 1) /\n           2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n          x *\\<^sub>R\n         (\\<phi> (l, i) x * \\<phi> (l', i') x))", "unfolding \\<phi>_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. integrable lborel\n     (\\<lambda>x.\n         indicat_real\n          {real_of_int (i - 1) /\n           2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n          x *\\<^sub>R\n         ((case (l, i) of\n           (l, i) \\<Rightarrow>\n             \\<lambda>x.\n                max 0 (1 - \\<bar>x * 2 ^ (l + 1) - real_of_int i\\<bar>))\n           x *\n          (case (l', i') of\n           (l, i) \\<Rightarrow>\n             \\<lambda>x.\n                max 0 (1 - \\<bar>x * 2 ^ (l + 1) - real_of_int i\\<bar>))\n           x))", "by (intro borel_integrable_compact) (auto intro!: continuous_intros)"], ["proof (state)\nthis:\n  integrable lborel\n   (\\<lambda>x.\n       indicat_real\n        {real_of_int (i - 1) /\n         2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n        x *\\<^sub>R\n       (\\<phi> (l, i) x * \\<phi> (l', i') x))\n\ngoal (1 subgoal):\n 1. \\<And>x1__ x2__ x1a__ x2a__.\n       \\<lbrakk>p = (x1__, x2__); q = (x1a__, x2a__)\\<rbrakk>\n       \\<Longrightarrow> integrable lborel\n                          (\\<lambda>x. \\<phi> p x * \\<phi> q x)", "then"], ["proof (chain)\npicking this:\n  integrable lborel\n   (\\<lambda>x.\n       indicat_real\n        {real_of_int (i - 1) /\n         2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n        x *\\<^sub>R\n       (\\<phi> (l, i) x * \\<phi> (l', i') x))", "show ?thesis"], ["proof (prove)\nusing this:\n  integrable lborel\n   (\\<lambda>x.\n       indicat_real\n        {real_of_int (i - 1) /\n         2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n        x *\\<^sub>R\n       (\\<phi> (l, i) x * \\<phi> (l', i') x))\n\ngoal (1 subgoal):\n 1. integrable lborel (\\<lambda>x. \\<phi> p x * \\<phi> q x)", "unfolding Pair_Pair"], ["proof (prove)\nusing this:\n  integrable lborel\n   (\\<lambda>x.\n       indicat_real\n        {real_of_int (i - 1) /\n         2 ^ (l + 1)..real_of_int (i + 1) / 2 ^ (l + 1)}\n        x *\\<^sub>R\n       (\\<phi> (l, i) x * \\<phi> (l', i') x))\n\ngoal (1 subgoal):\n 1. integrable lborel (\\<lambda>x. \\<phi> (l, i) x * \\<phi> (l', i') x)", "by (rule integrable_cong[THEN iffD1, rotated -1]) (auto simp: \\<phi>_zero_iff)"], ["proof (state)\nthis:\n  integrable lborel (\\<lambda>x. \\<phi> p x * \\<phi> q x)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma l2_\\<phi>I_DERIV:\n  assumes n: \"\\<And> x. x \\<in> { (real_of_int i' - 1) / 2^(l' + 1) .. real_of_int i' / 2^(l' + 1) } \\<Longrightarrow>\n    DERIV \\<Phi>_n x :> (\\<phi> (l', i') x * \\<phi> (l, i) x)\" (is \"\\<And> x. x \\<in> {?a..?b} \\<Longrightarrow> DERIV _ _ :> ?P x\")\n    and p: \"\\<And> x. x \\<in> { real_of_int i' / 2^(l' + 1) .. (real_of_int i' + 1) / 2^(l' + 1) } \\<Longrightarrow>\n    DERIV \\<Phi>_p x :> (\\<phi> (l', i') x * \\<phi> (l, i) x)\" (is \"\\<And> x. x \\<in> {?b..?c} \\<Longrightarrow> _\")\n  shows \"l2_\\<phi> (l', i') (l, i) = (\\<Phi>_n ?b - \\<Phi>_n ?a) + (\\<Phi>_p ?c - \\<Phi>_p ?b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) =\n    \\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1)))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) =\n    \\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1)))", "have \"has_bochner_integral lborel\n      (\\<lambda>x. ?P x * indicator {?a..?b} x + ?P x * indicator {?b..?c} x)\n      ((\\<Phi>_n ?b - \\<Phi>_n ?a) + (\\<Phi>_p ?c - \\<Phi>_p ?b))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_bochner_integral lborel\n     (\\<lambda>x.\n         \\<phi> (l', i') x * \\<phi> (l, i) x *\n         indicat_real\n          {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n          x +\n         \\<phi> (l', i') x * \\<phi> (l, i) x *\n         indicat_real\n          {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n          x)\n     (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n      \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n      (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n       \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))", "by (intro has_bochner_integral_add has_bochner_integral_FTC_Icc_nonneg n p)\n       (auto simp: \\<phi>_nonneg field_simps)"], ["proof (state)\nthis:\n  has_bochner_integral lborel\n   (\\<lambda>x.\n       \\<phi> (l', i') x * \\<phi> (l, i) x *\n       indicat_real\n        {(real_of_int i' - 1) / 2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n        x +\n       \\<phi> (l', i') x * \\<phi> (l, i) x *\n       indicat_real\n        {real_of_int i' / 2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n        x)\n   (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) =\n    \\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1)))", "then"], ["proof (chain)\npicking this:\n  has_bochner_integral lborel\n   (\\<lambda>x.\n       \\<phi> (l', i') x * \\<phi> (l, i) x *\n       indicat_real\n        {(real_of_int i' - 1) / 2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n        x +\n       \\<phi> (l', i') x * \\<phi> (l, i) x *\n       indicat_real\n        {real_of_int i' / 2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n        x)\n   (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))", "have \"has_bochner_integral lborel?P ((\\<Phi>_n ?b - \\<Phi>_n ?a) + (\\<Phi>_p ?c - \\<Phi>_p ?b))\""], ["proof (prove)\nusing this:\n  has_bochner_integral lborel\n   (\\<lambda>x.\n       \\<phi> (l', i') x * \\<phi> (l, i) x *\n       indicat_real\n        {(real_of_int i' - 1) / 2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n        x +\n       \\<phi> (l', i') x * \\<phi> (l, i) x *\n       indicat_real\n        {real_of_int i' / 2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n        x)\n   (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))\n\ngoal (1 subgoal):\n 1. has_bochner_integral lborel\n     (\\<lambda>x. \\<phi> (l', i') x * \\<phi> (l, i) x)\n     (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n      \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n      (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n       \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))", "by (rule has_bochner_integral_discrete_difference[where X=\"{?b}\", THEN iffD1, rotated -1])\n       (auto simp: power_add intro!: \\<phi>_zero integral_cong split: split_indicator)"], ["proof (state)\nthis:\n  has_bochner_integral lborel\n   (\\<lambda>x. \\<phi> (l', i') x * \\<phi> (l, i) x)\n   (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) =\n    \\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1)))", "then"], ["proof (chain)\npicking this:\n  has_bochner_integral lborel\n   (\\<lambda>x. \\<phi> (l', i') x * \\<phi> (l, i) x)\n   (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))", "show ?thesis"], ["proof (prove)\nusing this:\n  has_bochner_integral lborel\n   (\\<lambda>x. \\<phi> (l', i') x * \\<phi> (l, i) x)\n   (\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))))\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) =\n    \\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1)))", "by (simp add: has_bochner_integral_iff l2_\\<phi>_def)"], ["proof (state)\nthis:\n  l2_\\<phi> (l', i') (l, i) =\n  \\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n  \\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n  (\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n   \\<Phi>_p (real_of_int i' / 2 ^ (l' + 1)))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma l2_eq: \"length a = length b \\<Longrightarrow> l2 a b = (\\<Prod>d<length a. l2_\\<phi> (a!d) (b!d))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. length a = length b \\<Longrightarrow>\n    l2 a b = (\\<Prod>d<length a. l2_\\<phi> (a ! d) (b ! d))", "unfolding l2_def l2_\\<phi>_def \\<Phi>_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. length a = length b \\<Longrightarrow>\n    LINT x|Pi\\<^sub>M {..<length a} (\\<lambda>d. lborel).\n       (\\<Prod>d<length a. \\<phi> (a ! d) (x d)) *\n       (\\<Prod>d<length b. \\<phi> (b ! d) (x d)) =\n    (\\<Prod>d<length a. LBINT x. \\<phi> (a ! d) x * \\<phi> (b ! d) x)", "apply (simp add: prod.distrib[symmetric])"], ["proof (prove)\ngoal (1 subgoal):\n 1. length a = length b \\<Longrightarrow>\n    LINT x|Pi\\<^sub>M {..<length b} (\\<lambda>d. lborel).\n       (\\<Prod>xa<length b.\n           \\<phi> (a ! xa) (x xa) * \\<phi> (b ! xa) (x xa)) =\n    (\\<Prod>d<length b. LBINT x. \\<phi> (a ! d) x * \\<phi> (b ! d) x)", "proof (rule product_sigma_finite.product_integral_prod)"], ["proof (state)\ngoal (3 subgoals):\n 1. length a = length b \\<Longrightarrow>\n    product_sigma_finite (\\<lambda>d. lborel)\n 2. length a = length b \\<Longrightarrow> finite {..<length b}\n 3. \\<And>x.\n       \\<lbrakk>length a = length b; x \\<in> {..<length b}\\<rbrakk>\n       \\<Longrightarrow> integrable lborel\n                          (\\<lambda>xa.\n                              \\<phi> (a ! x) xa * \\<phi> (b ! x) xa)", "show \"product_sigma_finite (\\<lambda>d. lborel)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. product_sigma_finite (\\<lambda>d. lborel)", ".."], ["proof (state)\nthis:\n  product_sigma_finite (\\<lambda>d. lborel)\n\ngoal (2 subgoals):\n 1. length a = length b \\<Longrightarrow> finite {..<length b}\n 2. \\<And>x.\n       \\<lbrakk>length a = length b; x \\<in> {..<length b}\\<rbrakk>\n       \\<Longrightarrow> integrable lborel\n                          (\\<lambda>xa.\n                              \\<phi> (a ! x) xa * \\<phi> (b ! x) xa)", "qed (auto intro: integrable_\\<phi>2)"], ["", "lemma l2_when_disjoint:\n  assumes \"l \\<le> l'\"\n  defines \"d == l' - l\"\n  assumes \"(i + 1) * 2^d < i' \\<or> i' < (i - 1) * 2^d\" (is \"?right \\<or> ?left\")\n  shows \"l2_\\<phi> (l', i') (l, i) = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "let ?sup = \"\\<lambda>l i. {real_of_int (i - 1) / 2^(l + 1) <..< real_of_int (i + 1) / 2^(l + 1)}\""], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "have l': \"l' = l + d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l' = l + d", "using assms"], ["proof (prove)\nusing this:\n  l \\<le> l'\n  d \\<equiv> l' - l\n  (i + 1) * 2 ^ d < i' \\<or> i' < (i - 1) * 2 ^ d\n\ngoal (1 subgoal):\n 1. l' = l + d", "by simp"], ["proof (state)\nthis:\n  l' = l + d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "have *: \"\\<And>i l. 2 ^ l = real_of_int (2 ^ l::int)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>i l. 2 ^ l = real_of_int (2 ^ l)", "by simp"], ["proof (state)\nthis:\n  2 ^ ?l = real_of_int (2 ^ ?l)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "have [arith]: \"0 < (2^d::int)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < 2 ^ d", "by simp"], ["proof (state)\nthis:\n  0 < 2 ^ d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "from \\<open>?right \\<or> ?left\\<close> \\<open>l \\<le> l'\\<close>"], ["proof (chain)\npicking this:\n  (i + 1) * 2 ^ d < i' \\<or> i' < (i - 1) * 2 ^ d\n  l \\<le> l'", "have empty_support: \"?sup l i \\<inter> ?sup l' i' = {}\""], ["proof (prove)\nusing this:\n  (i + 1) * 2 ^ d < i' \\<or> i' < (i - 1) * 2 ^ d\n  l \\<le> l'\n\ngoal (1 subgoal):\n 1. {real_of_int (i - 1) /\n     2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)} \\<inter>\n    {real_of_int (i' - 1) /\n     2 ^ (l' + 1)<..<real_of_int (i' + 1) / 2 ^ (l' + 1)} =\n    {}", "by (auto simp add: min_def max_def divide_simps l' power_add * of_int_mult[symmetric]\n                simp del: of_int_diff of_int_add of_int_mult of_int_power)\n       (simp_all add: field_simps)"], ["proof (state)\nthis:\n  {real_of_int (i - 1) /\n   2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)} \\<inter>\n  {real_of_int (i' - 1) /\n   2 ^ (l' + 1)<..<real_of_int (i' + 1) / 2 ^ (l' + 1)} =\n  {}\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "then"], ["proof (chain)\npicking this:\n  {real_of_int (i - 1) /\n   2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)} \\<inter>\n  {real_of_int (i' - 1) /\n   2 ^ (l' + 1)<..<real_of_int (i' + 1) / 2 ^ (l' + 1)} =\n  {}", "have \"\\<And>x. \\<phi> (l', i') x * \\<phi> (l, i) x = 0\""], ["proof (prove)\nusing this:\n  {real_of_int (i - 1) /\n   2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)} \\<inter>\n  {real_of_int (i' - 1) /\n   2 ^ (l' + 1)<..<real_of_int (i' + 1) / 2 ^ (l' + 1)} =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>x. \\<phi> (l', i') x * \\<phi> (l, i) x = 0", "unfolding \\<phi>_zero_iff mult_eq_0_iff"], ["proof (prove)\nusing this:\n  {real_of_int (i - 1) /\n   2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)} \\<inter>\n  {real_of_int (i' - 1) /\n   2 ^ (l' + 1)<..<real_of_int (i' + 1) / 2 ^ (l' + 1)} =\n  {}\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<notin> {real_of_int (i' - 1) /\n                   2 ^\n                   (l' + 1)<..<real_of_int (i' + 1) / 2 ^ (l' + 1)} \\<or>\n       x \\<notin> {real_of_int (i - 1) /\n                   2 ^ (l + 1)<..<real_of_int (i + 1) / 2 ^ (l + 1)}", "by blast"], ["proof (state)\nthis:\n  \\<phi> (l', i') ?x1 * \\<phi> (l, i) ?x1 = 0\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "then"], ["proof (chain)\npicking this:\n  \\<phi> (l', i') ?x1 * \\<phi> (l, i) ?x1 = 0", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<phi> (l', i') ?x1 * \\<phi> (l, i) ?x1 = 0\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) = 0", "by (simp add: l2_\\<phi>_def del: mult_eq_0_iff vector_space_over_itself.scale_eq_0_iff)"], ["proof (state)\nthis:\n  l2_\\<phi> (l', i') (l, i) = 0\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma l2_commutative: \"l2_\\<phi> p q = l2_\\<phi> q p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> p q = l2_\\<phi> q p", "by (simp add: l2_\\<phi>_def mult.commute)"], ["", "lemma l2_when_same: \"l2_\\<phi> (l, i) (l, i) = 1/3 / 2^l\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l, i) (l, i) = 1 / 3 / 2 ^ l", "proof (subst l2_\\<phi>I_DERIV)"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "let ?l = \"(2 :: real)^(l + 1)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "let ?in = \"real_of_int i - 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "let ?ip = \"real_of_int i + 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "let ?\\<phi> = \"\\<phi> (l,i)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "let ?\\<phi>2 = \"\\<lambda>x. ?\\<phi> x * ?\\<phi> x\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "{"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "fix x"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "assume \"x \\<in> {?in / ?l .. real_of_int i / ?l}\""], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i - 1) / 2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)}\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "hence \\<phi>_eq: \"?\\<phi> x = ?l * x  - ?in\""], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i - 1) / 2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)}\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 2 ^ (l + 1) * x - (real_of_int i - 1)", "using \\<phi>_left_support'"], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i - 1) / 2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)}\n  ?x \\<in> {real_of_int (?i - 1) /\n            2 ^ (?l + 1)..real_of_int ?i / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 + ?x * 2 ^ (?l + 1) - real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 2 ^ (l + 1) * x - (real_of_int i - 1)", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l, i) x = 2 ^ (l + 1) * x - (real_of_int i - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i - 1) /\n                2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i / 2 ^ (l + 1)) -\n    ?\\<Phi>_n ((real_of_int i - 1) / 2 ^ (l + 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "show \"DERIV (\\<lambda>x. x^3 / 3 * ?l^2 + x * ?in^2 - x^2/2 * 2 * ?l * ?in) x :> ?\\<phi>2 x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<lambda>x.\n         x ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n         x * (real_of_int i - 1)\\<^sup>2 -\n         x\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n         (real_of_int i - 1)) has_real_derivative\n     \\<phi> (l, i) x * \\<phi> (l, i) x)\n     (at x)", "by (auto intro!: derivative_eq_intros simp add: power2_eq_square field_simps \\<phi>_eq)"], ["proof (state)\nthis:\n  ((\\<lambda>x.\n       x ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 + x * (real_of_int i - 1)\\<^sup>2 -\n       x\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n       (real_of_int i - 1)) has_real_derivative\n   \\<phi> (l, i) x * \\<phi> (l, i) x)\n   (at x)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i - 1) /\n         2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n  ((\\<lambda>x.\n       x ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 + x * (real_of_int i - 1)\\<^sup>2 -\n       x\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n       (real_of_int i - 1)) has_real_derivative\n   \\<phi> (l, i) ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "{"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i - 1) /\n         2 ^ (l + 1)..real_of_int i / 2 ^ (l + 1)} \\<Longrightarrow>\n  ((\\<lambda>x.\n       x ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 + x * (real_of_int i - 1)\\<^sup>2 -\n       x\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n       (real_of_int i - 1)) has_real_derivative\n   \\<phi> (l, i) ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "fix x"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "assume \"x \\<in> {real_of_int i / ?l .. ?ip / ?l}\""], ["proof (state)\nthis:\n  x \\<in> {real_of_int i / 2 ^ (l + 1)..(real_of_int i + 1) / 2 ^ (l + 1)}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "hence \\<phi>_eq: \"?\\<phi> x = ?ip - ?l * x\""], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i / 2 ^ (l + 1)..(real_of_int i + 1) / 2 ^ (l + 1)}\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = real_of_int i + 1 - 2 ^ (l + 1) * x", "using \\<phi>_right_support'"], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i / 2 ^ (l + 1)..(real_of_int i + 1) / 2 ^ (l + 1)}\n  ?x \\<in> {real_of_int ?i /\n            2 ^\n            (?l + 1)..real_of_int (?i + 1) / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 - ?x * 2 ^ (?l + 1) + real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = real_of_int i + 1 - 2 ^ (l + 1) * x", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l, i) x = real_of_int i + 1 - 2 ^ (l + 1) * x\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i /\n                2 ^\n                (l +\n                 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l, i) x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (?\\<Phi>_p ((real_of_int i + 1) / 2 ^ (l + 1)) -\n     ?\\<Phi>_p (real_of_int i / 2 ^ (l + 1))) =\n    1 / 3 / 2 ^ l", "show \"DERIV (\\<lambda>x. x^3 / 3 * ?l^2 + x * ?ip^2 - x^2/2 * 2 * ?l * ?ip) x :> ?\\<phi>2 x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<lambda>x.\n         x ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n         x * (real_of_int i + 1)\\<^sup>2 -\n         x\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n         (real_of_int i + 1)) has_real_derivative\n     \\<phi> (l, i) x * \\<phi> (l, i) x)\n     (at x)", "by (auto intro!: derivative_eq_intros simp add: power2_eq_square field_simps \\<phi>_eq)"], ["proof (state)\nthis:\n  ((\\<lambda>x.\n       x ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 + x * (real_of_int i + 1)\\<^sup>2 -\n       x\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n       (real_of_int i + 1)) has_real_derivative\n   \\<phi> (l, i) x * \\<phi> (l, i) x)\n   (at x)\n\ngoal (1 subgoal):\n 1. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (((real_of_int i + 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i + 1) / 2 ^ (l + 1) * (real_of_int i + 1)\\<^sup>2 -\n     ((real_of_int i + 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i + 1) -\n     ((real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n      real_of_int i / 2 ^ (l + 1) * (real_of_int i + 1)\\<^sup>2 -\n      (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n      (real_of_int i + 1))) =\n    1 / 3 / 2 ^ l", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {real_of_int i /\n         2 ^ (l + 1)..(real_of_int i + 1) / 2 ^ (l + 1)} \\<Longrightarrow>\n  ((\\<lambda>x.\n       x ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 + x * (real_of_int i + 1)\\<^sup>2 -\n       x\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n       (real_of_int i + 1)) has_real_derivative\n   \\<phi> (l, i) ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (1 subgoal):\n 1. (real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n    real_of_int i / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n    (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n    (real_of_int i - 1) -\n    (((real_of_int i - 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i - 1) / 2 ^ (l + 1) * (real_of_int i - 1)\\<^sup>2 -\n     ((real_of_int i - 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i - 1)) +\n    (((real_of_int i + 1) / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n     (real_of_int i + 1) / 2 ^ (l + 1) * (real_of_int i + 1)\\<^sup>2 -\n     ((real_of_int i + 1) / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n     (real_of_int i + 1) -\n     ((real_of_int i / 2 ^ (l + 1)) ^ 3 / 3 * (2 ^ (l + 1))\\<^sup>2 +\n      real_of_int i / 2 ^ (l + 1) * (real_of_int i + 1)\\<^sup>2 -\n      (real_of_int i / 2 ^ (l + 1))\\<^sup>2 / 2 * 2 * 2 ^ (l + 1) *\n      (real_of_int i + 1))) =\n    1 / 3 / 2 ^ l", "qed (simp_all add: field_simps power_eq_if[of _ 2] power_eq_if[of _ 3])"], ["", "lemma l2_when_left_child:\n  assumes \"l < l'\"\n  and i'_bot: \"i' > (i - 1) * 2^(l' - l)\"\n  and i'_top: \"i' < i * 2^(l' - l)\"\n  shows \"l2_\\<phi> (l', i') (l, i) = (1 + real_of_int i' / 2^(l' - l) - real_of_int i) / 2^(l' + 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "proof (subst l2_\\<phi>I_DERIV)"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let ?l' = \"(2 :: real)^(l' + 1)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let ?in' = \"real_of_int i' - 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let ?ip' = \"real_of_int i' + 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let ?l = \"(2 :: real)^(l + 1)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let ?i = \"real_of_int i - 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let ?\\<phi>' = \"\\<phi> (l',i')\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let ?\\<phi> = \"\\<phi> (l, i)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "let \"?\\<phi>2 x\" = \"?\\<phi>' x * ?\\<phi> x\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "define \\<Phi>_n where \"\\<Phi>_n x = x^3 / 3 * ?l' * ?l + x * ?i * ?in' - x^2 / 2 * (?in' * ?l + ?i * ?l')\" for x"], ["proof (state)\nthis:\n  \\<Phi>_n ?x =\n  ?x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n  ?x * (real_of_int i - 1) * (real_of_int i' - 1) -\n  ?x\\<^sup>2 / 2 *\n  ((real_of_int i' - 1) * 2 ^ (l + 1) + (real_of_int i - 1) * 2 ^ (l' + 1))\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "define \\<Phi>_p where \"\\<Phi>_p x = x^2 / 2 * (?ip' * ?l + ?i * ?l') - x^3 / 3 * ?l' * ?l - x * ?i * ?ip'\" for x"], ["proof (state)\nthis:\n  \\<Phi>_p ?x =\n  ?x\\<^sup>2 / 2 *\n  ((real_of_int i' + 1) * 2 ^ (l + 1) +\n   (real_of_int i - 1) * 2 ^ (l' + 1)) -\n  ?x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n  ?x * (real_of_int i - 1) * (real_of_int i' + 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "have level_diff: \"2^(l' - l) = 2^l' / (2^l :: real)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 ^ (l' - l) = 2 ^ l' / 2 ^ l", "using power_diff[of \"2::real\" l l'] \\<open>l < l'\\<close>"], ["proof (prove)\nusing this:\n  \\<lbrakk>2 \\<noteq> 0; l \\<le> l'\\<rbrakk>\n  \\<Longrightarrow> 2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n  l < l'\n\ngoal (1 subgoal):\n 1. 2 ^ (l' - l) = 2 ^ l' / 2 ^ l", "by auto"], ["proof (state)\nthis:\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "{"], ["proof (state)\nthis:\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "fix x"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "assume x: \"x \\<in> {?in' / ?l' .. ?ip' / ?l'}\""], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "have \"?i * 2^(l' - l) \\<le> ?in'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (real_of_int i - 1) * 2 ^ (l' - l) \\<le> real_of_int i' - 1", "using i'_bot int_less_real_le"], ["proof (prove)\nusing this:\n  (i - 1) * 2 ^ (l' - l) < i'\n  (?n < ?m) = (real_of_int ?n + 1 \\<le> real_of_int ?m)\n\ngoal (1 subgoal):\n 1. (real_of_int i - 1) * 2 ^ (l' - l) \\<le> real_of_int i' - 1", "by auto"], ["proof (state)\nthis:\n  (real_of_int i - 1) * 2 ^ (l' - l) \\<le> real_of_int i' - 1\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "hence \"?i / ?l \\<le> ?in' / ?l'\""], ["proof (prove)\nusing this:\n  (real_of_int i - 1) * 2 ^ (l' - l) \\<le> real_of_int i' - 1\n\ngoal (1 subgoal):\n 1. (real_of_int i - 1) / 2 ^ (l + 1)\n    \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)", "using level_diff"], ["proof (prove)\nusing this:\n  (real_of_int i - 1) * 2 ^ (l' - l) \\<le> real_of_int i' - 1\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (1 subgoal):\n 1. (real_of_int i - 1) / 2 ^ (l + 1)\n    \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)", "by (auto simp: field_simps)"], ["proof (state)\nthis:\n  (real_of_int i - 1) / 2 ^ (l + 1)\n  \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "hence \"?i / ?l \\<le> x\""], ["proof (prove)\nusing this:\n  (real_of_int i - 1) / 2 ^ (l + 1)\n  \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)\n\ngoal (1 subgoal):\n 1. (real_of_int i - 1) / 2 ^ (l + 1) \\<le> x", "using x"], ["proof (prove)\nusing this:\n  (real_of_int i - 1) / 2 ^ (l + 1)\n  \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. (real_of_int i - 1) / 2 ^ (l + 1) \\<le> x", "by auto"], ["proof (state)\nthis:\n  (real_of_int i - 1) / 2 ^ (l + 1) \\<le> x\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "moreover"], ["proof (state)\nthis:\n  (real_of_int i - 1) / 2 ^ (l + 1) \\<le> x\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "have \"?ip' \\<le> real_of_int i * 2^(l' - l)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real_of_int i' + 1 \\<le> real_of_int i * 2 ^ (l' - l)", "using i'_top int_less_real_le"], ["proof (prove)\nusing this:\n  i' < i * 2 ^ (l' - l)\n  (?n < ?m) = (real_of_int ?n + 1 \\<le> real_of_int ?m)\n\ngoal (1 subgoal):\n 1. real_of_int i' + 1 \\<le> real_of_int i * 2 ^ (l' - l)", "by auto"], ["proof (state)\nthis:\n  real_of_int i' + 1 \\<le> real_of_int i * 2 ^ (l' - l)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "hence ip'_le_i: \"?ip' / ?l' \\<le> real_of_int i / ?l\""], ["proof (prove)\nusing this:\n  real_of_int i' + 1 \\<le> real_of_int i * 2 ^ (l' - l)\n\ngoal (1 subgoal):\n 1. (real_of_int i' + 1) / 2 ^ (l' + 1) \\<le> real_of_int i / 2 ^ (l + 1)", "using level_diff"], ["proof (prove)\nusing this:\n  real_of_int i' + 1 \\<le> real_of_int i * 2 ^ (l' - l)\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (1 subgoal):\n 1. (real_of_int i' + 1) / 2 ^ (l' + 1) \\<le> real_of_int i / 2 ^ (l + 1)", "by (auto simp: field_simps)"], ["proof (state)\nthis:\n  (real_of_int i' + 1) / 2 ^ (l' + 1) \\<le> real_of_int i / 2 ^ (l + 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "hence \"x \\<le> real_of_int i / ?l\""], ["proof (prove)\nusing this:\n  (real_of_int i' + 1) / 2 ^ (l' + 1) \\<le> real_of_int i / 2 ^ (l + 1)\n\ngoal (1 subgoal):\n 1. x \\<le> real_of_int i / 2 ^ (l + 1)", "using x"], ["proof (prove)\nusing this:\n  (real_of_int i' + 1) / 2 ^ (l' + 1) \\<le> real_of_int i / 2 ^ (l + 1)\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. x \\<le> real_of_int i / 2 ^ (l + 1)", "by auto"], ["proof (state)\nthis:\n  x \\<le> real_of_int i / 2 ^ (l + 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "ultimately"], ["proof (chain)\npicking this:\n  (real_of_int i - 1) / 2 ^ (l + 1) \\<le> x\n  x \\<le> real_of_int i / 2 ^ (l + 1)", "have \"?\\<phi> x = ?l * x  - ?i\""], ["proof (prove)\nusing this:\n  (real_of_int i - 1) / 2 ^ (l + 1) \\<le> x\n  x \\<le> real_of_int i / 2 ^ (l + 1)\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 2 ^ (l + 1) * x - (real_of_int i - 1)", "using \\<phi>_left_support'"], ["proof (prove)\nusing this:\n  (real_of_int i - 1) / 2 ^ (l + 1) \\<le> x\n  x \\<le> real_of_int i / 2 ^ (l + 1)\n  ?x \\<in> {real_of_int (?i - 1) /\n            2 ^ (?l + 1)..real_of_int ?i / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 + ?x * 2 ^ (?l + 1) - real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = 2 ^ (l + 1) * x - (real_of_int i - 1)", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l, i) x = 2 ^ (l + 1) * x - (real_of_int i - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  \\<phi> (l, i) ?x2 = 2 ^ (l + 1) * ?x2 - (real_of_int i - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "note \\<phi>_eq = this"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  \\<phi> (l, i) ?x2 = 2 ^ (l + 1) * ?x2 - (real_of_int i - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "{"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  \\<phi> (l, i) ?x2 = 2 ^ (l + 1) * ?x2 - (real_of_int i - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "fix x"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "assume x: \"x \\<in> {?in' / ?l' .. real_of_int i' / ?l'}\""], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "hence \\<phi>'_eq: \"?\\<phi>' x = ?l' * x  - ?in'\""], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = 2 ^ (l' + 1) * x - (real_of_int i' - 1)", "using \\<phi>_left_support'"], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n  ?x \\<in> {real_of_int (?i - 1) /\n            2 ^ (?l + 1)..real_of_int ?i / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 + ?x * 2 ^ (?l + 1) - real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = 2 ^ (l' + 1) * x - (real_of_int i' - 1)", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l', i') x = 2 ^ (l' + 1) * x - (real_of_int i' - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "from x"], ["proof (chain)\npicking this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}", "have x': \"x \\<in> {?in' / ?l' .. ?ip' / ?l'}\""], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. x \\<in> {(real_of_int i' - 1) /\n             2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}", "by (auto simp add: field_simps)"], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "show \"DERIV \\<Phi>_n x :> ?\\<phi>2 x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n     (at x)", "unfolding \\<phi>_eq[OF x'] \\<phi>'_eq \\<Phi>_n_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<lambda>x.\n         x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n         x * (real_of_int i - 1) * (real_of_int i' - 1) -\n         x\\<^sup>2 / 2 *\n         ((real_of_int i' - 1) * 2 ^ (l + 1) +\n          (real_of_int i - 1) * 2 ^ (l' + 1))) has_real_derivative\n     (2 ^ (l' + 1) * x - (real_of_int i' - 1)) *\n     (2 ^ (l + 1) * x - (real_of_int i - 1)))\n     (at x)", "by (auto intro!: derivative_eq_intros simp add: power2_eq_square algebra_simps)"], ["proof (state)\nthis:\n  (\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x) (at x)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n  (\\<Phi>_n has_real_derivative \\<phi> (l', i') ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "{"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n  (\\<Phi>_n has_real_derivative \\<phi> (l', i') ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "fix x"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "assume x: \"x \\<in> {real_of_int i' / ?l' .. ?ip' / ?l'}\""], ["proof (state)\nthis:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "hence \\<phi>'_eq: \"?\\<phi>' x = ?ip' - ?l' * x\""], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = real_of_int i' + 1 - 2 ^ (l' + 1) * x", "using \\<phi>_right_support'"], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n  ?x \\<in> {real_of_int ?i /\n            2 ^\n            (?l + 1)..real_of_int (?i + 1) / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 - ?x * 2 ^ (?l + 1) + real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = real_of_int i' + 1 - 2 ^ (l' + 1) * x", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l', i') x = real_of_int i' + 1 - 2 ^ (l' + 1) * x\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "from x"], ["proof (chain)\npicking this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}", "have x': \"x \\<in> {?in' / ?l' .. ?ip' / ?l'}\""], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. x \\<in> {(real_of_int i' - 1) /\n             2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}", "by (simp add: field_simps)"], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "show \"DERIV \\<Phi>_p x :> ?\\<phi>2 x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n     (at x)", "unfolding \\<phi>_eq[OF x'] \\<phi>'_eq \\<Phi>_p_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<lambda>x.\n         x\\<^sup>2 / 2 *\n         ((real_of_int i' + 1) * 2 ^ (l + 1) +\n          (real_of_int i - 1) * 2 ^ (l' + 1)) -\n         x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n         x * (real_of_int i - 1) * (real_of_int i' + 1)) has_real_derivative\n     (real_of_int i' + 1 - 2 ^ (l' + 1) * x) *\n     (2 ^ (l + 1) * x - (real_of_int i - 1)))\n     (at x)", "by (auto intro!: derivative_eq_intros simp add: power2_eq_square algebra_simps)"], ["proof (state)\nthis:\n  (\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x) (at x)\n\ngoal (1 subgoal):\n 1. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (((real_of_int i' + 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' + 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' + 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' + 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' + 1) -\n     ((real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n      ((real_of_int i' + 1) * 2 ^ (l + 1) +\n       (real_of_int i - 1) * 2 ^ (l' + 1)) -\n      (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n      real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n      (real_of_int i' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {real_of_int i' /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  (\\<Phi>_p has_real_derivative \\<phi> (l', i') ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (1 subgoal):\n 1. (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n    (real_of_int i' - 1) -\n    (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i - 1) * 2 ^ (l' + 1)) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' - 1) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1))) +\n    (((real_of_int i' + 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' + 1) * 2 ^ (l + 1) +\n      (real_of_int i - 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' + 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' + 1) / 2 ^ (l' + 1) * (real_of_int i - 1) *\n     (real_of_int i' + 1) -\n     ((real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n      ((real_of_int i' + 1) * 2 ^ (l + 1) +\n       (real_of_int i - 1) * 2 ^ (l' + 1)) -\n      (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n      real_of_int i' / 2 ^ (l' + 1) * (real_of_int i - 1) *\n      (real_of_int i' + 1))) =\n    (1 + real_of_int i' / 2 ^ (l' - l) - real_of_int i) / 2 ^ (l' + 1)", "qed (simp_all add: field_simps power_eq_if[of _ 2] power_eq_if[of _ 3] power_diff[of \"2::real\", OF _ \\<open>l < l'\\<close>[THEN less_imp_le]] )"], ["", "lemma l2_when_right_child:\n  assumes \"l < l'\"\n  and i'_bot: \"i' > i * 2^(l' - l)\"\n  and i'_top: \"i' < (i + 1) * 2^(l' - l)\"\n  shows \"l2_\\<phi> (l', i') (l, i) = (1 - real_of_int i' / 2^(l' - l) + real_of_int i) / 2^(l' + 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (l', i') (l, i) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "proof (subst l2_\\<phi>I_DERIV)"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?l' = \"(2 :: real)^(l' + 1)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?in' = \"real_of_int i' - 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?ip' = \"real_of_int i' + 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?l = \"(2 :: real)^(l + 1)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?i = \"real_of_int i + 1\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?\\<phi>' = \"\\<phi> (l',i')\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?\\<phi> = \"\\<phi> (l, i)\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "let ?\\<phi>2 = \"\\<lambda>x. ?\\<phi>' x * ?\\<phi> x\""], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "define \\<Phi>_n where \"\\<Phi>_n x = x^2 / 2 * (?in' * ?l + ?i * ?l') - x^3 / 3 * ?l' * ?l - x * ?i * ?in'\" for x"], ["proof (state)\nthis:\n  \\<Phi>_n ?x =\n  ?x\\<^sup>2 / 2 *\n  ((real_of_int i' - 1) * 2 ^ (l + 1) +\n   (real_of_int i + 1) * 2 ^ (l' + 1)) -\n  ?x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n  ?x * (real_of_int i + 1) * (real_of_int i' - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "define \\<Phi>_p where \"\\<Phi>_p x = x^3 / 3 * ?l' * ?l + x * ?i * ?ip' - x^2 / 2 * (?ip' * ?l + ?i * ?l')\" for x"], ["proof (state)\nthis:\n  \\<Phi>_p ?x =\n  ?x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n  ?x * (real_of_int i + 1) * (real_of_int i' + 1) -\n  ?x\\<^sup>2 / 2 *\n  ((real_of_int i' + 1) * 2 ^ (l + 1) + (real_of_int i + 1) * 2 ^ (l' + 1))\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "have level_diff: \"2^(l' - l) = 2^l' / (2^l :: real)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 ^ (l' - l) = 2 ^ l' / 2 ^ l", "using power_diff[of \"2::real\" l l'] \\<open>l < l'\\<close>"], ["proof (prove)\nusing this:\n  \\<lbrakk>2 \\<noteq> 0; l \\<le> l'\\<rbrakk>\n  \\<Longrightarrow> 2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n  l < l'\n\ngoal (1 subgoal):\n 1. 2 ^ (l' - l) = 2 ^ l' / 2 ^ l", "by auto"], ["proof (state)\nthis:\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "{"], ["proof (state)\nthis:\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "fix x"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "assume x: \"x \\<in> {?in' / ?l' .. ?ip' / ?l'}\""], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "have \"real_of_int i * 2^(l' - l) \\<le> ?in'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real_of_int i * 2 ^ (l' - l) \\<le> real_of_int i' - 1", "using i'_bot int_less_real_le"], ["proof (prove)\nusing this:\n  i * 2 ^ (l' - l) < i'\n  (?n < ?m) = (real_of_int ?n + 1 \\<le> real_of_int ?m)\n\ngoal (1 subgoal):\n 1. real_of_int i * 2 ^ (l' - l) \\<le> real_of_int i' - 1", "by auto"], ["proof (state)\nthis:\n  real_of_int i * 2 ^ (l' - l) \\<le> real_of_int i' - 1\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "hence \"real_of_int i / ?l \\<le> ?in' / ?l'\""], ["proof (prove)\nusing this:\n  real_of_int i * 2 ^ (l' - l) \\<le> real_of_int i' - 1\n\ngoal (1 subgoal):\n 1. real_of_int i / 2 ^ (l + 1) \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)", "using level_diff"], ["proof (prove)\nusing this:\n  real_of_int i * 2 ^ (l' - l) \\<le> real_of_int i' - 1\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (1 subgoal):\n 1. real_of_int i / 2 ^ (l + 1) \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)", "by (auto simp: field_simps)"], ["proof (state)\nthis:\n  real_of_int i / 2 ^ (l + 1) \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "hence \"real_of_int i / ?l \\<le> x\""], ["proof (prove)\nusing this:\n  real_of_int i / 2 ^ (l + 1) \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)\n\ngoal (1 subgoal):\n 1. real_of_int i / 2 ^ (l + 1) \\<le> x", "using x"], ["proof (prove)\nusing this:\n  real_of_int i / 2 ^ (l + 1) \\<le> (real_of_int i' - 1) / 2 ^ (l' + 1)\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. real_of_int i / 2 ^ (l + 1) \\<le> x", "by auto"], ["proof (state)\nthis:\n  real_of_int i / 2 ^ (l + 1) \\<le> x\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "moreover"], ["proof (state)\nthis:\n  real_of_int i / 2 ^ (l + 1) \\<le> x\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "have \"?ip' \\<le> ?i * 2^(l' - l)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real_of_int i' + 1 \\<le> (real_of_int i + 1) * 2 ^ (l' - l)", "using i'_top int_less_real_le"], ["proof (prove)\nusing this:\n  i' < (i + 1) * 2 ^ (l' - l)\n  (?n < ?m) = (real_of_int ?n + 1 \\<le> real_of_int ?m)\n\ngoal (1 subgoal):\n 1. real_of_int i' + 1 \\<le> (real_of_int i + 1) * 2 ^ (l' - l)", "by auto"], ["proof (state)\nthis:\n  real_of_int i' + 1 \\<le> (real_of_int i + 1) * 2 ^ (l' - l)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "hence ip'_le_i: \"?ip' / ?l' \\<le> ?i / ?l\""], ["proof (prove)\nusing this:\n  real_of_int i' + 1 \\<le> (real_of_int i + 1) * 2 ^ (l' - l)\n\ngoal (1 subgoal):\n 1. (real_of_int i' + 1) / 2 ^ (l' + 1)\n    \\<le> (real_of_int i + 1) / 2 ^ (l + 1)", "using level_diff"], ["proof (prove)\nusing this:\n  real_of_int i' + 1 \\<le> (real_of_int i + 1) * 2 ^ (l' - l)\n  2 ^ (l' - l) = 2 ^ l' / 2 ^ l\n\ngoal (1 subgoal):\n 1. (real_of_int i' + 1) / 2 ^ (l' + 1)\n    \\<le> (real_of_int i + 1) / 2 ^ (l + 1)", "by (auto simp: field_simps)"], ["proof (state)\nthis:\n  (real_of_int i' + 1) / 2 ^ (l' + 1)\n  \\<le> (real_of_int i + 1) / 2 ^ (l + 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "hence \"x \\<le> ?i / ?l\""], ["proof (prove)\nusing this:\n  (real_of_int i' + 1) / 2 ^ (l' + 1)\n  \\<le> (real_of_int i + 1) / 2 ^ (l + 1)\n\ngoal (1 subgoal):\n 1. x \\<le> (real_of_int i + 1) / 2 ^ (l + 1)", "using x"], ["proof (prove)\nusing this:\n  (real_of_int i' + 1) / 2 ^ (l' + 1)\n  \\<le> (real_of_int i + 1) / 2 ^ (l + 1)\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. x \\<le> (real_of_int i + 1) / 2 ^ (l + 1)", "by auto"], ["proof (state)\nthis:\n  x \\<le> (real_of_int i + 1) / 2 ^ (l + 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "ultimately"], ["proof (chain)\npicking this:\n  real_of_int i / 2 ^ (l + 1) \\<le> x\n  x \\<le> (real_of_int i + 1) / 2 ^ (l + 1)", "have \"?\\<phi> x = ?i - ?l * x\""], ["proof (prove)\nusing this:\n  real_of_int i / 2 ^ (l + 1) \\<le> x\n  x \\<le> (real_of_int i + 1) / 2 ^ (l + 1)\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = real_of_int i + 1 - 2 ^ (l + 1) * x", "using \\<phi>_right_support'"], ["proof (prove)\nusing this:\n  real_of_int i / 2 ^ (l + 1) \\<le> x\n  x \\<le> (real_of_int i + 1) / 2 ^ (l + 1)\n  ?x \\<in> {real_of_int ?i /\n            2 ^\n            (?l + 1)..real_of_int (?i + 1) / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 - ?x * 2 ^ (?l + 1) + real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l, i) x = real_of_int i + 1 - 2 ^ (l + 1) * x", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l, i) x = real_of_int i + 1 - 2 ^ (l + 1) * x\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  \\<phi> (l, i) ?x2 = real_of_int i + 1 - 2 ^ (l + 1) * ?x2\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "note \\<phi>_eq = this"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  \\<phi> (l, i) ?x2 = real_of_int i + 1 - 2 ^ (l + 1) * ?x2\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "{"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  \\<phi> (l, i) ?x2 = real_of_int i + 1 - 2 ^ (l + 1) * ?x2\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "fix x"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "assume x: \"x \\<in> {?in' / ?l' .. real_of_int i' / ?l'}\""], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "hence \\<phi>'_eq: \"?\\<phi>' x = ?l' * x  - ?in'\""], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = 2 ^ (l' + 1) * x - (real_of_int i' - 1)", "using \\<phi>_left_support'"], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n  ?x \\<in> {real_of_int (?i - 1) /\n            2 ^ (?l + 1)..real_of_int ?i / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 + ?x * 2 ^ (?l + 1) - real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = 2 ^ (l' + 1) * x - (real_of_int i' - 1)", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l', i') x = 2 ^ (l' + 1) * x - (real_of_int i' - 1)\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "from x"], ["proof (chain)\npicking this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}", "have x': \"x \\<in> {?in' / ?l' .. ?ip' / ?l'}\""], ["proof (prove)\nusing this:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. x \\<in> {(real_of_int i' - 1) /\n             2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}", "by (simp add: field_simps)"], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       x \\<in> {(real_of_int i' - 1) /\n                2 ^\n                (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 3. ?\\<Phi>_n (real_of_int i' / 2 ^ (l' + 1)) -\n    ?\\<Phi>_n ((real_of_int i' - 1) / 2 ^ (l' + 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "show \"DERIV \\<Phi>_n x :> ?\\<phi>2 x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n     (at x)", "unfolding \\<Phi>_n_def \\<phi>_eq[OF x'] \\<phi>'_eq"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<lambda>x.\n         x\\<^sup>2 / 2 *\n         ((real_of_int i' - 1) * 2 ^ (l + 1) +\n          (real_of_int i + 1) * 2 ^ (l' + 1)) -\n         x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n         x * (real_of_int i + 1) * (real_of_int i' - 1)) has_real_derivative\n     (2 ^ (l' + 1) * x - (real_of_int i' - 1)) *\n     (real_of_int i + 1 - 2 ^ (l + 1) * x))\n     (at x)", "by (auto intro!: derivative_eq_intros simp add: simp add: power2_eq_square algebra_simps)"], ["proof (state)\nthis:\n  (\\<Phi>_n has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x) (at x)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n  (\\<Phi>_n has_real_derivative \\<phi> (l', i') ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "{"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {(real_of_int i' - 1) /\n         2 ^ (l' + 1)..real_of_int i' / 2 ^ (l' + 1)} \\<Longrightarrow>\n  (\\<Phi>_n has_real_derivative \\<phi> (l', i') ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "fix x"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "assume x: \"x \\<in> {real_of_int i' / ?l' .. ?ip' / ?l'}\""], ["proof (state)\nthis:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "hence \\<phi>'_eq: \"?\\<phi>' x = ?ip' - ?l' * x\""], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = real_of_int i' + 1 - 2 ^ (l' + 1) * x", "using \\<phi>_right_support'"], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n  ?x \\<in> {real_of_int ?i /\n            2 ^\n            (?l + 1)..real_of_int (?i + 1) / 2 ^ (?l + 1)} \\<Longrightarrow>\n  \\<phi> (?l, ?i) ?x = 1 - ?x * 2 ^ (?l + 1) + real_of_int ?i\n\ngoal (1 subgoal):\n 1. \\<phi> (l', i') x = real_of_int i' + 1 - 2 ^ (l' + 1) * x", "by auto"], ["proof (state)\nthis:\n  \\<phi> (l', i') x = real_of_int i' + 1 - 2 ^ (l' + 1) * x\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "from x"], ["proof (chain)\npicking this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}", "have x': \"x \\<in> {?in' / ?l' .. ?ip' / ?l'}\""], ["proof (prove)\nusing this:\n  x \\<in> {real_of_int i' /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (1 subgoal):\n 1. x \\<in> {(real_of_int i' - 1) /\n             2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}", "by (auto simp: field_simps)"], ["proof (state)\nthis:\n  x \\<in> {(real_of_int i' - 1) /\n           2 ^ (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> {real_of_int i' /\n                2 ^\n                (l' +\n                 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n       (?\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n        (at x)\n 2. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (?\\<Phi>_p ((real_of_int i' + 1) / 2 ^ (l' + 1)) -\n     ?\\<Phi>_p (real_of_int i' / 2 ^ (l' + 1))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "show \"DERIV \\<Phi>_p x :> ?\\<phi>2 x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x)\n     (at x)", "unfolding \\<phi>_eq[OF x'] \\<phi>'_eq \\<Phi>_p_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<lambda>x.\n         x ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n         x * (real_of_int i + 1) * (real_of_int i' + 1) -\n         x\\<^sup>2 / 2 *\n         ((real_of_int i' + 1) * 2 ^ (l + 1) +\n          (real_of_int i + 1) * 2 ^ (l' + 1))) has_real_derivative\n     (real_of_int i' + 1 - 2 ^ (l' + 1) * x) *\n     (real_of_int i + 1 - 2 ^ (l + 1) * x))\n     (at x)", "by (auto intro!: derivative_eq_intros simp add: power2_eq_square algebra_simps)"], ["proof (state)\nthis:\n  (\\<Phi>_p has_real_derivative \\<phi> (l', i') x * \\<phi> (l, i) x) (at x)\n\ngoal (1 subgoal):\n 1. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (((real_of_int i' + 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' + 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' + 1) -\n     ((real_of_int i' + 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' + 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n      real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n      (real_of_int i' + 1) -\n      (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n      ((real_of_int i' + 1) * 2 ^ (l + 1) +\n       (real_of_int i + 1) * 2 ^ (l' + 1)))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "}"], ["proof (state)\nthis:\n  ?x2\n  \\<in> {real_of_int i' /\n         2 ^\n         (l' + 1)..(real_of_int i' + 1) / 2 ^ (l' + 1)} \\<Longrightarrow>\n  (\\<Phi>_p has_real_derivative \\<phi> (l', i') ?x2 * \\<phi> (l, i) ?x2)\n   (at ?x2)\n\ngoal (1 subgoal):\n 1. (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n    ((real_of_int i' - 1) * 2 ^ (l + 1) +\n     (real_of_int i + 1) * 2 ^ (l' + 1)) -\n    (real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) -\n    real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n    (real_of_int i' - 1) -\n    (((real_of_int i' - 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' - 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' - 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) -\n     (real_of_int i' - 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' - 1)) +\n    (((real_of_int i' + 1) / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) *\n     2 ^ (l + 1) +\n     (real_of_int i' + 1) / 2 ^ (l' + 1) * (real_of_int i + 1) *\n     (real_of_int i' + 1) -\n     ((real_of_int i' + 1) / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n     ((real_of_int i' + 1) * 2 ^ (l + 1) +\n      (real_of_int i + 1) * 2 ^ (l' + 1)) -\n     ((real_of_int i' / 2 ^ (l' + 1)) ^ 3 / 3 * 2 ^ (l' + 1) * 2 ^ (l + 1) +\n      real_of_int i' / 2 ^ (l' + 1) * (real_of_int i + 1) *\n      (real_of_int i' + 1) -\n      (real_of_int i' / 2 ^ (l' + 1))\\<^sup>2 / 2 *\n      ((real_of_int i' + 1) * 2 ^ (l + 1) +\n       (real_of_int i + 1) * 2 ^ (l' + 1)))) =\n    (1 - real_of_int i' / 2 ^ (l' - l) + real_of_int i) / 2 ^ (l' + 1)", "qed (simp_all add: field_simps power_eq_if[of _ 2] power_eq_if[of _ 3] power_diff[of \"2::real\", OF _ \\<open>l < l'\\<close>[THEN less_imp_le]] )"], ["", "lemma level_shift: \"lc > l \\<Longrightarrow> (x :: real) / 2 ^ (lc - Suc l) = x * 2 / 2 ^ (lc - l)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l < lc \\<Longrightarrow> x / 2 ^ (lc - Suc l) = x * 2 / 2 ^ (lc - l)", "by (auto simp add: power_diff)"], ["", "lemma l2_child: assumes \"d < length b\"\n  and p_grid: \"p \\<in> grid (child b dir d) ds\" (is \"p \\<in> grid ?child ds\")\n  shows \"l2_\\<phi> (p ! d) (b ! d) = (1 - real_of_int (sgn dir) * (real_of_int (ix p d) / 2^(lv p d - lv b d) - real_of_int (ix b d))) /\n                                 2^(lv p d + 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "have \"lv ?child d \\<le> lv p d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. lv (child b dir d) d \\<le> lv p d", "using \\<open>d < length b\\<close> and p_grid"], ["proof (prove)\nusing this:\n  d < length b\n  p \\<in> grid (child b dir d) ds\n\ngoal (1 subgoal):\n 1. lv (child b dir d) d \\<le> lv p d", "using grid_single_level"], ["proof (prove)\nusing this:\n  d < length b\n  p \\<in> grid (child b dir d) ds\n  \\<lbrakk>?p \\<in> grid ?b ?ds; ?d < length ?b\\<rbrakk>\n  \\<Longrightarrow> lv ?b ?d \\<le> lv ?p ?d\n\ngoal (1 subgoal):\n 1. lv (child b dir d) d \\<le> lv p d", "by auto"], ["proof (state)\nthis:\n  lv (child b dir d) d \\<le> lv p d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "hence \"lv b d < lv p d\""], ["proof (prove)\nusing this:\n  lv (child b dir d) d \\<le> lv p d\n\ngoal (1 subgoal):\n 1. lv b d < lv p d", "using \\<open>d < length b\\<close> and p_grid"], ["proof (prove)\nusing this:\n  lv (child b dir d) d \\<le> lv p d\n  d < length b\n  p \\<in> grid (child b dir d) ds\n\ngoal (1 subgoal):\n 1. lv b d < lv p d", "using child_lv"], ["proof (prove)\nusing this:\n  lv (child b dir d) d \\<le> lv p d\n  d < length b\n  p \\<in> grid (child b dir d) ds\n  ?d < length ?p \\<Longrightarrow> lv (child ?p ?dir ?d) ?d = lv ?p ?d + 1\n\ngoal (1 subgoal):\n 1. lv b d < lv p d", "by auto"], ["proof (state)\nthis:\n  lv b d < lv p d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "let ?i_c = \"ix ?child d\" and ?l_c = \"lv ?child d\""], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "let ?i_p = \"ix p d\" and ?l_p = \"lv p d\""], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "let ?i_b = \"ix b d\" and ?l_b = \"lv b d\""], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "have \"(2::int) * 2^(?l_p - ?l_c) = 2^Suc (?l_p - ?l_c)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 * 2 ^ (lv p d - lv (child b dir d) d) =\n    2 ^ Suc (lv p d - lv (child b dir d) d)", "by auto"], ["proof (state)\nthis:\n  2 * 2 ^ (lv p d - lv (child b dir d) d) =\n  2 ^ Suc (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "also"], ["proof (state)\nthis:\n  2 * 2 ^ (lv p d - lv (child b dir d) d) =\n  2 ^ Suc (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "have \"\\<dots> = 2^(Suc ?l_p - ?l_c)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 ^ Suc (lv p d - lv (child b dir d) d) =\n    2 ^ (Suc (lv p d) - lv (child b dir d) d)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. 2 ^ Suc (lv p d - lv (child b dir d) d) =\n    2 ^ (Suc (lv p d) - lv (child b dir d) d)", "have \"Suc (?l_p - ?l_c) = Suc ?l_p - ?l_c\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Suc (lv p d - lv (child b dir d) d) =\n    Suc (lv p d) - lv (child b dir d) d", "using \\<open>lv ?child d \\<le> lv p d\\<close>"], ["proof (prove)\nusing this:\n  lv (child b dir d) d \\<le> lv p d\n\ngoal (1 subgoal):\n 1. Suc (lv p d - lv (child b dir d) d) =\n    Suc (lv p d) - lv (child b dir d) d", "by auto"], ["proof (state)\nthis:\n  Suc (lv p d - lv (child b dir d) d) = Suc (lv p d) - lv (child b dir d) d\n\ngoal (1 subgoal):\n 1. 2 ^ Suc (lv p d - lv (child b dir d) d) =\n    2 ^ (Suc (lv p d) - lv (child b dir d) d)", "thus ?thesis"], ["proof (prove)\nusing this:\n  Suc (lv p d - lv (child b dir d) d) = Suc (lv p d) - lv (child b dir d) d\n\ngoal (1 subgoal):\n 1. 2 ^ Suc (lv p d - lv (child b dir d) d) =\n    2 ^ (Suc (lv p d) - lv (child b dir d) d)", "by auto"], ["proof (state)\nthis:\n  2 ^ Suc (lv p d - lv (child b dir d) d) =\n  2 ^ (Suc (lv p d) - lv (child b dir d) d)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  2 ^ Suc (lv p d - lv (child b dir d) d) =\n  2 ^ (Suc (lv p d) - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "also"], ["proof (state)\nthis:\n  2 ^ Suc (lv p d - lv (child b dir d) d) =\n  2 ^ (Suc (lv p d) - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "have \"\\<dots> = 2^(?l_p - ?l_b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 ^ (Suc (lv p d) - lv (child b dir d) d) = 2 ^ (lv p d - lv b d)", "using \\<open>d < length b\\<close> and \\<open>lv b d < lv p d\\<close>"], ["proof (prove)\nusing this:\n  d < length b\n  lv b d < lv p d\n\ngoal (1 subgoal):\n 1. 2 ^ (Suc (lv p d) - lv (child b dir d) d) = 2 ^ (lv p d - lv b d)", "by (auto simp add: child_def lv_def)"], ["proof (state)\nthis:\n  2 ^ (Suc (lv p d) - lv (child b dir d) d) = 2 ^ (lv p d - lv b d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "finally"], ["proof (chain)\npicking this:\n  2 * 2 ^ (lv p d - lv (child b dir d) d) = 2 ^ (lv p d - lv b d)", "have level: \"2^(?l_p - ?l_b) = (2::int) * 2^(?l_p - ?l_c)\""], ["proof (prove)\nusing this:\n  2 * 2 ^ (lv p d - lv (child b dir d) d) = 2 ^ (lv p d - lv b d)\n\ngoal (1 subgoal):\n 1. 2 ^ (lv p d - lv b d) = 2 * 2 ^ (lv p d - lv (child b dir d) d)", ".."], ["proof (state)\nthis:\n  2 ^ (lv p d - lv b d) = 2 * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "from \\<open>d < length b\\<close> and p_grid"], ["proof (chain)\npicking this:\n  d < length b\n  p \\<in> grid (child b dir d) ds", "have range_left: \"?i_p > (?i_c - 1) * 2^(?l_p - ?l_c)\" and\n       range_right: \"?i_p < (?i_c + 1) * 2^(?l_p - ?l_c)\""], ["proof (prove)\nusing this:\n  d < length b\n  p \\<in> grid (child b dir d) ds\n\ngoal (1 subgoal):\n 1. (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n    < ix p d &&&\n    ix p d\n    < (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)", "using grid_estimate"], ["proof (prove)\nusing this:\n  d < length b\n  p \\<in> grid (child b dir d) ds\n  \\<lbrakk>?d < length ?b; ?p \\<in> grid ?b ?ds\\<rbrakk>\n  \\<Longrightarrow> ix ?p ?d\n                    < (ix ?b ?d + 1) * 2 ^ (lv ?p ?d - lv ?b ?d) \\<and>\n                    (ix ?b ?d - 1) * 2 ^ (lv ?p ?d - lv ?b ?d) < ix ?p ?d\n\ngoal (1 subgoal):\n 1. (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n    < ix p d &&&\n    ix p d\n    < (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)", "by auto"], ["proof (state)\nthis:\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d) < ix p d\n  ix p d < (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "proof (cases dir)"], ["proof (state)\ngoal (2 subgoals):\n 1. dir = left \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)\n 2. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "case left"], ["proof (state)\nthis:\n  dir = left\n\ngoal (2 subgoals):\n 1. dir = left \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)\n 2. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "with child_ix_left[OF \\<open>d < length b\\<close>]"], ["proof (chain)\npicking this:\n  ix (child b left d) d = 2 * ix b d - 1\n  dir = left", "have \"(?i_b - 1) * 2^(?l_p - ?l_b) = (?i_c - 1) * 2^(?l_p - ?l_c)\" and\n      \"?i_b * 2^(?l_p - ?l_b) = (?i_c + 1) * 2^(?l_p - ?l_c)\""], ["proof (prove)\nusing this:\n  ix (child b left d) d = 2 * ix b d - 1\n  dir = left\n\ngoal (1 subgoal):\n 1. (ix b d - 1) * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d) &&&\n    ix b d * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)", "using level"], ["proof (prove)\nusing this:\n  ix (child b left d) d = 2 * ix b d - 1\n  dir = left\n  2 ^ (lv p d - lv b d) = 2 * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. (ix b d - 1) * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d) &&&\n    ix b d * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)", "by auto"], ["proof (state)\nthis:\n  (ix b d - 1) * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  ix b d * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (2 subgoals):\n 1. dir = left \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)\n 2. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "hence \"?i_p > (?i_b - 1) * 2^(?l_p - ?l_b)\" and\n      \"?i_p < ?i_b * 2^(?l_p - ?l_b)\""], ["proof (prove)\nusing this:\n  (ix b d - 1) * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  ix b d * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. (ix b d - 1) * 2 ^ (lv p d - lv b d) < ix p d &&&\n    ix p d < ix b d * 2 ^ (lv p d - lv b d)", "using range_left and range_right"], ["proof (prove)\nusing this:\n  (ix b d - 1) * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  ix b d * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d) < ix p d\n  ix p d < (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. (ix b d - 1) * 2 ^ (lv p d - lv b d) < ix p d &&&\n    ix p d < ix b d * 2 ^ (lv p d - lv b d)", "by auto"], ["proof (state)\nthis:\n  (ix b d - 1) * 2 ^ (lv p d - lv b d) < ix p d\n  ix p d < ix b d * 2 ^ (lv p d - lv b d)\n\ngoal (2 subgoals):\n 1. dir = left \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)\n 2. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "with \\<open>?l_b < ?l_p\\<close>"], ["proof (chain)\npicking this:\n  lv b d < lv p d\n  (ix b d - 1) * 2 ^ (lv p d - lv b d) < ix p d\n  ix p d < ix b d * 2 ^ (lv p d - lv b d)", "have \"l2_\\<phi> (?l_p, ?i_p) (?l_b, ?i_b) =\n          (1 + real_of_int ?i_p / 2^(?l_p - ?l_b) - real_of_int ?i_b) / 2^(?l_p + 1)\""], ["proof (prove)\nusing this:\n  lv b d < lv p d\n  (ix b d - 1) * 2 ^ (lv p d - lv b d) < ix p d\n  ix p d < ix b d * 2 ^ (lv p d - lv b d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n    (1 + real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n     real_of_int (ix b d)) /\n    2 ^ (lv p d + 1)", "by (rule l2_when_left_child)"], ["proof (state)\nthis:\n  l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n  (1 + real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n   real_of_int (ix b d)) /\n  2 ^ (lv p d + 1)\n\ngoal (2 subgoals):\n 1. dir = left \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)\n 2. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "thus ?thesis"], ["proof (prove)\nusing this:\n  l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n  (1 + real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n   real_of_int (ix b d)) /\n  2 ^ (lv p d + 1)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "using left"], ["proof (prove)\nusing this:\n  l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n  (1 + real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n   real_of_int (ix b d)) /\n  2 ^ (lv p d + 1)\n  dir = left\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "by (auto simp add: ix_def lv_def)"], ["proof (state)\nthis:\n  l2_\\<phi> (p ! d) (b ! d) =\n  (1 -\n   real_of_int (Grid_Point.sgn dir) *\n   (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) - real_of_int (ix b d))) /\n  2 ^ (lv p d + 1)\n\ngoal (1 subgoal):\n 1. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "case right"], ["proof (state)\nthis:\n  dir = right\n\ngoal (1 subgoal):\n 1. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "hence \"?i_c = 2 * ?i_b + 1\""], ["proof (prove)\nusing this:\n  dir = right\n\ngoal (1 subgoal):\n 1. ix (child b dir d) d = 2 * ix b d + 1", "using child_ix_right and \\<open>d < length b\\<close>"], ["proof (prove)\nusing this:\n  dir = right\n  ?d < length ?p \\<Longrightarrow>\n  ix (child ?p right ?d) ?d = 2 * ix ?p ?d + 1\n  d < length b\n\ngoal (1 subgoal):\n 1. ix (child b dir d) d = 2 * ix b d + 1", "by auto"], ["proof (state)\nthis:\n  ix (child b dir d) d = 2 * ix b d + 1\n\ngoal (1 subgoal):\n 1. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "hence \"?i_b * 2^(?l_p - ?l_b) = (?i_c - 1) * 2^(?l_p - ?l_c)\" and\n      \"(?i_b + 1) * 2^(?l_p - ?l_b) = (?i_c + 1) * 2^(?l_p - ?l_c)\""], ["proof (prove)\nusing this:\n  ix (child b dir d) d = 2 * ix b d + 1\n\ngoal (1 subgoal):\n 1. ix b d * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d) &&&\n    (ix b d + 1) * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)", "using level"], ["proof (prove)\nusing this:\n  ix (child b dir d) d = 2 * ix b d + 1\n  2 ^ (lv p d - lv b d) = 2 * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. ix b d * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d) &&&\n    (ix b d + 1) * 2 ^ (lv p d - lv b d) =\n    (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)", "by auto"], ["proof (state)\nthis:\n  ix b d * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  (ix b d + 1) * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "hence \"?i_p > ?i_b * 2^(?l_p - ?l_b)\" and\n      \"?i_p < (?i_b + 1) * 2^(?l_p - ?l_b)\""], ["proof (prove)\nusing this:\n  ix b d * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  (ix b d + 1) * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. ix b d * 2 ^ (lv p d - lv b d) < ix p d &&&\n    ix p d < (ix b d + 1) * 2 ^ (lv p d - lv b d)", "using range_left and range_right"], ["proof (prove)\nusing this:\n  ix b d * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  (ix b d + 1) * 2 ^ (lv p d - lv b d) =\n  (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n  (ix (child b dir d) d - 1) * 2 ^ (lv p d - lv (child b dir d) d) < ix p d\n  ix p d < (ix (child b dir d) d + 1) * 2 ^ (lv p d - lv (child b dir d) d)\n\ngoal (1 subgoal):\n 1. ix b d * 2 ^ (lv p d - lv b d) < ix p d &&&\n    ix p d < (ix b d + 1) * 2 ^ (lv p d - lv b d)", "by auto"], ["proof (state)\nthis:\n  ix b d * 2 ^ (lv p d - lv b d) < ix p d\n  ix p d < (ix b d + 1) * 2 ^ (lv p d - lv b d)\n\ngoal (1 subgoal):\n 1. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "with \\<open>?l_b < ?l_p\\<close>"], ["proof (chain)\npicking this:\n  lv b d < lv p d\n  ix b d * 2 ^ (lv p d - lv b d) < ix p d\n  ix p d < (ix b d + 1) * 2 ^ (lv p d - lv b d)", "have \"l2_\\<phi> (?l_p, ?i_p) (?l_b, ?i_b) =\n          (1 - real_of_int ?i_p / 2^(?l_p - ?l_b) + real_of_int ?i_b) / 2^(?l_p + 1)\""], ["proof (prove)\nusing this:\n  lv b d < lv p d\n  ix b d * 2 ^ (lv p d - lv b d) < ix p d\n  ix p d < (ix b d + 1) * 2 ^ (lv p d - lv b d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n    (1 - real_of_int (ix p d) / 2 ^ (lv p d - lv b d) +\n     real_of_int (ix b d)) /\n    2 ^ (lv p d + 1)", "by (rule l2_when_right_child)"], ["proof (state)\nthis:\n  l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n  (1 - real_of_int (ix p d) / 2 ^ (lv p d - lv b d) +\n   real_of_int (ix b d)) /\n  2 ^ (lv p d + 1)\n\ngoal (1 subgoal):\n 1. dir = right \\<Longrightarrow>\n    l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "thus ?thesis"], ["proof (prove)\nusing this:\n  l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n  (1 - real_of_int (ix p d) / 2 ^ (lv p d - lv b d) +\n   real_of_int (ix b d)) /\n  2 ^ (lv p d + 1)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "using right"], ["proof (prove)\nusing this:\n  l2_\\<phi> (lv p d, ix p d) (lv b d, ix b d) =\n  (1 - real_of_int (ix p d) / 2 ^ (lv p d - lv b d) +\n   real_of_int (ix b d)) /\n  2 ^ (lv p d + 1)\n  dir = right\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (b ! d) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) -\n      real_of_int (ix b d))) /\n    2 ^ (lv p d + 1)", "by (auto simp add: ix_def lv_def)"], ["proof (state)\nthis:\n  l2_\\<phi> (p ! d) (b ! d) =\n  (1 -\n   real_of_int (Grid_Point.sgn dir) *\n   (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) - real_of_int (ix b d))) /\n  2 ^ (lv p d + 1)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  l2_\\<phi> (p ! d) (b ! d) =\n  (1 -\n   real_of_int (Grid_Point.sgn dir) *\n   (real_of_int (ix p d) / 2 ^ (lv p d - lv b d) - real_of_int (ix b d))) /\n  2 ^ (lv p d + 1)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma l2_same: \"l2_\\<phi> (p!d) (p!d) = 1/3 / 2^(lv p d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (p ! d) = 1 / 3 / 2 ^ lv p d", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (p ! d) = 1 / 3 / 2 ^ lv p d", "have \"l2_\\<phi> (p!d) (p!d) = l2_\\<phi> (lv p d, ix p d) (lv p d, ix p d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (p ! d) = l2_\\<phi> (lv p d, ix p d) (lv p d, ix p d)", "by (auto simp add: lv_def ix_def)"], ["proof (state)\nthis:\n  l2_\\<phi> (p ! d) (p ! d) = l2_\\<phi> (lv p d, ix p d) (lv p d, ix p d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (p ! d) = 1 / 3 / 2 ^ lv p d", "thus ?thesis"], ["proof (prove)\nusing this:\n  l2_\\<phi> (p ! d) (p ! d) = l2_\\<phi> (lv p d, ix p d) (lv p d, ix p d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (p ! d) = 1 / 3 / 2 ^ lv p d", "using l2_when_same"], ["proof (prove)\nusing this:\n  l2_\\<phi> (p ! d) (p ! d) = l2_\\<phi> (lv p d, ix p d) (lv p d, ix p d)\n  l2_\\<phi> (?l, ?i) (?l, ?i) = 1 / 3 / 2 ^ ?l\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p ! d) (p ! d) = 1 / 3 / 2 ^ lv p d", "by auto"], ["proof (state)\nthis:\n  l2_\\<phi> (p ! d) (p ! d) = 1 / 3 / 2 ^ lv p d\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma l2_disjoint: assumes \"d < length b\" and \"p \\<in> grid b {d}\" and \"p' \\<in> grid b {d}\"\n  and \"p' \\<notin> grid p {d}\" and \"lv p' d \\<ge> lv p d\"\n  shows \"l2_\\<phi> (p' ! d) (p ! d) = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) = 0", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) = 0", "have range: \"ix p' d > (ix p d + 1) * 2^(lv p' d - lv p d) \\<or> ix p' d < (ix p d - 1) * 2^(lv p' d - lv p d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n    ix p' d < (ix p d - 1) * 2 ^ (lv p' d - lv p d)", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> ((ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n            ix p' d\n            < (ix p d - 1) * 2 ^ (lv p' d - lv p d)) \\<Longrightarrow>\n    False", "assume \"\\<not> ?thesis\""], ["proof (state)\nthis:\n  \\<not> ((ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n          ix p' d < (ix p d - 1) * 2 ^ (lv p' d - lv p d))\n\ngoal (1 subgoal):\n 1. \\<not> ((ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n            ix p' d\n            < (ix p d - 1) * 2 ^ (lv p' d - lv p d)) \\<Longrightarrow>\n    False", "hence \"ix p' d \\<le> (ix p d + 1) * 2^(lv p' d - lv p d)\" and \"ix p' d \\<ge> (ix p d - 1) * 2^(lv p' d - lv p d)\""], ["proof (prove)\nusing this:\n  \\<not> ((ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n          ix p' d < (ix p d - 1) * 2 ^ (lv p' d - lv p d))\n\ngoal (1 subgoal):\n 1. ix p' d \\<le> (ix p d + 1) * 2 ^ (lv p' d - lv p d) &&&\n    (ix p d - 1) * 2 ^ (lv p' d - lv p d) \\<le> ix p' d", "by auto"], ["proof (state)\nthis:\n  ix p' d \\<le> (ix p d + 1) * 2 ^ (lv p' d - lv p d)\n  (ix p d - 1) * 2 ^ (lv p' d - lv p d) \\<le> ix p' d\n\ngoal (1 subgoal):\n 1. \\<not> ((ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n            ix p' d\n            < (ix p d - 1) * 2 ^ (lv p' d - lv p d)) \\<Longrightarrow>\n    False", "with \\<open>p' \\<in> grid b {d}\\<close> and \\<open>p \\<in> grid b {d}\\<close> and \\<open>lv p' d \\<ge> lv p d\\<close> and \\<open>d < length b\\<close>"], ["proof (chain)\npicking this:\n  p' \\<in> grid b {d}\n  p \\<in> grid b {d}\n  lv p d \\<le> lv p' d\n  d < length b\n  ix p' d \\<le> (ix p d + 1) * 2 ^ (lv p' d - lv p d)\n  (ix p d - 1) * 2 ^ (lv p' d - lv p d) \\<le> ix p' d", "have \"p' \\<in> grid p {d}\""], ["proof (prove)\nusing this:\n  p' \\<in> grid b {d}\n  p \\<in> grid b {d}\n  lv p d \\<le> lv p' d\n  d < length b\n  ix p' d \\<le> (ix p d + 1) * 2 ^ (lv p' d - lv p d)\n  (ix p d - 1) * 2 ^ (lv p' d - lv p d) \\<le> ix p' d\n\ngoal (1 subgoal):\n 1. p' \\<in> grid p {d}", "using grid_part[where p=p and b=b and d=d and p'=p']"], ["proof (prove)\nusing this:\n  p' \\<in> grid b {d}\n  p \\<in> grid b {d}\n  lv p d \\<le> lv p' d\n  d < length b\n  ix p' d \\<le> (ix p d + 1) * 2 ^ (lv p' d - lv p d)\n  (ix p d - 1) * 2 ^ (lv p' d - lv p d) \\<le> ix p' d\n  \\<lbrakk>d < length b; p \\<in> grid b {d}; p' \\<in> grid b {d};\n   lv p d \\<le> lv p' d;\n   ix p' d \\<le> (ix p d + 1) * 2 ^ (lv p' d - lv p d);\n   (ix p d - 1) * 2 ^ (lv p' d - lv p d) \\<le> ix p' d\\<rbrakk>\n  \\<Longrightarrow> p' \\<in> grid p {d}\n\ngoal (1 subgoal):\n 1. p' \\<in> grid p {d}", "by auto"], ["proof (state)\nthis:\n  p' \\<in> grid p {d}\n\ngoal (1 subgoal):\n 1. \\<not> ((ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n            ix p' d\n            < (ix p d - 1) * 2 ^ (lv p' d - lv p d)) \\<Longrightarrow>\n    False", "with \\<open>p' \\<notin> grid p {d}\\<close>"], ["proof (chain)\npicking this:\n  p' \\<notin> grid p {d}\n  p' \\<in> grid p {d}", "show False"], ["proof (prove)\nusing this:\n  p' \\<notin> grid p {d}\n  p' \\<in> grid p {d}\n\ngoal (1 subgoal):\n 1. False", "by auto"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n  ix p' d < (ix p d - 1) * 2 ^ (lv p' d - lv p d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) = 0", "have \"l2_\\<phi> (p' ! d) (p ! d) = l2_\\<phi> (lv p' d, ix p' d) (lv p d, ix p d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) =\n    l2_\\<phi> (lv p' d, ix p' d) (lv p d, ix p d)", "by (auto simp add: ix_def lv_def)"], ["proof (state)\nthis:\n  l2_\\<phi> (p' ! d) (p ! d) = l2_\\<phi> (lv p' d, ix p' d) (lv p d, ix p d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) = 0", "also"], ["proof (state)\nthis:\n  l2_\\<phi> (p' ! d) (p ! d) = l2_\\<phi> (lv p' d, ix p' d) (lv p d, ix p d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) = 0", "have \"\\<dots> = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (lv p' d, ix p' d) (lv p d, ix p d) = 0", "using range and \\<open>lv p' d \\<ge> lv p d\\<close> and l2_when_disjoint"], ["proof (prove)\nusing this:\n  (ix p d + 1) * 2 ^ (lv p' d - lv p d) < ix p' d \\<or>\n  ix p' d < (ix p d - 1) * 2 ^ (lv p' d - lv p d)\n  lv p d \\<le> lv p' d\n  \\<lbrakk>?l \\<le> ?l';\n   (?i + 1) * 2 ^ (?l' - ?l) < ?i' \\<or>\n   ?i' < (?i - 1) * 2 ^ (?l' - ?l)\\<rbrakk>\n  \\<Longrightarrow> l2_\\<phi> (?l', ?i') (?l, ?i) = 0\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (lv p' d, ix p' d) (lv p d, ix p d) = 0", "by auto"], ["proof (state)\nthis:\n  l2_\\<phi> (lv p' d, ix p' d) (lv p d, ix p d) = 0\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) = 0", "finally"], ["proof (chain)\npicking this:\n  l2_\\<phi> (p' ! d) (p ! d) = 0", "show ?thesis"], ["proof (prove)\nusing this:\n  l2_\\<phi> (p' ! d) (p ! d) = 0\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p ! d) = 0", "."], ["proof (state)\nthis:\n  l2_\\<phi> (p' ! d) (p ! d) = 0\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma l2_down2:\n  fixes pc pd p\n  assumes \"d < length pd\"\n  assumes pc_in_grid: \"pc \\<in> grid (child pd dir d) {d}\"\n  assumes pd_is_child: \"pd = child p dir d\" (is \"pd = ?pd\")\n  shows \"l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "have \"d < length p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. d < length p", "using pd_is_child \\<open>d < length pd\\<close>"], ["proof (prove)\nusing this:\n  pd = child p dir d\n  d < length pd\n\ngoal (1 subgoal):\n 1. d < length p", "by auto"], ["proof (state)\nthis:\n  d < length p\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "moreover"], ["proof (state)\nthis:\n  d < length p\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "have \"pc \\<in> grid ?pd {d}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. pc \\<in> grid (child p dir d) {d}", "using pd_is_child and grid_child and pc_in_grid"], ["proof (prove)\nusing this:\n  pd = child p dir d\n  \\<lbrakk>?d \\<in> ?ds; ?p \\<in> grid (child ?b ?dir ?d) ?ds\\<rbrakk>\n  \\<Longrightarrow> ?p \\<in> grid ?b ?ds\n  pc \\<in> grid (child pd dir d) {d}\n\ngoal (1 subgoal):\n 1. pc \\<in> grid (child p dir d) {d}", "by auto"], ["proof (state)\nthis:\n  pc \\<in> grid (child p dir d) {d}\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "hence \"lv p d < lv pc d\""], ["proof (prove)\nusing this:\n  pc \\<in> grid (child p dir d) {d}\n\ngoal (1 subgoal):\n 1. lv p d < lv pc d", "using grid_child_level and \\<open>d < length pd\\<close> and pd_is_child"], ["proof (prove)\nusing this:\n  pc \\<in> grid (child p dir d) {d}\n  \\<lbrakk>?d < length ?b; ?p \\<in> grid (child ?b ?dir ?d) ?ds\\<rbrakk>\n  \\<Longrightarrow> lv ?b ?d < lv ?p ?d\n  d < length pd\n  pd = child p dir d\n\ngoal (1 subgoal):\n 1. lv p d < lv pc d", "by auto"], ["proof (state)\nthis:\n  lv p d < lv pc d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "moreover"], ["proof (state)\nthis:\n  lv p d < lv pc d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "have \"real_of_int (sgn dir) * real_of_int (sgn dir) = 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1", "by (cases dir, auto)"], ["proof (state)\nthis:\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "ultimately"], ["proof (chain)\npicking this:\n  d < length p\n  lv p d < lv pc d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1", "show ?thesis"], ["proof (prove)\nusing this:\n  d < length p\n  lv p d < lv pc d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)", "unfolding l2_child[OF \\<open>d < length pd\\<close> pc_in_grid]\n              l2_child[OF \\<open>d < length p\\<close> \\<open>pc \\<in> grid ?pd {d}\\<close>]"], ["proof (prove)\nusing this:\n  d < length p\n  lv p d < lv pc d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n\ngoal (1 subgoal):\n 1. (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix pc d) / 2 ^ (lv pc d - lv pd d) -\n      real_of_int (ix pd d))) /\n    2 ^ (lv pc d + 1) /\n    2 =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix pc d) / 2 ^ (lv pc d - lv p d) -\n      real_of_int (ix p d))) /\n    2 ^ (lv pc d + 1)", "using child_lv and child_ix and pd_is_child and level_shift"], ["proof (prove)\nusing this:\n  d < length p\n  lv p d < lv pc d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n  ?d < length ?p \\<Longrightarrow> lv (child ?p ?dir ?d) ?d = lv ?p ?d + 1\n  ?d < length ?p \\<Longrightarrow>\n  ix (child ?p ?dir ?d) ?d = 2 * ix ?p ?d + Grid_Point.sgn ?dir\n  pd = child p dir d\n  ?l < ?lc \\<Longrightarrow>\n  ?x / 2 ^ (?lc - Suc ?l) = ?x * 2 / 2 ^ (?lc - ?l)\n\ngoal (1 subgoal):\n 1. (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix pc d) / 2 ^ (lv pc d - lv pd d) -\n      real_of_int (ix pd d))) /\n    2 ^ (lv pc d + 1) /\n    2 =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix pc d) / 2 ^ (lv pc d - lv p d) -\n      real_of_int (ix p d))) /\n    2 ^ (lv pc d + 1)", "by (auto simp add: algebra_simps diff_divide_distrib add_divide_distrib)"], ["proof (state)\nthis:\n  l2_\\<phi> (pc ! d) (pd ! d) / 2 = l2_\\<phi> (pc ! d) (p ! d)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma l2_zigzag:\n  assumes \"d < length p\" and p_child: \"p = child p_p dir d\"\n  and p'_grid: \"p' \\<in> grid (child p (inv dir) d) {d}\"\n  and ps_intro: \"child p (inv dir) d = child ps dir d\" (is \"?c_p = ?c_ps\")\n  shows \"l2_\\<phi> (p' ! d) (p_p ! d) = l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "have \"length p = length ?c_p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. length p = length (child p (Grid_Point.inv dir) d)", "by auto"], ["proof (state)\nthis:\n  length p = length (child p (Grid_Point.inv dir) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "also"], ["proof (state)\nthis:\n  length p = length (child p (Grid_Point.inv dir) d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "have \"\\<dots> = length ?c_ps\""], ["proof (prove)\ngoal (1 subgoal):\n 1. length (child p (Grid_Point.inv dir) d) = length (child ps dir d)", "using ps_intro"], ["proof (prove)\nusing this:\n  child p (Grid_Point.inv dir) d = child ps dir d\n\ngoal (1 subgoal):\n 1. length (child p (Grid_Point.inv dir) d) = length (child ps dir d)", "by auto"], ["proof (state)\nthis:\n  length (child p (Grid_Point.inv dir) d) = length (child ps dir d)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "finally"], ["proof (chain)\npicking this:\n  length p = length (child ps dir d)", "have \"length p = length ps\""], ["proof (prove)\nusing this:\n  length p = length (child ps dir d)\n\ngoal (1 subgoal):\n 1. length p = length ps", "using ps_intro"], ["proof (prove)\nusing this:\n  length p = length (child ps dir d)\n  child p (Grid_Point.inv dir) d = child ps dir d\n\ngoal (1 subgoal):\n 1. length p = length ps", "by auto"], ["proof (state)\nthis:\n  length p = length ps\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "hence \"d < length p_p\""], ["proof (prove)\nusing this:\n  length p = length ps\n\ngoal (1 subgoal):\n 1. d < length p_p", "using p_child and \\<open>d < length p\\<close>"], ["proof (prove)\nusing this:\n  length p = length ps\n  p = child p_p dir d\n  d < length p\n\ngoal (1 subgoal):\n 1. d < length p_p", "by auto"], ["proof (state)\nthis:\n  d < length p_p\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "moreover"], ["proof (state)\nthis:\n  d < length p_p\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "from ps_intro"], ["proof (chain)\npicking this:\n  child p (Grid_Point.inv dir) d = child ps dir d", "have \"ps = p[d := (lv p d, ix p d - sgn dir)]\""], ["proof (prove)\nusing this:\n  child p (Grid_Point.inv dir) d = child ps dir d\n\ngoal (1 subgoal):\n 1. ps = p[d := (lv p d, ix p d - Grid_Point.sgn dir)]", "by (rule child_neighbour)"], ["proof (state)\nthis:\n  ps = p[d := (lv p d, ix p d - Grid_Point.sgn dir)]\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "hence \"lv ps d = lv p d\" and \"real_of_int (ix ps d) = real_of_int (ix p d) - real_of_int (sgn dir)\""], ["proof (prove)\nusing this:\n  ps = p[d := (lv p d, ix p d - Grid_Point.sgn dir)]\n\ngoal (1 subgoal):\n 1. lv ps d = lv p d &&&\n    real_of_int (ix ps d) =\n    real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)", "using lv_def and ix_def and \\<open>length p = length ps\\<close> and \\<open>d < length p\\<close>"], ["proof (prove)\nusing this:\n  ps = p[d := (lv p d, ix p d - Grid_Point.sgn dir)]\n  lv ?p ?d = fst (?p ! ?d)\n  ix ?p ?d = snd (?p ! ?d)\n  length p = length ps\n  d < length p\n\ngoal (1 subgoal):\n 1. lv ps d = lv p d &&&\n    real_of_int (ix ps d) =\n    real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)", "by auto"], ["proof (state)\nthis:\n  lv ps d = lv p d\n  real_of_int (ix ps d) =\n  real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "moreover"], ["proof (state)\nthis:\n  lv ps d = lv p d\n  real_of_int (ix ps d) =\n  real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "have \"d < length ps\" and *: \"p' \\<in> grid (child ps dir d) {d}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. d < length ps &&& p' \\<in> grid (child ps dir d) {d}", "using p'_grid ps_intro \\<open>length p = length ps\\<close> \\<open>d < length p\\<close>"], ["proof (prove)\nusing this:\n  p' \\<in> grid (child p (Grid_Point.inv dir) d) {d}\n  child p (Grid_Point.inv dir) d = child ps dir d\n  length p = length ps\n  d < length p\n\ngoal (1 subgoal):\n 1. d < length ps &&& p' \\<in> grid (child ps dir d) {d}", "by auto"], ["proof (state)\nthis:\n  d < length ps\n  p' \\<in> grid (child ps dir d) {d}\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "have \"p' \\<in> grid p {d}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p' \\<in> grid p {d}", "using p'_grid and grid_child"], ["proof (prove)\nusing this:\n  p' \\<in> grid (child p (Grid_Point.inv dir) d) {d}\n  \\<lbrakk>?d \\<in> ?ds; ?p \\<in> grid (child ?b ?dir ?d) ?ds\\<rbrakk>\n  \\<Longrightarrow> ?p \\<in> grid ?b ?ds\n\ngoal (1 subgoal):\n 1. p' \\<in> grid p {d}", "by auto"], ["proof (state)\nthis:\n  p' \\<in> grid p {d}\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "hence p_p_grid: \"p' \\<in> grid (child p_p dir d) {d}\""], ["proof (prove)\nusing this:\n  p' \\<in> grid p {d}\n\ngoal (1 subgoal):\n 1. p' \\<in> grid (child p_p dir d) {d}", "using p_child"], ["proof (prove)\nusing this:\n  p' \\<in> grid p {d}\n  p = child p_p dir d\n\ngoal (1 subgoal):\n 1. p' \\<in> grid (child p_p dir d) {d}", "by auto"], ["proof (state)\nthis:\n  p' \\<in> grid (child p_p dir d) {d}\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "hence \"lv p' d > lv p_p d\""], ["proof (prove)\nusing this:\n  p' \\<in> grid (child p_p dir d) {d}\n\ngoal (1 subgoal):\n 1. lv p_p d < lv p' d", "using grid_child_level and \\<open>d < length p_p\\<close>"], ["proof (prove)\nusing this:\n  p' \\<in> grid (child p_p dir d) {d}\n  \\<lbrakk>?d < length ?b; ?p \\<in> grid (child ?b ?dir ?d) ?ds\\<rbrakk>\n  \\<Longrightarrow> lv ?b ?d < lv ?p ?d\n  d < length p_p\n\ngoal (1 subgoal):\n 1. lv p_p d < lv p' d", "by auto"], ["proof (state)\nthis:\n  lv p_p d < lv p' d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "moreover"], ["proof (state)\nthis:\n  lv p_p d < lv p' d\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "have \"real_of_int (sgn dir) * real_of_int (sgn dir) = 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1", "by (cases dir, auto)"], ["proof (state)\nthis:\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "ultimately"], ["proof (chain)\npicking this:\n  d < length p_p\n  lv ps d = lv p d\n  real_of_int (ix ps d) =\n  real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)\n  lv p_p d < lv p' d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1", "show ?thesis"], ["proof (prove)\nusing this:\n  d < length p_p\n  lv ps d = lv p d\n  real_of_int (ix ps d) =\n  real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)\n  lv p_p d < lv p' d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n\ngoal (1 subgoal):\n 1. l2_\\<phi> (p' ! d) (p_p ! d) =\n    l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2", "unfolding l2_child[OF \\<open>d < length p\\<close> p'_grid] l2_child[OF \\<open>d < length ps\\<close> *]\n              l2_child[OF \\<open>d < length p_p\\<close> p_p_grid]"], ["proof (prove)\nusing this:\n  d < length p_p\n  lv ps d = lv p d\n  real_of_int (ix ps d) =\n  real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)\n  lv p_p d < lv p' d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n\ngoal (1 subgoal):\n 1. (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p' d) / 2 ^ (lv p' d - lv p_p d) -\n      real_of_int (ix p_p d))) /\n    2 ^ (lv p' d + 1) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p' d) / 2 ^ (lv p' d - lv ps d) -\n      real_of_int (ix ps d))) /\n    2 ^ (lv p' d + 1) +\n    (1 -\n     real_of_int (Grid_Point.sgn (Grid_Point.inv dir)) *\n     (real_of_int (ix p' d) / 2 ^ (lv p' d - lv p d) -\n      real_of_int (ix p d))) /\n    2 ^ (lv p' d + 1) /\n    2", "using child_lv and child_ix and p_child level_shift"], ["proof (prove)\nusing this:\n  d < length p_p\n  lv ps d = lv p d\n  real_of_int (ix ps d) =\n  real_of_int (ix p d) - real_of_int (Grid_Point.sgn dir)\n  lv p_p d < lv p' d\n  real_of_int (Grid_Point.sgn dir) * real_of_int (Grid_Point.sgn dir) = 1\n  ?d < length ?p \\<Longrightarrow> lv (child ?p ?dir ?d) ?d = lv ?p ?d + 1\n  ?d < length ?p \\<Longrightarrow>\n  ix (child ?p ?dir ?d) ?d = 2 * ix ?p ?d + Grid_Point.sgn ?dir\n  p = child p_p dir d\n  ?l < ?lc \\<Longrightarrow>\n  ?x / 2 ^ (?lc - Suc ?l) = ?x * 2 / 2 ^ (?lc - ?l)\n\ngoal (1 subgoal):\n 1. (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p' d) / 2 ^ (lv p' d - lv p_p d) -\n      real_of_int (ix p_p d))) /\n    2 ^ (lv p' d + 1) =\n    (1 -\n     real_of_int (Grid_Point.sgn dir) *\n     (real_of_int (ix p' d) / 2 ^ (lv p' d - lv ps d) -\n      real_of_int (ix ps d))) /\n    2 ^ (lv p' d + 1) +\n    (1 -\n     real_of_int (Grid_Point.sgn (Grid_Point.inv dir)) *\n     (real_of_int (ix p' d) / 2 ^ (lv p' d - lv p d) -\n      real_of_int (ix p d))) /\n    2 ^ (lv p' d + 1) /\n    2", "by (auto simp add: add_divide_distrib algebra_simps diff_divide_distrib)"], ["proof (state)\nthis:\n  l2_\\<phi> (p' ! d) (p_p ! d) =\n  l2_\\<phi> (p' ! d) (ps ! d) + l2_\\<phi> (p' ! d) (p ! d) / 2\n\ngoal:\nNo subgoals!", "qed"], ["", "end"]]}