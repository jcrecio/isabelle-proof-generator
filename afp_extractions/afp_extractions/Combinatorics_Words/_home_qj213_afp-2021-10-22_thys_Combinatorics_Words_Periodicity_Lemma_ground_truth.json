{"file_name": "/home/qj213/afp-2021-10-22/thys/Combinatorics_Words/Periodicity_Lemma.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Combinatorics_Words", "problem_names": ["theorem per_lemma_relaxed:\n  assumes \"periodN w p\" and  \"periodN w q\" and  \"p + q \\<le> \\<^bold>|w\\<^bold>|\"\n  shows \"(take p w)\\<cdot>(take q w) = (take q w)\\<cdot>(take p w)\"", "lemma per_lemma_comm:\n  assumes \"w \\<le>p r \\<cdot> w\" and \"w \\<le>p s \\<cdot> w\" \n    and len: \"\\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| - (gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|) \\<le> \\<^bold>|w\\<^bold>|\"\n  shows \"s \\<cdot> r = r \\<cdot> s\"", "theorem per_lemma: assumes \"periodN w p\" and \"periodN w q\" and len: \"p + q - gcd p q \\<le> \\<^bold>|w\\<^bold>|\"\n  shows  \"periodN w (gcd p q)\"", "lemma ext_per_sum: assumes \"periodN w p\" and \"periodN w q\" and  \"p \\<le> \\<^bold>|w\\<^bold>|\" \n  shows \"periodN ((take p w) \\<cdot> w) (p+q)\"", "lemma FW_sym: \"FW_word p q = FW_word q p\"", "theorem fw_word': \"\\<not> p dvd q \\<Longrightarrow> \\<not> q dvd p \\<Longrightarrow>\n \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and> periodN (FW_word p q) p \\<and> periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\"", "theorem fw_word: assumes \"\\<not> p dvd q\" \"\\<not> q dvd p\"\n  shows \"\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\" and \"periodN (FW_word p q) p\" and  \"periodN (FW_word p q) q\" and \"\\<not> periodN (FW_word p q) (gcd p q)\"", "lemma fac_two_conjug_prim_root:\n  assumes facs: \"u \\<le>f r\\<^sup>@k\" \"u \\<le>f s\\<^sup>@l\" and nemps: \"r \\<noteq> \\<epsilon>\" \"s \\<noteq> \\<epsilon>\" and len: \"\\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| - gcd (\\<^bold>|r\\<^bold>|) (\\<^bold>|s\\<^bold>|) \\<le> \\<^bold>|u\\<^bold>|\"\n  shows \"\\<rho> r \\<sim> \\<rho> s\"", "lemma fac_two_conjug_prim_root':\n  assumes facs: \"u \\<le>f r\\<^sup>@k\" \"u \\<le>f s\\<^sup>@l\" and \"u \\<noteq> \\<epsilon>\" and len: \"\\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| - gcd (\\<^bold>|r\\<^bold>|) (\\<^bold>|s\\<^bold>|) \\<le> \\<^bold>|u\\<^bold>|\"\n  shows \"\\<rho> r \\<sim> \\<rho> s\"", "lemma fac_two_nconj_prim_pow:\n  assumes prims: \"primitive r\" \"primitive s\" and \"\\<not> r \\<sim> s\"\n      and facs: \"u \\<le>f r\\<^sup>@k\" \"u \\<le>f s\\<^sup>@l\"\n  shows \"\\<^bold>|u\\<^bold>| < \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| - gcd (\\<^bold>|r\\<^bold>|) (\\<^bold>|s\\<^bold>|)\""], "translations": [["", "theorem per_lemma_relaxed:\n  assumes \"periodN w p\" and  \"periodN w q\" and  \"p + q \\<le> \\<^bold>|w\\<^bold>|\"\n  shows \"(take p w)\\<cdot>(take q w) = (take q w)\\<cdot>(take p w)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. take p w \\<cdot> take q w = take q w \\<cdot> take p w", "using   two_pers[OF\n      \\<open>periodN w p\\<close>[unfolded periodN_def[of w p]]\n      \\<open>periodN w q\\<close>[unfolded periodN_def[of w q]], unfolded    \n      take_len[OF add_leD1[OF \\<open>p + q \\<le> \\<^bold>|w\\<^bold>|\\<close>]] \n      take_len[OF add_leD2[OF \\<open>p + q \\<le> \\<^bold>|w\\<^bold>|\\<close>]], OF \\<open>p + q \\<le> \\<^bold>|w\\<^bold>|\\<close>]"], ["proof (prove)\nusing this:\n  take p w \\<cdot> take q w = take q w \\<cdot> take p w\n\ngoal (1 subgoal):\n 1. take p w \\<cdot> take q w = take q w \\<cdot> take p w", "."], ["", "text\\<open>Also in terms of the numeric period:\\<close>"], ["", "thm two_periodsN"], ["", "section \\<open>Main claim\\<close>"], ["", "text\\<open>We first formulate the claim of the Periodicity lemma in terms of commutation of two periodic roots.\nFor trivial reasons we can also drop the requirement that the roots are nonempty.\n\\<close>"], ["", "lemma per_lemma_comm:\n  assumes \"w \\<le>p r \\<cdot> w\" and \"w \\<le>p s \\<cdot> w\" \n    and len: \"\\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| - (gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|) \\<le> \\<^bold>|w\\<^bold>|\"\n  shows \"s \\<cdot> r = r \\<cdot> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "using assms"], ["proof (prove)\nusing this:\n  w \\<le>p r \\<cdot> w\n  w \\<le>p s \\<cdot> w\n  \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| -\n  gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n  \\<le> \\<^bold>|w\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "proof (induction \"\\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>|\" arbitrary: w r s rule: less_induct)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>r s w.\n       \\<lbrakk>\\<And>ra sa w.\n                   \\<lbrakk>\\<^bold>|sa\\<^bold>| + \\<^bold>|sa\\<^bold>| +\n                            \\<^bold>|ra\\<^bold>|\n                            < \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| +\n                              \\<^bold>|r\\<^bold>|;\n                    w \\<le>p ra \\<cdot> w; w \\<le>p sa \\<cdot> w;\n                    \\<^bold>|sa\\<^bold>| + \\<^bold>|ra\\<^bold>| -\n                    gcd \\<^bold>|sa\\<^bold>| \\<^bold>|ra\\<^bold>|\n                    \\<le> \\<^bold>|w\\<^bold>|\\<rbrakk>\n                   \\<Longrightarrow> sa \\<cdot> ra = ra \\<cdot> sa;\n        w \\<le>p r \\<cdot> w; w \\<le>p s \\<cdot> w;\n        \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| -\n        gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n        \\<le> \\<^bold>|w\\<^bold>|\\<rbrakk>\n       \\<Longrightarrow> s \\<cdot> r = r \\<cdot> s", "case less"], ["proof (state)\nthis:\n  \\<lbrakk>\\<^bold>|?s\\<^bold>| + \\<^bold>|?s\\<^bold>| +\n           \\<^bold>|?r\\<^bold>|\n           < \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| +\n             \\<^bold>|r\\<^bold>|;\n   ?w \\<le>p ?r \\<cdot> ?w; ?w \\<le>p ?s \\<cdot> ?w;\n   \\<^bold>|?s\\<^bold>| + \\<^bold>|?r\\<^bold>| -\n   gcd \\<^bold>|?s\\<^bold>| \\<^bold>|?r\\<^bold>|\n   \\<le> \\<^bold>|?w\\<^bold>|\\<rbrakk>\n  \\<Longrightarrow> ?s \\<cdot> ?r = ?r \\<cdot> ?s\n  w \\<le>p r \\<cdot> w\n  w \\<le>p s \\<cdot> w\n  \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| -\n  gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n  \\<le> \\<^bold>|w\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<And>r s w.\n       \\<lbrakk>\\<And>ra sa w.\n                   \\<lbrakk>\\<^bold>|sa\\<^bold>| + \\<^bold>|sa\\<^bold>| +\n                            \\<^bold>|ra\\<^bold>|\n                            < \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| +\n                              \\<^bold>|r\\<^bold>|;\n                    w \\<le>p ra \\<cdot> w; w \\<le>p sa \\<cdot> w;\n                    \\<^bold>|sa\\<^bold>| + \\<^bold>|ra\\<^bold>| -\n                    gcd \\<^bold>|sa\\<^bold>| \\<^bold>|ra\\<^bold>|\n                    \\<le> \\<^bold>|w\\<^bold>|\\<rbrakk>\n                   \\<Longrightarrow> sa \\<cdot> ra = ra \\<cdot> sa;\n        w \\<le>p r \\<cdot> w; w \\<le>p s \\<cdot> w;\n        \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| -\n        gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n        \\<le> \\<^bold>|w\\<^bold>|\\<rbrakk>\n       \\<Longrightarrow> s \\<cdot> r = r \\<cdot> s", "consider (empty) \"s = \\<epsilon>\" | (short)  \"\\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>|\" | (step) \"s \\<noteq> \\<epsilon> \\<and> \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>s = \\<epsilon> \\<Longrightarrow> thesis;\n     \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow> thesis;\n     s \\<noteq> \\<epsilon> \\<and>\n     \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n     thesis\\<rbrakk>\n    \\<Longrightarrow> thesis", "by force"], ["proof (state)\nthis:\n  \\<lbrakk>s = \\<epsilon> \\<Longrightarrow> ?thesis;\n   \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow> ?thesis;\n   s \\<noteq> \\<epsilon> \\<and>\n   \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n   ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. \\<And>r s w.\n       \\<lbrakk>\\<And>ra sa w.\n                   \\<lbrakk>\\<^bold>|sa\\<^bold>| + \\<^bold>|sa\\<^bold>| +\n                            \\<^bold>|ra\\<^bold>|\n                            < \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| +\n                              \\<^bold>|r\\<^bold>|;\n                    w \\<le>p ra \\<cdot> w; w \\<le>p sa \\<cdot> w;\n                    \\<^bold>|sa\\<^bold>| + \\<^bold>|ra\\<^bold>| -\n                    gcd \\<^bold>|sa\\<^bold>| \\<^bold>|ra\\<^bold>|\n                    \\<le> \\<^bold>|w\\<^bold>|\\<rbrakk>\n                   \\<Longrightarrow> sa \\<cdot> ra = ra \\<cdot> sa;\n        w \\<le>p r \\<cdot> w; w \\<le>p s \\<cdot> w;\n        \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| -\n        gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n        \\<le> \\<^bold>|w\\<^bold>|\\<rbrakk>\n       \\<Longrightarrow> s \\<cdot> r = r \\<cdot> s", "then"], ["proof (chain)\npicking this:\n  \\<lbrakk>s = \\<epsilon> \\<Longrightarrow> ?thesis;\n   \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow> ?thesis;\n   s \\<noteq> \\<epsilon> \\<and>\n   \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n   ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis", "show ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>s = \\<epsilon> \\<Longrightarrow> ?thesis;\n   \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow> ?thesis;\n   s \\<noteq> \\<epsilon> \\<and>\n   \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n   ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "proof (cases)"], ["proof (state)\ngoal (3 subgoals):\n 1. s = \\<epsilon> \\<Longrightarrow> s \\<cdot> r = r \\<cdot> s\n 2. \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s\n 3. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "case (empty)"], ["proof (state)\nthis:\n  s = \\<epsilon>\n\ngoal (3 subgoals):\n 1. s = \\<epsilon> \\<Longrightarrow> s \\<cdot> r = r \\<cdot> s\n 2. \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s\n 3. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "thus \"s \\<cdot> r = r \\<cdot> s\""], ["proof (prove)\nusing this:\n  s = \\<epsilon>\n\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "by fastforce"], ["proof (state)\nthis:\n  s \\<cdot> r = r \\<cdot> s\n\ngoal (2 subgoals):\n 1. \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s\n 2. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s\n 2. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "case (short)"], ["proof (state)\nthis:\n  \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>|\n\ngoal (2 subgoals):\n 1. \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s\n 2. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "thus \"s \\<cdot> r = r \\<cdot> s\""], ["proof (prove)\nusing this:\n  \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "using  \"less.hyps\"[OF  _ \\<open> w \\<le>p s \\<cdot> w\\<close> \\<open> w \\<le>p r \\<cdot> w\\<close> \n      \\<open>\\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| - (gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|) \\<le> \\<^bold>|w\\<^bold>|\\<close>[unfolded gcd.commute[of \"\\<^bold>|s\\<^bold>|\"] add.commute[of \"\\<^bold>|s\\<^bold>|\"]]]"], ["proof (prove)\nusing this:\n  \\<^bold>|r\\<^bold>| < \\<^bold>|s\\<^bold>|\n  \\<^bold>|r\\<^bold>| + \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>|\n  < \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| +\n    \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n  r \\<cdot> s = s \\<cdot> r\n\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "by fastforce"], ["proof (state)\nthis:\n  s \\<cdot> r = r \\<cdot> s\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "case (step)"], ["proof (state)\nthis:\n  s \\<noteq> \\<epsilon> \\<and> \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "hence  \"s \\<noteq> \\<epsilon>\" and \"\\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\""], ["proof (prove)\nusing this:\n  s \\<noteq> \\<epsilon> \\<and> \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> &&& \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|", "by blast+"], ["proof (state)\nthis:\n  s \\<noteq> \\<epsilon>\n  \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "from le_add_diff[OF gcd_le2_nat[OF \\<open>s \\<noteq> \\<epsilon>\\<close>[folded length_0_conv], of \"\\<^bold>|r\\<^bold>|\"], unfolded gcd.commute[of \"\\<^bold>|r\\<^bold>|\"]]"], ["proof (chain)\npicking this:\n  ?c \\<le> \\<^bold>|s\\<^bold>| + ?c -\n           gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|", "have \"\\<^bold>|r\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|\""], ["proof (prove)\nusing this:\n  ?c \\<le> \\<^bold>|s\\<^bold>| + ?c -\n           gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|r\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|", "using  \\<open>\\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| - (gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|) \\<le> \\<^bold>|w\\<^bold>|\\<close> order.trans"], ["proof (prove)\nusing this:\n  ?c \\<le> \\<^bold>|s\\<^bold>| + ?c -\n           gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n  \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| -\n  gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n  \\<le> \\<^bold>|w\\<^bold>|\n  \\<lbrakk>?a \\<le> ?b; ?b \\<le> ?c\\<rbrakk> \\<Longrightarrow> ?a \\<le> ?c\n\ngoal (1 subgoal):\n 1. \\<^bold>|r\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|", "by fast"], ["proof (state)\nthis:\n  \\<^bold>|r\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "hence \"\\<^bold>|s\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|\""], ["proof (prove)\nusing this:\n  \\<^bold>|r\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|", "using \\<open>\\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\\<close> order.trans"], ["proof (prove)\nusing this:\n  \\<^bold>|r\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|\n  \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\n  \\<lbrakk>?a \\<le> ?b; ?b \\<le> ?c\\<rbrakk> \\<Longrightarrow> ?a \\<le> ?c\n\ngoal (1 subgoal):\n 1. \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|", "by blast"], ["proof (state)\nthis:\n  \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|w\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "from pref_prod_long[OF  \\<open>w \\<le>p s \\<cdot> w\\<close> this]"], ["proof (chain)\npicking this:\n  s \\<le>p w", "have \"s \\<le>p w\""], ["proof (prove)\nusing this:\n  s \\<le>p w\n\ngoal (1 subgoal):\n 1. s \\<le>p w", "."], ["proof (state)\nthis:\n  s \\<le>p w\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "obtain w' where \"s \\<cdot> w' = w\" and \"\\<^bold>|w'\\<^bold>| < \\<^bold>|w\\<^bold>|\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>w'.\n        \\<lbrakk>s \\<cdot> w' = w;\n         \\<^bold>|w'\\<^bold>| < \\<^bold>|w\\<^bold>|\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using \\<open>s \\<noteq> \\<epsilon>\\<close> \\<open>s \\<le>p w\\<close>"], ["proof (prove)\nusing this:\n  s \\<noteq> \\<epsilon>\n  s \\<le>p w\n\ngoal (1 subgoal):\n 1. (\\<And>w'.\n        \\<lbrakk>s \\<cdot> w' = w;\n         \\<^bold>|w'\\<^bold>| < \\<^bold>|w\\<^bold>|\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  s \\<cdot> w' = w\n  \\<^bold>|w'\\<^bold>| < \\<^bold>|w\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "have \"w' \\<le>p w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. w' \\<le>p w", "using \\<open>w \\<le>p s \\<cdot> w\\<close>"], ["proof (prove)\nusing this:\n  w \\<le>p s \\<cdot> w\n\ngoal (1 subgoal):\n 1. w' \\<le>p w", "unfolding \\<open>s \\<cdot> w' = w\\<close>[symmetric] pref_cancel_conv"], ["proof (prove)\nusing this:\n  w' \\<le>p s \\<cdot> w'\n\ngoal (1 subgoal):\n 1. w' \\<le>p s \\<cdot> w'", "."], ["proof (state)\nthis:\n  w' \\<le>p w\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "from this[folded \\<open>s \\<cdot> w' = w\\<close>]"], ["proof (chain)\npicking this:\n  w' \\<le>p s \\<cdot> w'", "have \"w' \\<le>p s\\<cdot>w'\""], ["proof (prove)\nusing this:\n  w' \\<le>p s \\<cdot> w'\n\ngoal (1 subgoal):\n 1. w' \\<le>p s \\<cdot> w'", "."], ["proof (state)\nthis:\n  w' \\<le>p s \\<cdot> w'\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "have \"s \\<le>p r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<le>p r", "using pref_prod_short[OF prefix_order.order.trans[OF \\<open>s \\<le>p w\\<close> \\<open>w \\<le>p r \\<cdot> w\\<close>] \\<open>\\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>|\\<close>]"], ["proof (prove)\nusing this:\n  s \\<le>p r\n\ngoal (1 subgoal):\n 1. s \\<le>p r", "."], ["proof (state)\nthis:\n  s \\<le>p r\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "hence  \"w' \\<le>p (s\\<inverse>\\<^sup>>r) \\<cdot> w'\""], ["proof (prove)\nusing this:\n  s \\<le>p r\n\ngoal (1 subgoal):\n 1. w' \\<le>p s\\<inverse>\\<^sup>>r \\<cdot> w'", "using \\<open>w \\<le>p r \\<cdot> w\\<close> \\<open>s \\<cdot> w' = w\\<close> pref_prod_pref[OF _ \\<open>w' \\<le>p w\\<close>, of \"s\\<inverse>\\<^sup>>r\"]"], ["proof (prove)\nusing this:\n  s \\<le>p r\n  w \\<le>p r \\<cdot> w\n  s \\<cdot> w' = w\n  w' \\<le>p s\\<inverse>\\<^sup>>r \\<cdot> w \\<Longrightarrow>\n  w' \\<le>p s\\<inverse>\\<^sup>>r \\<cdot> w'\n\ngoal (1 subgoal):\n 1. w' \\<le>p s\\<inverse>\\<^sup>>r \\<cdot> w'", "by fastforce"], ["proof (state)\nthis:\n  w' \\<le>p s\\<inverse>\\<^sup>>r \\<cdot> w'\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "have ind_len: \"\\<^bold>|s\\<^bold>| + \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>| - (gcd \\<^bold>|s\\<^bold>| \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>|) \\<le> \\<^bold>|w'\\<^bold>|\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>| -\n    gcd \\<^bold>|s\\<^bold>| \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>|\n    \\<le> \\<^bold>|w'\\<^bold>|", "using \\<open>\\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| - (gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|) \\<le> \\<^bold>|w\\<^bold>|\\<close> \\<open>s \\<cdot> w' = w\\<close> \\<open>s \\<le>p r\\<close>"], ["proof (prove)\nusing this:\n  \\<^bold>|s\\<^bold>| + \\<^bold>|r\\<^bold>| -\n  gcd \\<^bold>|s\\<^bold>| \\<^bold>|r\\<^bold>|\n  \\<le> \\<^bold>|w\\<^bold>|\n  s \\<cdot> w' = w\n  s \\<le>p r\n\ngoal (1 subgoal):\n 1. \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>| -\n    gcd \\<^bold>|s\\<^bold>| \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>|\n    \\<le> \\<^bold>|w'\\<^bold>|", "by auto"], ["proof (state)\nthis:\n  \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>| -\n  gcd \\<^bold>|s\\<^bold>| \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>|\n  \\<le> \\<^bold>|w'\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "have \"s \\<cdot> s\\<inverse>\\<^sup>>r = s\\<inverse>\\<^sup>>r \\<cdot> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<cdot> s\\<inverse>\\<^sup>>r = s\\<inverse>\\<^sup>>r \\<cdot> s", "using \"less.hyps\"[OF  _ \\<open>w' \\<le>p (s\\<inverse>\\<^sup>>r) \\<cdot> w'\\<close>  \\<open>w' \\<le>p s \\<cdot> w'\\<close> ind_len] \\<open>s \\<le>p r\\<close> \\<open>\\<^bold>|w'\\<^bold>| < \\<^bold>|w\\<^bold>|\\<close>"], ["proof (prove)\nusing this:\n  \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| +\n  \\<^bold>|s\\<inverse>\\<^sup>>r\\<^bold>|\n  < \\<^bold>|s\\<^bold>| + \\<^bold>|s\\<^bold>| +\n    \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n  s \\<cdot> s\\<inverse>\\<^sup>>r = s\\<inverse>\\<^sup>>r \\<cdot> s\n  s \\<le>p r\n  \\<^bold>|w'\\<^bold>| < \\<^bold>|w\\<^bold>|\n\ngoal (1 subgoal):\n 1. s \\<cdot> s\\<inverse>\\<^sup>>r = s\\<inverse>\\<^sup>>r \\<cdot> s", "by force"], ["proof (state)\nthis:\n  s \\<cdot> s\\<inverse>\\<^sup>>r = s\\<inverse>\\<^sup>>r \\<cdot> s\n\ngoal (1 subgoal):\n 1. s \\<noteq> \\<epsilon> \\<and>\n    \\<^bold>|s\\<^bold>| \\<le> \\<^bold>|r\\<^bold>| \\<Longrightarrow>\n    s \\<cdot> r = r \\<cdot> s", "thus \"s \\<cdot> r = r \\<cdot> s\""], ["proof (prove)\nusing this:\n  s \\<cdot> s\\<inverse>\\<^sup>>r = s\\<inverse>\\<^sup>>r \\<cdot> s\n\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "using \\<open>s \\<le>p r\\<close>"], ["proof (prove)\nusing this:\n  s \\<cdot> s\\<inverse>\\<^sup>>r = s\\<inverse>\\<^sup>>r \\<cdot> s\n  s \\<le>p r\n\ngoal (1 subgoal):\n 1. s \\<cdot> r = r \\<cdot> s", "by auto"], ["proof (state)\nthis:\n  s \\<cdot> r = r \\<cdot> s\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  s \\<cdot> r = r \\<cdot> s\n\ngoal:\nNo subgoals!", "qed"], ["", "text\\<open>We can now prove the numeric version.\\<close>"], ["", "theorem per_lemma: assumes \"periodN w p\" and \"periodN w q\" and len: \"p + q - gcd p q \\<le> \\<^bold>|w\\<^bold>|\"\n  shows  \"periodN w (gcd p q)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "have takep: \"w \\<le>p (take p w) \\<cdot> w\" and takeq: \"w \\<le>p (take q w) \\<cdot> w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. w \\<le>p take p w \\<cdot> w &&& w \\<le>p take q w \\<cdot> w", "using \\<open>periodN w p\\<close> \\<open>periodN w q\\<close> periodN_D3"], ["proof (prove)\nusing this:\n  periodN w p\n  periodN w q\n  periodN ?w ?n \\<Longrightarrow> ?w \\<le>p take ?n ?w \\<cdot> ?w\n\ngoal (1 subgoal):\n 1. w \\<le>p take p w \\<cdot> w &&& w \\<le>p take q w \\<cdot> w", "by blast+"], ["proof (state)\nthis:\n  w \\<le>p take p w \\<cdot> w\n  w \\<le>p take q w \\<cdot> w\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "have lenp: \"\\<^bold>|take p w\\<^bold>| = p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|take p w\\<^bold>| = p", "using gcd_le2_nat[OF per_positive[OF \\<open>periodN w q\\<close>], of p] len take_len"], ["proof (prove)\nusing this:\n  gcd p q \\<le> q\n  p + q - gcd p q \\<le> \\<^bold>|w\\<^bold>|\n  ?p \\<le> \\<^bold>|?w\\<^bold>| \\<Longrightarrow>\n  \\<^bold>|take ?p ?w\\<^bold>| = ?p\n\ngoal (1 subgoal):\n 1. \\<^bold>|take p w\\<^bold>| = p", "by auto"], ["proof (state)\nthis:\n  \\<^bold>|take p w\\<^bold>| = p\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "have lenq: \"\\<^bold>|take q w\\<^bold>| = q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|take q w\\<^bold>| = q", "using gcd_le1_nat[OF per_positive[OF \\<open>periodN w p\\<close>], of q] len take_len"], ["proof (prove)\nusing this:\n  gcd p q \\<le> p\n  p + q - gcd p q \\<le> \\<^bold>|w\\<^bold>|\n  ?p \\<le> \\<^bold>|?w\\<^bold>| \\<Longrightarrow>\n  \\<^bold>|take ?p ?w\\<^bold>| = ?p\n\ngoal (1 subgoal):\n 1. \\<^bold>|take q w\\<^bold>| = q", "by simp"], ["proof (state)\nthis:\n  \\<^bold>|take q w\\<^bold>| = q\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "obtain t where \"take p w \\<in> t*\" and \"take q w \\<in> t*\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>take p w \\<in> t*; take q w \\<in> t*\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using comm_rootE[OF per_lemma_comm[OF takeq takep, unfolded lenp lenq, OF len], of thesis]"], ["proof (prove)\nusing this:\n  (\\<And>t.\n      \\<lbrakk>take p w \\<in> t*; take q w \\<in> t*\\<rbrakk>\n      \\<Longrightarrow> thesis) \\<Longrightarrow>\n  thesis\n\ngoal (1 subgoal):\n 1. (\\<And>t.\n        \\<lbrakk>take p w \\<in> t*; take q w \\<in> t*\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  take p w \\<in> t*\n  take q w \\<in> t*\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "hence \"w \\<le>p t\\<^sup>\\<omega>\""], ["proof (prove)\nusing this:\n  take p w \\<in> t*\n  take q w \\<in> t*\n\ngoal (1 subgoal):\n 1. w \\<le>p t\\<^sup>\\<omega>", "using \\<open>periodN w p\\<close> periodN_def per_root_trans"], ["proof (prove)\nusing this:\n  take p w \\<in> t*\n  take q w \\<in> t*\n  periodN w p\n  periodN ?w ?n = ?w \\<le>p take ?n ?w\\<^sup>\\<omega>\n  \\<lbrakk>?w \\<le>p ?u\\<^sup>\\<omega>; ?u \\<in> ?t*\\<rbrakk>\n  \\<Longrightarrow> ?w \\<le>p ?t\\<^sup>\\<omega>\n\ngoal (1 subgoal):\n 1. w \\<le>p t\\<^sup>\\<omega>", "by blast"], ["proof (state)\nthis:\n  w \\<le>p t\\<^sup>\\<omega>\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "have \"periodN w \\<^bold>|t\\<^bold>|\""], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN w \\<^bold>|t\\<^bold>|", "using  root_periodN[OF  per_nemp[OF \\<open>periodN w p\\<close>] \\<open>w \\<le>p t\\<^sup>\\<omega>\\<close>]"], ["proof (prove)\nusing this:\n  periodN w \\<^bold>|t\\<^bold>|\n\ngoal (1 subgoal):\n 1. periodN w \\<^bold>|t\\<^bold>|", "."], ["proof (state)\nthis:\n  periodN w \\<^bold>|t\\<^bold>|\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "have \"\\<^bold>|t\\<^bold>| dvd (gcd p q)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|t\\<^bold>| dvd gcd p q", "using  common_root_len_gcd[OF \\<open>take p w \\<in> t*\\<close> \\<open>take q w \\<in> t*\\<close>]"], ["proof (prove)\nusing this:\n  \\<^bold>|t\\<^bold>| dvd\n  gcd \\<^bold>|take p w\\<^bold>| \\<^bold>|take q w\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|t\\<^bold>| dvd gcd p q", "unfolding  lenp lenq"], ["proof (prove)\nusing this:\n  \\<^bold>|t\\<^bold>| dvd gcd p q\n\ngoal (1 subgoal):\n 1. \\<^bold>|t\\<^bold>| dvd gcd p q", "."], ["proof (state)\nthis:\n  \\<^bold>|t\\<^bold>| dvd gcd p q\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "from dvd_div_mult_self[OF this]"], ["proof (chain)\npicking this:\n  gcd p q div \\<^bold>|t\\<^bold>| * \\<^bold>|t\\<^bold>| = gcd p q", "have \"gcd p q div \\<^bold>|t\\<^bold>| * \\<^bold>|t\\<^bold>| = gcd p q\""], ["proof (prove)\nusing this:\n  gcd p q div \\<^bold>|t\\<^bold>| * \\<^bold>|t\\<^bold>| = gcd p q\n\ngoal (1 subgoal):\n 1. gcd p q div \\<^bold>|t\\<^bold>| * \\<^bold>|t\\<^bold>| = gcd p q", "."], ["proof (state)\nthis:\n  gcd p q div \\<^bold>|t\\<^bold>| * \\<^bold>|t\\<^bold>| = gcd p q\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "have \"gcd p q \\<noteq> 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> 0", "using \\<open>periodN w p\\<close>"], ["proof (prove)\nusing this:\n  periodN w p\n\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> 0", "by auto"], ["proof (state)\nthis:\n  gcd p q \\<noteq> 0\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "from this[folded dvd_div_eq_0_iff[OF \\<open>\\<^bold>|t\\<^bold>| dvd (gcd p q)\\<close>]]"], ["proof (chain)\npicking this:\n  gcd p q div \\<^bold>|t\\<^bold>| \\<noteq> 0", "show \"periodN w (gcd p q)\""], ["proof (prove)\nusing this:\n  gcd p q div \\<^bold>|t\\<^bold>| \\<noteq> 0\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "using  per_mult[OF \\<open>periodN w \\<^bold>|t\\<^bold>|\\<close>, of \"gcd p q div \\<^bold>|t\\<^bold>|\", unfolded dvd_div_mult_self[OF \\<open>\\<^bold>|t\\<^bold>| dvd (gcd p q)\\<close>]]"], ["proof (prove)\nusing this:\n  gcd p q div \\<^bold>|t\\<^bold>| \\<noteq> 0\n  gcd p q div \\<^bold>|t\\<^bold>| \\<noteq> 0 \\<Longrightarrow>\n  periodN w (gcd p q)\n\ngoal (1 subgoal):\n 1. periodN w (gcd p q)", "by blast"], ["proof (state)\nthis:\n  periodN w (gcd p q)\n\ngoal:\nNo subgoals!", "qed"], ["", "section \\<open>Optimality\\<close>"], ["", "text\\<open>@{term \"FW_word\"} (where FW stands for  Fine and Wilf) yields a word which show the optimality of the bound in the Periodicity lemma. \n    Moreover, the obtained word has maximum possible letters (each equality of letters is forced by periods). The latter is not proved here.\\<close>"], ["", "term \"butlast ([0..<(gcd p q)]\\<^sup>@(p div (gcd p q)))\\<cdot>[gcd p q]\\<cdot>(butlast ([0..<(gcd p q)]\\<^sup>@(p div (gcd p q))))\"\n\n\\<comment> \\<open>an auxiliary claim\\<close>"], ["", "lemma ext_per_sum: assumes \"periodN w p\" and \"periodN w q\" and  \"p \\<le> \\<^bold>|w\\<^bold>|\" \n  shows \"periodN ((take p w) \\<cdot> w) (p+q)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "have nemp: \"take p w \\<cdot> take q w \\<noteq> \\<epsilon>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. take p w \\<cdot> take q w \\<noteq> \\<epsilon>", "using \\<open>periodN w p\\<close>"], ["proof (prove)\nusing this:\n  periodN w p\n\ngoal (1 subgoal):\n 1. take p w \\<cdot> take q w \\<noteq> \\<epsilon>", "by auto"], ["proof (state)\nthis:\n  take p w \\<cdot> take q w \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "have \"take (p + q) (take p w \\<cdot> w) = take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. take (p + q) (take p w \\<cdot> w) =\n    take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w))", "using take_add"], ["proof (prove)\nusing this:\n  take (?i + ?j) ?xs = take ?i ?xs \\<cdot> take ?j (drop ?i ?xs)\n\ngoal (1 subgoal):\n 1. take (p + q) (take p w \\<cdot> w) =\n    take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w))", "by blast"], ["proof (state)\nthis:\n  take (p + q) (take p w \\<cdot> w) =\n  take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w))\n\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "also"], ["proof (state)\nthis:\n  take (p + q) (take p w \\<cdot> w) =\n  take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w))\n\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "have \"... = take p w \\<cdot> take q w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. take p (take p w \\<cdot> w) \\<cdot>\n    take q (drop p (take p w \\<cdot> w)) =\n    take p w \\<cdot> take q w", "by (simp add: \\<open>p \\<le> \\<^bold>|w\\<^bold>|\\<close>)"], ["proof (state)\nthis:\n  take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w)) =\n  take p w \\<cdot> take q w\n\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "ultimately"], ["proof (chain)\npicking this:\n  take (p + q) (take p w \\<cdot> w) =\n  take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w))\n  take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w)) =\n  take p w \\<cdot> take q w", "have sum: \"take (p + q) (take p w \\<cdot> w) = take p w \\<cdot> take q w\""], ["proof (prove)\nusing this:\n  take (p + q) (take p w \\<cdot> w) =\n  take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w))\n  take p (take p w \\<cdot> w) \\<cdot> take q (drop p (take p w \\<cdot> w)) =\n  take p w \\<cdot> take q w\n\ngoal (1 subgoal):\n 1. take (p + q) (take p w \\<cdot> w) = take p w \\<cdot> take q w", "by simp"], ["proof (state)\nthis:\n  take (p + q) (take p w \\<cdot> w) = take p w \\<cdot> take q w\n\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "using assms(1) assms(2) nemp"], ["proof (prove)\nusing this:\n  periodN w p\n  periodN w q\n  take p w \\<cdot> take q w \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. periodN (take p w \\<cdot> w) (p + q)", "unfolding periodN_def period_root_def sum rassoc same_prefix_prefix"], ["proof (prove)\nusing this:\n  w \\<le>p take p w \\<cdot> w \\<and> take p w \\<noteq> \\<epsilon>\n  w \\<le>p take q w \\<cdot> w \\<and> take q w \\<noteq> \\<epsilon>\n  take p w \\<cdot> take q w \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. w \\<le>p take q w \\<cdot> take p w \\<cdot> w \\<and>\n    take p w \\<cdot> take q w \\<noteq> \\<epsilon>", "using pref_prolong"], ["proof (prove)\nusing this:\n  w \\<le>p take p w \\<cdot> w \\<and> take p w \\<noteq> \\<epsilon>\n  w \\<le>p take q w \\<cdot> w \\<and> take q w \\<noteq> \\<epsilon>\n  take p w \\<cdot> take q w \\<noteq> \\<epsilon>\n  \\<lbrakk>?w \\<le>p ?z \\<cdot> ?r; ?r \\<le>p ?s\\<rbrakk>\n  \\<Longrightarrow> ?w \\<le>p ?z \\<cdot> ?s\n\ngoal (1 subgoal):\n 1. w \\<le>p take q w \\<cdot> take p w \\<cdot> w \\<and>\n    take p w \\<cdot> take q w \\<noteq> \\<epsilon>", "by blast"], ["proof (state)\nthis:\n  periodN (take p w \\<cdot> w) (p + q)\n\ngoal:\nNo subgoals!", "qed"], ["", "abbreviation \"fw_p_per p q \\<equiv> butlast ([0..<(gcd p q)]\\<^sup>@(p div (gcd p q)))\""], ["", "abbreviation \"fw_base p q \\<equiv> fw_p_per p q \\<cdot> [gcd p q]\\<cdot> fw_p_per p q\""], ["", "fun FW_word :: \"nat \\<Rightarrow> nat \\<Rightarrow> nat list\" where\n  FW_word_def: \"FW_word p q =  \n\\<comment>\\<open>symmetry\\<close>           (if q < p then  FW_word q p else \n\\<comment>\\<open>artificial value\\<close>   if p = 0 \\<or> p = q then \\<epsilon> else \n\\<comment>\\<open>base case\\<close>          if gcd p q = q - p then fw_base p q\n\\<comment>\\<open>step\\<close>               else (take p (FW_word p (q-p))) \\<cdot> FW_word p (q-p)    )\""], ["", "lemma FW_sym: \"FW_word p q = FW_word q p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. FW_word p q = FW_word q p", "by (cases rule: linorder_cases[of p q], simp+)"], ["", "theorem fw_word': \"\\<not> p dvd q \\<Longrightarrow> \\<not> q dvd p \\<Longrightarrow>\n \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and> periodN (FW_word p q) p \\<and> periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<not> p dvd q; \\<not> q dvd p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "proof (induction \"p + p + q\" arbitrary: p q rule: less_induct)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>p q.\n       \\<lbrakk>\\<And>pa qa.\n                   \\<lbrakk>pa + pa + qa < p + p + q; \\<not> pa dvd qa;\n                    \\<not> qa dvd pa\\<rbrakk>\n                   \\<Longrightarrow> \\<^bold>|FW_word pa qa\\<^bold>| =\n                                     pa + qa - gcd pa qa - 1 \\<and>\n                                     periodN (FW_word pa qa) pa \\<and>\n                                     periodN (FW_word pa qa) qa \\<and>\n                                     \\<not> periodN (FW_word pa qa)\n       (gcd pa qa);\n        \\<not> p dvd q; \\<not> q dvd p\\<rbrakk>\n       \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                         p + q - gcd p q - 1 \\<and>\n                         periodN (FW_word p q) p \\<and>\n                         periodN (FW_word p q) q \\<and>\n                         \\<not> periodN (FW_word p q) (gcd p q)", "case less"], ["proof (state)\nthis:\n  \\<lbrakk>?p + ?p + ?q < p + p + q; \\<not> ?p dvd ?q;\n   \\<not> ?q dvd ?p\\<rbrakk>\n  \\<Longrightarrow> \\<^bold>|FW_word ?p ?q\\<^bold>| =\n                    ?p + ?q - gcd ?p ?q - 1 \\<and>\n                    periodN (FW_word ?p ?q) ?p \\<and>\n                    periodN (FW_word ?p ?q) ?q \\<and>\n                    \\<not> periodN (FW_word ?p ?q) (gcd ?p ?q)\n  \\<not> p dvd q\n  \\<not> q dvd p\n\ngoal (1 subgoal):\n 1. \\<And>p q.\n       \\<lbrakk>\\<And>pa qa.\n                   \\<lbrakk>pa + pa + qa < p + p + q; \\<not> pa dvd qa;\n                    \\<not> qa dvd pa\\<rbrakk>\n                   \\<Longrightarrow> \\<^bold>|FW_word pa qa\\<^bold>| =\n                                     pa + qa - gcd pa qa - 1 \\<and>\n                                     periodN (FW_word pa qa) pa \\<and>\n                                     periodN (FW_word pa qa) qa \\<and>\n                                     \\<not> periodN (FW_word pa qa)\n       (gcd pa qa);\n        \\<not> p dvd q; \\<not> q dvd p\\<rbrakk>\n       \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                         p + q - gcd p q - 1 \\<and>\n                         periodN (FW_word p q) p \\<and>\n                         periodN (FW_word p q) q \\<and>\n                         \\<not> periodN (FW_word p q) (gcd p q)", "have \"p \\<noteq> 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p \\<noteq> 0", "using  \\<open>\\<not> q dvd p\\<close> dvd_0_right[of q]"], ["proof (prove)\nusing this:\n  \\<not> q dvd p\n  q dvd 0\n\ngoal (1 subgoal):\n 1. p \\<noteq> 0", "by meson"], ["proof (state)\nthis:\n  p \\<noteq> 0\n\ngoal (1 subgoal):\n 1. \\<And>p q.\n       \\<lbrakk>\\<And>pa qa.\n                   \\<lbrakk>pa + pa + qa < p + p + q; \\<not> pa dvd qa;\n                    \\<not> qa dvd pa\\<rbrakk>\n                   \\<Longrightarrow> \\<^bold>|FW_word pa qa\\<^bold>| =\n                                     pa + qa - gcd pa qa - 1 \\<and>\n                                     periodN (FW_word pa qa) pa \\<and>\n                                     periodN (FW_word pa qa) qa \\<and>\n                                     \\<not> periodN (FW_word pa qa)\n       (gcd pa qa);\n        \\<not> p dvd q; \\<not> q dvd p\\<rbrakk>\n       \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                         p + q - gcd p q - 1 \\<and>\n                         periodN (FW_word p q) p \\<and>\n                         periodN (FW_word p q) q \\<and>\n                         \\<not> periodN (FW_word p q) (gcd p q)", "have \"p \\<noteq> q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p \\<noteq> q", "using \\<open>\\<not> p dvd q\\<close>"], ["proof (prove)\nusing this:\n  \\<not> p dvd q\n\ngoal (1 subgoal):\n 1. p \\<noteq> q", "by auto"], ["proof (state)\nthis:\n  p \\<noteq> q\n\ngoal (1 subgoal):\n 1. \\<And>p q.\n       \\<lbrakk>\\<And>pa qa.\n                   \\<lbrakk>pa + pa + qa < p + p + q; \\<not> pa dvd qa;\n                    \\<not> qa dvd pa\\<rbrakk>\n                   \\<Longrightarrow> \\<^bold>|FW_word pa qa\\<^bold>| =\n                                     pa + qa - gcd pa qa - 1 \\<and>\n                                     periodN (FW_word pa qa) pa \\<and>\n                                     periodN (FW_word pa qa) qa \\<and>\n                                     \\<not> periodN (FW_word pa qa)\n       (gcd pa qa);\n        \\<not> p dvd q; \\<not> q dvd p\\<rbrakk>\n       \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                         p + q - gcd p q - 1 \\<and>\n                         periodN (FW_word p q) p \\<and>\n                         periodN (FW_word p q) q \\<and>\n                         \\<not> periodN (FW_word p q) (gcd p q)", "then"], ["proof (chain)\npicking this:\n  p \\<noteq> q", "consider \"q < p\" | \"p < q\""], ["proof (prove)\nusing this:\n  p \\<noteq> q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>q < p \\<Longrightarrow> thesis;\n     p < q \\<Longrightarrow> thesis\\<rbrakk>\n    \\<Longrightarrow> thesis", "by linarith"], ["proof (state)\nthis:\n  \\<lbrakk>q < p \\<Longrightarrow> ?thesis;\n   p < q \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. \\<And>p q.\n       \\<lbrakk>\\<And>pa qa.\n                   \\<lbrakk>pa + pa + qa < p + p + q; \\<not> pa dvd qa;\n                    \\<not> qa dvd pa\\<rbrakk>\n                   \\<Longrightarrow> \\<^bold>|FW_word pa qa\\<^bold>| =\n                                     pa + qa - gcd pa qa - 1 \\<and>\n                                     periodN (FW_word pa qa) pa \\<and>\n                                     periodN (FW_word pa qa) qa \\<and>\n                                     \\<not> periodN (FW_word pa qa)\n       (gcd pa qa);\n        \\<not> p dvd q; \\<not> q dvd p\\<rbrakk>\n       \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                         p + q - gcd p q - 1 \\<and>\n                         periodN (FW_word p q) p \\<and>\n                         periodN (FW_word p q) q \\<and>\n                         \\<not> periodN (FW_word p q) (gcd p q)", "then"], ["proof (chain)\npicking this:\n  \\<lbrakk>q < p \\<Longrightarrow> ?thesis;\n   p < q \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis", "show ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>q < p \\<Longrightarrow> ?thesis;\n   p < q \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "proof (cases)"], ["proof (state)\ngoal (2 subgoals):\n 1. q < p \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n 2. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "assume \"q < p\""], ["proof (state)\nthis:\n  q < p\n\ngoal (2 subgoals):\n 1. q < p \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n 2. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "have less: \"q + q + p < p + p + q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. q + q + p < p + p + q", "by (simp add: \\<open>q < p\\<close>)"], ["proof (state)\nthis:\n  q + q + p < p + p + q\n\ngoal (2 subgoals):\n 1. q < p \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n 2. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "thus ?case"], ["proof (prove)\nusing this:\n  q + q + p < p + p + q\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "using \"less.hyps\"[OF _ \\<open>\\<not> q dvd p\\<close> \\<open>\\<not> p dvd q\\<close>]"], ["proof (prove)\nusing this:\n  q + q + p < p + p + q\n  q + q + p < p + p + q \\<Longrightarrow>\n  \\<^bold>|FW_word q p\\<^bold>| = q + p - gcd q p - 1 \\<and>\n  periodN (FW_word q p) q \\<and>\n  periodN (FW_word q p) p \\<and> \\<not> periodN (FW_word q p) (gcd q p)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "unfolding FW_sym[of p q] gcd.commute[of p q] add.commute[of p q]"], ["proof (prove)\nusing this:\n  q + q + p < p + p + q\n  q + q + p < p + p + q \\<Longrightarrow>\n  \\<^bold>|FW_word q p\\<^bold>| = q + p - gcd q p - 1 \\<and>\n  periodN (FW_word q p) q \\<and>\n  periodN (FW_word q p) p \\<and> \\<not> periodN (FW_word q p) (gcd q p)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word q p\\<^bold>| = q + p - gcd q p - 1 \\<and>\n    periodN (FW_word q p) p \\<and>\n    periodN (FW_word q p) q \\<and> \\<not> periodN (FW_word q p) (gcd q p)", "by blast"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n  periodN (FW_word p q) p \\<and>\n  periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal (1 subgoal):\n 1. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "let ?d = \"gcd p q\""], ["proof (state)\ngoal (1 subgoal):\n 1. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "let ?dw = \"[0..<(gcd p q)]\""], ["proof (state)\ngoal (1 subgoal):\n 1. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "let ?pd = \"p div (gcd p q)\""], ["proof (state)\ngoal (1 subgoal):\n 1. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "assume \"p < q\""], ["proof (state)\nthis:\n  p < q\n\ngoal (1 subgoal):\n 1. p < q \\<Longrightarrow>\n    \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "thus ?thesis"], ["proof (prove)\nusing this:\n  p < q\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "proof (cases \"?d = q - p\")"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "assume \"?d = q - p\""], ["proof (state)\nthis:\n  gcd p q = q - p\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "hence \"p + ?d = q\""], ["proof (prove)\nusing this:\n  gcd p q = q - p\n\ngoal (1 subgoal):\n 1. p + gcd p q = q", "using \\<open>p < q\\<close>"], ["proof (prove)\nusing this:\n  gcd p q = q - p\n  p < q\n\ngoal (1 subgoal):\n 1. p + gcd p q = q", "by auto"], ["proof (state)\nthis:\n  p + gcd p q = q\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have fw: \"FW_word p q = fw_base p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. FW_word p q = fw_base p q", "using FW_word_def \\<open>p \\<noteq> 0\\<close> \\<open>gcd p q = q - p\\<close> \\<open>p < q\\<close>"], ["proof (prove)\nusing this:\n  FW_word ?p ?q =\n  (if ?q < ?p then FW_word ?q ?p\n   else if ?p = 0 \\<or> ?p = ?q then \\<epsilon>\n        else if gcd ?p ?q = ?q - ?p then fw_base ?p ?q\n             else take ?p (FW_word ?p (?q - ?p)) \\<cdot>\n                  FW_word ?p (?q - ?p))\n  p \\<noteq> 0\n  gcd p q = q - p\n  p < q\n\ngoal (1 subgoal):\n 1. FW_word p q = fw_base p q", "by auto"], ["proof (state)\nthis:\n  FW_word p q = fw_base p q\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have ppref: \"\\<^bold>|butlast (?dw\\<^sup>@?pd)\\<cdot>[?d]\\<^bold>| = p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|fw_p_per p q \\<cdot> [gcd p q]\\<^bold>| = p", "using length_append \\<open>p \\<noteq> 0\\<close> pow_len[of \"?dw\" \"?pd\"]"], ["proof (prove)\nusing this:\n  \\<^bold>|?xs \\<cdot> ?ys\\<^bold>| =\n  \\<^bold>|?xs\\<^bold>| + \\<^bold>|?ys\\<^bold>|\n  p \\<noteq> 0\n  \\<^bold>|[0..<gcd p q] \\<^sup>@ (p div gcd p q)\\<^bold>| =\n  p div gcd p q * \\<^bold>|[0..<gcd p q]\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|fw_p_per p q \\<cdot> [gcd p q]\\<^bold>| = p", "by auto"], ["proof (state)\nthis:\n  \\<^bold>|fw_p_per p q \\<cdot> [gcd p q]\\<^bold>| = p\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "note ppref' = this[unfolded length_append]"], ["proof (state)\nthis:\n  \\<^bold>|fw_p_per p q\\<^bold>| + \\<^bold>|[gcd p q]\\<^bold>| = p\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have qpref: \"\\<^bold>|butlast (?dw\\<^sup>@?pd)\\<cdot>[?d]\\<cdot>?dw\\<^bold>| = q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|fw_p_per p q \\<cdot> [gcd p q] \\<cdot> [0..<gcd p q]\\<^bold>| =\n    q", "unfolding lassoc length_append ppref'"], ["proof (prove)\ngoal (1 subgoal):\n 1. p + \\<^bold>|[0..<gcd p q]\\<^bold>| = q", "using  \\<open>p + gcd p q = q\\<close>"], ["proof (prove)\nusing this:\n  p + gcd p q = q\n\ngoal (1 subgoal):\n 1. p + \\<^bold>|[0..<gcd p q]\\<^bold>| = q", "by simp"], ["proof (state)\nthis:\n  \\<^bold>|fw_p_per p q \\<cdot> [gcd p q] \\<cdot> [0..<gcd p q]\\<^bold>| = q\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"butlast (?dw\\<^sup>@?pd)\\<cdot>[?d] \\<le>p FW_word p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fw_p_per p q \\<cdot> [gcd p q] \\<le>p FW_word p q", "unfolding fw"], ["proof (prove)\ngoal (1 subgoal):\n 1. fw_p_per p q \\<cdot> [gcd p q] \\<le>p fw_base p q", "by force"], ["proof (state)\nthis:\n  fw_p_per p q \\<cdot> [gcd p q] \\<le>p FW_word p q\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "from pref_take[OF this]"], ["proof (chain)\npicking this:\n  take \\<^bold>|fw_p_per p q \\<cdot> [gcd p q]\\<^bold>| (FW_word p q) =\n  fw_p_per p q \\<cdot> [gcd p q]", "have takep: \"take p (FW_word p q) = butlast (?dw\\<^sup>@?pd)\\<cdot>[?d]\""], ["proof (prove)\nusing this:\n  take \\<^bold>|fw_p_per p q \\<cdot> [gcd p q]\\<^bold>| (FW_word p q) =\n  fw_p_per p q \\<cdot> [gcd p q]\n\ngoal (1 subgoal):\n 1. take p (FW_word p q) = fw_p_per p q \\<cdot> [gcd p q]", "unfolding ppref"], ["proof (prove)\nusing this:\n  take p (FW_word p q) = fw_p_per p q \\<cdot> [gcd p q]\n\ngoal (1 subgoal):\n 1. take p (FW_word p q) = fw_p_per p q \\<cdot> [gcd p q]", "."], ["proof (state)\nthis:\n  take p (FW_word p q) = fw_p_per p q \\<cdot> [gcd p q]\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"?dw \\<noteq> \\<epsilon>\" and \"\\<^bold>|?dw\\<^bold>| = ?d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<noteq> \\<epsilon> &&&\n    \\<^bold>|[0..<gcd p q]\\<^bold>| = gcd p q", "using \\<open>p \\<noteq> 0\\<close>"], ["proof (prove)\nusing this:\n  p \\<noteq> 0\n\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<noteq> \\<epsilon> &&&\n    \\<^bold>|[0..<gcd p q]\\<^bold>| = gcd p q", "by auto"], ["proof (state)\nthis:\n  [0..<gcd p q] \\<noteq> \\<epsilon>\n  \\<^bold>|[0..<gcd p q]\\<^bold>| = gcd p q\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"?pd \\<noteq> 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p div gcd p q \\<noteq> 0", "by (simp add: \\<open>p \\<noteq> 0\\<close> dvd_div_eq_0_iff)"], ["proof (state)\nthis:\n  p div gcd p q \\<noteq> 0\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "from not0_implies_Suc[OF this]"], ["proof (chain)\npicking this:\n  \\<exists>m. p div gcd p q = Suc m", "obtain e where \"?pd = Suc e\""], ["proof (prove)\nusing this:\n  \\<exists>m. p div gcd p q = Suc m\n\ngoal (1 subgoal):\n 1. (\\<And>e.\n        p div gcd p q = Suc e \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  p div gcd p q = Suc e\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"gcd p q \\<noteq> p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> p", "using \\<open>\\<not> p dvd q\\<close> gcd_dvd2[of p q]"], ["proof (prove)\nusing this:\n  \\<not> p dvd q\n  gcd p q dvd q\n\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> p", "by force"], ["proof (state)\nthis:\n  gcd p q \\<noteq> p\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "hence \"Suc e \\<noteq> 1\""], ["proof (prove)\nusing this:\n  gcd p q \\<noteq> p\n\ngoal (1 subgoal):\n 1. Suc e \\<noteq> 1", "using dvd_mult_div_cancel[OF gcd_dvd1[of p q], unfolded \\<open>?pd = Suc e\\<close>]"], ["proof (prove)\nusing this:\n  gcd p q \\<noteq> p\n  gcd p q * Suc e = p\n\ngoal (1 subgoal):\n 1. Suc e \\<noteq> 1", "by force"], ["proof (state)\nthis:\n  Suc e \\<noteq> 1\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "hence \"e \\<noteq> 0\""], ["proof (prove)\nusing this:\n  Suc e \\<noteq> 1\n\ngoal (1 subgoal):\n 1. e \\<noteq> 0", "by simp"], ["proof (state)\nthis:\n  e \\<noteq> 0\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"[0..<gcd p q] \\<^sup>@ e \\<noteq> \\<epsilon>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<^sup>@ e \\<noteq> \\<epsilon>", "using \\<open>[0..<gcd p q] \\<noteq> \\<epsilon>\\<close> \\<open>e \\<noteq> 0\\<close> nonzero_pow_emp"], ["proof (prove)\nusing this:\n  [0..<gcd p q] \\<noteq> \\<epsilon>\n  e \\<noteq> 0\n  ?m \\<noteq> 0 \\<Longrightarrow>\n  (?u \\<^sup>@ ?m = \\<epsilon>) = (?u = \\<epsilon>)\n\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<^sup>@ e \\<noteq> \\<epsilon>", "by blast"], ["proof (state)\nthis:\n  [0..<gcd p q] \\<^sup>@ e \\<noteq> \\<epsilon>\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "hence but_dec: \"butlast (?dw\\<^sup>@?pd) = ?dw \\<cdot> butlast (?dw\\<^sup>@e)\""], ["proof (prove)\nusing this:\n  [0..<gcd p q] \\<^sup>@ e \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. fw_p_per p q = [0..<gcd p q] \\<cdot> butlast ([0..<gcd p q] \\<^sup>@ e)", "unfolding \\<open>?pd = Suc e\\<close> pow_Suc_list butlast_append  if_not_P[OF \\<open>[0..<gcd p q] \\<^sup>@ e \\<noteq> \\<epsilon>\\<close>]"], ["proof (prove)\nusing this:\n  [0..<gcd p q] \\<^sup>@ e \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<cdot> butlast ([0..<gcd p q] \\<^sup>@ e) =\n    [0..<gcd p q] \\<cdot> butlast ([0..<gcd p q] \\<^sup>@ e)", "by blast"], ["proof (state)\nthis:\n  fw_p_per p q = [0..<gcd p q] \\<cdot> butlast ([0..<gcd p q] \\<^sup>@ e)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have but_dec_b: \"butlast (?dw\\<^sup>@?pd) = ?dw\\<^sup>@e \\<cdot> butlast ?dw\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fw_p_per p q = [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q]", "unfolding \\<open>?pd = Suc e\\<close> pow_Suc2_list butlast_append if_not_P[OF \\<open>?dw \\<noteq> \\<epsilon>\\<close>]"], ["proof (prove)\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q] =\n    [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q]", "by blast"], ["proof (state)\nthis:\n  fw_p_per p q = [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q]\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"butlast (?dw\\<^sup>@?pd)\\<cdot>[?d]\\<cdot>?dw \\<le>p FW_word p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fw_p_per p q \\<cdot> [gcd p q] \\<cdot> [0..<gcd p q] \\<le>p FW_word p q", "using fw but_dec"], ["proof (prove)\nusing this:\n  FW_word p q = fw_base p q\n  fw_p_per p q = [0..<gcd p q] \\<cdot> butlast ([0..<gcd p q] \\<^sup>@ e)\n\ngoal (1 subgoal):\n 1. fw_p_per p q \\<cdot> [gcd p q] \\<cdot> [0..<gcd p q] \\<le>p FW_word p q", "by auto"], ["proof (state)\nthis:\n  fw_p_per p q \\<cdot> [gcd p q] \\<cdot> [0..<gcd p q] \\<le>p FW_word p q\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "note takeq = pref_take[OF this, unfolded qpref]"], ["proof (state)\nthis:\n  take q (FW_word p q) =\n  fw_p_per p q \\<cdot> [gcd p q] \\<cdot> [0..<gcd p q]\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "have \"\\<^bold>|?dw\\<^bold>| = ?d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|[0..<gcd p q]\\<^bold>| = gcd p q", "by auto"], ["proof (state)\nthis:\n  \\<^bold>|[0..<gcd p q]\\<^bold>| = gcd p q\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "have \"gcd p q dvd p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p q dvd p", "by auto"], ["proof (state)\nthis:\n  gcd p q dvd p\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "hence \"\\<^bold>|?dw\\<^sup>@?pd\\<^bold>| = p\""], ["proof (prove)\nusing this:\n  gcd p q dvd p\n\ngoal (1 subgoal):\n 1. \\<^bold>|[0..<gcd p q] \\<^sup>@ (p div gcd p q)\\<^bold>| = p", "using pow_len[of \"?dw\" \"?pd\"]"], ["proof (prove)\nusing this:\n  gcd p q dvd p\n  \\<^bold>|[0..<gcd p q] \\<^sup>@ (p div gcd p q)\\<^bold>| =\n  p div gcd p q * \\<^bold>|[0..<gcd p q]\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|[0..<gcd p q] \\<^sup>@ (p div gcd p q)\\<^bold>| = p", "by auto"], ["proof (state)\nthis:\n  \\<^bold>|[0..<gcd p q] \\<^sup>@ (p div gcd p q)\\<^bold>| = p\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "hence \"\\<^bold>|butlast (?dw\\<^sup>@?pd)\\<^bold>| = p - 1\""], ["proof (prove)\nusing this:\n  \\<^bold>|[0..<gcd p q] \\<^sup>@ (p div gcd p q)\\<^bold>| = p\n\ngoal (1 subgoal):\n 1. \\<^bold>|fw_p_per p q\\<^bold>| = p - 1", "by simp"], ["proof (state)\nthis:\n  \\<^bold>|fw_p_per p q\\<^bold>| = p - 1\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "hence \"\\<^bold>|FW_word p q\\<^bold>| = (p - 1) + 1 +  (p - 1)\""], ["proof (prove)\nusing this:\n  \\<^bold>|fw_p_per p q\\<^bold>| = p - 1\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p - 1 + 1 + (p - 1)", "using fw"], ["proof (prove)\nusing this:\n  \\<^bold>|fw_p_per p q\\<^bold>| = p - 1\n  FW_word p q = fw_base p q\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p - 1 + 1 + (p - 1)", "unfolding length_append"], ["proof (prove)\nusing this:\n  \\<^bold>|fw_p_per p q\\<^bold>| = p - 1\n  FW_word p q = fw_base p q\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p - 1 + 1 + (p - 1)", "by auto"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p - 1 + 1 + (p - 1)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "thus \"\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\""], ["proof (prove)\nusing this:\n  \\<^bold>|FW_word p q\\<^bold>| = p - 1 + 1 + (p - 1)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "unfolding \\<open>gcd p q = q - p\\<close>"], ["proof (prove)\nusing this:\n  \\<^bold>|FW_word p q\\<^bold>| = p - 1 + 1 + (p - 1)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - (q - p) - 1", "using \\<open>p + gcd p q = q\\<close> \\<open>p \\<noteq> 0\\<close> add.assoc"], ["proof (prove)\nusing this:\n  \\<^bold>|FW_word p q\\<^bold>| = p - 1 + 1 + (p - 1)\n  p + gcd p q = q\n  p \\<noteq> 0\n  ?a + ?b + ?c = ?a + (?b + ?c)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - (q - p) - 1", "by auto"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"periodN (FW_word p q) p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN (FW_word p q) p", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. periodN (FW_word p q) p", "have \"take p (FW_word p q) \\<noteq> \\<epsilon>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. take p (FW_word p q) \\<noteq> \\<epsilon>", "using \\<open>p \\<noteq> 0\\<close>"], ["proof (prove)\nusing this:\n  p \\<noteq> 0\n\ngoal (1 subgoal):\n 1. take p (FW_word p q) \\<noteq> \\<epsilon>", "unfolding length_0_conv[symmetric] ppref[folded takep]"], ["proof (prove)\nusing this:\n  p \\<noteq> 0\n\ngoal (1 subgoal):\n 1. p \\<noteq> 0", "."], ["proof (state)\nthis:\n  take p (FW_word p q) \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. periodN (FW_word p q) p", "thus \"periodN (FW_word p q) p\""], ["proof (prove)\nusing this:\n  take p (FW_word p q) \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. periodN (FW_word p q) p", "unfolding periodN_def period_root_def  takep"], ["proof (prove)\nusing this:\n  fw_p_per p q \\<cdot> [gcd p q] \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. FW_word p q \\<le>p\n    (fw_p_per p q \\<cdot> [gcd p q]) \\<cdot> FW_word p q \\<and>\n    fw_p_per p q \\<cdot> [gcd p q] \\<noteq> \\<epsilon>", "unfolding fw lassoc"], ["proof (prove)\nusing this:\n  fw_p_per p q \\<cdot> [gcd p q] \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. (fw_p_per p q \\<cdot> [gcd p q]) \\<cdot> fw_p_per p q \\<le>p\n    (((fw_p_per p q \\<cdot> [gcd p q]) \\<cdot> fw_p_per p q) \\<cdot>\n     [gcd p q]) \\<cdot>\n    fw_p_per p q \\<and>\n    fw_p_per p q \\<cdot> [gcd p q] \\<noteq> \\<epsilon>", "by auto"], ["proof (state)\nthis:\n  periodN (FW_word p q) p\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  periodN (FW_word p q) p\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"periodN (FW_word p q) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN (FW_word p q) q", "unfolding periodN_def period_root_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. FW_word p q \\<le>p take q (FW_word p q) \\<cdot> FW_word p q \\<and>\n    take q (FW_word p q) \\<noteq> \\<epsilon>", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. FW_word p q \\<le>p take q (FW_word p q) \\<cdot> FW_word p q\n 2. take q (FW_word p q) \\<noteq> \\<epsilon>", "show \"take q (FW_word p q) \\<noteq> \\<epsilon>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. take q (FW_word p q) \\<noteq> \\<epsilon>", "unfolding length_0_conv[symmetric] qpref[folded takeq]"], ["proof (prove)\ngoal (1 subgoal):\n 1. q \\<noteq> 0", "using \\<open>p \\<noteq> 0\\<close> \\<open>p < q\\<close>"], ["proof (prove)\nusing this:\n  p \\<noteq> 0\n  p < q\n\ngoal (1 subgoal):\n 1. q \\<noteq> 0", "by linarith"], ["proof (state)\nthis:\n  take q (FW_word p q) \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. FW_word p q \\<le>p take q (FW_word p q) \\<cdot> FW_word p q", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. FW_word p q \\<le>p take q (FW_word p q) \\<cdot> FW_word p q", "show \"FW_word p q \\<le>p take q (FW_word p q) \\<cdot> FW_word p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. FW_word p q \\<le>p take q (FW_word p q) \\<cdot> FW_word p q", "unfolding takeq"], ["proof (prove)\ngoal (1 subgoal):\n 1. FW_word p q \\<le>p\n    (fw_p_per p q \\<cdot> [gcd p q] \\<cdot> [0..<gcd p q]) \\<cdot>\n    FW_word p q", "unfolding fw rassoc pref_cancel_conv but_dec but_dec_b \\<open>?pd = Suc e\\<close> pow_Suc2_list butlast_append pow_Suc_list if_not_P[OF \\<open>?dw \\<noteq> \\<epsilon>\\<close>]"], ["proof (prove)\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q] \\<le>p\n    [0..<gcd p q] \\<cdot>\n    [0..<gcd p q] \\<^sup>@ e \\<cdot>\n    butlast [0..<gcd p q] \\<cdot>\n    [gcd p q] \\<cdot> [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q]", "unfolding lassoc power_commutes[symmetric]"], ["proof (prove)\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q] \\<le>p\n    (((([0..<gcd p q] \\<^sup>@ e \\<cdot> [0..<gcd p q]) \\<cdot>\n       butlast [0..<gcd p q]) \\<cdot>\n      [gcd p q]) \\<cdot>\n     [0..<gcd p q] \\<^sup>@ e) \\<cdot>\n    butlast [0..<gcd p q]", "unfolding rassoc pref_cancel_conv"], ["proof (prove)\ngoal (1 subgoal):\n 1. butlast [0..<gcd p q] \\<le>p\n    [0..<gcd p q] \\<cdot>\n    butlast [0..<gcd p q] \\<cdot>\n    [gcd p q] \\<cdot> [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q]", "using pref_ext[OF prefixeq_butlast, of \"?dw\"]"], ["proof (prove)\nusing this:\n  butlast [0..<gcd p q] \\<le>p [0..<gcd p q] \\<cdot> ?zs\n\ngoal (1 subgoal):\n 1. butlast [0..<gcd p q] \\<le>p\n    [0..<gcd p q] \\<cdot>\n    butlast [0..<gcd p q] \\<cdot>\n    [gcd p q] \\<cdot> [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q]", "by blast"], ["proof (state)\nthis:\n  FW_word p q \\<le>p take q (FW_word p q) \\<cdot> FW_word p q\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  periodN (FW_word p q) q\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"\\<not> periodN (FW_word p q) ?d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "have last_a: \"last (take p (FW_word p q)) = ?d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. last (take p (FW_word p q)) = gcd p q", "unfolding takep nth_append_length[of \"butlast (?dw \\<^sup>@ ?pd)\" \"?d\" \\<epsilon>]\n            last_snoc"], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p q = gcd p q", "by blast"], ["proof (state)\nthis:\n  last (take p (FW_word p q)) = gcd p q\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "have \"?dw \\<le>p FW_word p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<le>p FW_word p q", "using fw but_dec"], ["proof (prove)\nusing this:\n  FW_word p q = fw_base p q\n  fw_p_per p q = [0..<gcd p q] \\<cdot> butlast ([0..<gcd p q] \\<^sup>@ e)\n\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<le>p FW_word p q", "by simp"], ["proof (state)\nthis:\n  [0..<gcd p q] \\<le>p FW_word p q\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "from pref_take[OF this, unfolded \\<open>\\<^bold>|?dw\\<^bold>| = ?d\\<close>]"], ["proof (chain)\npicking this:\n  take (gcd p q) (FW_word p q) = [0..<gcd p q]", "have takegcd:  \"take (gcd p q) (FW_word p q) = [0..<gcd p q]\""], ["proof (prove)\nusing this:\n  take (gcd p q) (FW_word p q) = [0..<gcd p q]\n\ngoal (1 subgoal):\n 1. take (gcd p q) (FW_word p q) = [0..<gcd p q]", "."], ["proof (state)\nthis:\n  take (gcd p q) (FW_word p q) = [0..<gcd p q]\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "have fw_dec_b: \"FW_word p q = [0..<gcd p q]\\<^sup>@e \\<cdot> butlast ([0..<gcd p q]) \\<cdot> [?d] \\<cdot> (butlast ([0..<gcd p q]\\<^sup>@(p div gcd p q)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. FW_word p q =\n    [0..<gcd p q] \\<^sup>@ e \\<cdot>\n    butlast [0..<gcd p q] \\<cdot> [gcd p q] \\<cdot> fw_p_per p q", "using fw but_dec_b"], ["proof (prove)\nusing this:\n  FW_word p q = fw_base p q\n  fw_p_per p q = [0..<gcd p q] \\<^sup>@ e \\<cdot> butlast [0..<gcd p q]\n\ngoal (1 subgoal):\n 1. FW_word p q =\n    [0..<gcd p q] \\<^sup>@ e \\<cdot>\n    butlast [0..<gcd p q] \\<cdot> [gcd p q] \\<cdot> fw_p_per p q", "by simp"], ["proof (state)\nthis:\n  FW_word p q =\n  [0..<gcd p q] \\<^sup>@ e \\<cdot>\n  butlast [0..<gcd p q] \\<cdot> [gcd p q] \\<cdot> fw_p_per p q\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "hence gcdepref:  \"[0..<gcd p q]\\<^sup>@ Suc e \\<le>p take (gcd p q) (FW_word p q) \\<cdot> FW_word p q\""], ["proof (prove)\nusing this:\n  FW_word p q =\n  [0..<gcd p q] \\<^sup>@ e \\<cdot>\n  butlast [0..<gcd p q] \\<cdot> [gcd p q] \\<cdot> fw_p_per p q\n\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<^sup>@ Suc e \\<le>p\n    take (gcd p q) (FW_word p q) \\<cdot> FW_word p q", "using takegcd"], ["proof (prove)\nusing this:\n  FW_word p q =\n  [0..<gcd p q] \\<^sup>@ e \\<cdot>\n  butlast [0..<gcd p q] \\<cdot> [gcd p q] \\<cdot> fw_p_per p q\n  take (gcd p q) (FW_word p q) = [0..<gcd p q]\n\ngoal (1 subgoal):\n 1. [0..<gcd p q] \\<^sup>@ Suc e \\<le>p\n    take (gcd p q) (FW_word p q) \\<cdot> FW_word p q", "by simp"], ["proof (state)\nthis:\n  [0..<gcd p q] \\<^sup>@ Suc e \\<le>p\n  take (gcd p q) (FW_word p q) \\<cdot> FW_word p q\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "have \"\\<^bold>|[0..<gcd p q]\\<^sup>@ Suc e\\<^bold>| = p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|[0..<gcd p q] \\<^sup>@ Suc e\\<^bold>| = p", "unfolding pow_len \\<open>\\<^bold>|?dw\\<^bold>| = ?d\\<close> \\<open>?pd = Suc e\\<close>[symmetric]"], ["proof (prove)\ngoal (1 subgoal):\n 1. p div gcd p q * gcd p q = p", "using  \n            dvd_div_mult_self[OF gcd_dvd1]"], ["proof (prove)\nusing this:\n  ?b div gcd ?b ?b1 * gcd ?b ?b1 = ?b\n\ngoal (1 subgoal):\n 1. p div gcd p q * gcd p q = p", "."], ["proof (state)\nthis:\n  \\<^bold>|[0..<gcd p q] \\<^sup>@ Suc e\\<^bold>| = p\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "from pref_take[OF gcdepref, unfolded this]"], ["proof (chain)\npicking this:\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q) =\n  [0..<gcd p q] \\<^sup>@ Suc e", "have takegcdp:  \"take p (take (gcd p q) (FW_word p q) \\<cdot> (FW_word p q)) = [0..<gcd p q]\\<^sup>@e \\<cdot> [0..<gcd p q]\""], ["proof (prove)\nusing this:\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q) =\n  [0..<gcd p q] \\<^sup>@ Suc e\n\ngoal (1 subgoal):\n 1. take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q) =\n    [0..<gcd p q] \\<^sup>@ e \\<cdot> [0..<gcd p q]", "unfolding pow_Suc2_list"], ["proof (prove)\nusing this:\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q) =\n  [0..<gcd p q] \\<^sup>@ e \\<cdot> [0..<gcd p q]\n\ngoal (1 subgoal):\n 1. take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q) =\n    [0..<gcd p q] \\<^sup>@ e \\<cdot> [0..<gcd p q]", "."], ["proof (state)\nthis:\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q) =\n  [0..<gcd p q] \\<^sup>@ e \\<cdot> [0..<gcd p q]\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "have \"0 < gcd p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < gcd p q", "by (simp add: \\<open>p \\<noteq> 0\\<close>)"], ["proof (state)\nthis:\n  0 < gcd p q\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "from last_upt[OF this]"], ["proof (chain)\npicking this:\n  last [0..<gcd p q] = gcd p q - 1", "have last_b: \"last (take p (take (gcd p q) (FW_word p q) \\<cdot> (FW_word p q))) = gcd p q - 1\""], ["proof (prove)\nusing this:\n  last [0..<gcd p q] = gcd p q - 1\n\ngoal (1 subgoal):\n 1. last (take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)) =\n    gcd p q - 1", "unfolding takegcdp  last_appendR[of \"[0..<gcd p q]\" \"[0..<gcd p q]\\<^sup>@e\", OF \\<open>[0..<gcd p q] \\<noteq> \\<epsilon>\\<close>]"], ["proof (prove)\nusing this:\n  last [0..<gcd p q] = gcd p q - 1\n\ngoal (1 subgoal):\n 1. last [0..<gcd p q] = gcd p q - 1", "."], ["proof (state)\nthis:\n  last (take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)) =\n  gcd p q - 1\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "have \"p \\<le> \\<^bold>|FW_word p q\\<^bold>|\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p \\<le> \\<^bold>|FW_word p q\\<^bold>|", "using \\<open>\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\\<close> \\<open>gcd p q = q - p\\<close> \\<open>p < q\\<close>"], ["proof (prove)\nusing this:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n  gcd p q = q - p\n  p < q\n\ngoal (1 subgoal):\n 1. p \\<le> \\<^bold>|FW_word p q\\<^bold>|", "by linarith"], ["proof (state)\nthis:\n  p \\<le> \\<^bold>|FW_word p q\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "have \"gcd p q \\<noteq> gcd p q - 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> gcd p q - 1", "using \\<open>gcd p q = q - p\\<close> \\<open>p < q\\<close>"], ["proof (prove)\nusing this:\n  gcd p q = q - p\n  p < q\n\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> gcd p q - 1", "by linarith"], ["proof (state)\nthis:\n  gcd p q \\<noteq> gcd p q - 1\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "hence \"take p (FW_word p q) \\<noteq> take p (take (gcd p q) (FW_word p q) \\<cdot> (FW_word p q))\""], ["proof (prove)\nusing this:\n  gcd p q \\<noteq> gcd p q - 1\n\ngoal (1 subgoal):\n 1. take p (FW_word p q) \\<noteq>\n    take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)", "unfolding last_b[symmetric]"], ["proof (prove)\nusing this:\n  gcd p q \\<noteq>\n  last (take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q))\n\ngoal (1 subgoal):\n 1. take p (FW_word p q) \\<noteq>\n    take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)", "unfolding last_a[symmetric]"], ["proof (prove)\nusing this:\n  last (take p (FW_word p q)) \\<noteq>\n  last\n   (take p\n     (take (last (take p (FW_word p q))) (FW_word p q) \\<cdot> FW_word p q))\n\ngoal (1 subgoal):\n 1. take p (FW_word p q) \\<noteq>\n    take p\n     (take (last (take p (FW_word p q))) (FW_word p q) \\<cdot> FW_word p q)", "using arg_cong[of _ _ last]"], ["proof (prove)\nusing this:\n  last (take p (FW_word p q)) \\<noteq>\n  last\n   (take p\n     (take (last (take p (FW_word p q))) (FW_word p q) \\<cdot> FW_word p q))\n  ?x = ?y \\<Longrightarrow> last ?x = last ?y\n\ngoal (1 subgoal):\n 1. take p (FW_word p q) \\<noteq>\n    take p\n     (take (last (take p (FW_word p q))) (FW_word p q) \\<cdot> FW_word p q)", "by blast"], ["proof (state)\nthis:\n  take p (FW_word p q) \\<noteq>\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "hence \"\\<not> FW_word p q \\<le>p take (gcd p q) (FW_word p q) \\<cdot> FW_word p q \""], ["proof (prove)\nusing this:\n  take p (FW_word p q) \\<noteq>\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)\n\ngoal (1 subgoal):\n 1. \\<not> FW_word p q \\<le>p\n           take (gcd p q) (FW_word p q) \\<cdot> FW_word p q", "using pref_share_take[OF _ \\<open>p \\<le> \\<^bold>|FW_word p q\\<^bold>|\\<close>, of \"take (gcd p q) (FW_word p q) \\<cdot> FW_word p q\"]"], ["proof (prove)\nusing this:\n  take p (FW_word p q) \\<noteq>\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)\n  FW_word p q \\<le>p\n  take (gcd p q) (FW_word p q) \\<cdot> FW_word p q \\<Longrightarrow>\n  take p (FW_word p q) =\n  take p (take (gcd p q) (FW_word p q) \\<cdot> FW_word p q)\n\ngoal (1 subgoal):\n 1. \\<not> FW_word p q \\<le>p\n           take (gcd p q) (FW_word p q) \\<cdot> FW_word p q", "by blast"], ["proof (state)\nthis:\n  \\<not> FW_word p q \\<le>p take (gcd p q) (FW_word p q) \\<cdot> FW_word p q\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "thus \"\\<not> periodN (FW_word p q) (gcd p q)\""], ["proof (prove)\nusing this:\n  \\<not> FW_word p q \\<le>p take (gcd p q) (FW_word p q) \\<cdot> FW_word p q\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "unfolding periodN_def period_root_def"], ["proof (prove)\nusing this:\n  \\<not> FW_word p q \\<le>p take (gcd p q) (FW_word p q) \\<cdot> FW_word p q\n\ngoal (1 subgoal):\n 1. \\<not> (FW_word p q \\<le>p\n            take (gcd p q) (FW_word p q) \\<cdot> FW_word p q \\<and>\n            take (gcd p q) (FW_word p q) \\<noteq> \\<epsilon>)", "by blast"], ["proof (state)\nthis:\n  \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>p < q; gcd p q = q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)\n 2. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "using \\<open>periodN (FW_word p q) p\\<close> \\<open>periodN (FW_word p q) q\\<close>\n          \\<open>\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\\<close> \\<open>\\<not> periodN (FW_word p q) (gcd p q)\\<close>"], ["proof (prove)\nusing this:\n  periodN (FW_word p q) p\n  periodN (FW_word p q) q\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n  \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "by blast"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n  periodN (FW_word p q) p \\<and>\n  periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "let ?d' = \"gcd p (q-p)\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "assume \"gcd p q \\<noteq> q - p\""], ["proof (state)\nthis:\n  gcd p q \\<noteq> q - p\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "hence fw: \"FW_word p q = (take p (FW_word p (q-p))) \\<cdot> FW_word p (q-p)\""], ["proof (prove)\nusing this:\n  gcd p q \\<noteq> q - p\n\ngoal (1 subgoal):\n 1. FW_word p q = take p (FW_word p (q - p)) \\<cdot> FW_word p (q - p)", "using FW_word_def \\<open>p \\<noteq> 0\\<close> \\<open>p \\<noteq> q\\<close> \\<open>p < q\\<close>"], ["proof (prove)\nusing this:\n  gcd p q \\<noteq> q - p\n  FW_word ?p ?q =\n  (if ?q < ?p then FW_word ?q ?p\n   else if ?p = 0 \\<or> ?p = ?q then \\<epsilon>\n        else if gcd ?p ?q = ?q - ?p then fw_base ?p ?q\n             else take ?p (FW_word ?p (?q - ?p)) \\<cdot>\n                  FW_word ?p (?q - ?p))\n  p \\<noteq> 0\n  p \\<noteq> q\n  p < q\n\ngoal (1 subgoal):\n 1. FW_word p q = take p (FW_word p (q - p)) \\<cdot> FW_word p (q - p)", "by (meson less_Suc_eq not_less_eq)"], ["proof (state)\nthis:\n  FW_word p q = take p (FW_word p (q - p)) \\<cdot> FW_word p (q - p)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have divhyp1: \"\\<not> p dvd q - p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> p dvd q - p", "using \\<open>\\<not> p dvd q\\<close> \\<open>p < q\\<close> dvd_minus_self"], ["proof (prove)\nusing this:\n  \\<not> p dvd q\n  p < q\n  (?m dvd ?n - ?m) = (?n < ?m \\<or> ?m dvd ?n)\n\ngoal (1 subgoal):\n 1. \\<not> p dvd q - p", "by auto"], ["proof (state)\nthis:\n  \\<not> p dvd q - p\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have divhyp2: \"\\<not> q - p dvd p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> q - p dvd p", "proof (rule notI)"], ["proof (state)\ngoal (1 subgoal):\n 1. q - p dvd p \\<Longrightarrow> False", "assume \"q - p dvd p\""], ["proof (state)\nthis:\n  q - p dvd p\n\ngoal (1 subgoal):\n 1. q - p dvd p \\<Longrightarrow> False", "have \"q = p + (q - p)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. q = p + (q - p)", "by (simp add: \\<open>p < q\\<close> less_or_eq_imp_le)"], ["proof (state)\nthis:\n  q = p + (q - p)\n\ngoal (1 subgoal):\n 1. q - p dvd p \\<Longrightarrow> False", "from gcd_add2[of p \"q - p\", folded  this, unfolded gcd_nat.absorb2[of \"q - p\" p, OF \\<open>q - p dvd p\\<close>]]"], ["proof (chain)\npicking this:\n  gcd p q = q - p", "show \"False\""], ["proof (prove)\nusing this:\n  gcd p q = q - p\n\ngoal (1 subgoal):\n 1. False", "using \\<open>gcd p q \\<noteq> q - p\\<close>"], ["proof (prove)\nusing this:\n  gcd p q = q - p\n  gcd p q \\<noteq> q - p\n\ngoal (1 subgoal):\n 1. False", "by blast"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<not> q - p dvd p\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have lenhyp: \"p + p + (q - p) < p + p + q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p + p + (q - p) < p + p + q", "using \\<open>p < q\\<close> \\<open>p \\<noteq> 0\\<close>"], ["proof (prove)\nusing this:\n  p < q\n  p \\<noteq> 0\n\ngoal (1 subgoal):\n 1. p + p + (q - p) < p + p + q", "by linarith \n\n\\<comment> \\<open>induction assumption\\<close>"], ["proof (state)\nthis:\n  p + p + (q - p) < p + p + q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"\\<^bold>|FW_word p (q - p)\\<^bold>| = p + (q - p) - ?d' - 1\" and \"periodN (FW_word p (q-p)) p\" and \"periodN (FW_word p (q-p)) (q-p)\" and\n        \"\\<not> periodN (FW_word p (q-p)) (gcd p (q-p))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<^bold>|FW_word p (q - p)\\<^bold>| =\n     p + (q - p) - gcd p (q - p) - 1 &&&\n     periodN (FW_word p (q - p)) p) &&&\n    periodN (FW_word p (q - p)) (q - p) &&&\n    \\<not> periodN (FW_word p (q - p)) (gcd p (q - p))", "using \"less.hyps\"[OF _ divhyp1 divhyp2] lenhyp"], ["proof (prove)\nusing this:\n  p + p + (q - p) < p + p + q \\<Longrightarrow>\n  \\<^bold>|FW_word p (q - p)\\<^bold>| =\n  p + (q - p) - gcd p (q - p) - 1 \\<and>\n  periodN (FW_word p (q - p)) p \\<and>\n  periodN (FW_word p (q - p)) (q - p) \\<and>\n  \\<not> periodN (FW_word p (q - p)) (gcd p (q - p))\n  p + p + (q - p) < p + p + q\n\ngoal (1 subgoal):\n 1. (\\<^bold>|FW_word p (q - p)\\<^bold>| =\n     p + (q - p) - gcd p (q - p) - 1 &&&\n     periodN (FW_word p (q - p)) p) &&&\n    periodN (FW_word p (q - p)) (q - p) &&&\n    \\<not> periodN (FW_word p (q - p)) (gcd p (q - p))", "by blast+ \n\n\\<comment> \\<open>auxiliary facts\\<close>"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p (q - p)\\<^bold>| = p + (q - p) - gcd p (q - p) - 1\n  periodN (FW_word p (q - p)) p\n  periodN (FW_word p (q - p)) (q - p)\n  \\<not> periodN (FW_word p (q - p)) (gcd p (q - p))\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"p + (q - p) = q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p + (q - p) = q", "using divhyp1 dvd_minus_self"], ["proof (prove)\nusing this:\n  \\<not> p dvd q - p\n  (?m dvd ?n - ?m) = (?n < ?m \\<or> ?m dvd ?n)\n\ngoal (1 subgoal):\n 1. p + (q - p) = q", "by auto"], ["proof (state)\nthis:\n  p + (q - p) = q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"?d = ?d'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p q = gcd p (q - p)", "using  gcd_add2[of p \"q-p\", unfolded le_add_diff_inverse[OF less_imp_le[OF \\<open>p < q\\<close>]]]"], ["proof (prove)\nusing this:\n  gcd p q = gcd p (q - p)\n\ngoal (1 subgoal):\n 1. gcd p q = gcd p (q - p)", "."], ["proof (state)\nthis:\n  gcd p q = gcd p (q - p)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"?d \\<noteq> q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> q", "using  \\<open>\\<not> q dvd p\\<close>  gcd_dvd2[of q p, unfolded gcd.commute[of q]]"], ["proof (prove)\nusing this:\n  \\<not> q dvd p\n  gcd p q dvd p\n\ngoal (1 subgoal):\n 1. gcd p q \\<noteq> q", "by force"], ["proof (state)\nthis:\n  gcd p q \\<noteq> q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "from this[unfolded nat_neq_iff]"], ["proof (chain)\npicking this:\n  gcd p q < q \\<or> q < gcd p q", "have \"?d < q\""], ["proof (prove)\nusing this:\n  gcd p q < q \\<or> q < gcd p q\n\ngoal (1 subgoal):\n 1. gcd p q < q", "using  gr_implies_not0 \\<open>p < q\\<close> nat_dvd_not_less"], ["proof (prove)\nusing this:\n  gcd p q < q \\<or> q < gcd p q\n  ?m < ?n \\<Longrightarrow> ?n \\<noteq> 0\n  p < q\n  \\<lbrakk>0 < ?m; ?m < ?n\\<rbrakk> \\<Longrightarrow> \\<not> ?n dvd ?m\n\ngoal (1 subgoal):\n 1. gcd p q < q", "by blast"], ["proof (state)\nthis:\n  gcd p q < q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "hence \"1 \\<le> q - ?d\""], ["proof (prove)\nusing this:\n  gcd p q < q\n\ngoal (1 subgoal):\n 1. 1 \\<le> q - gcd p q", "by linarith"], ["proof (state)\nthis:\n  1 \\<le> q - gcd p q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"?d' < q - p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. gcd p (q - p) < q - p", "using  gcd_le2_nat[OF per_positive[OF \\<open>periodN (FW_word p (q - p)) (q - p)\\<close>], of p]  divhyp2[unfolded  gcd_nat.absorb_iff2] nat_less_le"], ["proof (prove)\nusing this:\n  gcd p (q - p) \\<le> q - p\n  gcd p (q - p) \\<noteq> q - p\n  (?m < ?n) = (?m \\<le> ?n \\<and> ?m \\<noteq> ?n)\n\ngoal (1 subgoal):\n 1. gcd p (q - p) < q - p", "by blast"], ["proof (state)\nthis:\n  gcd p (q - p) < q - p\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "hence \"p \\<le> \\<^bold>|(FW_word p (q - p))\\<^bold>|\""], ["proof (prove)\nusing this:\n  gcd p (q - p) < q - p\n\ngoal (1 subgoal):\n 1. p \\<le> \\<^bold>|FW_word p (q - p)\\<^bold>|", "unfolding  \\<open>\\<^bold>|FW_word p (q - p)\\<^bold>| = p + (q - p) - ?d' - 1\\<close>  diff_diff_left discrete"], ["proof (prove)\nusing this:\n  gcd p (q - p) + 1 \\<le> q - p\n\ngoal (1 subgoal):\n 1. p \\<le> p + (q - p) - (gcd p (q - p) + 1)", "by linarith"], ["proof (state)\nthis:\n  p \\<le> \\<^bold>|FW_word p (q - p)\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"FW_word p (q - p) \\<noteq> \\<epsilon>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. FW_word p (q - p) \\<noteq> \\<epsilon>", "unfolding length_0_conv[symmetric]"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p (q - p)\\<^bold>| \\<noteq> 0", "using  \\<open>p \\<le> \\<^bold>|FW_word p (q - p)\\<^bold>|\\<close> \\<open>p \\<noteq> 0\\<close>[folded le_zero_eq]"], ["proof (prove)\nusing this:\n  p \\<le> \\<^bold>|FW_word p (q - p)\\<^bold>|\n  \\<not> p \\<le> 0\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p (q - p)\\<^bold>| \\<noteq> 0", "by linarith\n\n\\<comment> \\<open>claim 1\\<close>"], ["proof (state)\nthis:\n  FW_word p (q - p) \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"\\<^bold>|FW_word p q\\<^bold>| = p + q - ?d - 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "have \"\\<^bold>|FW_word p q\\<^bold>| = \\<^bold>|take p (FW_word p (q - p))\\<^bold>| + \\<^bold>|FW_word p (q - p)\\<^bold>|\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| =\n    \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n    \\<^bold>|FW_word p (q - p)\\<^bold>|", "using fw length_append[of \"take p (FW_word p (q - p))\" \"FW_word p (q - p)\"]"], ["proof (prove)\nusing this:\n  FW_word p q = take p (FW_word p (q - p)) \\<cdot> FW_word p (q - p)\n  \\<^bold>|take p (FW_word p (q - p)) \\<cdot> FW_word p (q - p)\\<^bold>| =\n  \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n  \\<^bold>|FW_word p (q - p)\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| =\n    \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n    \\<^bold>|FW_word p (q - p)\\<^bold>|", "by presburger"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| =\n  \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n  \\<^bold>|FW_word p (q - p)\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "also"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| =\n  \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n  \\<^bold>|FW_word p (q - p)\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "have \"... = p + (p + (q - p) - ?d' - 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n    \\<^bold>|FW_word p (q - p)\\<^bold>| =\n    p + (p + (q - p) - gcd p (q - p) - 1)", "unfolding \\<open>\\<^bold>|FW_word p (q - p)\\<^bold>| = p + (q - p) - ?d' - 1\\<close> \n            take_len[OF \\<open>p \\<le> \\<^bold>|FW_word p (q - p)\\<^bold>|\\<close>]"], ["proof (prove)\ngoal (1 subgoal):\n 1. p + (p + (q - p) - gcd p (q - p) - 1) =\n    p + (p + (q - p) - gcd p (q - p) - 1)", "by blast"], ["proof (state)\nthis:\n  \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n  \\<^bold>|FW_word p (q - p)\\<^bold>| =\n  p + (p + (q - p) - gcd p (q - p) - 1)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "also"], ["proof (state)\nthis:\n  \\<^bold>|take p (FW_word p (q - p))\\<^bold>| +\n  \\<^bold>|FW_word p (q - p)\\<^bold>| =\n  p + (p + (q - p) - gcd p (q - p) - 1)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "have \"... = p + (q - ?d  - 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p + (p + (q - p) - gcd p (q - p) - 1) = p + (q - gcd p q - 1)", "unfolding \\<open>?d = ?d'\\<close>"], ["proof (prove)\ngoal (1 subgoal):\n 1. p + (p + (q - p) - gcd p (q - p) - 1) = p + (q - gcd p (q - p) - 1)", "using  \\<open>p < q\\<close>"], ["proof (prove)\nusing this:\n  p < q\n\ngoal (1 subgoal):\n 1. p + (p + (q - p) - gcd p (q - p) - 1) = p + (q - gcd p (q - p) - 1)", "by auto"], ["proof (state)\nthis:\n  p + (p + (q - p) - gcd p (q - p) - 1) = p + (q - gcd p q - 1)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "also"], ["proof (state)\nthis:\n  p + (p + (q - p) - gcd p (q - p) - 1) = p + (q - gcd p q - 1)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "have \"... = p + (q - ?d) - 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p + (q - gcd p q - 1) = p + (q - gcd p q) - 1", "using Nat.add_diff_assoc[OF \\<open>1 \\<le> q - ?d\\<close>]"], ["proof (prove)\nusing this:\n  ?i + (q - gcd p q - 1) = ?i + (q - gcd p q) - 1\n\ngoal (1 subgoal):\n 1. p + (q - gcd p q - 1) = p + (q - gcd p q) - 1", "."], ["proof (state)\nthis:\n  p + (q - gcd p q - 1) = p + (q - gcd p q) - 1\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "also"], ["proof (state)\nthis:\n  p + (q - gcd p q - 1) = p + (q - gcd p q) - 1\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "have \"... = p + q - ?d - 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. p + (q - gcd p q) - 1 = p + q - gcd p q - 1", "by (simp add: \\<open>?d < q\\<close> less_or_eq_imp_le)"], ["proof (state)\nthis:\n  p + (q - gcd p q) - 1 = p + q - gcd p q - 1\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "finally"], ["proof (chain)\npicking this:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "show \"\\<^bold>|FW_word p q\\<^bold>| = p + q - ?d - 1\""], ["proof (prove)\nusing this:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1", "by presburger"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n\ngoal:\nNo subgoals!", "qed\n\n\\<comment> \\<open>claim 2\\<close>"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"periodN (FW_word p q) p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN (FW_word p q) p", "using fw  ext_per_left[OF \\<open>periodN (FW_word p (q-p)) p\\<close> \\<open>p \\<le> \\<^bold>|FW_word p (q - p)\\<^bold>|\\<close>]"], ["proof (prove)\nusing this:\n  FW_word p q = take p (FW_word p (q - p)) \\<cdot> FW_word p (q - p)\n  periodN (take p (FW_word p (q - p)) \\<cdot> FW_word p (q - p)) p\n\ngoal (1 subgoal):\n 1. periodN (FW_word p q) p", "by presburger\n\n\\<comment> \\<open>claim 3\\<close>"], ["proof (state)\nthis:\n  periodN (FW_word p q) p\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"periodN (FW_word p q) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. periodN (FW_word p q) q", "using ext_per_sum[OF \\<open>periodN (FW_word p (q - p)) p\\<close> \\<open>periodN (FW_word p (q - p)) (q - p)\\<close> \\<open>p \\<le> \\<^bold>|FW_word p (q - p)\\<^bold>|\\<close>, folded fw, unfolded \\<open>p + (q-p) = q\\<close>]"], ["proof (prove)\nusing this:\n  periodN (FW_word p q) q\n\ngoal (1 subgoal):\n 1. periodN (FW_word p q) q", ".\n\n\\<comment> \\<open>claim 4\\<close>"], ["proof (state)\nthis:\n  periodN (FW_word p q) q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "have \"\\<not> periodN (FW_word p q) ?d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "using \\<open>\\<not> periodN (FW_word p (q -p)) (gcd p (q-p))\\<close>"], ["proof (prove)\nusing this:\n  \\<not> periodN (FW_word p (q - p)) (gcd p (q - p))\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "unfolding \\<open>?d = ?d'\\<close>[symmetric]"], ["proof (prove)\nusing this:\n  \\<not> periodN (FW_word p (q - p)) (gcd p q)\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "using periodN_fac[of \"take p (FW_word p (q - p))\" \"FW_word p (q - p)\" \\<epsilon> \"?d\", unfolded append_Nil2, \n                          OF _ \\<open>FW_word p (q - p) \\<noteq> \\<epsilon>\\<close>, folded fw]"], ["proof (prove)\nusing this:\n  \\<not> periodN (FW_word p (q - p)) (gcd p q)\n  periodN (FW_word p q) (gcd p q) \\<Longrightarrow>\n  periodN (FW_word p (q - p)) (gcd p q)\n\ngoal (1 subgoal):\n 1. \\<not> periodN (FW_word p q) (gcd p q)", "by blast"], ["proof (state)\nthis:\n  \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>p < q; gcd p q \\<noteq> q - p\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>|FW_word p q\\<^bold>| =\n                      p + q - gcd p q - 1 \\<and>\n                      periodN (FW_word p q) p \\<and>\n                      periodN (FW_word p q) q \\<and>\n                      \\<not> periodN (FW_word p q) (gcd p q)", "thus ?thesis"], ["proof (prove)\nusing this:\n  \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "using \\<open>periodN (FW_word p q) p\\<close> \\<open>periodN (FW_word p q) q\\<close> \\<open>\\<^bold>|FW_word p q\\<^bold>| = p + q - ?d - 1\\<close>"], ["proof (prove)\nusing this:\n  \\<not> periodN (FW_word p q) (gcd p q)\n  periodN (FW_word p q) p\n  periodN (FW_word p q) q\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\n\ngoal (1 subgoal):\n 1. \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n    periodN (FW_word p q) p \\<and>\n    periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)", "by blast"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n  periodN (FW_word p q) p \\<and>\n  periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n  periodN (FW_word p q) p \\<and>\n  periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n  periodN (FW_word p q) p \\<and>\n  periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal:\nNo subgoals!", "qed"], ["", "theorem fw_word: assumes \"\\<not> p dvd q\" \"\\<not> q dvd p\"\n  shows \"\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1\" and \"periodN (FW_word p q) p\" and  \"periodN (FW_word p q) q\" and \"\\<not> periodN (FW_word p q) (gcd p q)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 &&&\n     periodN (FW_word p q) p) &&&\n    periodN (FW_word p q) q &&& \\<not> periodN (FW_word p q) (gcd p q)", "using fw_word'[OF assms]"], ["proof (prove)\nusing this:\n  \\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 \\<and>\n  periodN (FW_word p q) p \\<and>\n  periodN (FW_word p q) q \\<and> \\<not> periodN (FW_word p q) (gcd p q)\n\ngoal (1 subgoal):\n 1. (\\<^bold>|FW_word p q\\<^bold>| = p + q - gcd p q - 1 &&&\n     periodN (FW_word p q) p) &&&\n    periodN (FW_word p q) q &&& \\<not> periodN (FW_word p q) (gcd p q)", "by blast+"], ["", "text\\<open>Calculation examples\\<close>"], ["", "value \"FW_word 3 7\""], ["", "value \"FW_word 5 7\""], ["", "value \"FW_word 5 13\""], ["", "value \"FW_word 4 6\""], ["", "value \"FW_word 12 18\""], ["", "section \"Other variants of the periodicity lemma\""], ["", "text \\<open>Periodicity lemma is one of the most frequent tools in Combinatorics on words.\n   Here are some useful variants.\\<close>"], ["", "lemma fac_two_conjug_prim_root:\n  assumes facs: \"u \\<le>f r\\<^sup>@k\" \"u \\<le>f s\\<^sup>@l\" and nemps: \"r \\<noteq> \\<epsilon>\" \"s \\<noteq> \\<epsilon>\" and len: \"\\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| - gcd (\\<^bold>|r\\<^bold>|) (\\<^bold>|s\\<^bold>|) \\<le> \\<^bold>|u\\<^bold>|\"\n  shows \"\\<rho> r \\<sim> \\<rho> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "obtain r' s' where prefr': \"u \\<le>p r'\\<^sup>@k\" and prefs': \"u \\<le>p s'\\<^sup>@l\"\n               and   conjugs: \"r \\<sim> r'\" \"s \\<sim> s'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>r' s'.\n        \\<lbrakk>u \\<le>p r' \\<^sup>@ k; u \\<le>p s' \\<^sup>@ l;\n         r \\<sim> r'; s \\<sim> s'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using facs"], ["proof (prove)\nusing this:\n  u \\<le>f r \\<^sup>@ k\n  u \\<le>f s \\<^sup>@ l\n\ngoal (1 subgoal):\n 1. (\\<And>r' s'.\n        \\<lbrakk>u \\<le>p r' \\<^sup>@ k; u \\<le>p s' \\<^sup>@ l;\n         r \\<sim> r'; s \\<sim> s'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (elim fac_pow_pref_conjug)"], ["proof (state)\nthis:\n  u \\<le>p r' \\<^sup>@ k\n  u \\<le>p s' \\<^sup>@ l\n  r \\<sim> r'\n  s \\<sim> s'\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "have rootr': \"u \\<le>p r' \\<cdot> u\" and roots': \"u \\<le>p s' \\<cdot> u\""], ["proof (prove)\ngoal (1 subgoal):\n 1. u \\<le>p r' \\<cdot> u &&& u \\<le>p s' \\<cdot> u", "using pref_prod_root[OF prefr'] pref_prod_root[OF prefs']"], ["proof (prove)\nusing this:\n  u \\<le>p r' \\<cdot> u\n  u \\<le>p s' \\<cdot> u\n\ngoal (1 subgoal):\n 1. u \\<le>p r' \\<cdot> u &&& u \\<le>p s' \\<cdot> u", "."], ["proof (state)\nthis:\n  u \\<le>p r' \\<cdot> u\n  u \\<le>p s' \\<cdot> u\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "have nemps': \"r' \\<noteq> \\<epsilon>\" \"s'\\<noteq> \\<epsilon>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. r' \\<noteq> \\<epsilon> &&& s' \\<noteq> \\<epsilon>", "using nemps conjugs conjug_nemp_iff"], ["proof (prove)\nusing this:\n  r \\<noteq> \\<epsilon>\n  s \\<noteq> \\<epsilon>\n  r \\<sim> r'\n  s \\<sim> s'\n  ?u \\<sim> ?v \\<Longrightarrow> (?u = \\<epsilon>) = (?v = \\<epsilon>)\n\ngoal (1 subgoal):\n 1. r' \\<noteq> \\<epsilon> &&& s' \\<noteq> \\<epsilon>", "by blast+"], ["proof (state)\nthis:\n  r' \\<noteq> \\<epsilon>\n  s' \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "have \"\\<^bold>|r'\\<^bold>| + \\<^bold>|s'\\<^bold>| - gcd (\\<^bold>|r'\\<^bold>|) (\\<^bold>|s'\\<^bold>|) \\<le> \\<^bold>|u\\<^bold>|\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|r'\\<^bold>| + \\<^bold>|s'\\<^bold>| -\n    gcd \\<^bold>|r'\\<^bold>| \\<^bold>|s'\\<^bold>|\n    \\<le> \\<^bold>|u\\<^bold>|", "using len"], ["proof (prove)\nusing this:\n  \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| -\n  gcd \\<^bold>|r\\<^bold>| \\<^bold>|s\\<^bold>|\n  \\<le> \\<^bold>|u\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|r'\\<^bold>| + \\<^bold>|s'\\<^bold>| -\n    gcd \\<^bold>|r'\\<^bold>| \\<^bold>|s'\\<^bold>|\n    \\<le> \\<^bold>|u\\<^bold>|", "unfolding conjug_len[OF \\<open>r \\<sim> r'\\<close>] conjug_len[OF \\<open>s \\<sim> s'\\<close>]"], ["proof (prove)\nusing this:\n  \\<^bold>|r'\\<^bold>| + \\<^bold>|s'\\<^bold>| -\n  gcd \\<^bold>|r'\\<^bold>| \\<^bold>|s'\\<^bold>|\n  \\<le> \\<^bold>|u\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<^bold>|r'\\<^bold>| + \\<^bold>|s'\\<^bold>| -\n    gcd \\<^bold>|r'\\<^bold>| \\<^bold>|s'\\<^bold>|\n    \\<le> \\<^bold>|u\\<^bold>|", "."], ["proof (state)\nthis:\n  \\<^bold>|r'\\<^bold>| + \\<^bold>|s'\\<^bold>| -\n  gcd \\<^bold>|r'\\<^bold>| \\<^bold>|s'\\<^bold>|\n  \\<le> \\<^bold>|u\\<^bold>|\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "from per_lemma_comm[OF roots' rootr' this]"], ["proof (chain)\npicking this:\n  r' \\<cdot> s' = s' \\<cdot> r'", "have \"r' \\<cdot> s' = s' \\<cdot> r'\""], ["proof (prove)\nusing this:\n  r' \\<cdot> s' = s' \\<cdot> r'\n\ngoal (1 subgoal):\n 1. r' \\<cdot> s' = s' \\<cdot> r'", "."], ["proof (state)\nthis:\n  r' \\<cdot> s' = s' \\<cdot> r'\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "then"], ["proof (chain)\npicking this:\n  r' \\<cdot> s' = s' \\<cdot> r'", "have \"\\<rho> r' = \\<rho> s'\""], ["proof (prove)\nusing this:\n  r' \\<cdot> s' = s' \\<cdot> r'\n\ngoal (1 subgoal):\n 1. \\<rho> r' = \\<rho> s'", "using comm_primroots[OF nemps']"], ["proof (prove)\nusing this:\n  r' \\<cdot> s' = s' \\<cdot> r'\n  (r' \\<cdot> s' = s' \\<cdot> r') = (\\<rho> r' = \\<rho> s')\n\ngoal (1 subgoal):\n 1. \\<rho> r' = \\<rho> s'", "by force"], ["proof (state)\nthis:\n  \\<rho> r' = \\<rho> s'\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "also"], ["proof (state)\nthis:\n  \\<rho> r' = \\<rho> s'\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "have \"\\<rho> s \\<sim> \\<rho> s'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<rho> s \\<sim> \\<rho> s'", "using conjug_prim_root[OF \\<open>s \\<sim> s'\\<close> \\<open>s \\<noteq> \\<epsilon>\\<close>]"], ["proof (prove)\nusing this:\n  \\<rho> s \\<sim> \\<rho> s'\n\ngoal (1 subgoal):\n 1. \\<rho> s \\<sim> \\<rho> s'", "."], ["proof (state)\nthis:\n  \\<rho> s \\<sim> \\<rho> s'\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "also"], ["proof (state)\nthis:\n  \\<rho> s \\<sim> \\<rho> s'\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "have [symmetric]: \"\\<rho> r \\<sim> \\<rho> r'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> r'", "using conjug_prim_root[OF \\<open>r \\<sim> r'\\<close> \\<open>r \\<noteq> \\<epsilon>\\<close>]"], ["proof (prove)\nusing this:\n  \\<rho> r \\<sim> \\<rho> r'\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> r'", "."], ["proof (state)\nthis:\n  \\<rho> r' \\<sim> \\<rho> r\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "finally"], ["proof (chain)\npicking this:\n  \\<rho> s \\<sim> \\<rho> r", "show \"\\<rho> r \\<sim> \\<rho> s\""], ["proof (prove)\nusing this:\n  \\<rho> s \\<sim> \\<rho> r\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", ".."], ["proof (state)\nthis:\n  \\<rho> r \\<sim> \\<rho> s\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma fac_two_conjug_prim_root':\n  assumes facs: \"u \\<le>f r\\<^sup>@k\" \"u \\<le>f s\\<^sup>@l\" and \"u \\<noteq> \\<epsilon>\" and len: \"\\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| - gcd (\\<^bold>|r\\<^bold>|) (\\<^bold>|s\\<^bold>|) \\<le> \\<^bold>|u\\<^bold>|\"\n  shows \"\\<rho> r \\<sim> \\<rho> s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "have nemps: \"r \\<noteq> \\<epsilon>\" \"s \\<noteq> \\<epsilon>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. r \\<noteq> \\<epsilon> &&& s \\<noteq> \\<epsilon>", "using facs \\<open>u \\<noteq> \\<epsilon>\\<close>"], ["proof (prove)\nusing this:\n  u \\<le>f r \\<^sup>@ k\n  u \\<le>f s \\<^sup>@ l\n  u \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. r \\<noteq> \\<epsilon> &&& s \\<noteq> \\<epsilon>", "by auto"], ["proof (state)\nthis:\n  r \\<noteq> \\<epsilon>\n  s \\<noteq> \\<epsilon>\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "show \"conjugate (\\<rho> r) (\\<rho> s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "using fac_two_conjug_prim_root[OF facs nemps len]"], ["proof (prove)\nusing this:\n  \\<rho> r \\<sim> \\<rho> s\n\ngoal (1 subgoal):\n 1. \\<rho> r \\<sim> \\<rho> s", "."], ["proof (state)\nthis:\n  \\<rho> r \\<sim> \\<rho> s\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma fac_two_nconj_prim_pow:\n  assumes prims: \"primitive r\" \"primitive s\" and \"\\<not> r \\<sim> s\"\n      and facs: \"u \\<le>f r\\<^sup>@k\" \"u \\<le>f s\\<^sup>@l\"\n  shows \"\\<^bold>|u\\<^bold>| < \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| - gcd (\\<^bold>|r\\<^bold>|) (\\<^bold>|s\\<^bold>|)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>|u\\<^bold>|\n    < \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| -\n      gcd \\<^bold>|r\\<^bold>| \\<^bold>|s\\<^bold>|", "using \\<open>\\<not> r \\<sim> s\\<close> fac_two_conjug_prim_root[OF facs prim_nemp prim_nemp leI, OF prims]"], ["proof (prove)\nusing this:\n  \\<not> r \\<sim> s\n  \\<not> \\<^bold>|u\\<^bold>|\n         < \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| -\n           gcd \\<^bold>|r\\<^bold>| \\<^bold>|s\\<^bold>| \\<Longrightarrow>\n  \\<rho> r \\<sim> \\<rho> s\n\ngoal (1 subgoal):\n 1. \\<^bold>|u\\<^bold>|\n    < \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| -\n      gcd \\<^bold>|r\\<^bold>| \\<^bold>|s\\<^bold>|", "unfolding prim_self_root[OF \\<open>primitive r\\<close>] prim_self_root[OF \\<open>primitive s\\<close>]"], ["proof (prove)\nusing this:\n  \\<not> r \\<sim> s\n  \\<not> \\<^bold>|u\\<^bold>|\n         < \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| -\n           gcd \\<^bold>|r\\<^bold>| \\<^bold>|s\\<^bold>| \\<Longrightarrow>\n  r \\<sim> s\n\ngoal (1 subgoal):\n 1. \\<^bold>|u\\<^bold>|\n    < \\<^bold>|r\\<^bold>| + \\<^bold>|s\\<^bold>| -\n      gcd \\<^bold>|r\\<^bold>| \\<^bold>|s\\<^bold>|", "by (rule contrapos_np)"], ["", "end"]]}