{"file_name": "/home/qj213/afp-2021-10-22/thys/Posix-Lexing/Lexer.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Posix-Lexing", "problem_names": ["lemma flat_Stars [simp]:\n \"flat (Stars vs) = concat (map flat vs)\"", "lemma Prf_flat_lang:\n  assumes \"\\<turnstile> v : r\" shows \"flat v \\<in> lang r\"", "lemma Prf_Stars:\n  assumes \"\\<forall>v \\<in> set vs. \\<turnstile> v : r\"\n  shows \"\\<turnstile> Stars vs : Star r\"", "lemma Star_string:\n  assumes \"s \\<in> star A\"\n  shows \"\\<exists>ss. concat ss = s \\<and> (\\<forall>s \\<in> set ss. s \\<in> A)\"", "lemma Star_val:\n  assumes \"\\<forall>s\\<in>set ss. \\<exists>v. s = flat v \\<and> \\<turnstile> v : r\"\n  shows \"\\<exists>vs. concat (map flat vs) = concat ss \\<and> (\\<forall>v\\<in>set vs. \\<turnstile> v : r)\"", "lemma L_flat_Prf1:\n  assumes \"\\<turnstile> v : r\" shows \"flat v \\<in> lang r\"", "lemma L_flat_Prf2:\n  assumes \"s \\<in> lang r\" shows \"\\<exists>v. \\<turnstile> v : r \\<and> flat v = s\"", "lemma L_flat_Prf:\n  \"lang r = {flat v | v. \\<turnstile> v : r}\"", "lemma mkeps_nullable:\n  assumes \"nullable r\" \n  shows \"\\<turnstile> mkeps r : r\"", "lemma mkeps_flat:\n  assumes \"nullable r\" \n  shows \"flat (mkeps r) = []\"", "lemma Prf_injval:\n  assumes \"\\<turnstile> v : deriv c r\" \n  shows \"\\<turnstile> (injval r c v) : r\"", "lemma Prf_injval_flat:\n  assumes \"\\<turnstile> v : deriv c r\" \n  shows \"flat (injval r c v) = c # (flat v)\"", "lemma Posix1:\n  assumes \"s \\<in> r \\<rightarrow> v\"\n  shows \"s \\<in> lang r\" \"flat v = s\"", "lemma Posix1a:\n  assumes \"s \\<in> r \\<rightarrow> v\"\n  shows \"\\<turnstile> v : r\"", "lemma Posix_mkeps:\n  assumes \"nullable r\"\n  shows \"[] \\<in> r \\<rightarrow> mkeps r\"", "lemma Posix_determ:\n  assumes \"s \\<in> r \\<rightarrow> v1\" \"s \\<in> r \\<rightarrow> v2\"\n  shows \"v1 = v2\"", "lemma Posix_injval:\n  assumes \"s \\<in> (deriv c r) \\<rightarrow> v\"\n  shows \"(c # s) \\<in> r \\<rightarrow> (injval r c v)\"", "lemma lexer_correct_None:\n  shows \"s \\<notin> lang r \\<longleftrightarrow> lexer r s = None\"", "lemma lexer_correct_Some:\n  shows \"s \\<in> lang r \\<longleftrightarrow> (\\<exists>v. lexer r s = Some(v) \\<and> s \\<in> r \\<rightarrow> v)\"", "lemma lexer_correctness:\n  shows \"(lexer r s = Some v) \\<longleftrightarrow> s \\<in> r \\<rightarrow> v\"\n  and   \"(lexer r s = None) \\<longleftrightarrow> \\<not>(\\<exists>v. s \\<in> r \\<rightarrow> v)\""], "translations": [["", "lemma flat_Stars [simp]:\n \"flat (Stars vs) = concat (map flat vs)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. flat (Stars vs) = concat (map flat vs)", "by (induct vs) (auto)"], ["", "section \\<open>Relation between values and regular expressions\\<close>"], ["", "inductive \n  Prf :: \"'a val \\<Rightarrow> 'a rexp \\<Rightarrow> bool\" (\"\\<turnstile> _ : _\" [100, 100] 100)\nwhere\n \"\\<lbrakk>\\<turnstile> v1 : r1; \\<turnstile> v2 : r2\\<rbrakk> \\<Longrightarrow> \\<turnstile> Seq v1 v2 : Times r1 r2\"\n| \"\\<turnstile> v1 : r1 \\<Longrightarrow> \\<turnstile> Left v1 : Plus r1 r2\"\n| \"\\<turnstile> v2 : r2 \\<Longrightarrow> \\<turnstile> Right v2 : Plus r1 r2\"\n| \"\\<turnstile> Void : One\"\n| \"\\<turnstile> Atm c : Atom c\"\n| \"\\<turnstile> Stars [] : Star r\"\n| \"\\<lbrakk>\\<turnstile> v : r; \\<turnstile> Stars vs : Star r\\<rbrakk> \\<Longrightarrow> \\<turnstile> Stars (v # vs) : Star r\""], ["", "inductive_cases Prf_elims:\n  \"\\<turnstile> v : Zero\"\n  \"\\<turnstile> v : Times r1 r2\"\n  \"\\<turnstile> v : Plus r1 r2\"\n  \"\\<turnstile> v : One\"\n  \"\\<turnstile> v : Atom c\""], ["", "(*  \"\\<turnstile> vs : Star r\"*)"], ["", "lemma Prf_flat_lang:\n  assumes \"\\<turnstile> v : r\" shows \"flat v \\<in> lang r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. flat v \\<in> lang r", "using assms"], ["proof (prove)\nusing this:\n  \\<turnstile> v : r\n\ngoal (1 subgoal):\n 1. flat v \\<in> lang r", "by(induct v r rule: Prf.induct) (auto)"], ["", "lemma Prf_Stars:\n  assumes \"\\<forall>v \\<in> set vs. \\<turnstile> v : r\"\n  shows \"\\<turnstile> Stars vs : Star r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile> Stars vs : Star r", "using assms"], ["proof (prove)\nusing this:\n  \\<forall>v\\<in>set vs. \\<turnstile> v : r\n\ngoal (1 subgoal):\n 1. \\<turnstile> Stars vs : Star r", "by(induct vs) (auto intro: Prf.intros)"], ["", "lemma Star_string:\n  assumes \"s \\<in> star A\"\n  shows \"\\<exists>ss. concat ss = s \\<and> (\\<forall>s \\<in> set ss. s \\<in> A)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ss. concat ss = s \\<and> (\\<forall>s\\<in>set ss. s \\<in> A)", "using assms"], ["proof (prove)\nusing this:\n  s \\<in> star A\n\ngoal (1 subgoal):\n 1. \\<exists>ss. concat ss = s \\<and> (\\<forall>s\\<in>set ss. s \\<in> A)", "by (metis in_star_iff_concat subsetD)"], ["", "lemma Star_val:\n  assumes \"\\<forall>s\\<in>set ss. \\<exists>v. s = flat v \\<and> \\<turnstile> v : r\"\n  shows \"\\<exists>vs. concat (map flat vs) = concat ss \\<and> (\\<forall>v\\<in>set vs. \\<turnstile> v : r)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>vs.\n       concat (map flat vs) = concat ss \\<and>\n       (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "using assms"], ["proof (prove)\nusing this:\n  \\<forall>s\\<in>set ss. \\<exists>v. s = flat v \\<and> \\<turnstile> v : r\n\ngoal (1 subgoal):\n 1. \\<exists>vs.\n       concat (map flat vs) = concat ss \\<and>\n       (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(induct ss)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<forall>s\\<in>set [].\n       \\<exists>v. s = flat v \\<and> \\<turnstile> v : r \\<Longrightarrow>\n    \\<exists>vs.\n       concat (map flat vs) = concat [] \\<and>\n       (\\<forall>v\\<in>set vs. \\<turnstile> v : r)\n 2. \\<And>a ss.\n       \\<lbrakk>\\<forall>s\\<in>set ss.\n                   \\<exists>v.\n                      s = flat v \\<and> \\<turnstile> v : r \\<Longrightarrow>\n                \\<exists>vs.\n                   concat (map flat vs) = concat ss \\<and>\n                   (\\<forall>v\\<in>set vs. \\<turnstile> v : r);\n        \\<forall>s\\<in>set (a # ss).\n           \\<exists>v. s = flat v \\<and> \\<turnstile> v : r\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = concat (a # ss) \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(auto)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<exists>vs.\n       (\\<forall>xs\\<in>set vs. flat xs = []) \\<and>\n       (\\<forall>v\\<in>set vs. \\<turnstile> v : r)\n 2. \\<And>ss vs v.\n       \\<lbrakk>\\<forall>s\\<in>set ss.\n                   \\<exists>v. s = flat v \\<and> \\<turnstile> v : r;\n        concat (map flat vs) = concat ss;\n        \\<forall>v\\<in>set vs. \\<turnstile> v : r;\n        \\<turnstile> v : r\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = flat v @ concat ss \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply (metis empty_iff list.set(1))"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ss vs v.\n       \\<lbrakk>\\<forall>s\\<in>set ss.\n                   \\<exists>v. s = flat v \\<and> \\<turnstile> v : r;\n        concat (map flat vs) = concat ss;\n        \\<forall>v\\<in>set vs. \\<turnstile> v : r;\n        \\<turnstile> v : r\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = flat v @ concat ss \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "by (metis concat.simps(2) list.simps(9) set_ConsD)"], ["", "lemma L_flat_Prf1:\n  assumes \"\\<turnstile> v : r\" shows \"flat v \\<in> lang r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. flat v \\<in> lang r", "using assms"], ["proof (prove)\nusing this:\n  \\<turnstile> v : r\n\ngoal (1 subgoal):\n 1. flat v \\<in> lang r", "by (induct)(auto)"], ["", "lemma L_flat_Prf2:\n  assumes \"s \\<in> lang r\" shows \"\\<exists>v. \\<turnstile> v : r \\<and> flat v = s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>v. \\<turnstile> v : r \\<and> flat v = s", "using assms"], ["proof (prove)\nusing this:\n  s \\<in> lang r\n\ngoal (1 subgoal):\n 1. \\<exists>v. \\<turnstile> v : r \\<and> flat v = s", "apply(induct r arbitrary: s)"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<And>s.\n       s \\<in> lang Zero \\<Longrightarrow>\n       \\<exists>v. \\<turnstile> v : Zero \\<and> flat v = s\n 2. \\<And>s.\n       s \\<in> lang One \\<Longrightarrow>\n       \\<exists>v. \\<turnstile> v : One \\<and> flat v = s\n 3. \\<And>x s.\n       s \\<in> lang (Atom x) \\<Longrightarrow>\n       \\<exists>v. \\<turnstile> v : Atom x \\<and> flat v = s\n 4. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang (Plus r1 r2)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Plus r1 r2 \\<and> flat v = s\n 5. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang (Times r1 r2)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Times r1 r2 \\<and> flat v = s\n 6. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s", "apply(auto intro: Prf.intros)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r1\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Plus r1 r2 \\<and> flat v = s\n 2. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Plus r1 r2 \\<and> flat v = s\n 3. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r1 @@ lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Times r1 r2 \\<and> flat v = s\n 4. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s", "using Prf.intros(2) flat.simps(3)"], ["proof (prove)\nusing this:\n  \\<turnstile> ?v1.0 : ?r1.0 \\<Longrightarrow>\n  \\<turnstile> val.Left ?v1.0 : Plus ?r1.0 ?r2.0\n  flat (val.Left ?v) = flat ?v\n\ngoal (4 subgoals):\n 1. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r1\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Plus r1 r2 \\<and> flat v = s\n 2. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Plus r1 r2 \\<and> flat v = s\n 3. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r1 @@ lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Times r1 r2 \\<and> flat v = s\n 4. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s", "apply blast"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Plus r1 r2 \\<and> flat v = s\n 2. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r1 @@ lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Times r1 r2 \\<and> flat v = s\n 3. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s", "using Prf.intros(3) flat.simps(4)"], ["proof (prove)\nusing this:\n  \\<turnstile> ?v2.0 : ?r2.0 \\<Longrightarrow>\n  \\<turnstile> val.Right ?v2.0 : Plus ?r1.0 ?r2.0\n  flat (val.Right ?v) = flat ?v\n\ngoal (3 subgoals):\n 1. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Plus r1 r2 \\<and> flat v = s\n 2. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r1 @@ lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Times r1 r2 \\<and> flat v = s\n 3. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s", "apply blast"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r1 r2 s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r1 \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r1 \\<and> flat v = s;\n        \\<And>s.\n           s \\<in> lang r2 \\<Longrightarrow>\n           \\<exists>v. \\<turnstile> v : r2 \\<and> flat v = s;\n        s \\<in> lang r1 @@ lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Times r1 r2 \\<and> flat v = s\n 2. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s", "apply (metis Prf.intros(1) concE flat.simps(5))"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s", "apply(subgoal_tac \"\\<exists>vs::('a val) list. concat (map flat vs) = s \\<and> (\\<forall>v \\<in> set vs. \\<turnstile> v : r)\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r);\n        \\<exists>vs.\n           concat (map flat vs) = s \\<and>\n           (\\<forall>v\\<in>set vs. \\<turnstile> v : r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and> flat v = s\n 2. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = s \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(auto)[1]"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r vs.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        concat (map flat vs) \\<in> star (lang r);\n        \\<forall>v\\<in>set vs. \\<turnstile> v : r\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            \\<turnstile> v : Star r \\<and>\n                            flat v = concat (map flat vs)\n 2. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = s \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(rule_tac x=\"Stars vs\" in exI)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r vs.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        concat (map flat vs) \\<in> star (lang r);\n        \\<forall>v\\<in>set vs. \\<turnstile> v : r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> Stars vs : Star r \\<and>\n                         flat (Stars vs) = concat (map flat vs)\n 2. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = s \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(simp)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r vs.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        concat (map flat vs) \\<in> star (lang r);\n        \\<forall>v\\<in>set vs. \\<turnstile> v : r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> Stars vs : Star r\n 2. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = s \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply (simp add: Prf_Stars)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        s \\<in> star (lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = s \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(drule Star_string)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r s.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        \\<exists>ss.\n           concat ss = s \\<and>\n           (\\<forall>s\\<in>set ss. s \\<in> lang r)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = s \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(auto)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r ss.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        \\<forall>s\\<in>set ss. s \\<in> lang r\\<rbrakk>\n       \\<Longrightarrow> \\<exists>vs.\n                            concat (map flat vs) = concat ss \\<and>\n                            (\\<forall>v\\<in>set vs. \\<turnstile> v : r)", "apply(rule Star_val)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r ss.\n       \\<lbrakk>\\<And>s.\n                   s \\<in> lang r \\<Longrightarrow>\n                   \\<exists>v. \\<turnstile> v : r \\<and> flat v = s;\n        \\<forall>s\\<in>set ss. s \\<in> lang r\\<rbrakk>\n       \\<Longrightarrow> \\<forall>s\\<in>set ss.\n                            \\<exists>v. s = flat v \\<and> \\<turnstile> v : r", "apply(auto)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma L_flat_Prf:\n  \"lang r = {flat v | v. \\<turnstile> v : r}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. lang r = {flat v |v. \\<turnstile> v : r}", "using L_flat_Prf1 L_flat_Prf2"], ["proof (prove)\nusing this:\n  \\<turnstile> ?v : ?r \\<Longrightarrow> flat ?v \\<in> lang ?r\n  ?s \\<in> lang ?r \\<Longrightarrow>\n  \\<exists>v. \\<turnstile> v : ?r \\<and> flat v = ?s\n\ngoal (1 subgoal):\n 1. lang r = {flat v |v. \\<turnstile> v : r}", "by blast"], ["", "section \\<open>Sulzmann and Lu functions\\<close>"], ["", "fun \n  mkeps :: \"'a rexp \\<Rightarrow> 'a val\"\nwhere\n  \"mkeps(One) = Void\"\n| \"mkeps(Times r1 r2) = Seq (mkeps r1) (mkeps r2)\"\n| \"mkeps(Plus r1 r2) = (if nullable(r1) then Left (mkeps r1) else Right (mkeps r2))\"\n| \"mkeps(Star r) = Stars []\""], ["", "fun injval :: \"'a rexp \\<Rightarrow> 'a \\<Rightarrow> 'a val \\<Rightarrow> 'a val\"\nwhere\n  \"injval (Atom d) c Void = Atm d\"\n| \"injval (Plus r1 r2) c (Left v1) = Left(injval r1 c v1)\"\n| \"injval (Plus r1 r2) c (Right v2) = Right(injval r2 c v2)\"\n| \"injval (Times r1 r2) c (Seq v1 v2) = Seq (injval r1 c v1) v2\"\n| \"injval (Times r1 r2) c (Left (Seq v1 v2)) = Seq (injval r1 c v1) v2\"\n| \"injval (Times r1 r2) c (Right v2) = Seq (mkeps r1) (injval r2 c v2)\"\n| \"injval (Star r) c (Seq v (Stars vs)) = Stars ((injval r c v) # vs)\""], ["", "section \\<open>Mkeps, injval\\<close>"], ["", "lemma mkeps_nullable:\n  assumes \"nullable r\" \n  shows \"\\<turnstile> mkeps r : r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile> mkeps r : r", "using assms"], ["proof (prove)\nusing this:\n  nullable r\n\ngoal (1 subgoal):\n 1. \\<turnstile> mkeps r : r", "by (induct r) \n   (auto intro: Prf.intros)"], ["", "lemma mkeps_flat:\n  assumes \"nullable r\" \n  shows \"flat (mkeps r) = []\""], ["proof (prove)\ngoal (1 subgoal):\n 1. flat (mkeps r) = []", "using assms"], ["proof (prove)\nusing this:\n  nullable r\n\ngoal (1 subgoal):\n 1. flat (mkeps r) = []", "by (induct r) (auto)"], ["", "lemma Prf_injval:\n  assumes \"\\<turnstile> v : deriv c r\" \n  shows \"\\<turnstile> (injval r c v) : r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile> injval r c v : r", "using assms"], ["proof (prove)\nusing this:\n  \\<turnstile> v : deriv c r\n\ngoal (1 subgoal):\n 1. \\<turnstile> injval r c v : r", "apply(induct r arbitrary: c v rule: rexp.induct)"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<And>c v.\n       \\<turnstile> v : deriv c Zero \\<Longrightarrow>\n       \\<turnstile> injval Zero c v : Zero\n 2. \\<And>c v.\n       \\<turnstile> v : deriv c One \\<Longrightarrow>\n       \\<turnstile> injval One c v : One\n 3. \\<And>x c v.\n       \\<turnstile> v : deriv c (Atom x) \\<Longrightarrow>\n       \\<turnstile> injval (Atom x) c v : Atom x\n 4. \\<And>x1 x2 c v.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x1 \\<Longrightarrow>\n                   \\<turnstile> injval x1 c v : x1;\n        \\<And>c v.\n           \\<turnstile> v : deriv c x2 \\<Longrightarrow>\n           \\<turnstile> injval x2 c v : x2;\n        \\<turnstile> v : deriv c (Plus x1 x2)\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Plus x1 x2) c v : Plus x1 x2\n 5. \\<And>x1 x2 c v.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x1 \\<Longrightarrow>\n                   \\<turnstile> injval x1 c v : x1;\n        \\<And>c v.\n           \\<turnstile> v : deriv c x2 \\<Longrightarrow>\n           \\<turnstile> injval x2 c v : x2;\n        \\<turnstile> v : deriv c (Times x1 x2)\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Times x1 x2) c v : Times x1 x2\n 6. \\<And>x c v.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v : deriv c (Star x)\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c v : Star x", "apply(auto intro!: Prf.intros mkeps_nullable elim!: Prf_elims split: if_splits)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x c v1 v2.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; \\<turnstile> v2 : Star x\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x", "(* Star *)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x c v1 v2.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; \\<turnstile> v2 : Star x\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x", "apply(rotate_tac 2)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x c v1 v2.\n       \\<lbrakk>\\<turnstile> v2 : Star x;\n        \\<And>c v.\n           \\<turnstile> v : deriv c x \\<Longrightarrow>\n           \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x", "apply(erule Prf.cases)"], ["proof (prove)\ngoal (7 subgoals):\n 1. \\<And>x c v1 v2 v1a r1 v2a r2.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; v2 = Seq v1a v2a; Star x = Times r1 r2;\n        \\<turnstile> v1a : r1; \\<turnstile> v2a : r2\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x\n 2. \\<And>x c v1 v2 v1a r1 r2.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; v2 = val.Left v1a; Star x = Plus r1 r2;\n        \\<turnstile> v1a : r1\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x\n 3. \\<And>x c v1 v2 v2a r2 r1.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; v2 = val.Right v2a;\n        Star x = Plus r1 r2; \\<turnstile> v2a : r2\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x\n 4. \\<And>x c v1 v2.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; v2 = Void; Star x = One\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x\n 5. \\<And>x c v1 v2 ca.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; v2 = Atm ca; Star x = Atom ca\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x\n 6. \\<And>x c v1 v2 r.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; v2 = Stars []; Star x = Star r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x\n 7. \\<And>x c v1 v2 v r vs.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c x \\<Longrightarrow>\n                   \\<turnstile> injval x c v : x;\n        \\<turnstile> v1 : deriv c x; v2 = Stars (v # vs); Star x = Star r;\n        \\<turnstile> v : r; \\<turnstile> Stars vs : Star r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> injval (Star x) c (Seq v1 v2) : Star x", "apply(simp_all)[7]"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x c v1 v2 r.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   \\<turnstile> injval r c v : r;\n        \\<turnstile> v1 : deriv c r; v2 = Stars []; x = r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> Stars [injval r c v1] : Star r\n 2. \\<And>x c v1 v2 v r vs.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   \\<turnstile> injval r c v : r;\n        \\<turnstile> v1 : deriv c r; v2 = Stars (v # vs); x = r;\n        \\<turnstile> v : r; \\<turnstile> Stars vs : Star r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> Stars\n (injval r c v1 # v # vs) : Star r", "apply(auto)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>c v1 r.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   \\<turnstile> injval r c v : r;\n        \\<turnstile> v1 : deriv c r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> Stars [injval r c v1] : Star r\n 2. \\<And>c v1 v r vs.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   \\<turnstile> injval r c v : r;\n        \\<turnstile> v1 : deriv c r; \\<turnstile> v : r;\n        \\<turnstile> Stars vs : Star r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> Stars\n (injval r c v1 # v # vs) : Star r", "apply (metis Prf.intros(6) Prf.intros(7))"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>c v1 v r vs.\n       \\<lbrakk>\\<And>c v.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   \\<turnstile> injval r c v : r;\n        \\<turnstile> v1 : deriv c r; \\<turnstile> v : r;\n        \\<turnstile> Stars vs : Star r\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile> Stars\n (injval r c v1 # v # vs) : Star r", "by (metis Prf.intros(7))"], ["", "lemma Prf_injval_flat:\n  assumes \"\\<turnstile> v : deriv c r\" \n  shows \"flat (injval r c v) = c # (flat v)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. flat (injval r c v) = c # flat v", "using assms"], ["proof (prove)\nusing this:\n  \\<turnstile> v : deriv c r\n\ngoal (1 subgoal):\n 1. flat (injval r c v) = c # flat v", "apply(induct r arbitrary: v c)"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<And>v c.\n       \\<turnstile> v : deriv c Zero \\<Longrightarrow>\n       flat (injval Zero c v) = c # flat v\n 2. \\<And>v c.\n       \\<turnstile> v : deriv c One \\<Longrightarrow>\n       flat (injval One c v) = c # flat v\n 3. \\<And>x v c.\n       \\<turnstile> v : deriv c (Atom x) \\<Longrightarrow>\n       flat (injval (Atom x) c v) = c # flat v\n 4. \\<And>r1 r2 v c.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r1 \\<Longrightarrow>\n                   flat (injval r1 c v) = c # flat v;\n        \\<And>v c.\n           \\<turnstile> v : deriv c r2 \\<Longrightarrow>\n           flat (injval r2 c v) = c # flat v;\n        \\<turnstile> v : deriv c (Plus r1 r2)\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Plus r1 r2) c v) = c # flat v\n 5. \\<And>r1 r2 v c.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r1 \\<Longrightarrow>\n                   flat (injval r1 c v) = c # flat v;\n        \\<And>v c.\n           \\<turnstile> v : deriv c r2 \\<Longrightarrow>\n           flat (injval r2 c v) = c # flat v;\n        \\<turnstile> v : deriv c (Times r1 r2)\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Times r1 r2) c v) = c # flat v\n 6. \\<And>r v c.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v : deriv c (Star r)\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c v) = c # flat v", "apply(auto elim!: Prf_elims split: if_splits)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r1 r2 c v2.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r1 \\<Longrightarrow>\n                   flat (injval r1 c v) = c # flat v;\n        \\<And>v c.\n           \\<turnstile> v : deriv c r2 \\<Longrightarrow>\n           flat (injval r2 c v) = c # flat v;\n        nullable r1; \\<turnstile> v2 : deriv c r2\\<rbrakk>\n       \\<Longrightarrow> flat (mkeps r1) = []\n 2. \\<And>r c v1 v2.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; \\<turnstile> v2 : Star r\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2", "apply(metis mkeps_flat)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r c v1 v2.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; \\<turnstile> v2 : Star r\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2", "apply(rotate_tac 2)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r c v1 v2.\n       \\<lbrakk>\\<turnstile> v2 : Star r;\n        \\<And>v c.\n           \\<turnstile> v : deriv c r \\<Longrightarrow>\n           flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2", "apply(erule Prf.cases)"], ["proof (prove)\ngoal (7 subgoals):\n 1. \\<And>r c v1 v2 v1a r1 v2a r2.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; v2 = Seq v1a v2a; Star r = Times r1 r2;\n        \\<turnstile> v1a : r1; \\<turnstile> v2a : r2\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2\n 2. \\<And>r c v1 v2 v1a r1 r2.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; v2 = val.Left v1a; Star r = Plus r1 r2;\n        \\<turnstile> v1a : r1\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2\n 3. \\<And>r c v1 v2 v2a r2 r1.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; v2 = val.Right v2a;\n        Star r = Plus r1 r2; \\<turnstile> v2a : r2\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2\n 4. \\<And>r c v1 v2.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; v2 = Void; Star r = One\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2\n 5. \\<And>r c v1 v2 ca.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; v2 = Atm ca; Star r = Atom ca\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2\n 6. \\<And>r c v1 v2 ra.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; v2 = Stars [];\n        Star r = Star ra\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2\n 7. \\<And>r c v1 v2 v ra vs.\n       \\<lbrakk>\\<And>v c.\n                   \\<turnstile> v : deriv c r \\<Longrightarrow>\n                   flat (injval r c v) = c # flat v;\n        \\<turnstile> v1 : deriv c r; v2 = Stars (v # vs); Star r = Star ra;\n        \\<turnstile> v : ra; \\<turnstile> Stars vs : Star ra\\<rbrakk>\n       \\<Longrightarrow> flat (injval (Star r) c (Seq v1 v2)) =\n                         c # flat v1 @ flat v2", "apply(simp_all)[7]"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "(* HERE *)"], ["", "section \\<open>Our Alternative Posix definition\\<close>"], ["", "inductive \n  Posix :: \"'a list \\<Rightarrow> 'a rexp \\<Rightarrow> 'a val \\<Rightarrow> bool\" (\"_ \\<in> _ \\<rightarrow> _\" [100, 100, 100] 100)\nwhere\n  Posix_One: \"[] \\<in> One \\<rightarrow> Void\"\n| Posix_Atom: \"[c] \\<in> (Atom c) \\<rightarrow> (Atm c)\"\n| Posix_Plus1: \"s \\<in> r1 \\<rightarrow> v \\<Longrightarrow> s \\<in> (Plus r1 r2) \\<rightarrow> (Left v)\"\n| Posix_Plus2: \"\\<lbrakk>s \\<in> r2 \\<rightarrow> v; s \\<notin> lang r1\\<rbrakk> \\<Longrightarrow> s \\<in> (Plus r1 r2) \\<rightarrow> (Right v)\"\n| Posix_Times: \"\\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n    \\<not>(\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> (s1 @ s\\<^sub>3) \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2)\\<rbrakk> \\<Longrightarrow> \n    (s1 @ s2) \\<in> (Times r1 r2) \\<rightarrow> (Seq v1 v2)\"\n| Posix_Star1: \"\\<lbrakk>s1 \\<in> r \\<rightarrow> v; s2 \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n    \\<not>(\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> (s1 @ s\\<^sub>3) \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r))\\<rbrakk>\n    \\<Longrightarrow> (s1 @ s2) \\<in> Star r \\<rightarrow> Stars (v # vs)\"\n| Posix_Star2: \"[] \\<in> Star r \\<rightarrow> Stars []\""], ["", "inductive_cases Posix_elims:\n  \"s \\<in> Zero \\<rightarrow> v\"\n  \"s \\<in> One \\<rightarrow> v\"\n  \"s \\<in> Atom c \\<rightarrow> v\"\n  \"s \\<in> Plus r1 r2 \\<rightarrow> v\"\n  \"s \\<in> Times r1 r2 \\<rightarrow> v\"\n  \"s \\<in> Star r \\<rightarrow> v\""], ["", "lemma Posix1:\n  assumes \"s \\<in> r \\<rightarrow> v\"\n  shows \"s \\<in> lang r\" \"flat v = s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> lang r &&& flat v = s", "using assms"], ["proof (prove)\nusing this:\n  s \\<in> r \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s \\<in> lang r &&& flat v = s", "by (induct s r v rule: Posix.induct) (auto)"], ["", "lemma Posix1a:\n  assumes \"s \\<in> r \\<rightarrow> v\"\n  shows \"\\<turnstile> v : r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile> v : r", "using assms"], ["proof (prove)\nusing this:\n  s \\<in> r \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. \\<turnstile> v : r", "by (induct s r v rule: Posix.induct)(auto intro: Prf.intros)"], ["", "lemma Posix_mkeps:\n  assumes \"nullable r\"\n  shows \"[] \\<in> r \\<rightarrow> mkeps r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [] \\<in> r \\<rightarrow> mkeps r", "using assms"], ["proof (prove)\nusing this:\n  nullable r\n\ngoal (1 subgoal):\n 1. [] \\<in> r \\<rightarrow> mkeps r", "apply(induct r)"], ["proof (prove)\ngoal (6 subgoals):\n 1. nullable Zero \\<Longrightarrow> [] \\<in> Zero \\<rightarrow> mkeps Zero\n 2. nullable One \\<Longrightarrow> [] \\<in> One \\<rightarrow> mkeps One\n 3. \\<And>x.\n       nullable (Atom x) \\<Longrightarrow>\n       [] \\<in> Atom x \\<rightarrow> mkeps (Atom x)\n 4. \\<And>r1 r2.\n       \\<lbrakk>nullable r1 \\<Longrightarrow>\n                [] \\<in> r1 \\<rightarrow> mkeps r1;\n        nullable r2 \\<Longrightarrow> [] \\<in> r2 \\<rightarrow> mkeps r2;\n        nullable (Plus r1 r2)\\<rbrakk>\n       \\<Longrightarrow> [] \\<in> Plus r1\n                                   r2 \\<rightarrow> mkeps (Plus r1 r2)\n 5. \\<And>r1 r2.\n       \\<lbrakk>nullable r1 \\<Longrightarrow>\n                [] \\<in> r1 \\<rightarrow> mkeps r1;\n        nullable r2 \\<Longrightarrow> [] \\<in> r2 \\<rightarrow> mkeps r2;\n        nullable (Times r1 r2)\\<rbrakk>\n       \\<Longrightarrow> [] \\<in> Times r1\n                                   r2 \\<rightarrow> mkeps (Times r1 r2)\n 6. \\<And>r.\n       \\<lbrakk>nullable r \\<Longrightarrow>\n                [] \\<in> r \\<rightarrow> mkeps r;\n        nullable (Star r)\\<rbrakk>\n       \\<Longrightarrow> [] \\<in> Star r \\<rightarrow> mkeps (Star r)", "apply(auto intro: Posix.intros simp add: nullable_iff)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r1 r2.\n       \\<lbrakk>[] \\<in> r1 \\<rightarrow> mkeps r1;\n        [] \\<in> r2 \\<rightarrow> mkeps r2; [] \\<in> lang r1;\n        [] \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> [] \\<in> Times r1\n                                   r2 \\<rightarrow> Seq (mkeps r1)\n               (mkeps r2)", "apply(subst append.simps(1)[symmetric])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r1 r2.\n       \\<lbrakk>[] \\<in> r1 \\<rightarrow> mkeps r1;\n        [] \\<in> r2 \\<rightarrow> mkeps r2; [] \\<in> lang r1;\n        [] \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> ([] @\n                          []) \\<in> Times r1\n                                     r2 \\<rightarrow> Seq (mkeps r1)\n                 (mkeps r2)", "apply(rule Posix.intros)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>r1 r2.\n       \\<lbrakk>[] \\<in> r1 \\<rightarrow> mkeps r1;\n        [] \\<in> r2 \\<rightarrow> mkeps r2; [] \\<in> lang r1;\n        [] \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> [] \\<in> r1 \\<rightarrow> mkeps r1\n 2. \\<And>r1 r2.\n       \\<lbrakk>[] \\<in> r1 \\<rightarrow> mkeps r1;\n        [] \\<in> r2 \\<rightarrow> mkeps r2; [] \\<in> lang r1;\n        [] \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> [] \\<in> r2 \\<rightarrow> mkeps r2\n 3. \\<And>r1 r2.\n       \\<lbrakk>[] \\<in> r1 \\<rightarrow> mkeps r1;\n        [] \\<in> r2 \\<rightarrow> mkeps r2; [] \\<in> lang r1;\n        [] \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> \\<nexists>s\\<^sub>3 s\\<^sub>4.\n                            s\\<^sub>3 \\<noteq> [] \\<and>\n                            s\\<^sub>3 @ s\\<^sub>4 = [] \\<and>\n                            [] @ s\\<^sub>3 \\<in> lang r1 \\<and>\n                            s\\<^sub>4 \\<in> lang r2", "apply(auto)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma Posix_determ:\n  assumes \"s \\<in> r \\<rightarrow> v1\" \"s \\<in> r \\<rightarrow> v2\"\n  shows \"v1 = v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v1 = v2", "using assms"], ["proof (prove)\nusing this:\n  s \\<in> r \\<rightarrow> v1\n  s \\<in> r \\<rightarrow> v2\n\ngoal (1 subgoal):\n 1. v1 = v2", "proof (induct s r v1 arbitrary: v2 rule: Posix.induct)"], ["proof (state)\ngoal (7 subgoals):\n 1. \\<And>v2. [] \\<in> One \\<rightarrow> v2 \\<Longrightarrow> Void = v2\n 2. \\<And>c v2.\n       [c] \\<in> Atom c \\<rightarrow> v2 \\<Longrightarrow> Atm c = v2\n 3. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 4. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 5. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 6. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 7. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "case (Posix_One v2)"], ["proof (state)\nthis:\n  [] \\<in> One \\<rightarrow> v2\n\ngoal (7 subgoals):\n 1. \\<And>v2. [] \\<in> One \\<rightarrow> v2 \\<Longrightarrow> Void = v2\n 2. \\<And>c v2.\n       [c] \\<in> Atom c \\<rightarrow> v2 \\<Longrightarrow> Atm c = v2\n 3. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 4. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 5. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 6. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 7. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"[] \\<in> One \\<rightarrow> v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [] \\<in> One \\<rightarrow> v2", "by fact"], ["proof (state)\nthis:\n  [] \\<in> One \\<rightarrow> v2\n\ngoal (7 subgoals):\n 1. \\<And>v2. [] \\<in> One \\<rightarrow> v2 \\<Longrightarrow> Void = v2\n 2. \\<And>c v2.\n       [c] \\<in> Atom c \\<rightarrow> v2 \\<Longrightarrow> Atm c = v2\n 3. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 4. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 5. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 6. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 7. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  [] \\<in> One \\<rightarrow> v2", "show \"Void = v2\""], ["proof (prove)\nusing this:\n  [] \\<in> One \\<rightarrow> v2\n\ngoal (1 subgoal):\n 1. Void = v2", "by cases auto"], ["proof (state)\nthis:\n  Void = v2\n\ngoal (6 subgoals):\n 1. \\<And>c v2.\n       [c] \\<in> Atom c \\<rightarrow> v2 \\<Longrightarrow> Atm c = v2\n 2. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 3. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 4. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 5. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 6. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "next"], ["proof (state)\ngoal (6 subgoals):\n 1. \\<And>c v2.\n       [c] \\<in> Atom c \\<rightarrow> v2 \\<Longrightarrow> Atm c = v2\n 2. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 3. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 4. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 5. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 6. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "case (Posix_Atom c v2)"], ["proof (state)\nthis:\n  [c] \\<in> Atom c \\<rightarrow> v2\n\ngoal (6 subgoals):\n 1. \\<And>c v2.\n       [c] \\<in> Atom c \\<rightarrow> v2 \\<Longrightarrow> Atm c = v2\n 2. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 3. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 4. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 5. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 6. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"[c] \\<in> Atom c \\<rightarrow> v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [c] \\<in> Atom c \\<rightarrow> v2", "by fact"], ["proof (state)\nthis:\n  [c] \\<in> Atom c \\<rightarrow> v2\n\ngoal (6 subgoals):\n 1. \\<And>c v2.\n       [c] \\<in> Atom c \\<rightarrow> v2 \\<Longrightarrow> Atm c = v2\n 2. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 3. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 4. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 5. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 6. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  [c] \\<in> Atom c \\<rightarrow> v2", "show \"Atm c = v2\""], ["proof (prove)\nusing this:\n  [c] \\<in> Atom c \\<rightarrow> v2\n\ngoal (1 subgoal):\n 1. Atm c = v2", "by cases auto"], ["proof (state)\nthis:\n  Atm c = v2\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "next"], ["proof (state)\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "case (Posix_Plus1 s r1 v r2 v2)"], ["proof (state)\nthis:\n  s \\<in> r1 \\<rightarrow> v\n  s \\<in> r1 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"s \\<in> Plus r1 r2 \\<rightarrow> v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> Plus r1 r2 \\<rightarrow> v2", "by fact"], ["proof (state)\nthis:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "moreover"], ["proof (state)\nthis:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"s \\<in> r1 \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> r1 \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> r1 \\<rightarrow> v\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  s \\<in> r1 \\<rightarrow> v", "have \"s \\<in> lang r1\""], ["proof (prove)\nusing this:\n  s \\<in> r1 \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s \\<in> lang r1", "by (simp add: Posix1)"], ["proof (state)\nthis:\n  s \\<in> lang r1\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "ultimately"], ["proof (chain)\npicking this:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n  s \\<in> lang r1", "obtain v' where eq: \"v2 = Left v'\" \"s \\<in> r1 \\<rightarrow> v'\""], ["proof (prove)\nusing this:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n  s \\<in> lang r1\n\ngoal (1 subgoal):\n 1. (\\<And>v'.\n        \\<lbrakk>v2 = val.Left v'; s \\<in> r1 \\<rightarrow> v'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by cases auto"], ["proof (state)\nthis:\n  v2 = val.Left v'\n  s \\<in> r1 \\<rightarrow> v'\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "moreover"], ["proof (state)\nthis:\n  v2 = val.Left v'\n  s \\<in> r1 \\<rightarrow> v'\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have IH: \"\\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2", "by fact"], ["proof (state)\nthis:\n  s \\<in> r1 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "ultimately"], ["proof (chain)\npicking this:\n  v2 = val.Left v'\n  s \\<in> r1 \\<rightarrow> v'\n  s \\<in> r1 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0", "have \"v = v'\""], ["proof (prove)\nusing this:\n  v2 = val.Left v'\n  s \\<in> r1 \\<rightarrow> v'\n  s \\<in> r1 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n\ngoal (1 subgoal):\n 1. v = v'", "by simp"], ["proof (state)\nthis:\n  v = v'\n\ngoal (5 subgoals):\n 1. \\<And>s r1 v r2 v2.\n       \\<lbrakk>s \\<in> r1 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Left v = v2\n 2. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 3. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 4. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 5. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  v = v'", "show \"Left v = v2\""], ["proof (prove)\nusing this:\n  v = v'\n\ngoal (1 subgoal):\n 1. val.Left v = v2", "using eq"], ["proof (prove)\nusing this:\n  v = v'\n  v2 = val.Left v'\n  s \\<in> r1 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. val.Left v = v2", "by simp"], ["proof (state)\nthis:\n  val.Left v = v2\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "next"], ["proof (state)\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "case (Posix_Plus2 s r2 v r1 v2)"], ["proof (state)\nthis:\n  s \\<in> r2 \\<rightarrow> v\n  s \\<in> r2 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n  s \\<notin> lang r1\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"s \\<in> Plus r1 r2 \\<rightarrow> v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> Plus r1 r2 \\<rightarrow> v2", "by fact"], ["proof (state)\nthis:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "moreover"], ["proof (state)\nthis:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"s \\<notin> lang r1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<notin> lang r1", "by fact"], ["proof (state)\nthis:\n  s \\<notin> lang r1\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "ultimately"], ["proof (chain)\npicking this:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n  s \\<notin> lang r1", "obtain v' where eq: \"v2 = Right v'\" \"s \\<in> r2 \\<rightarrow> v'\""], ["proof (prove)\nusing this:\n  s \\<in> Plus r1 r2 \\<rightarrow> v2\n  s \\<notin> lang r1\n\ngoal (1 subgoal):\n 1. (\\<And>v'.\n        \\<lbrakk>v2 = val.Right v'; s \\<in> r2 \\<rightarrow> v'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by cases (auto simp add: Posix1)"], ["proof (state)\nthis:\n  v2 = val.Right v'\n  s \\<in> r2 \\<rightarrow> v'\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "moreover"], ["proof (state)\nthis:\n  v2 = val.Right v'\n  s \\<in> r2 \\<rightarrow> v'\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have IH: \"\\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2", "by fact"], ["proof (state)\nthis:\n  s \\<in> r2 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "ultimately"], ["proof (chain)\npicking this:\n  v2 = val.Right v'\n  s \\<in> r2 \\<rightarrow> v'\n  s \\<in> r2 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0", "have \"v = v'\""], ["proof (prove)\nusing this:\n  v2 = val.Right v'\n  s \\<in> r2 \\<rightarrow> v'\n  s \\<in> r2 \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n\ngoal (1 subgoal):\n 1. v = v'", "by simp"], ["proof (state)\nthis:\n  v = v'\n\ngoal (4 subgoals):\n 1. \\<And>s r2 v r1 v2.\n       \\<lbrakk>s \\<in> r2 \\<rightarrow> v;\n        \\<And>v2. s \\<in> r2 \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s \\<notin> lang r1; s \\<in> Plus r1 r2 \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> val.Right v = v2\n 2. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 3. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 4. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  v = v'", "show \"Right v = v2\""], ["proof (prove)\nusing this:\n  v = v'\n\ngoal (1 subgoal):\n 1. val.Right v = v2", "using eq"], ["proof (prove)\nusing this:\n  v = v'\n  v2 = val.Right v'\n  s \\<in> r2 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. val.Right v = v2", "by simp"], ["proof (state)\nthis:\n  val.Right v = v2\n\ngoal (3 subgoals):\n 1. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 2. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 3. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "next"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 2. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 3. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "case (Posix_Times s1 r1 v1 s2 r2 v2 v')"], ["proof (state)\nthis:\n  s1 \\<in> r1 \\<rightarrow> v1\n  s1 \\<in> r1 \\<rightarrow> ?v2.0 \\<Longrightarrow> v1 = ?v2.0\n  s2 \\<in> r2 \\<rightarrow> v2\n  s2 \\<in> r2 \\<rightarrow> ?v2.0 \\<Longrightarrow> v2 = ?v2.0\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n  (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v'\n\ngoal (3 subgoals):\n 1. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 2. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 3. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"(s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v'\" \n       \"s1 \\<in> r1 \\<rightarrow> v1\" \"s2 \\<in> r2 \\<rightarrow> v2\"\n       \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ((s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v' &&&\n     s1 \\<in> r1 \\<rightarrow> v1) &&&\n    s2 \\<in> r2 \\<rightarrow> v2 &&&\n    \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "by fact+"], ["proof (state)\nthis:\n  (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v'\n  s1 \\<in> r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (3 subgoals):\n 1. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 2. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 3. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v'\n  s1 \\<in> r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "obtain v1' v2' where \"v' = Seq v1' v2'\" \"s1 \\<in> r1 \\<rightarrow> v1'\" \"s2 \\<in> r2 \\<rightarrow> v2'\""], ["proof (prove)\nusing this:\n  (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v'\n  s1 \\<in> r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. (\\<And>v1' v2'.\n        \\<lbrakk>v' = Seq v1' v2'; s1 \\<in> r1 \\<rightarrow> v1';\n         s2 \\<in> r2 \\<rightarrow> v2'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "apply(cases)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s1a v1 s2a v2.\n       \\<lbrakk>\\<And>v1' v2'.\n                   \\<lbrakk>v' = Seq v1' v2'; s1 \\<in> r1 \\<rightarrow> v1';\n                    s2 \\<in> r2 \\<rightarrow> v2'\\<rbrakk>\n                   \\<Longrightarrow> thesis;\n        s1 \\<in> r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        s1 @ s2 = s1a @ s2a; v' = Seq v1 v2; s1a \\<in> r1 \\<rightarrow> v1;\n        s2a \\<in> r2 \\<rightarrow> v2;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2a \\<and>\n           s1a @ s\\<^sub>3 \\<in> lang r1 \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> thesis", "apply (auto simp add: append_eq_append_conv2)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s1a v1 v2 us.\n       \\<lbrakk>\\<lbrakk>(s1a @ us) \\<in> r1 \\<rightarrow> v1;\n                 s2 \\<in> r2 \\<rightarrow> v2\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        (s1a @ us) \\<in> r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1a @ us @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        v' = Seq v1 v2; s1a \\<in> r1 \\<rightarrow> v1;\n        (us @ s2) \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1a @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2 \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        s1 = s1a @ us\\<rbrakk>\n       \\<Longrightarrow> thesis\n 2. \\<And>v1 s2a v2 us.\n       \\<lbrakk>\\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n                 (us @ s2a) \\<in> r2 \\<rightarrow> v2\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        s1 \\<in> r1 \\<rightarrow> v1; (us @ s2a) \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2a \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2a) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        v' = Seq v1 v2; (s1 @ us) \\<in> r1 \\<rightarrow> v1;\n        s2a \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1 @ us @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        s2 = us @ s2a\\<rbrakk>\n       \\<Longrightarrow> thesis", "using Posix1(1)"], ["proof (prove)\nusing this:\n  ?s \\<in> ?r \\<rightarrow> ?v \\<Longrightarrow> ?s \\<in> lang ?r\n\ngoal (2 subgoals):\n 1. \\<And>s1a v1 v2 us.\n       \\<lbrakk>\\<lbrakk>(s1a @ us) \\<in> r1 \\<rightarrow> v1;\n                 s2 \\<in> r2 \\<rightarrow> v2\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        (s1a @ us) \\<in> r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1a @ us @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        v' = Seq v1 v2; s1a \\<in> r1 \\<rightarrow> v1;\n        (us @ s2) \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1a @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2 \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        s1 = s1a @ us\\<rbrakk>\n       \\<Longrightarrow> thesis\n 2. \\<And>v1 s2a v2 us.\n       \\<lbrakk>\\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n                 (us @ s2a) \\<in> r2 \\<rightarrow> v2\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        s1 \\<in> r1 \\<rightarrow> v1; (us @ s2a) \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2a \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2a) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        v' = Seq v1 v2; (s1 @ us) \\<in> r1 \\<rightarrow> v1;\n        s2a \\<in> r2 \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           s1 @ us @ s\\<^sub>3 \\<in> lang r1 \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n               s\\<^sub>4 \\<notin> lang r2);\n        s2 = us @ s2a\\<rbrakk>\n       \\<Longrightarrow> thesis", "by fastforce+"], ["proof (state)\nthis:\n  v' = Seq v1' v2'\n  s1 \\<in> r1 \\<rightarrow> v1'\n  s2 \\<in> r2 \\<rightarrow> v2'\n\ngoal (3 subgoals):\n 1. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 2. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 3. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "moreover"], ["proof (state)\nthis:\n  v' = Seq v1' v2'\n  s1 \\<in> r1 \\<rightarrow> v1'\n  s2 \\<in> r2 \\<rightarrow> v2'\n\ngoal (3 subgoals):\n 1. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 2. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 3. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have IHs: \"\\<And>v1'. s1 \\<in> r1 \\<rightarrow> v1' \\<Longrightarrow> v1 = v1'\"\n            \"\\<And>v2'. s2 \\<in> r2 \\<rightarrow> v2' \\<Longrightarrow> v2 = v2'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v1'.\n        s1 \\<in> r1 \\<rightarrow> v1' \\<Longrightarrow> v1 = v1') &&&\n    (\\<And>v2'. s2 \\<in> r2 \\<rightarrow> v2' \\<Longrightarrow> v2 = v2')", "by fact+"], ["proof (state)\nthis:\n  s1 \\<in> r1 \\<rightarrow> ?v1' \\<Longrightarrow> v1 = ?v1'\n  s2 \\<in> r2 \\<rightarrow> ?v2' \\<Longrightarrow> v2 = ?v2'\n\ngoal (3 subgoals):\n 1. \\<And>s1 r1 v1 s2 r2 v2 v2a.\n       \\<lbrakk>s1 \\<in> r1 \\<rightarrow> v1;\n        \\<And>v2. s1 \\<in> r1 \\<rightarrow> v2 \\<Longrightarrow> v1 = v2;\n        s2 \\<in> r2 \\<rightarrow> v2;\n        \\<And>v2a. s2 \\<in> r2 \\<rightarrow> v2a \\<Longrightarrow> v2 = v2a;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2;\n        (s1 @ s2) \\<in> Times r1 r2 \\<rightarrow> v2a\\<rbrakk>\n       \\<Longrightarrow> Seq v1 v2 = v2a\n 2. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 3. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "ultimately"], ["proof (chain)\npicking this:\n  v' = Seq v1' v2'\n  s1 \\<in> r1 \\<rightarrow> v1'\n  s2 \\<in> r2 \\<rightarrow> v2'\n  s1 \\<in> r1 \\<rightarrow> ?v1' \\<Longrightarrow> v1 = ?v1'\n  s2 \\<in> r2 \\<rightarrow> ?v2' \\<Longrightarrow> v2 = ?v2'", "show \"Seq v1 v2 = v'\""], ["proof (prove)\nusing this:\n  v' = Seq v1' v2'\n  s1 \\<in> r1 \\<rightarrow> v1'\n  s2 \\<in> r2 \\<rightarrow> v2'\n  s1 \\<in> r1 \\<rightarrow> ?v1' \\<Longrightarrow> v1 = ?v1'\n  s2 \\<in> r2 \\<rightarrow> ?v2' \\<Longrightarrow> v2 = ?v2'\n\ngoal (1 subgoal):\n 1. Seq v1 v2 = v'", "by simp"], ["proof (state)\nthis:\n  Seq v1 v2 = v'\n\ngoal (2 subgoals):\n 1. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 2. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 2. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "case (Posix_Star1 s1 r v s2 vs v2)"], ["proof (state)\nthis:\n  s1 \\<in> r \\<rightarrow> v\n  s1 \\<in> r \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  s2 \\<in> Star r \\<rightarrow> ?v2.0 \\<Longrightarrow> Stars vs = ?v2.0\n  flat v \\<noteq> []\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)\n  (s1 @ s2) \\<in> Star r \\<rightarrow> v2\n\ngoal (2 subgoals):\n 1. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 2. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"(s1 @ s2) \\<in> Star r \\<rightarrow> v2\" \n       \"s1 \\<in> r \\<rightarrow> v\" \"s2 \\<in> Star r \\<rightarrow> Stars vs\" \"flat v \\<noteq> []\"\n       \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ((s1 @ s2) \\<in> Star r \\<rightarrow> v2 &&&\n     s1 \\<in> r \\<rightarrow> v) &&&\n    s2 \\<in> Star r \\<rightarrow> Stars vs &&&\n    flat v \\<noteq> [] &&&\n    \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)", "by fact+"], ["proof (state)\nthis:\n  (s1 @ s2) \\<in> Star r \\<rightarrow> v2\n  s1 \\<in> r \\<rightarrow> v\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  flat v \\<noteq> []\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (2 subgoals):\n 1. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 2. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  (s1 @ s2) \\<in> Star r \\<rightarrow> v2\n  s1 \\<in> r \\<rightarrow> v\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  flat v \\<noteq> []\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)", "obtain v' vs' where \"v2 = Stars (v' # vs')\" \"s1 \\<in> r \\<rightarrow> v'\" \"s2 \\<in> (Star r) \\<rightarrow> (Stars vs')\""], ["proof (prove)\nusing this:\n  (s1 @ s2) \\<in> Star r \\<rightarrow> v2\n  s1 \\<in> r \\<rightarrow> v\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  flat v \\<noteq> []\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (1 subgoal):\n 1. (\\<And>v' vs'.\n        \\<lbrakk>v2 = Stars (v' # vs'); s1 \\<in> r \\<rightarrow> v';\n         s2 \\<in> Star r \\<rightarrow> Stars vs'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "apply(cases)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s1a va s2a vsa.\n       \\<lbrakk>\\<And>v' vs'.\n                   \\<lbrakk>v2 = Stars (v' # vs');\n                    s1 \\<in> r \\<rightarrow> v';\n                    s2 \\<in> Star r \\<rightarrow> Stars vs'\\<rbrakk>\n                   \\<Longrightarrow> thesis;\n        s1 \\<in> r \\<rightarrow> v; s2 \\<in> Star r \\<rightarrow> Stars vs;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        s1 @ s2 = s1a @ s2a; v2 = Stars (va # vsa);\n        s1a \\<in> r \\<rightarrow> va;\n        s2a \\<in> Star r \\<rightarrow> Stars vsa; flat va \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2a \\<and>\n           s1a @ s\\<^sub>3 \\<in> lang r \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> thesis\n 2. \\<lbrakk>\\<And>v' vs'.\n                \\<lbrakk>v2 = Stars (v' # vs'); s1 \\<in> r \\<rightarrow> v';\n                 s2 \\<in> Star r \\<rightarrow> Stars vs'\\<rbrakk>\n                \\<Longrightarrow> thesis;\n     s1 \\<in> r \\<rightarrow> v; s2 \\<in> Star r \\<rightarrow> Stars vs;\n     flat v \\<noteq> [];\n     \\<nexists>s\\<^sub>3 s\\<^sub>4.\n        s\\<^sub>3 \\<noteq> [] \\<and>\n        s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n        s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n     s1 @ s2 = []; v2 = Stars []\\<rbrakk>\n    \\<Longrightarrow> thesis", "apply (auto simp add: append_eq_append_conv2)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>s1a va vsa us.\n       \\<lbrakk>\\<lbrakk>(s1a @ us) \\<in> r \\<rightarrow> va;\n                 s2 \\<in> Star r \\<rightarrow> Stars vsa\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        (s1a @ us) \\<in> r \\<rightarrow> v;\n        s2 \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1a @ us @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        v2 = Stars (va # vsa); s1a \\<in> r \\<rightarrow> va;\n        (us @ s2) \\<in> Star r \\<rightarrow> Stars vsa; flat va \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2 \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        s1 = s1a @ us\\<rbrakk>\n       \\<Longrightarrow> thesis\n 2. \\<And>va s2a vsa us.\n       \\<lbrakk>\\<lbrakk>s1 \\<in> r \\<rightarrow> va;\n                 (us @ s2a) \\<in> Star r \\<rightarrow> Stars vsa\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        s1 \\<in> r \\<rightarrow> v;\n        (us @ s2a) \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2a \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2a) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        v2 = Stars (va # vsa); (s1 @ us) \\<in> r \\<rightarrow> va;\n        s2a \\<in> Star r \\<rightarrow> Stars vsa; flat va \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1 @ us @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        s2 = us @ s2a\\<rbrakk>\n       \\<Longrightarrow> thesis\n 3. \\<lbrakk>[] \\<in> r \\<rightarrow> v;\n     [] \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n     v2 = Stars []; s1 = []; s2 = []\\<rbrakk>\n    \\<Longrightarrow> thesis", "using Posix1(1)"], ["proof (prove)\nusing this:\n  ?s \\<in> ?r \\<rightarrow> ?v \\<Longrightarrow> ?s \\<in> lang ?r\n\ngoal (3 subgoals):\n 1. \\<And>s1a va vsa us.\n       \\<lbrakk>\\<lbrakk>(s1a @ us) \\<in> r \\<rightarrow> va;\n                 s2 \\<in> Star r \\<rightarrow> Stars vsa\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        (s1a @ us) \\<in> r \\<rightarrow> v;\n        s2 \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1a @ us @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        v2 = Stars (va # vsa); s1a \\<in> r \\<rightarrow> va;\n        (us @ s2) \\<in> Star r \\<rightarrow> Stars vsa; flat va \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2 \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        s1 = s1a @ us\\<rbrakk>\n       \\<Longrightarrow> thesis\n 2. \\<And>va s2a vsa us.\n       \\<lbrakk>\\<lbrakk>s1 \\<in> r \\<rightarrow> va;\n                 (us @ s2a) \\<in> Star r \\<rightarrow> Stars vsa\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        s1 \\<in> r \\<rightarrow> v;\n        (us @ s2a) \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2a \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2a) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        v2 = Stars (va # vsa); (s1 @ us) \\<in> r \\<rightarrow> va;\n        s2a \\<in> Star r \\<rightarrow> Stars vsa; flat va \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1 @ us @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        s2 = us @ s2a\\<rbrakk>\n       \\<Longrightarrow> thesis\n 3. \\<lbrakk>[] \\<in> r \\<rightarrow> v;\n     [] \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n     v2 = Stars []; s1 = []; s2 = []\\<rbrakk>\n    \\<Longrightarrow> thesis", "apply fastforce"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>va s2a vsa us.\n       \\<lbrakk>\\<lbrakk>s1 \\<in> r \\<rightarrow> va;\n                 (us @ s2a) \\<in> Star r \\<rightarrow> Stars vsa\\<rbrakk>\n                \\<Longrightarrow> thesis;\n        s1 \\<in> r \\<rightarrow> v;\n        (us @ s2a) \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               (\\<exists>usa.\n                   s\\<^sub>3 = us @ usa \\<and> usa @ s\\<^sub>4 = s2a \\<or>\n                   s\\<^sub>3 @ usa = us \\<and>\n                   s\\<^sub>4 = usa @ s2a) \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        v2 = Stars (va # vsa); (s1 @ us) \\<in> r \\<rightarrow> va;\n        s2a \\<in> Star r \\<rightarrow> Stars vsa; flat va \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1 @ us @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        s2 = us @ s2a\\<rbrakk>\n       \\<Longrightarrow> thesis\n 2. \\<lbrakk>[] \\<in> r \\<rightarrow> v;\n     [] \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n     v2 = Stars []; s1 = []; s2 = []\\<rbrakk>\n    \\<Longrightarrow> thesis", "apply (metis Posix1(1) Posix_Star1.hyps(6) append_Nil append_Nil2)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>[] \\<in> r \\<rightarrow> v;\n     [] \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n     v2 = Stars []; s1 = []; s2 = []\\<rbrakk>\n    \\<Longrightarrow> thesis", "using Posix1(2)"], ["proof (prove)\nusing this:\n  ?s \\<in> ?r \\<rightarrow> ?v \\<Longrightarrow> flat ?v = ?s\n\ngoal (1 subgoal):\n 1. \\<lbrakk>[] \\<in> r \\<rightarrow> v;\n     [] \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n     v2 = Stars []; s1 = []; s2 = []\\<rbrakk>\n    \\<Longrightarrow> thesis", "by blast"], ["proof (state)\nthis:\n  v2 = Stars (v' # vs')\n  s1 \\<in> r \\<rightarrow> v'\n  s2 \\<in> Star r \\<rightarrow> Stars vs'\n\ngoal (2 subgoals):\n 1. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 2. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "moreover"], ["proof (state)\nthis:\n  v2 = Stars (v' # vs')\n  s1 \\<in> r \\<rightarrow> v'\n  s2 \\<in> Star r \\<rightarrow> Stars vs'\n\ngoal (2 subgoals):\n 1. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 2. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have IHs: \"\\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2\"\n            \"\\<And>v2. s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2) &&&\n    (\\<And>v2.\n        s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2)", "by fact+"], ["proof (state)\nthis:\n  s1 \\<in> r \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n  s2 \\<in> Star r \\<rightarrow> ?v2.0 \\<Longrightarrow> Stars vs = ?v2.0\n\ngoal (2 subgoals):\n 1. \\<And>s1 r v s2 vs v2.\n       \\<lbrakk>s1 \\<in> r \\<rightarrow> v;\n        \\<And>v2. s1 \\<in> r \\<rightarrow> v2 \\<Longrightarrow> v = v2;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<And>v2.\n           s2 \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars vs = v2;\n        flat v \\<noteq> [];\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r);\n        (s1 @ s2) \\<in> Star r \\<rightarrow> v2\\<rbrakk>\n       \\<Longrightarrow> Stars (v # vs) = v2\n 2. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "ultimately"], ["proof (chain)\npicking this:\n  v2 = Stars (v' # vs')\n  s1 \\<in> r \\<rightarrow> v'\n  s2 \\<in> Star r \\<rightarrow> Stars vs'\n  s1 \\<in> r \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n  s2 \\<in> Star r \\<rightarrow> ?v2.0 \\<Longrightarrow> Stars vs = ?v2.0", "show \"Stars (v # vs) = v2\""], ["proof (prove)\nusing this:\n  v2 = Stars (v' # vs')\n  s1 \\<in> r \\<rightarrow> v'\n  s2 \\<in> Star r \\<rightarrow> Stars vs'\n  s1 \\<in> r \\<rightarrow> ?v2.0 \\<Longrightarrow> v = ?v2.0\n  s2 \\<in> Star r \\<rightarrow> ?v2.0 \\<Longrightarrow> Stars vs = ?v2.0\n\ngoal (1 subgoal):\n 1. Stars (v # vs) = v2", "by auto"], ["proof (state)\nthis:\n  Stars (v # vs) = v2\n\ngoal (1 subgoal):\n 1. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "case (Posix_Star2 r v2)"], ["proof (state)\nthis:\n  [] \\<in> Star r \\<rightarrow> v2\n\ngoal (1 subgoal):\n 1. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "have \"[] \\<in> Star r \\<rightarrow> v2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [] \\<in> Star r \\<rightarrow> v2", "by fact"], ["proof (state)\nthis:\n  [] \\<in> Star r \\<rightarrow> v2\n\ngoal (1 subgoal):\n 1. \\<And>r v2.\n       [] \\<in> Star r \\<rightarrow> v2 \\<Longrightarrow> Stars [] = v2", "then"], ["proof (chain)\npicking this:\n  [] \\<in> Star r \\<rightarrow> v2", "show \"Stars [] = v2\""], ["proof (prove)\nusing this:\n  [] \\<in> Star r \\<rightarrow> v2\n\ngoal (1 subgoal):\n 1. Stars [] = v2", "by cases (auto simp add: Posix1)"], ["proof (state)\nthis:\n  Stars [] = v2\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma Posix_injval:\n  assumes \"s \\<in> (deriv c r) \\<rightarrow> v\"\n  shows \"(c # s) \\<in> r \\<rightarrow> (injval r c v)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (c # s) \\<in> r \\<rightarrow> injval r c v", "using assms"], ["proof (prove)\nusing this:\n  s \\<in> deriv c r \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> r \\<rightarrow> injval r c v", "proof(induct r arbitrary: s v rule: rexp.induct)"], ["proof (state)\ngoal (6 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c Zero \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Zero \\<rightarrow> injval Zero c v\n 2. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 3. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 5. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 6. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "case Zero"], ["proof (state)\nthis:\n  s \\<in> deriv c Zero \\<rightarrow> v\n\ngoal (6 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c Zero \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Zero \\<rightarrow> injval Zero c v\n 2. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 3. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 5. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 6. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have \"s \\<in> deriv c Zero \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c Zero \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c Zero \\<rightarrow> v\n\ngoal (6 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c Zero \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Zero \\<rightarrow> injval Zero c v\n 2. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 3. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 5. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 6. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c Zero \\<rightarrow> v", "have \"s \\<in> Zero \\<rightarrow> v\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c Zero \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s \\<in> Zero \\<rightarrow> v", "by simp"], ["proof (state)\nthis:\n  s \\<in> Zero \\<rightarrow> v\n\ngoal (6 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c Zero \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Zero \\<rightarrow> injval Zero c v\n 2. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 3. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 5. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 6. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> Zero \\<rightarrow> v", "have \"False\""], ["proof (prove)\nusing this:\n  s \\<in> Zero \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. False", "by cases"], ["proof (state)\nthis:\n  False\n\ngoal (6 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c Zero \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Zero \\<rightarrow> injval Zero c v\n 2. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 3. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 5. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 6. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  False", "show \"(c # s) \\<in> Zero \\<rightarrow> (injval Zero c v)\""], ["proof (prove)\nusing this:\n  False\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Zero \\<rightarrow> injval Zero c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> Zero \\<rightarrow> injval Zero c v\n\ngoal (5 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 2. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 5. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "next"], ["proof (state)\ngoal (5 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 2. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 5. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "case One"], ["proof (state)\nthis:\n  s \\<in> deriv c One \\<rightarrow> v\n\ngoal (5 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 2. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 5. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have \"s \\<in> deriv c One \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c One \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c One \\<rightarrow> v\n\ngoal (5 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 2. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 5. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c One \\<rightarrow> v", "have \"s \\<in> Zero \\<rightarrow> v\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c One \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s \\<in> Zero \\<rightarrow> v", "by simp"], ["proof (state)\nthis:\n  s \\<in> Zero \\<rightarrow> v\n\ngoal (5 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 2. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 5. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> Zero \\<rightarrow> v", "have \"False\""], ["proof (prove)\nusing this:\n  s \\<in> Zero \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. False", "by cases"], ["proof (state)\nthis:\n  False\n\ngoal (5 subgoals):\n 1. \\<And>s v.\n       s \\<in> deriv c One \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> One \\<rightarrow> injval One c v\n 2. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 4. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 5. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  False", "show \"(c # s) \\<in> One \\<rightarrow> (injval One c v)\""], ["proof (prove)\nusing this:\n  False\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> One \\<rightarrow> injval One c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> One \\<rightarrow> injval One c v\n\ngoal (4 subgoals):\n 1. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 4. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "next"], ["proof (state)\ngoal (4 subgoals):\n 1. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 4. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "case (Atom d)"], ["proof (state)\nthis:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v\n\ngoal (4 subgoals):\n 1. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 4. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "consider (eq) \"c = d\" | (ineq) \"c \\<noteq> d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>c = d \\<Longrightarrow> thesis;\n     c \\<noteq> d \\<Longrightarrow> thesis\\<rbrakk>\n    \\<Longrightarrow> thesis", "by blast"], ["proof (state)\nthis:\n  \\<lbrakk>c = d \\<Longrightarrow> ?thesis;\n   c \\<noteq> d \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (4 subgoals):\n 1. \\<And>x s v.\n       s \\<in> deriv c (Atom x) \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> Atom x \\<rightarrow> injval (Atom x) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 3. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 4. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  \\<lbrakk>c = d \\<Longrightarrow> ?thesis;\n   c \\<noteq> d \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis", "show \"(c # s) \\<in> (Atom d) \\<rightarrow> (injval (Atom d) c v)\""], ["proof (prove)\nusing this:\n  \\<lbrakk>c = d \\<Longrightarrow> ?thesis;\n   c \\<noteq> d \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "proof (cases)"], ["proof (state)\ngoal (2 subgoals):\n 1. c = d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n 2. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "case eq"], ["proof (state)\nthis:\n  c = d\n\ngoal (2 subgoals):\n 1. c = d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n 2. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "have \"s \\<in> deriv c (Atom d) \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c (Atom d) \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v\n\ngoal (2 subgoals):\n 1. c = d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n 2. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v", "have \"s \\<in> One \\<rightarrow> v\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s \\<in> One \\<rightarrow> v", "using eq"], ["proof (prove)\nusing this:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v\n  c = d\n\ngoal (1 subgoal):\n 1. s \\<in> One \\<rightarrow> v", "by simp"], ["proof (state)\nthis:\n  s \\<in> One \\<rightarrow> v\n\ngoal (2 subgoals):\n 1. c = d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n 2. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> One \\<rightarrow> v", "have eqs: \"s = [] \\<and> v = Void\""], ["proof (prove)\nusing this:\n  s \\<in> One \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s = [] \\<and> v = Void", "by cases simp"], ["proof (state)\nthis:\n  s = [] \\<and> v = Void\n\ngoal (2 subgoals):\n 1. c = d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n 2. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "show \"(c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "using eq eqs"], ["proof (prove)\nusing this:\n  c = d\n  s = [] \\<and> v = Void\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "by (auto intro: Posix.intros)"], ["proof (state)\nthis:\n  (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n\ngoal (1 subgoal):\n 1. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "case ineq"], ["proof (state)\nthis:\n  c \\<noteq> d\n\ngoal (1 subgoal):\n 1. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "have \"s \\<in> deriv c (Atom d) \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c (Atom d) \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v", "have \"s \\<in> Zero \\<rightarrow> v\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s \\<in> Zero \\<rightarrow> v", "using ineq"], ["proof (prove)\nusing this:\n  s \\<in> deriv c (Atom d) \\<rightarrow> v\n  c \\<noteq> d\n\ngoal (1 subgoal):\n 1. s \\<in> Zero \\<rightarrow> v", "by simp"], ["proof (state)\nthis:\n  s \\<in> Zero \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> Zero \\<rightarrow> v", "have \"False\""], ["proof (prove)\nusing this:\n  s \\<in> Zero \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. False", "by cases"], ["proof (state)\nthis:\n  False\n\ngoal (1 subgoal):\n 1. c \\<noteq> d \\<Longrightarrow>\n    (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "then"], ["proof (chain)\npicking this:\n  False", "show \"(c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\""], ["proof (prove)\nusing this:\n  False\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (c # s) \\<in> Atom d \\<rightarrow> injval (Atom d) c v\n\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "next"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "case (Plus r1 r2)"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r1 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r1 \\<rightarrow> injval r1 c ?v\n  ?s \\<in> deriv c r2 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r2 \\<rightarrow> injval r2 c ?v\n  s \\<in> deriv c (Plus r1 r2) \\<rightarrow> v\n\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have IH1: \"\\<And>s v. s \\<in> deriv c r1 \\<rightarrow> v \\<Longrightarrow> (c # s) \\<in> r1 \\<rightarrow> injval r1 c v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s v.\n       s \\<in> deriv c r1 \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> r1 \\<rightarrow> injval r1 c v", "by fact"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r1 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r1 \\<rightarrow> injval r1 c ?v\n\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have IH2: \"\\<And>s v. s \\<in> deriv c r2 \\<rightarrow> v \\<Longrightarrow> (c # s) \\<in> r2 \\<rightarrow> injval r2 c v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s v.\n       s \\<in> deriv c r2 \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> r2 \\<rightarrow> injval r2 c v", "by fact"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r2 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r2 \\<rightarrow> injval r2 c ?v\n\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have \"s \\<in> deriv c (Plus r1 r2) \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c (Plus r1 r2) \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c (Plus r1 r2) \\<rightarrow> v\n\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c (Plus r1 r2) \\<rightarrow> v", "have \"s \\<in> Plus (deriv c r1) (deriv c r2) \\<rightarrow> v\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c (Plus r1 r2) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. s \\<in> Plus (deriv c r1) (deriv c r2) \\<rightarrow> v", "by simp"], ["proof (state)\nthis:\n  s \\<in> Plus (deriv c r1) (deriv c r2) \\<rightarrow> v\n\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> Plus (deriv c r1) (deriv c r2) \\<rightarrow> v", "consider (left) v' where \"v = Left v'\" \"s \\<in> deriv c r1 \\<rightarrow> v'\" \n              | (right) v' where \"v = Right v'\" \"s \\<notin> lang (deriv c r1)\" \"s \\<in> deriv c r2 \\<rightarrow> v'\""], ["proof (prove)\nusing this:\n  s \\<in> Plus (deriv c r1) (deriv c r2) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>v'.\n                \\<lbrakk>v = val.Left v';\n                 s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n                \\<Longrightarrow> thesis;\n     \\<And>v'.\n        \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n         s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n        \\<Longrightarrow> thesis\\<rbrakk>\n    \\<Longrightarrow> thesis", "by cases auto"], ["proof (state)\nthis:\n  \\<lbrakk>\\<And>v'.\n              \\<lbrakk>v = val.Left v';\n               s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n              \\<Longrightarrow> ?thesis;\n   \\<And>v'.\n      \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n       s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (3 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Plus x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus x1\n                                    x2 \\<rightarrow> injval (Plus x1 x2) c v\n 2. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 3. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  \\<lbrakk>\\<And>v'.\n              \\<lbrakk>v = val.Left v';\n               s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n              \\<Longrightarrow> ?thesis;\n   \\<And>v'.\n      \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n       s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis", "show \"(c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v\""], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>v'.\n              \\<lbrakk>v = val.Left v';\n               s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n              \\<Longrightarrow> ?thesis;\n   \\<And>v'.\n      \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n       s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v", "proof (cases)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Left v';\n        s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v\n 2. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "case left"], ["proof (state)\nthis:\n  v = val.Left v'\n  s \\<in> deriv c r1 \\<rightarrow> v'\n\ngoal (2 subgoals):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Left v';\n        s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v\n 2. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "have \"s \\<in> deriv c r1 \\<rightarrow> v'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c r1 \\<rightarrow> v'", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c r1 \\<rightarrow> v'\n\ngoal (2 subgoals):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Left v';\n        s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v\n 2. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c r1 \\<rightarrow> v'", "have \"(c # s) \\<in> r1 \\<rightarrow> injval r1 c v'\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c r1 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> r1 \\<rightarrow> injval r1 c v'", "using IH1"], ["proof (prove)\nusing this:\n  s \\<in> deriv c r1 \\<rightarrow> v'\n  ?s \\<in> deriv c r1 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r1 \\<rightarrow> injval r1 c ?v\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> r1 \\<rightarrow> injval r1 c v'", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> r1 \\<rightarrow> injval r1 c v'\n\ngoal (2 subgoals):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Left v';\n        s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v\n 2. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "then"], ["proof (chain)\npicking this:\n  (c # s) \\<in> r1 \\<rightarrow> injval r1 c v'", "have \"(c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (Left v')\""], ["proof (prove)\nusing this:\n  (c # s) \\<in> r1 \\<rightarrow> injval r1 c v'\n\ngoal (1 subgoal):\n 1. (c #\n     s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Left v')", "by (auto intro: Posix.intros)"], ["proof (state)\nthis:\n  (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Left v')\n\ngoal (2 subgoals):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Left v';\n        s \\<in> deriv c r1 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v\n 2. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "then"], ["proof (chain)\npicking this:\n  (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Left v')", "show \"(c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v\""], ["proof (prove)\nusing this:\n  (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Left v')\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v", "using left"], ["proof (prove)\nusing this:\n  (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Left v')\n  v = val.Left v'\n  s \\<in> deriv c r1 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "case right"], ["proof (state)\nthis:\n  v = val.Right v'\n  s \\<notin> lang (deriv c r1)\n  s \\<in> deriv c r2 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "have \"s \\<notin> lang (deriv c r1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<notin> lang (deriv c r1)", "by fact"], ["proof (state)\nthis:\n  s \\<notin> lang (deriv c r1)\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "then"], ["proof (chain)\npicking this:\n  s \\<notin> lang (deriv c r1)", "have \"c # s \\<notin> lang r1\""], ["proof (prove)\nusing this:\n  s \\<notin> lang (deriv c r1)\n\ngoal (1 subgoal):\n 1. c # s \\<notin> lang r1", "by (simp add: lang_deriv Deriv_def)"], ["proof (state)\nthis:\n  c # s \\<notin> lang r1\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "moreover"], ["proof (state)\nthis:\n  c # s \\<notin> lang r1\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "have \"s \\<in> deriv c r2 \\<rightarrow> v'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c r2 \\<rightarrow> v'", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c r2 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c r2 \\<rightarrow> v'", "have \"(c # s) \\<in> r2 \\<rightarrow> injval r2 c v'\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c r2 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> r2 \\<rightarrow> injval r2 c v'", "using IH2"], ["proof (prove)\nusing this:\n  s \\<in> deriv c r2 \\<rightarrow> v'\n  ?s \\<in> deriv c r2 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r2 \\<rightarrow> injval r2 c ?v\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> r2 \\<rightarrow> injval r2 c v'", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> r2 \\<rightarrow> injval r2 c v'\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "ultimately"], ["proof (chain)\npicking this:\n  c # s \\<notin> lang r1\n  (c # s) \\<in> r2 \\<rightarrow> injval r2 c v'", "have \"(c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (Right v')\""], ["proof (prove)\nusing this:\n  c # s \\<notin> lang r1\n  (c # s) \\<in> r2 \\<rightarrow> injval r2 c v'\n\ngoal (1 subgoal):\n 1. (c #\n     s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Right v')", "by (auto intro: Posix.intros)"], ["proof (state)\nthis:\n  (c #\n   s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Right v')\n\ngoal (1 subgoal):\n 1. \\<And>v'.\n       \\<lbrakk>v = val.Right v'; s \\<notin> lang (deriv c r1);\n        s \\<in> deriv c r2 \\<rightarrow> v'\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Plus r1\n                                    r2 \\<rightarrow> injval (Plus r1 r2) c v", "then"], ["proof (chain)\npicking this:\n  (c #\n   s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Right v')", "show \"(c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v\""], ["proof (prove)\nusing this:\n  (c #\n   s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Right v')\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v", "using right"], ["proof (prove)\nusing this:\n  (c #\n   s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c (val.Right v')\n  v = val.Right v'\n  s \\<notin> lang (deriv c r1)\n  s \\<in> deriv c r2 \\<rightarrow> v'\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (c # s) \\<in> Plus r1 r2 \\<rightarrow> injval (Plus r1 r2) c v\n\ngoal (2 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 2. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 2. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "case (Times r1 r2)"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r1 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r1 \\<rightarrow> injval r1 c ?v\n  ?s \\<in> deriv c r2 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r2 \\<rightarrow> injval r2 c ?v\n  s \\<in> deriv c (Times r1 r2) \\<rightarrow> v\n\ngoal (2 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 2. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have IH1: \"\\<And>s v. s \\<in> deriv c r1 \\<rightarrow> v \\<Longrightarrow> (c # s) \\<in> r1 \\<rightarrow> injval r1 c v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s v.\n       s \\<in> deriv c r1 \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> r1 \\<rightarrow> injval r1 c v", "by fact"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r1 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r1 \\<rightarrow> injval r1 c ?v\n\ngoal (2 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 2. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have IH2: \"\\<And>s v. s \\<in> deriv c r2 \\<rightarrow> v \\<Longrightarrow> (c # s) \\<in> r2 \\<rightarrow> injval r2 c v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s v.\n       s \\<in> deriv c r2 \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> r2 \\<rightarrow> injval r2 c v", "by fact"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r2 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r2 \\<rightarrow> injval r2 c ?v\n\ngoal (2 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 2. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have \"s \\<in> deriv c (Times r1 r2) \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c (Times r1 r2) \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c (Times r1 r2) \\<rightarrow> v\n\ngoal (2 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 2. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c (Times r1 r2) \\<rightarrow> v", "consider \n        (left_nullable) v1 v2 s1 s2 where \n        \"v = Left (Seq v1 v2)\"  \"s = s1 @ s2\" \n        \"s1 \\<in> deriv c r1 \\<rightarrow> v1\" \"s2 \\<in> r2 \\<rightarrow> v2\" \"nullable r1\" \n        \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2)\"\n      | (right_nullable) v1 s1 s2 where \n        \"v = Right v1\" \"s = s1 @ s2\"  \n        \"s \\<in> deriv c r2 \\<rightarrow> v1\" \"nullable r1\" \"s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\"\n      | (not_nullable) v1 v2 s1 s2 where\n        \"v = Seq v1 v2\" \"s = s1 @ s2\" \n        \"s1 \\<in> deriv c r1 \\<rightarrow> v1\" \"s2 \\<in> r2 \\<rightarrow> v2\" \"\\<not>nullable r1\" \n        \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2)\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c (Times r1 r2) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>v1 v2 s1 s2.\n                \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n                 s1 \\<in> deriv c r1 \\<rightarrow> v1;\n                 s2 \\<in> r2 \\<rightarrow> v2; nullable r1;\n                 \\<nexists>s\\<^sub>3 s\\<^sub>4.\n                    s\\<^sub>3 \\<noteq> [] \\<and>\n                    s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n                    s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n                    s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n                \\<Longrightarrow> thesis;\n     \\<And>v1 s1 s2.\n        \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n         s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n         s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n        \\<Longrightarrow> thesis;\n     \\<And>v1 v2 s1 s2.\n        \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n         s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n         \\<not> nullable r1;\n         \\<nexists>s\\<^sub>3 s\\<^sub>4.\n            s\\<^sub>3 \\<noteq> [] \\<and>\n            s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n            s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n            s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n        \\<Longrightarrow> thesis\\<rbrakk>\n    \\<Longrightarrow> thesis", "by (force split: if_splits elim!: Posix_elims simp add: lang_deriv Deriv_def)"], ["proof (state)\nthis:\n  \\<lbrakk>\\<And>v1 v2 s1 s2.\n              \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n               s1 \\<in> deriv c r1 \\<rightarrow> v1;\n               s2 \\<in> r2 \\<rightarrow> v2; nullable r1;\n               \\<nexists>s\\<^sub>3 s\\<^sub>4.\n                  s\\<^sub>3 \\<noteq> [] \\<and>\n                  s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n                  s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n                  s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n              \\<Longrightarrow> ?thesis;\n   \\<And>v1 s1 s2.\n      \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n       s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n       s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n      \\<Longrightarrow> ?thesis;\n   \\<And>v1 v2 s1 s2.\n      \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n       s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n       \\<not> nullable r1;\n       \\<nexists>s\\<^sub>3 s\\<^sub>4.\n          s\\<^sub>3 \\<noteq> [] \\<and>\n          s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n          s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n          s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (2 subgoals):\n 1. \\<And>x1 x2 s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x1 \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x1 \\<rightarrow> injval x1 c v;\n        \\<And>s v.\n           s \\<in> deriv c x2 \\<rightarrow> v \\<Longrightarrow>\n           (c # s) \\<in> x2 \\<rightarrow> injval x2 c v;\n        s \\<in> deriv c (Times x1 x2) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times x1\n                                    x2 \\<rightarrow> injval (Times x1 x2) c\n                v\n 2. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  \\<lbrakk>\\<And>v1 v2 s1 s2.\n              \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n               s1 \\<in> deriv c r1 \\<rightarrow> v1;\n               s2 \\<in> r2 \\<rightarrow> v2; nullable r1;\n               \\<nexists>s\\<^sub>3 s\\<^sub>4.\n                  s\\<^sub>3 \\<noteq> [] \\<and>\n                  s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n                  s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n                  s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n              \\<Longrightarrow> ?thesis;\n   \\<And>v1 s1 s2.\n      \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n       s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n       s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n      \\<Longrightarrow> ?thesis;\n   \\<And>v1 v2 s1 s2.\n      \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n       s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n       \\<not> nullable r1;\n       \\<nexists>s\\<^sub>3 s\\<^sub>4.\n          s\\<^sub>3 \\<noteq> [] \\<and>\n          s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n          s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n          s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis", "show \"(c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\""], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>v1 v2 s1 s2.\n              \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n               s1 \\<in> deriv c r1 \\<rightarrow> v1;\n               s2 \\<in> r2 \\<rightarrow> v2; nullable r1;\n               \\<nexists>s\\<^sub>3 s\\<^sub>4.\n                  s\\<^sub>3 \\<noteq> [] \\<and>\n                  s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n                  s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n                  s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n              \\<Longrightarrow> ?thesis;\n   \\<And>v1 s1 s2.\n      \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n       s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n       s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n      \\<Longrightarrow> ?thesis;\n   \\<And>v1 v2 s1 s2.\n      \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n       s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n       \\<not> nullable r1;\n       \\<nexists>s\\<^sub>3 s\\<^sub>4.\n          s\\<^sub>3 \\<noteq> [] \\<and>\n          s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n          s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n          s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v", "proof (cases)"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "case left_nullable"], ["proof (state)\nthis:\n  v = val.Left (Seq v1 v2)\n  s = s1 @ s2\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  nullable r1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "have \"s1 \\<in> deriv c r1 \\<rightarrow> v1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s1 \\<in> deriv c r1 \\<rightarrow> v1", "by fact"], ["proof (state)\nthis:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1", "have \"(c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\""], ["proof (prove)\nusing this:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n\ngoal (1 subgoal):\n 1. (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1", "using IH1"], ["proof (prove)\nusing this:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  ?s \\<in> deriv c r1 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r1 \\<rightarrow> injval r1 c ?v\n\ngoal (1 subgoal):\n 1. (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1", "by simp"], ["proof (state)\nthis:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "moreover"], ["proof (state)\nthis:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "have \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2", "by fact"], ["proof (state)\nthis:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2", "have \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2)\""], ["proof (prove)\nusing this:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "by (simp add: lang_deriv Deriv_def)"], ["proof (state)\nthis:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "ultimately"], ["proof (chain)\npicking this:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "have \"((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\""], ["proof (prove)\nusing this:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2", "using left_nullable"], ["proof (prove)\nusing this:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n  v = val.Left (Seq v1 v2)\n  s = s1 @ s2\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  nullable r1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2", "by (rule_tac Posix.intros)"], ["proof (state)\nthis:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\n\ngoal (3 subgoals):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = val.Left (Seq v1 v2); s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 3. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2", "show \"(c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\""], ["proof (prove)\nusing this:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v", "using left_nullable"], ["proof (prove)\nusing this:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\n  v = val.Left (Seq v1 v2)\n  s = s1 @ s2\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  nullable r1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "case right_nullable"], ["proof (state)\nthis:\n  v = val.Right v1\n  s = s1 @ s2\n  s \\<in> deriv c r2 \\<rightarrow> v1\n  nullable r1\n  s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "have \"nullable r1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. nullable r1", "by fact"], ["proof (state)\nthis:\n  nullable r1\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  nullable r1", "have \"[] \\<in> r1 \\<rightarrow> (mkeps r1)\""], ["proof (prove)\nusing this:\n  nullable r1\n\ngoal (1 subgoal):\n 1. [] \\<in> r1 \\<rightarrow> mkeps r1", "by (rule Posix_mkeps)"], ["proof (state)\nthis:\n  [] \\<in> r1 \\<rightarrow> mkeps r1\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "moreover"], ["proof (state)\nthis:\n  [] \\<in> r1 \\<rightarrow> mkeps r1\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "have \"s \\<in> deriv c r2 \\<rightarrow> v1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c r2 \\<rightarrow> v1", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c r2 \\<rightarrow> v1\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c r2 \\<rightarrow> v1", "have \"(c # s) \\<in> r2 \\<rightarrow> (injval r2 c v1)\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c r2 \\<rightarrow> v1\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> r2 \\<rightarrow> injval r2 c v1", "using IH2"], ["proof (prove)\nusing this:\n  s \\<in> deriv c r2 \\<rightarrow> v1\n  ?s \\<in> deriv c r2 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r2 \\<rightarrow> injval r2 c ?v\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> r2 \\<rightarrow> injval r2 c v1", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> r2 \\<rightarrow> injval r2 c v1\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "moreover"], ["proof (state)\nthis:\n  (c # s) \\<in> r2 \\<rightarrow> injval r2 c v1\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "have \"s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)", "by fact"], ["proof (state)\nthis:\n  s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)", "have \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = c # s \\<and> [] @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2)\""], ["proof (prove)\nusing this:\n  s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\n\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = c # s \\<and>\n       [] @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "using right_nullable"], ["proof (prove)\nusing this:\n  s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\n  v = val.Right v1\n  s = s1 @ s2\n  s \\<in> deriv c r2 \\<rightarrow> v1\n  nullable r1\n  s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\n\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = c # s \\<and>\n       [] @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "apply (auto simp add: lang_deriv Deriv_def append_eq_Cons_conv)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s\\<^sub>4 ys'.\n       \\<lbrakk>s1 @ s2 \\<notin> {xs. c # xs \\<in> lang r1} @@ lang r2;\n        v = val.Right v1; s = s1 @ s2;\n        (s1 @ s2) \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        c # ys' \\<in> lang r1; s\\<^sub>4 \\<in> lang r2;\n        ys' @ s\\<^sub>4 = s1 @ s2\\<rbrakk>\n       \\<Longrightarrow> False", "by (metis concI mem_Collect_eq)"], ["proof (state)\nthis:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = c # s \\<and>\n     [] @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "ultimately"], ["proof (chain)\npicking this:\n  [] \\<in> r1 \\<rightarrow> mkeps r1\n  (c # s) \\<in> r2 \\<rightarrow> injval r2 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = c # s \\<and>\n     [] @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "have \"([] @ (c # s)) \\<in> Times r1 r2 \\<rightarrow> Seq (mkeps r1) (injval r2 c v1)\""], ["proof (prove)\nusing this:\n  [] \\<in> r1 \\<rightarrow> mkeps r1\n  (c # s) \\<in> r2 \\<rightarrow> injval r2 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = c # s \\<and>\n     [] @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. ([] @\n     c # s) \\<in> Times r1 r2 \\<rightarrow> Seq (mkeps r1) (injval r2 c v1)", "by(rule Posix.intros)"], ["proof (state)\nthis:\n  ([] @\n   c # s) \\<in> Times r1 r2 \\<rightarrow> Seq (mkeps r1) (injval r2 c v1)\n\ngoal (2 subgoals):\n 1. \\<And>v1 s1 s2.\n       \\<lbrakk>v = val.Right v1; s = s1 @ s2;\n        s \\<in> deriv c r2 \\<rightarrow> v1; nullable r1;\n        s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v\n 2. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  ([] @\n   c # s) \\<in> Times r1 r2 \\<rightarrow> Seq (mkeps r1) (injval r2 c v1)", "show \"(c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\""], ["proof (prove)\nusing this:\n  ([] @\n   c # s) \\<in> Times r1 r2 \\<rightarrow> Seq (mkeps r1) (injval r2 c v1)\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v", "using right_nullable"], ["proof (prove)\nusing this:\n  ([] @\n   c # s) \\<in> Times r1 r2 \\<rightarrow> Seq (mkeps r1) (injval r2 c v1)\n  v = val.Right v1\n  s = s1 @ s2\n  s \\<in> deriv c r2 \\<rightarrow> v1\n  nullable r1\n  s1 @ s2 \\<notin> lang (Times (deriv c r1) r2)\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "case not_nullable"], ["proof (state)\nthis:\n  v = Seq v1 v2\n  s = s1 @ s2\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  \\<not> nullable r1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "have \"s1 \\<in> deriv c r1 \\<rightarrow> v1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s1 \\<in> deriv c r1 \\<rightarrow> v1", "by fact"], ["proof (state)\nthis:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1", "have \"(c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\""], ["proof (prove)\nusing this:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n\ngoal (1 subgoal):\n 1. (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1", "using IH1"], ["proof (prove)\nusing this:\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  ?s \\<in> deriv c r1 \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r1 \\<rightarrow> injval r1 c ?v\n\ngoal (1 subgoal):\n 1. (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1", "by simp"], ["proof (state)\nthis:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "moreover"], ["proof (state)\nthis:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "have \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2", "by fact"], ["proof (state)\nthis:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2", "have \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2)\""], ["proof (prove)\nusing this:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "by (simp add: lang_deriv Deriv_def)"], ["proof (state)\nthis:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "ultimately"], ["proof (chain)\npicking this:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2", "have \"((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\""], ["proof (prove)\nusing this:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2", "using not_nullable"], ["proof (prove)\nusing this:\n  (c # s1) \\<in> r1 \\<rightarrow> injval r1 c v1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r1 \\<and> s\\<^sub>4 \\<in> lang r2\n  v = Seq v1 v2\n  s = s1 @ s2\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  \\<not> nullable r1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2", "by (rule_tac Posix.intros) (simp_all)"], ["proof (state)\nthis:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\n\ngoal (1 subgoal):\n 1. \\<And>v1 v2 s1 s2.\n       \\<lbrakk>v = Seq v1 v2; s = s1 @ s2;\n        s1 \\<in> deriv c r1 \\<rightarrow> v1; s2 \\<in> r2 \\<rightarrow> v2;\n        \\<not> nullable r1;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and>\n           s\\<^sub>4 \\<in> lang r2\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Times r1\n                                    r2 \\<rightarrow> injval (Times r1 r2) c\n                v", "then"], ["proof (chain)\npicking this:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2", "show \"(c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\""], ["proof (prove)\nusing this:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v", "using not_nullable"], ["proof (prove)\nusing this:\n  ((c # s1) @ s2) \\<in> Times r1 r2 \\<rightarrow> Seq (injval r1 c v1) v2\n  v = Seq v1 v2\n  s = s1 @ s2\n  s1 \\<in> deriv c r1 \\<rightarrow> v1\n  s2 \\<in> r2 \\<rightarrow> v2\n  \\<not> nullable r1\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r1) \\<and> s\\<^sub>4 \\<in> lang r2\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v", "by simp"], ["proof (state)\nthis:\n  (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (c # s) \\<in> Times r1 r2 \\<rightarrow> injval (Times r1 r2) c v\n\ngoal (1 subgoal):\n 1. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "case (Star r)"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r \\<rightarrow> injval r c ?v\n  s \\<in> deriv c (Star r) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have IH: \"\\<And>s v. s \\<in> deriv c r \\<rightarrow> v \\<Longrightarrow> (c # s) \\<in> r \\<rightarrow> injval r c v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s v.\n       s \\<in> deriv c r \\<rightarrow> v \\<Longrightarrow>\n       (c # s) \\<in> r \\<rightarrow> injval r c v", "by fact"], ["proof (state)\nthis:\n  ?s \\<in> deriv c r \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r \\<rightarrow> injval r c ?v\n\ngoal (1 subgoal):\n 1. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "have \"s \\<in> deriv c (Star r) \\<rightarrow> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s \\<in> deriv c (Star r) \\<rightarrow> v", "by fact"], ["proof (state)\nthis:\n  s \\<in> deriv c (Star r) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  s \\<in> deriv c (Star r) \\<rightarrow> v", "consider\n      (cons) v1 vs s1 s2 where \n        \"v = Seq v1 (Stars vs)\" \"s = s1 @ s2\" \n        \"s1 \\<in> deriv c r \\<rightarrow> v1\" \"s2 \\<in> (Star r) \\<rightarrow> (Stars vs)\"\n        \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and> s\\<^sub>4 \\<in> lang (Star r))\""], ["proof (prove)\nusing this:\n  s \\<in> deriv c (Star r) \\<rightarrow> v\n\ngoal (1 subgoal):\n 1. (\\<And>v1 vs s1 s2.\n        \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n         s1 \\<in> deriv c r \\<rightarrow> v1;\n         s2 \\<in> Star r \\<rightarrow> Stars vs;\n         \\<nexists>s\\<^sub>3 s\\<^sub>4.\n            s\\<^sub>3 \\<noteq> [] \\<and>\n            s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n            s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n            s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "apply(auto elim!: Posix_elims(1-5) simp add: lang_deriv Deriv_def intro: Posix.intros)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s1 v1 s2 v2.\n       \\<lbrakk>\\<And>vs s1a s2a.\n                   \\<lbrakk>v2 = Stars vs; s1 @ s2 = s1a @ s2a;\n                    s1a \\<in> deriv c r \\<rightarrow> v1;\n                    s2a \\<in> Star r \\<rightarrow> Stars vs;\n                    \\<forall>s\\<^sub>3.\n                       c # s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n                       s\\<^sub>3 = [] \\<or>\n                       (\\<forall>s\\<^sub>4.\n                           s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n                           s\\<^sub>4 \\<notin> star (lang r))\\<rbrakk>\n                   \\<Longrightarrow> thesis;\n        v = Seq v1 v2; s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           c # s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        s = s1 @ s2\\<rbrakk>\n       \\<Longrightarrow> thesis", "apply(rotate_tac 3)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s1 v1 s2 v2.\n       \\<lbrakk>s2 \\<in> Star r \\<rightarrow> v2;\n        \\<forall>s\\<^sub>3.\n           c # s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r));\n        s = s1 @ s2;\n        \\<And>vs s1a s2a.\n           \\<lbrakk>v2 = Stars vs; s1 @ s2 = s1a @ s2a;\n            s1a \\<in> deriv c r \\<rightarrow> v1;\n            s2a \\<in> Star r \\<rightarrow> Stars vs;\n            \\<forall>s\\<^sub>3.\n               c # s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n               s\\<^sub>3 = [] \\<or>\n               (\\<forall>s\\<^sub>4.\n                   s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n                   s\\<^sub>4 \\<notin> star (lang r))\\<rbrakk>\n           \\<Longrightarrow> thesis;\n        v = Seq v1 v2; s1 \\<in> deriv c r \\<rightarrow> v1\\<rbrakk>\n       \\<Longrightarrow> thesis", "apply(erule_tac Posix_elims(6))"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s1 v1 s2 v2 s1a v s2a vs.\n       \\<lbrakk>\\<forall>s\\<^sub>3.\n                   c # s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n                   s\\<^sub>3 = [] \\<or>\n                   (\\<forall>s\\<^sub>4.\n                       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n                       s\\<^sub>4 \\<notin> star (lang r));\n        s = s1 @ s2;\n        \\<And>vs s1a s2a.\n           \\<lbrakk>v2 = Stars vs; s1 @ s2 = s1a @ s2a;\n            s1a \\<in> deriv c r \\<rightarrow> v1;\n            s2a \\<in> Star r \\<rightarrow> Stars vs;\n            \\<forall>s\\<^sub>3.\n               c # s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n               s\\<^sub>3 = [] \\<or>\n               (\\<forall>s\\<^sub>4.\n                   s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n                   s\\<^sub>4 \\<notin> star (lang r))\\<rbrakk>\n           \\<Longrightarrow> thesis;\n        v = Seq v1 v2; s1 \\<in> deriv c r \\<rightarrow> v1; s2 = s1a @ s2a;\n        v2 = Stars (v # vs); s1a \\<in> r \\<rightarrow> v;\n        s2a \\<in> Star r \\<rightarrow> Stars vs; flat v \\<noteq> [];\n        \\<forall>s\\<^sub>3.\n           s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n           s\\<^sub>3 = [] \\<or>\n           (\\<forall>s\\<^sub>4.\n               s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n               s\\<^sub>4 \\<notin> star (lang r))\\<rbrakk>\n       \\<Longrightarrow> thesis\n 2. \\<And>s1 v1 s2 v2.\n       \\<lbrakk>\\<forall>s\\<^sub>3.\n                   c # s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n                   s\\<^sub>3 = [] \\<or>\n                   (\\<forall>s\\<^sub>4.\n                       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n                       s\\<^sub>4 \\<notin> star (lang r));\n        s = s1 @ s2;\n        \\<And>vs s1a s2a.\n           \\<lbrakk>v2 = Stars vs; s1 @ s2 = s1a @ s2a;\n            s1a \\<in> deriv c r \\<rightarrow> v1;\n            s2a \\<in> Star r \\<rightarrow> Stars vs;\n            \\<forall>s\\<^sub>3.\n               c # s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n               s\\<^sub>3 = [] \\<or>\n               (\\<forall>s\\<^sub>4.\n                   s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n                   s\\<^sub>4 \\<notin> star (lang r))\\<rbrakk>\n           \\<Longrightarrow> thesis;\n        v = Seq v1 v2; s1 \\<in> deriv c r \\<rightarrow> v1; s2 = [];\n        v2 = Stars []\\<rbrakk>\n       \\<Longrightarrow> thesis", "apply (simp add: Posix.intros(6))"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s1 v1 s2 v2.\n       \\<lbrakk>\\<forall>s\\<^sub>3.\n                   c # s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n                   s\\<^sub>3 = [] \\<or>\n                   (\\<forall>s\\<^sub>4.\n                       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n                       s\\<^sub>4 \\<notin> star (lang r));\n        s = s1 @ s2;\n        \\<And>vs s1a s2a.\n           \\<lbrakk>v2 = Stars vs; s1 @ s2 = s1a @ s2a;\n            s1a \\<in> deriv c r \\<rightarrow> v1;\n            s2a \\<in> Star r \\<rightarrow> Stars vs;\n            \\<forall>s\\<^sub>3.\n               c # s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n               s\\<^sub>3 = [] \\<or>\n               (\\<forall>s\\<^sub>4.\n                   s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n                   s\\<^sub>4 \\<notin> star (lang r))\\<rbrakk>\n           \\<Longrightarrow> thesis;\n        v = Seq v1 v2; s1 \\<in> deriv c r \\<rightarrow> v1; s2 = [];\n        v2 = Stars []\\<rbrakk>\n       \\<Longrightarrow> thesis", "using Posix.intros(7)"], ["proof (prove)\nusing this:\n  [] \\<in> Star ?r \\<rightarrow> Stars []\n\ngoal (1 subgoal):\n 1. \\<And>s1 v1 s2 v2.\n       \\<lbrakk>\\<forall>s\\<^sub>3.\n                   c # s1 @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n                   s\\<^sub>3 = [] \\<or>\n                   (\\<forall>s\\<^sub>4.\n                       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<longrightarrow>\n                       s\\<^sub>4 \\<notin> star (lang r));\n        s = s1 @ s2;\n        \\<And>vs s1a s2a.\n           \\<lbrakk>v2 = Stars vs; s1 @ s2 = s1a @ s2a;\n            s1a \\<in> deriv c r \\<rightarrow> v1;\n            s2a \\<in> Star r \\<rightarrow> Stars vs;\n            \\<forall>s\\<^sub>3.\n               c # s1a @ s\\<^sub>3 \\<in> lang r \\<longrightarrow>\n               s\\<^sub>3 = [] \\<or>\n               (\\<forall>s\\<^sub>4.\n                   s\\<^sub>3 @ s\\<^sub>4 = s2a \\<longrightarrow>\n                   s\\<^sub>4 \\<notin> star (lang r))\\<rbrakk>\n           \\<Longrightarrow> thesis;\n        v = Seq v1 v2; s1 \\<in> deriv c r \\<rightarrow> v1; s2 = [];\n        v2 = Stars []\\<rbrakk>\n       \\<Longrightarrow> thesis", "by blast"], ["proof (state)\nthis:\n  (\\<And>v1 vs s1 s2.\n      \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n       s1 \\<in> deriv c r \\<rightarrow> v1;\n       s2 \\<in> Star r \\<rightarrow> Stars vs;\n       \\<nexists>s\\<^sub>3 s\\<^sub>4.\n          s\\<^sub>3 \\<noteq> [] \\<and>\n          s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n          s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n          s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n      \\<Longrightarrow> ?thesis) \\<Longrightarrow>\n  ?thesis\n\ngoal (1 subgoal):\n 1. \\<And>x s v.\n       \\<lbrakk>\\<And>s v.\n                   s \\<in> deriv c x \\<rightarrow> v \\<Longrightarrow>\n                   (c # s) \\<in> x \\<rightarrow> injval x c v;\n        s \\<in> deriv c (Star x) \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star x \\<rightarrow> injval (Star x) c v", "then"], ["proof (chain)\npicking this:\n  (\\<And>v1 vs s1 s2.\n      \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n       s1 \\<in> deriv c r \\<rightarrow> v1;\n       s2 \\<in> Star r \\<rightarrow> Stars vs;\n       \\<nexists>s\\<^sub>3 s\\<^sub>4.\n          s\\<^sub>3 \\<noteq> [] \\<and>\n          s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n          s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n          s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n      \\<Longrightarrow> ?thesis) \\<Longrightarrow>\n  ?thesis", "show \"(c # s) \\<in> Star r \\<rightarrow> injval (Star r) c v\""], ["proof (prove)\nusing this:\n  (\\<And>v1 vs s1 s2.\n      \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n       s1 \\<in> deriv c r \\<rightarrow> v1;\n       s2 \\<in> Star r \\<rightarrow> Stars vs;\n       \\<nexists>s\\<^sub>3 s\\<^sub>4.\n          s\\<^sub>3 \\<noteq> [] \\<and>\n          s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n          s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n          s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n      \\<Longrightarrow> ?thesis) \\<Longrightarrow>\n  ?thesis\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "proof (cases)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "case cons"], ["proof (state)\nthis:\n  v = Seq v1 (Stars vs)\n  s = s1 @ s2\n  s1 \\<in> deriv c r \\<rightarrow> v1\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n     s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "have \"s1 \\<in> deriv c r \\<rightarrow> v1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s1 \\<in> deriv c r \\<rightarrow> v1", "by fact"], ["proof (state)\nthis:\n  s1 \\<in> deriv c r \\<rightarrow> v1\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "then"], ["proof (chain)\npicking this:\n  s1 \\<in> deriv c r \\<rightarrow> v1", "have \"(c # s1) \\<in> r \\<rightarrow> injval r c v1\""], ["proof (prove)\nusing this:\n  s1 \\<in> deriv c r \\<rightarrow> v1\n\ngoal (1 subgoal):\n 1. (c # s1) \\<in> r \\<rightarrow> injval r c v1", "using IH"], ["proof (prove)\nusing this:\n  s1 \\<in> deriv c r \\<rightarrow> v1\n  ?s \\<in> deriv c r \\<rightarrow> ?v \\<Longrightarrow>\n  (c # ?s) \\<in> r \\<rightarrow> injval r c ?v\n\ngoal (1 subgoal):\n 1. (c # s1) \\<in> r \\<rightarrow> injval r c v1", "by simp"], ["proof (state)\nthis:\n  (c # s1) \\<in> r \\<rightarrow> injval r c v1\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "moreover"], ["proof (state)\nthis:\n  (c # s1) \\<in> r \\<rightarrow> injval r c v1\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "have \"s2 \\<in> Star r \\<rightarrow> Stars vs\""], ["proof (prove)\ngoal (1 subgoal):\n 1. s2 \\<in> Star r \\<rightarrow> Stars vs", "by fact"], ["proof (state)\nthis:\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "moreover"], ["proof (state)\nthis:\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "have \"(c # s1) \\<in> r \\<rightarrow> injval r c v1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (c # s1) \\<in> r \\<rightarrow> injval r c v1", "by fact"], ["proof (state)\nthis:\n  (c # s1) \\<in> r \\<rightarrow> injval r c v1\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "then"], ["proof (chain)\npicking this:\n  (c # s1) \\<in> r \\<rightarrow> injval r c v1", "have \"flat (injval r c v1) = (c # s1)\""], ["proof (prove)\nusing this:\n  (c # s1) \\<in> r \\<rightarrow> injval r c v1\n\ngoal (1 subgoal):\n 1. flat (injval r c v1) = c # s1", "by (rule Posix1)"], ["proof (state)\nthis:\n  flat (injval r c v1) = c # s1\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "then"], ["proof (chain)\npicking this:\n  flat (injval r c v1) = c # s1", "have \"flat (injval r c v1) \\<noteq> []\""], ["proof (prove)\nusing this:\n  flat (injval r c v1) = c # s1\n\ngoal (1 subgoal):\n 1. flat (injval r c v1) \\<noteq> []", "by simp"], ["proof (state)\nthis:\n  flat (injval r c v1) \\<noteq> []\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "moreover"], ["proof (state)\nthis:\n  flat (injval r c v1) \\<noteq> []\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "have \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and> s\\<^sub>4 \\<in> lang (Star r))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n       s\\<^sub>4 \\<in> lang (Star r)", "by fact"], ["proof (state)\nthis:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n     s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "then"], ["proof (chain)\npicking this:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n     s\\<^sub>4 \\<in> lang (Star r)", "have \"\\<not> (\\<exists>s\\<^sub>3 s\\<^sub>4. s\\<^sub>3 \\<noteq> [] \\<and> s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and> (c # s1) @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r))\""], ["proof (prove)\nusing this:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n     s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (1 subgoal):\n 1. \\<nexists>s\\<^sub>3 s\\<^sub>4.\n       s\\<^sub>3 \\<noteq> [] \\<and>\n       s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n       (c # s1) @ s\\<^sub>3 \\<in> lang r \\<and>\n       s\\<^sub>4 \\<in> lang (Star r)", "by (simp add: lang_deriv Deriv_def)"], ["proof (state)\nthis:\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "ultimately"], ["proof (chain)\npicking this:\n  (c # s1) \\<in> r \\<rightarrow> injval r c v1\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  flat (injval r c v1) \\<noteq> []\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)", "have \"((c # s1) @ s2) \\<in> Star r \\<rightarrow> Stars (injval r c v1 # vs)\""], ["proof (prove)\nusing this:\n  (c # s1) \\<in> r \\<rightarrow> injval r c v1\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  flat (injval r c v1) \\<noteq> []\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     (c # s1) @ s\\<^sub>3 \\<in> lang r \\<and> s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (1 subgoal):\n 1. ((c # s1) @ s2) \\<in> Star r \\<rightarrow> Stars (injval r c v1 # vs)", "by (rule Posix.intros)"], ["proof (state)\nthis:\n  ((c # s1) @ s2) \\<in> Star r \\<rightarrow> Stars (injval r c v1 # vs)\n\ngoal (1 subgoal):\n 1. \\<And>v1 vs s1 s2.\n       \\<lbrakk>v = Seq v1 (Stars vs); s = s1 @ s2;\n        s1 \\<in> deriv c r \\<rightarrow> v1;\n        s2 \\<in> Star r \\<rightarrow> Stars vs;\n        \\<nexists>s\\<^sub>3 s\\<^sub>4.\n           s\\<^sub>3 \\<noteq> [] \\<and>\n           s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n           s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n           s\\<^sub>4 \\<in> lang (Star r)\\<rbrakk>\n       \\<Longrightarrow> (c #\n                          s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "then"], ["proof (chain)\npicking this:\n  ((c # s1) @ s2) \\<in> Star r \\<rightarrow> Stars (injval r c v1 # vs)", "show \"(c # s) \\<in> Star r \\<rightarrow> injval (Star r) c v\""], ["proof (prove)\nusing this:\n  ((c # s1) @ s2) \\<in> Star r \\<rightarrow> Stars (injval r c v1 # vs)\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "using cons"], ["proof (prove)\nusing this:\n  ((c # s1) @ s2) \\<in> Star r \\<rightarrow> Stars (injval r c v1 # vs)\n  v = Seq v1 (Stars vs)\n  s = s1 @ s2\n  s1 \\<in> deriv c r \\<rightarrow> v1\n  s2 \\<in> Star r \\<rightarrow> Stars vs\n  \\<nexists>s\\<^sub>3 s\\<^sub>4.\n     s\\<^sub>3 \\<noteq> [] \\<and>\n     s\\<^sub>3 @ s\\<^sub>4 = s2 \\<and>\n     s1 @ s\\<^sub>3 \\<in> lang (deriv c r) \\<and>\n     s\\<^sub>4 \\<in> lang (Star r)\n\ngoal (1 subgoal):\n 1. (c # s) \\<in> Star r \\<rightarrow> injval (Star r) c v", "by(simp)"], ["proof (state)\nthis:\n  (c # s) \\<in> Star r \\<rightarrow> injval (Star r) c v\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (c # s) \\<in> Star r \\<rightarrow> injval (Star r) c v\n\ngoal:\nNo subgoals!", "qed"], ["", "section \\<open>The Lexer by Sulzmann and Lu\\<close>"], ["", "fun \n  lexer :: \"'a rexp \\<Rightarrow> 'a list \\<Rightarrow> ('a val) option\"\nwhere\n  \"lexer r [] = (if nullable r then Some(mkeps r) else None)\"\n| \"lexer r (c#s) = (case (lexer (deriv c r) s) of  \n                    None \\<Rightarrow> None\n                  | Some(v) \\<Rightarrow> Some(injval r c v))\""], ["", "lemma lexer_correct_None:\n  shows \"s \\<notin> lang r \\<longleftrightarrow> lexer r s = None\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (s \\<notin> lang r) = (lexer r s = None)", "apply(induct s arbitrary: r)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r. ([] \\<notin> lang r) = (lexer r [] = None)\n 2. \\<And>a s r.\n       (\\<And>r. (s \\<notin> lang r) = (lexer r s = None)) \\<Longrightarrow>\n       (a # s \\<notin> lang r) = (lexer r (a # s) = None)", "apply(simp add: nullable_iff)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a s r.\n       (\\<And>r. (s \\<notin> lang r) = (lexer r s = None)) \\<Longrightarrow>\n       (a # s \\<notin> lang r) = (lexer r (a # s) = None)", "apply(drule_tac x=\"deriv a r\" in meta_spec)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a s r.\n       (s \\<notin> lang (deriv a r)) =\n       (lexer (deriv a r) s = None) \\<Longrightarrow>\n       (a # s \\<notin> lang r) = (lexer r (a # s) = None)", "apply(auto simp add: lang_deriv Deriv_def)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma lexer_correct_Some:\n  shows \"s \\<in> lang r \\<longleftrightarrow> (\\<exists>v. lexer r s = Some(v) \\<and> s \\<in> r \\<rightarrow> v)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (s \\<in> lang r) =\n    (\\<exists>v. lexer r s = Some v \\<and> s \\<in> r \\<rightarrow> v)", "apply(induct s arbitrary: r)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>r.\n       ([] \\<in> lang r) =\n       (\\<exists>v. lexer r [] = Some v \\<and> [] \\<in> r \\<rightarrow> v)\n 2. \\<And>a s r.\n       (\\<And>r.\n           (s \\<in> lang r) =\n           (\\<exists>v.\n               lexer r s = Some v \\<and>\n               s \\<in> r \\<rightarrow> v)) \\<Longrightarrow>\n       (a # s \\<in> lang r) =\n       (\\<exists>v.\n           lexer r (a # s) = Some v \\<and> (a # s) \\<in> r \\<rightarrow> v)", "apply(auto simp add: Posix_mkeps nullable_iff)[1]"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a s r.\n       (\\<And>r.\n           (s \\<in> lang r) =\n           (\\<exists>v.\n               lexer r s = Some v \\<and>\n               s \\<in> r \\<rightarrow> v)) \\<Longrightarrow>\n       (a # s \\<in> lang r) =\n       (\\<exists>v.\n           lexer r (a # s) = Some v \\<and> (a # s) \\<in> r \\<rightarrow> v)", "apply(drule_tac x=\"deriv a r\" in meta_spec)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a s r.\n       (s \\<in> lang (deriv a r)) =\n       (\\<exists>v.\n           lexer (deriv a r) s = Some v \\<and>\n           s \\<in> deriv a r \\<rightarrow> v) \\<Longrightarrow>\n       (a # s \\<in> lang r) =\n       (\\<exists>v.\n           lexer r (a # s) = Some v \\<and> (a # s) \\<in> r \\<rightarrow> v)", "apply(simp add: lang_deriv Deriv_def)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a s r.\n       (a # s \\<in> lang r) =\n       (\\<exists>v.\n           lexer (deriv a r) s = Some v \\<and>\n           s \\<in> deriv a r \\<rightarrow> v) \\<Longrightarrow>\n       (\\<exists>v.\n           lexer (deriv a r) s = Some v \\<and>\n           s \\<in> deriv a r \\<rightarrow> v) =\n       (\\<exists>v.\n           (case lexer (deriv a r) s of None \\<Rightarrow> None\n            | Some v \\<Rightarrow> Some (injval r a v)) =\n           Some v \\<and>\n           (a # s) \\<in> r \\<rightarrow> v)", "apply(rule iffI)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a s r.\n       \\<lbrakk>(a # s \\<in> lang r) =\n                (\\<exists>v.\n                    lexer (deriv a r) s = Some v \\<and>\n                    s \\<in> deriv a r \\<rightarrow> v);\n        \\<exists>v.\n           lexer (deriv a r) s = Some v \\<and>\n           s \\<in> deriv a r \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            (case lexer (deriv a r) s of\n                             None \\<Rightarrow> None\n                             | Some v \\<Rightarrow> Some (injval r a v)) =\n                            Some v \\<and>\n                            (a # s) \\<in> r \\<rightarrow> v\n 2. \\<And>a s r.\n       \\<lbrakk>(a # s \\<in> lang r) =\n                (\\<exists>v.\n                    lexer (deriv a r) s = Some v \\<and>\n                    s \\<in> deriv a r \\<rightarrow> v);\n        \\<exists>v.\n           (case lexer (deriv a r) s of None \\<Rightarrow> None\n            | Some v \\<Rightarrow> Some (injval r a v)) =\n           Some v \\<and>\n           (a # s) \\<in> r \\<rightarrow> v\\<rbrakk>\n       \\<Longrightarrow> \\<exists>v.\n                            lexer (deriv a r) s = Some v \\<and>\n                            s \\<in> deriv a r \\<rightarrow> v", "apply(auto intro: Posix_injval simp add: Posix1(1))"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma lexer_correctness:\n  shows \"(lexer r s = Some v) \\<longleftrightarrow> s \\<in> r \\<rightarrow> v\"\n  and   \"(lexer r s = None) \\<longleftrightarrow> \\<not>(\\<exists>v. s \\<in> r \\<rightarrow> v)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (lexer r s = Some v) = s \\<in> r \\<rightarrow> v &&&\n    (lexer r s = None) = (\\<nexists>v. s \\<in> r \\<rightarrow> v)", "apply(auto)"], ["proof (prove)\ngoal (4 subgoals):\n 1. lexer r s = Some v \\<Longrightarrow> s \\<in> r \\<rightarrow> v\n 2. s \\<in> r \\<rightarrow> v \\<Longrightarrow> lexer r s = Some v\n 3. \\<And>x.\n       \\<lbrakk>lexer r s = None; s \\<in> r \\<rightarrow> x\\<rbrakk>\n       \\<Longrightarrow> False\n 4. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "using lexer_correct_None lexer_correct_Some"], ["proof (prove)\nusing this:\n  (?s \\<notin> lang ?r) = (lexer ?r ?s = None)\n  (?s \\<in> lang ?r) =\n  (\\<exists>v. lexer ?r ?s = Some v \\<and> ?s \\<in> ?r \\<rightarrow> v)\n\ngoal (4 subgoals):\n 1. lexer r s = Some v \\<Longrightarrow> s \\<in> r \\<rightarrow> v\n 2. s \\<in> r \\<rightarrow> v \\<Longrightarrow> lexer r s = Some v\n 3. \\<And>x.\n       \\<lbrakk>lexer r s = None; s \\<in> r \\<rightarrow> x\\<rbrakk>\n       \\<Longrightarrow> False\n 4. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "apply fastforce"], ["proof (prove)\ngoal (3 subgoals):\n 1. s \\<in> r \\<rightarrow> v \\<Longrightarrow> lexer r s = Some v\n 2. \\<And>x.\n       \\<lbrakk>lexer r s = None; s \\<in> r \\<rightarrow> x\\<rbrakk>\n       \\<Longrightarrow> False\n 3. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "using Posix1(1) Posix_determ lexer_correct_Some"], ["proof (prove)\nusing this:\n  ?s \\<in> ?r \\<rightarrow> ?v \\<Longrightarrow> ?s \\<in> lang ?r\n  \\<lbrakk>?s \\<in> ?r \\<rightarrow> ?v1.0;\n   ?s \\<in> ?r \\<rightarrow> ?v2.0\\<rbrakk>\n  \\<Longrightarrow> ?v1.0 = ?v2.0\n  (?s \\<in> lang ?r) =\n  (\\<exists>v. lexer ?r ?s = Some v \\<and> ?s \\<in> ?r \\<rightarrow> v)\n\ngoal (3 subgoals):\n 1. s \\<in> r \\<rightarrow> v \\<Longrightarrow> lexer r s = Some v\n 2. \\<And>x.\n       \\<lbrakk>lexer r s = None; s \\<in> r \\<rightarrow> x\\<rbrakk>\n       \\<Longrightarrow> False\n 3. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "apply blast"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>lexer r s = None; s \\<in> r \\<rightarrow> x\\<rbrakk>\n       \\<Longrightarrow> False\n 2. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "using Posix1(1) lexer_correct_None"], ["proof (prove)\nusing this:\n  ?s \\<in> ?r \\<rightarrow> ?v \\<Longrightarrow> ?s \\<in> lang ?r\n  (?s \\<notin> lang ?r) = (lexer ?r ?s = None)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>lexer r s = None; s \\<in> r \\<rightarrow> x\\<rbrakk>\n       \\<Longrightarrow> False\n 2. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "apply blast"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "using lexer_correct_None lexer_correct_Some"], ["proof (prove)\nusing this:\n  (?s \\<notin> lang ?r) = (lexer ?r ?s = None)\n  (?s \\<in> lang ?r) =\n  (\\<exists>v. lexer ?r ?s = Some v \\<and> ?s \\<in> ?r \\<rightarrow> v)\n\ngoal (1 subgoal):\n 1. \\<forall>x. \\<not> s \\<in> r \\<rightarrow> x \\<Longrightarrow>\n    lexer r s = None", "by blast"], ["", "end"]]}