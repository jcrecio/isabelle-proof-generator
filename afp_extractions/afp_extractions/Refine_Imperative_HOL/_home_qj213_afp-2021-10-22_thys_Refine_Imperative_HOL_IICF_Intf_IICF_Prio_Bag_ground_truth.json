{"file_name": "/home/qj213/afp-2021-10-22/thys/Refine_Imperative_HOL/IICF/Intf/IICF_Prio_Bag.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Refine_Imperative_HOL", "problem_names": ["lemma param_mop_prio_pop_min[param]: \n    assumes [param]: \"(prio',prio) \\<in> A \\<rightarrow> B\"\n    assumes [param]: \"((\\<le>),(\\<le>)) \\<in> B \\<rightarrow> B \\<rightarrow> bool_rel\"\n    shows \"(mop_prio_pop_min prio',mop_prio_pop_min prio) \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow> \\<langle>A \\<times>\\<^sub>r \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel\"", "lemma param_mop_prio_peek_min[param]: \n    assumes [param]: \"(prio',prio) \\<in> A \\<rightarrow> B\"\n    assumes [param]: \"((\\<le>),(\\<le>)) \\<in> B \\<rightarrow> B \\<rightarrow> bool_rel\"\n    shows \"(mop_prio_peek_min prio',mop_prio_peek_min prio) \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow> \\<langle>A\\<rangle>nres_rel\"", "lemma [def_pat_rules]:\n  \"mop_prio_pop_min$prio \\<equiv> UNPROTECT (mop_prio_pop_min prio)\"\n  \"mop_prio_peek_min$prio \\<equiv> UNPROTECT (mop_prio_peek_min prio)\""], "translations": [["", "lemma param_mop_prio_pop_min[param]: \n    assumes [param]: \"(prio',prio) \\<in> A \\<rightarrow> B\"\n    assumes [param]: \"((\\<le>),(\\<le>)) \\<in> B \\<rightarrow> B \\<rightarrow> bool_rel\"\n    shows \"(mop_prio_pop_min prio',mop_prio_pop_min prio) \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow> \\<langle>A \\<times>\\<^sub>r \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (mop_prio_pop_min prio', mop_prio_pop_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\n          \\<langle>A \\<times>\\<^sub>r\n                   \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "unfolding mop_prio_pop_min_def[abs_def]"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>b.\n        ASSERT (b \\<noteq> {#}) \\<bind>\n        (\\<lambda>_.\n            SPEC\n             (\\<lambda>(v, b').\n                 v \\<in># b \\<and>\n                 b' = b - {#v#} \\<and>\n                 (\\<forall>v'\\<in>#b. prio' v \\<le> prio' v'))),\n     \\<lambda>b.\n        ASSERT (b \\<noteq> {#}) \\<bind>\n        (\\<lambda>_.\n            SPEC\n             (\\<lambda>(v, b').\n                 v \\<in># b \\<and>\n                 b' = b - {#v#} \\<and>\n                 (\\<forall>v'\\<in>#b. prio v \\<le> prio v'))))\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\n          \\<langle>A \\<times>\\<^sub>r\n                   \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "apply (clarsimp simp: mop_prio_pop_min_def nres_rel_def pw_le_iff refine_pw_simps)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a a'.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel;\n        a' \\<noteq> {#}\\<rbrakk>\n       \\<Longrightarrow> a \\<noteq> {#} \\<and>\n                         (\\<forall>aa b.\n                             (a \\<noteq> {#} \\<longrightarrow>\n                              aa \\<in># a \\<and>\n                              b = a - {#aa#} \\<and>\n                              (\\<forall>v'\\<in>#a.\n                                  prio' aa\n                                  \\<le> prio' v')) \\<longrightarrow>\n                             (\\<exists>a.\n                                 (aa, a) \\<in> A \\<and>\n                                 (b, a' - {#a#})\n                                 \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                                 a \\<in># a' \\<and>\n                                 (\\<forall>v'\\<in>#a'.\n                                     prio a \\<le> prio v')))", "apply (safe; simp)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "proof goal_cases"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "case (1 m n x)"], ["proof (state)\nthis:\n  (m, n) \\<in> \\<langle>A\\<rangle>mset_rel\n  n \\<noteq> {#}\n  x \\<in># m\n  \\<forall>v'\\<in>#m. prio' x \\<le> prio' v'\n\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "(*fix m n x*)"], ["proof (state)\nthis:\n  (m, n) \\<in> \\<langle>A\\<rangle>mset_rel\n  n \\<noteq> {#}\n  x \\<in># m\n  \\<forall>v'\\<in>#m. prio' x \\<le> prio' v'\n\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "assume \"(m,n)\\<in>\\<langle>A\\<rangle>mset_rel\"\n      and \"x\\<in>#m\"\n      and P': \"\\<forall>x'\\<in>set_mset m. prio' x \\<le> prio' x'\""], ["proof (state)\nthis:\n  (m, n) \\<in> \\<langle>A\\<rangle>mset_rel\n  x \\<in># m\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "hence R: \"rel_mset (rel2p A) m n\""], ["proof (prove)\nusing this:\n  (m, n) \\<in> \\<langle>A\\<rangle>mset_rel\n  x \\<in># m\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. rel_mset (rel2p A) m n", "by (simp add: mset_rel_def p2rel_def)"], ["proof (state)\nthis:\n  rel_mset (rel2p A) m n\n\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "from multi_member_split[OF \\<open>x\\<in>#m\\<close>]"], ["proof (chain)\npicking this:\n  \\<exists>A. m = add_mset x A", "obtain m' where [simp]: \"m=m'+{#x#}\""], ["proof (prove)\nusing this:\n  \\<exists>A. m = add_mset x A\n\ngoal (1 subgoal):\n 1. (\\<And>m'. m = m' + {#x#} \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  m = m' + {#x#}\n\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "from msed_rel_invL[OF R[simplified]]"], ["proof (chain)\npicking this:\n  \\<exists>N1 b.\n     n = add_mset b N1 \\<and> rel2p A x b \\<and> rel_mset (rel2p A) m' N1", "obtain n' y where \n      [simp]: \"n=n'+{#y#}\" and [param, simp]: \"(x,y)\\<in>A\" and R': \"(m',n')\\<in>\\<langle>A\\<rangle>mset_rel\""], ["proof (prove)\nusing this:\n  \\<exists>N1 b.\n     n = add_mset b N1 \\<and> rel2p A x b \\<and> rel_mset (rel2p A) m' N1\n\ngoal (1 subgoal):\n 1. (\\<And>n' y.\n        \\<lbrakk>n = n' + {#y#}; (x, y) \\<in> A;\n         (m', n') \\<in> \\<langle>A\\<rangle>mset_rel\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto simp: rel2p_def mset_rel_def p2rel_def)"], ["proof (state)\nthis:\n  n = n' + {#y#}\n  (x, y) \\<in> A\n  (m', n') \\<in> \\<langle>A\\<rangle>mset_rel\n\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "have \"\\<forall>y'\\<in>set_mset n. prio y \\<le> prio y'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>y'\\<in>#n. prio y \\<le> prio y'", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "fix y'"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "assume \"y'\\<in>set_mset n\""], ["proof (state)\nthis:\n  y' \\<in># n\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "then"], ["proof (chain)\npicking this:\n  y' \\<in># n", "obtain x' where [param]: \"(x',y')\\<in>A\" and \"x'\\<in>set_mset m\""], ["proof (prove)\nusing this:\n  y' \\<in># n\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>(x', y') \\<in> A; x' \\<in># m\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using R"], ["proof (prove)\nusing this:\n  y' \\<in># n\n  rel_mset (rel2p A) m n\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>(x', y') \\<in> A; x' \\<in># m\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis insert_DiffM msed_rel_invR rel2pD union_single_eq_member)"], ["proof (state)\nthis:\n  (x', y') \\<in> A\n  x' \\<in># m\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "with P'"], ["proof (chain)\npicking this:\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n  (x', y') \\<in> A\n  x' \\<in># m", "have \"prio' x \\<le> prio' x'\""], ["proof (prove)\nusing this:\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n  (x', y') \\<in> A\n  x' \\<in># m\n\ngoal (1 subgoal):\n 1. prio' x \\<le> prio' x'", "by blast"], ["proof (state)\nthis:\n  prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "moreover"], ["proof (state)\nthis:\n  prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "have \"(prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel", "by parametricity"], ["proof (state)\nthis:\n  (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "ultimately"], ["proof (chain)\npicking this:\n  prio' x \\<le> prio' x'\n  (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel", "show \"prio y \\<le> prio y'\""], ["proof (prove)\nusing this:\n  prio' x \\<le> prio' x'\n  (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel\n\ngoal (1 subgoal):\n 1. prio y \\<le> prio y'", "by simp"], ["proof (state)\nthis:\n  prio y \\<le> prio y'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>y'\\<in>#n. prio y \\<le> prio y'\n\ngoal (1 subgoal):\n 1. \\<And>a a' aa.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        aa \\<in># a; \\<forall>v'\\<in>#a. prio' aa \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ab.\n                            (aa, ab) \\<in> A \\<and>\n                            (a - {#aa#}, a' - {#ab#})\n                            \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n                            ab \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio ab \\<le> prio v')", "thus \n      \"\\<exists>a. (x, a) \\<in> A \\<and> (m - {#x#}, n - {#a#}) \\<in> \\<langle>A\\<rangle>mset_rel \\<and> a \\<in># n \\<and> (\\<forall>v'\\<in>set_mset n. prio a \\<le> prio v')\""], ["proof (prove)\nusing this:\n  \\<forall>y'\\<in>#n. prio y \\<le> prio y'\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       (x, a) \\<in> A \\<and>\n       (m - {#x#}, n - {#a#}) \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n       a \\<in># n \\<and> (\\<forall>v'\\<in>#n. prio a \\<le> prio v')", "using R'"], ["proof (prove)\nusing this:\n  \\<forall>y'\\<in>#n. prio y \\<le> prio y'\n  (m', n') \\<in> \\<langle>A\\<rangle>mset_rel\n\ngoal (1 subgoal):\n 1. \\<exists>a.\n       (x, a) \\<in> A \\<and>\n       (m - {#x#}, n - {#a#}) \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n       a \\<in># n \\<and> (\\<forall>v'\\<in>#n. prio a \\<le> prio v')", "by (auto intro!: exI[where x=n'] exI[where x=y])"], ["proof (state)\nthis:\n  \\<exists>a.\n     (x, a) \\<in> A \\<and>\n     (m - {#x#}, n - {#a#}) \\<in> \\<langle>A\\<rangle>mset_rel \\<and>\n     a \\<in># n \\<and> (\\<forall>v'\\<in>#n. prio a \\<le> prio v')\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma param_mop_prio_peek_min[param]: \n    assumes [param]: \"(prio',prio) \\<in> A \\<rightarrow> B\"\n    assumes [param]: \"((\\<le>),(\\<le>)) \\<in> B \\<rightarrow> B \\<rightarrow> bool_rel\"\n    shows \"(mop_prio_peek_min prio',mop_prio_peek_min prio) \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow> \\<langle>A\\<rangle>nres_rel\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (mop_prio_peek_min prio', mop_prio_peek_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\n          \\<langle>A\\<rangle>nres_rel", "unfolding mop_prio_peek_min_def[abs_def]"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>b.\n        ASSERT (b \\<noteq> {#}) \\<bind>\n        (\\<lambda>_.\n            SPEC\n             (\\<lambda>v.\n                 v \\<in># b \\<and>\n                 (\\<forall>v'\\<in>#b. prio' v \\<le> prio' v'))),\n     \\<lambda>b.\n        ASSERT (b \\<noteq> {#}) \\<bind>\n        (\\<lambda>_.\n            SPEC\n             (\\<lambda>v.\n                 v \\<in># b \\<and>\n                 (\\<forall>v'\\<in>#b. prio v \\<le> prio v'))))\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\n          \\<langle>A\\<rangle>nres_rel", "apply (clarsimp \n      simp: mop_prio_pop_min_def nres_rel_def pw_le_iff refine_pw_simps\n      )"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a a'.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel;\n        a' \\<noteq> {#}\\<rbrakk>\n       \\<Longrightarrow> a \\<noteq> {#} \\<and>\n                         (\\<forall>x.\n                             (a \\<noteq> {#} \\<longrightarrow>\n                              x \\<in># a \\<and>\n                              (\\<forall>v'\\<in>#a.\n                                  prio' x \\<le> prio' v')) \\<longrightarrow>\n                             (\\<exists>s'.\n                                 (x, s') \\<in> A \\<and>\n                                 s' \\<in># a' \\<and>\n                                 (\\<forall>v'\\<in>#a'.\n                                     prio s' \\<le> prio v')))", "apply (safe; simp?)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "fix m n x"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "assume \"(m,n)\\<in>\\<langle>A\\<rangle>mset_rel\"\n      and \"x\\<in>#m\"\n      and P': \"\\<forall>x'\\<in>set_mset m. prio' x \\<le> prio' x'\""], ["proof (state)\nthis:\n  (m, n) \\<in> \\<langle>A\\<rangle>mset_rel\n  x \\<in># m\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "hence R: \"rel_mset (rel2p A) m n\""], ["proof (prove)\nusing this:\n  (m, n) \\<in> \\<langle>A\\<rangle>mset_rel\n  x \\<in># m\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. rel_mset (rel2p A) m n", "by (simp add: mset_rel_def p2rel_def)"], ["proof (state)\nthis:\n  rel_mset (rel2p A) m n\n\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "from multi_member_split[OF \\<open>x\\<in>#m\\<close>]"], ["proof (chain)\npicking this:\n  \\<exists>A. m = add_mset x A", "obtain m' where [simp]: \"m=m'+{#x#}\""], ["proof (prove)\nusing this:\n  \\<exists>A. m = add_mset x A\n\ngoal (1 subgoal):\n 1. (\\<And>m'. m = m' + {#x#} \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  m = m' + {#x#}\n\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "from msed_rel_invL[OF R[simplified]]"], ["proof (chain)\npicking this:\n  \\<exists>N1 b.\n     n = add_mset b N1 \\<and> rel2p A x b \\<and> rel_mset (rel2p A) m' N1", "obtain n' y where \n      [simp]: \"n=n'+{#y#}\" and [param, simp]: \"(x,y)\\<in>A\" and R': \"(m',n')\\<in>\\<langle>A\\<rangle>mset_rel\""], ["proof (prove)\nusing this:\n  \\<exists>N1 b.\n     n = add_mset b N1 \\<and> rel2p A x b \\<and> rel_mset (rel2p A) m' N1\n\ngoal (1 subgoal):\n 1. (\\<And>n' y.\n        \\<lbrakk>n = n' + {#y#}; (x, y) \\<in> A;\n         (m', n') \\<in> \\<langle>A\\<rangle>mset_rel\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto simp: rel2p_def mset_rel_def p2rel_def)"], ["proof (state)\nthis:\n  n = n' + {#y#}\n  (x, y) \\<in> A\n  (m', n') \\<in> \\<langle>A\\<rangle>mset_rel\n\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "have \"\\<forall>y'\\<in>set_mset n. prio y \\<le> prio y'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>y'\\<in>#n. prio y \\<le> prio y'", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "fix y'"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "assume \"y'\\<in>set_mset n\""], ["proof (state)\nthis:\n  y' \\<in># n\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "then"], ["proof (chain)\npicking this:\n  y' \\<in># n", "obtain x' where [param]: \"(x',y')\\<in>A\" and \"x'\\<in>set_mset m\""], ["proof (prove)\nusing this:\n  y' \\<in># n\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>(x', y') \\<in> A; x' \\<in># m\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using R"], ["proof (prove)\nusing this:\n  y' \\<in># n\n  rel_mset (rel2p A) m n\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>(x', y') \\<in> A; x' \\<in># m\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (metis msed_rel_invR mset_contains_eq rel2pD union_mset_add_mset_left union_single_eq_member)"], ["proof (state)\nthis:\n  (x', y') \\<in> A\n  x' \\<in># m\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "with P'"], ["proof (chain)\npicking this:\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n  (x', y') \\<in> A\n  x' \\<in># m", "have \"prio' x \\<le> prio' x'\""], ["proof (prove)\nusing this:\n  \\<forall>x'\\<in>#m. prio' x \\<le> prio' x'\n  (x', y') \\<in> A\n  x' \\<in># m\n\ngoal (1 subgoal):\n 1. prio' x \\<le> prio' x'", "by blast"], ["proof (state)\nthis:\n  prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "moreover"], ["proof (state)\nthis:\n  prio' x \\<le> prio' x'\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "have \"(prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel", "by parametricity"], ["proof (state)\nthis:\n  (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel\n\ngoal (1 subgoal):\n 1. \\<And>y'. y' \\<in># n \\<Longrightarrow> prio y \\<le> prio y'", "ultimately"], ["proof (chain)\npicking this:\n  prio' x \\<le> prio' x'\n  (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel", "show \"prio y \\<le> prio y'\""], ["proof (prove)\nusing this:\n  prio' x \\<le> prio' x'\n  (prio' x \\<le> prio' x', prio y \\<le> prio y') \\<in> bool_rel\n\ngoal (1 subgoal):\n 1. prio y \\<le> prio y'", "by simp"], ["proof (state)\nthis:\n  prio y \\<le> prio y'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>y'\\<in>#n. prio y \\<le> prio y'\n\ngoal (1 subgoal):\n 1. \\<And>a a' x.\n       \\<lbrakk>(a, a') \\<in> \\<langle>A\\<rangle>mset_rel; a' \\<noteq> {#};\n        x \\<in># a; \\<forall>v'\\<in>#a. prio' x \\<le> prio' v'\\<rbrakk>\n       \\<Longrightarrow> \\<exists>s'.\n                            (x, s') \\<in> A \\<and>\n                            s' \\<in># a' \\<and>\n                            (\\<forall>v'\\<in>#a'. prio s' \\<le> prio v')", "thus \"\\<exists>y. (x, y) \\<in> A \\<and> y \\<in># n \\<and> (\\<forall>v'\\<in>set_mset n. prio y \\<le> prio v')\""], ["proof (prove)\nusing this:\n  \\<forall>y'\\<in>#n. prio y \\<le> prio y'\n\ngoal (1 subgoal):\n 1. \\<exists>y.\n       (x, y) \\<in> A \\<and>\n       y \\<in># n \\<and> (\\<forall>v'\\<in>#n. prio y \\<le> prio v')", "using R'"], ["proof (prove)\nusing this:\n  \\<forall>y'\\<in>#n. prio y \\<le> prio y'\n  (m', n') \\<in> \\<langle>A\\<rangle>mset_rel\n\ngoal (1 subgoal):\n 1. \\<exists>y.\n       (x, y) \\<in> A \\<and>\n       y \\<in># n \\<and> (\\<forall>v'\\<in>#n. prio y \\<le> prio v')", "by (auto intro!: exI[where x=y])"], ["proof (state)\nthis:\n  \\<exists>y.\n     (x, y) \\<in> A \\<and>\n     y \\<in># n \\<and> (\\<forall>v'\\<in>#n. prio y \\<le> prio v')\n\ngoal:\nNo subgoals!", "qed"], ["", "context fixes prio :: \"'a \\<Rightarrow> 'b::linorder\" and A :: \"('a\\<times>'a) set\" begin"], ["", "sepref_decl_op (no_def,no_mop) prio_pop_min: \n      \"PR_CONST (mop_prio_pop_min prio)\" :: \"\\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A \\<times>\\<^sub>r \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel\"\n      where \"IS_BELOW_ID A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_pop_min prio, mop_prio_pop_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A \\<times>\\<^sub>r\n                               \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "proof goal_cases"], ["proof (state)\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_pop_min prio, mop_prio_pop_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A \\<times>\\<^sub>r\n                               \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "case 1"], ["proof (state)\nthis:\n  IS_BELOW_ID A\n\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_pop_min prio, mop_prio_pop_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A \\<times>\\<^sub>r\n                               \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "hence [param]: \"(prio,prio)\\<in>A \\<rightarrow> Id\""], ["proof (prove)\nusing this:\n  IS_BELOW_ID A\n\ngoal (1 subgoal):\n 1. (prio, prio) \\<in> A \\<rightarrow> Id", "by (auto simp: IS_BELOW_ID_def)"], ["proof (state)\nthis:\n  (prio, prio) \\<in> A \\<rightarrow> Id\n\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_pop_min prio, mop_prio_pop_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A \\<times>\\<^sub>r\n                               \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. (mop_prio_pop_min prio, mop_prio_pop_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A \\<times>\\<^sub>r\n                               \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "apply (rule fref_ncI)"], ["proof (prove)\ngoal (1 subgoal):\n 1. (mop_prio_pop_min prio, mop_prio_pop_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\n          \\<langle>A \\<times>\\<^sub>r\n                   \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel", "apply parametricity"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<le>), (\\<le>)) \\<in> Id \\<rightarrow> Id \\<rightarrow> bool_rel", "by auto"], ["proof (state)\nthis:\n  (mop_prio_pop_min prio, mop_prio_pop_min prio)\n  \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A \\<times>\\<^sub>r\n                             \\<langle>A\\<rangle>mset_rel\\<rangle>nres_rel\n\ngoal:\nNo subgoals!", "qed"], ["", "sepref_decl_op (no_def,no_mop) prio_peek_min: \n      \"PR_CONST (mop_prio_peek_min prio)\" :: \"\\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A\\<rangle>nres_rel\"\n      where \"IS_BELOW_ID A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_peek_min prio, mop_prio_peek_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A\\<rangle>nres_rel", "proof goal_cases"], ["proof (state)\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_peek_min prio, mop_prio_peek_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A\\<rangle>nres_rel", "case 1"], ["proof (state)\nthis:\n  IS_BELOW_ID A\n\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_peek_min prio, mop_prio_peek_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A\\<rangle>nres_rel", "hence [param]: \"(prio,prio)\\<in>A \\<rightarrow> Id\""], ["proof (prove)\nusing this:\n  IS_BELOW_ID A\n\ngoal (1 subgoal):\n 1. (prio, prio) \\<in> A \\<rightarrow> Id", "by (auto simp: IS_BELOW_ID_def)"], ["proof (state)\nthis:\n  (prio, prio) \\<in> A \\<rightarrow> Id\n\ngoal (1 subgoal):\n 1. IS_BELOW_ID A \\<Longrightarrow>\n    (mop_prio_peek_min prio, mop_prio_peek_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A\\<rangle>nres_rel", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. (mop_prio_peek_min prio, mop_prio_peek_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A\\<rangle>nres_rel", "apply (rule fref_ncI)"], ["proof (prove)\ngoal (1 subgoal):\n 1. (mop_prio_peek_min prio, mop_prio_peek_min prio)\n    \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\n          \\<langle>A\\<rangle>nres_rel", "apply parametricity"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<le>), (\\<le>)) \\<in> Id \\<rightarrow> Id \\<rightarrow> bool_rel", "by auto"], ["proof (state)\nthis:\n  (mop_prio_peek_min prio, mop_prio_peek_min prio)\n  \\<in> \\<langle>A\\<rangle>mset_rel \\<rightarrow>\\<^sub>f \\<langle>A\\<rangle>nres_rel\n\ngoal:\nNo subgoals!", "qed"], ["", "end"], ["", "subsection \\<open>Patterns\\<close>"], ["", "lemma [def_pat_rules]:\n  \"mop_prio_pop_min$prio \\<equiv> UNPROTECT (mop_prio_pop_min prio)\"\n  \"mop_prio_peek_min$prio \\<equiv> UNPROTECT (mop_prio_peek_min prio)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (mop_prio_pop_min $ prio \\<equiv> UNPROTECT (mop_prio_pop_min prio)) &&&\n    mop_prio_peek_min $ prio \\<equiv> UNPROTECT (mop_prio_peek_min prio)", "by auto"], ["", "end"]]}