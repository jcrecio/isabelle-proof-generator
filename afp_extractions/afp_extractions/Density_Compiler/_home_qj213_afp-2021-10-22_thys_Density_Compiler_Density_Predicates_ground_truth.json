{"file_name": "/home/qj213/afp-2021-10-22/thys/Density_Compiler/Density_Predicates.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Density_Compiler", "problem_names": ["lemma is_subprob_densityI[intro]:\n    \"\\<lbrakk>f \\<in> borel_measurable M; \\<And>x. x \\<in> space M \\<Longrightarrow> f x \\<ge> 0; space M \\<noteq> {}; (\\<integral>\\<^sup>+x. f x \\<partial>M) \\<le> 1\\<rbrakk>\n        \\<Longrightarrow> is_subprob_density M f\"", "lemma is_subprob_densityD[dest]:\n  \"is_subprob_density M f \\<Longrightarrow> f \\<in> borel_measurable M\"\n  \"is_subprob_density M f \\<Longrightarrow> x \\<in> space M \\<Longrightarrow> f x \\<ge> 0\"\n  \"is_subprob_density M f \\<Longrightarrow> space M \\<noteq> {}\"\n  \"is_subprob_density M f \\<Longrightarrow> (\\<integral>\\<^sup>+x. f x \\<partial>M) \\<le> 1\"", "lemma has_densityI[intro]:\n  \"\\<lbrakk>f \\<in> borel_measurable N; M = density N f; space N \\<noteq> {}\\<rbrakk> \\<Longrightarrow> has_density M N f\"", "lemma has_densityD:\n  assumes \"has_density M N f\"\n  shows \"f \\<in> borel_measurable N\" \"M = density N f\" \"space N \\<noteq> {}\"", "lemma has_density_sets: \"has_density M N f \\<Longrightarrow> sets M = sets N\"", "lemma has_density_space: \"has_density M N f \\<Longrightarrow> space M = space N\"", "lemma has_density_emeasure:\n    \"has_density M N f \\<Longrightarrow> X \\<in> sets M \\<Longrightarrow> emeasure M X = \\<integral>\\<^sup>+x. f x * indicator X x \\<partial>N\"", "lemma nn_integral_cong': \"(\\<And>x. x \\<in> space N =simp=> f x = g x) \\<Longrightarrow> (\\<integral>\\<^sup>+x. f x \\<partial>N) = (\\<integral>\\<^sup>+x. g x \\<partial>N)\"", "lemma has_density_emeasure_space:\n    \"has_density M N f \\<Longrightarrow> emeasure M (space M) = (\\<integral>\\<^sup>+x. f x \\<partial>N)\"", "lemma has_density_emeasure_space':\n    \"has_density M N f \\<Longrightarrow> emeasure (density N f) (space (density N f)) = \\<integral>\\<^sup>+x. f x \\<partial>N\"", "lemma has_density_imp_is_subprob_density:\n    \"\\<lbrakk>has_density M N f; (\\<integral>\\<^sup>+x. f x \\<partial>N) = 1\\<rbrakk> \\<Longrightarrow> is_subprob_density N f\"", "lemma has_density_imp_is_subprob_density':\n    \"\\<lbrakk>has_density M N f; prob_space M\\<rbrakk> \\<Longrightarrow> is_subprob_density N f\"", "lemma has_density_equal_on_space:\n  assumes \"has_density M N f\" \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_density M N g\"", "lemma has_density_cong:\n  assumes \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_density M N f = has_density M N g\"", "lemma has_density_dens_AE:\n    \"\\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n      \\<And>x. x \\<in> space M \\<Longrightarrow> f' x \\<ge> 0; has_density M N f\\<rbrakk>\n        \\<Longrightarrow> has_density M N f'\"", "lemma is_subprob_density_imp_has_density:\n    \"\\<lbrakk>is_subprob_density N f; M = density N f\\<rbrakk> \\<Longrightarrow> has_density M N f\"", "lemma has_subprob_density_imp_subprob_space':\n    \"\\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk> \\<Longrightarrow> subprob_space M\"", "lemma has_subprob_density_imp_subprob_space[dest]:\n    \"is_subprob_density M f \\<Longrightarrow> subprob_space (density M f)\"", "lemma subprob_space_density_not_empty: \"subprob_space (density M f) \\<Longrightarrow> space M \\<noteq> {}\"", "lemma has_subprob_densityI:\n  \"\\<lbrakk>f \\<in> borel_measurable N; M = density N f; subprob_space M\\<rbrakk> \\<Longrightarrow> has_subprob_density M N f\"", "lemma has_subprob_densityI':\n  assumes \"f \\<in> borel_measurable N\" \"space N \\<noteq> {}\"\n          \"M = density N f\" \"(\\<integral>\\<^sup>+x. f x \\<partial>N) \\<le> 1\"\n  shows \"has_subprob_density M N f\"", "lemma has_subprob_densityD:\n  assumes \"has_subprob_density M N f\"\n  shows \"f \\<in> borel_measurable N\" \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x \\<ge> 0\" \"M = density N f\" \"subprob_space M\"", "lemma has_subprob_density_measurable[measurable_dest]:\n  \"has_subprob_density M N f \\<Longrightarrow> f \\<in> N \\<rightarrow>\\<^sub>M borel\"", "lemma has_subprob_density_imp_has_density:\n  \"has_subprob_density M N f \\<Longrightarrow> has_density M N f\"", "lemma has_subprob_density_equal_on_space:\n  assumes \"has_subprob_density M N f\" \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_subprob_density M N g\"", "lemma has_subprob_density_cong:\n  assumes \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_subprob_density M N f = has_subprob_density M N g\"", "lemma has_subprob_density_dens_AE:\n    \"\\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n      \\<And>x. x \\<in> space M \\<Longrightarrow> f' x \\<ge> 0; has_subprob_density M N f\\<rbrakk>\n      \\<Longrightarrow> has_subprob_density M N f'\"", "lemma has_parametrized_subprob_densityI:\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> N x = density R (f x)\"\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> subprob_space (N x)\"\n  assumes \"case_prod f \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\"\n  shows \"has_parametrized_subprob_density M N R f\"", "lemma has_parametrized_subprob_densityD:\n  assumes \"has_parametrized_subprob_density M N R f\"\n  shows \"\\<And>x. x \\<in> space M \\<Longrightarrow> N x = density R (f x)\"\n    and \"\\<And>x. x \\<in> space M \\<Longrightarrow> subprob_space (N x)\"\n    and [measurable_dest]: \"case_prod f \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\"", "lemma has_parametrized_subprob_density_integral:\n  assumes \"has_parametrized_subprob_density M N R f\" \"x \\<in> space M\"\n  shows \"(\\<integral>\\<^sup>+y. f x y \\<partial>R) \\<le> 1\"", "lemma has_parametrized_subprob_density_cong:\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> N x = N' x\"\n  shows \"has_parametrized_subprob_density M N R f = has_parametrized_subprob_density M N' R f\"", "lemma has_parametrized_subprob_density_dens_AE:\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> AE y in R. f x y = f' x y\"\n          \"case_prod f' \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\"\n          \"has_parametrized_subprob_density M N R f\"\n  shows   \"has_parametrized_subprob_density M N R f'\"", "lemma emeasure_bind_density:\n  assumes \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n          \"f \\<in> measurable M (subprob_algebra N)\" \"X \\<in> sets N\"\n  shows \"emeasure (M \\<bind> f) X = \\<integral>\\<^sup>+x. \\<integral>\\<^sup>+y. g x y * indicator X y \\<partial>N \\<partial>M\"", "lemma bind_density:\n  assumes \"sigma_finite_measure M\" \"sigma_finite_measure N\"\n          \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n     and [measurable]: \"case_prod g \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\" \"f \\<in> measurable M (subprob_algebra N)\"\n  shows \"(M \\<bind> f) = density N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)\"", "lemma bind_has_density:\n  assumes \"sigma_finite_measure M\" \"sigma_finite_measure N\"\n          \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n          \"case_prod g \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\"\n          \"f \\<in> measurable M (subprob_algebra N)\"\n  shows \"has_density (M \\<bind> f) N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)\"", "lemma bind_has_density':\n  assumes sfM: \"sigma_finite_measure M\"\n      and sfR: \"sigma_finite_measure R\"\n      and not_empty: \"space M \\<noteq> {}\" and dens_M: \"has_density M N \\<delta>M\"\n      and dens_f: \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) R (\\<delta>f x)\"\n      and M\\<delta>f: \"case_prod \\<delta>f \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\"\n      and Mf: \"f \\<in> measurable N (subprob_algebra R)\"\n  shows \"has_density (M \\<bind> f) R (\\<lambda>y. \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N)\"", "lemma bind_has_subprob_density:\n  assumes \"subprob_space M\" \"sigma_finite_measure N\"\n          \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n          \"case_prod g \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\"\n          \"f \\<in> measurable M (subprob_algebra N)\"\n  shows \"has_subprob_density (M \\<bind> f) N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)\"", "lemma bind_has_subprob_density':\n  assumes \"has_subprob_density M N \\<delta>M\" \"space R \\<noteq> {}\" \"sigma_finite_measure R\"\n          \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_subprob_density (f x) R (\\<delta>f x)\"\n          \"case_prod \\<delta>f \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\" \"f \\<in> measurable N (subprob_algebra R)\"\n  shows \"has_subprob_density (M \\<bind> f) R (\\<lambda>y. \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N)\"", "lemma null_measure_has_subprob_density:\n  \"space M \\<noteq> {} \\<Longrightarrow> has_subprob_density (null_measure M) M (\\<lambda>_. 0)\"", "lemma emeasure_has_parametrized_subprob_density:\n  assumes \"has_parametrized_subprob_density M N R f\"\n  assumes \"x \\<in> space M\" \"X \\<in> sets R\"\n  shows \"emeasure (N x) X = \\<integral>\\<^sup>+y. f x y * indicator X y \\<partial>R\"", "lemma emeasure_count_space_density_singleton:\n  assumes \"x \\<in> A\" \"has_density M (count_space A) f\"\n  shows \"emeasure M {x} = f x\"", "lemma subprob_count_space_density_le_1:\n  assumes \"has_subprob_density M (count_space A) f\" \"x \\<in> A\"\n  shows \"f x \\<le> 1\"", "lemma has_density_embed_measure:\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\"\n  shows \"has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f') \\<longleftrightarrow> has_density M N \\<delta>\"\n        (is \"has_density ?M' ?N' ?\\<delta>' \\<longleftrightarrow> has_density M N \\<delta>\")", "lemma has_density_embed_measure':\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\" and\n          sets_M: \"sets M = sets (embed_measure N f)\"\n  shows \"has_density (distr M N f') N (\\<delta> \\<circ> f) \\<longleftrightarrow> has_density M (embed_measure N f) \\<delta>\"", "lemma has_density_embed_measure'':\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\" and\n          \"has_density M (embed_measure N f) \\<delta>\"\n  shows \"has_density (distr M N f') N (\\<delta> \\<circ> f)\"", "lemma has_subprob_density_embed_measure'':\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\" and\n          \"has_subprob_density M (embed_measure N f) \\<delta>\"\n  shows \"has_subprob_density (distr M N f') N (\\<delta> \\<circ> f)\""], "translations": [["", "lemma is_subprob_densityI[intro]:\n    \"\\<lbrakk>f \\<in> borel_measurable M; \\<And>x. x \\<in> space M \\<Longrightarrow> f x \\<ge> 0; space M \\<noteq> {}; (\\<integral>\\<^sup>+x. f x \\<partial>M) \\<le> 1\\<rbrakk>\n        \\<Longrightarrow> is_subprob_density M f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>f \\<in> borel_measurable M;\n     \\<And>x. x \\<in> space M \\<Longrightarrow> 0 \\<le> f x;\n     space M \\<noteq> {}; integral\\<^sup>N M f \\<le> 1\\<rbrakk>\n    \\<Longrightarrow> is_subprob_density M f", "unfolding is_subprob_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>f \\<in> borel_measurable M;\n     \\<And>x. x \\<in> space M \\<Longrightarrow> 0 \\<le> f x;\n     space M \\<noteq> {}; integral\\<^sup>N M f \\<le> 1\\<rbrakk>\n    \\<Longrightarrow> f \\<in> borel_measurable M \\<and>\n                      space M \\<noteq> {} \\<and>\n                      (\\<forall>x\\<in>space M. 0 \\<le> f x) \\<and>\n                      integral\\<^sup>N M f \\<le> 1", "by simp"], ["", "lemma is_subprob_densityD[dest]:\n  \"is_subprob_density M f \\<Longrightarrow> f \\<in> borel_measurable M\"\n  \"is_subprob_density M f \\<Longrightarrow> x \\<in> space M \\<Longrightarrow> f x \\<ge> 0\"\n  \"is_subprob_density M f \\<Longrightarrow> space M \\<noteq> {}\"\n  \"is_subprob_density M f \\<Longrightarrow> (\\<integral>\\<^sup>+x. f x \\<partial>M) \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ((is_subprob_density M f \\<Longrightarrow>\n      f \\<in> borel_measurable M) &&&\n     (\\<lbrakk>is_subprob_density M f; x \\<in> space M\\<rbrakk>\n      \\<Longrightarrow> 0 \\<le> f x)) &&&\n    (is_subprob_density M f \\<Longrightarrow> space M \\<noteq> {}) &&&\n    (is_subprob_density M f \\<Longrightarrow> integral\\<^sup>N M f \\<le> 1)", "unfolding is_subprob_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((f \\<in> borel_measurable M \\<and>\n      space M \\<noteq> {} \\<and>\n      (\\<forall>x\\<in>space M. 0 \\<le> f x) \\<and>\n      integral\\<^sup>N M f \\<le> 1 \\<Longrightarrow>\n      f \\<in> borel_measurable M) &&&\n     (\\<lbrakk>f \\<in> borel_measurable M \\<and>\n               space M \\<noteq> {} \\<and>\n               (\\<forall>x\\<in>space M. 0 \\<le> f x) \\<and>\n               integral\\<^sup>N M f \\<le> 1;\n       x \\<in> space M\\<rbrakk>\n      \\<Longrightarrow> 0 \\<le> f x)) &&&\n    (f \\<in> borel_measurable M \\<and>\n     space M \\<noteq> {} \\<and>\n     (\\<forall>x\\<in>space M. 0 \\<le> f x) \\<and>\n     integral\\<^sup>N M f \\<le> 1 \\<Longrightarrow>\n     space M \\<noteq> {}) &&&\n    (f \\<in> borel_measurable M \\<and>\n     space M \\<noteq> {} \\<and>\n     (\\<forall>x\\<in>space M. 0 \\<le> f x) \\<and>\n     integral\\<^sup>N M f \\<le> 1 \\<Longrightarrow>\n     integral\\<^sup>N M f \\<le> 1)", "by simp_all"], ["", "subsection \\<open>Measure spaces with densities\\<close>"], ["", "definition has_density :: \"'a measure \\<Rightarrow> 'a measure \\<Rightarrow> ('a \\<Rightarrow> ennreal) \\<Rightarrow> bool\" where\n  \"has_density M N f \\<longleftrightarrow> (f \\<in> borel_measurable N) \\<and> space N \\<noteq> {} \\<and> M = density N f\""], ["", "lemma has_densityI[intro]:\n  \"\\<lbrakk>f \\<in> borel_measurable N; M = density N f; space N \\<noteq> {}\\<rbrakk> \\<Longrightarrow> has_density M N f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>f \\<in> borel_measurable N; M = density N f;\n     space N \\<noteq> {}\\<rbrakk>\n    \\<Longrightarrow> has_density M N f", "unfolding has_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>f \\<in> borel_measurable N; M = density N f;\n     space N \\<noteq> {}\\<rbrakk>\n    \\<Longrightarrow> f \\<in> borel_measurable N \\<and>\n                      space N \\<noteq> {} \\<and> M = density N f", "by blast"], ["", "lemma has_densityD:\n  assumes \"has_density M N f\"\n  shows \"f \\<in> borel_measurable N\" \"M = density N f\" \"space N \\<noteq> {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f \\<in> borel_measurable N &&& M = density N f &&& space N \\<noteq> {}", "using assms"], ["proof (prove)\nusing this:\n  has_density M N f\n\ngoal (1 subgoal):\n 1. f \\<in> borel_measurable N &&& M = density N f &&& space N \\<noteq> {}", "unfolding has_density_def"], ["proof (prove)\nusing this:\n  f \\<in> borel_measurable N \\<and>\n  space N \\<noteq> {} \\<and> M = density N f\n\ngoal (1 subgoal):\n 1. f \\<in> borel_measurable N &&& M = density N f &&& space N \\<noteq> {}", "by simp_all"], ["", "lemma has_density_sets: \"has_density M N f \\<Longrightarrow> sets M = sets N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density M N f \\<Longrightarrow> sets M = sets N", "unfolding has_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. f \\<in> borel_measurable N \\<and>\n    space N \\<noteq> {} \\<and> M = density N f \\<Longrightarrow>\n    sets M = sets N", "by simp"], ["", "lemma has_density_space: \"has_density M N f \\<Longrightarrow> space M = space N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density M N f \\<Longrightarrow> space M = space N", "unfolding has_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. f \\<in> borel_measurable N \\<and>\n    space N \\<noteq> {} \\<and> M = density N f \\<Longrightarrow>\n    space M = space N", "by simp"], ["", "lemma has_density_emeasure:\n    \"has_density M N f \\<Longrightarrow> X \\<in> sets M \\<Longrightarrow> emeasure M X = \\<integral>\\<^sup>+x. f x * indicator X x \\<partial>N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>has_density M N f; X \\<in> sets M\\<rbrakk>\n    \\<Longrightarrow> emeasure M X = set_nn_integral N X f", "unfolding has_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>f \\<in> borel_measurable N \\<and>\n             space N \\<noteq> {} \\<and> M = density N f;\n     X \\<in> sets M\\<rbrakk>\n    \\<Longrightarrow> emeasure M X = set_nn_integral N X f", "by (simp_all add: emeasure_density)"], ["", "lemma nn_integral_cong': \"(\\<And>x. x \\<in> space N =simp=> f x = g x) \\<Longrightarrow> (\\<integral>\\<^sup>+x. f x \\<partial>N) = (\\<integral>\\<^sup>+x. g x \\<partial>N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>x. x \\<in> space N =simp=> f x = g x) \\<Longrightarrow>\n    integral\\<^sup>N N f = integral\\<^sup>N N g", "by (simp add: simp_implies_def cong: nn_integral_cong)"], ["", "lemma has_density_emeasure_space:\n    \"has_density M N f \\<Longrightarrow> emeasure M (space M) = (\\<integral>\\<^sup>+x. f x \\<partial>N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density M N f \\<Longrightarrow>\n    emeasure M (space M) = integral\\<^sup>N N f", "by (simp add: has_density_emeasure) (simp add: has_density_space cong: nn_integral_cong')"], ["", "lemma has_density_emeasure_space':\n    \"has_density M N f \\<Longrightarrow> emeasure (density N f) (space (density N f)) = \\<integral>\\<^sup>+x. f x \\<partial>N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density M N f \\<Longrightarrow>\n    emeasure (density N f) (space (density N f)) = integral\\<^sup>N N f", "by (frule has_densityD(2)[symmetric]) (simp add: has_density_emeasure_space)"], ["", "lemma has_density_imp_is_subprob_density:\n    \"\\<lbrakk>has_density M N f; (\\<integral>\\<^sup>+x. f x \\<partial>N) = 1\\<rbrakk> \\<Longrightarrow> is_subprob_density N f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>has_density M N f; integral\\<^sup>N N f = 1\\<rbrakk>\n    \\<Longrightarrow> is_subprob_density N f", "by (auto dest: has_densityD)"], ["", "lemma has_density_imp_is_subprob_density':\n    \"\\<lbrakk>has_density M N f; prob_space M\\<rbrakk> \\<Longrightarrow> is_subprob_density N f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>has_density M N f; prob_space M\\<rbrakk>\n    \\<Longrightarrow> is_subprob_density N f", "by (auto intro!: has_density_imp_is_subprob_density dest: prob_space.emeasure_space_1\n           simp: has_density_emeasure_space)"], ["", "lemma has_density_equal_on_space:\n  assumes \"has_density M N f\" \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_density M N g\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density M N g", "proof"], ["proof (state)\ngoal (3 subgoals):\n 1. g \\<in> borel_measurable N\n 2. M = density N g\n 3. space N \\<noteq> {}", "from assms"], ["proof (chain)\npicking this:\n  has_density M N f\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x", "show \"g \\<in> borel_measurable N\""], ["proof (prove)\nusing this:\n  has_density M N f\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x\n\ngoal (1 subgoal):\n 1. g \\<in> borel_measurable N", "by (subst measurable_cong[of _ _ f]) (auto dest: has_densityD)"], ["proof (state)\nthis:\n  g \\<in> borel_measurable N\n\ngoal (2 subgoals):\n 1. M = density N g\n 2. space N \\<noteq> {}", "with assms"], ["proof (chain)\npicking this:\n  has_density M N f\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x\n  g \\<in> borel_measurable N", "show \"M = density N g\""], ["proof (prove)\nusing this:\n  has_density M N f\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x\n  g \\<in> borel_measurable N\n\ngoal (1 subgoal):\n 1. M = density N g", "by (subst density_cong[of _ _ f]) (auto dest: has_densityD)"], ["proof (state)\nthis:\n  M = density N g\n\ngoal (1 subgoal):\n 1. space N \\<noteq> {}", "from assms(1)"], ["proof (chain)\npicking this:\n  has_density M N f", "show \"space N \\<noteq> {}\""], ["proof (prove)\nusing this:\n  has_density M N f\n\ngoal (1 subgoal):\n 1. space N \\<noteq> {}", "by (rule has_densityD)"], ["proof (state)\nthis:\n  space N \\<noteq> {}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma has_density_cong:\n  assumes \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_density M N f = has_density M N g\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density M N f = has_density M N g", "using assms"], ["proof (prove)\nusing this:\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x\n\ngoal (1 subgoal):\n 1. has_density M N f = has_density M N g", "by (intro iffI) (erule has_density_equal_on_space, simp)+"], ["", "lemma has_density_dens_AE:\n    \"\\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n      \\<And>x. x \\<in> space M \\<Longrightarrow> f' x \\<ge> 0; has_density M N f\\<rbrakk>\n        \\<Longrightarrow> has_density M N f'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n     \\<And>x. x \\<in> space M \\<Longrightarrow> 0 \\<le> f' x;\n     has_density M N f\\<rbrakk>\n    \\<Longrightarrow> has_density M N f'", "unfolding has_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n     \\<And>x. x \\<in> space M \\<Longrightarrow> 0 \\<le> f' x;\n     f \\<in> borel_measurable N \\<and>\n     space N \\<noteq> {} \\<and> M = density N f\\<rbrakk>\n    \\<Longrightarrow> f' \\<in> borel_measurable N \\<and>\n                      space N \\<noteq> {} \\<and> M = density N f'", "by (simp cong: density_cong)"], ["", "subsection \\<open>Probability spaces with densities\\<close>"], ["", "lemma is_subprob_density_imp_has_density:\n    \"\\<lbrakk>is_subprob_density N f; M = density N f\\<rbrakk> \\<Longrightarrow> has_density M N f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>is_subprob_density N f; M = density N f\\<rbrakk>\n    \\<Longrightarrow> has_density M N f", "by (rule has_densityI) auto"], ["", "lemma has_subprob_density_imp_subprob_space':\n    \"\\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk> \\<Longrightarrow> subprob_space M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> subprob_space M", "proof (rule subprob_spaceI)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> emeasure M (space M) \\<le> 1\n 2. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> space M \\<noteq> {}", "assume \"has_density M N f\""], ["proof (state)\nthis:\n  has_density M N f\n\ngoal (2 subgoals):\n 1. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> emeasure M (space M) \\<le> 1\n 2. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> space M \\<noteq> {}", "hence \"M = density N f\""], ["proof (prove)\nusing this:\n  has_density M N f\n\ngoal (1 subgoal):\n 1. M = density N f", "by (simp add: has_density_def)"], ["proof (state)\nthis:\n  M = density N f\n\ngoal (2 subgoals):\n 1. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> emeasure M (space M) \\<le> 1\n 2. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> space M \\<noteq> {}", "also"], ["proof (state)\nthis:\n  M = density N f\n\ngoal (2 subgoals):\n 1. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> emeasure M (space M) \\<le> 1\n 2. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> space M \\<noteq> {}", "from \\<open>has_density M N f\\<close>"], ["proof (chain)\npicking this:\n  has_density M N f", "have \"space ... \\<noteq> {}\""], ["proof (prove)\nusing this:\n  has_density M N f\n\ngoal (1 subgoal):\n 1. space (density N f) \\<noteq> {}", "by (simp add: has_density_def)"], ["proof (state)\nthis:\n  space (density N f) \\<noteq> {}\n\ngoal (2 subgoals):\n 1. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> emeasure M (space M) \\<le> 1\n 2. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> space M \\<noteq> {}", "finally"], ["proof (chain)\npicking this:\n  space M \\<noteq> {}", "show \"space M \\<noteq> {}\""], ["proof (prove)\nusing this:\n  space M \\<noteq> {}\n\ngoal (1 subgoal):\n 1. space M \\<noteq> {}", "."], ["proof (state)\nthis:\n  space M \\<noteq> {}\n\ngoal (1 subgoal):\n 1. \\<lbrakk>has_density M N f; is_subprob_density N f\\<rbrakk>\n    \\<Longrightarrow> emeasure M (space M) \\<le> 1", "qed (auto simp add: has_density_emeasure_space dest: has_densityD)"], ["", "lemma has_subprob_density_imp_subprob_space[dest]:\n    \"is_subprob_density M f \\<Longrightarrow> subprob_space (density M f)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. is_subprob_density M f \\<Longrightarrow> subprob_space (density M f)", "by (rule has_subprob_density_imp_subprob_space') auto"], ["", "definition \"has_subprob_density M N f \\<equiv> has_density M N f \\<and> subprob_space M\""], ["", "(* TODO: Move *)"], ["", "lemma subprob_space_density_not_empty: \"subprob_space (density M f) \\<Longrightarrow> space M \\<noteq> {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. subprob_space (density M f) \\<Longrightarrow> space M \\<noteq> {}", "by (subst space_density[symmetric], subst subprob_space.subprob_not_empty, assumption) simp"], ["", "lemma has_subprob_densityI:\n  \"\\<lbrakk>f \\<in> borel_measurable N; M = density N f; subprob_space M\\<rbrakk> \\<Longrightarrow> has_subprob_density M N f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>f \\<in> borel_measurable N; M = density N f;\n     subprob_space M\\<rbrakk>\n    \\<Longrightarrow> has_subprob_density M N f", "unfolding has_subprob_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>f \\<in> borel_measurable N; M = density N f;\n     subprob_space M\\<rbrakk>\n    \\<Longrightarrow> has_density M N f \\<and> subprob_space M", "by (auto simp: subprob_space_density_not_empty)"], ["", "lemma has_subprob_densityI':\n  assumes \"f \\<in> borel_measurable N\" \"space N \\<noteq> {}\"\n          \"M = density N f\" \"(\\<integral>\\<^sup>+x. f x \\<partial>N) \\<le> 1\"\n  shows \"has_subprob_density M N f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density M N f", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. has_subprob_density M N f", "from assms"], ["proof (chain)\npicking this:\n  f \\<in> borel_measurable N\n  space N \\<noteq> {}\n  M = density N f\n  integral\\<^sup>N N f \\<le> 1", "have D: \"has_density M N f\""], ["proof (prove)\nusing this:\n  f \\<in> borel_measurable N\n  space N \\<noteq> {}\n  M = density N f\n  integral\\<^sup>N N f \\<le> 1\n\ngoal (1 subgoal):\n 1. has_density M N f", "by blast"], ["proof (state)\nthis:\n  has_density M N f\n\ngoal (1 subgoal):\n 1. has_subprob_density M N f", "moreover"], ["proof (state)\nthis:\n  has_density M N f\n\ngoal (1 subgoal):\n 1. has_subprob_density M N f", "from D and assms"], ["proof (chain)\npicking this:\n  has_density M N f\n  f \\<in> borel_measurable N\n  space N \\<noteq> {}\n  M = density N f\n  integral\\<^sup>N N f \\<le> 1", "have \"subprob_space M\""], ["proof (prove)\nusing this:\n  has_density M N f\n  f \\<in> borel_measurable N\n  space N \\<noteq> {}\n  M = density N f\n  integral\\<^sup>N N f \\<le> 1\n\ngoal (1 subgoal):\n 1. subprob_space M", "by (auto intro!: subprob_spaceI simp: has_density_emeasure_space emeasure_density\n             cong: nn_integral_cong')"], ["proof (state)\nthis:\n  subprob_space M\n\ngoal (1 subgoal):\n 1. has_subprob_density M N f", "ultimately"], ["proof (chain)\npicking this:\n  has_density M N f\n  subprob_space M", "show ?thesis"], ["proof (prove)\nusing this:\n  has_density M N f\n  subprob_space M\n\ngoal (1 subgoal):\n 1. has_subprob_density M N f", "unfolding has_subprob_density_def"], ["proof (prove)\nusing this:\n  has_density M N f\n  subprob_space M\n\ngoal (1 subgoal):\n 1. has_density M N f \\<and> subprob_space M", "by simp"], ["proof (state)\nthis:\n  has_subprob_density M N f\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma has_subprob_densityD:\n  assumes \"has_subprob_density M N f\"\n  shows \"f \\<in> borel_measurable N\" \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x \\<ge> 0\" \"M = density N f\" \"subprob_space M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (f \\<in> borel_measurable N &&&\n     (\\<And>x. x \\<in> space N \\<Longrightarrow> 0 \\<le> f x)) &&&\n    M = density N f &&& subprob_space M", "using assms"], ["proof (prove)\nusing this:\n  has_subprob_density M N f\n\ngoal (1 subgoal):\n 1. (f \\<in> borel_measurable N &&&\n     (\\<And>x. x \\<in> space N \\<Longrightarrow> 0 \\<le> f x)) &&&\n    M = density N f &&& subprob_space M", "unfolding has_subprob_density_def"], ["proof (prove)\nusing this:\n  has_density M N f \\<and> subprob_space M\n\ngoal (1 subgoal):\n 1. (f \\<in> borel_measurable N &&&\n     (\\<And>x. x \\<in> space N \\<Longrightarrow> 0 \\<le> f x)) &&&\n    M = density N f &&& subprob_space M", "by (auto dest: has_densityD)"], ["", "lemma has_subprob_density_measurable[measurable_dest]:\n  \"has_subprob_density M N f \\<Longrightarrow> f \\<in> N \\<rightarrow>\\<^sub>M borel\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density M N f \\<Longrightarrow> f \\<in> borel_measurable N", "by (auto dest: has_subprob_densityD)"], ["", "lemma has_subprob_density_imp_has_density:\n  \"has_subprob_density M N f \\<Longrightarrow> has_density M N f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density M N f \\<Longrightarrow> has_density M N f", "by (simp add: has_subprob_density_def)"], ["", "lemma has_subprob_density_equal_on_space:\n  assumes \"has_subprob_density M N f\" \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_subprob_density M N g\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density M N g", "using assms"], ["proof (prove)\nusing this:\n  has_subprob_density M N f\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x\n\ngoal (1 subgoal):\n 1. has_subprob_density M N g", "unfolding has_subprob_density_def"], ["proof (prove)\nusing this:\n  has_density M N f \\<and> subprob_space M\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x\n\ngoal (1 subgoal):\n 1. has_density M N g \\<and> subprob_space M", "by (auto dest: has_density_equal_on_space)"], ["", "lemma has_subprob_density_cong:\n  assumes \"\\<And>x. x \\<in> space N \\<Longrightarrow> f x = g x\"\n  shows \"has_subprob_density M N f = has_subprob_density M N g\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density M N f = has_subprob_density M N g", "using assms"], ["proof (prove)\nusing this:\n  ?x \\<in> space N \\<Longrightarrow> f ?x = g ?x\n\ngoal (1 subgoal):\n 1. has_subprob_density M N f = has_subprob_density M N g", "by (intro iffI) (erule has_subprob_density_equal_on_space, simp)+"], ["", "lemma has_subprob_density_dens_AE:\n    \"\\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n      \\<And>x. x \\<in> space M \\<Longrightarrow> f' x \\<ge> 0; has_subprob_density M N f\\<rbrakk>\n      \\<Longrightarrow> has_subprob_density M N f'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n     \\<And>x. x \\<in> space M \\<Longrightarrow> 0 \\<le> f' x;\n     has_subprob_density M N f\\<rbrakk>\n    \\<Longrightarrow> has_subprob_density M N f'", "unfolding has_subprob_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>AE y in N. f y = f' y; f' \\<in> borel_measurable N;\n     \\<And>x. x \\<in> space M \\<Longrightarrow> 0 \\<le> f' x;\n     has_density M N f \\<and> subprob_space M\\<rbrakk>\n    \\<Longrightarrow> has_density M N f' \\<and> subprob_space M", "by (simp add: has_density_dens_AE)"], ["", "subsection \\<open>Parametrized probability densities\\<close>"], ["", "definition\n  \"has_parametrized_subprob_density M N R f \\<equiv>\n       (\\<forall>x \\<in> space M. has_subprob_density (N x) R (f x)) \\<and> case_prod f \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\""], ["", "lemma has_parametrized_subprob_densityI:\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> N x = density R (f x)\"\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> subprob_space (N x)\"\n  assumes \"case_prod f \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\"\n  shows \"has_parametrized_subprob_density M N R f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_parametrized_subprob_density M N R f", "unfolding has_parametrized_subprob_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<forall>x\\<in>space M. has_subprob_density (N x) R (f x)) \\<and>\n    (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "using assms"], ["proof (prove)\nusing this:\n  ?x \\<in> space M \\<Longrightarrow> N ?x = density R (f ?x)\n  ?x \\<in> space M \\<Longrightarrow> subprob_space (N ?x)\n  (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\n\ngoal (1 subgoal):\n 1. (\\<forall>x\\<in>space M. has_subprob_density (N x) R (f x)) \\<and>\n    (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "by (intro ballI conjI has_subprob_densityI) simp_all"], ["", "lemma has_parametrized_subprob_densityD:\n  assumes \"has_parametrized_subprob_density M N R f\"\n  shows \"\\<And>x. x \\<in> space M \\<Longrightarrow> N x = density R (f x)\"\n    and \"\\<And>x. x \\<in> space M \\<Longrightarrow> subprob_space (N x)\"\n    and [measurable_dest]: \"case_prod f \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>x. x \\<in> space M \\<Longrightarrow> N x = density R (f x)) &&&\n    (\\<And>x. x \\<in> space M \\<Longrightarrow> subprob_space (N x)) &&&\n    (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "using assms"], ["proof (prove)\nusing this:\n  has_parametrized_subprob_density M N R f\n\ngoal (1 subgoal):\n 1. (\\<And>x. x \\<in> space M \\<Longrightarrow> N x = density R (f x)) &&&\n    (\\<And>x. x \\<in> space M \\<Longrightarrow> subprob_space (N x)) &&&\n    (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "unfolding has_parametrized_subprob_density_def"], ["proof (prove)\nusing this:\n  (\\<forall>x\\<in>space M. has_subprob_density (N x) R (f x)) \\<and>\n  (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\n\ngoal (1 subgoal):\n 1. (\\<And>x. x \\<in> space M \\<Longrightarrow> N x = density R (f x)) &&&\n    (\\<And>x. x \\<in> space M \\<Longrightarrow> subprob_space (N x)) &&&\n    (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "by (auto dest: has_subprob_densityD)"], ["", "lemma has_parametrized_subprob_density_integral:\n  assumes \"has_parametrized_subprob_density M N R f\" \"x \\<in> space M\"\n  shows \"(\\<integral>\\<^sup>+y. f x y \\<partial>R) \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "have \"(\\<integral>\\<^sup>+y. f x y \\<partial>R) = emeasure (density R (f x)) (space (density R (f x)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) =\n    emeasure (density R (f x)) (space (density R (f x)))", "using assms"], ["proof (prove)\nusing this:\n  has_parametrized_subprob_density M N R f\n  x \\<in> space M\n\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) =\n    emeasure (density R (f x)) (space (density R (f x)))", "by (auto simp: emeasure_density cong: nn_integral_cong' dest: has_parametrized_subprob_densityD)"], ["proof (state)\nthis:\n  integral\\<^sup>N R (f x) =\n  emeasure (density R (f x)) (space (density R (f x)))\n\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "also"], ["proof (state)\nthis:\n  integral\\<^sup>N R (f x) =\n  emeasure (density R (f x)) (space (density R (f x)))\n\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "have \"density R (f x) = (N x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. density R (f x) = N x", "using assms"], ["proof (prove)\nusing this:\n  has_parametrized_subprob_density M N R f\n  x \\<in> space M\n\ngoal (1 subgoal):\n 1. density R (f x) = N x", "by (auto dest: has_parametrized_subprob_densityD)"], ["proof (state)\nthis:\n  density R (f x) = N x\n\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "also"], ["proof (state)\nthis:\n  density R (f x) = N x\n\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "have \"emeasure ... (space ...) \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. emeasure (N x) (space (N x)) \\<le> 1", "using assms"], ["proof (prove)\nusing this:\n  has_parametrized_subprob_density M N R f\n  x \\<in> space M\n\ngoal (1 subgoal):\n 1. emeasure (N x) (space (N x)) \\<le> 1", "by (subst subprob_space.emeasure_space_le_1) (auto dest: has_parametrized_subprob_densityD)"], ["proof (state)\nthis:\n  emeasure (N x) (space (N x)) \\<le> 1\n\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "finally"], ["proof (chain)\npicking this:\n  integral\\<^sup>N R (f x) \\<le> 1", "show ?thesis"], ["proof (prove)\nusing this:\n  integral\\<^sup>N R (f x) \\<le> 1\n\ngoal (1 subgoal):\n 1. integral\\<^sup>N R (f x) \\<le> 1", "."], ["proof (state)\nthis:\n  integral\\<^sup>N R (f x) \\<le> 1\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma has_parametrized_subprob_density_cong:\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> N x = N' x\"\n  shows \"has_parametrized_subprob_density M N R f = has_parametrized_subprob_density M N' R f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_parametrized_subprob_density M N R f =\n    has_parametrized_subprob_density M N' R f", "using assms"], ["proof (prove)\nusing this:\n  ?x \\<in> space M \\<Longrightarrow> N ?x = N' ?x\n\ngoal (1 subgoal):\n 1. has_parametrized_subprob_density M N R f =\n    has_parametrized_subprob_density M N' R f", "unfolding has_parametrized_subprob_density_def"], ["proof (prove)\nusing this:\n  ?x \\<in> space M \\<Longrightarrow> N ?x = N' ?x\n\ngoal (1 subgoal):\n 1. ((\\<forall>x\\<in>space M. has_subprob_density (N x) R (f x)) \\<and>\n     (\\<lambda>(x, y). f x y)\n     \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)) =\n    ((\\<forall>x\\<in>space M. has_subprob_density (N' x) R (f x)) \\<and>\n     (\\<lambda>(x, y). f x y)\n     \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R))", "by auto"], ["", "lemma has_parametrized_subprob_density_dens_AE:\n  assumes \"\\<And>x. x \\<in> space M \\<Longrightarrow> AE y in R. f x y = f' x y\"\n          \"case_prod f' \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\"\n          \"has_parametrized_subprob_density M N R f\"\n  shows   \"has_parametrized_subprob_density M N R f'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_parametrized_subprob_density M N R f'", "unfolding has_parametrized_subprob_density_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<forall>x\\<in>space M. has_subprob_density (N x) R (f' x)) \\<and>\n    (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "proof (intro conjI ballI)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> space M \\<Longrightarrow> has_subprob_density (N x) R (f' x)\n 2. (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "fix x"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> space M \\<Longrightarrow> has_subprob_density (N x) R (f' x)\n 2. (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "assume x: \"x \\<in> space M\""], ["proof (state)\nthis:\n  x \\<in> space M\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> space M \\<Longrightarrow> has_subprob_density (N x) R (f' x)\n 2. (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "with assms(3)"], ["proof (chain)\npicking this:\n  has_parametrized_subprob_density M N R f\n  x \\<in> space M", "have \"space (N x) = space R\""], ["proof (prove)\nusing this:\n  has_parametrized_subprob_density M N R f\n  x \\<in> space M\n\ngoal (1 subgoal):\n 1. space (N x) = space R", "by (auto dest!: has_parametrized_subprob_densityD(1))"], ["proof (state)\nthis:\n  space (N x) = space R\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x \\<in> space M \\<Longrightarrow> has_subprob_density (N x) R (f' x)\n 2. (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "with assms and x"], ["proof (chain)\npicking this:\n  ?x \\<in> space M \\<Longrightarrow> AE y in R. f ?x y = f' ?x y\n  (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\n  has_parametrized_subprob_density M N R f\n  x \\<in> space M\n  space (N x) = space R", "show \"has_subprob_density (N x) R (f' x)\""], ["proof (prove)\nusing this:\n  ?x \\<in> space M \\<Longrightarrow> AE y in R. f ?x y = f' ?x y\n  (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\n  has_parametrized_subprob_density M N R f\n  x \\<in> space M\n  space (N x) = space R\n\ngoal (1 subgoal):\n 1. has_subprob_density (N x) R (f' x)", "by (rule_tac has_subprob_density_dens_AE[of \"f x\"])\n       (auto simp: has_parametrized_subprob_density_def)"], ["proof (state)\nthis:\n  has_subprob_density (N x) R (f' x)\n\ngoal (1 subgoal):\n 1. (\\<lambda>(x, y). f' x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)", "qed fact"], ["", "subsection \\<open>Density in the Giry monad\\<close>"], ["", "lemma emeasure_bind_density:\n  assumes \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n          \"f \\<in> measurable M (subprob_algebra N)\" \"X \\<in> sets N\"\n  shows \"emeasure (M \\<bind> f) X = \\<integral>\\<^sup>+x. \\<integral>\\<^sup>+y. g x y * indicator X y \\<partial>N \\<partial>M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "from assms"], ["proof (chain)\npicking this:\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n  X \\<in> sets N", "have \"emeasure (M \\<bind> f) X = \\<integral>\\<^sup>+x. emeasure (f x) X \\<partial>M\""], ["proof (prove)\nusing this:\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n  X \\<in> sets N\n\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. emeasure (f x) X \\<partial>M", "by (intro emeasure_bind)"], ["proof (state)\nthis:\n  emeasure (M \\<bind> f) X =\n  \\<integral>\\<^sup>+ x. emeasure (f x) X \\<partial>M\n\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "also"], ["proof (state)\nthis:\n  emeasure (M \\<bind> f) X =\n  \\<integral>\\<^sup>+ x. emeasure (f x) X \\<partial>M\n\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "have \"... = \\<integral>\\<^sup>+x. \\<integral>\\<^sup>+y. g x y * indicator X y \\<partial>N \\<partial>M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<integral>\\<^sup>+ x. emeasure (f x) X \\<partial>M =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "using assms"], ["proof (prove)\nusing this:\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n  X \\<in> sets N\n\ngoal (1 subgoal):\n 1. \\<integral>\\<^sup>+ x. emeasure (f x) X \\<partial>M =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "by (intro nn_integral_cong) (simp add: has_density_emeasure sets_kernel)"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ x. emeasure (f x) X \\<partial>M =\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M\n\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "finally"], ["proof (chain)\npicking this:\n  emeasure (M \\<bind> f) X =\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "show ?thesis"], ["proof (prove)\nusing this:\n  emeasure (M \\<bind> f) X =\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M\n\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "."], ["proof (state)\nthis:\n  emeasure (M \\<bind> f) X =\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bind_density:\n  assumes \"sigma_finite_measure M\" \"sigma_finite_measure N\"\n          \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n     and [measurable]: \"case_prod g \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\" \"f \\<in> measurable M (subprob_algebra N)\"\n  shows \"(M \\<bind> f) = density N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<bind> f =\n    density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)", "proof (rule measure_eqI)"], ["proof (state)\ngoal (2 subgoals):\n 1. sets (M \\<bind> f) =\n    sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))\n 2. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "interpret sfN: sigma_finite_measure N"], ["proof (prove)\ngoal (1 subgoal):\n 1. sigma_finite_measure N", "by fact"], ["proof (state)\ngoal (2 subgoals):\n 1. sets (M \\<bind> f) =\n    sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))\n 2. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "interpret sfNM: pair_sigma_finite N M"], ["proof (prove)\ngoal (1 subgoal):\n 1. pair_sigma_finite N M", "unfolding pair_sigma_finite_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. sigma_finite_measure N \\<and> sigma_finite_measure M", "using assms"], ["proof (prove)\nusing this:\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n\ngoal (1 subgoal):\n 1. sigma_finite_measure N \\<and> sigma_finite_measure M", "by simp"], ["proof (state)\ngoal (2 subgoals):\n 1. sets (M \\<bind> f) =\n    sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))\n 2. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "show eq: \"sets (M \\<bind> f) = sets (density N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sets (M \\<bind> f) =\n    sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))", "using sets_bind[OF sets_kernel[OF assms(6)] assms(3)]"], ["proof (prove)\nusing this:\n  (\\<And>x.\n      x \\<in> space M \\<Longrightarrow>\n      ?a1 x \\<in> space M) \\<Longrightarrow>\n  sets (M \\<bind> (\\<lambda>x. f (?a1 x))) = sets N\n\ngoal (1 subgoal):\n 1. sets (M \\<bind> f) =\n    sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))", "by auto"], ["proof (state)\nthis:\n  sets (M \\<bind> f) =\n  sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "fix X"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "assume \"X \\<in> sets (M \\<bind> f)\""], ["proof (state)\nthis:\n  X \\<in> sets (M \\<bind> f)\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "with eq"], ["proof (chain)\npicking this:\n  sets (M \\<bind> f) =\n  sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))\n  X \\<in> sets (M \\<bind> f)", "have [measurable]: \"X \\<in> sets N\""], ["proof (prove)\nusing this:\n  sets (M \\<bind> f) =\n  sets (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M))\n  X \\<in> sets (M \\<bind> f)\n\ngoal (1 subgoal):\n 1. X \\<in> sets N", "by auto"], ["proof (state)\nthis:\n  X \\<in> sets N\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "with assms"], ["proof (chain)\npicking this:\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n  X \\<in> sets N", "have \"emeasure (M \\<bind> f) X = \\<integral>\\<^sup>+x. \\<integral>\\<^sup>+y. g x y * indicator X y \\<partial>N \\<partial>M\""], ["proof (prove)\nusing this:\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n  X \\<in> sets N\n\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M", "by (intro emeasure_bind_density) simp_all"], ["proof (state)\nthis:\n  emeasure (M \\<bind> f) X =\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "also"], ["proof (state)\nthis:\n  emeasure (M \\<bind> f) X =\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "from \\<open>X \\<in> sets N\\<close>"], ["proof (chain)\npicking this:\n  X \\<in> sets N", "have \"... = \\<integral>\\<^sup>+y. \\<integral>\\<^sup>+x. g x y * indicator X y \\<partial>M \\<partial>N\""], ["proof (prove)\nusing this:\n  X \\<in> sets N\n\ngoal (1 subgoal):\n 1. \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M =\n    \\<integral>\\<^sup>+ y. \\<integral>\\<^sup>+ x. g x y * indicator X y\n        \\<partial>M\n                       \\<partial>N", "by (intro sfNM.Fubini') measurable"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M =\n  \\<integral>\\<^sup>+ y. \\<integral>\\<^sup>+ x. g x y * indicator X y\n      \\<partial>M\n                     \\<partial>N\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "also"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M =\n  \\<integral>\\<^sup>+ y. \\<integral>\\<^sup>+ x. g x y * indicator X y\n      \\<partial>M\n                     \\<partial>N\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "{"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ x. set_nn_integral N X (g x) \\<partial>M =\n  \\<integral>\\<^sup>+ y. \\<integral>\\<^sup>+ x. g x y * indicator X y\n      \\<partial>M\n                     \\<partial>N\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "fix y"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "assume \"y \\<in> space N\""], ["proof (state)\nthis:\n  y \\<in> space N\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "have \"(\\<lambda>x. g x y) = case_prod g \\<circ> (\\<lambda>x. (x, y))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. g x y) =\n    (\\<lambda>(x, y). g x y) \\<circ> (\\<lambda>x. (x, y))", "by (rule ext) simp"], ["proof (state)\nthis:\n  (\\<lambda>x. g x y) =\n  (\\<lambda>(x, y). g x y) \\<circ> (\\<lambda>x. (x, y))\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "also"], ["proof (state)\nthis:\n  (\\<lambda>x. g x y) =\n  (\\<lambda>(x, y). g x y) \\<circ> (\\<lambda>x. (x, y))\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "from \\<open>y \\<in> space N\\<close>"], ["proof (chain)\npicking this:\n  y \\<in> space N", "have \"... \\<in> borel_measurable M\""], ["proof (prove)\nusing this:\n  y \\<in> space N\n\ngoal (1 subgoal):\n 1. (\\<lambda>(x, y). g x y) \\<circ> (\\<lambda>x. (x, y))\n    \\<in> borel_measurable M", "by (intro measurable_comp[OF _ assms(5)] measurable_Pair2')"], ["proof (state)\nthis:\n  (\\<lambda>(x, y). g x y) \\<circ> (\\<lambda>x. (x, y))\n  \\<in> borel_measurable M\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "finally"], ["proof (chain)\npicking this:\n  (\\<lambda>x. g x y) \\<in> borel_measurable M", "have \"(\\<lambda>x. g x y) \\<in> borel_measurable M\""], ["proof (prove)\nusing this:\n  (\\<lambda>x. g x y) \\<in> borel_measurable M\n\ngoal (1 subgoal):\n 1. (\\<lambda>x. g x y) \\<in> borel_measurable M", "."], ["proof (state)\nthis:\n  (\\<lambda>x. g x y) \\<in> borel_measurable M\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "}"], ["proof (state)\nthis:\n  ?y2 \\<in> space N \\<Longrightarrow>\n  (\\<lambda>x. g x ?y2) \\<in> borel_measurable M\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "hence \"... = \\<integral>\\<^sup>+y. (\\<integral>\\<^sup>+x. g x y \\<partial>M) * indicator X y \\<partial>N\""], ["proof (prove)\nusing this:\n  ?y2 \\<in> space N \\<Longrightarrow>\n  (\\<lambda>x. g x ?y2) \\<in> borel_measurable M\n\ngoal (1 subgoal):\n 1. \\<integral>\\<^sup>+ y. \\<integral>\\<^sup>+ x. g x y * indicator X y\n        \\<partial>M\n                       \\<partial>N =\n    \\<integral>\\<^sup>+y\\<in>X. \\<integral>\\<^sup>+ x. g x y \\<partial>M\n    \\<partial>N", "by (intro nn_integral_cong nn_integral_multc)  simp_all"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ y. \\<integral>\\<^sup>+ x. g x y * indicator X y\n      \\<partial>M\n                     \\<partial>N =\n  \\<integral>\\<^sup>+y\\<in>X. \\<integral>\\<^sup>+ x. g x y \\<partial>M\n  \\<partial>N\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "also"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ y. \\<integral>\\<^sup>+ x. g x y * indicator X y\n      \\<partial>M\n                     \\<partial>N =\n  \\<integral>\\<^sup>+y\\<in>X. \\<integral>\\<^sup>+ x. g x y \\<partial>M\n  \\<partial>N\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "from \\<open>X \\<in> sets N\\<close> and assms"], ["proof (chain)\npicking this:\n  X \\<in> sets N\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N", "have \"... = emeasure (density N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)) X\""], ["proof (prove)\nusing this:\n  X \\<in> sets N\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n\ngoal (1 subgoal):\n 1. \\<integral>\\<^sup>+y\\<in>X. \\<integral>\\<^sup>+ x. g x y \\<partial>M\n    \\<partial>N =\n    emeasure\n     (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) X", "by (subst emeasure_density) (simp_all add: sfN.borel_measurable_nn_integral)"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+y\\<in>X. \\<integral>\\<^sup>+ x. g x y \\<partial>M\n  \\<partial>N =\n  emeasure\n   (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) X\n\ngoal (1 subgoal):\n 1. \\<And>A.\n       A \\<in> sets (M \\<bind> f) \\<Longrightarrow>\n       emeasure (M \\<bind> f) A =\n       emeasure\n        (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) A", "finally"], ["proof (chain)\npicking this:\n  emeasure (M \\<bind> f) X =\n  emeasure\n   (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) X", "show \"emeasure (M \\<bind> f) X = emeasure (density N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)) X\""], ["proof (prove)\nusing this:\n  emeasure (M \\<bind> f) X =\n  emeasure\n   (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) X\n\ngoal (1 subgoal):\n 1. emeasure (M \\<bind> f) X =\n    emeasure\n     (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) X", "."], ["proof (state)\nthis:\n  emeasure (M \\<bind> f) X =\n  emeasure\n   (density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)) X\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bind_has_density:\n  assumes \"sigma_finite_measure M\" \"sigma_finite_measure N\"\n          \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n          \"case_prod g \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\"\n          \"f \\<in> measurable M (subprob_algebra N)\"\n  shows \"has_density (M \\<bind> f) N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) N\n     (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)", "proof"], ["proof (state)\ngoal (3 subgoals):\n 1. (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n    \\<in> borel_measurable N\n 2. M \\<bind> f =\n    density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n 3. space N \\<noteq> {}", "interpret sigma_finite_measure M"], ["proof (prove)\ngoal (1 subgoal):\n 1. sigma_finite_measure M", "by fact"], ["proof (state)\ngoal (3 subgoals):\n 1. (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n    \\<in> borel_measurable N\n 2. M \\<bind> f =\n    density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n 3. space N \\<noteq> {}", "show \"(\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M) \\<in> borel_measurable N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n    \\<in> borel_measurable N", "using assms"], ["proof (prove)\nusing this:\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n\ngoal (1 subgoal):\n 1. (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n    \\<in> borel_measurable N", "by (intro borel_measurable_nn_integral, subst measurable_pair_swap_iff) simp"], ["proof (state)\nthis:\n  (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n  \\<in> borel_measurable N\n\ngoal (2 subgoals):\n 1. M \\<bind> f =\n    density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n 2. space N \\<noteq> {}", "show \"M \\<bind> f = density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<bind> f =\n    density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)", "by (intro bind_density) (simp_all add: assms)"], ["proof (state)\nthis:\n  M \\<bind> f =\n  density N (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n\ngoal (1 subgoal):\n 1. space N \\<noteq> {}", "from \\<open>space M \\<noteq> {}\\<close>"], ["proof (chain)\npicking this:\n  space M \\<noteq> {}", "obtain x where \"x \\<in> space M\""], ["proof (prove)\nusing this:\n  space M \\<noteq> {}\n\ngoal (1 subgoal):\n 1. (\\<And>x. x \\<in> space M \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  x \\<in> space M\n\ngoal (1 subgoal):\n 1. space N \\<noteq> {}", "with assms"], ["proof (chain)\npicking this:\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n  x \\<in> space M", "have \"has_density (f x) N (g x)\""], ["proof (prove)\nusing this:\n  sigma_finite_measure M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n  x \\<in> space M\n\ngoal (1 subgoal):\n 1. has_density (f x) N (g x)", "by simp"], ["proof (state)\nthis:\n  has_density (f x) N (g x)\n\ngoal (1 subgoal):\n 1. space N \\<noteq> {}", "thus \"space N \\<noteq> {}\""], ["proof (prove)\nusing this:\n  has_density (f x) N (g x)\n\ngoal (1 subgoal):\n 1. space N \\<noteq> {}", "by (rule has_densityD)"], ["proof (state)\nthis:\n  space N \\<noteq> {}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bind_has_density':\n  assumes sfM: \"sigma_finite_measure M\"\n      and sfR: \"sigma_finite_measure R\"\n      and not_empty: \"space M \\<noteq> {}\" and dens_M: \"has_density M N \\<delta>M\"\n      and dens_f: \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) R (\\<delta>f x)\"\n      and M\\<delta>f: \"case_prod \\<delta>f \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\"\n      and Mf: \"f \\<in> measurable N (subprob_algebra R)\"\n  shows \"has_density (M \\<bind> f) R (\\<lambda>y. \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "from dens_M"], ["proof (chain)\npicking this:\n  has_density M N \\<delta>M", "have M_M: \"measurable M = measurable N\""], ["proof (prove)\nusing this:\n  has_density M N \\<delta>M\n\ngoal (1 subgoal):\n 1. (\\<rightarrow>\\<^sub>M) M = (\\<rightarrow>\\<^sub>M) N", "by (intro ext measurable_cong_sets) (auto dest: has_densityD)"], ["proof (state)\nthis:\n  (\\<rightarrow>\\<^sub>M) M = (\\<rightarrow>\\<^sub>M) N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "from dens_M"], ["proof (chain)\npicking this:\n  has_density M N \\<delta>M", "have M_MR: \"measurable (M \\<Otimes>\\<^sub>M R) = measurable (N \\<Otimes>\\<^sub>M R)\""], ["proof (prove)\nusing this:\n  has_density M N \\<delta>M\n\ngoal (1 subgoal):\n 1. (\\<rightarrow>\\<^sub>M) (M \\<Otimes>\\<^sub>M R) =\n    (\\<rightarrow>\\<^sub>M) (N \\<Otimes>\\<^sub>M R)", "by (intro ext measurable_cong_sets sets_pair_measure_cong) (auto dest: has_densityD)"], ["proof (state)\nthis:\n  (\\<rightarrow>\\<^sub>M) (M \\<Otimes>\\<^sub>M R) =\n  (\\<rightarrow>\\<^sub>M) (N \\<Otimes>\\<^sub>M R)\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "have \"has_density (M \\<bind> f) R (\\<lambda>y. \\<integral>\\<^sup>+x. \\<delta>f x y \\<partial>M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M)", "by (rule bind_has_density) (auto simp: assms M_MR M_M)"], ["proof (state)\nthis:\n  has_density (M \\<bind> f) R\n   (\\<lambda>y. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M)\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "moreover"], ["proof (state)\nthis:\n  has_density (M \\<bind> f) R\n   (\\<lambda>y. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M)\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "{"], ["proof (state)\nthis:\n  has_density (M \\<bind> f) R\n   (\\<lambda>y. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M)\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "fix y"], ["proof (state)\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "assume A: \"y \\<in> space R\""], ["proof (state)\nthis:\n  y \\<in> space R\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "have \"(\\<lambda>x. \\<delta>f x y) = case_prod \\<delta>f \\<circ> (\\<lambda>x. (x,y))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. \\<delta>f x y) =\n    (\\<lambda>(x, y). \\<delta>f x y) \\<circ> (\\<lambda>x. (x, y))", "by (rule ext) (simp add: o_def)"], ["proof (state)\nthis:\n  (\\<lambda>x. \\<delta>f x y) =\n  (\\<lambda>(x, y). \\<delta>f x y) \\<circ> (\\<lambda>x. (x, y))\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "also"], ["proof (state)\nthis:\n  (\\<lambda>x. \\<delta>f x y) =\n  (\\<lambda>(x, y). \\<delta>f x y) \\<circ> (\\<lambda>x. (x, y))\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "have \"... \\<in> borel_measurable N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>(x, y). \\<delta>f x y) \\<circ> (\\<lambda>x. (x, y))\n    \\<in> borel_measurable N", "by (intro measurable_comp[OF _ M\\<delta>f] measurable_Pair2' A)"], ["proof (state)\nthis:\n  (\\<lambda>(x, y). \\<delta>f x y) \\<circ> (\\<lambda>x. (x, y))\n  \\<in> borel_measurable N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "finally"], ["proof (chain)\npicking this:\n  (\\<lambda>x. \\<delta>f x y) \\<in> borel_measurable N", "have M_\\<delta>f': \"(\\<lambda>x. \\<delta>f x y) \\<in> borel_measurable N\""], ["proof (prove)\nusing this:\n  (\\<lambda>x. \\<delta>f x y) \\<in> borel_measurable N\n\ngoal (1 subgoal):\n 1. (\\<lambda>x. \\<delta>f x y) \\<in> borel_measurable N", "."], ["proof (state)\nthis:\n  (\\<lambda>x. \\<delta>f x y) \\<in> borel_measurable N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "from dens_M"], ["proof (chain)\npicking this:\n  has_density M N \\<delta>M", "have \"M = density N \\<delta>M\""], ["proof (prove)\nusing this:\n  has_density M N \\<delta>M\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>M", "by (auto dest: has_densityD)"], ["proof (state)\nthis:\n  M = density N \\<delta>M\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "also"], ["proof (state)\nthis:\n  M = density N \\<delta>M\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "from dens_M"], ["proof (chain)\npicking this:\n  has_density M N \\<delta>M", "have \"(\\<integral>\\<^sup>+x. \\<delta>f x y \\<partial>...) = \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N\""], ["proof (prove)\nusing this:\n  has_density M N \\<delta>M\n\ngoal (1 subgoal):\n 1. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>density N \\<delta>M =\n    \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N", "by (subst nn_integral_density) (auto dest: has_densityD simp: M_\\<delta>f')"], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>density N \\<delta>M =\n  \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "finally"], ["proof (chain)\npicking this:\n  \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M =\n  \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N", "have \"(\\<integral>\\<^sup>+x. \\<delta>f x y \\<partial>M) = \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N\""], ["proof (prove)\nusing this:\n  \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M =\n  \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N\n\ngoal (1 subgoal):\n 1. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M =\n    \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N", "."], ["proof (state)\nthis:\n  \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M =\n  \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "}"], ["proof (state)\nthis:\n  ?y4 \\<in> space R \\<Longrightarrow>\n  \\<integral>\\<^sup>+ x. \\<delta>f x ?y4 \\<partial>M =\n  \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x ?y4 \\<partial>N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "ultimately"], ["proof (chain)\npicking this:\n  has_density (M \\<bind> f) R\n   (\\<lambda>y. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M)\n  ?y4 \\<in> space R \\<Longrightarrow>\n  \\<integral>\\<^sup>+ x. \\<delta>f x ?y4 \\<partial>M =\n  \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x ?y4 \\<partial>N", "show \"has_density (M \\<bind> f) R (\\<lambda>y. \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N)\""], ["proof (prove)\nusing this:\n  has_density (M \\<bind> f) R\n   (\\<lambda>y. \\<integral>\\<^sup>+ x. \\<delta>f x y \\<partial>M)\n  ?y4 \\<in> space R \\<Longrightarrow>\n  \\<integral>\\<^sup>+ x. \\<delta>f x ?y4 \\<partial>M =\n  \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x ?y4 \\<partial>N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "by (rule has_density_equal_on_space) simp_all"], ["proof (state)\nthis:\n  has_density (M \\<bind> f) R\n   (\\<lambda>y.\n       \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bind_has_subprob_density:\n  assumes \"subprob_space M\" \"sigma_finite_measure N\"\n          \"space M \\<noteq> {}\" \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_density (f x) N (g x)\"\n          \"case_prod g \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\"\n          \"f \\<in> measurable M (subprob_algebra N)\"\n  shows \"has_subprob_density (M \\<bind> f) N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density (M \\<bind> f) N\n     (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)", "proof (unfold has_subprob_density_def, intro conjI)"], ["proof (state)\ngoal (2 subgoals):\n 1. has_density (M \\<bind> f) N\n     (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n 2. subprob_space (M \\<bind> f)", "from assms"], ["proof (chain)\npicking this:\n  subprob_space M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N", "show \"has_density (M \\<bind> f) N (\\<lambda>y. \\<integral>\\<^sup>+x. g x y \\<partial>M)\""], ["proof (prove)\nusing this:\n  subprob_space M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) N\n     (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)", "by (intro bind_has_density) (auto simp: subprob_space_imp_sigma_finite)"], ["proof (state)\nthis:\n  has_density (M \\<bind> f) N\n   (\\<lambda>y. \\<integral>\\<^sup>+ x. g x y \\<partial>M)\n\ngoal (1 subgoal):\n 1. subprob_space (M \\<bind> f)", "from assms"], ["proof (chain)\npicking this:\n  subprob_space M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N", "show \"subprob_space (M \\<bind> f)\""], ["proof (prove)\nusing this:\n  subprob_space M\n  sigma_finite_measure N\n  space M \\<noteq> {}\n  ?x \\<in> space M \\<Longrightarrow> has_density (f ?x) N (g ?x)\n  (\\<lambda>(x, y). g x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M N)\n  f \\<in> M \\<rightarrow>\\<^sub>M subprob_algebra N\n\ngoal (1 subgoal):\n 1. subprob_space (M \\<bind> f)", "by (intro subprob_space_bind)"], ["proof (state)\nthis:\n  subprob_space (M \\<bind> f)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bind_has_subprob_density':\n  assumes \"has_subprob_density M N \\<delta>M\" \"space R \\<noteq> {}\" \"sigma_finite_measure R\"\n          \"\\<And>x. x \\<in> space M \\<Longrightarrow> has_subprob_density (f x) R (\\<delta>f x)\"\n          \"case_prod \\<delta>f \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\" \"f \\<in> measurable N (subprob_algebra R)\"\n  shows \"has_subprob_density (M \\<bind> f) R (\\<lambda>y. \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "proof (unfold has_subprob_density_def, intro conjI)"], ["proof (state)\ngoal (2 subgoals):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)\n 2. subprob_space (M \\<bind> f)", "from assms(1)"], ["proof (chain)\npicking this:\n  has_subprob_density M N \\<delta>M", "have \"space M \\<noteq> {}\""], ["proof (prove)\nusing this:\n  has_subprob_density M N \\<delta>M\n\ngoal (1 subgoal):\n 1. space M \\<noteq> {}", "by (intro subprob_space.subprob_not_empty has_subprob_densityD)"], ["proof (state)\nthis:\n  space M \\<noteq> {}\n\ngoal (2 subgoals):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)\n 2. subprob_space (M \\<bind> f)", "with assms"], ["proof (chain)\npicking this:\n  has_subprob_density M N \\<delta>M\n  space R \\<noteq> {}\n  sigma_finite_measure R\n  ?x \\<in> space M \\<Longrightarrow>\n  has_subprob_density (f ?x) R (\\<delta>f ?x)\n  (\\<lambda>(x, y). \\<delta>f x y)\n  \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\n  f \\<in> N \\<rightarrow>\\<^sub>M subprob_algebra R\n  space M \\<noteq> {}", "show \"has_density (M \\<bind> f) R (\\<lambda>y. \\<integral>\\<^sup>+x. \\<delta>M x * \\<delta>f x y \\<partial>N)\""], ["proof (prove)\nusing this:\n  has_subprob_density M N \\<delta>M\n  space R \\<noteq> {}\n  sigma_finite_measure R\n  ?x \\<in> space M \\<Longrightarrow>\n  has_subprob_density (f ?x) R (\\<delta>f ?x)\n  (\\<lambda>(x, y). \\<delta>f x y)\n  \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\n  f \\<in> N \\<rightarrow>\\<^sub>M subprob_algebra R\n  space M \\<noteq> {}\n\ngoal (1 subgoal):\n 1. has_density (M \\<bind> f) R\n     (\\<lambda>y.\n         \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)", "by (intro bind_has_density' has_densityI)\n       (auto simp: subprob_space_imp_sigma_finite dest: has_subprob_densityD)"], ["proof (state)\nthis:\n  has_density (M \\<bind> f) R\n   (\\<lambda>y.\n       \\<integral>\\<^sup>+ x. \\<delta>M x * \\<delta>f x y \\<partial>N)\n\ngoal (1 subgoal):\n 1. subprob_space (M \\<bind> f)", "from assms"], ["proof (chain)\npicking this:\n  has_subprob_density M N \\<delta>M\n  space R \\<noteq> {}\n  sigma_finite_measure R\n  ?x \\<in> space M \\<Longrightarrow>\n  has_subprob_density (f ?x) R (\\<delta>f ?x)\n  (\\<lambda>(x, y). \\<delta>f x y)\n  \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\n  f \\<in> N \\<rightarrow>\\<^sub>M subprob_algebra R", "show \"subprob_space (M \\<bind> f)\""], ["proof (prove)\nusing this:\n  has_subprob_density M N \\<delta>M\n  space R \\<noteq> {}\n  sigma_finite_measure R\n  ?x \\<in> space M \\<Longrightarrow>\n  has_subprob_density (f ?x) R (\\<delta>f ?x)\n  (\\<lambda>(x, y). \\<delta>f x y)\n  \\<in> borel_measurable (N \\<Otimes>\\<^sub>M R)\n  f \\<in> N \\<rightarrow>\\<^sub>M subprob_algebra R\n\ngoal (1 subgoal):\n 1. subprob_space (M \\<bind> f)", "by (intro subprob_space_bind) (auto dest: has_subprob_densityD)"], ["proof (state)\nthis:\n  subprob_space (M \\<bind> f)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma null_measure_has_subprob_density:\n  \"space M \\<noteq> {} \\<Longrightarrow> has_subprob_density (null_measure M) M (\\<lambda>_. 0)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. space M \\<noteq> {} \\<Longrightarrow>\n    has_subprob_density (null_measure M) M (\\<lambda>_. 0)", "by (intro has_subprob_densityI)\n     (auto intro: null_measure_eq_density simp: subprob_space_null_measure_iff)"], ["", "lemma emeasure_has_parametrized_subprob_density:\n  assumes \"has_parametrized_subprob_density M N R f\"\n  assumes \"x \\<in> space M\" \"X \\<in> sets R\"\n  shows \"emeasure (N x) X = \\<integral>\\<^sup>+y. f x y * indicator X y \\<partial>R\""], ["proof (prove)\ngoal (1 subgoal):\n 1. emeasure (N x) X = set_nn_integral R X (f x)", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. emeasure (N x) X = set_nn_integral R X (f x)", "from has_parametrized_subprob_densityD(3)[OF assms(1)] and assms(2)"], ["proof (chain)\npicking this:\n  (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\n  x \\<in> space M", "have Mf: \"f x \\<in> borel_measurable R\""], ["proof (prove)\nusing this:\n  (\\<lambda>(x, y). f x y) \\<in> borel_measurable (M \\<Otimes>\\<^sub>M R)\n  x \\<in> space M\n\ngoal (1 subgoal):\n 1. f x \\<in> borel_measurable R", "by simp"], ["proof (state)\nthis:\n  f x \\<in> borel_measurable R\n\ngoal (1 subgoal):\n 1. emeasure (N x) X = set_nn_integral R X (f x)", "have \"N x = density R (f x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. N x = density R (f x)", "by (rule has_parametrized_subprob_densityD(1)[OF assms(1,2)])"], ["proof (state)\nthis:\n  N x = density R (f x)\n\ngoal (1 subgoal):\n 1. emeasure (N x) X = set_nn_integral R X (f x)", "also"], ["proof (state)\nthis:\n  N x = density R (f x)\n\ngoal (1 subgoal):\n 1. emeasure (N x) X = set_nn_integral R X (f x)", "from Mf and assms(3)"], ["proof (chain)\npicking this:\n  f x \\<in> borel_measurable R\n  X \\<in> sets R", "have \"emeasure ... X = \\<integral>\\<^sup>+y. f x y * indicator X y \\<partial>R\""], ["proof (prove)\nusing this:\n  f x \\<in> borel_measurable R\n  X \\<in> sets R\n\ngoal (1 subgoal):\n 1. emeasure (density R (f x)) X = set_nn_integral R X (f x)", "by (rule emeasure_density)"], ["proof (state)\nthis:\n  emeasure (density R (f x)) X = set_nn_integral R X (f x)\n\ngoal (1 subgoal):\n 1. emeasure (N x) X = set_nn_integral R X (f x)", "finally"], ["proof (chain)\npicking this:\n  emeasure (N x) X = set_nn_integral R X (f x)", "show ?thesis"], ["proof (prove)\nusing this:\n  emeasure (N x) X = set_nn_integral R X (f x)\n\ngoal (1 subgoal):\n 1. emeasure (N x) X = set_nn_integral R X (f x)", "."], ["proof (state)\nthis:\n  emeasure (N x) X = set_nn_integral R X (f x)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma emeasure_count_space_density_singleton:\n  assumes \"x \\<in> A\" \"has_density M (count_space A) f\"\n  shows \"emeasure M {x} = f x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "from has_densityD[OF assms(2)]"], ["proof (chain)\npicking this:\n  f \\<in> borel_measurable (count_space A)\n  M = density (count_space A) f\n  space (count_space A) \\<noteq> {}", "have nonneg: \"\\<And>x. x \\<in> A \\<Longrightarrow> f x \\<ge> 0\""], ["proof (prove)\nusing this:\n  f \\<in> borel_measurable (count_space A)\n  M = density (count_space A) f\n  space (count_space A) \\<noteq> {}\n\ngoal (1 subgoal):\n 1. \\<And>x. x \\<in> A \\<Longrightarrow> 0 \\<le> f x", "by simp"], ["proof (state)\nthis:\n  ?x \\<in> A \\<Longrightarrow> 0 \\<le> f ?x\n\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "from assms"], ["proof (chain)\npicking this:\n  x \\<in> A\n  has_density M (count_space A) f", "have M: \"M = density (count_space A) f\""], ["proof (prove)\nusing this:\n  x \\<in> A\n  has_density M (count_space A) f\n\ngoal (1 subgoal):\n 1. M = density (count_space A) f", "by (intro has_densityD)"], ["proof (state)\nthis:\n  M = density (count_space A) f\n\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "from assms"], ["proof (chain)\npicking this:\n  x \\<in> A\n  has_density M (count_space A) f", "have \"emeasure M {x} = \\<integral>\\<^sup>+y. f y * indicator {x} y \\<partial>count_space A\""], ["proof (prove)\nusing this:\n  x \\<in> A\n  has_density M (count_space A) f\n\ngoal (1 subgoal):\n 1. emeasure M {x} = set_nn_integral (count_space A) {x} f", "by (simp add: M emeasure_density)"], ["proof (state)\nthis:\n  emeasure M {x} = set_nn_integral (count_space A) {x} f\n\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "also"], ["proof (state)\nthis:\n  emeasure M {x} = set_nn_integral (count_space A) {x} f\n\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "from assms and nonneg"], ["proof (chain)\npicking this:\n  x \\<in> A\n  has_density M (count_space A) f\n  ?x \\<in> A \\<Longrightarrow> 0 \\<le> f ?x", "have \"... = f x\""], ["proof (prove)\nusing this:\n  x \\<in> A\n  has_density M (count_space A) f\n  ?x \\<in> A \\<Longrightarrow> 0 \\<le> f ?x\n\ngoal (1 subgoal):\n 1. set_nn_integral (count_space A) {x} f = f x", "by (subst nn_integral_indicator_singleton) auto"], ["proof (state)\nthis:\n  set_nn_integral (count_space A) {x} f = f x\n\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "finally"], ["proof (chain)\npicking this:\n  emeasure M {x} = f x", "show ?thesis"], ["proof (prove)\nusing this:\n  emeasure M {x} = f x\n\ngoal (1 subgoal):\n 1. emeasure M {x} = f x", "."], ["proof (state)\nthis:\n  emeasure M {x} = f x\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma subprob_count_space_density_le_1:\n  assumes \"has_subprob_density M (count_space A) f\" \"x \\<in> A\"\n  shows \"f x \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f x \\<le> 1", "proof (cases \"f x > 0\")"], ["proof (state)\ngoal (2 subgoals):\n 1. 0 < f x \\<Longrightarrow> f x \\<le> 1\n 2. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "assume \"f x > 0\""], ["proof (state)\nthis:\n  0 < f x\n\ngoal (2 subgoals):\n 1. 0 < f x \\<Longrightarrow> f x \\<le> 1\n 2. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "from assms"], ["proof (chain)\npicking this:\n  has_subprob_density M (count_space A) f\n  x \\<in> A", "interpret subprob_space M"], ["proof (prove)\nusing this:\n  has_subprob_density M (count_space A) f\n  x \\<in> A\n\ngoal (1 subgoal):\n 1. subprob_space M", "by (intro has_subprob_densityD)"], ["proof (state)\ngoal (2 subgoals):\n 1. 0 < f x \\<Longrightarrow> f x \\<le> 1\n 2. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "from assms"], ["proof (chain)\npicking this:\n  has_subprob_density M (count_space A) f\n  x \\<in> A", "have M: \"M = density (count_space A) f\""], ["proof (prove)\nusing this:\n  has_subprob_density M (count_space A) f\n  x \\<in> A\n\ngoal (1 subgoal):\n 1. M = density (count_space A) f", "by (intro has_subprob_densityD)"], ["proof (state)\nthis:\n  M = density (count_space A) f\n\ngoal (2 subgoals):\n 1. 0 < f x \\<Longrightarrow> f x \\<le> 1\n 2. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "from assms"], ["proof (chain)\npicking this:\n  has_subprob_density M (count_space A) f\n  x \\<in> A", "have \"f x = emeasure M {x}\""], ["proof (prove)\nusing this:\n  has_subprob_density M (count_space A) f\n  x \\<in> A\n\ngoal (1 subgoal):\n 1. f x = emeasure M {x}", "by (intro emeasure_count_space_density_singleton[symmetric])\n       (auto simp: has_subprob_density_def)"], ["proof (state)\nthis:\n  f x = emeasure M {x}\n\ngoal (2 subgoals):\n 1. 0 < f x \\<Longrightarrow> f x \\<le> 1\n 2. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "also"], ["proof (state)\nthis:\n  f x = emeasure M {x}\n\ngoal (2 subgoals):\n 1. 0 < f x \\<Longrightarrow> f x \\<le> 1\n 2. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "have \"... \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. emeasure M {x} \\<le> 1", "by (rule subprob_emeasure_le_1)"], ["proof (state)\nthis:\n  emeasure M {x} \\<le> 1\n\ngoal (2 subgoals):\n 1. 0 < f x \\<Longrightarrow> f x \\<le> 1\n 2. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "finally"], ["proof (chain)\npicking this:\n  f x \\<le> 1", "show ?thesis"], ["proof (prove)\nusing this:\n  f x \\<le> 1\n\ngoal (1 subgoal):\n 1. f x \\<le> 1", "."], ["proof (state)\nthis:\n  f x \\<le> 1\n\ngoal (1 subgoal):\n 1. \\<not> 0 < f x \\<Longrightarrow> f x \\<le> 1", "qed (auto simp: not_less intro: order.trans[of _ 0 1])"], ["", "lemma has_density_embed_measure:\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\"\n  shows \"has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f') \\<longleftrightarrow> has_density M N \\<delta>\"\n        (is \"has_density ?M' ?N' ?\\<delta>' \\<longleftrightarrow> has_density M N \\<delta>\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f') =\n    has_density M N \\<delta>", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f') \\<Longrightarrow>\n    has_density M N \\<delta>\n 2. has_density M N \\<delta> \\<Longrightarrow>\n    has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f')", "assume dens: \"has_density ?M' ?N' ?\\<delta>'\""], ["proof (state)\nthis:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (2 subgoals):\n 1. has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f') \\<Longrightarrow>\n    has_density M N \\<delta>\n 2. has_density M N \\<delta> \\<Longrightarrow>\n    has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f')", "show \"has_density M N \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density M N \\<delta>", "proof"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<delta> \\<in> borel_measurable N\n 2. M = density N \\<delta>\n 3. space N \\<noteq> {}", "from dens"], ["proof (chain)\npicking this:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')", "show \"space N \\<noteq> {}\""], ["proof (prove)\nusing this:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (1 subgoal):\n 1. space N \\<noteq> {}", "by (auto simp: space_embed_measure dest: has_densityD)"], ["proof (state)\nthis:\n  space N \\<noteq> {}\n\ngoal (2 subgoals):\n 1. \\<delta> \\<in> borel_measurable N\n 2. M = density N \\<delta>", "from dens"], ["proof (chain)\npicking this:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')", "have M\\<delta>f': \"\\<delta> \\<circ> f' \\<in> borel_measurable ?N'\""], ["proof (prove)\nusing this:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (1 subgoal):\n 1. \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)", "by (rule has_densityD)"], ["proof (state)\nthis:\n  \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\n\ngoal (2 subgoals):\n 1. \\<delta> \\<in> borel_measurable N\n 2. M = density N \\<delta>", "hence M\\<delta>f'f: \"\\<delta> \\<circ> f' \\<circ> f \\<in> borel_measurable N\""], ["proof (prove)\nusing this:\n  \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\n\ngoal (1 subgoal):\n 1. \\<delta> \\<circ> f' \\<circ> f \\<in> borel_measurable N", "by (rule_tac measurable_comp, rule_tac measurable_embed_measure2[OF inj])"], ["proof (state)\nthis:\n  \\<delta> \\<circ> f' \\<circ> f \\<in> borel_measurable N\n\ngoal (2 subgoals):\n 1. \\<delta> \\<in> borel_measurable N\n 2. M = density N \\<delta>", "thus M\\<delta>: \"\\<delta> \\<in> borel_measurable N\""], ["proof (prove)\nusing this:\n  \\<delta> \\<circ> f' \\<circ> f \\<in> borel_measurable N\n\ngoal (1 subgoal):\n 1. \\<delta> \\<in> borel_measurable N", "by (simp cong: measurable_cong add: inv)"], ["proof (state)\nthis:\n  \\<delta> \\<in> borel_measurable N\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>", "from dens"], ["proof (chain)\npicking this:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')", "have \"embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')\""], ["proof (prove)\nusing this:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "by (rule has_densityD)"], ["proof (state)\nthis:\n  embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>", "also"], ["proof (state)\nthis:\n  embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>", "have \"... = embed_measure (density N (\\<delta> \\<circ> f' \\<circ> f)) f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. density (embed_measure N f) (\\<delta> \\<circ> f') =\n    embed_measure (density N (\\<delta> \\<circ> f' \\<circ> f)) f", "by (simp only: density_embed_measure[OF inj M\\<delta>f'])"], ["proof (state)\nthis:\n  density (embed_measure N f) (\\<delta> \\<circ> f') =\n  embed_measure (density N (\\<delta> \\<circ> f' \\<circ> f)) f\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>", "also"], ["proof (state)\nthis:\n  density (embed_measure N f) (\\<delta> \\<circ> f') =\n  embed_measure (density N (\\<delta> \\<circ> f' \\<circ> f)) f\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>", "have \"density N (\\<delta> \\<circ> f' \\<circ> f) = density N \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. density N (\\<delta> \\<circ> f' \\<circ> f) = density N \\<delta>", "by (intro density_cong[OF M\\<delta>f'f M\\<delta>]) (simp_all add: inv)"], ["proof (state)\nthis:\n  density N (\\<delta> \\<circ> f' \\<circ> f) = density N \\<delta>\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>", "finally"], ["proof (chain)\npicking this:\n  embed_measure M f = embed_measure (density N \\<delta>) f", "show \"M = density N \\<delta>\""], ["proof (prove)\nusing this:\n  embed_measure M f = embed_measure (density N \\<delta>) f\n\ngoal (1 subgoal):\n 1. M = density N \\<delta>", "by (simp add: embed_measure_eq_iff[OF inj])"], ["proof (state)\nthis:\n  M = density N \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  has_density M N \\<delta>\n\ngoal (1 subgoal):\n 1. has_density M N \\<delta> \\<Longrightarrow>\n    has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f')", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. has_density M N \\<delta> \\<Longrightarrow>\n    has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f')", "assume dens: \"has_density M N \\<delta>\""], ["proof (state)\nthis:\n  has_density M N \\<delta>\n\ngoal (1 subgoal):\n 1. has_density M N \\<delta> \\<Longrightarrow>\n    has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f')", "show \"has_density ?M' ?N' ?\\<delta>'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (embed_measure M f) (embed_measure N f)\n     (\\<delta> \\<circ> f')", "proof"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\n 2. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')\n 3. space (embed_measure N f) \\<noteq> {}", "from dens"], ["proof (chain)\npicking this:\n  has_density M N \\<delta>", "show \"space ?N' \\<noteq> {}\""], ["proof (prove)\nusing this:\n  has_density M N \\<delta>\n\ngoal (1 subgoal):\n 1. space (embed_measure N f) \\<noteq> {}", "by (auto simp: space_embed_measure dest: has_densityD)"], ["proof (state)\nthis:\n  space (embed_measure N f) \\<noteq> {}\n\ngoal (2 subgoals):\n 1. \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\n 2. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "have Mf'f: \"(\\<lambda>x. f' (f x)) \\<in> measurable N N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N", "by (subst measurable_cong[OF inv]) simp_all"], ["proof (state)\nthis:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n\ngoal (2 subgoals):\n 1. \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\n 2. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "from dens"], ["proof (chain)\npicking this:\n  has_density M N \\<delta>", "have M\\<delta>: \"\\<delta> \\<in> borel_measurable N\""], ["proof (prove)\nusing this:\n  has_density M N \\<delta>\n\ngoal (1 subgoal):\n 1. \\<delta> \\<in> borel_measurable N", "by (auto dest: has_densityD)"], ["proof (state)\nthis:\n  \\<delta> \\<in> borel_measurable N\n\ngoal (2 subgoals):\n 1. \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\n 2. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "from Mf'f and dens"], ["proof (chain)\npicking this:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n  has_density M N \\<delta>", "show M\\<delta>f': \"\\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\""], ["proof (prove)\nusing this:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n  has_density M N \\<delta>\n\ngoal (1 subgoal):\n 1. \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)", "by (intro measurable_comp) (erule measurable_embed_measure1, rule has_densityD)"], ["proof (state)\nthis:\n  \\<delta> \\<circ> f' \\<in> borel_measurable (embed_measure N f)\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "have \"embed_measure M f = embed_measure (density N \\<delta>) f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. embed_measure M f = embed_measure (density N \\<delta>) f", "by (simp only: has_densityD[OF dens])"], ["proof (state)\nthis:\n  embed_measure M f = embed_measure (density N \\<delta>) f\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "also"], ["proof (state)\nthis:\n  embed_measure M f = embed_measure (density N \\<delta>) f\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "from inv and dens and measurable_comp[OF Mf'f M\\<delta>]"], ["proof (chain)\npicking this:\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  has_density M N \\<delta>\n  \\<delta> \\<circ> (\\<lambda>x. f' (f x)) \\<in> borel_measurable N", "have \"density N \\<delta> = density N (?\\<delta>' \\<circ> f)\""], ["proof (prove)\nusing this:\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  has_density M N \\<delta>\n  \\<delta> \\<circ> (\\<lambda>x. f' (f x)) \\<in> borel_measurable N\n\ngoal (1 subgoal):\n 1. density N \\<delta> = density N (\\<delta> \\<circ> f' \\<circ> f)", "by (intro density_cong[OF M\\<delta>]) (simp add: o_def, simp add: inv o_def)"], ["proof (state)\nthis:\n  density N \\<delta> = density N (\\<delta> \\<circ> f' \\<circ> f)\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "also"], ["proof (state)\nthis:\n  density N \\<delta> = density N (\\<delta> \\<circ> f' \\<circ> f)\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "have \"embed_measure (density N (?\\<delta>' \\<circ> f)) f = density (embed_measure N f) (\\<delta> \\<circ> f')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. embed_measure (density N (\\<delta> \\<circ> f' \\<circ> f)) f =\n    density (embed_measure N f) (\\<delta> \\<circ> f')", "by (simp only: density_embed_measure[OF inj M\\<delta>f', symmetric])"], ["proof (state)\nthis:\n  embed_measure (density N (\\<delta> \\<circ> f' \\<circ> f)) f =\n  density (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "finally"], ["proof (chain)\npicking this:\n  embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "show \"embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')\""], ["proof (prove)\nusing this:\n  embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal (1 subgoal):\n 1. embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')", "."], ["proof (state)\nthis:\n  embed_measure M f = density (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  has_density (embed_measure M f) (embed_measure N f) (\\<delta> \\<circ> f')\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma has_density_embed_measure':\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\" and\n          sets_M: \"sets M = sets (embed_measure N f)\"\n  shows \"has_density (distr M N f') N (\\<delta> \\<circ> f) \\<longleftrightarrow> has_density M (embed_measure N f) \\<delta>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "have sets': \"sets (embed_measure (distr M N f') f) = sets (embed_measure N f)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sets (embed_measure (distr M N f') f) = sets (embed_measure N f)", "by (simp add: sets_embed_measure[OF inj])"], ["proof (state)\nthis:\n  sets (embed_measure (distr M N f') f) = sets (embed_measure N f)\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "have Mff': \"(\\<lambda>x. f' (f x)) \\<in> measurable N N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N", "by (subst measurable_cong[OF inv]) simp_all"], ["proof (state)\nthis:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "have inv': \"\\<And>x. x \\<in> space M \\<Longrightarrow> f (f' x) = x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x. x \\<in> space M \\<Longrightarrow> f (f' x) = x", "by (subst (asm) sets_eq_imp_space_eq[OF sets_M]) (auto simp: space_embed_measure inv)"], ["proof (state)\nthis:\n  ?x \\<in> space M \\<Longrightarrow> f (f' ?x) = ?x\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "have \"M = distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M = distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x))", "by (subst distr_cong[OF refl _ inv', of _ M]) (simp_all add: sets_embed_measure inj sets_M)"], ["proof (state)\nthis:\n  M = distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x))\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "also"], ["proof (state)\nthis:\n  M = distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x))\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "have \"... = embed_measure (distr M N f') f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x)) =\n    embed_measure (distr M N f') f", "apply (subst (2) embed_measure_eq_distr[OF inj], subst distr_distr)"], ["proof (prove)\ngoal (3 subgoals):\n 1. f \\<in> N \\<rightarrow>\\<^sub>M embed_measure (distr M N f') f\n 2. f' \\<in> M \\<rightarrow>\\<^sub>M N\n 3. distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x)) =\n    distr M (embed_measure (distr M N f') f) (f \\<circ> f')", "apply (subst measurable_cong_sets[OF refl sets'], rule measurable_embed_measure2[OF inj])"], ["proof (prove)\ngoal (2 subgoals):\n 1. f' \\<in> M \\<rightarrow>\\<^sub>M N\n 2. distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x)) =\n    distr M (embed_measure (distr M N f') f) (f \\<circ> f')", "apply (subst measurable_cong_sets[OF sets_M refl], rule measurable_embed_measure1, rule Mff')"], ["proof (prove)\ngoal (1 subgoal):\n 1. distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x)) =\n    distr M (embed_measure (distr M N f') f) (f \\<circ> f')", "apply (simp cong: distr_cong add: inv)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  distr M (embed_measure (distr M N f') f) (\\<lambda>x. f (f' x)) =\n  embed_measure (distr M N f') f\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "finally"], ["proof (chain)\npicking this:\n  M = embed_measure (distr M N f') f", "have M: \"M = embed_measure (distr M N f') f\""], ["proof (prove)\nusing this:\n  M = embed_measure (distr M N f') f\n\ngoal (1 subgoal):\n 1. M = embed_measure (distr M N f') f", "."], ["proof (state)\nthis:\n  M = embed_measure (distr M N f') f\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f) =\n    has_density M (embed_measure N f) \\<delta>", "by (subst (2) M, subst has_density_embed_measure[OF inj inv, symmetric])\n                  (auto simp: space_embed_measure inv intro!: has_density_cong)"], ["proof (state)\nthis:\n  has_density (distr M N f') N (\\<delta> \\<circ> f) =\n  has_density M (embed_measure N f) \\<delta>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma has_density_embed_measure'':\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\" and\n          \"has_density M (embed_measure N f) \\<delta>\"\n  shows \"has_density (distr M N f') N (\\<delta> \\<circ> f)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f)", "proof (subst has_density_embed_measure')"], ["proof (state)\ngoal (4 subgoals):\n 1. inj f\n 2. \\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\n 3. sets M = sets (embed_measure N f)\n 4. has_density M (embed_measure N f) \\<delta>", "from assms(3)"], ["proof (chain)\npicking this:\n  has_density M (embed_measure N f) \\<delta>", "show \"sets M = sets (embed_measure N f)\""], ["proof (prove)\nusing this:\n  has_density M (embed_measure N f) \\<delta>\n\ngoal (1 subgoal):\n 1. sets M = sets (embed_measure N f)", "by (auto dest: has_densityD)"], ["proof (state)\nthis:\n  sets M = sets (embed_measure N f)\n\ngoal (3 subgoals):\n 1. inj f\n 2. \\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\n 3. has_density M (embed_measure N f) \\<delta>", "qed (insert assms)"], ["", "lemma has_subprob_density_embed_measure'':\n  assumes inj: \"inj f\" and inv: \"\\<And>x. x \\<in> space N \\<Longrightarrow> f' (f x) = x\" and\n          \"has_subprob_density M (embed_measure N f) \\<delta>\"\n  shows \"has_subprob_density (distr M N f') N (\\<delta> \\<circ> f)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. has_subprob_density (distr M N f') N (\\<delta> \\<circ> f)", "proof (unfold has_subprob_density_def, intro conjI)"], ["proof (state)\ngoal (2 subgoals):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f)\n 2. subprob_space (distr M N f')", "from assms"], ["proof (chain)\npicking this:\n  inj f\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  has_subprob_density M (embed_measure N f) \\<delta>", "show \"has_density (distr M N f') N (\\<delta> \\<circ> f)\""], ["proof (prove)\nusing this:\n  inj f\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  has_subprob_density M (embed_measure N f) \\<delta>\n\ngoal (1 subgoal):\n 1. has_density (distr M N f') N (\\<delta> \\<circ> f)", "by (intro has_density_embed_measure'' has_subprob_density_imp_has_density)"], ["proof (state)\nthis:\n  has_density (distr M N f') N (\\<delta> \\<circ> f)\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "from assms(3)"], ["proof (chain)\npicking this:\n  has_subprob_density M (embed_measure N f) \\<delta>", "have \"sets M = sets (embed_measure N f)\""], ["proof (prove)\nusing this:\n  has_subprob_density M (embed_measure N f) \\<delta>\n\ngoal (1 subgoal):\n 1. sets M = sets (embed_measure N f)", "by (auto dest: has_subprob_densityD)"], ["proof (state)\nthis:\n  sets M = sets (embed_measure N f)\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "hence M: \"measurable M = measurable (embed_measure N f)\""], ["proof (prove)\nusing this:\n  sets M = sets (embed_measure N f)\n\ngoal (1 subgoal):\n 1. (\\<rightarrow>\\<^sub>M) M = (\\<rightarrow>\\<^sub>M) (embed_measure N f)", "by (intro ext measurable_cong_sets) simp_all"], ["proof (state)\nthis:\n  (\\<rightarrow>\\<^sub>M) M = (\\<rightarrow>\\<^sub>M) (embed_measure N f)\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "have \"(\\<lambda>x. f' (f x)) \\<in> measurable N N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N", "by (simp cong: measurable_cong add: inv)"], ["proof (state)\nthis:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "moreover"], ["proof (state)\nthis:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "from assms"], ["proof (chain)\npicking this:\n  inj f\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  has_subprob_density M (embed_measure N f) \\<delta>", "have \"space (embed_measure N f) \\<noteq> {}\""], ["proof (prove)\nusing this:\n  inj f\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  has_subprob_density M (embed_measure N f) \\<delta>\n\ngoal (1 subgoal):\n 1. space (embed_measure N f) \\<noteq> {}", "unfolding has_subprob_density_def has_density_def"], ["proof (prove)\nusing this:\n  inj f\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  (\\<delta> \\<in> borel_measurable (embed_measure N f) \\<and>\n   space (embed_measure N f) \\<noteq> {} \\<and>\n   M = density (embed_measure N f) \\<delta>) \\<and>\n  subprob_space M\n\ngoal (1 subgoal):\n 1. space (embed_measure N f) \\<noteq> {}", "by simp"], ["proof (state)\nthis:\n  space (embed_measure N f) \\<noteq> {}\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "ultimately"], ["proof (chain)\npicking this:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n  space (embed_measure N f) \\<noteq> {}", "show \"subprob_space (distr M N f')\""], ["proof (prove)\nusing this:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n  space (embed_measure N f) \\<noteq> {}\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "using assms"], ["proof (prove)\nusing this:\n  (\\<lambda>x. f' (f x)) \\<in> N \\<rightarrow>\\<^sub>M N\n  space (embed_measure N f) \\<noteq> {}\n  inj f\n  ?x \\<in> space N \\<Longrightarrow> f' (f ?x) = ?x\n  has_subprob_density M (embed_measure N f) \\<delta>\n\ngoal (1 subgoal):\n 1. subprob_space (distr M N f')", "by (intro subprob_space.subprob_space_distr has_subprob_densityD)\n       (auto simp: M space_embed_measure intro!: measurable_embed_measure1 dest: has_subprob_densityD)"], ["proof (state)\nthis:\n  subprob_space (distr M N f')\n\ngoal:\nNo subgoals!", "qed (insert assms)"], ["", "end"]]}