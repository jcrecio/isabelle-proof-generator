{"file_name": "/home/qj213/afp-2021-10-22/thys/Source_Coding_Theorem/Source_Coding_Theorem.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Source_Coding_Theorem", "problem_names": ["lemma fin_L: \"finite L\"", "lemma emp_L: \"L \\<noteq> {}\"", "lemma rw_tail:\n  assumes \"real_word w\"\nshows \"w = [] \\<or> real_word (tl w)\"", "lemma fi_pos: \"i\\<in> L \\<Longrightarrow> 0 \\<le> fi i\"", "lemma (in prob_space) simp_exp_composed:\n  assumes X: \"simple_distributed M X Px\"\nshows \"expectation (\\<lambda>a. f (X a)) = (\\<Sum>x \\<in> X`space M. f x * Px x)\"", "lemma cr_rw:\n  \"code_rate enc X = (\\<Sum>i \\<in> X ` space M. fi i * cw_len i)\"", "lemma cw_len_length: \"cw_len_concat w = length (enc w)\"", "lemma maj_fold:\n  assumes \"\\<And>l. l\\<in>L \\<Longrightarrow> f l \\<le> bound\"\n  assumes \"real_word w\"\nshows \"foldr (\\<lambda>x s. f x + s) w 0 \\<le> length w * bound\"", "lemma max_cw:\n  \"l \\<in> L \\<Longrightarrow> cw_len l \\<le> max_len\"", "lemma pos_cw_len: \"0 < 1 / b ^ cw_len i\"", "lemma \\<K>_pos: \"0 < \\<K>\"", "lemma \\<K>_pow: \"\\<K> = (\\<Sum>i\\<in>L. 1 / b powr cw_len i)\"", "lemma k_words_rel:\n  \"k_words (Suc k) = {w. (hd w \\<in> L \\<and> tl w \\<in> k_words k \\<and> w \\<noteq> [])}\"", "lemma bij_k_words:\nshows \"bij_betw (\\<lambda>wi. Cons (fst wi) (snd wi)) (L \\<times> k_words k) (k_words (Suc k))\"", "lemma finite_k_words: \"finite (k_words k)\"", "lemma cartesian_product:\n  fixes f::\"('c \\<Rightarrow> real)\"\n  fixes g::\"('d \\<Rightarrow> real)\"\n  assumes \"finite A\"\n  assumes \"finite B\"\nshows \"(\\<Sum>b\\<in>B. g b) * (\\<Sum>a\\<in>A. f a) = (\\<Sum>ab\\<in>A\\<times>B. f (fst ab) * g (snd ab))\"", "lemma \\<K>_power:\nshows \"\\<K>^k = (\\<Sum>w \\<in> (k_words k). 1 / b^(cw_len_concat w))\"", "lemma bound_len_concat:\nshows \"w \\<in> k_words k \\<Longrightarrow> cw_len_concat w \\<le> k * max_len\"", "lemma sum_vimage_proof:\n  fixes g::\"nat \\<Rightarrow> real\"\n  assumes \"\\<And>w. f w < bd\"\nshows \"finite S \\<Longrightarrow> (\\<Sum>w\\<in>S. g (f w)) = (\\<Sum> m=0..<bd. (card ((f-`{m}) \\<inter> S) )* g m)\"\n(is \"_ \\<Longrightarrow> _ = (\\<Sum> m=0..<bd. ?ff m S)\")", "lemma sum_vimage:\n  fixes g::\"nat \\<Rightarrow> real\"\n  assumes bounded: \"\\<And>w. w \\<in> S \\<Longrightarrow> f w < bd\" and \"0 < bd\"\n  assumes finite: \"finite S\"\nshows \"(\\<Sum>w\\<in>S. g (f w)) = (\\<Sum> m=0..<bd. (card ((f-`{m}) \\<inter> S) ) * g m)\"\n(is \"?s1 = ?s2\")", "lemma \\<K>_rw:\n  \"(\\<Sum>w \\<in> (k_words k). 1 / b^(cw_len_concat w)) = (\\<Sum>m=0..<Suc (k*max_len). card (k_words k \\<inter>\n((cw_len_concat) -` {m})) * (1 / b^m))\" (is \"?L = ?R\")", "lemma am_inj_code: \"inj_on enc ((cw_len_concat)-`{m})\" (is \"inj_on _ ?s\")", "lemma img_inc: \"enc`cw_len_concat-`{m} \\<subseteq> {bl. length bl = m}\"", "lemma bool_lists_card: \"card {bl::bool list. length bl = m} = b^m\"", "lemma bool_list_fin: \"finite {bl::bool list. length bl = m}\"", "lemma set_of_k_words_bound:\nshows \"card (set_of_k_words_length_m k m) \\<le> b^m\" (is \"?c \\<le> ?b\")", "lemma empty_set_k_words:\n  assumes \"0 < k\"\nshows \"set_of_k_words_length_m k 0 = {}\"", "lemma \\<K>_rw2:\n  assumes \"0 < k\"\nshows \"(\\<Sum>m=0..<Suc (k * max_len). card (set_of_k_words_length_m k m)/ b^m) \\<le> (k * max_len)\"", "lemma \\<K>_power_bound :\n  assumes \"0 < k\"\nshows \" \\<K>^k \\<le> k * max_len\"", "theorem McMillan :\nshows \"\\<K> \\<le> 1\"", "lemma entropy_rw: \"\\<H>(X) = -(\\<Sum>i \\<in> L. fi i * log b (fi i))\"", "lemma log_mult_ext3:\n  \"0 \\<le> x \\<Longrightarrow> 0 < y \\<Longrightarrow> 0 < z \\<Longrightarrow> x * log b (x*y*z) = x * log b (x*y) + x * log b z\"", "lemma log_mult_ext2:\n  \"0 \\<le> x \\<Longrightarrow> 0 < y \\<Longrightarrow> x * log b (x*y) = x * log b x + x * log b y\"", "lemma KL_div_mul:\n  assumes \"0 < d\" \"d \\<le> 1\"\n  assumes \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 \\<le> a i\"\n  assumes \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 < e i\"\nshows \"KL_div S a e \\<ge> KL_div S a (\\<lambda>i. e i / d)\"", "lemma KL_div_pos:\n  fixes a e::\"'b \\<Rightarrow> real\"\n  assumes fin: \"finite S\"\n  assumes nemp: \"S \\<noteq> {}\"\n  assumes non_null: \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 < a i\" \"\\<And>i. i\\<in> S \\<Longrightarrow> 0 < e i\"\n  assumes sum_a_one: \"(\\<Sum> i \\<in> S. a i) = 1\"\n  assumes sum_c_one: \"(\\<Sum> i \\<in> S. e i) = 1\"\nshows \"0 \\<le> KL_div S a e\"", "lemma KL_div_pos_emp:\n  \"0 \\<le> KL_div {} a e\"", "lemma KL_div_pos_gen:\n  fixes a d::\"'b \\<Rightarrow> real\"\n  assumes fin: \"finite S\"\n  assumes non_null: \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 < a i\" \"\\<And>i. i\\<in> S \\<Longrightarrow> 0 < d i\"\n  assumes sum_a_one: \"(\\<Sum> i \\<in> S. a i) = 1\"\n  assumes sum_d_one: \"(\\<Sum> i \\<in> S. d i) = 1\"\nshows \"0 \\<le> KL_div S a d\"", "theorem KL_div_pos2:\n  fixes a d::\"'b \\<Rightarrow> real\"\n  assumes fin: \"finite S\"\n  assumes non_null: \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 \\<le> a i\" \"\\<And>i. i\\<in> S \\<Longrightarrow> 0 < d i\"\n  assumes sum_a_one: \"(\\<Sum> i \\<in> S. a i) = 1\"\n  assumes sum_c_one: \"(\\<Sum> i \\<in> S. d i) = 1\"\nshows \"0 \\<le> KL_div S a d\"", "lemma sum_div_1:\n  fixes f::\"'b \\<Rightarrow> 'c::field\"\n  assumes \"(\\<Sum>i\\<in>A. f i) \\<noteq> 0\"\nshows \"(\\<Sum>i\\<in>A. f i / (\\<Sum>j\\<in>A. f j)) = 1\"", "theorem rate_lower_bound:\nshows \"\\<H>(X) \\<le> code_rate enc X\""], "translations": [["", "lemma fin_L: \"finite L\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite L", "using L_def distr_i"], ["proof (prove)\nusing this:\n  L \\<equiv> X ` space M\n  simple_distributed M X fi\n\ngoal (1 subgoal):\n 1. finite L", "by auto"], ["", "lemma emp_L: \"L \\<noteq> {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. L \\<noteq> {}", "using L_def subprob_not_empty"], ["proof (prove)\nusing this:\n  L \\<equiv> X ` space M\n  space M \\<noteq> {}\n\ngoal (1 subgoal):\n 1. L \\<noteq> {}", "by auto"], ["", "subsection\\<open>Codes and words\\<close>"], ["", "abbreviation real_word :: \"'b word \\<Rightarrow> bool\" where\n  \"real_word w \\<equiv> (set w \\<subseteq> L)\""], ["", "abbreviation k_words :: \"nat \\<Rightarrow> ('b word) set\" where\n  \"k_words k \\<equiv> {w. length w = k \\<and> real_word w}\""], ["", "lemma rw_tail:\n  assumes \"real_word w\"\nshows \"w = [] \\<or> real_word (tl w)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. w = [] \\<or> set (tl w) \\<subseteq> L", "by (meson assms list.set_sel(2) subset_code(1))"], ["", "definition code_word_length :: \"'e encoder \\<Rightarrow> 'e \\<Rightarrow> nat\" where\n  \"code_word_length e l = length (e [l])\""], ["", "abbreviation cw_len :: \"'b \\<Rightarrow> nat\" where\n  \"cw_len l \\<equiv> code_word_length enc l\""], ["", "definition code_rate :: \"'e encoder \\<Rightarrow> ('a \\<Rightarrow> 'e) \\<Rightarrow> real\" where\n  \"code_rate e Xo = expectation (\\<lambda>a. (code_word_length e ((Xo) a)))\""], ["", "lemma fi_pos: \"i\\<in> L \\<Longrightarrow> 0 \\<le> fi i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. i \\<in> L \\<Longrightarrow> 0 \\<le> fi i", "using simple_distributed_nonneg[OF distr_i] L_def"], ["proof (prove)\nusing this:\n  0 \\<le> fi ?x\n  L \\<equiv> X ` space M\n\ngoal (1 subgoal):\n 1. i \\<in> L \\<Longrightarrow> 0 \\<le> fi i", "by auto"], ["", "lemma (in prob_space) simp_exp_composed:\n  assumes X: \"simple_distributed M X Px\"\nshows \"expectation (\\<lambda>a. f (X a)) = (\\<Sum>x \\<in> X`space M. f x * Px x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. expectation (\\<lambda>a. f (X a)) =\n    (\\<Sum>x\\<in>X ` space M. f x * Px x)", "using distributed_integral[OF simple_distributed[OF X], of f]\n    simple_distributed_nonneg[OF X]\n    lebesgue_integral_count_space_finite[OF simple_distributed_finite[OF X], of \"\\<lambda>x. f x * Px x\"]"], ["proof (prove)\nusing this:\n  \\<lbrakk>f \\<in> borel_measurable (count_space (X ` space M));\n   \\<And>x.\n      x \\<in> space (count_space (X ` space M)) \\<Longrightarrow>\n      0 \\<le> Px x\\<rbrakk>\n  \\<Longrightarrow> LINT x|count_space (X ` space M). Px x * f x =\n                    expectation (\\<lambda>x. f (X x))\n  0 \\<le> Px ?x\n  LINT x|count_space (X ` space M). f x * Px x =\n  (\\<Sum>a\\<in>X ` space M. f a * Px a)\n\ngoal (1 subgoal):\n 1. expectation (\\<lambda>a. f (X a)) =\n    (\\<Sum>x\\<in>X ` space M. f x * Px x)", "by (simp add:  ac_simps)"], ["", "lemma cr_rw:\n  \"code_rate enc X = (\\<Sum>i \\<in> X ` space M. fi i * cw_len i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. code_rate enc X = (\\<Sum>i\\<in>X ` space M. fi i * real (cw_len i))", "using simp_exp_composed[OF distr_i, of \"cw_len\"]"], ["proof (prove)\nusing this:\n  expectation (\\<lambda>a. real (cw_len (X a))) =\n  (\\<Sum>x\\<in>X ` space M. real (cw_len x) * fi x)\n\ngoal (1 subgoal):\n 1. code_rate enc X = (\\<Sum>i\\<in>X ` space M. fi i * real (cw_len i))", "by (simp add: mult.commute code_rate_def)"], ["", "abbreviation cw_len_concat :: \"'b word \\<Rightarrow> nat\" where\n  \"cw_len_concat w \\<equiv> foldr (\\<lambda>x s. (cw_len x) + s) w 0\""], ["", "lemma cw_len_length: \"cw_len_concat w = length (enc w)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. cw_len_concat w = length (enc w)", "proof (induction w)"], ["proof (state)\ngoal (2 subgoals):\n 1. cw_len_concat [] = length (enc [])\n 2. \\<And>a w.\n       cw_len_concat w = length (enc w) \\<Longrightarrow>\n       cw_len_concat (a # w) = length (enc (a # w))", "case Nil"], ["proof (state)\nthis:\n  \n\ngoal (2 subgoals):\n 1. cw_len_concat [] = length (enc [])\n 2. \\<And>a w.\n       cw_len_concat w = length (enc w) \\<Longrightarrow>\n       cw_len_concat (a # w) = length (enc (a # w))", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. cw_len_concat [] = length (enc [])", "using real_code"], ["proof (prove)\nusing this:\n  dec (enc ?x) = Some ?x\n  (enc ?w = []) = (?w = [])\n  ?x \\<noteq> [] \\<longrightarrow> enc ?x = enc [hd ?x] @ enc (tl ?x)\n\ngoal (1 subgoal):\n 1. cw_len_concat [] = length (enc [])", "by simp"], ["proof (state)\nthis:\n  cw_len_concat [] = length (enc [])\n\ngoal (1 subgoal):\n 1. \\<And>a w.\n       cw_len_concat w = length (enc w) \\<Longrightarrow>\n       cw_len_concat (a # w) = length (enc (a # w))", "case (Cons a w)"], ["proof (state)\nthis:\n  cw_len_concat w = length (enc w)\n\ngoal (1 subgoal):\n 1. \\<And>a w.\n       cw_len_concat w = length (enc w) \\<Longrightarrow>\n       cw_len_concat (a # w) = length (enc (a # w))", "have \"cw_len_concat (a # w) = cw_len a + cw_len_concat w\""], ["proof (prove)\ngoal (1 subgoal):\n 1. cw_len_concat (a # w) = cw_len a + cw_len_concat w", "by simp"], ["proof (state)\nthis:\n  cw_len_concat (a # w) = cw_len a + cw_len_concat w\n\ngoal (1 subgoal):\n 1. \\<And>a w.\n       cw_len_concat w = length (enc w) \\<Longrightarrow>\n       cw_len_concat (a # w) = length (enc (a # w))", "thus ?case"], ["proof (prove)\nusing this:\n  cw_len_concat (a # w) = cw_len a + cw_len_concat w\n\ngoal (1 subgoal):\n 1. cw_len_concat (a # w) = length (enc (a # w))", "using code_word_length_def real_code Cons"], ["proof (prove)\nusing this:\n  cw_len_concat (a # w) = cw_len a + cw_len_concat w\n  code_word_length ?e ?l = length (?e [?l])\n  dec (enc ?x) = Some ?x\n  (enc ?w = []) = (?w = [])\n  ?x \\<noteq> [] \\<longrightarrow> enc ?x = enc [hd ?x] @ enc (tl ?x)\n  cw_len_concat w = length (enc w)\n\ngoal (1 subgoal):\n 1. cw_len_concat (a # w) = length (enc (a # w))", "by (metis length_append list.distinct(1) list.sel(1) list.sel(3))"], ["proof (state)\nthis:\n  cw_len_concat (a # w) = length (enc (a # w))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma maj_fold:\n  assumes \"\\<And>l. l\\<in>L \\<Longrightarrow> f l \\<le> bound\"\n  assumes \"real_word w\"\nshows \"foldr (\\<lambda>x s. f x + s) w 0 \\<le> length w * bound\""], ["proof (prove)\ngoal (1 subgoal):\n 1. foldr (\\<lambda>x. (+) (f x)) w 0 \\<le> length w * bound", "using assms"], ["proof (prove)\nusing this:\n  ?l14 \\<in> L \\<Longrightarrow> f ?l14 \\<le> bound\n  set w \\<subseteq> L\n\ngoal (1 subgoal):\n 1. foldr (\\<lambda>x. (+) (f x)) w 0 \\<le> length w * bound", "by(induction w) (simp,fastforce)"], ["", "definition max_len :: \"nat\" where\n  \"max_len = Max ((\\<lambda>x. cw_len x) ` L)\""], ["", "lemma max_cw:\n  \"l \\<in> L \\<Longrightarrow> cw_len l \\<le> max_len\""], ["proof (prove)\ngoal (1 subgoal):\n 1. l \\<in> L \\<Longrightarrow> cw_len l \\<le> max_len", "by (simp add: max_len_def fin_L)"], ["", "subsection\\<open>Related to the Kraft theorem\\<close>"], ["", "definition \\<K> :: \"real\" where\n  \"\\<K> = (\\<Sum>i\\<in>L. 1 / b ^ (cw_len i))\""], ["", "lemma pos_cw_len: \"0 < 1 / b ^ cw_len i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < 1 / b ^ cw_len i", "using b_gt_1"], ["proof (prove)\nusing this:\n  1 < b\n\ngoal (1 subgoal):\n 1. 0 < 1 / b ^ cw_len i", "by simp"], ["", "lemma \\<K>_pos: \"0 < \\<K>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < \\<K>", "using emp_L fin_L pos_cw_len sum_pos \\<K>_def"], ["proof (prove)\nusing this:\n  L \\<noteq> {}\n  finite L\n  0 < 1 / b ^ cw_len ?i\n  \\<lbrakk>finite ?I; ?I \\<noteq> {};\n   \\<And>i. i \\<in> ?I \\<Longrightarrow> (0::?'a) < ?f i\\<rbrakk>\n  \\<Longrightarrow> (0::?'a) < sum ?f ?I\n  \\<K> = (\\<Sum>i\\<in>L. 1 / b ^ cw_len i)\n\ngoal (1 subgoal):\n 1. 0 < \\<K>", "by metis"], ["", "lemma \\<K>_pow: \"\\<K> = (\\<Sum>i\\<in>L. 1 / b powr cw_len i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<K> = (\\<Sum>i\\<in>L. 1 / b powr real (cw_len i))", "using powr_realpow b_gt_1"], ["proof (prove)\nusing this:\n  0 < ?x \\<Longrightarrow> ?x powr real ?n = ?x ^ ?n\n  1 < b\n\ngoal (1 subgoal):\n 1. \\<K> = (\\<Sum>i\\<in>L. 1 / b powr real (cw_len i))", "by (simp add: \\<K>_def)"], ["", "lemma k_words_rel:\n  \"k_words (Suc k) = {w. (hd w \\<in> L \\<and> tl w \\<in> k_words k \\<and> w \\<noteq> [])}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {w. length w = Suc k \\<and> set w \\<subseteq> L} =\n    {w. hd w \\<in> L \\<and>\n        tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<noteq> []}", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. {w. length w = Suc k \\<and> set w \\<subseteq> L}\n    \\<subseteq> {w. hd w \\<in> L \\<and>\n                    tl w\n                    \\<in> {w. length w = k \\<and>\n                              set w \\<subseteq> L} \\<and>\n                    w \\<noteq> []}\n 2. {w. hd w \\<in> L \\<and>\n        tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<noteq> []}\n    \\<subseteq> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "fix k"], ["proof (state)\ngoal (2 subgoals):\n 1. {w. length w = Suc k \\<and> set w \\<subseteq> L}\n    \\<subseteq> {w. hd w \\<in> L \\<and>\n                    tl w\n                    \\<in> {w. length w = k \\<and>\n                              set w \\<subseteq> L} \\<and>\n                    w \\<noteq> []}\n 2. {w. hd w \\<in> L \\<and>\n        tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<noteq> []}\n    \\<subseteq> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "show \"k_words (Suc k) \\<subseteq> {w. (hd w \\<in> L \\<and> tl w \\<in> k_words k \\<and> w \\<noteq> [] )}\" (is \"?l \\<subseteq> ?r\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. {w. length w = Suc k \\<and> set w \\<subseteq> L}\n    \\<subseteq> {w. hd w \\<in> L \\<and>\n                    tl w\n                    \\<in> {w. length w = k \\<and>\n                              set w \\<subseteq> L} \\<and>\n                    w \\<noteq> []}", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "fix w"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "assume w_kw: \"w \\<in> k_words (Suc k)\""], ["proof (state)\nthis:\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "hence \"real_word w\""], ["proof (prove)\nusing this:\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. set w \\<subseteq> L", "by simp"], ["proof (state)\nthis:\n  set w \\<subseteq> L\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "hence \"hd w \\<in> L\""], ["proof (prove)\nusing this:\n  set w \\<subseteq> L\n\ngoal (1 subgoal):\n 1. hd w \\<in> L", "by (metis (mono_tags) w_kw hd_in_set list.size(3) mem_Collect_eq nat.distinct(1) subset_code(1))"], ["proof (state)\nthis:\n  hd w \\<in> L\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "moreover"], ["proof (state)\nthis:\n  hd w \\<in> L\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "have \"length w = Suc k\""], ["proof (prove)\ngoal (1 subgoal):\n 1. length w = Suc k", "using w_kw"], ["proof (prove)\nusing this:\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. length w = Suc k", "by simp"], ["proof (state)\nthis:\n  length w = Suc k\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "moreover"], ["proof (state)\nthis:\n  length w = Suc k\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "hence \"w \\<noteq> []\""], ["proof (prove)\nusing this:\n  length w = Suc k\n\ngoal (1 subgoal):\n 1. w \\<noteq> []", "by auto"], ["proof (state)\nthis:\n  w \\<noteq> []\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "moreover"], ["proof (state)\nthis:\n  w \\<noteq> []\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "have \"real_word (tl w)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. set (tl w) \\<subseteq> L", "using \\<open>real_word w\\<close> calculation(3) rw_tail"], ["proof (prove)\nusing this:\n  set w \\<subseteq> L\n  w \\<noteq> []\n  set ?w \\<subseteq> L \\<Longrightarrow>\n  ?w = [] \\<or> set (tl ?w) \\<subseteq> L\n\ngoal (1 subgoal):\n 1. set (tl w) \\<subseteq> L", "by auto"], ["proof (state)\nthis:\n  set (tl w) \\<subseteq> L\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. length w = Suc k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []}", "ultimately"], ["proof (chain)\npicking this:\n  hd w \\<in> L\n  length w = Suc k\n  w \\<noteq> []\n  set (tl w) \\<subseteq> L", "show \"w \\<in> ?r\""], ["proof (prove)\nusing this:\n  hd w \\<in> L\n  length w = Suc k\n  w \\<noteq> []\n  set (tl w) \\<subseteq> L\n\ngoal (1 subgoal):\n 1. w \\<in> {w. hd w \\<in> L \\<and>\n                tl w\n                \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                w \\<noteq> []}", "using w_kw"], ["proof (prove)\nusing this:\n  hd w \\<in> L\n  length w = Suc k\n  w \\<noteq> []\n  set (tl w) \\<subseteq> L\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. w \\<in> {w. hd w \\<in> L \\<and>\n                tl w\n                \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                w \\<noteq> []}", "by simp"], ["proof (state)\nthis:\n  w \\<in> {w. hd w \\<in> L \\<and>\n              tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n              w \\<noteq> []}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  {w. length w = Suc k \\<and> set w \\<subseteq> L}\n  \\<subseteq> {w. hd w \\<in> L \\<and>\n                  tl w\n                  \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                  w \\<noteq> []}\n\ngoal (1 subgoal):\n 1. {w. hd w \\<in> L \\<and>\n        tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<noteq> []}\n    \\<subseteq> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. {w. hd w \\<in> L \\<and>\n        tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<noteq> []}\n    \\<subseteq> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "fix k"], ["proof (state)\ngoal (1 subgoal):\n 1. {w. hd w \\<in> L \\<and>\n        tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<noteq> []}\n    \\<subseteq> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "show \"k_words (Suc k) \\<supseteq> {w. (hd w \\<in> L \\<and> tl w \\<in> k_words k \\<and> w \\<noteq> [])}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {w. hd w \\<in> L \\<and>\n        tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<noteq> []}\n    \\<subseteq> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []} \\<Longrightarrow>\n       x \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "fix w"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []} \\<Longrightarrow>\n       x \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "assume asm: \"w \\<in> {w. hd w \\<in> L \\<and> tl w \\<in> {w. length w = k \\<and> real_word w} \\<and> w \\<noteq> []}\""], ["proof (state)\nthis:\n  w \\<in> {w. hd w \\<in> L \\<and>\n              tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n              w \\<noteq> []}\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []} \\<Longrightarrow>\n       x \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "hence \"hd w \\<in> L \\<and> length (tl w) = k \\<and> real_word (tl w)\""], ["proof (prove)\nusing this:\n  w \\<in> {w. hd w \\<in> L \\<and>\n              tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n              w \\<noteq> []}\n\ngoal (1 subgoal):\n 1. hd w \\<in> L \\<and> length (tl w) = k \\<and> set (tl w) \\<subseteq> L", "by simp"], ["proof (state)\nthis:\n  hd w \\<in> L \\<and> length (tl w) = k \\<and> set (tl w) \\<subseteq> L\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []} \\<Longrightarrow>\n       x \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "hence \"real_word w\""], ["proof (prove)\nusing this:\n  hd w \\<in> L \\<and> length (tl w) = k \\<and> set (tl w) \\<subseteq> L\n\ngoal (1 subgoal):\n 1. set w \\<subseteq> L", "by (metis empty_iff insert_subset list.collapse list.set(1) set_simps(2) subsetI)"], ["proof (state)\nthis:\n  set w \\<subseteq> L\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []} \\<Longrightarrow>\n       x \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "moreover"], ["proof (state)\nthis:\n  set w \\<subseteq> L\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []} \\<Longrightarrow>\n       x \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "hence \"length w = Suc k\""], ["proof (prove)\nusing this:\n  set w \\<subseteq> L\n\ngoal (1 subgoal):\n 1. length w = Suc k", "using asm"], ["proof (prove)\nusing this:\n  set w \\<subseteq> L\n  w \\<in> {w. hd w \\<in> L \\<and>\n              tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n              w \\<noteq> []}\n\ngoal (1 subgoal):\n 1. length w = Suc k", "by auto"], ["proof (state)\nthis:\n  length w = Suc k\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x \\<in> {w. hd w \\<in> L \\<and>\n                   tl w\n                   \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n                   w \\<noteq> []} \\<Longrightarrow>\n       x \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "ultimately"], ["proof (chain)\npicking this:\n  set w \\<subseteq> L\n  length w = Suc k", "show \"w \\<in> k_words (Suc k)\""], ["proof (prove)\nusing this:\n  set w \\<subseteq> L\n  length w = Suc k\n\ngoal (1 subgoal):\n 1. w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}", "by simp"], ["proof (state)\nthis:\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  {w. hd w \\<in> L \\<and>\n      tl w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<and>\n      w \\<noteq> []}\n  \\<subseteq> {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bij_k_words:\nshows \"bij_betw (\\<lambda>wi. Cons (fst wi) (snd wi)) (L \\<times> k_words k) (k_words (Suc k))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n     {w. length w = Suc k \\<and> set w \\<subseteq> L}", "unfolding bij_betw_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. inj_on (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<and>\n    (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. inj_on (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n 2. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "fix k"], ["proof (state)\ngoal (2 subgoals):\n 1. inj_on (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n 2. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "let ?f = \"(\\<lambda>wi. Cons (fst wi) (snd wi))\""], ["proof (state)\ngoal (2 subgoals):\n 1. inj_on (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n 2. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "let ?S = \"L \\<times> (k_words k)\""], ["proof (state)\ngoal (2 subgoals):\n 1. inj_on (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n 2. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "let ?T = \"k_words (Suc k)\""], ["proof (state)\ngoal (2 subgoals):\n 1. inj_on (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n 2. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "show \"inj_on ?f ?S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inj_on (\\<lambda>wi. fst wi # snd wi)\n     (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})", "by (simp add: inj_on_def)"], ["proof (state)\nthis:\n  inj_on (\\<lambda>wi. fst wi # snd wi)\n   (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "show \"?f`?S = ?T\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n    {w. length w = Suc k \\<and> set w \\<subseteq> L}", "proof (rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "assume \"?f ` ?S \\<noteq> ?T\""], ["proof (state)\nthis:\n  (\\<lambda>wi. fst wi # snd wi) `\n  (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n  {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "hence \"\\<exists>w. w\\<in> ?T \\<and> w \\<notin> ?f`?S\""], ["proof (prove)\nusing this:\n  (\\<lambda>wi. fst wi # snd wi) `\n  (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n  {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. \\<exists>w.\n       w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n       w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n                  (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})", "by auto"], ["proof (state)\nthis:\n  \\<exists>w.\n     w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n     w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n                (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "then"], ["proof (chain)\npicking this:\n  \\<exists>w.\n     w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n     w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n                (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})", "obtain w where asm: \"w\\<in> ?T \\<and> w \\<notin> ?f`?S\""], ["proof (prove)\nusing this:\n  \\<exists>w.\n     w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n     w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n                (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. (\\<And>w.\n        w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n        w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n                   (L \\<times>\n                    {w. length w = k \\<and>\n                        set w \\<subseteq> L}) \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n  w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n             (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "hence \"w = ?f (hd w,tl w)\""], ["proof (prove)\nusing this:\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n  w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n             (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. w = fst (hd w, tl w) # snd (hd w, tl w)", "using k_words_rel"], ["proof (prove)\nusing this:\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n  w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n             (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n  {w. length w = Suc ?k \\<and> set w \\<subseteq> L} =\n  {w. hd w \\<in> L \\<and>\n      tl w \\<in> {w. length w = ?k \\<and> set w \\<subseteq> L} \\<and>\n      w \\<noteq> []}\n\ngoal (1 subgoal):\n 1. w = fst (hd w, tl w) # snd (hd w, tl w)", "by simp"], ["proof (state)\nthis:\n  w = fst (hd w, tl w) # snd (hd w, tl w)\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "moreover"], ["proof (state)\nthis:\n  w = fst (hd w, tl w) # snd (hd w, tl w)\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "have \"(hd w,tl w) \\<in> ?S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (hd w, tl w)\n    \\<in> L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}", "using k_words_rel asm"], ["proof (prove)\nusing this:\n  {w. length w = Suc ?k \\<and> set w \\<subseteq> L} =\n  {w. hd w \\<in> L \\<and>\n      tl w \\<in> {w. length w = ?k \\<and> set w \\<subseteq> L} \\<and>\n      w \\<noteq> []}\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n  w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n             (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. (hd w, tl w)\n    \\<in> L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}", "by simp"], ["proof (state)\nthis:\n  (hd w, tl w) \\<in> L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "ultimately"], ["proof (chain)\npicking this:\n  w = fst (hd w, tl w) # snd (hd w, tl w)\n  (hd w, tl w) \\<in> L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}", "have \"w \\<in> ?f`?S\""], ["proof (prove)\nusing this:\n  w = fst (hd w, tl w) # snd (hd w, tl w)\n  (hd w, tl w) \\<in> L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. w \\<in> (\\<lambda>wi. fst wi # snd wi) `\n            (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})", "by blast"], ["proof (state)\nthis:\n  w \\<in> (\\<lambda>wi. fst wi # snd wi) `\n          (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. (\\<lambda>wi. fst wi # snd wi) `\n    (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) \\<noteq>\n    {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    False", "thus \"False\""], ["proof (prove)\nusing this:\n  w \\<in> (\\<lambda>wi. fst wi # snd wi) `\n          (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. False", "using asm"], ["proof (prove)\nusing this:\n  w \\<in> (\\<lambda>wi. fst wi # snd wi) `\n          (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n  w \\<in> {w. length w = Suc k \\<and> set w \\<subseteq> L} \\<and>\n  w \\<notin> (\\<lambda>wi. fst wi # snd wi) `\n             (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L})\n\ngoal (1 subgoal):\n 1. False", "by simp"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (\\<lambda>wi. fst wi # snd wi) `\n  (L \\<times> {w. length w = k \\<and> set w \\<subseteq> L}) =\n  {w. length w = Suc k \\<and> set w \\<subseteq> L}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma finite_k_words: \"finite (k_words k)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite {w. length w = k \\<and> set w \\<subseteq> L}", "proof (induct k)"], ["proof (state)\ngoal (2 subgoals):\n 1. finite {w. length w = 0 \\<and> set w \\<subseteq> L}\n 2. \\<And>k.\n       finite {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n       finite {w. length w = Suc k \\<and> set w \\<subseteq> L}", "case 0"], ["proof (state)\nthis:\n  \n\ngoal (2 subgoals):\n 1. finite {w. length w = 0 \\<and> set w \\<subseteq> L}\n 2. \\<And>k.\n       finite {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n       finite {w. length w = Suc k \\<and> set w \\<subseteq> L}", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. finite {w. length w = 0 \\<and> set w \\<subseteq> L}", "by simp"], ["proof (state)\nthis:\n  finite {w. length w = 0 \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       finite {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n       finite {w. length w = Suc k \\<and> set w \\<subseteq> L}", "case (Suc n)"], ["proof (state)\nthis:\n  finite {w. length w = n \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       finite {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n       finite {w. length w = Suc k \\<and> set w \\<subseteq> L}", "thus ?case"], ["proof (prove)\nusing this:\n  finite {w. length w = n \\<and> set w \\<subseteq> L}\n\ngoal (1 subgoal):\n 1. finite {w. length w = Suc n \\<and> set w \\<subseteq> L}", "using bij_k_words bij_betw_finite fin_L"], ["proof (prove)\nusing this:\n  finite {w. length w = n \\<and> set w \\<subseteq> L}\n  bij_betw (\\<lambda>wi. fst wi # snd wi)\n   (L \\<times> {w. length w = ?k \\<and> set w \\<subseteq> L})\n   {w. length w = Suc ?k \\<and> set w \\<subseteq> L}\n  bij_betw ?f ?A ?B \\<Longrightarrow> finite ?A = finite ?B\n  finite L\n\ngoal (1 subgoal):\n 1. finite {w. length w = Suc n \\<and> set w \\<subseteq> L}", "by blast"], ["proof (state)\nthis:\n  finite {w. length w = Suc n \\<and> set w \\<subseteq> L}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma cartesian_product:\n  fixes f::\"('c \\<Rightarrow> real)\"\n  fixes g::\"('d \\<Rightarrow> real)\"\n  assumes \"finite A\"\n  assumes \"finite B\"\nshows \"(\\<Sum>b\\<in>B. g b) * (\\<Sum>a\\<in>A. f a) = (\\<Sum>ab\\<in>A\\<times>B. f (fst ab) * g (snd ab))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum g B * sum f A = (\\<Sum>ab\\<in>A \\<times> B. f (fst ab) * g (snd ab))", "using bilinear_times bilinear_sum[where h=\"(\\<lambda>x y. x * y)\" and f=\"f\" and g=\"g\"] assms"], ["proof (prove)\nusing this:\n  bilinear (*)\n  bilinear (*) \\<Longrightarrow>\n  sum f ?S * sum g ?T = (\\<Sum>(i, j)\\<in>?S \\<times> ?T. f i * g j)\n  finite A\n  finite B\n\ngoal (1 subgoal):\n 1. sum g B * sum f A = (\\<Sum>ab\\<in>A \\<times> B. f (fst ab) * g (snd ab))", "by (metis (erased, lifting) sum.cong split_beta' Groups.ab_semigroup_mult_class.mult.commute)"], ["", "lemma \\<K>_power:\nshows \"\\<K>^k = (\\<Sum>w \\<in> (k_words k). 1 / b^(cw_len_concat w))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<K> ^ k =\n    (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)", "proof (induct k)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<K> ^ 0 =\n    (\\<Sum>w | length w = 0 \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)\n 2. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "case 0"], ["proof (state)\nthis:\n  \n\ngoal (2 subgoals):\n 1. \\<K> ^ 0 =\n    (\\<Sum>w | length w = 0 \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)\n 2. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "have \"k_words 0 = {[]}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {w. length w = 0 \\<and> set w \\<subseteq> L} = {[]}", "by auto"], ["proof (state)\nthis:\n  {w. length w = 0 \\<and> set w \\<subseteq> L} = {[]}\n\ngoal (2 subgoals):\n 1. \\<K> ^ 0 =\n    (\\<Sum>w | length w = 0 \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)\n 2. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "thus ?case"], ["proof (prove)\nusing this:\n  {w. length w = 0 \\<and> set w \\<subseteq> L} = {[]}\n\ngoal (1 subgoal):\n 1. \\<K> ^ 0 =\n    (\\<Sum>w | length w = 0 \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)", "by simp"], ["proof (state)\nthis:\n  \\<K> ^ 0 =\n  (\\<Sum>w | length w = 0 \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "case (Suc n)"], ["proof (state)\nthis:\n  \\<K> ^ n =\n  (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "have \" \\<K> ^Suc n = \\<K> ^n * \\<K> \""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<K> ^ Suc n = \\<K> ^ n * \\<K>", "by simp"], ["proof (state)\nthis:\n  \\<K> ^ Suc n = \\<K> ^ n * \\<K>\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "also"], ["proof (state)\nthis:\n  \\<K> ^ Suc n = \\<K> ^ n * \\<K>\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "have \"\\<dots> = (\\<Sum>w \\<in> k_words n. 1 / b^cw_len_concat w) * (\\<Sum>i\\<in>L. 1 / b^cw_len i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<K> ^ n * \\<K> =\n    (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) *\n    (\\<Sum>i\\<in>L. 1 / b ^ cw_len i)", "using Suc.hyps \\<K>_def"], ["proof (prove)\nusing this:\n  \\<K> ^ n =\n  (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)\n  \\<K> = (\\<Sum>i\\<in>L. 1 / b ^ cw_len i)\n\ngoal (1 subgoal):\n 1. \\<K> ^ n * \\<K> =\n    (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) *\n    (\\<Sum>i\\<in>L. 1 / b ^ cw_len i)", "by auto"], ["proof (state)\nthis:\n  \\<K> ^ n * \\<K> =\n  (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w) *\n  (\\<Sum>i\\<in>L. 1 / b ^ cw_len i)\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "also"], ["proof (state)\nthis:\n  \\<K> ^ n * \\<K> =\n  (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w) *\n  (\\<Sum>i\\<in>L. 1 / b ^ cw_len i)\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "have \"\\<dots> = (\\<Sum>wi \\<in> L \\<times> k_words n. 1/b^cw_len (fst wi) * (1 / b^cw_len_concat (snd wi)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) *\n    (\\<Sum>i\\<in>L. 1 / b ^ cw_len i) =\n    (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ cw_len (fst wi) * (1 / b ^ cw_len_concat (snd wi)))", "using fin_L finite_k_words cartesian_product"], ["proof (prove)\nusing this:\n  finite L\n  finite {w. length w = ?k \\<and> set w \\<subseteq> L}\n  \\<lbrakk>finite ?A; finite ?B\\<rbrakk>\n  \\<Longrightarrow> sum ?g ?B * sum ?f ?A =\n                    (\\<Sum>ab\\<in>?A \\<times> ?B. ?f (fst ab) * ?g (snd ab))\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) *\n    (\\<Sum>i\\<in>L. 1 / b ^ cw_len i) =\n    (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ cw_len (fst wi) * (1 / b ^ cw_len_concat (snd wi)))", "by blast"], ["proof (state)\nthis:\n  (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w) *\n  (\\<Sum>i\\<in>L. 1 / b ^ cw_len i) =\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ cw_len (fst wi) * (1 / b ^ cw_len_concat (snd wi)))\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "also"], ["proof (state)\nthis:\n  (\\<Sum>w | length w = n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w) *\n  (\\<Sum>i\\<in>L. 1 / b ^ cw_len i) =\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ cw_len (fst wi) * (1 / b ^ cw_len_concat (snd wi)))\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "have \"\\<dots> = (\\<Sum>wi \\<in> L \\<times> k_words n. 1 / b^(cw_len_concat (snd wi) + cw_len (fst wi)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ cw_len (fst wi) * (1 / b ^ cw_len_concat (snd wi))) =\n    (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ (cw_len_concat (snd wi) + cw_len (fst wi)))", "by (metis (no_types, lifting) power_add add.commute power_one_over)"], ["proof (state)\nthis:\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ cw_len (fst wi) * (1 / b ^ cw_len_concat (snd wi))) =\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ (cw_len_concat (snd wi) + cw_len (fst wi)))\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "also"], ["proof (state)\nthis:\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ cw_len (fst wi) * (1 / b ^ cw_len_concat (snd wi))) =\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ (cw_len_concat (snd wi) + cw_len (fst wi)))\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "have \"\\<dots> = (\\<Sum>wi \\<in> L \\<times> k_words n. 1 / b^cw_len_concat (fst wi # snd wi))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ (cw_len_concat (snd wi) + cw_len (fst wi))) =\n    (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ cw_len_concat (fst wi # snd wi))", "by (metis (erased, lifting) add.commute comp_apply foldr.simps(2))"], ["proof (state)\nthis:\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ (cw_len_concat (snd wi) + cw_len (fst wi))) =\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ cw_len_concat (fst wi # snd wi))\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "also"], ["proof (state)\nthis:\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ (cw_len_concat (snd wi) + cw_len (fst wi))) =\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ cw_len_concat (fst wi # snd wi))\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "have \"\\<dots> = (\\<Sum>w \\<in> (k_words (Suc n)). 1 / b^(cw_len_concat w))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ cw_len_concat (fst wi # snd wi)) =\n    (\\<Sum>w | length w = Suc n \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)", "using bij_k_words sum.reindex_bij_betw"], ["proof (prove)\nusing this:\n  bij_betw (\\<lambda>wi. fst wi # snd wi)\n   (L \\<times> {w. length w = ?k \\<and> set w \\<subseteq> L})\n   {w. length w = Suc ?k \\<and> set w \\<subseteq> L}\n  bij_betw ?h ?S ?T \\<Longrightarrow>\n  (\\<Sum>x\\<in>?S. ?g (?h x)) = sum ?g ?T\n\ngoal (1 subgoal):\n 1. (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n       1 / b ^ cw_len_concat (fst wi # snd wi)) =\n    (\\<Sum>w | length w = Suc n \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)", "by fastforce"], ["proof (state)\nthis:\n  (\\<Sum>wi\\<in>L \\<times> {w. length w = n \\<and> set w \\<subseteq> L}.\n     1 / b ^ cw_len_concat (fst wi # snd wi)) =\n  (\\<Sum>w | length w = Suc n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       \\<K> ^ k =\n       (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w) \\<Longrightarrow>\n       \\<K> ^ Suc k =\n       (\\<Sum>w | length w = Suc k \\<and> set w \\<subseteq> L.\n          1 / b ^ cw_len_concat w)", "finally"], ["proof (chain)\npicking this:\n  \\<K> ^ Suc n =\n  (\\<Sum>w | length w = Suc n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)", "show ?case"], ["proof (prove)\nusing this:\n  \\<K> ^ Suc n =\n  (\\<Sum>w | length w = Suc n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)\n\ngoal (1 subgoal):\n 1. \\<K> ^ Suc n =\n    (\\<Sum>w | length w = Suc n \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w)", "by simp"], ["proof (state)\nthis:\n  \\<K> ^ Suc n =\n  (\\<Sum>w | length w = Suc n \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bound_len_concat:\nshows \"w \\<in> k_words k \\<Longrightarrow> cw_len_concat w \\<le> k * max_len\""], ["proof (prove)\ngoal (1 subgoal):\n 1. w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    cw_len_concat w \\<le> k * max_len", "using max_cw maj_fold"], ["proof (prove)\nusing this:\n  ?l \\<in> L \\<Longrightarrow> cw_len ?l \\<le> max_len\n  \\<lbrakk>\\<And>l. l \\<in> L \\<Longrightarrow> ?f l \\<le> ?bound;\n   set ?w \\<subseteq> L\\<rbrakk>\n  \\<Longrightarrow> foldr (\\<lambda>x. (+) (?f x)) ?w 0\n                    \\<le> length ?w * ?bound\n\ngoal (1 subgoal):\n 1. w \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n    cw_len_concat w \\<le> k * max_len", "by blast"], ["", "subsection\\<open>Inequality of the kraft sum (source coding theorem, direct)\\<close>"], ["", "subsubsection\\<open>Sum manipulation lemmas and McMillan theorem\\<close>"], ["", "lemma sum_vimage_proof:\n  fixes g::\"nat \\<Rightarrow> real\"\n  assumes \"\\<And>w. f w < bd\"\nshows \"finite S \\<Longrightarrow> (\\<Sum>w\\<in>S. g (f w)) = (\\<Sum> m=0..<bd. (card ((f-`{m}) \\<inter> S) )* g m)\"\n(is \"_ \\<Longrightarrow> _ = (\\<Sum> m=0..<bd. ?ff m S)\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. finite S \\<Longrightarrow>\n    (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "proof (induct S rule: finite_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. (\\<Sum>w\\<in>{}. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> {})) * g m)\n 2. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "case empty"], ["proof (state)\nthis:\n  \n\ngoal (2 subgoals):\n 1. (\\<Sum>w\\<in>{}. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> {})) * g m)\n 2. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>{}. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> {})) * g m)", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>w\\<in>{}. g (f w)) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> {})) * g m)\n\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "case (insert x F)"], ["proof (state)\nthis:\n  finite F\n  x \\<notin> F\n  (\\<Sum>w\\<in>F. g (f w)) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\n\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "let ?rr = \"(\\<Sum>m = 0..<bd. ?ff m (insert x F))\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "have \"(f x) \\<in> {0..<bd}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f x \\<in> {0..<bd}", "using assms"], ["proof (prove)\nusing this:\n  f ?w14 < bd\n\ngoal (1 subgoal):\n 1. f x \\<in> {0..<bd}", "by simp"], ["proof (state)\nthis:\n  f x \\<in> {0..<bd}\n\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "hence \"\\<And>h::(nat \\<Rightarrow> real). (\\<Sum>m=0..<bd. h m) = (\\<Sum>y\\<in>({0..<bd} - {f x}).h y) + h (f x)\""], ["proof (prove)\nusing this:\n  f x \\<in> {0..<bd}\n\ngoal (1 subgoal):\n 1. \\<And>h. sum h {0..<bd} = sum h ({0..<bd} - {f x}) + h (f x)", "by (metis diff_add_cancel finite_atLeastLessThan sum_diff1)"], ["proof (state)\nthis:\n  sum ?h14 {0..<bd} = sum ?h14 ({0..<bd} - {f x}) + ?h14 (f x)\n\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "moreover"], ["proof (state)\nthis:\n  sum ?h14 {0..<bd} = sum ?h14 ({0..<bd} - {f x}) + ?h14 (f x)\n\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "hence\n    \"(\\<Sum>m = 0..<bd. ?ff m (insert x F))\n    = (\\<Sum>m\\<in>{0..<bd} - {f x}. ?ff m (insert x F)) + card (f -` {f x} \\<inter> F) * g (f x) + g (f x)\""], ["proof (prove)\nusing this:\n  sum ?h14 {0..<bd} = sum ?h14 ({0..<bd} - {f x}) + ?h14 (f x)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n    (\\<Sum>m\\<in>{0..<bd} - {f x}.\n       real (card (f -` {m} \\<inter> insert x F)) * g m) +\n    real (card (f -` {f x} \\<inter> F)) * g (f x) +\n    g (f x)", "by (simp add: semiring_normalization_rules(2), simp add: insert)"], ["proof (state)\nthis:\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n  (\\<Sum>m\\<in>{0..<bd} - {f x}.\n     real (card (f -` {m} \\<inter> insert x F)) * g m) +\n  real (card (f -` {f x} \\<inter> F)) * g (f x) +\n  g (f x)\n\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "ultimately"], ["proof (chain)\npicking this:\n  sum ?h14 {0..<bd} = sum ?h14 ({0..<bd} - {f x}) + ?h14 (f x)\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n  (\\<Sum>m\\<in>{0..<bd} - {f x}.\n     real (card (f -` {m} \\<inter> insert x F)) * g m) +\n  real (card (f -` {f x} \\<inter> F)) * g (f x) +\n  g (f x)", "have \"(\\<Sum>m = 0..<bd. ?ff m (insert x F)) = (\\<Sum>m\\<in>{0..<bd}. ?ff m F) + g (f x)\""], ["proof (prove)\nusing this:\n  sum ?h14 {0..<bd} = sum ?h14 ({0..<bd} - {f x}) + ?h14 (f x)\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n  (\\<Sum>m\\<in>{0..<bd} - {f x}.\n     real (card (f -` {m} \\<inter> insert x F)) * g m) +\n  real (card (f -` {f x} \\<inter> F)) * g (f x) +\n  g (f x)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m) + g (f x)", "by fastforce"], ["proof (state)\nthis:\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m) + g (f x)\n\ngoal (1 subgoal):\n 1. \\<And>x F.\n       \\<lbrakk>finite F; x \\<notin> F;\n        (\\<Sum>w\\<in>F. g (f w)) =\n        (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>w\\<in>insert x F. g (f w)) =\n                         (\\<Sum>m = 0..<bd.\n                             real (card (f -` {m} \\<inter> insert x F)) *\n                             g m)", "thus ?case"], ["proof (prove)\nusing this:\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m) + g (f x)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>insert x F. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m)", "using insert"], ["proof (prove)\nusing this:\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m) + g (f x)\n  finite F\n  x \\<notin> F\n  (\\<Sum>w\\<in>F. g (f w)) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> F)) * g m)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>insert x F. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m)", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>w\\<in>insert x F. g (f w)) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> insert x F)) * g m)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sum_vimage:\n  fixes g::\"nat \\<Rightarrow> real\"\n  assumes bounded: \"\\<And>w. w \\<in> S \\<Longrightarrow> f w < bd\" and \"0 < bd\"\n  assumes finite: \"finite S\"\nshows \"(\\<Sum>w\\<in>S. g (f w)) = (\\<Sum> m=0..<bd. (card ((f-`{m}) \\<inter> S) ) * g m)\"\n(is \"?s1 = ?s2\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "let ?ff = \"(\\<lambda>x. if x\\<in>S then f x else 0)\""], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "let ?ss1 = \"(\\<Sum>w\\<in>S. g (?ff w))\""], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "let ?ss2 = \"(\\<Sum> m=0..<bd. (card ((?ff-`{m}) \\<inter> S) ) * g m)\""], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "have \"?s1 =?ss1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0))", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>w\\<in>S. g (f w)) =\n  (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0))\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "moreover"], ["proof (state)\nthis:\n  (\\<Sum>w\\<in>S. g (f w)) =\n  (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0))\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "have\"\\<And>m. ?ff -`{m} \\<inter> S = f-`{m} \\<inter> S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>m.\n       (\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S =\n       f -` {m} \\<inter> S", "by auto"], ["proof (state)\nthis:\n  (\\<lambda>x. if x \\<in> S then f x else 0) -` {?m14} \\<inter> S =\n  f -` {?m14} \\<inter> S\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "moreover"], ["proof (state)\nthis:\n  (\\<lambda>x. if x \\<in> S then f x else 0) -` {?m14} \\<inter> S =\n  f -` {?m14} \\<inter> S\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "hence \"?s2 = ?ss2\""], ["proof (prove)\nusing this:\n  (\\<lambda>x. if x \\<in> S then f x else 0) -` {?m14} \\<inter> S =\n  f -` {?m14} \\<inter> S\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m) =\n    (\\<Sum>m = 0..<bd.\n        real\n         (card\n           ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n        g m)", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m) =\n  (\\<Sum>m = 0..<bd.\n      real\n       (card\n         ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n      g m)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "moreover"], ["proof (state)\nthis:\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m) =\n  (\\<Sum>m = 0..<bd.\n      real\n       (card\n         ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n      g m)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "have \"\\<And>w . ?ff w < bd\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>w. (if w \\<in> S then f w else 0) < bd", "using assms"], ["proof (prove)\nusing this:\n  ?w14 \\<in> S \\<Longrightarrow> f ?w14 < bd\n  0 < bd\n  finite S\n\ngoal (1 subgoal):\n 1. \\<And>w. (if w \\<in> S then f w else 0) < bd", "by simp"], ["proof (state)\nthis:\n  (if ?w14 \\<in> S then f ?w14 else 0) < bd\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "moreover"], ["proof (state)\nthis:\n  (if ?w14 \\<in> S then f ?w14 else 0) < bd\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "hence \"?ss1 = ?ss2\""], ["proof (prove)\nusing this:\n  (if ?w14 \\<in> S then f ?w14 else 0) < bd\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0)) =\n    (\\<Sum>m = 0..<bd.\n        real\n         (card\n           ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n        g m)", "using sum_vimage_proof[of \"?ff\"] finite"], ["proof (prove)\nusing this:\n  (if ?w14 \\<in> S then f ?w14 else 0) < bd\n  \\<lbrakk>\\<And>w. (if w \\<in> S then f w else 0) < ?bd; finite ?S\\<rbrakk>\n  \\<Longrightarrow> (\\<Sum>w\\<in>?S. ?g (if w \\<in> S then f w else 0)) =\n                    (\\<Sum>m = 0..<?bd.\n                        real\n                         (card\n                           ((\\<lambda>x. if x \\<in> S then f x else 0) -`\n                            {m} \\<inter>\n                            ?S)) *\n                        ?g m)\n  finite S\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0)) =\n    (\\<Sum>m = 0..<bd.\n        real\n         (card\n           ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n        g m)", "by blast"], ["proof (state)\nthis:\n  (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0)) =\n  (\\<Sum>m = 0..<bd.\n      real\n       (card\n         ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n      g m)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "ultimately"], ["proof (chain)\npicking this:\n  (\\<Sum>w\\<in>S. g (f w)) =\n  (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0))\n  (\\<lambda>x. if x \\<in> S then f x else 0) -` {?m14} \\<inter> S =\n  f -` {?m14} \\<inter> S\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m) =\n  (\\<Sum>m = 0..<bd.\n      real\n       (card\n         ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n      g m)\n  (if ?w14 \\<in> S then f ?w14 else 0) < bd\n  (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0)) =\n  (\\<Sum>m = 0..<bd.\n      real\n       (card\n         ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n      g m)", "show \"?s1 = ?s2\""], ["proof (prove)\nusing this:\n  (\\<Sum>w\\<in>S. g (f w)) =\n  (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0))\n  (\\<lambda>x. if x \\<in> S then f x else 0) -` {?m14} \\<inter> S =\n  f -` {?m14} \\<inter> S\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m) =\n  (\\<Sum>m = 0..<bd.\n      real\n       (card\n         ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n      g m)\n  (if ?w14 \\<in> S then f ?w14 else 0) < bd\n  (\\<Sum>w\\<in>S. g (if w \\<in> S then f w else 0)) =\n  (\\<Sum>m = 0..<bd.\n      real\n       (card\n         ((\\<lambda>x. if x \\<in> S then f x else 0) -` {m} \\<inter> S)) *\n      g m)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w\\<in>S. g (f w)) =\n    (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)", "by metis"], ["proof (state)\nthis:\n  (\\<Sum>w\\<in>S. g (f w)) =\n  (\\<Sum>m = 0..<bd. real (card (f -` {m} \\<inter> S)) * g m)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma \\<K>_rw:\n  \"(\\<Sum>w \\<in> (k_words k). 1 / b^(cw_len_concat w)) = (\\<Sum>m=0..<Suc (k*max_len). card (k_words k \\<inter>\n((cw_len_concat) -` {m})) * (1 / b^m))\" (is \"?L = ?R\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "have \"\\<And>w. w \\<in> k_words k \\<Longrightarrow> cw_len_concat w < Suc ( k * max_len)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>w.\n       w \\<in> {w. length w = k \\<and>\n                   set w \\<subseteq> L} \\<Longrightarrow>\n       cw_len_concat w < Suc (k * max_len)", "by (simp add: bound_len_concat le_imp_less_Suc)"], ["proof (state)\nthis:\n  ?w14 \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n  cw_len_concat ?w14 < Suc (k * max_len)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "moreover"], ["proof (state)\nthis:\n  ?w14 \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n  cw_len_concat ?w14 < Suc (k * max_len)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "have\n    \"?R = (\\<Sum>m = 0..<Suc (k * max_len).\n  (card (cw_len_concat -` {m} \\<inter> k_words k)) * (1 / b ^ m))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m)) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           (cw_len_concat -` {m} \\<inter>\n            {w. length w = k \\<and> set w \\<subseteq> L})) *\n        (1 / b ^ m))", "by (metis Int_commute)"], ["proof (state)\nthis:\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n          cw_len_concat -` {m})) *\n      (1 / b ^ m)) =\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         (cw_len_concat -` {m} \\<inter>\n          {w. length w = k \\<and> set w \\<subseteq> L})) *\n      (1 / b ^ m))\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "moreover"], ["proof (state)\nthis:\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n          cw_len_concat -` {m})) *\n      (1 / b ^ m)) =\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         (cw_len_concat -` {m} \\<inter>\n          {w. length w = k \\<and> set w \\<subseteq> L})) *\n      (1 / b ^ m))\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "have \"0 < Suc (k*max_len)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < Suc (k * max_len)", "by simp"], ["proof (state)\nthis:\n  0 < Suc (k * max_len)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "ultimately"], ["proof (chain)\npicking this:\n  ?w14 \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n  cw_len_concat ?w14 < Suc (k * max_len)\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n          cw_len_concat -` {m})) *\n      (1 / b ^ m)) =\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         (cw_len_concat -` {m} \\<inter>\n          {w. length w = k \\<and> set w \\<subseteq> L})) *\n      (1 / b ^ m))\n  0 < Suc (k * max_len)", "show ?thesis"], ["proof (prove)\nusing this:\n  ?w14 \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n  cw_len_concat ?w14 < Suc (k * max_len)\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n          cw_len_concat -` {m})) *\n      (1 / b ^ m)) =\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         (cw_len_concat -` {m} \\<inter>\n          {w. length w = k \\<and> set w \\<subseteq> L})) *\n      (1 / b ^ m))\n  0 < Suc (k * max_len)\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "using finite_k_words\n    sum_vimage[where f=\"cw_len_concat\" and g = \"\\<lambda>i. 1/ (b^i)\"]"], ["proof (prove)\nusing this:\n  ?w14 \\<in> {w. length w = k \\<and> set w \\<subseteq> L} \\<Longrightarrow>\n  cw_len_concat ?w14 < Suc (k * max_len)\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n          cw_len_concat -` {m})) *\n      (1 / b ^ m)) =\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         (cw_len_concat -` {m} \\<inter>\n          {w. length w = k \\<and> set w \\<subseteq> L})) *\n      (1 / b ^ m))\n  0 < Suc (k * max_len)\n  finite {w. length w = ?k \\<and> set w \\<subseteq> L}\n  \\<lbrakk>\\<And>w. w \\<in> ?S \\<Longrightarrow> cw_len_concat w < ?bd;\n   0 < ?bd; finite ?S\\<rbrakk>\n  \\<Longrightarrow> (\\<Sum>w\\<in>?S. 1 / b ^ cw_len_concat w) =\n                    (\\<Sum>m = 0..<?bd.\n                        real (card (cw_len_concat -` {m} \\<inter> ?S)) *\n                        (1 / b ^ m))\n\ngoal (1 subgoal):\n 1. (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n       1 / b ^ cw_len_concat w) =\n    (\\<Sum>m = 0..<Suc (k * max_len).\n        real\n         (card\n           ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n            cw_len_concat -` {m})) *\n        (1 / b ^ m))", "by fastforce"], ["proof (state)\nthis:\n  (\\<Sum>w | length w = k \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w) =\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real\n       (card\n         ({w. length w = k \\<and> set w \\<subseteq> L} \\<inter>\n          cw_len_concat -` {m})) *\n      (1 / b ^ m))\n\ngoal:\nNo subgoals!", "qed"], ["", "definition set_of_k_words_length_m :: \"nat \\<Rightarrow> nat \\<Rightarrow> 'b word set\" where\n  \"set_of_k_words_length_m k m = {xk. xk \\<in> k_words k} \\<inter> (cw_len_concat)-`{m}\""], ["", "lemma am_inj_code: \"inj_on enc ((cw_len_concat)-`{m})\" (is \"inj_on _ ?s\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. inj_on enc (cw_len_concat -` {m})", "using inj_on_def[of enc \"?s\"] real_code"], ["proof (prove)\nusing this:\n  inj_on enc (cw_len_concat -` {m}) =\n  (\\<forall>x\\<in>cw_len_concat -` {m}.\n      \\<forall>y\\<in>cw_len_concat -` {m}.\n         enc x = enc y \\<longrightarrow> x = y)\n  dec (enc ?x) = Some ?x\n  (enc ?w = []) = (?w = [])\n  ?x \\<noteq> [] \\<longrightarrow> enc ?x = enc [hd ?x] @ enc (tl ?x)\n\ngoal (1 subgoal):\n 1. inj_on enc (cw_len_concat -` {m})", "by (metis option.inject)"], ["", "lemma img_inc: \"enc`cw_len_concat-`{m} \\<subseteq> {bl. length bl = m}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. enc ` cw_len_concat -` {m} \\<subseteq> {bl. length bl = m}", "using cw_len_length"], ["proof (prove)\nusing this:\n  cw_len_concat ?w = length (enc ?w)\n\ngoal (1 subgoal):\n 1. enc ` cw_len_concat -` {m} \\<subseteq> {bl. length bl = m}", "by auto"], ["", "lemma bool_lists_card: \"card {bl::bool list. length bl = m} = b^m\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real (card {bl. length bl = m}) = b ^ m", "using card_lists_length_eq[of \"UNIV::bool set\"]"], ["proof (prove)\nusing this:\n  finite UNIV \\<Longrightarrow>\n  card {xs. set xs \\<subseteq> UNIV \\<and> length xs = ?n} = CARD(bool) ^ ?n\n\ngoal (1 subgoal):\n 1. real (card {bl. length bl = m}) = b ^ m", "by (simp add: b_val)"], ["", "lemma bool_list_fin: \"finite {bl::bool list. length bl = m}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite {bl. length bl = m}", "using finite_lists_length_eq[of \"UNIV::bool set\"]"], ["proof (prove)\nusing this:\n  finite UNIV \\<Longrightarrow>\n  finite {xs. set xs \\<subseteq> UNIV \\<and> length xs = ?n}\n\ngoal (1 subgoal):\n 1. finite {bl. length bl = m}", "by (simp add: b_val)"], ["", "lemma set_of_k_words_bound:\nshows \"card (set_of_k_words_length_m k m) \\<le> b^m\" (is \"?c \\<le> ?b\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. real (card (set_of_k_words_length_m k m)) \\<le> b ^ m", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. real (card (set_of_k_words_length_m k m)) \\<le> b ^ m", "have card_w_len_m_bound: \"card (cw_len_concat-`{m}) \\<le> b^m\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real (card (cw_len_concat -` {m})) \\<le> b ^ m", "by (metis (no_types, lifting) am_inj_code bool_list_fin bool_lists_card card_image card_mono\n    img_inc of_nat_le_iff)"], ["proof (state)\nthis:\n  real (card (cw_len_concat -` {m})) \\<le> b ^ m\n\ngoal (1 subgoal):\n 1. real (card (set_of_k_words_length_m k m)) \\<le> b ^ m", "have \"set_of_k_words_length_m k m \\<subseteq> (cw_len_concat)-`{m}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k m \\<subseteq> cw_len_concat -` {m}", "by (simp add: set_of_k_words_length_m_def)"], ["proof (state)\nthis:\n  set_of_k_words_length_m k m \\<subseteq> cw_len_concat -` {m}\n\ngoal (1 subgoal):\n 1. real (card (set_of_k_words_length_m k m)) \\<le> b ^ m", "hence \"card (set_of_k_words_length_m k m) \\<le> card ((cw_len_concat)-`{m})\""], ["proof (prove)\nusing this:\n  set_of_k_words_length_m k m \\<subseteq> cw_len_concat -` {m}\n\ngoal (1 subgoal):\n 1. card (set_of_k_words_length_m k m) \\<le> card (cw_len_concat -` {m})", "by (metis (no_types, lifting) am_inj_code bool_list_fin card.infinite card_0_eq\n    card_image card_mono empty_iff finite_subset img_inc inf_img_fin_dom)"], ["proof (state)\nthis:\n  card (set_of_k_words_length_m k m) \\<le> card (cw_len_concat -` {m})\n\ngoal (1 subgoal):\n 1. real (card (set_of_k_words_length_m k m)) \\<le> b ^ m", "thus ?thesis"], ["proof (prove)\nusing this:\n  card (set_of_k_words_length_m k m) \\<le> card (cw_len_concat -` {m})\n\ngoal (1 subgoal):\n 1. real (card (set_of_k_words_length_m k m)) \\<le> b ^ m", "using card_w_len_m_bound"], ["proof (prove)\nusing this:\n  card (set_of_k_words_length_m k m) \\<le> card (cw_len_concat -` {m})\n  real (card (cw_len_concat -` {m})) \\<le> b ^ m\n\ngoal (1 subgoal):\n 1. real (card (set_of_k_words_length_m k m)) \\<le> b ^ m", "by simp"], ["proof (state)\nthis:\n  real (card (set_of_k_words_length_m k m)) \\<le> b ^ m\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma empty_set_k_words:\n  assumes \"0 < k\"\nshows \"set_of_k_words_length_m k 0 = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 = {}", "proof(rule ccontr)"], ["proof (state)\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "assume \"\\<not> set_of_k_words_length_m k 0 = {}\""], ["proof (state)\nthis:\n  set_of_k_words_length_m k 0 \\<noteq> {}\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "hence \"\\<exists>x. x \\<in> set_of_k_words_length_m k 0\""], ["proof (prove)\nusing this:\n  set_of_k_words_length_m k 0 \\<noteq> {}\n\ngoal (1 subgoal):\n 1. \\<exists>x. x \\<in> set_of_k_words_length_m k 0", "by auto"], ["proof (state)\nthis:\n  \\<exists>x. x \\<in> set_of_k_words_length_m k 0\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "then"], ["proof (chain)\npicking this:\n  \\<exists>x. x \\<in> set_of_k_words_length_m k 0", "obtain x where x_def: \"x \\<in> set_of_k_words_length_m k 0\""], ["proof (prove)\nusing this:\n  \\<exists>x. x \\<in> set_of_k_words_length_m k 0\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        x \\<in> set_of_k_words_length_m k 0 \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  x \\<in> set_of_k_words_length_m k 0\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "hence \"x \\<noteq> []\""], ["proof (prove)\nusing this:\n  x \\<in> set_of_k_words_length_m k 0\n\ngoal (1 subgoal):\n 1. x \\<noteq> []", "unfolding set_of_k_words_length_m_def"], ["proof (prove)\nusing this:\n  x \\<in> {xk.\n           xk \\<in> {w. length w = k \\<and> set w \\<subseteq> L}} \\<inter>\n          cw_len_concat -` {0}\n\ngoal (1 subgoal):\n 1. x \\<noteq> []", "using assms"], ["proof (prove)\nusing this:\n  x \\<in> {xk.\n           xk \\<in> {w. length w = k \\<and> set w \\<subseteq> L}} \\<inter>\n          cw_len_concat -` {0}\n  0 < k\n\ngoal (1 subgoal):\n 1. x \\<noteq> []", "by auto"], ["proof (state)\nthis:\n  x \\<noteq> []\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  x \\<noteq> []\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "have \"cw_len_concat (hd x#tl x) = cw_len_concat (tl x) + cw_len (hd x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. cw_len_concat (hd x # tl x) = cw_len_concat (tl x) + cw_len (hd x)", "by (metis add.commute comp_apply foldr.simps(2))"], ["proof (state)\nthis:\n  cw_len_concat (hd x # tl x) = cw_len_concat (tl x) + cw_len (hd x)\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  cw_len_concat (hd x # tl x) = cw_len_concat (tl x) + cw_len (hd x)\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "have \"enc [(hd x)] \\<noteq> []\""], ["proof (prove)\ngoal (1 subgoal):\n 1. enc [hd x] \\<noteq> []", "using assms real_code"], ["proof (prove)\nusing this:\n  0 < k\n  dec (enc ?x) = Some ?x\n  (enc ?w = []) = (?w = [])\n  ?x \\<noteq> [] \\<longrightarrow> enc ?x = enc [hd ?x] @ enc (tl ?x)\n\ngoal (1 subgoal):\n 1. enc [hd x] \\<noteq> []", "by blast"], ["proof (state)\nthis:\n  enc [hd x] \\<noteq> []\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "moreover"], ["proof (state)\nthis:\n  enc [hd x] \\<noteq> []\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "hence \"0 < cw_len (hd x)\""], ["proof (prove)\nusing this:\n  enc [hd x] \\<noteq> []\n\ngoal (1 subgoal):\n 1. 0 < cw_len (hd x)", "unfolding code_word_length_def"], ["proof (prove)\nusing this:\n  enc [hd x] \\<noteq> []\n\ngoal (1 subgoal):\n 1. 0 < length (enc [hd x])", "by simp"], ["proof (state)\nthis:\n  0 < cw_len (hd x)\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "ultimately"], ["proof (chain)\npicking this:\n  x \\<noteq> []\n  cw_len_concat (hd x # tl x) = cw_len_concat (tl x) + cw_len (hd x)\n  enc [hd x] \\<noteq> []\n  0 < cw_len (hd x)", "have \"x \\<notin> set_of_k_words_length_m k 0\""], ["proof (prove)\nusing this:\n  x \\<noteq> []\n  cw_len_concat (hd x # tl x) = cw_len_concat (tl x) + cw_len (hd x)\n  enc [hd x] \\<noteq> []\n  0 < cw_len (hd x)\n\ngoal (1 subgoal):\n 1. x \\<notin> set_of_k_words_length_m k 0", "by (simp add:set_of_k_words_length_m_def)"], ["proof (state)\nthis:\n  x \\<notin> set_of_k_words_length_m k 0\n\ngoal (1 subgoal):\n 1. set_of_k_words_length_m k 0 \\<noteq> {} \\<Longrightarrow> False", "thus \"False\""], ["proof (prove)\nusing this:\n  x \\<notin> set_of_k_words_length_m k 0\n\ngoal (1 subgoal):\n 1. False", "using x_def"], ["proof (prove)\nusing this:\n  x \\<notin> set_of_k_words_length_m k 0\n  x \\<in> set_of_k_words_length_m k 0\n\ngoal (1 subgoal):\n 1. False", "by simp"], ["proof (state)\nthis:\n  False\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma \\<K>_rw2:\n  assumes \"0 < k\"\nshows \"(\\<Sum>m=0..<Suc (k * max_len). card (set_of_k_words_length_m k m)/ b^m) \\<le> (k * max_len)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "have\n    \"(\\<Sum>m=1..<Suc (k * max_len). card (set_of_k_words_length_m k m) / b^m)\n    \\<le> (\\<Sum>m=1..<Suc(k * max_len). b^m / b^m)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>m = 1..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m)", "using set_of_k_words_bound b_val\n    Groups_Big.sum_mono[of \"{1..<Suc(k * max_len)}\"\n    \"(\\<lambda>m. (card (set_of_k_words_length_m k m))/b^m)\" \"\\<lambda>m. b^m /b^m\"]"], ["proof (prove)\nusing this:\n  real (card (set_of_k_words_length_m ?k ?m)) \\<le> b ^ ?m\n  b = 2\n  (\\<And>i.\n      i \\<in> {1..<Suc (k * max_len)} \\<Longrightarrow>\n      real (card (set_of_k_words_length_m k i)) / b ^ i\n      \\<le> b ^ i / b ^ i) \\<Longrightarrow>\n  (\\<Sum>i = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k i)) / b ^ i)\n  \\<le> (\\<Sum>i = 1..<Suc (k * max_len). b ^ i / b ^ i)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 1..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m)", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>m = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "moreover"], ["proof (state)\nthis:\n  (\\<Sum>m = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "have\"(\\<Sum>m=1..<Suc(k * max_len). b^m / b^m) = (\\<Sum>m=1..<Suc(k *max_len). 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m) =\n    (\\<Sum>m = 1..<Suc (k * max_len). 1)", "using b_gt_1"], ["proof (prove)\nusing this:\n  1 < b\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m) =\n    (\\<Sum>m = 1..<Suc (k * max_len). 1)", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m) =\n  (\\<Sum>m = 1..<Suc (k * max_len). 1)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "moreover"], ["proof (state)\nthis:\n  (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m) =\n  (\\<Sum>m = 1..<Suc (k * max_len). 1)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "have \"(\\<Sum>m=1..<Suc(k * max_len). 1) = (k * max_len)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>m = 1..<Suc (k * max_len). 1) = k * max_len", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>m = 1..<Suc (k * max_len). 1) = k * max_len\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "ultimately"], ["proof (chain)\npicking this:\n  (\\<Sum>m = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m)\n  (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m) =\n  (\\<Sum>m = 1..<Suc (k * max_len). 1)\n  (\\<Sum>m = 1..<Suc (k * max_len). 1) = k * max_len", "have\n    \"(\\<Sum>m = 1..<Suc (k * max_len). card (set_of_k_words_length_m k m) / b ^ m) \\<le> k * max_len\""], ["proof (prove)\nusing this:\n  (\\<Sum>m = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m)\n  (\\<Sum>m = 1..<Suc (k * max_len). b ^ m / b ^ m) =\n  (\\<Sum>m = 1..<Suc (k * max_len). 1)\n  (\\<Sum>m = 1..<Suc (k * max_len). 1) = k * max_len\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 1..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "by (metis One_nat_def card_atLeastLessThan card_eq_sum diff_Suc_Suc real_of_card)"], ["proof (state)\nthis:\n  (\\<Sum>m = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> real (k * max_len)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "thus ?thesis"], ["proof (prove)\nusing this:\n  (\\<Sum>m = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> real (k * max_len)\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "using empty_set_k_words assms"], ["proof (prove)\nusing this:\n  (\\<Sum>m = 1..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> real (k * max_len)\n  0 < ?k \\<Longrightarrow> set_of_k_words_length_m ?k 0 = {}\n  0 < k\n\ngoal (1 subgoal):\n 1. (\\<Sum>m = 0..<Suc (k * max_len).\n        real (card (set_of_k_words_length_m k m)) / b ^ m)\n    \\<le> real (k * max_len)", "by (simp add: sum_shift_lb_Suc0_0_upt split: if_split_asm)"], ["proof (state)\nthis:\n  (\\<Sum>m = 0..<Suc (k * max_len).\n      real (card (set_of_k_words_length_m k m)) / b ^ m)\n  \\<le> real (k * max_len)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma \\<K>_power_bound :\n  assumes \"0 < k\"\nshows \" \\<K>^k \\<le> k * max_len\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<K> ^ k \\<le> real (k * max_len)", "using assms \\<K>_power \\<K>_rw \\<K>_rw2"], ["proof (prove)\nusing this:\n  0 < k\n  \\<K> ^ ?k =\n  (\\<Sum>w | length w = ?k \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w)\n  (\\<Sum>w | length w = ?k \\<and> set w \\<subseteq> L.\n     1 / b ^ cw_len_concat w) =\n  (\\<Sum>m = 0..<Suc (?k * max_len).\n      real\n       (card\n         ({w. length w = ?k \\<and> set w \\<subseteq> L} \\<inter>\n          cw_len_concat -` {m})) *\n      (1 / b ^ m))\n  0 < ?k \\<Longrightarrow>\n  (\\<Sum>m = 0..<Suc (?k * max_len).\n      real (card (set_of_k_words_length_m ?k m)) / b ^ m)\n  \\<le> real (?k * max_len)\n\ngoal (1 subgoal):\n 1. \\<K> ^ k \\<le> real (k * max_len)", "by (simp add: set_of_k_words_length_m_def)"], ["", "theorem McMillan :\nshows \"\\<K> \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "have ineq: \"\\<And>k. 0 < k \\<Longrightarrow> \\<K> \\<le> root k k * root k max_len\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>k.\n       0 < k \\<Longrightarrow>\n       \\<K> \\<le> root k (real k) * root k (real max_len)", "using \\<K>_pos \\<K>_power_bound"], ["proof (prove)\nusing this:\n  0 < \\<K>\n  0 < ?k \\<Longrightarrow> \\<K> ^ ?k \\<le> real (?k * max_len)\n\ngoal (1 subgoal):\n 1. \\<And>k.\n       0 < k \\<Longrightarrow>\n       \\<K> \\<le> root k (real k) * root k (real max_len)", "by (metis (no_types, hide_lams) not_less of_nat_0_le_iff of_nat_mult power_strict_mono real_root_mult real_root_pos_pos_le real_root_pos_unique real_root_power)"], ["proof (state)\nthis:\n  0 < ?k14 \\<Longrightarrow>\n  \\<K> \\<le> root ?k14 (real ?k14) * root ?k14 (real max_len)\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "hence \"0 < max_len \\<Longrightarrow> (\\<lambda>k. root k k * root k max_len) \\<longlonglongrightarrow> 1\""], ["proof (prove)\nusing this:\n  0 < ?k14 \\<Longrightarrow>\n  \\<K> \\<le> root ?k14 (real ?k14) * root ?k14 (real max_len)\n\ngoal (1 subgoal):\n 1. 0 < max_len \\<Longrightarrow>\n    (\\<lambda>k. root k (real k) * root k (real max_len))\n    \\<longlonglongrightarrow> 1", "by (auto intro!: tendsto_eq_intros LIMSEQ_root LIMSEQ_root_const)"], ["proof (state)\nthis:\n  0 < max_len \\<Longrightarrow>\n  (\\<lambda>k. root k (real k) * root k (real max_len))\n  \\<longlonglongrightarrow> 1\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "moreover"], ["proof (state)\nthis:\n  0 < max_len \\<Longrightarrow>\n  (\\<lambda>k. root k (real k) * root k (real max_len))\n  \\<longlonglongrightarrow> 1\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "have \"\\<forall>n\\<ge>1. \\<K> \\<le> root n n * root n max_len\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>n\\<ge>1. \\<K> \\<le> root n (real n) * root n (real max_len)", "using ineq"], ["proof (prove)\nusing this:\n  0 < ?k14 \\<Longrightarrow>\n  \\<K> \\<le> root ?k14 (real ?k14) * root ?k14 (real max_len)\n\ngoal (1 subgoal):\n 1. \\<forall>n\\<ge>1. \\<K> \\<le> root n (real n) * root n (real max_len)", "by simp"], ["proof (state)\nthis:\n  \\<forall>n\\<ge>1. \\<K> \\<le> root n (real n) * root n (real max_len)\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "moreover"], ["proof (state)\nthis:\n  \\<forall>n\\<ge>1. \\<K> \\<le> root n (real n) * root n (real max_len)\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "have \"max_len = 0 \\<Longrightarrow> \\<K> \\<le> 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. max_len = 0 \\<Longrightarrow> \\<K> \\<le> 1", "using ineq"], ["proof (prove)\nusing this:\n  0 < ?k14 \\<Longrightarrow>\n  \\<K> \\<le> root ?k14 (real ?k14) * root ?k14 (real max_len)\n\ngoal (1 subgoal):\n 1. max_len = 0 \\<Longrightarrow> \\<K> \\<le> 1", "by fastforce"], ["proof (state)\nthis:\n  max_len = 0 \\<Longrightarrow> \\<K> \\<le> 1\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "ultimately"], ["proof (chain)\npicking this:\n  0 < max_len \\<Longrightarrow>\n  (\\<lambda>k. root k (real k) * root k (real max_len))\n  \\<longlonglongrightarrow> 1\n  \\<forall>n\\<ge>1. \\<K> \\<le> root n (real n) * root n (real max_len)\n  max_len = 0 \\<Longrightarrow> \\<K> \\<le> 1", "show \" \\<K> \\<le> 1\""], ["proof (prove)\nusing this:\n  0 < max_len \\<Longrightarrow>\n  (\\<lambda>k. root k (real k) * root k (real max_len))\n  \\<longlonglongrightarrow> 1\n  \\<forall>n\\<ge>1. \\<K> \\<le> root n (real n) * root n (real max_len)\n  max_len = 0 \\<Longrightarrow> \\<K> \\<le> 1\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "using LIMSEQ_le_const"], ["proof (prove)\nusing this:\n  0 < max_len \\<Longrightarrow>\n  (\\<lambda>k. root k (real k) * root k (real max_len))\n  \\<longlonglongrightarrow> 1\n  \\<forall>n\\<ge>1. \\<K> \\<le> root n (real n) * root n (real max_len)\n  max_len = 0 \\<Longrightarrow> \\<K> \\<le> 1\n  \\<lbrakk>?X \\<longlonglongrightarrow> ?x;\n   \\<exists>N. \\<forall>n\\<ge>N. ?a \\<le> ?X n\\<rbrakk>\n  \\<Longrightarrow> ?a \\<le> ?x\n\ngoal (1 subgoal):\n 1. \\<K> \\<le> 1", "by blast"], ["proof (state)\nthis:\n  \\<K> \\<le> 1\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma entropy_rw: \"\\<H>(X) = -(\\<Sum>i \\<in> L. fi i * log b (fi i))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<H>(X) = - (\\<Sum>i\\<in>L. fi i * log b (fi i))", "using entropy_simple_distributed[OF distr_i]"], ["proof (prove)\nusing this:\n  \\<H>(X) = - (\\<Sum>x\\<in>X ` space M. fi x * log b (fi x))\n\ngoal (1 subgoal):\n 1. \\<H>(X) = - (\\<Sum>i\\<in>L. fi i * log b (fi i))", "by (simp add: L_def)"], ["", "subsubsection\\<open>Technical lemmas about the logarithm\\<close>"], ["", "lemma log_mult_ext3:\n  \"0 \\<le> x \\<Longrightarrow> 0 < y \\<Longrightarrow> 0 < z \\<Longrightarrow> x * log b (x*y*z) = x * log b (x*y) + x * log b z\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>0 \\<le> x; 0 < y; 0 < z\\<rbrakk>\n    \\<Longrightarrow> x * log b (x * y * z) =\n                      x * log b (x * y) + x * log b z", "by(cases \"x=0\")(simp add: log_mult_eq abs_of_pos distrib_left less_eq_real_def)+"], ["", "lemma log_mult_ext2:\n  \"0 \\<le> x \\<Longrightarrow> 0 < y \\<Longrightarrow> x * log b (x*y) = x * log b x + x * log b y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>0 \\<le> x; 0 < y\\<rbrakk>\n    \\<Longrightarrow> x * log b (x * y) = x * log b x + x * log b y", "using log_mult_ext3[where y=1]"], ["proof (prove)\nusing this:\n  \\<lbrakk>0 \\<le> ?x; 0 < 1; 0 < ?z\\<rbrakk>\n  \\<Longrightarrow> ?x * log b (?x * 1 * ?z) =\n                    ?x * log b (?x * 1) + ?x * log b ?z\n\ngoal (1 subgoal):\n 1. \\<lbrakk>0 \\<le> x; 0 < y\\<rbrakk>\n    \\<Longrightarrow> x * log b (x * y) = x * log b x + x * log b y", "by simp"], ["", "subsubsection \\<open>KL divergence and properties\\<close>"], ["", "definition KL_div ::\"'b set \\<Rightarrow> ('b \\<Rightarrow> real) \\<Rightarrow> ('b \\<Rightarrow> real) \\<Rightarrow> real\" where\n  \"KL_div S a d = (\\<Sum> i \\<in> S. a i * log b (a i / d i))\""], ["", "lemma KL_div_mul:\n  assumes \"0 < d\" \"d \\<le> 1\"\n  assumes \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 \\<le> a i\"\n  assumes \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 < e i\"\nshows \"KL_div S a e \\<ge> KL_div S a (\\<lambda>i. e i / d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. KL_div S a (\\<lambda>i. e i / d) \\<le> KL_div S a e", "unfolding KL_div_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "fix i"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "assume \"i\\<in>S\""], ["proof (state)\nthis:\n  i \\<in> S\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "hence \"a i / (e i / d) \\<le> a i / e i\""], ["proof (prove)\nusing this:\n  i \\<in> S\n\ngoal (1 subgoal):\n 1. a i / (e i / d) \\<le> a i / e i", "using assms"], ["proof (prove)\nusing this:\n  i \\<in> S\n  0 < d\n  d \\<le> 1\n  ?i14 \\<in> S \\<Longrightarrow> 0 \\<le> a ?i14\n  ?i14 \\<in> S \\<Longrightarrow> 0 < e ?i14\n\ngoal (1 subgoal):\n 1. a i / (e i / d) \\<le> a i / e i", "by (metis (no_types) div_by_1 frac_le less_imp_triv not_less)"], ["proof (state)\nthis:\n  a i / (e i / d) \\<le> a i / e i\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "hence \"log b (a i / (e i / d)) \\<le> log b (a i / e i)\""], ["proof (prove)\nusing this:\n  a i / (e i / d) \\<le> a i / e i\n\ngoal (1 subgoal):\n 1. log b (a i / (e i / d)) \\<le> log b (a i / e i)", "using assms(1)"], ["proof (prove)\nusing this:\n  a i / (e i / d) \\<le> a i / e i\n  0 < d\n\ngoal (1 subgoal):\n 1. log b (a i / (e i / d)) \\<le> log b (a i / e i)", "by (metis (full_types) b_gt_1 divide_divide_eq_left inverse_divide le_less_linear log_le\n    log_neg_const order_refl times_divide_eq_right zero_less_mult_iff)"], ["proof (state)\nthis:\n  log b (a i / (e i / d)) \\<le> log b (a i / e i)\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "}"], ["proof (state)\nthis:\n  ?i16 \\<in> S \\<Longrightarrow>\n  log b (a ?i16 / (e ?i16 / d)) \\<le> log b (a ?i16 / e ?i16)\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "thus \"(\\<Sum>i\\<in>S. a i * log b (a i / (e i / d))) \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))\""], ["proof (prove)\nusing this:\n  ?i16 \\<in> S \\<Longrightarrow>\n  log b (a ?i16 / (e ?i16 / d)) \\<le> log b (a ?i16 / e ?i16)\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n    \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "by (meson mult_left_mono assms sum_mono)"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>S. a i * log b (a i / (e i / d)))\n  \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma KL_div_pos:\n  fixes a e::\"'b \\<Rightarrow> real\"\n  assumes fin: \"finite S\"\n  assumes nemp: \"S \\<noteq> {}\"\n  assumes non_null: \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 < a i\" \"\\<And>i. i\\<in> S \\<Longrightarrow> 0 < e i\"\n  assumes sum_a_one: \"(\\<Sum> i \\<in> S. a i) = 1\"\n  assumes sum_c_one: \"(\\<Sum> i \\<in> S. e i) = 1\"\nshows \"0 \\<le> KL_div S a e\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a e", "unfolding KL_div_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "let ?f = \"\\<lambda>i. e i / a i\""], ["proof (state)\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "have f_pos: \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 < ?f i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> S \\<Longrightarrow> 0 < e i / a i", "using non_null"], ["proof (prove)\nusing this:\n  ?i14 \\<in> S \\<Longrightarrow> 0 < a ?i14\n  ?i14 \\<in> S \\<Longrightarrow> 0 < e ?i14\n\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> S \\<Longrightarrow> 0 < e i / a i", "by simp"], ["proof (state)\nthis:\n  ?i14 \\<in> S \\<Longrightarrow> 0 < e ?i14 / a ?i14\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "have a_pos: \"\\<And>i. i\\<in> S \\<Longrightarrow> 0 \\<le> a i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> S \\<Longrightarrow> 0 \\<le> a i", "using non_null"], ["proof (prove)\nusing this:\n  ?i14 \\<in> S \\<Longrightarrow> 0 < a ?i14\n  ?i14 \\<in> S \\<Longrightarrow> 0 < e ?i14\n\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> S \\<Longrightarrow> 0 \\<le> a i", "by (simp add: order.strict_implies_order)"], ["proof (state)\nthis:\n  ?i14 \\<in> S \\<Longrightarrow> 0 \\<le> a ?i14\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "have \"- log b (\\<Sum>i\\<in>S. a i * e i / a i) \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. - log b (\\<Sum>i\\<in>S. a i * e i / a i)\n    \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))", "using convex_on_sum[OF fin nemp  minus_log_convex[OF b_gt_1] convex_real_interval(3)\n                             sum_a_one a_pos, of \"\\<lambda>i. e i / a i\"] f_pos"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>i. i \\<in> S \\<Longrightarrow> i \\<in> S;\n   \\<And>i. i \\<in> S \\<Longrightarrow> e i / a i \\<in> {0<..}\\<rbrakk>\n  \\<Longrightarrow> - log b (\\<Sum>i\\<in>S. a i *\\<^sub>R (e i / a i))\n                    \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\n  ?i14 \\<in> S \\<Longrightarrow> 0 < e ?i14 / a ?i14\n\ngoal (1 subgoal):\n 1. - log b (\\<Sum>i\\<in>S. a i * e i / a i)\n    \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))", "by simp"], ["proof (state)\nthis:\n  - log b (\\<Sum>i\\<in>S. a i * e i / a i)\n  \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "also"], ["proof (state)\nthis:\n  - log b (\\<Sum>i\\<in>S. a i * e i / a i)\n  \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "have \"-log b (\\<Sum>i\\<in>S. a i * e i / a i) = -log b (\\<Sum>i\\<in>S. e i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. - log b (\\<Sum>i\\<in>S. a i * e i / a i) = - log b (sum e S)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. - log b (\\<Sum>i\\<in>S. a i * e i / a i) = - log b (sum e S)", "from non_null(1)"], ["proof (chain)\npicking this:\n  ?i14 \\<in> S \\<Longrightarrow> 0 < a ?i14", "have \"\\<And>i. i \\<in> S \\<Longrightarrow> a i * e i / a i = e i\""], ["proof (prove)\nusing this:\n  ?i14 \\<in> S \\<Longrightarrow> 0 < a ?i14\n\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> S \\<Longrightarrow> a i * e i / a i = e i", "by force"], ["proof (state)\nthis:\n  ?i14 \\<in> S \\<Longrightarrow> a ?i14 * e ?i14 / a ?i14 = e ?i14\n\ngoal (1 subgoal):\n 1. - log b (\\<Sum>i\\<in>S. a i * e i / a i) = - log b (sum e S)", "thus ?thesis"], ["proof (prove)\nusing this:\n  ?i14 \\<in> S \\<Longrightarrow> a ?i14 * e ?i14 / a ?i14 = e ?i14\n\ngoal (1 subgoal):\n 1. - log b (\\<Sum>i\\<in>S. a i * e i / a i) = - log b (sum e S)", "by simp"], ["proof (state)\nthis:\n  - log b (\\<Sum>i\\<in>S. a i * e i / a i) = - log b (sum e S)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  - log b (\\<Sum>i\\<in>S. a i * e i / a i) = - log b (sum e S)\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "finally"], ["proof (chain)\npicking this:\n  - log b (sum e S) \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))", "have \"0 \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\""], ["proof (prove)\nusing this:\n  - log b (sum e S) \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))", "by (simp add: sum_c_one)"], ["proof (state)\nthis:\n  0 \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "thus \"0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))\""], ["proof (prove)\nusing this:\n  0 \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "using b_gt_1 log_divide non_null"], ["proof (prove)\nusing this:\n  0 \\<le> (\\<Sum>i\\<in>S. a i * - log b (e i / a i))\n  1 < b\n  \\<lbrakk>0 < ?a; ?a \\<noteq> 1; 0 < ?x; 0 < ?y\\<rbrakk>\n  \\<Longrightarrow> log ?a (?x / ?y) = log ?a ?x - log ?a ?y\n  ?i14 \\<in> S \\<Longrightarrow> 0 < a ?i14\n  ?i14 \\<in> S \\<Longrightarrow> 0 < e ?i14\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))", "by simp"], ["proof (state)\nthis:\n  0 \\<le> (\\<Sum>i\\<in>S. a i * log b (a i / e i))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma KL_div_pos_emp:\n  \"0 \\<le> KL_div {} a e\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div {} a e", "by (simp add: KL_div_def)"], ["", "lemma KL_div_pos_gen:\n  fixes a d::\"'b \\<Rightarrow> real\"\n  assumes fin: \"finite S\"\n  assumes non_null: \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 < a i\" \"\\<And>i. i\\<in> S \\<Longrightarrow> 0 < d i\"\n  assumes sum_a_one: \"(\\<Sum> i \\<in> S. a i) = 1\"\n  assumes sum_d_one: \"(\\<Sum> i \\<in> S. d i) = 1\"\nshows \"0 \\<le> KL_div S a d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "using KL_div_pos KL_div_pos_emp assms"], ["proof (prove)\nusing this:\n  \\<lbrakk>finite ?S; ?S \\<noteq> {};\n   \\<And>i. i \\<in> ?S \\<Longrightarrow> 0 < ?a i;\n   \\<And>i. i \\<in> ?S \\<Longrightarrow> 0 < ?e i; sum ?a ?S = 1;\n   sum ?e ?S = 1\\<rbrakk>\n  \\<Longrightarrow> 0 \\<le> KL_div ?S ?a ?e\n  0 \\<le> KL_div {} ?a ?e\n  finite S\n  ?i14 \\<in> S \\<Longrightarrow> 0 < a ?i14\n  ?i14 \\<in> S \\<Longrightarrow> 0 < d ?i14\n  sum a S = 1\n  sum d S = 1\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "by metis"], ["", "theorem KL_div_pos2:\n  fixes a d::\"'b \\<Rightarrow> real\"\n  assumes fin: \"finite S\"\n  assumes non_null: \"\\<And>i. i\\<in>S \\<Longrightarrow> 0 \\<le> a i\" \"\\<And>i. i\\<in> S \\<Longrightarrow> 0 < d i\"\n  assumes sum_a_one: \"(\\<Sum> i \\<in> S. a i) = 1\"\n  assumes sum_c_one: \"(\\<Sum> i \\<in> S. d i) = 1\"\nshows \"0 \\<le> KL_div S a d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "have \"S = (S \\<inter> {i. 0 < a i}) \\<union> (S \\<inter> {i. 0 = a i})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. S = S \\<inter> {i. 0 < a i} \\<union> S \\<inter> {i. 0 = a i}", "using non_null(1)"], ["proof (prove)\nusing this:\n  ?i14 \\<in> S \\<Longrightarrow> 0 \\<le> a ?i14\n\ngoal (1 subgoal):\n 1. S = S \\<inter> {i. 0 < a i} \\<union> S \\<inter> {i. 0 = a i}", "by fastforce"], ["proof (state)\nthis:\n  S = S \\<inter> {i. 0 < a i} \\<union> S \\<inter> {i. 0 = a i}\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "moreover"], ["proof (state)\nthis:\n  S = S \\<inter> {i. 0 < a i} \\<union> S \\<inter> {i. 0 = a i}\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "have \"(S \\<inter> {i. 0 < a i}) \\<inter> (S \\<inter> {i. 0 = a i}) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<inter> (S \\<inter> {i. 0 = a i}) = {}", "by auto"], ["proof (state)\nthis:\n  S \\<inter> {i. 0 < a i} \\<inter> (S \\<inter> {i. 0 = a i}) = {}\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "ultimately"], ["proof (chain)\npicking this:\n  S = S \\<inter> {i. 0 < a i} \\<union> S \\<inter> {i. 0 = a i}\n  S \\<inter> {i. 0 < a i} \\<inter> (S \\<inter> {i. 0 = a i}) = {}", "have\n    eq: \"KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d + KL_div (S \\<inter> {i. 0 = a i}) a d\""], ["proof (prove)\nusing this:\n  S = S \\<inter> {i. 0 < a i} \\<union> S \\<inter> {i. 0 = a i}\n  S \\<inter> {i. 0 < a i} \\<inter> (S \\<inter> {i. 0 = a i}) = {}\n\ngoal (1 subgoal):\n 1. KL_div S a d =\n    KL_div (S \\<inter> {i. 0 < a i}) a d +\n    KL_div (S \\<inter> {i. 0 = a i}) a d", "unfolding KL_div_def"], ["proof (prove)\nusing this:\n  S = S \\<inter> {i. 0 < a i} \\<union> S \\<inter> {i. 0 = a i}\n  S \\<inter> {i. 0 < a i} \\<inter> (S \\<inter> {i. 0 = a i}) = {}\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S. a i * log b (a i / d i)) =\n    (\\<Sum>i\\<in>S \\<inter> {i. 0 < a i}. a i * log b (a i / d i)) +\n    (\\<Sum>i\\<in>S \\<inter> {i. 0 = a i}. a i * log b (a i / d i))", "by (metis (mono_tags, lifting) fin finite_Un sum.union_disjoint)"], ["proof (state)\nthis:\n  KL_div S a d =\n  KL_div (S \\<inter> {i. 0 < a i}) a d +\n  KL_div (S \\<inter> {i. 0 = a i}) a d\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "have \"KL_div (S \\<inter> {i. 0 = a i}) a d = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. KL_div (S \\<inter> {i. 0 = a i}) a d = 0", "unfolding KL_div_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S \\<inter> {i. 0 = a i}. a i * log b (a i / d i)) = 0", "by simp"], ["proof (state)\nthis:\n  KL_div (S \\<inter> {i. 0 = a i}) a d = 0\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "hence \"KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d\""], ["proof (prove)\nusing this:\n  KL_div (S \\<inter> {i. 0 = a i}) a d = 0\n\ngoal (1 subgoal):\n 1. KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d", "using eq"], ["proof (prove)\nusing this:\n  KL_div (S \\<inter> {i. 0 = a i}) a d = 0\n  KL_div S a d =\n  KL_div (S \\<inter> {i. 0 < a i}) a d +\n  KL_div (S \\<inter> {i. 0 = a i}) a d\n\ngoal (1 subgoal):\n 1. KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d", "by simp"], ["proof (state)\nthis:\n  KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "moreover"], ["proof (state)\nthis:\n  KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "have \"0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "proof(cases \"(S \\<inter> {i. 0 < a i}) = {}\")"], ["proof (state)\ngoal (2 subgoals):\n 1. S \\<inter> {i. 0 < a i} = {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d\n 2. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "case True"], ["proof (state)\nthis:\n  S \\<inter> {i. 0 < a i} = {}\n\ngoal (2 subgoals):\n 1. S \\<inter> {i. 0 < a i} = {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d\n 2. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "thus ?thesis"], ["proof (prove)\nusing this:\n  S \\<inter> {i. 0 < a i} = {}\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "unfolding KL_div_def"], ["proof (prove)\nusing this:\n  S \\<inter> {i. 0 < a i} = {}\n\ngoal (1 subgoal):\n 1. 0 \\<le> (\\<Sum>i\\<in>S \\<inter> {i. 0 < a i}. a i * log b (a i / d i))", "by simp"], ["proof (state)\nthis:\n  0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "case False"], ["proof (state)\nthis:\n  S \\<inter> {i. 0 < a i} \\<noteq> {}\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "let ?c = \"\\<lambda>i. d i / (\\<Sum>j \\<in>(S \\<inter> {i. 0 < a i}). d j)\""], ["proof (state)\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "have 1: \"(\\<And>i. i \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow> 0 < a i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow> 0 < a i", "by simp"], ["proof (state)\nthis:\n  ?i14 \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow> 0 < a ?i14\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "have 2: \"(\\<And>i. i \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow> 0 < ?c i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>i.\n       i \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow>\n       0 < d i / sum d (S \\<inter> {i. 0 < a i})", "by (metis False IntD1 divide_pos_pos fin finite_Int non_null(2) sum_pos)"], ["proof (state)\nthis:\n  ?i14 \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow>\n  0 < d ?i14 / sum d (S \\<inter> {i. 0 < a i})\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "have 3: \"(\\<Sum>i\\<in> (S \\<inter> {i. 0 < a i}). a i) = 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum a (S \\<inter> {i. 0 < a i}) = 1", "using sum.cong[of S, of S, of \"(\\<lambda>x. if x \\<in> {i. 0 < a i} then a x else 0)\", of a]\n      sum.inter_restrict[OF fin, of a] non_null(1) sum_a_one"], ["proof (prove)\nusing this:\n  \\<lbrakk>S = S;\n   \\<And>x.\n      x \\<in> S \\<Longrightarrow>\n      (if x \\<in> {i. 0 < a i} then a x else 0) = a x\\<rbrakk>\n  \\<Longrightarrow> (\\<Sum>x\\<in>S.\n                       if x \\<in> {i. 0 < a i} then a x else 0) =\n                    sum a S\n  sum a (S \\<inter> ?B) = (\\<Sum>x\\<in>S. if x \\<in> ?B then a x else 0)\n  ?i14 \\<in> S \\<Longrightarrow> 0 \\<le> a ?i14\n  sum a S = 1\n\ngoal (1 subgoal):\n 1. sum a (S \\<inter> {i. 0 < a i}) = 1", "by fastforce"], ["proof (state)\nthis:\n  sum a (S \\<inter> {i. 0 < a i}) = 1\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "have \"(\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}. ?c i) = (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}. d i) / (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}. d i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n       d i / sum d (S \\<inter> {i. 0 < a i})) =\n    sum d (S \\<inter> {j. 0 < a j}) / sum d (S \\<inter> {j. 0 < a j})", "by (metis sum_divide_distrib)"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  sum d (S \\<inter> {j. 0 < a j}) / sum d (S \\<inter> {j. 0 < a j})\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "hence 5: \"(\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}. ?c i) = 1\""], ["proof (prove)\nusing this:\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  sum d (S \\<inter> {j. 0 < a j}) / sum d (S \\<inter> {j. 0 < a j})\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n       d i / sum d (S \\<inter> {i. 0 < a i})) =\n    1", "using 2 False"], ["proof (prove)\nusing this:\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  sum d (S \\<inter> {j. 0 < a j}) / sum d (S \\<inter> {j. 0 < a j})\n  ?i14 \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow>\n  0 < d ?i14 / sum d (S \\<inter> {i. 0 < a i})\n  S \\<inter> {i. 0 < a i} \\<noteq> {}\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n       d i / sum d (S \\<inter> {i. 0 < a i})) =\n    1", "by force"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  1\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "hence \"0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a ?c\""], ["proof (prove)\nusing this:\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  1\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n             (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "using KL_div_pos_gen[\n      OF finite_Int[OF disjI1, of S, of \"{j. 0 < a j}\"], of a, of ?c\n      ] 1 2 3"], ["proof (prove)\nusing this:\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  1\n  \\<lbrakk>finite S;\n   \\<And>i. i \\<in> S \\<inter> {j. 0 < a j} \\<Longrightarrow> 0 < a i;\n   \\<And>i.\n      i \\<in> S \\<inter> {j. 0 < a j} \\<Longrightarrow>\n      0 < d i / sum d (S \\<inter> {i. 0 < a i});\n   sum a (S \\<inter> {j. 0 < a j}) = 1;\n   (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n      d i / sum d (S \\<inter> {i. 0 < a i})) =\n   1\\<rbrakk>\n  \\<Longrightarrow> 0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n                             (\\<lambda>i.\n                                 d i / sum d (S \\<inter> {i. 0 < a i}))\n  ?i14 \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow> 0 < a ?i14\n  ?i14 \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow>\n  0 < d ?i14 / sum d (S \\<inter> {i. 0 < a i})\n  sum a (S \\<inter> {i. 0 < a i}) = 1\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n             (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "by (metis fin)"], ["proof (state)\nthis:\n  0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n           (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "have fstdb: \"0 < (\\<Sum>i\\<in>S \\<inter> {i. 0 < a i}. d i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < sum d (S \\<inter> {i. 0 < a i})", "using non_null(2) False"], ["proof (prove)\nusing this:\n  ?i14 \\<in> S \\<Longrightarrow> 0 < d ?i14\n  S \\<inter> {i. 0 < a i} \\<noteq> {}\n\ngoal (1 subgoal):\n 1. 0 < sum d (S \\<inter> {i. 0 < a i})", "by (metis Int_Collect fin finite_Int sum_pos)"], ["proof (state)\nthis:\n  0 < sum d (S \\<inter> {i. 0 < a i})\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "have 6: \"0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a (\\<lambda>i. d i / (\\<Sum>i\\<in>(S \\<inter> {i. 0 < a i}). d i))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a\n             (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "using 2 3 5\n        KL_div_pos_gen[\n      OF finite_Int[OF disjI1, OF fin], of \"{i. 0 < a i}\", of \"a\", of \"?c\"\n      ]"], ["proof (prove)\nusing this:\n  ?i14 \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow>\n  0 < d ?i14 / sum d (S \\<inter> {i. 0 < a i})\n  sum a (S \\<inter> {i. 0 < a i}) = 1\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  1\n  \\<lbrakk>\\<And>i.\n              i \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow> 0 < a i;\n   \\<And>i.\n      i \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow>\n      0 < d i / sum d (S \\<inter> {i. 0 < a i});\n   sum a (S \\<inter> {i. 0 < a i}) = 1;\n   (\\<Sum>i\\<in>S \\<inter> {i. 0 < a i}.\n      d i / sum d (S \\<inter> {i. 0 < a i})) =\n   1\\<rbrakk>\n  \\<Longrightarrow> 0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a\n                             (\\<lambda>i.\n                                 d i / sum d (S \\<inter> {i. 0 < a i}))\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a\n             (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "by simp"], ["proof (state)\nthis:\n  0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a\n           (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "hence\n      \"KL_div (S \\<inter> {j. 0 < a j}) a (\\<lambda>i. d i / (\\<Sum>i\\<in>(S \\<inter> {i. 0 < a i}). d i)) \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d\""], ["proof (prove)\nusing this:\n  0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a\n           (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n\ngoal (1 subgoal):\n 1. KL_div (S \\<inter> {j. 0 < a j}) a\n     (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n    \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d", "using non_null sum.inter_restrict[OF fin, of d, of \"{i. 0 < a i}\"]\n        sum_mono[of S, of \"(\\<lambda>x. if x \\<in> {i. 0 < a i} then d x else 0)\", of d] non_null(2) sum_c_one\n        non_null(2) fstdb KL_div_mul"], ["proof (prove)\nusing this:\n  0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a\n           (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n  ?i14 \\<in> S \\<Longrightarrow> 0 \\<le> a ?i14\n  ?i14 \\<in> S \\<Longrightarrow> 0 < d ?i14\n  sum d (S \\<inter> {i. 0 < a i}) =\n  (\\<Sum>x\\<in>S. if x \\<in> {i. 0 < a i} then d x else 0)\n  (\\<And>i.\n      i \\<in> S \\<Longrightarrow>\n      (if i \\<in> {i. 0 < a i} then d i else 0) \\<le> d i) \\<Longrightarrow>\n  (\\<Sum>i\\<in>S. if i \\<in> {i. 0 < a i} then d i else 0) \\<le> sum d S\n  ?i14 \\<in> S \\<Longrightarrow> 0 < d ?i14\n  sum d S = 1\n  ?i14 \\<in> S \\<Longrightarrow> 0 < d ?i14\n  0 < sum d (S \\<inter> {i. 0 < a i})\n  \\<lbrakk>0 < ?d; ?d \\<le> 1;\n   \\<And>i. i \\<in> ?S \\<Longrightarrow> 0 \\<le> ?a i;\n   \\<And>i. i \\<in> ?S \\<Longrightarrow> 0 < ?e i\\<rbrakk>\n  \\<Longrightarrow> KL_div ?S ?a (\\<lambda>i. ?e i / ?d)\n                    \\<le> KL_div ?S ?a ?e\n\ngoal (1 subgoal):\n 1. KL_div (S \\<inter> {j. 0 < a j}) a\n     (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n    \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d", "by force"], ["proof (state)\nthis:\n  KL_div (S \\<inter> {j. 0 < a j}) a\n   (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n  \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "moreover"], ["proof (state)\nthis:\n  KL_div (S \\<inter> {j. 0 < a j}) a\n   (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n  \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "have \"0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a (\\<lambda>i. d i / (\\<Sum>i\\<in>(S \\<inter> {i. 0 < a i}). d i))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n             (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "using KL_div_pos_gen[ OF finite_Int[OF disjI1, OF fin]]"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>i. i \\<in> S \\<inter> ?G1 \\<Longrightarrow> 0 < ?a i;\n   \\<And>i. i \\<in> S \\<inter> ?G1 \\<Longrightarrow> 0 < ?d i;\n   sum ?a (S \\<inter> ?G1) = 1; sum ?d (S \\<inter> ?G1) = 1\\<rbrakk>\n  \\<Longrightarrow> 0 \\<le> KL_div (S \\<inter> ?G1) ?a ?d\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n             (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "using 2 3 5"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>i. i \\<in> S \\<inter> ?G1 \\<Longrightarrow> 0 < ?a i;\n   \\<And>i. i \\<in> S \\<inter> ?G1 \\<Longrightarrow> 0 < ?d i;\n   sum ?a (S \\<inter> ?G1) = 1; sum ?d (S \\<inter> ?G1) = 1\\<rbrakk>\n  \\<Longrightarrow> 0 \\<le> KL_div (S \\<inter> ?G1) ?a ?d\n  ?i14 \\<in> S \\<inter> {i. 0 < a i} \\<Longrightarrow>\n  0 < d ?i14 / sum d (S \\<inter> {i. 0 < a i})\n  sum a (S \\<inter> {i. 0 < a i}) = 1\n  (\\<Sum>i\\<in>S \\<inter> {j. 0 < a j}.\n     d i / sum d (S \\<inter> {i. 0 < a i})) =\n  1\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n             (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "by fastforce"], ["proof (state)\nthis:\n  0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n           (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n\ngoal (1 subgoal):\n 1. S \\<inter> {i. 0 < a i} \\<noteq> {} \\<Longrightarrow>\n    0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "ultimately"], ["proof (chain)\npicking this:\n  KL_div (S \\<inter> {j. 0 < a j}) a\n   (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n  \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d\n  0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n           (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))", "show \"0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d\""], ["proof (prove)\nusing this:\n  KL_div (S \\<inter> {j. 0 < a j}) a\n   (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n  \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d\n  0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a\n           (\\<lambda>i. d i / sum d (S \\<inter> {i. 0 < a i}))\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d", "by simp"], ["proof (state)\nthis:\n  0 \\<le> KL_div (S \\<inter> {j. 0 < a j}) a d\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "ultimately"], ["proof (chain)\npicking this:\n  KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d\n  0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d", "show ?thesis"], ["proof (prove)\nusing this:\n  KL_div S a d = KL_div (S \\<inter> {i. 0 < a i}) a d\n  0 \\<le> KL_div (S \\<inter> {i. 0 < a i}) a d\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div S a d", "by simp"], ["proof (state)\nthis:\n  0 \\<le> KL_div S a d\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sum_div_1:\n  fixes f::\"'b \\<Rightarrow> 'c::field\"\n  assumes \"(\\<Sum>i\\<in>A. f i) \\<noteq> 0\"\nshows \"(\\<Sum>i\\<in>A. f i / (\\<Sum>j\\<in>A. f j)) = 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>A. f i / sum f A) = (1::'c)", "by (metis (no_types) assms right_inverse_eq sum_divide_distrib)"], ["", "theorem rate_lower_bound:\nshows \"\\<H>(X) \\<le> code_rate enc X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "let ?cr = \"code_rate enc X\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "let ?r = \"(\\<lambda>i. 1 / ((b powr cw_len i) * \\<K>))\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have pos_pi: \"\\<And>i. i \\<in> L \\<Longrightarrow> 0 \\<le> fi i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> L \\<Longrightarrow> 0 \\<le> fi i", "using fi_pos"], ["proof (prove)\nusing this:\n  ?i \\<in> L \\<Longrightarrow> 0 \\<le> fi ?i\n\ngoal (1 subgoal):\n 1. \\<And>i. i \\<in> L \\<Longrightarrow> 0 \\<le> fi i", "by simp"], ["proof (state)\nthis:\n  ?i14 \\<in> L \\<Longrightarrow> 0 \\<le> fi ?i14\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "{"], ["proof (state)\nthis:\n  ?i14 \\<in> L \\<Longrightarrow> 0 \\<le> fi ?i14\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "fix i"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "assume \"i \\<in> L\""], ["proof (state)\nthis:\n  i \\<in> L\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "hence\n    \"fi i * (log b (1 / (1 / b powr (cw_len i))) + log b (fi i))\n    = fi i * log b (fi i / (1 / b powr (cw_len i)))\""], ["proof (prove)\nusing this:\n  i \\<in> L\n\ngoal (1 subgoal):\n 1. fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)) =\n    fi i * log b (fi i / (1 / b powr real (cw_len i)))", "using log_mult_ext2 [OF pos_pi, of i] b_gt_1"], ["proof (prove)\nusing this:\n  i \\<in> L\n  \\<lbrakk>i \\<in> L; 0 < ?y\\<rbrakk>\n  \\<Longrightarrow> fi i * log b (fi i * ?y) =\n                    fi i * log b (fi i) + fi i * log b ?y\n  1 < b\n\ngoal (1 subgoal):\n 1. fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)) =\n    fi i * log b (fi i / (1 / b powr real (cw_len i)))", "by simp (simp add: algebra_simps)"], ["proof (state)\nthis:\n  fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)) =\n  fi i * log b (fi i / (1 / b powr real (cw_len i)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "}"], ["proof (state)\nthis:\n  ?i16 \\<in> L \\<Longrightarrow>\n  fi ?i16 *\n  (log b (1 / (1 / b powr real (cw_len ?i16))) + log b (fi ?i16)) =\n  fi ?i16 * log b (fi ?i16 / (1 / b powr real (cw_len ?i16)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "hence eqpi:\n    \"\\<And>i. i\\<in> L \\<Longrightarrow> fi i * (log b (1 / (1 / b powr (cw_len i))) + log b (fi i))\n    = fi i * log b (fi i / (1 / b powr (cw_len i)))\""], ["proof (prove)\nusing this:\n  ?i16 \\<in> L \\<Longrightarrow>\n  fi ?i16 *\n  (log b (1 / (1 / b powr real (cw_len ?i16))) + log b (fi ?i16)) =\n  fi ?i16 * log b (fi ?i16 / (1 / b powr real (cw_len ?i16)))\n\ngoal (1 subgoal):\n 1. \\<And>i.\n       i \\<in> L \\<Longrightarrow>\n       fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)) =\n       fi i * log b (fi i / (1 / b powr real (cw_len i)))", "by simp"], ["proof (state)\nthis:\n  ?i14 \\<in> L \\<Longrightarrow>\n  fi ?i14 *\n  (log b (1 / (1 / b powr real (cw_len ?i14))) + log b (fi ?i14)) =\n  fi ?i14 * log b (fi ?i14 / (1 / b powr real (cw_len ?i14)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have sum_one_L: \"(\\<Sum> i \\<in> L. fi i) = 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum fi L = 1", "using simple_distributed_sum_space[OF distr_i]"], ["proof (prove)\nusing this:\n  sum fi (X ` space M) = 1\n\ngoal (1 subgoal):\n 1. sum fi L = 1", "by (simp add: L_def)"], ["proof (state)\nthis:\n  sum fi L = 1\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "{"], ["proof (state)\nthis:\n  sum fi L = 1\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "fix i"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "assume \"i \\<in> L\""], ["proof (state)\nthis:\n  i \\<in> L\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "hence h1: \"0 \\<le> fi i\""], ["proof (prove)\nusing this:\n  i \\<in> L\n\ngoal (1 subgoal):\n 1. 0 \\<le> fi i", "using pos_pi"], ["proof (prove)\nusing this:\n  i \\<in> L\n  ?i14 \\<in> L \\<Longrightarrow> 0 \\<le> fi ?i14\n\ngoal (1 subgoal):\n 1. 0 \\<le> fi i", "by blast"], ["proof (state)\nthis:\n  0 \\<le> fi i\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have h2: \"0 < \\<K> / (1/b powr cw_len i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < \\<K> / (1 / b powr real (cw_len i))", "using b_gt_1 \\<K>_pos"], ["proof (prove)\nusing this:\n  1 < b\n  0 < \\<K>\n\ngoal (1 subgoal):\n 1. 0 < \\<K> / (1 / b powr real (cw_len i))", "by auto"], ["proof (state)\nthis:\n  0 < \\<K> / (1 / b powr real (cw_len i))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have h3: \"0 < 1 / \\<K>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < 1 / \\<K>", "using \\<K>_pos"], ["proof (prove)\nusing this:\n  0 < \\<K>\n\ngoal (1 subgoal):\n 1. 0 < 1 / \\<K>", "by simp"], ["proof (state)\nthis:\n  0 < 1 / \\<K>\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have\n    \"fi i * log b (fi i * \\<K> / (1/b powr cw_len i) * (1/ \\<K>)) =\n    fi i * log b (fi i * \\<K> / (1/b powr cw_len i)) + fi i * log b (1/ \\<K>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)) * (1 / \\<K>)) =\n    fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i))) +\n    fi i * log b (1 / \\<K>)", "using log_mult_ext3[OF h1 h2 h3]"], ["proof (prove)\nusing this:\n  fi i * log b (fi i * (\\<K> / (1 / b powr real (cw_len i))) * (1 / \\<K>)) =\n  fi i * log b (fi i * (\\<K> / (1 / b powr real (cw_len i)))) +\n  fi i * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)) * (1 / \\<K>)) =\n    fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i))) +\n    fi i * log b (1 / \\<K>)", "by (metis times_divide_eq_right)"], ["proof (state)\nthis:\n  fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)) * (1 / \\<K>)) =\n  fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i))) +\n  fi i * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "}"], ["proof (state)\nthis:\n  ?i16 \\<in> L \\<Longrightarrow>\n  fi ?i16 *\n  log b (fi ?i16 * \\<K> / (1 / b powr real (cw_len ?i16)) * (1 / \\<K>)) =\n  fi ?i16 * log b (fi ?i16 * \\<K> / (1 / b powr real (cw_len ?i16))) +\n  fi ?i16 * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "hence big_eq:\n    \"\\<And>i. i \\<in> L \\<Longrightarrow> fi i * log b (fi i * \\<K> / (1/b powr cw_len i) * (1 / \\<K>)) =\n    fi i * log b (fi i * \\<K> / (1/b powr cw_len i)) + fi i * log b (1 / \\<K>)\""], ["proof (prove)\nusing this:\n  ?i16 \\<in> L \\<Longrightarrow>\n  fi ?i16 *\n  log b (fi ?i16 * \\<K> / (1 / b powr real (cw_len ?i16)) * (1 / \\<K>)) =\n  fi ?i16 * log b (fi ?i16 * \\<K> / (1 / b powr real (cw_len ?i16))) +\n  fi ?i16 * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<And>i.\n       i \\<in> L \\<Longrightarrow>\n       fi i *\n       log b (fi i * \\<K> / (1 / b powr real (cw_len i)) * (1 / \\<K>)) =\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i))) +\n       fi i * log b (1 / \\<K>)", "by (simp add: inverse_eq_divide)"], ["proof (state)\nthis:\n  ?i14 \\<in> L \\<Longrightarrow>\n  fi ?i14 *\n  log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14)) * (1 / \\<K>)) =\n  fi ?i14 * log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14))) +\n  fi ?i14 * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have 1: \"?cr - \\<H>(X) = (\\<Sum>i \\<in> L. fi i * cw_len i) + (\\<Sum>i \\<in> L. fi i * log b (fi i))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. code_rate enc X - \\<H>(X) =\n    (\\<Sum>i\\<in>L. fi i * real (cw_len i)) +\n    (\\<Sum>i\\<in>L. fi i * log b (fi i))", "using \\<K>_def entropy_rw cr_rw L_def"], ["proof (prove)\nusing this:\n  \\<K> = (\\<Sum>i\\<in>L. 1 / b ^ cw_len i)\n  \\<H>(X) = - (\\<Sum>i\\<in>L. fi i * log b (fi i))\n  code_rate enc X = (\\<Sum>i\\<in>X ` space M. fi i * real (cw_len i))\n  L \\<equiv> X ` space M\n\ngoal (1 subgoal):\n 1. code_rate enc X - \\<H>(X) =\n    (\\<Sum>i\\<in>L. fi i * real (cw_len i)) +\n    (\\<Sum>i\\<in>L. fi i * log b (fi i))", "by simp"], ["proof (state)\nthis:\n  code_rate enc X - \\<H>(X) =\n  (\\<Sum>i\\<in>L. fi i * real (cw_len i)) +\n  (\\<Sum>i\\<in>L. fi i * log b (fi i))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  code_rate enc X - \\<H>(X) =\n  (\\<Sum>i\\<in>L. fi i * real (cw_len i)) +\n  (\\<Sum>i\\<in>L. fi i * log b (fi i))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have 2: \"(\\<Sum>i\\<in>L. fi i * cw_len i) = (\\<Sum>i \\<in> L. fi i * (-log b (1/(b powr (cw_len i)))))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. fi i * real (cw_len i)) =\n    (\\<Sum>i\\<in>L. fi i * - log b (1 / b powr real (cw_len i)))", "using b_gt_1 log_divide"], ["proof (prove)\nusing this:\n  1 < b\n  \\<lbrakk>0 < ?a; ?a \\<noteq> 1; 0 < ?x; 0 < ?y\\<rbrakk>\n  \\<Longrightarrow> log ?a (?x / ?y) = log ?a ?x - log ?a ?y\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. fi i * real (cw_len i)) =\n    (\\<Sum>i\\<in>L. fi i * - log b (1 / b powr real (cw_len i)))", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L. fi i * real (cw_len i)) =\n  (\\<Sum>i\\<in>L. fi i * - log b (1 / b powr real (cw_len i)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L. fi i * real (cw_len i)) =\n  (\\<Sum>i\\<in>L. fi i * - log b (1 / b powr real (cw_len i)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"\\<dots> = -1 * (\\<Sum>i \\<in> L. fi i * (log b (1/(b powr (cw_len i)))))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. fi i * - log b (1 / b powr real (cw_len i))) =\n    - 1 * (\\<Sum>i\\<in>L. fi i * log b (1 / b powr real (cw_len i)))", "using sum_distrib_left[of \"-1\" \"(\\<lambda>i. fi i * (- 1 * log b (1 / b powr (cw_len i))))\" L]"], ["proof (prove)\nusing this:\n  - 1 * (\\<Sum>i\\<in>L. fi i * (- 1 * log b (1 / b powr real (cw_len i)))) =\n  (\\<Sum>n\\<in>L. - 1 * (fi n * (- 1 * log b (1 / b powr real (cw_len n)))))\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. fi i * - log b (1 / b powr real (cw_len i))) =\n    - 1 * (\\<Sum>i\\<in>L. fi i * log b (1 / b powr real (cw_len i)))", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L. fi i * - log b (1 / b powr real (cw_len i))) =\n  - 1 * (\\<Sum>i\\<in>L. fi i * log b (1 / b powr real (cw_len i)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "finally"], ["proof (chain)\npicking this:\n  code_rate enc X - \\<H>(X) =\n  - 1 * (\\<Sum>i\\<in>L. fi i * log b (1 / b powr real (cw_len i))) +\n  (\\<Sum>i\\<in>L. fi i * log b (fi i))", "have\n    \"?cr - \\<H>(X) = -(\\<Sum>i \\<in> L. fi i * log b (1/b powr cw_len i)) + (\\<Sum>i \\<in> L. fi i * log b (fi i))\""], ["proof (prove)\nusing this:\n  code_rate enc X - \\<H>(X) =\n  - 1 * (\\<Sum>i\\<in>L. fi i * log b (1 / b powr real (cw_len i))) +\n  (\\<Sum>i\\<in>L. fi i * log b (fi i))\n\ngoal (1 subgoal):\n 1. code_rate enc X - \\<H>(X) =\n    - (\\<Sum>i\\<in>L. fi i * log b (1 / b powr real (cw_len i))) +\n    (\\<Sum>i\\<in>L. fi i * log b (fi i))", "by simp"], ["proof (state)\nthis:\n  code_rate enc X - \\<H>(X) =\n  - (\\<Sum>i\\<in>L. fi i * log b (1 / b powr real (cw_len i))) +\n  (\\<Sum>i\\<in>L. fi i * log b (fi i))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"?cr - \\<H>(X) = (\\<Sum>i \\<in> L. fi i * ((log b (1/ (1/(b powr (cw_len i))))) + log b (fi i)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. code_rate enc X - \\<H>(X) =\n    (\\<Sum>i\\<in>L.\n       fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)))", "using b_gt_1 1"], ["proof (prove)\nusing this:\n  1 < b\n  code_rate enc X - \\<H>(X) =\n  (\\<Sum>i\\<in>L. fi i * real (cw_len i)) +\n  (\\<Sum>i\\<in>L. fi i * log b (fi i))\n\ngoal (1 subgoal):\n 1. code_rate enc X - \\<H>(X) =\n    (\\<Sum>i\\<in>L.\n       fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)))", "by (simp add: distrib_left sum.distrib)"], ["proof (state)\nthis:\n  code_rate enc X - \\<H>(X) =\n  (\\<Sum>i\\<in>L.\n     fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  code_rate enc X - \\<H>(X) =\n  (\\<Sum>i\\<in>L.\n     fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i)))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"\\<dots> = (\\<Sum>i \\<in> L. fi i *((log b (fi i / (1/(b powr (cw_len i)))))))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L.\n       fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i))) =\n    (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i))))", "using Finite_Cartesian_Product.sum_cong_aux[OF eqpi]"], ["proof (prove)\nusing this:\n  (\\<And>x. x \\<in> ?A \\<Longrightarrow> ?i15 x \\<in> L) \\<Longrightarrow>\n  (\\<Sum>x\\<in>?A.\n     fi (?i15 x) *\n     (log b (1 / (1 / b powr real (cw_len (?i15 x)))) +\n      log b (fi (?i15 x)))) =\n  (\\<Sum>x\\<in>?A.\n     fi (?i15 x) *\n     log b (fi (?i15 x) / (1 / b powr real (cw_len (?i15 x)))))\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L.\n       fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i))) =\n    (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i))))", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i))) =\n  (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i))))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * (log b (1 / (1 / b powr real (cw_len i))) + log b (fi i))) =\n  (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i))))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "from big_eq"], ["proof (chain)\npicking this:\n  ?i14 \\<in> L \\<Longrightarrow>\n  fi ?i14 *\n  log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14)) * (1 / \\<K>)) =\n  fi ?i14 * log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14))) +\n  fi ?i14 * log b (1 / \\<K>)", "have\n    \"\\<dots> = (\\<Sum>i\\<in>L. fi i * (log b (fi i * \\<K> / (1 / b powr (cw_len i))))) + (\\<Sum>i \\<in> L. fi i) * log b (1/ \\<K>)\""], ["proof (prove)\nusing this:\n  ?i14 \\<in> L \\<Longrightarrow>\n  fi ?i14 *\n  log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14)) * (1 / \\<K>)) =\n  fi ?i14 * log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14))) +\n  fi ?i14 * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i)))) =\n    (\\<Sum>i\\<in>L.\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n    sum fi L * log b (1 / \\<K>)", "using \\<K>_pos"], ["proof (prove)\nusing this:\n  ?i14 \\<in> L \\<Longrightarrow>\n  fi ?i14 *\n  log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14)) * (1 / \\<K>)) =\n  fi ?i14 * log b (fi ?i14 * \\<K> / (1 / b powr real (cw_len ?i14))) +\n  fi ?i14 * log b (1 / \\<K>)\n  0 < \\<K>\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i)))) =\n    (\\<Sum>i\\<in>L.\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n    sum fi L * log b (1 / \\<K>)", "by (simp add: sum_distrib_right sum.distrib)"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i)))) =\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n  sum fi L * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L. fi i * log b (fi i / (1 / b powr real (cw_len i)))) =\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n  sum fi L * log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"\\<dots> = (\\<Sum>i\\<in>L. fi i * (log b (fi i * \\<K> / (1 / b powr (cw_len i))))) - log b (\\<K>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L.\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n    sum fi L * log b (1 / \\<K>) =\n    (\\<Sum>i\\<in>L.\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) -\n    log b \\<K>", "using \\<K>_pos"], ["proof (prove)\nusing this:\n  0 < \\<K>\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L.\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n    sum fi L * log b (1 / \\<K>) =\n    (\\<Sum>i\\<in>L.\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) -\n    log b \\<K>", "by (simp add: log_inverse_eq divide_inverse sum_one_L)"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n  sum fi L * log b (1 / \\<K>) =\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) -\n  log b \\<K>\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) +\n  sum fi L * log b (1 / \\<K>) =\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) -\n  log b \\<K>\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"\\<dots> = (\\<Sum> i \\<in> L. fi i * log b (fi i / ?r i)) - log b (\\<K>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L.\n       fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) -\n    log b \\<K> =\n    (\\<Sum>i\\<in>L.\n       fi i * log b (fi i / (1 / (b powr real (cw_len i) * \\<K>)))) -\n    log b \\<K>", "by (metis (mono_tags, hide_lams) divide_divide_eq_left divide_divide_eq_right)"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) -\n  log b \\<K> =\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i / (1 / (b powr real (cw_len i) * \\<K>)))) -\n  log b \\<K>\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i * \\<K> / (1 / b powr real (cw_len i)))) -\n  log b \\<K> =\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i / (1 / (b powr real (cw_len i) * \\<K>)))) -\n  log b \\<K>\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"\\<dots> = KL_div L fi ?r - log b ( \\<K>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L.\n       fi i * log b (fi i / (1 / (b powr real (cw_len i) * \\<K>)))) -\n    log b \\<K> =\n    KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) -\n    log b \\<K>", "using b_gt_1 \\<K>_pos log_inverse KL_div_def"], ["proof (prove)\nusing this:\n  1 < b\n  0 < \\<K>\n  \\<lbrakk>0 < ?a; ?a \\<noteq> 1; 0 < ?x\\<rbrakk>\n  \\<Longrightarrow> log ?a (inverse ?x) = - log ?a ?x\n  KL_div ?S ?a ?d = (\\<Sum>i\\<in>?S. ?a i * log b (?a i / ?d i))\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L.\n       fi i * log b (fi i / (1 / (b powr real (cw_len i) * \\<K>)))) -\n    log b \\<K> =\n    KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) -\n    log b \\<K>", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i / (1 / (b powr real (cw_len i) * \\<K>)))) -\n  log b \\<K> =\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) - log b \\<K>\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "also"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L.\n     fi i * log b (fi i / (1 / (b powr real (cw_len i) * \\<K>)))) -\n  log b \\<K> =\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) - log b \\<K>\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"\\<dots> = KL_div L fi ?r + log b (1 / \\<K>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) -\n    log b \\<K> =\n    KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n    log b (1 / \\<K>)", "using log_inverse b_val \\<K>_pos"], ["proof (prove)\nusing this:\n  \\<lbrakk>0 < ?a; ?a \\<noteq> 1; 0 < ?x\\<rbrakk>\n  \\<Longrightarrow> log ?a (inverse ?x) = - log ?a ?x\n  b = 2\n  0 < \\<K>\n\ngoal (1 subgoal):\n 1. KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) -\n    log b \\<K> =\n    KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n    log b (1 / \\<K>)", "by (simp add: inverse_eq_divide)"], ["proof (state)\nthis:\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) -\n  log b \\<K> =\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n  log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "finally"], ["proof (chain)\npicking this:\n  code_rate enc X - \\<H>(X) =\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n  log b (1 / \\<K>)", "have code_ent_kl_log: \"?cr - \\<H>(X) = KL_div L fi ?r + log b (1 / \\<K>)\""], ["proof (prove)\nusing this:\n  code_rate enc X - \\<H>(X) =\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n  log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. code_rate enc X - \\<H>(X) =\n    KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n    log b (1 / \\<K>)", "by simp"], ["proof (state)\nthis:\n  code_rate enc X - \\<H>(X) =\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n  log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"(\\<Sum>i\\<in>L. ?r i) = 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. 1 / (b powr real (cw_len i) * \\<K>)) = 1", "using sum_div_1[of \"\\<lambda>i. 1 / (b powr (cw_len i))\"] \\<K>_pos \\<K>_pow"], ["proof (prove)\nusing this:\n  (\\<Sum>i\\<in>?A. 1 / b powr real (cw_len i)) \\<noteq> 0 \\<Longrightarrow>\n  (\\<Sum>i\\<in>?A.\n     1 / b powr real (cw_len i) /\n     (\\<Sum>j\\<in>?A. 1 / b powr real (cw_len j))) =\n  1\n  0 < \\<K>\n  \\<K> = (\\<Sum>i\\<in>L. 1 / b powr real (cw_len i))\n\ngoal (1 subgoal):\n 1. (\\<Sum>i\\<in>L. 1 / (b powr real (cw_len i) * \\<K>)) = 1", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L. 1 / (b powr real (cw_len i) * \\<K>)) = 1\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "moreover"], ["proof (state)\nthis:\n  (\\<Sum>i\\<in>L. 1 / (b powr real (cw_len i) * \\<K>)) = 1\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"\\<And>i. 0 < ?r i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>i. 0 < 1 / (b powr real (cw_len i) * \\<K>)", "using b_gt_1 \\<K>_pos"], ["proof (prove)\nusing this:\n  1 < b\n  0 < \\<K>\n\ngoal (1 subgoal):\n 1. \\<And>i. 0 < 1 / (b powr real (cw_len i) * \\<K>)", "by simp"], ["proof (state)\nthis:\n  0 < 1 / (b powr real (cw_len ?i14) * \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "moreover"], ["proof (state)\nthis:\n  0 < 1 / (b powr real (cw_len ?i14) * \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "have \"(\\<Sum>i\\<in>L. fi i) = 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum fi L = 1", "using sum_one_L"], ["proof (prove)\nusing this:\n  sum fi L = 1\n\ngoal (1 subgoal):\n 1. sum fi L = 1", "by simp"], ["proof (state)\nthis:\n  sum fi L = 1\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "ultimately"], ["proof (chain)\npicking this:\n  (\\<Sum>i\\<in>L. 1 / (b powr real (cw_len i) * \\<K>)) = 1\n  0 < 1 / (b powr real (cw_len ?i14) * \\<K>)\n  sum fi L = 1", "have \"0 \\<le> KL_div L fi ?r\""], ["proof (prove)\nusing this:\n  (\\<Sum>i\\<in>L. 1 / (b powr real (cw_len i) * \\<K>)) = 1\n  0 < 1 / (b powr real (cw_len ?i14) * \\<K>)\n  sum fi L = 1\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>))", "using KL_div_pos2[OF fin_L fi_pos]"], ["proof (prove)\nusing this:\n  (\\<Sum>i\\<in>L. 1 / (b powr real (cw_len i) * \\<K>)) = 1\n  0 < 1 / (b powr real (cw_len ?i14) * \\<K>)\n  sum fi L = 1\n  \\<lbrakk>\\<And>i. i \\<in> L \\<Longrightarrow> ?i1 i \\<in> L;\n   \\<And>i. i \\<in> L \\<Longrightarrow> 0 < ?d i;\n   (\\<Sum>i\\<in>L. fi (?i1 i)) = 1; sum ?d L = 1\\<rbrakk>\n  \\<Longrightarrow> 0 \\<le> KL_div L (\\<lambda>i. fi (?i1 i)) ?d\n\ngoal (1 subgoal):\n 1. 0 \\<le> KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>))", "by simp"], ["proof (state)\nthis:\n  0 \\<le> KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>))\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "hence \"log b (1 / \\<K>) \\<le> ?cr - \\<H>(X)\""], ["proof (prove)\nusing this:\n  0 \\<le> KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>))\n\ngoal (1 subgoal):\n 1. log b (1 / \\<K>) \\<le> code_rate enc X - \\<H>(X)", "using code_ent_kl_log"], ["proof (prove)\nusing this:\n  0 \\<le> KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>))\n  code_rate enc X - \\<H>(X) =\n  KL_div L fi (\\<lambda>i. 1 / (b powr real (cw_len i) * \\<K>)) +\n  log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. log b (1 / \\<K>) \\<le> code_rate enc X - \\<H>(X)", "by simp"], ["proof (state)\nthis:\n  log b (1 / \\<K>) \\<le> code_rate enc X - \\<H>(X)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "moreover"], ["proof (state)\nthis:\n  log b (1 / \\<K>) \\<le> code_rate enc X - \\<H>(X)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "from McMillan"], ["proof (chain)\npicking this:\n  \\<K> \\<le> 1", "have \"0 \\<le> log b (1 / \\<K>)\""], ["proof (prove)\nusing this:\n  \\<K> \\<le> 1\n\ngoal (1 subgoal):\n 1. 0 \\<le> log b (1 / \\<K>)", "using \\<K>_pos"], ["proof (prove)\nusing this:\n  \\<K> \\<le> 1\n  0 < \\<K>\n\ngoal (1 subgoal):\n 1. 0 \\<le> log b (1 / \\<K>)", "by (simp add: b_gt_1)"], ["proof (state)\nthis:\n  0 \\<le> log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "ultimately"], ["proof (chain)\npicking this:\n  log b (1 / \\<K>) \\<le> code_rate enc X - \\<H>(X)\n  0 \\<le> log b (1 / \\<K>)", "show ?thesis"], ["proof (prove)\nusing this:\n  log b (1 / \\<K>) \\<le> code_rate enc X - \\<H>(X)\n  0 \\<le> log b (1 / \\<K>)\n\ngoal (1 subgoal):\n 1. \\<H>(X) \\<le> code_rate enc X", "by simp"], ["proof (state)\nthis:\n  \\<H>(X) \\<le> code_rate enc X\n\ngoal:\nNo subgoals!", "qed"], ["", "end"], ["", "end"]]}