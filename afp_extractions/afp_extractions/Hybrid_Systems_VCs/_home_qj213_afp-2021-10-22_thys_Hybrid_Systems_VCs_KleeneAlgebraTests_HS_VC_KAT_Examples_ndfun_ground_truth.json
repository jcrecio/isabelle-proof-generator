{"file_name": "/home/qj213/afp-2021-10-22/thys/Hybrid_Systems_VCs/KleeneAlgebraTests/HS_VC_KAT_Examples_ndfun.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Hybrid_Systems_VCs", "problem_names": ["lemma pendulum_dyn: \"\\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>} EVOL \\<phi> G T \\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}\"", "lemma pendulum_inv: \"\\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>} (x\\<acute>=f & G) \\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}\"", "lemma local_flow_pend: \"local_flow f UNIV UNIV \\<phi>\"", "lemma pendulum_flow: \"\\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>} (x\\<acute>=f & G) \\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}\"", "lemma [bb_real_arith]: \n  assumes \"0 > g\" and inv: \"2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h = v \\<cdot> v\"\n  shows \"(x::real) \\<le> h\"", "lemma fball_invariant: \n  fixes g h :: real\n  defines dinv: \"I \\<equiv> (\\<lambda>s. 2 \\<cdot> g \\<cdot> s$1 - 2 \\<cdot> g \\<cdot> h - (s$2 \\<cdot> s$2) = 0)\"\n  shows \"diff_invariant I (\\<lambda>t. f g) (\\<lambda>s. UNIV) UNIV 0 G\"", "lemma bouncing_ball_inv: \"g < 0 \\<Longrightarrow> h \\<ge> 0 \\<Longrightarrow> \n  \\<^bold>{\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<^bold>}\n  (LOOP \n      ((x\\<acute>= f g & (\\<lambda> s. s$1 \\<ge> 0) DINV (\\<lambda>s. 2 \\<cdot> g \\<cdot> s$1 - 2 \\<cdot> g \\<cdot> h - s$2 \\<cdot> s$2 = 0));\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2)\n  ) \\<^bold>{\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<^bold>}\"", "lemma [bb_real_arith]:\n  assumes invar: \"2 \\<cdot> g \\<cdot> x = 2 \\<cdot> g \\<cdot> h + v \\<cdot> v\"\n    and pos: \"g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + (x::real) = 0\"\n  shows \"2 \\<cdot> g \\<cdot> h + (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) = 0\"\n    and \"2 \\<cdot> g \\<cdot> h + (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) + v \\<cdot> (g \\<cdot> \\<tau> + v)) = 0\"", "lemma [bb_real_arith]:\n  assumes invar: \"2 \\<cdot> g \\<cdot> x = 2 \\<cdot> g \\<cdot> h + v \\<cdot> v\"\n  shows \"2 \\<cdot> g \\<cdot> (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + (x::real)) = \n  2 \\<cdot> g \\<cdot> h + (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) + v \\<cdot> (g \\<cdot> \\<tau> + v))\" (is \"?lhs = ?rhs\")", "lemma bouncing_ball_dyn: \"g < 0 \\<Longrightarrow> h \\<ge> 0 \\<Longrightarrow>\n  \\<^bold>{\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<^bold>}\n  (LOOP \n      ((EVOL (\\<phi> g) (\\<lambda> s. s$1 \\<ge> 0) T);\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2)\n  ) \\<^bold>{\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<^bold>}\"", "lemma local_flow_ball: \"local_flow (f g) UNIV UNIV (\\<phi> g)\"", "lemma bouncing_ball_flow: \"g < 0 \\<Longrightarrow> h \\<ge> 0 \\<Longrightarrow>\n  \\<^bold>{\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<^bold>}\n  (LOOP \n      ((x\\<acute>= f g & (\\<lambda> s. s$1 \\<ge> 0));\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2)\n  ) \\<^bold>{\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<^bold>}\"", "lemma R_bb_assign: \"g < (0::real) \\<Longrightarrow> 0 \\<le> h \\<Longrightarrow> \n  2 ::= (\\<lambda>s. - s$2) \\<le> Ref \n    \\<lceil>\\<lambda>s. s$1 = 0 \\<and> 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2\\<rceil> \n    \\<lceil>\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2\\<rceil>\"", "lemma R_bouncing_ball_dyn:\n  assumes \"g < 0\" and \"h \\<ge> 0\"\n  shows \"Ref \\<lceil>\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<rceil> \\<lceil>\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<rceil> \\<ge> \n  (LOOP \n      ((EVOL (\\<phi> g) (\\<lambda> s. s$1 \\<ge> 0) T);\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2))\"", "lemma norm_diff_therm_dyn: \"0 < a \\<Longrightarrow> \\<parallel>f a L s\\<^sub>1 - f a L s\\<^sub>2\\<parallel> = \\<bar>a\\<bar> * \\<bar>s\\<^sub>1$1 - s\\<^sub>2$1\\<bar>\"", "lemma local_lipschitz_therm_dyn:\n  assumes \"0 < (a::real)\"\n  shows \"local_lipschitz UNIV UNIV (\\<lambda>t::real. f a L)\"", "lemma local_flow_therm: \"a > 0 \\<Longrightarrow> local_flow (f a L) UNIV UNIV (\\<phi> a L)\"", "lemma therm_dyn_down_real_arith:\n  assumes \"a > 0\" and Thyps: \"0 < Tmin\" \"Tmin \\<le> T\" \"T \\<le> Tmax\"\n    and thyps: \"0 \\<le> (\\<tau>::real)\" \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> - (ln (Tmin / T) / a) \"\n  shows \"Tmin \\<le> exp (-a * \\<tau>) * T\" and \"exp (-a * \\<tau>) * T \\<le> Tmax\"", "lemma therm_dyn_up_real_arith:\n  assumes \"a > 0\" and Thyps: \"Tmin \\<le> T\" \"T \\<le> Tmax\" \"Tmax < (L::real)\"\n    and thyps: \"0 \\<le> \\<tau>\" \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a) \"\n  shows \"L - Tmax \\<le> exp (-(a * \\<tau>)) * (L - T)\" \n    and \"L - exp (-(a * \\<tau>)) * (L - T) \\<le> Tmax\" \n    and \"Tmin \\<le> L - exp (-(a * \\<tau>)) * (L - T)\"", "lemmas H_g_ode_therm = local_flow.sH_g_ode_ivl[OF local_flow_therm _ UNIV_I]", "lemma thermostat_flow: \n  assumes \"0 < a\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"\\<^bold>{I Tmin Tmax\\<^bold>}\n  (LOOP (\n    \\<comment> \\<open>control\\<close>\n    (2 ::= (\\<lambda>s. 0));\n    (3 ::= (\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> Tmin + 1) THEN \n      (4 ::= (\\<lambda>s.1)) \n     ELSE IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> Tmax - 1) THEN \n      (4 ::= (\\<lambda>s.0)) \n     ELSE skip);\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n    ELSE \n      (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0))\n  ) INV I Tmin Tmax)\n   \\<^bold>{I Tmin Tmax\\<^bold>}\"", "lemma R_therm_dyn_down: \n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>\\<lambda>s. s$4 = 0 \\<and> I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n    (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0)\"", "lemma R_therm_dyn_up: \n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>\\<lambda>s. s$4 \\<noteq> 0 \\<and> I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n    (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0)\"", "lemma R_therm_dyn:\n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n  (IF (\\<lambda>s. s$4 = 0) THEN \n    (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n  ELSE \n    (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0))\"", "lemma R_therm_assign1: \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0\\<rceil> \\<ge> (2 ::= (\\<lambda>s. 0))\"", "lemma R_therm_assign2: \n  \"Ref \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<ge> (3 ::= (\\<lambda>s. s$1))\"", "lemma R_therm_ctrl:\n  \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<ge>\n  (2 ::= (\\<lambda>s. 0));\n  (3 ::= (\\<lambda>s. s$1));\n  (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> Tmin + 1) THEN \n    (4 ::= (\\<lambda>s.1)) \n   ELSE IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> Tmax - 1) THEN \n    (4 ::= (\\<lambda>s.0)) \n   ELSE skip)\"", "lemma R_therm_loop: \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n  (LOOP \n    Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil>;\n    Ref \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil>\n  INV I Tmin Tmax)\"", "lemma R_thermostat_flow: \n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n  (LOOP (\n    \\<comment> \\<open>control\\<close>\n    (2 ::= (\\<lambda>s. 0));(3 ::= (\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> Tmin + 1) THEN \n      (4 ::= (\\<lambda>s.1)) \n     ELSE IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> Tmax - 1) THEN \n      (4 ::= (\\<lambda>s.0)) \n     ELSE skip);\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n    ELSE \n      (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0))\n  ) INV I Tmin Tmax)\"", "lemma local_flow_tank: \"local_flow (f k) UNIV UNIV (\\<phi> k)\"", "lemma tank_arith:\n  assumes \"0 \\<le> (\\<tau>::real)\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> - ((hmin - y) / c\\<^sub>o) \\<Longrightarrow>  hmin \\<le> y - c\\<^sub>o * \\<tau>\"\n    and \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> (hmax - y) / (c\\<^sub>i - c\\<^sub>o) \\<Longrightarrow>  (c\\<^sub>i - c\\<^sub>o) * \\<tau> + y \\<le> hmax\"\n    and \"hmin \\<le> y \\<Longrightarrow> hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\"\n    and \"y \\<le> hmax \\<Longrightarrow> y - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax\"", "lemmas H_g_ode_tank = local_flow.sH_g_ode_ivl[OF local_flow_tank _ UNIV_I]", "lemma tank_flow:\n  assumes \"0 \\<le> \\<tau>\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"\\<^bold>{I hmin hmax\\<^bold>}\n  (LOOP \n    \\<comment> \\<open>control\\<close>\n    ((2 ::=(\\<lambda>s.0));(3 ::=(\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> hmin + 1) THEN (4 ::= (\\<lambda>s.1)) ELSE \n    (IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> hmax - 1) THEN (4 ::= (\\<lambda>s.0)) ELSE skip));\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN (x\\<acute>= (\\<lambda>t. f (c\\<^sub>i-c\\<^sub>o)) & G hmax (c\\<^sub>i-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n     ELSE (x\\<acute>= (\\<lambda>t. f (-c\\<^sub>o)) & G hmin (-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0)) )\n  INV I hmin hmax) \n  \\<^bold>{I hmin hmax\\<^bold>}\"", "lemma tank_diff_inv:\n  \"0 \\<le> \\<tau> \\<Longrightarrow> diff_invariant (dI hmin hmax k) (\\<lambda>t. f k) (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\"", "lemma tank_inv_arith1:\n  assumes \"0 \\<le> (\\<tau>::real)\" and \"c\\<^sub>o < c\\<^sub>i\" and b: \"hmin \\<le> y\\<^sub>0\" and g: \"\\<tau> \\<le> (hmax - y\\<^sub>0) / (c\\<^sub>i - c\\<^sub>o)\"\n  shows \"hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0\" and \"(c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax\"", "lemma tank_inv_arith2:\n  assumes \"0 \\<le> (\\<tau>::real)\" and \"0 < c\\<^sub>o\" and b: \"y\\<^sub>0 \\<le> hmax\" and g: \"\\<tau> \\<le> - ((hmin - y\\<^sub>0) / c\\<^sub>o)\"\n  shows \"hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau>\" and \"y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax\"", "lemma tank_inv:\n  assumes \"0 \\<le> \\<tau>\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"\\<^bold>{I hmin hmax\\<^bold>}\n  (LOOP \n    \\<comment> \\<open>control\\<close>\n    ((2 ::=(\\<lambda>s.0));(3 ::=(\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> hmin + 1) THEN (4 ::= (\\<lambda>s.1)) ELSE \n    (IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> hmax - 1) THEN (4 ::= (\\<lambda>s.0)) ELSE skip));\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f (c\\<^sub>i-c\\<^sub>o)) & G hmax (c\\<^sub>i-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (c\\<^sub>i-c\\<^sub>o))) \n     ELSE \n      (x\\<acute>= (\\<lambda>t. f (-c\\<^sub>o)) & G hmin (-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (-c\\<^sub>o)))) )\n  INV I hmin hmax)\n  \\<^bold>{I hmin hmax\\<^bold>}\"", "lemma R_tank_inv:\n  assumes \"0 \\<le> \\<tau>\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil> \\<ge> \n  (LOOP \n    \\<comment> \\<open>control\\<close>\n    ((2 ::=(\\<lambda>s.0));(3 ::=(\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> hmin + 1) THEN (4 ::= (\\<lambda>s.1)) ELSE \n    (IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> hmax - 1) THEN (4 ::= (\\<lambda>s.0)) ELSE skip));\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f (c\\<^sub>i-c\\<^sub>o)) & G hmax (c\\<^sub>i-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (c\\<^sub>i-c\\<^sub>o))) \n     ELSE \n      (x\\<acute>= (\\<lambda>t. f (-c\\<^sub>o)) & G hmin (-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (-c\\<^sub>o)))) )\n  INV I hmin hmax)\""], "translations": [["", "lemma pendulum_dyn: \"\\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>} EVOL \\<phi> G T \\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>{\\<lambda>s.\n                r\\<^sup>2 =\n                (s $ 1)\\<^sup>2 +\n                (s $\n                 2)\\<^sup>2\\<^bold>}EVOL \\<phi> G\n                                     T\\<^bold>{\\<lambda>s.\n            r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}", "by simp\n\n\\<comment> \\<open>Verified with differential invariants \\<close>"], ["", "lemma pendulum_inv: \"\\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>} (x\\<acute>=f & G) \\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>{\\<lambda>s.\n                r\\<^sup>2 =\n                (s $ 1)\\<^sup>2 +\n                (s $\n                 2)\\<^sup>2\\<^bold>}x\\<acute>= \\<lambda>t.\n            f & G on \\<lambda>s.\n                        {t. 0 \\<le> t} UNIV @ 0\\<^bold>{\\<lambda>s.\n                     r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}", "by (auto intro!: diff_invariant_rules poly_derivatives)\n\n\\<comment> \\<open>Verified with the flow \\<close>"], ["", "lemma local_flow_pend: \"local_flow f UNIV UNIV \\<phi>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. local_flow f UNIV UNIV \\<phi>", "apply(unfold_locales, simp_all add: local_lipschitz_def lipschitz_on_def vec_eq_iff, clarsimp)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x t.\n       \\<exists>u>0.\n          (\\<exists>ta. dist t ta \\<le> u) \\<longrightarrow>\n          (\\<exists>L\\<ge>0.\n              \\<forall>xa\\<in>cball x u.\n                 \\<forall>y\\<in>cball x u.\n                    dist (f xa) (f y) \\<le> L \\<cdot> dist xa y)\n 2. \\<And>t s.\n       \\<forall>i.\n           D (\\<lambda>x.\n                 if i = 1 then s $ 1 \\<cdot> cos x + s $ 2 \\<cdot> sin x\n                 else - s $ 1 \\<cdot> sin x +\n                      s $ 2 \\<cdot>\n                      cos x) = (\\<lambda>x.\n                                   if i = 1 then \\<phi> x s $ 2\n                                   else - \\<phi> x s $ 1)\n           on {0--t}\n 3. \\<And>s. \\<forall>i. i \\<noteq> 1 \\<longrightarrow> s $ 2 = s $ i", "apply(rule_tac x=\"1\" in exI, clarsimp, rule_tac x=1 in exI)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x t ta.\n       dist t ta \\<le> 1 \\<Longrightarrow>\n       0 \\<le> 1 \\<and>\n       (\\<forall>xa\\<in>cball x 1.\n           \\<forall>y\\<in>cball x 1.\n              dist (f xa) (f y) \\<le> 1 \\<cdot> dist xa y)\n 2. \\<And>t s.\n       \\<forall>i.\n           D (\\<lambda>x.\n                 if i = 1 then s $ 1 \\<cdot> cos x + s $ 2 \\<cdot> sin x\n                 else - s $ 1 \\<cdot> sin x +\n                      s $ 2 \\<cdot>\n                      cos x) = (\\<lambda>x.\n                                   if i = 1 then \\<phi> x s $ 2\n                                   else - \\<phi> x s $ 1)\n           on {0--t}\n 3. \\<And>s. \\<forall>i. i \\<noteq> 1 \\<longrightarrow> s $ 2 = s $ i", "apply(simp add: dist_norm norm_vec_def L2_set_def power2_commute UNIV_2)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>t s.\n       \\<forall>i.\n           D (\\<lambda>x.\n                 if i = 1 then s $ 1 \\<cdot> cos x + s $ 2 \\<cdot> sin x\n                 else - s $ 1 \\<cdot> sin x +\n                      s $ 2 \\<cdot>\n                      cos x) = (\\<lambda>x.\n                                   if i = 1 then \\<phi> x s $ 2\n                                   else - \\<phi> x s $ 1)\n           on {0--t}\n 2. \\<And>s. \\<forall>i. i \\<noteq> 1 \\<longrightarrow> s $ 2 = s $ i", "by (auto simp: forall_2 intro!: poly_derivatives)"], ["", "lemma pendulum_flow: \"\\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>} (x\\<acute>=f & G) \\<^bold>{\\<lambda>s. r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>{\\<lambda>s.\n                r\\<^sup>2 =\n                (s $ 1)\\<^sup>2 +\n                (s $\n                 2)\\<^sup>2\\<^bold>}x\\<acute>= \\<lambda>t.\n            f & G on \\<lambda>s.\n                        {t. 0 \\<le> t} UNIV @ 0\\<^bold>{\\<lambda>s.\n                     r\\<^sup>2 = (s $ 1)\\<^sup>2 + (s $ 2)\\<^sup>2\\<^bold>}", "by (subst local_flow.sH_g_ode_subset[OF local_flow_pend], simp_all)"], ["", "no_notation fpend (\"f\")\n        and pend_flow (\"\\<phi>\")"], ["", "subsubsection \\<open> Bouncing Ball \\<close>"], ["", "text \\<open> A ball is dropped from rest at an initial height @{text \"h\"}. The motion is described with\nthe free-fall equations @{text \"x' t = v t\"} and @{text \"v' t = g\"} where @{text \"g\"} is the\nconstant acceleration due to gravity. The bounce is modelled with a variable assignment that\nflips the velocity. That is, we model it as a completely elastic collision with the ground. We use \n@{text \"s$1\"} to represent the ball's height and @{text \"s$2\"} for its velocity. We prove that the \nball remains above ground and below its initial resting position. \\<close>"], ["", "abbreviation fball :: \"real \\<Rightarrow> real^2 \\<Rightarrow> real^2\" (\"f\") \n  where \"f g s \\<equiv> (\\<chi> i. if i=1 then s$2 else g)\""], ["", "abbreviation ball_flow :: \"real \\<Rightarrow> real \\<Rightarrow> real^2 \\<Rightarrow> real^2\" (\"\\<phi>\") \n  where \"\\<phi> g \\<tau> s \\<equiv> (\\<chi> i. if i=1 then g \\<cdot> \\<tau> ^ 2/2 + s$2 \\<cdot> \\<tau> + s$1 else g \\<cdot> \\<tau> + s$2)\"\n\n\\<comment> \\<open>Verified with differential invariants \\<close>"], ["", "named_theorems bb_real_arith \"real arithmetic properties for the bouncing ball.\""], ["", "lemma [bb_real_arith]: \n  assumes \"0 > g\" and inv: \"2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h = v \\<cdot> v\"\n  shows \"(x::real) \\<le> h\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<le> h", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. x \\<le> h", "have \"v \\<cdot> v = 2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h \\<and> 0 > g\""], ["proof (prove)\ngoal (1 subgoal):\n 1. v \\<cdot> v = 2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h \\<and> g < 0", "using inv and \\<open>0 > g\\<close>"], ["proof (prove)\nusing this:\n  2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h = v \\<cdot> v\n  g < 0\n\ngoal (1 subgoal):\n 1. v \\<cdot> v = 2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h \\<and> g < 0", "by auto"], ["proof (state)\nthis:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h \\<and> g < 0\n\ngoal (1 subgoal):\n 1. x \\<le> h", "hence obs:\"v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and> 0 > g \\<and> v \\<cdot> v \\<ge> 0\""], ["proof (prove)\nusing this:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h \\<and> g < 0\n\ngoal (1 subgoal):\n 1. v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and>\n    g < 0 \\<and> 0 \\<le> v \\<cdot> v", "using left_diff_distrib mult.commute"], ["proof (prove)\nusing this:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> x - 2 \\<cdot> g \\<cdot> h \\<and> g < 0\n  (?a - ?b) \\<cdot> ?c = ?a \\<cdot> ?c - ?b \\<cdot> ?c\n  ?a \\<cdot> ?b = ?b \\<cdot> ?a\n\ngoal (1 subgoal):\n 1. v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and>\n    g < 0 \\<and> 0 \\<le> v \\<cdot> v", "by (metis zero_le_square)"], ["proof (state)\nthis:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and>\n  g < 0 \\<and> 0 \\<le> v \\<cdot> v\n\ngoal (1 subgoal):\n 1. x \\<le> h", "hence \"(v \\<cdot> v)/(2 \\<cdot> g) = (x - h)\""], ["proof (prove)\nusing this:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and>\n  g < 0 \\<and> 0 \\<le> v \\<cdot> v\n\ngoal (1 subgoal):\n 1. v \\<cdot> v / (2 \\<cdot> g) = x - h", "by auto"], ["proof (state)\nthis:\n  v \\<cdot> v / (2 \\<cdot> g) = x - h\n\ngoal (1 subgoal):\n 1. x \\<le> h", "also"], ["proof (state)\nthis:\n  v \\<cdot> v / (2 \\<cdot> g) = x - h\n\ngoal (1 subgoal):\n 1. x \\<le> h", "from obs"], ["proof (chain)\npicking this:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and>\n  g < 0 \\<and> 0 \\<le> v \\<cdot> v", "have \"(v \\<cdot> v)/(2 \\<cdot> g) \\<le> 0\""], ["proof (prove)\nusing this:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and>\n  g < 0 \\<and> 0 \\<le> v \\<cdot> v\n\ngoal (1 subgoal):\n 1. v \\<cdot> v / (2 \\<cdot> g) \\<le> 0", "using divide_nonneg_neg"], ["proof (prove)\nusing this:\n  v \\<cdot> v = 2 \\<cdot> g \\<cdot> (x - h) \\<and>\n  g < 0 \\<and> 0 \\<le> v \\<cdot> v\n  \\<lbrakk>(0::?'a) \\<le> ?x; ?y < (0::?'a)\\<rbrakk>\n  \\<Longrightarrow> ?x / ?y \\<le> (0::?'a)\n\ngoal (1 subgoal):\n 1. v \\<cdot> v / (2 \\<cdot> g) \\<le> 0", "by fastforce"], ["proof (state)\nthis:\n  v \\<cdot> v / (2 \\<cdot> g) \\<le> 0\n\ngoal (1 subgoal):\n 1. x \\<le> h", "ultimately"], ["proof (chain)\npicking this:\n  v \\<cdot> v / (2 \\<cdot> g) = x - h\n  v \\<cdot> v / (2 \\<cdot> g) \\<le> 0", "have \"h - x \\<ge> 0\""], ["proof (prove)\nusing this:\n  v \\<cdot> v / (2 \\<cdot> g) = x - h\n  v \\<cdot> v / (2 \\<cdot> g) \\<le> 0\n\ngoal (1 subgoal):\n 1. 0 \\<le> h - x", "by linarith"], ["proof (state)\nthis:\n  0 \\<le> h - x\n\ngoal (1 subgoal):\n 1. x \\<le> h", "thus ?thesis"], ["proof (prove)\nusing this:\n  0 \\<le> h - x\n\ngoal (1 subgoal):\n 1. x \\<le> h", "by auto"], ["proof (state)\nthis:\n  x \\<le> h\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma fball_invariant: \n  fixes g h :: real\n  defines dinv: \"I \\<equiv> (\\<lambda>s. 2 \\<cdot> g \\<cdot> s$1 - 2 \\<cdot> g \\<cdot> h - (s$2 \\<cdot> s$2) = 0)\"\n  shows \"diff_invariant I (\\<lambda>t. f g) (\\<lambda>s. UNIV) UNIV 0 G\""], ["proof (prove)\ngoal (1 subgoal):\n 1. diff_invariant I (\\<lambda>t. f g) (\\<lambda>s. UNIV) UNIV 0 G", "unfolding dinv"], ["proof (prove)\ngoal (1 subgoal):\n 1. diff_invariant\n     (\\<lambda>s.\n         2 \\<cdot> g \\<cdot> s $ 1 - 2 \\<cdot> g \\<cdot> h -\n         s $ 2 \\<cdot> s $ 2 =\n         0)\n     (\\<lambda>t. f g) (\\<lambda>s. UNIV) UNIV 0 G", "apply(rule diff_invariant_rules, simp)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>X.\n        D X = (\\<lambda>\\<tau>. f g (X \\<tau>)) on UNIV \\<Longrightarrow>\n        D (\\<lambda>\\<tau>.\n              2 \\<cdot> g \\<cdot> X \\<tau> $ 1 - 2 \\<cdot> g \\<cdot> h -\n              X \\<tau> $ 2 \\<cdot> X \\<tau> $ 2 -\n              0) = (*\\<^sub>R) 0\n        on UNIV", "by(auto intro!: poly_derivatives)"], ["", "lemma bouncing_ball_inv: \"g < 0 \\<Longrightarrow> h \\<ge> 0 \\<Longrightarrow> \n  \\<^bold>{\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<^bold>}\n  (LOOP \n      ((x\\<acute>= f g & (\\<lambda> s. s$1 \\<ge> 0) DINV (\\<lambda>s. 2 \\<cdot> g \\<cdot> s$1 - 2 \\<cdot> g \\<cdot> h - s$2 \\<cdot> s$2 = 0));\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2)\n  ) \\<^bold>{\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  s $ 1 = h \\<and>\n                                  s $ 2 =\n                                  0\\<^bold>}LOOP x\\<acute>=\\<lambda>t.\n                        f g & \\<lambda>s.\n                                 0 \\<le> s $\n   1 on \\<lambda>s.\n           {t. 0 \\<le> t} UNIV @ 0 DINV \\<lambda>s.\n     2 \\<cdot> g \\<cdot> s $ 1 - 2 \\<cdot> g \\<cdot> h -\n     s $ 2 \\<cdot> s $ 2 =\n     0  ;\n           (IF (\\<lambda>s.\n                   s $ 1 =\n                   0) THEN (2 ::= (\\<lambda>s.\n- s $\n  2)) ELSE skip) INV (\\<lambda>s.\n                         0 \\<le> s $ 1 \\<and>\n                         2 \\<cdot> g \\<cdot> s $ 1 =\n                         2 \\<cdot> g \\<cdot> h +\n                         s $ 2 \\<cdot>\n                         s $\n                         2) \\<^bold>{\\<lambda>s.\n  0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<^bold>}", "apply(hyb_hoare \"\\<lambda>s::real^2. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2\")"], ["proof (prove)\ngoal (7 subgoals):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> diff_invariant\n                       (\\<lambda>s.\n                           2 \\<cdot> g \\<cdot> s $ 1 -\n                           2 \\<cdot> g \\<cdot> h =\n                           s $ 2 \\<cdot> s $ 2)\n                       (\\<lambda>t. f g) (\\<lambda>s. Collect ((\\<le>) 0))\n                       UNIV 0 (\\<lambda>s. 0 \\<le> s $ 1)\n 2. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 0 \\<le> s $ 1 \\<and>\n                                 2 \\<cdot> g \\<cdot> s $ 1 =\n                                 2 \\<cdot> g \\<cdot> h +\n                                 s $ 2 \\<cdot> s $ 2\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 2 \\<cdot> g \\<cdot> s $ 1 - 2 \\<cdot> g \\<cdot> h - s $ 2 \\<cdot> s $ 2 =\n 0\\<rceil>\n 3. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 2 \\<cdot> g \\<cdot> s $ 1 -\n                                 2 \\<cdot> g \\<cdot> h -\n                                 s $ 2 \\<cdot> s $ 2 =\n                                 0 \\<and>\n                                 0 \\<le> s $ 1\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and>\n 2 \\<cdot> g \\<cdot> s $ 1 =\n 2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 4. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<forall>s.\n                         0 \\<le> s $ 1 \\<and>\n                         2 \\<cdot> g \\<cdot> s $ 1 =\n                         2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 \\<and>\n                         s $ 1 = 0 \\<longrightarrow>\n                         2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 = 0\n 5. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  (0 \\<le> s $ 1 \\<and>\n                                   2 \\<cdot> g \\<cdot> s $ 1 =\n                                   2 \\<cdot> g \\<cdot> h +\n                                   s $ 2 \\<cdot> s $ 2) \\<and>\n                                  s $ 1 \\<noteq>\n                                  0\\<^bold>}skip\\<^bold>{\\<lambda>s.\n                      0 \\<le> s $ 1 \\<and>\n                      2 \\<cdot> g \\<cdot> s $ 1 =\n                      2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<^bold>}\n 6. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and>\n 2 \\<cdot> g \\<cdot> s $ 1 =\n 2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 7. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 0 \\<le> s $ 1 \\<and>\n                                 2 \\<cdot> g \\<cdot> s $ 1 =\n                                 2 \\<cdot> g \\<cdot> h +\n                                 s $ 2 \\<cdot> s $ 2\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "using fball_invariant"], ["proof (prove)\nusing this:\n  diff_invariant\n   (\\<lambda>s.\n       2 \\<cdot> ?g \\<cdot> s $ 1 - 2 \\<cdot> ?g \\<cdot> ?h -\n       s $ 2 \\<cdot> s $ 2 =\n       0)\n   (\\<lambda>t. f ?g) (\\<lambda>s. UNIV) UNIV 0 ?G\n\ngoal (7 subgoals):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> diff_invariant\n                       (\\<lambda>s.\n                           2 \\<cdot> g \\<cdot> s $ 1 -\n                           2 \\<cdot> g \\<cdot> h =\n                           s $ 2 \\<cdot> s $ 2)\n                       (\\<lambda>t. f g) (\\<lambda>s. Collect ((\\<le>) 0))\n                       UNIV 0 (\\<lambda>s. 0 \\<le> s $ 1)\n 2. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 0 \\<le> s $ 1 \\<and>\n                                 2 \\<cdot> g \\<cdot> s $ 1 =\n                                 2 \\<cdot> g \\<cdot> h +\n                                 s $ 2 \\<cdot> s $ 2\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 2 \\<cdot> g \\<cdot> s $ 1 - 2 \\<cdot> g \\<cdot> h - s $ 2 \\<cdot> s $ 2 =\n 0\\<rceil>\n 3. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 2 \\<cdot> g \\<cdot> s $ 1 -\n                                 2 \\<cdot> g \\<cdot> h -\n                                 s $ 2 \\<cdot> s $ 2 =\n                                 0 \\<and>\n                                 0 \\<le> s $ 1\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and>\n 2 \\<cdot> g \\<cdot> s $ 1 =\n 2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 4. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<forall>s.\n                         0 \\<le> s $ 1 \\<and>\n                         2 \\<cdot> g \\<cdot> s $ 1 =\n                         2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 \\<and>\n                         s $ 1 = 0 \\<longrightarrow>\n                         2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 = 0\n 5. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  (0 \\<le> s $ 1 \\<and>\n                                   2 \\<cdot> g \\<cdot> s $ 1 =\n                                   2 \\<cdot> g \\<cdot> h +\n                                   s $ 2 \\<cdot> s $ 2) \\<and>\n                                  s $ 1 \\<noteq>\n                                  0\\<^bold>}skip\\<^bold>{\\<lambda>s.\n                      0 \\<le> s $ 1 \\<and>\n                      2 \\<cdot> g \\<cdot> s $ 1 =\n                      2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<^bold>}\n 6. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and>\n 2 \\<cdot> g \\<cdot> s $ 1 =\n 2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 7. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 0 \\<le> s $ 1 \\<and>\n                                 2 \\<cdot> g \\<cdot> s $ 1 =\n                                 2 \\<cdot> g \\<cdot> h +\n                                 s $ 2 \\<cdot> s $ 2\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "by (auto simp: bb_real_arith intro!: poly_derivatives diff_invariant_rules)\n\n\\<comment> \\<open>Verified with annotated dynamics \\<close>"], ["", "lemma [bb_real_arith]:\n  assumes invar: \"2 \\<cdot> g \\<cdot> x = 2 \\<cdot> g \\<cdot> h + v \\<cdot> v\"\n    and pos: \"g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + (x::real) = 0\"\n  shows \"2 \\<cdot> g \\<cdot> h + (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) = 0\"\n    and \"2 \\<cdot> g \\<cdot> h + (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) + v \\<cdot> (g \\<cdot> \\<tau> + v)) = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0 &&&\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    0", "proof-"], ["proof (state)\ngoal (2 subgoals):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0\n 2. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    0", "from pos"], ["proof (chain)\npicking this:\n  g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x = 0", "have \"g \\<cdot> \\<tau>\\<^sup>2  + 2 \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> x = 0\""], ["proof (prove)\nusing this:\n  g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x = 0\n\ngoal (1 subgoal):\n 1. g \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> x = 0", "by auto"], ["proof (state)\nthis:\n  g \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> x = 0\n\ngoal (2 subgoals):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0\n 2. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    0", "then"], ["proof (chain)\npicking this:\n  g \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> x = 0", "have \"g\\<^sup>2  \\<cdot> \\<tau>\\<^sup>2  + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> g \\<cdot> x = 0\""], ["proof (prove)\nusing this:\n  g \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> x = 0\n\ngoal (1 subgoal):\n 1. g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> x =\n    0", "by (metis (mono_tags, hide_lams) Groups.mult_ac(1,3) mult_zero_right\n        monoid_mult_class.power2_eq_square semiring_class.distrib_left)"], ["proof (state)\nthis:\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> x =\n  0\n\ngoal (2 subgoals):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0\n 2. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    0", "hence \"g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> + v\\<^sup>2 + 2 \\<cdot> g \\<cdot> h = 0\""], ["proof (prove)\nusing this:\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> x =\n  0\n\ngoal (1 subgoal):\n 1. g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    v\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> h =\n    0", "using invar"], ["proof (prove)\nusing this:\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> x =\n  0\n  2 \\<cdot> g \\<cdot> x = 2 \\<cdot> g \\<cdot> h + v \\<cdot> v\n\ngoal (1 subgoal):\n 1. g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    v\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> h =\n    0", "by (simp add: monoid_mult_class.power2_eq_square)"], ["proof (state)\nthis:\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  v\\<^sup>2 +\n  2 \\<cdot> g \\<cdot> h =\n  0\n\ngoal (2 subgoals):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0\n 2. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    0", "hence obs: \"(g \\<cdot> \\<tau> + v)\\<^sup>2 + 2 \\<cdot> g \\<cdot> h = 0\""], ["proof (prove)\nusing this:\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  v\\<^sup>2 +\n  2 \\<cdot> g \\<cdot> h =\n  0\n\ngoal (1 subgoal):\n 1. (g \\<cdot> \\<tau> + v)\\<^sup>2 + 2 \\<cdot> g \\<cdot> h = 0", "apply(subst power2_sum)"], ["proof (prove)\ngoal (1 subgoal):\n 1. g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    v\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> h =\n    0 \\<Longrightarrow>\n    (g \\<cdot> \\<tau>)\\<^sup>2 + v\\<^sup>2 +\n    2 \\<cdot> (g \\<cdot> \\<tau>) \\<cdot> v +\n    2 \\<cdot> g \\<cdot> h =\n    0", "by (metis (no_types, hide_lams) Groups.add_ac(2, 3) \n        Groups.mult_ac(2, 3) monoid_mult_class.power2_eq_square nat_distrib(2))"], ["proof (state)\nthis:\n  (g \\<cdot> \\<tau> + v)\\<^sup>2 + 2 \\<cdot> g \\<cdot> h = 0\n\ngoal (2 subgoals):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0\n 2. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    0", "thus \"2 \\<cdot> g \\<cdot> h + (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) + v \\<cdot> (g \\<cdot> \\<tau> + v)) = 0\""], ["proof (prove)\nusing this:\n  (g \\<cdot> \\<tau> + v)\\<^sup>2 + 2 \\<cdot> g \\<cdot> h = 0\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    0", "by (simp add: monoid_mult_class.power2_eq_square)"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  0\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0", "have  \"2 \\<cdot> g \\<cdot> h + (- ((g \\<cdot> \\<tau>) + v))\\<^sup>2 = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h + (- (g \\<cdot> \\<tau> + v))\\<^sup>2 = 0", "using obs"], ["proof (prove)\nusing this:\n  (g \\<cdot> \\<tau> + v)\\<^sup>2 + 2 \\<cdot> g \\<cdot> h = 0\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h + (- (g \\<cdot> \\<tau> + v))\\<^sup>2 = 0", "by (metis Groups.add_ac(2) power2_minus)"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot> h + (- (g \\<cdot> \\<tau> + v))\\<^sup>2 = 0\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0", "thus \"2 \\<cdot> g \\<cdot> h + (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) = 0\""], ["proof (prove)\nusing this:\n  2 \\<cdot> g \\<cdot> h + (- (g \\<cdot> \\<tau> + v))\\<^sup>2 = 0\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n    0", "by (simp add: monoid_mult_class.power2_eq_square)"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot> h +\n  (- (g \\<cdot> \\<tau>) - v) \\<cdot> (- (g \\<cdot> \\<tau>) - v) =\n  0\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma [bb_real_arith]:\n  assumes invar: \"2 \\<cdot> g \\<cdot> x = 2 \\<cdot> g \\<cdot> h + v \\<cdot> v\"\n  shows \"2 \\<cdot> g \\<cdot> (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + (x::real)) = \n  2 \\<cdot> g \\<cdot> h + (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) + v \\<cdot> (g \\<cdot> \\<tau> + v))\" (is \"?lhs = ?rhs\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "have \"?lhs = g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> g \\<cdot> x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> x", "by(auto simp: algebra_simps semiring_normalization_rules(29))"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> x\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "also"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> x\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "have \"... = g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> g \\<cdot> h + v \\<cdot> v\" (is \"... = ?middle\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> x =\n    g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> h +\n    v \\<cdot> v", "by(subst invar, simp)"], ["proof (state)\nthis:\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> x =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "finally"], ["proof (chain)\npicking this:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v", "have \"?lhs = ?middle\""], ["proof (prove)\nusing this:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> h +\n    v \\<cdot> v", "."], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "moreover"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "{"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "have \"?rhs = g \\<cdot> g \\<cdot> (\\<tau> \\<cdot> \\<tau>) + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> + 2 \\<cdot> g \\<cdot> h + v \\<cdot> v\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    g \\<cdot> g \\<cdot> (\\<tau> \\<cdot> \\<tau>) +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> h +\n    v \\<cdot> v", "by (simp add: Groups.mult_ac(2,3) semiring_class.distrib_left)"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g \\<cdot> g \\<cdot> (\\<tau> \\<cdot> \\<tau>) +\n  2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "also"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g \\<cdot> g \\<cdot> (\\<tau> \\<cdot> \\<tau>) +\n  2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "have \"... = ?middle\""], ["proof (prove)\ngoal (1 subgoal):\n 1. g \\<cdot> g \\<cdot> (\\<tau> \\<cdot> \\<tau>) +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> h +\n    v \\<cdot> v =\n    g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> h +\n    v \\<cdot> v", "by (simp add: semiring_normalization_rules(29))"], ["proof (state)\nthis:\n  g \\<cdot> g \\<cdot> (\\<tau> \\<cdot> \\<tau>) +\n  2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "finally"], ["proof (chain)\npicking this:\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v", "have \"?rhs = ?middle\""], ["proof (prove)\nusing this:\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n    g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 +\n    2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n    2 \\<cdot> g \\<cdot> h +\n    v \\<cdot> v", "."], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "}"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "ultimately"], ["proof (chain)\npicking this:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v", "show ?thesis"], ["proof (prove)\nusing this:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v)) =\n  g\\<^sup>2 \\<cdot> \\<tau>\\<^sup>2 + 2 \\<cdot> g \\<cdot> v \\<cdot> \\<tau> +\n  2 \\<cdot> g \\<cdot> h +\n  v \\<cdot> v\n\ngoal (1 subgoal):\n 1. 2 \\<cdot> g \\<cdot>\n    (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n    2 \\<cdot> g \\<cdot> h +\n    (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n     v \\<cdot> (g \\<cdot> \\<tau> + v))", "by auto"], ["proof (state)\nthis:\n  2 \\<cdot> g \\<cdot>\n  (g \\<cdot> \\<tau>\\<^sup>2 / 2 + v \\<cdot> \\<tau> + x) =\n  2 \\<cdot> g \\<cdot> h +\n  (g \\<cdot> \\<tau> \\<cdot> (g \\<cdot> \\<tau> + v) +\n   v \\<cdot> (g \\<cdot> \\<tau> + v))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma bouncing_ball_dyn: \"g < 0 \\<Longrightarrow> h \\<ge> 0 \\<Longrightarrow>\n  \\<^bold>{\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<^bold>}\n  (LOOP \n      ((EVOL (\\<phi> g) (\\<lambda> s. s$1 \\<ge> 0) T);\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2)\n  ) \\<^bold>{\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  s $ 1 = h \\<and>\n                                  s $ 2 =\n                                  0\\<^bold>}LOOP EVOL\n            (\\<lambda>\\<tau> s.\n                \\<chi>i.\n                   if i = 1\n                   then g \\<cdot> \\<tau>\\<^sup>2 / 2 +\n                        s $ 2 \\<cdot> \\<tau> +\n                        s $ 1\n                   else g \\<cdot> \\<tau> + s $ 2)\n            (\\<lambda>s. 0 \\<le> s $ 1) T ;\n           (IF (\\<lambda>s.\n                   s $ 1 =\n                   0) THEN (2 ::= (\\<lambda>s.\n- s $\n  2)) ELSE skip) INV (\\<lambda>s.\n                         0 \\<le> s $ 1 \\<and>\n                         2 \\<cdot> g \\<cdot> s $ 1 =\n                         2 \\<cdot> g \\<cdot> h +\n                         s $ 2 \\<cdot>\n                         s $\n                         2) \\<^bold>{\\<lambda>s.\n  0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<^bold>}", "apply(hyb_hoare \"\\<lambda>s::real^2. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2\")"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  0 \\<le> s $ 1 \\<and>\n                                  2 \\<cdot> g \\<cdot> s $ 1 =\n                                  2 \\<cdot> g \\<cdot> h +\n                                  s $ 2 \\<cdot>\n                                  s $\n                                  2\\<^bold>}EVOL\n       (\\<lambda>\\<tau> s.\n           \\<chi>i.\n              if i = 1\n              then g \\<cdot> \\<tau>\\<^sup>2 / 2 + s $ 2 \\<cdot> \\<tau> +\n                   s $ 1\n              else g \\<cdot> \\<tau> + s $ 2)\n       (\\<lambda>s. 0 \\<le> s $ 1)\n       T\\<^bold>{\\<lambda>s.\n                    0 \\<le> s $ 1 \\<and>\n                    2 \\<cdot> g \\<cdot> s $ 1 =\n                    2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<^bold>}\n 2. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<forall>s.\n                         0 \\<le> s $ 1 \\<and>\n                         2 \\<cdot> g \\<cdot> s $ 1 =\n                         2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 \\<and>\n                         s $ 1 = 0 \\<longrightarrow>\n                         2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 = 0\n 3. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  (0 \\<le> s $ 1 \\<and>\n                                   2 \\<cdot> g \\<cdot> s $ 1 =\n                                   2 \\<cdot> g \\<cdot> h +\n                                   s $ 2 \\<cdot> s $ 2) \\<and>\n                                  s $ 1 \\<noteq>\n                                  0\\<^bold>}skip\\<^bold>{\\<lambda>s.\n                      0 \\<le> s $ 1 \\<and>\n                      2 \\<cdot> g \\<cdot> s $ 1 =\n                      2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<^bold>}\n 4. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and>\n 2 \\<cdot> g \\<cdot> s $ 1 =\n 2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 5. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 0 \\<le> s $ 1 \\<and>\n                                 2 \\<cdot> g \\<cdot> s $ 1 =\n                                 2 \\<cdot> g \\<cdot> h +\n                                 s $ 2 \\<cdot> s $ 2\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "by (auto simp: bb_real_arith)\n\n\\<comment> \\<open>Verified with the flow \\<close>"], ["", "lemma local_flow_ball: \"local_flow (f g) UNIV UNIV (\\<phi> g)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. local_flow (f g) UNIV UNIV\n     (\\<lambda>\\<tau> s.\n         \\<chi>i.\n            if i = 1\n            then g \\<cdot> \\<tau>\\<^sup>2 / 2 + s $ 2 \\<cdot> \\<tau> + s $ 1\n            else g \\<cdot> \\<tau> + s $ 2)", "apply(unfold_locales, simp_all add: local_lipschitz_def lipschitz_on_def vec_eq_iff, clarsimp)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x t.\n       \\<exists>u>0.\n          (\\<exists>ta. dist t ta \\<le> u) \\<longrightarrow>\n          (\\<exists>L\\<ge>0.\n              \\<forall>xa\\<in>cball x u.\n                 \\<forall>y\\<in>cball x u.\n                    dist (f g xa) (f g y) \\<le> L \\<cdot> dist xa y)\n 2. \\<And>t s.\n       \\<forall>i.\n           D (\\<lambda>x.\n                 if i = 1\n                 then g \\<cdot> x\\<^sup>2 / 2 + s $ 2 \\<cdot> x + s $ 1\n                 else g \\<cdot> x +\n                      s $\n                      2) = (\\<lambda>x.\n                               if i = 1\n                               then (\\<chi>i.\n  if i = 1 then g \\<cdot> x\\<^sup>2 / 2 + s $ 2 \\<cdot> x + s $ 1\n  else g \\<cdot> x + s $ 2) $\n                                    2\n                               else g)\n           on {0--t}\n 3. \\<And>s. \\<forall>i. i \\<noteq> 1 \\<longrightarrow> s $ 2 = s $ i", "apply(rule_tac x=\"1/2\" in exI, clarsimp, rule_tac x=1 in exI)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x t ta.\n       dist t ta \\<cdot> 2 \\<le> 1 \\<Longrightarrow>\n       0 \\<le> 1 \\<and>\n       (\\<forall>xa\\<in>cball x (1 / 2).\n           \\<forall>y\\<in>cball x (1 / 2).\n              dist (f g xa) (f g y) \\<le> 1 \\<cdot> dist xa y)\n 2. \\<And>t s.\n       \\<forall>i.\n           D (\\<lambda>x.\n                 if i = 1\n                 then g \\<cdot> x\\<^sup>2 / 2 + s $ 2 \\<cdot> x + s $ 1\n                 else g \\<cdot> x +\n                      s $\n                      2) = (\\<lambda>x.\n                               if i = 1\n                               then (\\<chi>i.\n  if i = 1 then g \\<cdot> x\\<^sup>2 / 2 + s $ 2 \\<cdot> x + s $ 1\n  else g \\<cdot> x + s $ 2) $\n                                    2\n                               else g)\n           on {0--t}\n 3. \\<And>s. \\<forall>i. i \\<noteq> 1 \\<longrightarrow> s $ 2 = s $ i", "apply(simp add: dist_norm norm_vec_def L2_set_def UNIV_2)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>t s.\n       \\<forall>i.\n           D (\\<lambda>x.\n                 if i = 1\n                 then g \\<cdot> x\\<^sup>2 / 2 + s $ 2 \\<cdot> x + s $ 1\n                 else g \\<cdot> x +\n                      s $\n                      2) = (\\<lambda>x.\n                               if i = 1\n                               then (\\<chi>i.\n  if i = 1 then g \\<cdot> x\\<^sup>2 / 2 + s $ 2 \\<cdot> x + s $ 1\n  else g \\<cdot> x + s $ 2) $\n                                    2\n                               else g)\n           on {0--t}\n 2. \\<And>s. \\<forall>i. i \\<noteq> 1 \\<longrightarrow> s $ 2 = s $ i", "by (auto simp: forall_2 intro!: poly_derivatives)"], ["", "lemma bouncing_ball_flow: \"g < 0 \\<Longrightarrow> h \\<ge> 0 \\<Longrightarrow>\n  \\<^bold>{\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<^bold>}\n  (LOOP \n      ((x\\<acute>= f g & (\\<lambda> s. s$1 \\<ge> 0));\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2)\n  ) \\<^bold>{\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  s $ 1 = h \\<and>\n                                  s $ 2 =\n                                  0\\<^bold>}LOOP x\\<acute>= \\<lambda>t.\n                         f g & \\<lambda>s.\n                                  0 \\<le> s $\n    1 on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0 ;\n           (IF (\\<lambda>s.\n                   s $ 1 =\n                   0) THEN (2 ::= (\\<lambda>s.\n- s $\n  2)) ELSE skip) INV (\\<lambda>s.\n                         0 \\<le> s $ 1 \\<and>\n                         2 \\<cdot> g \\<cdot> s $ 1 =\n                         2 \\<cdot> g \\<cdot> h +\n                         s $ 2 \\<cdot>\n                         s $\n                         2) \\<^bold>{\\<lambda>s.\n  0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<^bold>}", "apply(rule H_loopI; (rule H_seq[where R=\"\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2\"])?)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  0 \\<le> s $ 1 \\<and>\n                                  2 \\<cdot> g \\<cdot> s $ 1 =\n                                  2 \\<cdot> g \\<cdot> h +\n                                  s $ 2 \\<cdot>\n                                  s $\n                                  2\\<^bold>}x\\<acute>= \\<lambda>t.\n                    f g & \\<lambda>s.\n                             0 \\<le> s $\n                                     1 on \\<lambda>s.\n       {t. 0 \\<le> t} UNIV @ 0\\<^bold>{\\<lambda>s.\n    0 \\<le> s $ 1 \\<and>\n    2 \\<cdot> g \\<cdot> s $ 1 =\n    2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<^bold>}\n 2. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  0 \\<le> s $ 1 \\<and>\n                                  2 \\<cdot> g \\<cdot> s $ 1 =\n                                  2 \\<cdot> g \\<cdot> h +\n                                  s $ 2 \\<cdot>\n                                  s $\n                                  2\\<^bold>}IF (\\<lambda>s.\n             s $ 1 =\n             0) THEN (2 ::= (\\<lambda>s.\n                                - s $\n                                  2)) ELSE skip\\<^bold>{\\<lambda>s.\n                     0 \\<le> s $ 1 \\<and>\n                     2 \\<cdot> g \\<cdot> s $ 1 =\n                     2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<^bold>}\n 3. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and>\n 2 \\<cdot> g \\<cdot> s $ 1 =\n 2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 4. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 0 \\<le> s $ 1 \\<and>\n                                 2 \\<cdot> g \\<cdot> s $ 1 =\n                                 2 \\<cdot> g \\<cdot> h +\n                                 s $ 2 \\<cdot> s $ 2\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "apply(subst local_flow.sH_g_ode_subset[OF local_flow_ball])"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<And>s.\n       \\<lbrakk>g < 0; 0 \\<le> h; s2p UNIV s\\<rbrakk>\n       \\<Longrightarrow> s2p (Collect ((\\<le>) 0)) 0 \\<and>\n                         is_interval (Collect ((\\<le>) 0)) \\<and>\n                         Collect ((\\<le>) 0) \\<subseteq> UNIV\n 2. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<forall>s\\<in>UNIV.\n                         0 \\<le> s $ 1 \\<and>\n                         2 \\<cdot> g \\<cdot> s $ 1 =\n                         2 \\<cdot> g \\<cdot> h +\n                         s $ 2 \\<cdot> s $ 2 \\<longrightarrow>\n                         (\\<forall>t\\<in>Collect ((\\<le>) 0).\n                             (\\<forall>\\<tau>\n \\<in>down (Collect ((\\<le>) 0)) t.\n                                 0 \\<le> (\\<chi>i.\n       if i = 1\n       then g \\<cdot> \\<tau>\\<^sup>2 / 2 + s $ 2 \\<cdot> \\<tau> + s $ 1\n       else g \\<cdot> \\<tau> + s $ 2) $\n   1) \\<longrightarrow>\n                             0 \\<le> (\\<chi>i.\n   if i = 1 then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t + s $ 1\n   else g \\<cdot> t + s $ 2) $\n                                     1 \\<and>\n                             2 \\<cdot> g \\<cdot>\n                             (\\<chi>i.\n                                 if i = 1\n                                 then g \\<cdot> t\\<^sup>2 / 2 +\ns $ 2 \\<cdot> t +\ns $ 1\n                                 else g \\<cdot> t + s $ 2) $\n                             1 =\n                             2 \\<cdot> g \\<cdot> h +\n                             (\\<chi>i.\n                                 if i = 1\n                                 then g \\<cdot> t\\<^sup>2 / 2 +\ns $ 2 \\<cdot> t +\ns $ 1\n                                 else g \\<cdot> t + s $ 2) $\n                             2 \\<cdot>\n                             (\\<chi>i.\n                                 if i = 1\n                                 then g \\<cdot> t\\<^sup>2 / 2 +\ns $ 2 \\<cdot> t +\ns $ 1\n                                 else g \\<cdot> t + s $ 2) $\n                             2)\n 3. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<^bold>{\\<lambda>s.\n                                  0 \\<le> s $ 1 \\<and>\n                                  2 \\<cdot> g \\<cdot> s $ 1 =\n                                  2 \\<cdot> g \\<cdot> h +\n                                  s $ 2 \\<cdot>\n                                  s $\n                                  2\\<^bold>}IF (\\<lambda>s.\n             s $ 1 =\n             0) THEN (2 ::= (\\<lambda>s.\n                                - s $\n                                  2)) ELSE skip\\<^bold>{\\<lambda>s.\n                     0 \\<le> s $ 1 \\<and>\n                     2 \\<cdot> g \\<cdot> s $ 1 =\n                     2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<^bold>}\n 4. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and>\n 2 \\<cdot> g \\<cdot> s $ 1 =\n 2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 5. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> \\<lceil>\\<lambda>s.\n                                 0 \\<le> s $ 1 \\<and>\n                                 2 \\<cdot> g \\<cdot> s $ 1 =\n                                 2 \\<cdot> g \\<cdot> h +\n                                 s $ 2 \\<cdot> s $ 2\\<rceil>\n                      \\<le> \\<lceil>\\<lambda>s.\n 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "by (auto simp: bb_real_arith)\n\n\\<comment> \\<open>Refined with annotated dynamics \\<close>"], ["", "lemma R_bb_assign: \"g < (0::real) \\<Longrightarrow> 0 \\<le> h \\<Longrightarrow> \n  2 ::= (\\<lambda>s. - s$2) \\<le> Ref \n    \\<lceil>\\<lambda>s. s$1 = 0 \\<and> 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2\\<rceil> \n    \\<lceil>\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2\\<rceil>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>g < 0; 0 \\<le> h\\<rbrakk>\n    \\<Longrightarrow> (2::'a) ::= (\\<lambda>s. - s $ (2::'a))\n                      \\<le> Ref \\<lceil>\\<lambda>s.\n     s $ (1::'a) = 0 \\<and>\n     0 \\<le> s $ (1::'a) \\<and>\n     2 \\<cdot> g \\<cdot> s $ (1::'a) =\n     2 \\<cdot> g \\<cdot> h + s $ (2::'a) \\<cdot> s $ (2::'a)\\<rceil>\n                             \\<lceil>\\<lambda>s.\n  0 \\<le> s $ (1::'a) \\<and>\n  2 \\<cdot> g \\<cdot> s $ (1::'a) =\n  2 \\<cdot> g \\<cdot> h + s $ (2::'a) \\<cdot> s $ (2::'a)\\<rceil>", "by (rule R_assign_law, auto)"], ["", "lemma R_bouncing_ball_dyn:\n  assumes \"g < 0\" and \"h \\<ge> 0\"\n  shows \"Ref \\<lceil>\\<lambda>s. s$1 = h \\<and> s$2 = 0\\<rceil> \\<lceil>\\<lambda>s. 0 \\<le> s$1 \\<and> s$1 \\<le> h\\<rceil> \\<ge> \n  (LOOP \n      ((EVOL (\\<phi> g) (\\<lambda> s. s$1 \\<ge> 0) T);\n       (IF (\\<lambda> s. s$1 = 0) THEN (2 ::= (\\<lambda>s. - s$2)) ELSE skip)) \n    INV (\\<lambda>s. 0 \\<le> s$1 \\<and> 2 \\<cdot> g \\<cdot> s$1 = 2 \\<cdot> g \\<cdot> h + s$2 \\<cdot> s$2))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP EVOL\n          (\\<lambda>\\<tau> s.\n              \\<chi>i.\n                 if i = 1\n                 then g \\<cdot> \\<tau>\\<^sup>2 / 2 + s $ 2 \\<cdot> \\<tau> +\n                      s $ 1\n                 else g \\<cdot> \\<tau> + s $ 2)\n          (\\<lambda>s. 0 \\<le> s $ 1) T ;\n         (IF (\\<lambda>s.\n                 s $ 1 =\n                 0) THEN (2 ::= (\\<lambda>s.\n                                    - s $\n2)) ELSE skip) INV (\\<lambda>s.\n                       0 \\<le> s $ 1 \\<and>\n                       2 \\<cdot> g \\<cdot> s $ 1 =\n                       2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2) \n    \\<le> Ref \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n           \\<lceil>\\<lambda>s. 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "apply(refinement; (rule R_bb_assign[OF assms])?)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<forall>s.\n       0 \\<le> s $ 1 \\<and>\n       2 \\<cdot> g \\<cdot> s $ 1 =\n       2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 \\<longrightarrow>\n       (\\<forall>t\\<in>T s.\n           (\\<forall>\\<tau>\\<in>down (T s) t.\n               0 \\<le> (\\<chi>i.\n                           if i = 1\n                           then g \\<cdot> \\<tau>\\<^sup>2 / 2 +\n                                s $ 2 \\<cdot> \\<tau> +\n                                s $ 1\n                           else g \\<cdot> \\<tau> + s $ 2) $\n                       1) \\<longrightarrow>\n           0 \\<le> (\\<chi>i.\n                       if i = 1\n                       then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t +\n                            s $ 1\n                       else g \\<cdot> t + s $ 2) $\n                   1 \\<and>\n           2 \\<cdot> g \\<cdot>\n           (\\<chi>i.\n               if i = 1\n               then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t + s $ 1\n               else g \\<cdot> t + s $ 2) $\n           1 =\n           2 \\<cdot> g \\<cdot> h +\n           (\\<chi>i.\n               if i = 1\n               then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t + s $ 1\n               else g \\<cdot> t + s $ 2) $\n           2 \\<cdot>\n           (\\<chi>i.\n               if i = 1\n               then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t + s $ 1\n               else g \\<cdot> t + s $ 2) $\n           2)\n 2. \\<forall>s.\n       s $ 1 \\<noteq> 0 \\<and>\n       0 \\<le> s $ 1 \\<and>\n       2 \\<cdot> g \\<cdot> s $ 1 =\n       2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 \\<longrightarrow>\n       0 \\<le> s $ 1 \\<and>\n       2 \\<cdot> g \\<cdot> s $ 1 =\n       2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\n 3. \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n    \\<le> \\<lceil>\\<lambda>s.\n                     0 \\<le> s $ 1 \\<and>\n                     2 \\<cdot> g \\<cdot> s $ 1 =\n                     2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 4. \\<lceil>\\<lambda>s.\n               0 \\<le> s $ 1 \\<and>\n               2 \\<cdot> g \\<cdot> s $ 1 =\n               2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n    \\<le> \\<lceil>\\<lambda>s. 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "using assms"], ["proof (prove)\nusing this:\n  g < 0\n  0 \\<le> h\n\ngoal (4 subgoals):\n 1. \\<forall>s.\n       0 \\<le> s $ 1 \\<and>\n       2 \\<cdot> g \\<cdot> s $ 1 =\n       2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 \\<longrightarrow>\n       (\\<forall>t\\<in>T s.\n           (\\<forall>\\<tau>\\<in>down (T s) t.\n               0 \\<le> (\\<chi>i.\n                           if i = 1\n                           then g \\<cdot> \\<tau>\\<^sup>2 / 2 +\n                                s $ 2 \\<cdot> \\<tau> +\n                                s $ 1\n                           else g \\<cdot> \\<tau> + s $ 2) $\n                       1) \\<longrightarrow>\n           0 \\<le> (\\<chi>i.\n                       if i = 1\n                       then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t +\n                            s $ 1\n                       else g \\<cdot> t + s $ 2) $\n                   1 \\<and>\n           2 \\<cdot> g \\<cdot>\n           (\\<chi>i.\n               if i = 1\n               then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t + s $ 1\n               else g \\<cdot> t + s $ 2) $\n           1 =\n           2 \\<cdot> g \\<cdot> h +\n           (\\<chi>i.\n               if i = 1\n               then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t + s $ 1\n               else g \\<cdot> t + s $ 2) $\n           2 \\<cdot>\n           (\\<chi>i.\n               if i = 1\n               then g \\<cdot> t\\<^sup>2 / 2 + s $ 2 \\<cdot> t + s $ 1\n               else g \\<cdot> t + s $ 2) $\n           2)\n 2. \\<forall>s.\n       s $ 1 \\<noteq> 0 \\<and>\n       0 \\<le> s $ 1 \\<and>\n       2 \\<cdot> g \\<cdot> s $ 1 =\n       2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2 \\<longrightarrow>\n       0 \\<le> s $ 1 \\<and>\n       2 \\<cdot> g \\<cdot> s $ 1 =\n       2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\n 3. \\<lceil>\\<lambda>s. s $ 1 = h \\<and> s $ 2 = 0\\<rceil>\n    \\<le> \\<lceil>\\<lambda>s.\n                     0 \\<le> s $ 1 \\<and>\n                     2 \\<cdot> g \\<cdot> s $ 1 =\n                     2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n 4. \\<lceil>\\<lambda>s.\n               0 \\<le> s $ 1 \\<and>\n               2 \\<cdot> g \\<cdot> s $ 1 =\n               2 \\<cdot> g \\<cdot> h + s $ 2 \\<cdot> s $ 2\\<rceil>\n    \\<le> \\<lceil>\\<lambda>s. 0 \\<le> s $ 1 \\<and> s $ 1 \\<le> h\\<rceil>", "by (auto simp: bb_real_arith)"], ["", "no_notation fball (\"f\")\n        and ball_flow (\"\\<phi>\")"], ["", "subsubsection \\<open> Thermostat \\<close>"], ["", "text \\<open> A thermostat has a chronometer, a thermometer and a switch to turn on and off a heater.\nAt most every @{text \"t\"} minutes, it sets its chronometer to @{term \"0::real\"}, it registers\nthe room temperature, and it turns the heater on (or off) based on this reading. The temperature\nfollows the ODE @{text \"T' = - a * (T - U)\"} where @{text \"U\"} is @{text \"L \\<ge> 0\"} when the heater\nis on, and @{text \"0\"} when it is off. We use @{term \"1::4\"} to denote the room's temperature,\n@{term \"2::4\"} is time as measured by the thermostat's chronometer, @{term \"3::4\"} is the\ntemperature detected by the thermometer, and @{term \"4::4\"} states whether the heater is on\n(@{text \"s$4 = 1\"}) or off (@{text \"s$4 = 0\"}). We prove that the thermostat keeps the room's\ntemperature between @{text \"Tmin\"} and @{text \"Tmax\"}. \\<close>"], ["", "abbreviation therm_vec_field :: \"real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> real^4\" (\"f\")\n  where \"f a L s \\<equiv> (\\<chi> i. if i = 2 then 1 else (if i = 1 then - a * (s$1 - L) else 0))\""], ["", "abbreviation therm_guard :: \"real \\<Rightarrow> real \\<Rightarrow> real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> bool\" (\"G\")\n  where \"G Tmin Tmax a L s \\<equiv> (s$2 \\<le> - (ln ((L-(if L=0 then Tmin else Tmax))/(L-s$3)))/a)\""], ["", "abbreviation therm_loop_inv :: \"real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> bool\" (\"I\")\n  where \"I Tmin Tmax s \\<equiv> Tmin \\<le> s$1 \\<and> s$1 \\<le> Tmax \\<and> (s$4 = 0 \\<or> s$4 = 1)\""], ["", "abbreviation therm_flow :: \"real \\<Rightarrow> real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> real^4\" (\"\\<phi>\")\n  where \"\\<phi> a L \\<tau> s \\<equiv> (\\<chi> i. if i = 1 then - exp(-a * \\<tau>) * (L - s$1) + L else \n  (if i = 2 then \\<tau> + s$2 else s$i))\"\n\n\\<comment> \\<open>Verified with the flow \\<close>"], ["", "lemma norm_diff_therm_dyn: \"0 < a \\<Longrightarrow> \\<parallel>f a L s\\<^sub>1 - f a L s\\<^sub>2\\<parallel> = \\<bar>a\\<bar> * \\<bar>s\\<^sub>1$1 - s\\<^sub>2$1\\<bar>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < a \\<Longrightarrow>\n    \\<parallel>f a L s\\<^sub>1 - f a L s\\<^sub>2\\<parallel> =\n    \\<bar>a\\<bar> \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "proof(simp add: norm_vec_def L2_set_def, unfold UNIV_4, simp)"], ["proof (state)\ngoal (1 subgoal):\n 1. 0 < a \\<Longrightarrow>\n    \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n          a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "assume a1: \"0 < a\""], ["proof (state)\nthis:\n  0 < a\n\ngoal (1 subgoal):\n 1. 0 < a \\<Longrightarrow>\n    \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n          a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "have f2: \"\\<And>r ra. \\<bar>(r::real) + - ra\\<bar> = \\<bar>ra + - r\\<bar>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r ra. \\<bar>r + - ra\\<bar> = \\<bar>ra + - r\\<bar>", "by (metis abs_minus_commute minus_real_def)"], ["proof (state)\nthis:\n  \\<bar>?r + - ?ra\\<bar> = \\<bar>?ra + - ?r\\<bar>\n\ngoal (1 subgoal):\n 1. 0 < a \\<Longrightarrow>\n    \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n          a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "have \"\\<And>r ra rb. (r::real) * ra + - (r * rb) = r * (ra + - rb)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>r ra rb. r \\<cdot> ra + - (r \\<cdot> rb) = r \\<cdot> (ra + - rb)", "by (metis minus_real_def right_diff_distrib)"], ["proof (state)\nthis:\n  ?r \\<cdot> ?ra + - (?r \\<cdot> ?rb) = ?r \\<cdot> (?ra + - ?rb)\n\ngoal (1 subgoal):\n 1. 0 < a \\<Longrightarrow>\n    \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n          a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "hence \"\\<bar>a * (s\\<^sub>1$1 + - L) + - (a * (s\\<^sub>2$1 + - L))\\<bar> = a * \\<bar>s\\<^sub>1$1 + - s\\<^sub>2$1\\<bar>\""], ["proof (prove)\nusing this:\n  ?r \\<cdot> ?ra + - (?r \\<cdot> ?rb) = ?r \\<cdot> (?ra + - ?rb)\n\ngoal (1 subgoal):\n 1. \\<bar>a \\<cdot> (s\\<^sub>1 $ 1 + - L) +\n          - (a \\<cdot> (s\\<^sub>2 $ 1 + - L))\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 + - s\\<^sub>2 $ 1\\<bar>", "using a1"], ["proof (prove)\nusing this:\n  ?r \\<cdot> ?ra + - (?r \\<cdot> ?rb) = ?r \\<cdot> (?ra + - ?rb)\n  0 < a\n\ngoal (1 subgoal):\n 1. \\<bar>a \\<cdot> (s\\<^sub>1 $ 1 + - L) +\n          - (a \\<cdot> (s\\<^sub>2 $ 1 + - L))\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 + - s\\<^sub>2 $ 1\\<bar>", "by (simp add: abs_mult)"], ["proof (state)\nthis:\n  \\<bar>a \\<cdot> (s\\<^sub>1 $ 1 + - L) +\n        - (a \\<cdot> (s\\<^sub>2 $ 1 + - L))\\<bar> =\n  a \\<cdot> \\<bar>s\\<^sub>1 $ 1 + - s\\<^sub>2 $ 1\\<bar>\n\ngoal (1 subgoal):\n 1. 0 < a \\<Longrightarrow>\n    \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n          a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "thus \"\\<bar>a * (s\\<^sub>2$1 - L) - a * (s\\<^sub>1$1 - L)\\<bar> = a * \\<bar>s\\<^sub>1$1 - s\\<^sub>2$1\\<bar>\""], ["proof (prove)\nusing this:\n  \\<bar>a \\<cdot> (s\\<^sub>1 $ 1 + - L) +\n        - (a \\<cdot> (s\\<^sub>2 $ 1 + - L))\\<bar> =\n  a \\<cdot> \\<bar>s\\<^sub>1 $ 1 + - s\\<^sub>2 $ 1\\<bar>\n\ngoal (1 subgoal):\n 1. \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n          a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "using f2 minus_real_def"], ["proof (prove)\nusing this:\n  \\<bar>a \\<cdot> (s\\<^sub>1 $ 1 + - L) +\n        - (a \\<cdot> (s\\<^sub>2 $ 1 + - L))\\<bar> =\n  a \\<cdot> \\<bar>s\\<^sub>1 $ 1 + - s\\<^sub>2 $ 1\\<bar>\n  \\<bar>?r + - ?ra\\<bar> = \\<bar>?ra + - ?r\\<bar>\n  ?x - ?y = ?x + - ?y\n\ngoal (1 subgoal):\n 1. \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n          a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n    a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>", "by presburger"], ["proof (state)\nthis:\n  \\<bar>a \\<cdot> (s\\<^sub>2 $ 1 - L) -\n        a \\<cdot> (s\\<^sub>1 $ 1 - L)\\<bar> =\n  a \\<cdot> \\<bar>s\\<^sub>1 $ 1 - s\\<^sub>2 $ 1\\<bar>\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma local_lipschitz_therm_dyn:\n  assumes \"0 < (a::real)\"\n  shows \"local_lipschitz UNIV UNIV (\\<lambda>t::real. f a L)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. local_lipschitz UNIV UNIV (\\<lambda>t. f a L)", "apply(unfold local_lipschitz_def lipschitz_on_def dist_norm)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>x\\<in>UNIV.\n       \\<forall>t\\<in>UNIV.\n          \\<exists>u>0.\n             \\<exists>La.\n                \\<forall>t\\<in>cball t u \\<inter> UNIV.\n                   0 \\<le> La \\<and>\n                   (\\<forall>xa\\<in>cball x u \\<inter> UNIV.\n                       \\<forall>y\\<in>cball x u \\<inter> UNIV.\n                          \\<parallel>f a L xa - f a L y\\<parallel>\n                          \\<le> La \\<cdot> (\\<parallel>xa - y\\<parallel>))", "apply(clarsimp, rule_tac x=1 in exI, clarsimp, rule_tac x=a in exI)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x t ta.\n       dist t ta \\<le> 1 \\<Longrightarrow>\n       0 \\<le> a \\<and>\n       (\\<forall>xa\\<in>cball x 1.\n           \\<forall>y\\<in>cball x 1.\n              \\<parallel>f a L xa - f a L y\\<parallel>\n              \\<le> a \\<cdot> (\\<parallel>xa - y\\<parallel>))", "using assms"], ["proof (prove)\nusing this:\n  0 < a\n\ngoal (1 subgoal):\n 1. \\<And>x t ta.\n       dist t ta \\<le> 1 \\<Longrightarrow>\n       0 \\<le> a \\<and>\n       (\\<forall>xa\\<in>cball x 1.\n           \\<forall>y\\<in>cball x 1.\n              \\<parallel>f a L xa - f a L y\\<parallel>\n              \\<le> a \\<cdot> (\\<parallel>xa - y\\<parallel>))", "apply(simp_all add: norm_diff_therm_dyn)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x t ta.\n       \\<lbrakk>dist t ta \\<le> 1; 0 < a\\<rbrakk>\n       \\<Longrightarrow> \\<forall>xa\\<in>cball x 1.\n                            \\<forall>y\\<in>cball x 1.\n                               \\<bar>xa $ 1 - y $ 1\\<bar>\n                               \\<le> \\<parallel>xa - y\\<parallel>", "apply(simp add: norm_vec_def L2_set_def, unfold UNIV_4, clarsimp)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x t ta xa y.\n       \\<lbrakk>dist t ta \\<le> 1; 0 < a; dist x xa \\<le> 1;\n        dist x y \\<le> 1\\<rbrakk>\n       \\<Longrightarrow> \\<bar>xa $ 1 - y $ 1\\<bar>\n                         \\<le> sqrt\n                                ((xa $ 1 - y $ 1)\\<^sup>2 +\n                                 ((xa $ 2 - y $ 2)\\<^sup>2 +\n                                  ((xa $ 3 - y $ 3)\\<^sup>2 +\n                                   (xa $ 4 - y $ 4)\\<^sup>2)))", "unfolding real_sqrt_abs[symmetric]"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x t ta xa y.\n       \\<lbrakk>dist t ta \\<le> 1; 0 < a; dist x xa \\<le> 1;\n        dist x y \\<le> 1\\<rbrakk>\n       \\<Longrightarrow> sqrt ((xa $ 1 - y $ 1)\\<^sup>2)\n                         \\<le> sqrt\n                                ((xa $ 1 - y $ 1)\\<^sup>2 +\n                                 ((xa $ 2 - y $ 2)\\<^sup>2 +\n                                  ((xa $ 3 - y $ 3)\\<^sup>2 +\n                                   (xa $ 4 - y $ 4)\\<^sup>2)))", "by (rule real_le_lsqrt) auto"], ["", "lemma local_flow_therm: \"a > 0 \\<Longrightarrow> local_flow (f a L) UNIV UNIV (\\<phi> a L)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < a \\<Longrightarrow> local_flow (f a L) UNIV UNIV (\\<phi> a L)", "by (unfold_locales, auto intro!: poly_derivatives local_lipschitz_therm_dyn \n      simp: forall_4 vec_eq_iff)"], ["", "lemma therm_dyn_down_real_arith:\n  assumes \"a > 0\" and Thyps: \"0 < Tmin\" \"Tmin \\<le> T\" \"T \\<le> Tmax\"\n    and thyps: \"0 \\<le> (\\<tau>::real)\" \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> - (ln (Tmin / T) / a) \"\n  shows \"Tmin \\<le> exp (-a * \\<tau>) * T\" and \"exp (-a * \\<tau>) * T \\<le> Tmax\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T &&&\n    exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "proof-"], ["proof (state)\ngoal (2 subgoals):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T\n 2. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "have \"0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln (Tmin / T) / a)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln (Tmin / T) / a)", "using thyps"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau>\n  \\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> - (ln (Tmin / T) / a)\n\ngoal (1 subgoal):\n 1. 0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln (Tmin / T) / a)", "by auto"], ["proof (state)\nthis:\n  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln (Tmin / T) / a)\n\ngoal (2 subgoals):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T\n 2. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "hence \"ln (Tmin / T) \\<le> - a * \\<tau> \\<and> - a * \\<tau> \\<le> 0\""], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln (Tmin / T) / a)\n\ngoal (1 subgoal):\n 1. ln (Tmin / T) \\<le> - a \\<cdot> \\<tau> \\<and> - a \\<cdot> \\<tau> \\<le> 0", "using assms(1) divide_le_cancel"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln (Tmin / T) / a)\n  0 < a\n  (?a / ?c \\<le> ?b / ?c) =\n  (((0::?'a) < ?c \\<longrightarrow> ?a \\<le> ?b) \\<and>\n   (?c < (0::?'a) \\<longrightarrow> ?b \\<le> ?a))\n\ngoal (1 subgoal):\n 1. ln (Tmin / T) \\<le> - a \\<cdot> \\<tau> \\<and> - a \\<cdot> \\<tau> \\<le> 0", "by fastforce"], ["proof (state)\nthis:\n  ln (Tmin / T) \\<le> - a \\<cdot> \\<tau> \\<and> - a \\<cdot> \\<tau> \\<le> 0\n\ngoal (2 subgoals):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T\n 2. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "also"], ["proof (state)\nthis:\n  ln (Tmin / T) \\<le> - a \\<cdot> \\<tau> \\<and> - a \\<cdot> \\<tau> \\<le> 0\n\ngoal (2 subgoals):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T\n 2. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "have \"Tmin / T > 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < Tmin / T", "using Thyps"], ["proof (prove)\nusing this:\n  0 < Tmin\n  Tmin \\<le> T\n  T \\<le> Tmax\n\ngoal (1 subgoal):\n 1. 0 < Tmin / T", "by auto"], ["proof (state)\nthis:\n  0 < Tmin / T\n\ngoal (2 subgoals):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T\n 2. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "ultimately"], ["proof (chain)\npicking this:\n  ln (Tmin / T) \\<le> - a \\<cdot> \\<tau> \\<and> - a \\<cdot> \\<tau> \\<le> 0\n  0 < Tmin / T", "have obs: \"Tmin / T \\<le> exp (-a * \\<tau>)\" \"exp (-a * \\<tau>) \\<le> 1\""], ["proof (prove)\nusing this:\n  ln (Tmin / T) \\<le> - a \\<cdot> \\<tau> \\<and> - a \\<cdot> \\<tau> \\<le> 0\n  0 < Tmin / T\n\ngoal (1 subgoal):\n 1. Tmin / T \\<le> exp (- a \\<cdot> \\<tau>) &&&\n    exp (- a \\<cdot> \\<tau>) \\<le> 1", "using exp_ln exp_le_one_iff"], ["proof (prove)\nusing this:\n  ln (Tmin / T) \\<le> - a \\<cdot> \\<tau> \\<and> - a \\<cdot> \\<tau> \\<le> 0\n  0 < Tmin / T\n  0 < ?x \\<Longrightarrow> exp (ln ?x) = ?x\n  (exp ?x \\<le> 1) = (?x \\<le> 0)\n\ngoal (1 subgoal):\n 1. Tmin / T \\<le> exp (- a \\<cdot> \\<tau>) &&&\n    exp (- a \\<cdot> \\<tau>) \\<le> 1", "by (metis exp_less_cancel_iff not_less, simp)"], ["proof (state)\nthis:\n  Tmin / T \\<le> exp (- a \\<cdot> \\<tau>)\n  exp (- a \\<cdot> \\<tau>) \\<le> 1\n\ngoal (2 subgoals):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T\n 2. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "thus \"Tmin \\<le> exp (-a * \\<tau>) * T\""], ["proof (prove)\nusing this:\n  Tmin / T \\<le> exp (- a \\<cdot> \\<tau>)\n  exp (- a \\<cdot> \\<tau>) \\<le> 1\n\ngoal (1 subgoal):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T", "using Thyps"], ["proof (prove)\nusing this:\n  Tmin / T \\<le> exp (- a \\<cdot> \\<tau>)\n  exp (- a \\<cdot> \\<tau>) \\<le> 1\n  0 < Tmin\n  Tmin \\<le> T\n  T \\<le> Tmax\n\ngoal (1 subgoal):\n 1. Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T", "by (simp add: pos_divide_le_eq)"], ["proof (state)\nthis:\n  Tmin \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> T\n\ngoal (1 subgoal):\n 1. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "show \"exp (-a * \\<tau>) * T \\<le> Tmax\""], ["proof (prove)\ngoal (1 subgoal):\n 1. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "using Thyps mult_left_le_one_le[OF _ exp_ge_zero obs(2), of T] \n      less_eq_real_def order_trans_rules(23)"], ["proof (prove)\nusing this:\n  0 < Tmin\n  Tmin \\<le> T\n  T \\<le> Tmax\n  0 \\<le> T \\<Longrightarrow> exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> T\n  (?x \\<le> ?y) = (?x < ?y \\<or> ?x = ?y)\n  \\<lbrakk>?x \\<le> ?y; ?y \\<le> ?z\\<rbrakk> \\<Longrightarrow> ?x \\<le> ?z\n\ngoal (1 subgoal):\n 1. exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax", "by blast"], ["proof (state)\nthis:\n  exp (- a \\<cdot> \\<tau>) \\<cdot> T \\<le> Tmax\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma therm_dyn_up_real_arith:\n  assumes \"a > 0\" and Thyps: \"Tmin \\<le> T\" \"T \\<le> Tmax\" \"Tmax < (L::real)\"\n    and thyps: \"0 \\<le> \\<tau>\" \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a) \"\n  shows \"L - Tmax \\<le> exp (-(a * \\<tau>)) * (L - T)\" \n    and \"L - exp (-(a * \\<tau>)) * (L - T) \\<le> Tmax\" \n    and \"Tmin \\<le> L - exp (-(a * \\<tau>)) * (L - T)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) &&&\n    L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax &&&\n    Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "proof-"], ["proof (state)\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "have \"0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a)", "using thyps"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau>\n  \\<forall>\\<tau>\\<in>{0..\\<tau>}.\n     \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a)\n\ngoal (1 subgoal):\n 1. 0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a)", "by auto"], ["proof (state)\nthis:\n  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a)\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "hence \"ln ((L - Tmax) / (L - T)) \\<le> - a * \\<tau> \\<and> - a * \\<tau> \\<le> 0\""], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a)\n\ngoal (1 subgoal):\n 1. ln ((L - Tmax) / (L - T)) \\<le> - a \\<cdot> \\<tau> \\<and>\n    - a \\<cdot> \\<tau> \\<le> 0", "using assms(1) divide_le_cancel"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> - (ln ((L - Tmax) / (L - T)) / a)\n  0 < a\n  (?a / ?c \\<le> ?b / ?c) =\n  (((0::?'a) < ?c \\<longrightarrow> ?a \\<le> ?b) \\<and>\n   (?c < (0::?'a) \\<longrightarrow> ?b \\<le> ?a))\n\ngoal (1 subgoal):\n 1. ln ((L - Tmax) / (L - T)) \\<le> - a \\<cdot> \\<tau> \\<and>\n    - a \\<cdot> \\<tau> \\<le> 0", "by fastforce"], ["proof (state)\nthis:\n  ln ((L - Tmax) / (L - T)) \\<le> - a \\<cdot> \\<tau> \\<and>\n  - a \\<cdot> \\<tau> \\<le> 0\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "also"], ["proof (state)\nthis:\n  ln ((L - Tmax) / (L - T)) \\<le> - a \\<cdot> \\<tau> \\<and>\n  - a \\<cdot> \\<tau> \\<le> 0\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "have \"(L - Tmax) / (L - T) > 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < (L - Tmax) / (L - T)", "using Thyps"], ["proof (prove)\nusing this:\n  Tmin \\<le> T\n  T \\<le> Tmax\n  Tmax < L\n\ngoal (1 subgoal):\n 1. 0 < (L - Tmax) / (L - T)", "by auto"], ["proof (state)\nthis:\n  0 < (L - Tmax) / (L - T)\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "ultimately"], ["proof (chain)\npicking this:\n  ln ((L - Tmax) / (L - T)) \\<le> - a \\<cdot> \\<tau> \\<and>\n  - a \\<cdot> \\<tau> \\<le> 0\n  0 < (L - Tmax) / (L - T)", "have \"(L - Tmax) / (L - T) \\<le> exp (-a * \\<tau>) \\<and> exp (-a * \\<tau>) \\<le> 1\""], ["proof (prove)\nusing this:\n  ln ((L - Tmax) / (L - T)) \\<le> - a \\<cdot> \\<tau> \\<and>\n  - a \\<cdot> \\<tau> \\<le> 0\n  0 < (L - Tmax) / (L - T)\n\ngoal (1 subgoal):\n 1. (L - Tmax) / (L - T) \\<le> exp (- a \\<cdot> \\<tau>) \\<and>\n    exp (- a \\<cdot> \\<tau>) \\<le> 1", "using exp_ln exp_le_one_iff"], ["proof (prove)\nusing this:\n  ln ((L - Tmax) / (L - T)) \\<le> - a \\<cdot> \\<tau> \\<and>\n  - a \\<cdot> \\<tau> \\<le> 0\n  0 < (L - Tmax) / (L - T)\n  0 < ?x \\<Longrightarrow> exp (ln ?x) = ?x\n  (exp ?x \\<le> 1) = (?x \\<le> 0)\n\ngoal (1 subgoal):\n 1. (L - Tmax) / (L - T) \\<le> exp (- a \\<cdot> \\<tau>) \\<and>\n    exp (- a \\<cdot> \\<tau>) \\<le> 1", "by (metis exp_less_cancel_iff not_less)"], ["proof (state)\nthis:\n  (L - Tmax) / (L - T) \\<le> exp (- a \\<cdot> \\<tau>) \\<and>\n  exp (- a \\<cdot> \\<tau>) \\<le> 1\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "moreover"], ["proof (state)\nthis:\n  (L - Tmax) / (L - T) \\<le> exp (- a \\<cdot> \\<tau>) \\<and>\n  exp (- a \\<cdot> \\<tau>) \\<le> 1\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "have \"L - T > 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 < L - T", "using Thyps"], ["proof (prove)\nusing this:\n  Tmin \\<le> T\n  T \\<le> Tmax\n  Tmax < L\n\ngoal (1 subgoal):\n 1. 0 < L - T", "by auto"], ["proof (state)\nthis:\n  0 < L - T\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "ultimately"], ["proof (chain)\npicking this:\n  (L - Tmax) / (L - T) \\<le> exp (- a \\<cdot> \\<tau>) \\<and>\n  exp (- a \\<cdot> \\<tau>) \\<le> 1\n  0 < L - T", "have obs: \"(L - Tmax) \\<le> exp (-a * \\<tau>) * (L - T) \\<and> exp (-a * \\<tau>) * (L - T) \\<le> (L - T)\""], ["proof (prove)\nusing this:\n  (L - Tmax) / (L - T) \\<le> exp (- a \\<cdot> \\<tau>) \\<and>\n  exp (- a \\<cdot> \\<tau>) \\<le> 1\n  0 < L - T\n\ngoal (1 subgoal):\n 1. L - Tmax \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<and>\n    exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<le> L - T", "by (simp add: pos_divide_le_eq)"], ["proof (state)\nthis:\n  L - Tmax \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<and>\n  exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<le> L - T\n\ngoal (3 subgoals):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n 2. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 3. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "thus \"(L - Tmax) \\<le> exp (-(a * \\<tau>)) * (L - T)\""], ["proof (prove)\nusing this:\n  L - Tmax \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<and>\n  exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<le> L - T\n\ngoal (1 subgoal):\n 1. L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "by auto"], ["proof (state)\nthis:\n  L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n\ngoal (2 subgoals):\n 1. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n 2. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "thus \"L - exp (-(a * \\<tau>)) * (L - T) \\<le> Tmax\""], ["proof (prove)\nusing this:\n  L - Tmax \\<le> exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n\ngoal (1 subgoal):\n 1. L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax", "by auto"], ["proof (state)\nthis:\n  L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T) \\<le> Tmax\n\ngoal (1 subgoal):\n 1. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "show \"Tmin \\<le> L - exp (-(a * \\<tau>)) * (L - T)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "using Thyps and obs"], ["proof (prove)\nusing this:\n  Tmin \\<le> T\n  T \\<le> Tmax\n  Tmax < L\n  L - Tmax \\<le> exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<and>\n  exp (- a \\<cdot> \\<tau>) \\<cdot> (L - T) \\<le> L - T\n\ngoal (1 subgoal):\n 1. Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)", "by auto"], ["proof (state)\nthis:\n  Tmin \\<le> L - exp (- (a \\<cdot> \\<tau>)) \\<cdot> (L - T)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemmas H_g_ode_therm = local_flow.sH_g_ode_ivl[OF local_flow_therm _ UNIV_I]"], ["", "lemma thermostat_flow: \n  assumes \"0 < a\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"\\<^bold>{I Tmin Tmax\\<^bold>}\n  (LOOP (\n    \\<comment> \\<open>control\\<close>\n    (2 ::= (\\<lambda>s. 0));\n    (3 ::= (\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> Tmin + 1) THEN \n      (4 ::= (\\<lambda>s.1)) \n     ELSE IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> Tmax - 1) THEN \n      (4 ::= (\\<lambda>s.0)) \n     ELSE skip);\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n    ELSE \n      (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0))\n  ) INV I Tmin Tmax)\n   \\<^bold>{I Tmin Tmax\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>{I Tmin\n              Tmax\\<^bold>}LOOP (2 ::= (\\<lambda>s. 0)) ;\n                                (3 ::= (\\<lambda>s. s $ 1)) ;\n                                (IF (\\<lambda>s.\n  s $ 4 = 0 \\<and>\n  s $ 3\n  \\<le> Tmin +\n        1) THEN (4 ::= (\\<lambda>s.\n                           1)) ELSE IF (\\<lambda>s.\n     s $ 4 = 1 \\<and>\n     Tmax - 1 \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n                                (IF (\\<lambda>s.\n  s $ 4 =\n  0) THEN x\\<acute>= \\<lambda>t.\n                        f a 0 & G Tmin Tmax a\n                                 0 on \\<lambda>s.\n   {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n     f a L & G Tmin Tmax a\n              L on \\<lambda>s.\n                      {0..\\<tau>} UNIV @ 0) INV I Tmin\n           Tmax \\<^bold>{I Tmin Tmax\\<^bold>}", "apply(rule H_loopI)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<^bold>{I Tmin\n              Tmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s. s $ 1)) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 = 0 \\<and>\n                                   s $ 3\n                                   \\<le> Tmin +\n   1) THEN (4 ::= (\\<lambda>s.\n                      1)) ELSE IF (\\<lambda>s.\ns $ 4 = 1 \\<and>\nTmax - 1 \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 =\n                                   0) THEN x\\<acute>= \\<lambda>t.\n                   f a 0 & G Tmin Tmax a\n                            0 on \\<lambda>s.\n                                    {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\nf a L & G Tmin Tmax a\n         L on \\<lambda>s. {0..\\<tau>} UNIV @ 0)\\<^bold>{I Tmin Tmax\\<^bold>}\n 2. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>\n 3. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I Tmin Tmax s \\<and> s$2=0 \\<and> s$3 = s$1\" in H_seq)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<^bold>{I Tmin\n              Tmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s. s $ 1)) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 = 0 \\<and>\n                                   s $ 3\n                                   \\<le> Tmin +\n   1) THEN (4 ::= (\\<lambda>s.\n                      1)) ELSE IF (\\<lambda>s.\ns $ 4 = 1 \\<and>\nTmax - 1\n\\<le> s $\n      3) THEN (4 ::= (\\<lambda>s.\n                         0)) ELSE skip)\\<^bold>{\\<lambda>s.\n             I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I Tmin Tmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>= \\<lambda>t.\n                 f a 0 & G Tmin Tmax a\n                          0 on \\<lambda>s.\n                                  {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                                    f a L & G Tmin Tmax a\n       L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\\<^bold>{I Tmin Tmax\\<^bold>}\n 3. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>\n 4. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I Tmin Tmax s\\<and> s$2=0 \\<and> s$3 = s$1\" in H_seq)"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<^bold>{I Tmin\n              Tmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s.\ns $\n1))\\<^bold>{\\<lambda>s.\n               I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I Tmin Tmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 = 0 \\<and>\n                                 s $ 3\n                                 \\<le> Tmin +\n 1) THEN (4 ::= (\\<lambda>s.\n                    1)) ELSE IF (\\<lambda>s.\n                                    s $ 4 = 1 \\<and>\n                                    Tmax - 1\n                                    \\<le> s $\n    3) THEN (4 ::= (\\<lambda>s.\n                       0)) ELSE skip\\<^bold>{\\<lambda>s.\n          I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 3. \\<^bold>{\\<lambda>s.\n                I Tmin Tmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>= \\<lambda>t.\n                 f a 0 & G Tmin Tmax a\n                          0 on \\<lambda>s.\n                                  {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                                    f a L & G Tmin Tmax a\n       L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\\<^bold>{I Tmin Tmax\\<^bold>}\n 4. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>\n 5. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0\" in H_seq, simp, simp)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<^bold>{\\<lambda>s.\n                I Tmin Tmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 = 0 \\<and>\n                                 s $ 3\n                                 \\<le> Tmin +\n 1) THEN (4 ::= (\\<lambda>s.\n                    1)) ELSE IF (\\<lambda>s.\n                                    s $ 4 = 1 \\<and>\n                                    Tmax - 1\n                                    \\<le> s $\n    3) THEN (4 ::= (\\<lambda>s.\n                       0)) ELSE skip\\<^bold>{\\<lambda>s.\n          I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I Tmin Tmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>= \\<lambda>t.\n                 f a 0 & G Tmin Tmax a\n                          0 on \\<lambda>s.\n                                  {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                                    f a L & G Tmin Tmax a\n       L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\\<^bold>{I Tmin Tmax\\<^bold>}\n 3. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>\n 4. \\<lceil>I Tmin Tmax\\<rceil> \\<le> \\<lceil>I Tmin Tmax\\<rceil>", "apply(rule H_cond, simp_all add: H_g_ode_therm[OF assms(1,2)])+"], ["proof (prove)\ngoal (1 subgoal):\n 1. (L = 0 \\<longrightarrow>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<and> s $ 4 = 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau> \\<le> - (ln (Tmin / s $ 1) / a)) \\<longrightarrow>\n             Tmin \\<le> exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<and>\n             exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<le> Tmax)) \\<and>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and>\n         s $ 3 = s $ 1 \\<and> s $ 4 \\<noteq> 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau> \\<le> - (ln (Tmin / s $ 1) / a)) \\<longrightarrow>\n             Tmin \\<le> exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<and>\n             exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<le> Tmax \\<and>\n             s $ 4 = 1))) \\<and>\n    (L \\<noteq> 0 \\<longrightarrow>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<and> s $ 4 = 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau> \\<le> - (ln (Tmin / s $ 1) / a)) \\<longrightarrow>\n             Tmin \\<le> exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<and>\n             exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<le> Tmax)) \\<and>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and>\n         s $ 3 = s $ 1 \\<and> s $ 4 \\<noteq> 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau>\n                 \\<le> - (ln ((L - Tmax) / (L - s $ 1)) /\n                          a)) \\<longrightarrow>\n             Tmin \\<le> L - exp (- (a \\<cdot> t)) \\<cdot> (L - s $ 1) \\<and>\n             L - exp (- (a \\<cdot> t)) \\<cdot> (L - s $ 1) \\<le> Tmax \\<and>\n             s $ 4 = 1)))", "using therm_dyn_up_real_arith[OF assms(1) _ _ assms(4), of Tmin]\n    and therm_dyn_down_real_arith[OF assms(1,3), of _ Tmax]"], ["proof (prove)\nusing this:\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln ((L - Tmax) / (L - ?T)) / a)\\<rbrakk>\n  \\<Longrightarrow> L - Tmax\n                    \\<le> exp (- (a \\<cdot> ?\\<tau>)) \\<cdot> (L - ?T)\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln ((L - Tmax) / (L - ?T)) / a)\\<rbrakk>\n  \\<Longrightarrow> L - exp (- (a \\<cdot> ?\\<tau>)) \\<cdot> (L - ?T)\n                    \\<le> Tmax\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln ((L - Tmax) / (L - ?T)) / a)\\<rbrakk>\n  \\<Longrightarrow> Tmin\n                    \\<le> L - exp (- (a \\<cdot> ?\\<tau>)) \\<cdot> (L - ?T)\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln (Tmin / ?T) / a)\\<rbrakk>\n  \\<Longrightarrow> Tmin \\<le> exp (- a \\<cdot> ?\\<tau>) \\<cdot> ?T\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln (Tmin / ?T) / a)\\<rbrakk>\n  \\<Longrightarrow> exp (- a \\<cdot> ?\\<tau>) \\<cdot> ?T \\<le> Tmax\n\ngoal (1 subgoal):\n 1. (L = 0 \\<longrightarrow>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<and> s $ 4 = 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau> \\<le> - (ln (Tmin / s $ 1) / a)) \\<longrightarrow>\n             Tmin \\<le> exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<and>\n             exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<le> Tmax)) \\<and>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and>\n         s $ 3 = s $ 1 \\<and> s $ 4 \\<noteq> 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau> \\<le> - (ln (Tmin / s $ 1) / a)) \\<longrightarrow>\n             Tmin \\<le> exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<and>\n             exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<le> Tmax \\<and>\n             s $ 4 = 1))) \\<and>\n    (L \\<noteq> 0 \\<longrightarrow>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<and> s $ 4 = 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau> \\<le> - (ln (Tmin / s $ 1) / a)) \\<longrightarrow>\n             Tmin \\<le> exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<and>\n             exp (- (a \\<cdot> t)) \\<cdot> s $ 1 \\<le> Tmax)) \\<and>\n     (\\<forall>s.\n         Tmin \\<le> s $ 1 \\<and>\n         s $ 1 \\<le> Tmax \\<and>\n         (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n         s $ 2 = 0 \\<and>\n         s $ 3 = s $ 1 \\<and> s $ 4 \\<noteq> 0 \\<longrightarrow>\n         (\\<forall>t\\<in>{0..\\<tau>}.\n             (\\<forall>\\<tau>\\<in>{0..t}.\n                 \\<tau>\n                 \\<le> - (ln ((L - Tmax) / (L - s $ 1)) /\n                          a)) \\<longrightarrow>\n             Tmin \\<le> L - exp (- (a \\<cdot> t)) \\<cdot> (L - s $ 1) \\<and>\n             L - exp (- (a \\<cdot> t)) \\<cdot> (L - s $ 1) \\<le> Tmax \\<and>\n             s $ 4 = 1)))", "by auto\n\n\\<comment> \\<open>Refined with the flow \\<close>"], ["", "lemma R_therm_dyn_down: \n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>\\<lambda>s. s$4 = 0 \\<and> I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n    (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x\\<acute>= \\<lambda>t.\n                  f a 0 & G Tmin Tmax a\n                           0 on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n    \\<le> Ref \\<lceil>\\<lambda>s.\n                         s $ 4 = 0 \\<and>\n                         I Tmin Tmax s \\<and>\n                         s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n           \\<lceil>I Tmin Tmax\\<rceil>", "apply(rule local_flow.R_g_ode_ivl[OF local_flow_therm])"], ["proof (prove)\ngoal (4 subgoals):\n 1. 0 < a\n 2. 0 \\<le> \\<tau>\n 3. s2p UNIV \\<tau>\n 4. \\<forall>s\\<in>UNIV.\n       s $ 4 = 0 \\<and>\n       I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<longrightarrow>\n       (\\<forall>t\\<in>{0..\\<tau>}.\n           (\\<forall>\\<tau>\\<in>{0..t}.\n               G Tmin Tmax a 0 (\\<phi> a 0 \\<tau> s)) \\<longrightarrow>\n           I Tmin Tmax (\\<phi> a 0 t s))", "using assms therm_dyn_down_real_arith[OF assms(1,3), of _ Tmax]"], ["proof (prove)\nusing this:\n  0 < a\n  0 \\<le> \\<tau>\n  0 < Tmin\n  Tmax < L\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln (Tmin / ?T) / a)\\<rbrakk>\n  \\<Longrightarrow> Tmin \\<le> exp (- a \\<cdot> ?\\<tau>) \\<cdot> ?T\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln (Tmin / ?T) / a)\\<rbrakk>\n  \\<Longrightarrow> exp (- a \\<cdot> ?\\<tau>) \\<cdot> ?T \\<le> Tmax\n\ngoal (4 subgoals):\n 1. 0 < a\n 2. 0 \\<le> \\<tau>\n 3. s2p UNIV \\<tau>\n 4. \\<forall>s\\<in>UNIV.\n       s $ 4 = 0 \\<and>\n       I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<longrightarrow>\n       (\\<forall>t\\<in>{0..\\<tau>}.\n           (\\<forall>\\<tau>\\<in>{0..t}.\n               G Tmin Tmax a 0 (\\<phi> a 0 \\<tau> s)) \\<longrightarrow>\n           I Tmin Tmax (\\<phi> a 0 t s))", "by auto"], ["", "lemma R_therm_dyn_up: \n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>\\<lambda>s. s$4 \\<noteq> 0 \\<and> I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n    (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x\\<acute>= \\<lambda>t.\n                  f a L & G Tmin Tmax a\n                           L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n    \\<le> Ref \\<lceil>\\<lambda>s.\n                         s $ 4 \\<noteq> 0 \\<and>\n                         I Tmin Tmax s \\<and>\n                         s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n           \\<lceil>I Tmin Tmax\\<rceil>", "apply(rule local_flow.R_g_ode_ivl[OF local_flow_therm])"], ["proof (prove)\ngoal (4 subgoals):\n 1. 0 < a\n 2. 0 \\<le> \\<tau>\n 3. s2p UNIV \\<tau>\n 4. \\<forall>s\\<in>UNIV.\n       s $ 4 \\<noteq> 0 \\<and>\n       I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<longrightarrow>\n       (\\<forall>t\\<in>{0..\\<tau>}.\n           (\\<forall>\\<tau>\\<in>{0..t}.\n               G Tmin Tmax a L (\\<phi> a L \\<tau> s)) \\<longrightarrow>\n           I Tmin Tmax (\\<phi> a L t s))", "using assms therm_dyn_up_real_arith[OF assms(1) _ _ assms(4), of Tmin]"], ["proof (prove)\nusing this:\n  0 < a\n  0 \\<le> \\<tau>\n  0 < Tmin\n  Tmax < L\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln ((L - Tmax) / (L - ?T)) / a)\\<rbrakk>\n  \\<Longrightarrow> L - Tmax\n                    \\<le> exp (- (a \\<cdot> ?\\<tau>)) \\<cdot> (L - ?T)\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln ((L - Tmax) / (L - ?T)) / a)\\<rbrakk>\n  \\<Longrightarrow> L - exp (- (a \\<cdot> ?\\<tau>)) \\<cdot> (L - ?T)\n                    \\<le> Tmax\n  \\<lbrakk>Tmin \\<le> ?T; ?T \\<le> Tmax; 0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - (ln ((L - Tmax) / (L - ?T)) / a)\\<rbrakk>\n  \\<Longrightarrow> Tmin\n                    \\<le> L - exp (- (a \\<cdot> ?\\<tau>)) \\<cdot> (L - ?T)\n\ngoal (4 subgoals):\n 1. 0 < a\n 2. 0 \\<le> \\<tau>\n 3. s2p UNIV \\<tau>\n 4. \\<forall>s\\<in>UNIV.\n       s $ 4 \\<noteq> 0 \\<and>\n       I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<longrightarrow>\n       (\\<forall>t\\<in>{0..\\<tau>}.\n           (\\<forall>\\<tau>\\<in>{0..t}.\n               G Tmin Tmax a L (\\<phi> a L \\<tau> s)) \\<longrightarrow>\n           I Tmin Tmax (\\<phi> a L t s))", "by auto"], ["", "lemma R_therm_dyn:\n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n  (IF (\\<lambda>s. s$4 = 0) THEN \n    (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n  ELSE \n    (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. IF (\\<lambda>s.\n           s $ 4 =\n           0) THEN x\\<acute>= \\<lambda>t.\n                                 f a 0 & G Tmin Tmax a\n    0 on \\<lambda>s.\n            {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n              f a L & G Tmin Tmax a L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n    \\<le> Ref \\<lceil>\\<lambda>s.\n                         I Tmin Tmax s \\<and>\n                         s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n           \\<lceil>I Tmin Tmax\\<rceil>", "apply(rule order_trans, rule R_cond_mono)"], ["proof (prove)\ngoal (3 subgoals):\n 1. x\\<acute>= \\<lambda>t.\n                  f a 0 & G Tmin Tmax a\n                           0 on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n    \\<le> ?X'3\n 2. x\\<acute>= \\<lambda>t.\n                  f a L & G Tmin Tmax a\n                           L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n    \\<le> ?Y'3\n 3. IF (\\<lambda>s. s $ 4 = 0) THEN ?X'3 ELSE ?Y'3\n    \\<le> Ref \\<lceil>\\<lambda>s.\n                         I Tmin Tmax s \\<and>\n                         s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n           \\<lceil>I Tmin Tmax\\<rceil>", "using R_therm_dyn_down[OF assms] R_therm_dyn_up[OF assms]"], ["proof (prove)\nusing this:\n  x\\<acute>= \\<lambda>t.\n                f a 0 & G Tmin Tmax a 0 on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n  \\<le> Ref \\<lceil>\\<lambda>s.\n                       s $ 4 = 0 \\<and>\n                       I Tmin Tmax s \\<and>\n                       s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n         \\<lceil>I Tmin Tmax\\<rceil>\n  x\\<acute>= \\<lambda>t.\n                f a L & G Tmin Tmax a L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n  \\<le> Ref \\<lceil>\\<lambda>s.\n                       s $ 4 \\<noteq> 0 \\<and>\n                       I Tmin Tmax s \\<and>\n                       s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n         \\<lceil>I Tmin Tmax\\<rceil>\n\ngoal (3 subgoals):\n 1. x\\<acute>= \\<lambda>t.\n                  f a 0 & G Tmin Tmax a\n                           0 on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n    \\<le> ?X'3\n 2. x\\<acute>= \\<lambda>t.\n                  f a L & G Tmin Tmax a\n                           L on \\<lambda>s. {0..\\<tau>} UNIV @ 0\n    \\<le> ?Y'3\n 3. IF (\\<lambda>s. s $ 4 = 0) THEN ?X'3 ELSE ?Y'3\n    \\<le> Ref \\<lceil>\\<lambda>s.\n                         I Tmin Tmax s \\<and>\n                         s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n           \\<lceil>I Tmin Tmax\\<rceil>", "by (auto intro!: R_cond)"], ["", "lemma R_therm_assign1: \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0\\<rceil> \\<ge> (2 ::= (\\<lambda>s. 0))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 ::= (\\<lambda>s. 0)\n    \\<le> Ref \\<lceil>I Tmin Tmax\\<rceil>\n           \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s $ 2 = 0\\<rceil>", "by (auto simp: R_assign_law)"], ["", "lemma R_therm_assign2: \n  \"Ref \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<ge> (3 ::= (\\<lambda>s. s$1))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 3 ::= (\\<lambda>s. s $ 1)\n    \\<le> Ref \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s $ 2 = 0\\<rceil>\n           \\<lceil>\\<lambda>s.\n                      I Tmin Tmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>", "by (auto simp: R_assign_law)"], ["", "lemma R_therm_ctrl:\n  \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<ge>\n  (2 ::= (\\<lambda>s. 0));\n  (3 ::= (\\<lambda>s. s$1));\n  (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> Tmin + 1) THEN \n    (4 ::= (\\<lambda>s.1)) \n   ELSE IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> Tmax - 1) THEN \n    (4 ::= (\\<lambda>s.0)) \n   ELSE skip)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lparr>(2 ::= (\\<lambda>s. 0)) ;\n            (3 ::= (\\<lambda>s.\n                       s $\n                       1))\\<rparr>IF (\\<lambda>s.\n   s $ 4 = 0 \\<and>\n   s $ 3\n   \\<le> Tmin +\n         1) THEN (4 ::= (\\<lambda>s.\n                            1)) ELSE IF (\\<lambda>s.\n      s $ 4 = 1 \\<and>\n      Tmax - 1\n      \\<le> s $\n            3) THEN (4 ::= (\\<lambda>s.\n                               0)) ELSE skip\\<lparr>Ref\n               \\<lceil>I Tmin Tmax\\<rceil>\n               \\<lceil>\\<lambda>s.\n                          I Tmin Tmax s \\<and>\n                          s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\\<rparr>", "apply(refinement, rule R_therm_assign1, rule R_therm_assign2)"], ["proof (prove)\ngoal (3 subgoals):\n 1. 4 ::= (\\<lambda>s. 1)\n    \\<le> Ref \\<lceil>\\<lambda>s.\n                         (s $ 4 = 0 \\<and> s $ 3 \\<le> Tmin + 1) \\<and>\n                         I Tmin Tmax s \\<and>\n                         s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n           \\<lceil>\\<lambda>s.\n                      I Tmin Tmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n 2. 4 ::= (\\<lambda>s. 0)\n    \\<le> Ref \\<lceil>\\<lambda>s.\n                         (s $ 4 = 1 \\<and> Tmax - 1 \\<le> s $ 3) \\<and>\n                         \\<not> (s $ 4 = 0 \\<and>\n                                 s $ 3 \\<le> Tmin + 1) \\<and>\n                         I Tmin Tmax s \\<and>\n                         s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n           \\<lceil>\\<lambda>s.\n                      I Tmin Tmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n 3. \\<forall>s.\n       \\<not> (s $ 4 = 1 \\<and> Tmax - 1 \\<le> s $ 3) \\<and>\n       \\<not> (s $ 4 = 0 \\<and> s $ 3 \\<le> Tmin + 1) \\<and>\n       I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<longrightarrow>\n       I Tmin Tmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1", "by (rule R_assign_law, simp)+ auto"], ["", "lemma R_therm_loop: \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n  (LOOP \n    Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil>;\n    Ref \\<lceil>\\<lambda>s. I Tmin Tmax s \\<and> s$2 = 0 \\<and> s$3 = s$1\\<rceil> \\<lceil>I Tmin Tmax\\<rceil>\n  INV I Tmin Tmax)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP Ref \\<lceil>I Tmin Tmax\\<rceil>\n          \\<lceil>\\<lambda>s.\n                     I Tmin Tmax s \\<and>\n                     s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil> ;\n         Ref \\<lceil>\\<lambda>s.\n                        I Tmin Tmax s \\<and>\n                        s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n          \\<lceil>I Tmin Tmax\\<rceil> INV I Tmin Tmax \n    \\<le> Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>I Tmin Tmax\\<rceil>", "by (intro R_loop R_seq, simp_all)"], ["", "lemma R_thermostat_flow: \n  assumes \"a > 0\" and \"0 \\<le> \\<tau>\" and \"0 < Tmin\" and \"Tmax < L\"\n  shows \"Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>I Tmin Tmax\\<rceil> \\<ge> \n  (LOOP (\n    \\<comment> \\<open>control\\<close>\n    (2 ::= (\\<lambda>s. 0));(3 ::= (\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> Tmin + 1) THEN \n      (4 ::= (\\<lambda>s.1)) \n     ELSE IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> Tmax - 1) THEN \n      (4 ::= (\\<lambda>s.0)) \n     ELSE skip);\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f a 0) & G Tmin Tmax a 0 on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n    ELSE \n      (x\\<acute>= (\\<lambda>t. f a L) & G Tmin Tmax a L on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0))\n  ) INV I Tmin Tmax)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> Tmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    Tmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         (IF (\\<lambda>s.\n                 s $ 4 =\n                 0) THEN x\\<acute>= \\<lambda>t.\n f a 0 & G Tmin Tmax a\n          0 on \\<lambda>s.\n                  {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                    f a L & G Tmin Tmax a\n                             L on \\<lambda>s.\n                                     {0..\\<tau>} UNIV @ 0) INV I Tmin Tmax \n    \\<le> Ref \\<lceil>I Tmin Tmax\\<rceil> \\<lceil>I Tmin Tmax\\<rceil>", "by (intro order_trans[OF _ R_therm_loop] R_loop_mono \n      R_seq_mono R_therm_ctrl R_therm_dyn[OF assms])"], ["", "no_notation therm_vec_field (\"f\")\n        and therm_flow (\"\\<phi>\")\n        and therm_guard (\"G\")\n        and therm_loop_inv (\"I\")"], ["", "subsubsection \\<open> Water tank \\<close> \\<comment> \\<open> Variation of Hespanha and Alur's tank \\<close>"], ["", "subsubsection \\<open> Tank \\<close>"], ["", "text \\<open> A controller turns a water pump on and off to keep the level of water @{text \"h\"} in a tank\nwithin an acceptable range @{text \"hmin \\<le> h \\<le> hmax\"}. Just like in the previous example, after \neach intervention, the controller registers the current level of water and resets its chronometer,\nthen it changes the status of the water pump accordingly. The level of water grows linearly \n@{text \"h' = k\"} at a rate of @{text \"k = c\\<^sub>i-c\\<^sub>o\"} if the pump is on, and at a rate of \n@{text \"k = -c\\<^sub>o\"} if the pump is off. We use @{term \"1::4\"} to denote the tank's level of water,\n@{term \"2::4\"} is time as measured by the controller's chronometer, @{term \"3::4\"} is the\nlevel of water measured by the chronometer, and @{term \"4::4\"} states whether the pump is on\n(@{text \"s$4 = 1\"}) or off (@{text \"s$4 = 0\"}). We prove that the controller keeps the level of\nwater between @{text \"hmin\"} and @{text \"hmax\"}. \\<close>"], ["", "abbreviation tank_vec_field :: \"real \\<Rightarrow> real^4 \\<Rightarrow> real^4\" (\"f\")\n  where \"f k s \\<equiv> (\\<chi> i. if i = 2 then 1 else (if i = 1 then k else 0))\""], ["", "abbreviation tank_flow :: \"real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> real^4\" (\"\\<phi>\")\n  where \"\\<phi> k \\<tau> s \\<equiv> (\\<chi> i. if i = 1 then k * \\<tau> + s$1 else \n  (if i = 2 then \\<tau> + s$2 else s$i))\""], ["", "abbreviation tank_guard :: \"real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> bool\" (\"G\")\n  where \"G Hm k s \\<equiv> s$2 \\<le> (Hm - s$3)/k\""], ["", "abbreviation tank_loop_inv :: \"real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> bool\" (\"I\")\n  where \"I hmin hmax s \\<equiv> hmin \\<le> s$1 \\<and> s$1 \\<le> hmax \\<and> (s$4 = 0 \\<or> s$4 = 1)\""], ["", "abbreviation tank_diff_inv :: \"real \\<Rightarrow> real \\<Rightarrow> real \\<Rightarrow> real^4 \\<Rightarrow> bool\" (\"dI\")\n  where \"dI hmin hmax k s \\<equiv> s$1 = k \\<cdot> s$2 + s$3 \\<and> 0 \\<le> s$2 \\<and> \n    hmin \\<le> s$3 \\<and> s$3 \\<le> hmax \\<and> (s$4 = 0 \\<or> s$4 = 1)\"\n\n\\<comment> \\<open>Verified with the flow \\<close>"], ["", "lemma local_flow_tank: \"local_flow (f k) UNIV UNIV (\\<phi> k)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. local_flow (f k) UNIV UNIV (\\<phi> k)", "apply (unfold_locales, unfold local_lipschitz_def lipschitz_on_def, simp_all, clarsimp)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x t.\n       \\<exists>u>0.\n          (\\<exists>ta. dist t ta \\<le> u) \\<longrightarrow>\n          (\\<exists>L\\<ge>0.\n              \\<forall>xa\\<in>cball x u.\n                 \\<forall>y\\<in>cball x u. 0 \\<le> L \\<cdot> dist xa y)\n 2. \\<And>t s.\n       \\<forall>i.\n          (i = 1 \\<longrightarrow>\n            D (\\<lambda>x. k \\<cdot> x + s $ 1) = (\\<lambda>x. k)\n            on {0--t}) \\<and>\n          (i \\<noteq> 1 \\<longrightarrow>\n           (i = 2 \\<longrightarrow>\n             D (\\<lambda>x. x + s $ 2) = (\\<lambda>x. 1) on {0--t}) \\<and>\n           (i \\<noteq> 2 \\<longrightarrow>\n             D (\\<lambda>x. s $ i) = (\\<lambda>x. 0) on {0--t}))\n 3. \\<And>s. \\<phi> k 0 s = s", "apply(rule_tac x=\"1/2\" in exI, clarsimp, rule_tac x=1 in exI)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x t ta.\n       dist t ta \\<cdot> 2 \\<le> 1 \\<Longrightarrow>\n       0 \\<le> 1 \\<and>\n       (\\<forall>xa\\<in>cball x (1 / 2).\n           \\<forall>y\\<in>cball x (1 / 2). 0 \\<le> 1 \\<cdot> dist xa y)\n 2. \\<And>t s.\n       \\<forall>i.\n          (i = 1 \\<longrightarrow>\n            D (\\<lambda>x. k \\<cdot> x + s $ 1) = (\\<lambda>x. k)\n            on {0--t}) \\<and>\n          (i \\<noteq> 1 \\<longrightarrow>\n           (i = 2 \\<longrightarrow>\n             D (\\<lambda>x. x + s $ 2) = (\\<lambda>x. 1) on {0--t}) \\<and>\n           (i \\<noteq> 2 \\<longrightarrow>\n             D (\\<lambda>x. s $ i) = (\\<lambda>x. 0) on {0--t}))\n 3. \\<And>s. \\<phi> k 0 s = s", "apply(simp add: dist_norm norm_vec_def L2_set_def, unfold UNIV_4)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x t ta.\n       \\<bar>t - ta\\<bar> \\<cdot> 2 \\<le> 1 \\<Longrightarrow>\n       \\<forall>xa\\<in>cball x (1 / 2).\n          \\<forall>y\\<in>cball x (1 / 2).\n             0 \\<le> (\\<Sum>i\\<in>insert 1 (insert 2 (insert 3 (\\<eta> 4))).\n                        (xa $ i - y $ i)\\<^sup>2)\n 2. \\<And>t s.\n       \\<forall>i.\n          (i = 1 \\<longrightarrow>\n            D (\\<lambda>x. k \\<cdot> x + s $ 1) = (\\<lambda>x. k)\n            on {0--t}) \\<and>\n          (i \\<noteq> 1 \\<longrightarrow>\n           (i = 2 \\<longrightarrow>\n             D (\\<lambda>x. x + s $ 2) = (\\<lambda>x. 1) on {0--t}) \\<and>\n           (i \\<noteq> 2 \\<longrightarrow>\n             D (\\<lambda>x. s $ i) = (\\<lambda>x. 0) on {0--t}))\n 3. \\<And>s. \\<phi> k 0 s = s", "by (auto intro!: poly_derivatives simp: vec_eq_iff)"], ["", "lemma tank_arith:\n  assumes \"0 \\<le> (\\<tau>::real)\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> - ((hmin - y) / c\\<^sub>o) \\<Longrightarrow>  hmin \\<le> y - c\\<^sub>o * \\<tau>\"\n    and \"\\<forall>\\<tau>\\<in>{0..\\<tau>}. \\<tau> \\<le> (hmax - y) / (c\\<^sub>i - c\\<^sub>o) \\<Longrightarrow>  (c\\<^sub>i - c\\<^sub>o) * \\<tau> + y \\<le> hmax\"\n    and \"hmin \\<le> y \\<Longrightarrow> hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\"\n    and \"y \\<le> hmax \\<Longrightarrow> y - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<forall>\\<tau>\\<in>{0..\\<tau>}.\n         \\<tau> \\<le> - ((hmin - y) / c\\<^sub>o) \\<Longrightarrow>\n      hmin \\<le> y - c\\<^sub>o \\<cdot> \\<tau>) &&&\n     (\\<forall>\\<tau>\\<in>{0..\\<tau>}.\n         \\<tau> \\<le> (hmax - y) / (c\\<^sub>i - c\\<^sub>o) \\<Longrightarrow>\n      (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y \\<le> hmax)) &&&\n    (hmin \\<le> y \\<Longrightarrow>\n     hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y) &&&\n    (y \\<le> hmax \\<Longrightarrow> y - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax)", "apply(simp_all add: field_simps le_divide_eq assms)"], ["proof (prove)\ngoal (2 subgoals):\n 1. hmin \\<le> y \\<Longrightarrow>\n    hmin + \\<tau> \\<cdot> c\\<^sub>o \\<le> y + \\<tau> \\<cdot> c\\<^sub>i\n 2. y \\<le> hmax \\<Longrightarrow> y \\<le> hmax + \\<tau> \\<cdot> c\\<^sub>o", "using assms"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau>\n  0 < c\\<^sub>o\n  c\\<^sub>o < c\\<^sub>i\n\ngoal (2 subgoals):\n 1. hmin \\<le> y \\<Longrightarrow>\n    hmin + \\<tau> \\<cdot> c\\<^sub>o \\<le> y + \\<tau> \\<cdot> c\\<^sub>i\n 2. y \\<le> hmax \\<Longrightarrow> y \\<le> hmax + \\<tau> \\<cdot> c\\<^sub>o", "apply (meson add_mono less_eq_real_def mult_left_mono)"], ["proof (prove)\ngoal (1 subgoal):\n 1. y \\<le> hmax \\<Longrightarrow> y \\<le> hmax + \\<tau> \\<cdot> c\\<^sub>o", "using assms"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau>\n  0 < c\\<^sub>o\n  c\\<^sub>o < c\\<^sub>i\n\ngoal (1 subgoal):\n 1. y \\<le> hmax \\<Longrightarrow> y \\<le> hmax + \\<tau> \\<cdot> c\\<^sub>o", "by (meson add_increasing2 less_eq_real_def mult_nonneg_nonneg)"], ["", "lemmas H_g_ode_tank = local_flow.sH_g_ode_ivl[OF local_flow_tank _ UNIV_I]"], ["", "lemma tank_flow:\n  assumes \"0 \\<le> \\<tau>\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"\\<^bold>{I hmin hmax\\<^bold>}\n  (LOOP \n    \\<comment> \\<open>control\\<close>\n    ((2 ::=(\\<lambda>s.0));(3 ::=(\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> hmin + 1) THEN (4 ::= (\\<lambda>s.1)) ELSE \n    (IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> hmax - 1) THEN (4 ::= (\\<lambda>s.0)) ELSE skip));\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN (x\\<acute>= (\\<lambda>t. f (c\\<^sub>i-c\\<^sub>o)) & G hmax (c\\<^sub>i-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0) \n     ELSE (x\\<acute>= (\\<lambda>t. f (-c\\<^sub>o)) & G hmin (-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0)) )\n  INV I hmin hmax) \n  \\<^bold>{I hmin hmax\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}LOOP (2 ::= (\\<lambda>s. 0)) ;\n                                (3 ::= (\\<lambda>s. s $ 1)) ;\n                                (IF (\\<lambda>s.\n  s $ 4 = 0 \\<and>\n  s $ 3\n  \\<le> hmin +\n        1) THEN (4 ::= (\\<lambda>s.\n                           1)) ELSE IF (\\<lambda>s.\n     s $ 4 = 1 \\<and>\n     hmax - 1 \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n                                (IF (\\<lambda>s.\n  s $ 4 =\n  0) THEN x\\<acute>= \\<lambda>t.\n                        f (c\\<^sub>i -\n                           c\\<^sub>o) & G hmax\n   (c\\<^sub>i -\n    c\\<^sub>o) on \\<lambda>s.\n                     {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                       f (- c\\<^sub>o) & G hmin\n    (- c\\<^sub>o) on \\<lambda>s.\n                        {0..\\<tau>} UNIV @ 0) INV I hmin\n             hmax \\<^bold>{I hmin hmax\\<^bold>}", "apply(rule H_loopI)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s. s $ 1)) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 = 0 \\<and>\n                                   s $ 3\n                                   \\<le> hmin +\n   1) THEN (4 ::= (\\<lambda>s.\n                      1)) ELSE IF (\\<lambda>s.\ns $ 4 = 1 \\<and>\nhmax - 1 \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 =\n                                   0) THEN x\\<acute>= \\<lambda>t.\n                   f (c\\<^sub>i -\n                      c\\<^sub>o) & G hmax\n                                    (c\\<^sub>i -\n                                     c\\<^sub>o) on \\<lambda>s.\n                {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                  f (- c\\<^sub>o) & G hmin\n                                     (- c\\<^sub>o) on \\<lambda>s.\n                   {0..\\<tau>} UNIV @ 0)\\<^bold>{I hmin hmax\\<^bold>}\n 2. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I hmin hmax s \\<and> s$2=0 \\<and> s$3 = s$1\" in H_seq)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s. s $ 1)) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 = 0 \\<and>\n                                   s $ 3\n                                   \\<le> hmin +\n   1) THEN (4 ::= (\\<lambda>s.\n                      1)) ELSE IF (\\<lambda>s.\ns $ 4 = 1 \\<and>\nhmax - 1\n\\<le> s $\n      3) THEN (4 ::= (\\<lambda>s.\n                         0)) ELSE skip)\\<^bold>{\\<lambda>s.\n             I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>= \\<lambda>t.\n                 f (c\\<^sub>i -\n                    c\\<^sub>o) & G hmax\n                                  (c\\<^sub>i -\n                                   c\\<^sub>o) on \\<lambda>s.\n              {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                f (- c\\<^sub>o) & G hmin\n                                   (- c\\<^sub>o) on \\<lambda>s.\n                 {0..\\<tau>} UNIV @ 0\\<^bold>{I hmin hmax\\<^bold>}\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I hmin hmax s \\<and> s$2=0 \\<and> s$3 = s$1\" in H_seq)"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s.\ns $\n1))\\<^bold>{\\<lambda>s.\n               I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 = 0 \\<and>\n                                 s $ 3\n                                 \\<le> hmin +\n 1) THEN (4 ::= (\\<lambda>s.\n                    1)) ELSE IF (\\<lambda>s.\n                                    s $ 4 = 1 \\<and>\n                                    hmax - 1\n                                    \\<le> s $\n    3) THEN (4 ::= (\\<lambda>s.\n                       0)) ELSE skip\\<^bold>{\\<lambda>s.\n          I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 3. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>= \\<lambda>t.\n                 f (c\\<^sub>i -\n                    c\\<^sub>o) & G hmax\n                                  (c\\<^sub>i -\n                                   c\\<^sub>o) on \\<lambda>s.\n              {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                f (- c\\<^sub>o) & G hmin\n                                   (- c\\<^sub>o) on \\<lambda>s.\n                 {0..\\<tau>} UNIV @ 0\\<^bold>{I hmin hmax\\<^bold>}\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 5. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I hmin hmax s \\<and> s$2=0\" in H_seq, simp, simp)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 = 0 \\<and>\n                                 s $ 3\n                                 \\<le> hmin +\n 1) THEN (4 ::= (\\<lambda>s.\n                    1)) ELSE IF (\\<lambda>s.\n                                    s $ 4 = 1 \\<and>\n                                    hmax - 1\n                                    \\<le> s $\n    3) THEN (4 ::= (\\<lambda>s.\n                       0)) ELSE skip\\<^bold>{\\<lambda>s.\n          I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>= \\<lambda>t.\n                 f (c\\<^sub>i -\n                    c\\<^sub>o) & G hmax\n                                  (c\\<^sub>i -\n                                   c\\<^sub>o) on \\<lambda>s.\n              {0..\\<tau>} UNIV @ 0 ELSE x\\<acute>= \\<lambda>t.\n                f (- c\\<^sub>o) & G hmin\n                                   (- c\\<^sub>o) on \\<lambda>s.\n                 {0..\\<tau>} UNIV @ 0\\<^bold>{I hmin hmax\\<^bold>}\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule H_cond, simp_all add: H_g_ode_tank[OF assms(1)])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<forall>s.\n        hmin \\<le> s $ 1 \\<and>\n        s $ 1 \\<le> hmax \\<and>\n        (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n        s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<and> s $ 4 = 0 \\<longrightarrow>\n        (\\<forall>t\\<in>{0..\\<tau>}.\n            (\\<forall>\\<tau>\\<in>{0..t}.\n                \\<tau>\n                \\<le> (hmax - s $ 1) /\n                      (c\\<^sub>i - c\\<^sub>o)) \\<longrightarrow>\n            hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> t + s $ 1 \\<and>\n            (c\\<^sub>i - c\\<^sub>o) \\<cdot> t + s $ 1 \\<le> hmax)) \\<and>\n    (\\<forall>s.\n        hmin \\<le> s $ 1 \\<and>\n        s $ 1 \\<le> hmax \\<and>\n        (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n        s $ 2 = 0 \\<and>\n        s $ 3 = s $ 1 \\<and> s $ 4 \\<noteq> 0 \\<longrightarrow>\n        (\\<forall>t\\<in>{0..\\<tau>}.\n            (\\<forall>\\<tau>\\<in>{0..t}.\n                \\<tau>\n                \\<le> - ((hmin - s $ 1) / c\\<^sub>o)) \\<longrightarrow>\n            hmin \\<le> s $ 1 - c\\<^sub>o \\<cdot> t \\<and>\n            s $ 1 - c\\<^sub>o \\<cdot> t \\<le> hmax \\<and> s $ 4 = 1))", "using assms tank_arith[OF _ assms(2,3)]"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau>\n  0 < c\\<^sub>o\n  c\\<^sub>o < c\\<^sub>i\n  \\<lbrakk>0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> - ((?hmin - ?y) / c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> ?hmin \\<le> ?y - c\\<^sub>o \\<cdot> ?\\<tau>\n  \\<lbrakk>0 \\<le> ?\\<tau>;\n   \\<forall>\\<tau>\\<in>{0..?\\<tau>}.\n      \\<tau> \\<le> (?hmax - ?y) / (c\\<^sub>i - c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> (c\\<^sub>i - c\\<^sub>o) \\<cdot> ?\\<tau> + ?y \\<le> ?hmax\n  \\<lbrakk>0 \\<le> ?\\<tau>; ?hmin \\<le> ?y\\<rbrakk>\n  \\<Longrightarrow> ?hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> ?\\<tau> + ?y\n  \\<lbrakk>0 \\<le> ?\\<tau>; ?y \\<le> ?hmax\\<rbrakk>\n  \\<Longrightarrow> ?y - c\\<^sub>o \\<cdot> ?\\<tau> \\<le> ?hmax\n\ngoal (1 subgoal):\n 1. (\\<forall>s.\n        hmin \\<le> s $ 1 \\<and>\n        s $ 1 \\<le> hmax \\<and>\n        (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n        s $ 2 = 0 \\<and> s $ 3 = s $ 1 \\<and> s $ 4 = 0 \\<longrightarrow>\n        (\\<forall>t\\<in>{0..\\<tau>}.\n            (\\<forall>\\<tau>\\<in>{0..t}.\n                \\<tau>\n                \\<le> (hmax - s $ 1) /\n                      (c\\<^sub>i - c\\<^sub>o)) \\<longrightarrow>\n            hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> t + s $ 1 \\<and>\n            (c\\<^sub>i - c\\<^sub>o) \\<cdot> t + s $ 1 \\<le> hmax)) \\<and>\n    (\\<forall>s.\n        hmin \\<le> s $ 1 \\<and>\n        s $ 1 \\<le> hmax \\<and>\n        (s $ 4 = 0 \\<or> s $ 4 = 1) \\<and>\n        s $ 2 = 0 \\<and>\n        s $ 3 = s $ 1 \\<and> s $ 4 \\<noteq> 0 \\<longrightarrow>\n        (\\<forall>t\\<in>{0..\\<tau>}.\n            (\\<forall>\\<tau>\\<in>{0..t}.\n                \\<tau>\n                \\<le> - ((hmin - s $ 1) / c\\<^sub>o)) \\<longrightarrow>\n            hmin \\<le> s $ 1 - c\\<^sub>o \\<cdot> t \\<and>\n            s $ 1 - c\\<^sub>o \\<cdot> t \\<le> hmax \\<and> s $ 4 = 1))", "by auto\n\n\\<comment> \\<open>Verified with differential invariants \\<close>"], ["", "lemma tank_diff_inv:\n  \"0 \\<le> \\<tau> \\<Longrightarrow> diff_invariant (dI hmin hmax k) (\\<lambda>t. f k) (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (dI hmin hmax k) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard", "apply(intro diff_invariant_conj_rule)"], ["proof (prove)\ngoal (5 subgoals):\n 1. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 1 = k \\<cdot> s $ 2 + s $ 3)\n     (\\<lambda>t. f k) (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 2. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. 0 \\<le> s $ 2) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 3. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. hmin \\<le> s $ 3) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 4. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 3 \\<le> hmax) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 5. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 4 = 0 \\<or> s $ 4 = 1) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard", "apply(force intro!: poly_derivatives diff_invariant_rules)"], ["proof (prove)\ngoal (4 subgoals):\n 1. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. 0 \\<le> s $ 2) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 2. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. hmin \\<le> s $ 3) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 3. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 3 \\<le> hmax) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 4. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 4 = 0 \\<or> s $ 4 = 1) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard", "apply(rule_tac \\<nu>'=\"\\<lambda>t. 0\" and \\<mu>'=\"\\<lambda>t. 1\" in diff_invariant_leq_rule, simp_all, presburger)"], ["proof (prove)\ngoal (3 subgoals):\n 1. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. hmin \\<le> s $ 3) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 2. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 3 \\<le> hmax) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 3. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 4 = 0 \\<or> s $ 4 = 1) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard", "apply(rule_tac \\<nu>'=\"\\<lambda>t. 0\" and \\<mu>'=\"\\<lambda>t. 0\" in diff_invariant_leq_rule, simp_all)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>X.\n       \\<lbrakk>0 \\<le> \\<tau>;\n        \\<forall>i.\n            D (\\<lambda>x.\n                  X x $\n                  i) = (\\<lambda>x.\n                           if i = 2 then 1 else if i = 1 then k else 0)\n            on {0..\\<tau>}\\<rbrakk>\n       \\<Longrightarrow>  D (\\<lambda>x. X x $ 3 - hmin) = (\\<lambda>x. 0)\n                          on {0..\\<tau>}\n 2. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 3 \\<le> hmax) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 3. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 4 = 0 \\<or> s $ 4 = 1) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard", "apply(force intro!: poly_derivatives)+"], ["proof (prove)\ngoal (2 subgoals):\n 1. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 3 \\<le> hmax) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard\n 2. 0 \\<le> \\<tau> \\<Longrightarrow>\n    diff_invariant (\\<lambda>s. s $ 4 = 0 \\<or> s $ 4 = 1) (\\<lambda>t. f k)\n     (\\<lambda>s. {0..\\<tau>}) UNIV 0 Guard", "by (auto intro!: poly_derivatives diff_invariant_rules)"], ["", "lemma tank_inv_arith1:\n  assumes \"0 \\<le> (\\<tau>::real)\" and \"c\\<^sub>o < c\\<^sub>i\" and b: \"hmin \\<le> y\\<^sub>0\" and g: \"\\<tau> \\<le> (hmax - y\\<^sub>0) / (c\\<^sub>i - c\\<^sub>o)\"\n  shows \"hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0\" and \"(c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax\""], ["proof (prove)\ngoal (1 subgoal):\n 1. hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 &&&\n    (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax", "proof-"], ["proof (state)\ngoal (2 subgoals):\n 1. hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0\n 2. (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax", "have \"(c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> \\<le> (hmax - y\\<^sub>0)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> \\<le> hmax - y\\<^sub>0", "using g assms(2,3)"], ["proof (prove)\nusing this:\n  \\<tau> \\<le> (hmax - y\\<^sub>0) / (c\\<^sub>i - c\\<^sub>o)\n  c\\<^sub>o < c\\<^sub>i\n  hmin \\<le> y\\<^sub>0\n\ngoal (1 subgoal):\n 1. (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> \\<le> hmax - y\\<^sub>0", "by (metis diff_gt_0_iff_gt mult.commute pos_le_divide_eq)"], ["proof (state)\nthis:\n  (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> \\<le> hmax - y\\<^sub>0\n\ngoal (2 subgoals):\n 1. hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0\n 2. (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax", "thus \"(c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax\""], ["proof (prove)\nusing this:\n  (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> \\<le> hmax - y\\<^sub>0\n\ngoal (1 subgoal):\n 1. (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax", "by auto"], ["proof (state)\nthis:\n  (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0 \\<le> hmax\n\ngoal (1 subgoal):\n 1. hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0", "show \"hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0", "using b assms(1,2)"], ["proof (prove)\nusing this:\n  hmin \\<le> y\\<^sub>0\n  0 \\<le> \\<tau>\n  c\\<^sub>o < c\\<^sub>i\n\ngoal (1 subgoal):\n 1. hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0", "by (metis add.commute add_increasing2 diff_ge_0_iff_ge \n        less_eq_real_def mult_nonneg_nonneg)"], ["proof (state)\nthis:\n  hmin \\<le> (c\\<^sub>i - c\\<^sub>o) \\<cdot> \\<tau> + y\\<^sub>0\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma tank_inv_arith2:\n  assumes \"0 \\<le> (\\<tau>::real)\" and \"0 < c\\<^sub>o\" and b: \"y\\<^sub>0 \\<le> hmax\" and g: \"\\<tau> \\<le> - ((hmin - y\\<^sub>0) / c\\<^sub>o)\"\n  shows \"hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau>\" and \"y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax\""], ["proof (prove)\ngoal (1 subgoal):\n 1. hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> &&&\n    y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax", "proof-"], ["proof (state)\ngoal (2 subgoals):\n 1. hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau>\n 2. y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax", "have \"\\<tau> \\<cdot> c\\<^sub>o \\<le> y\\<^sub>0 - hmin\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<tau> \\<cdot> c\\<^sub>o \\<le> y\\<^sub>0 - hmin", "using g \\<open>0 < c\\<^sub>o\\<close> pos_le_minus_divide_eq"], ["proof (prove)\nusing this:\n  \\<tau> \\<le> - ((hmin - y\\<^sub>0) / c\\<^sub>o)\n  0 < c\\<^sub>o\n  (0::?'a) < ?c \\<Longrightarrow>\n  (?a \\<le> - (?b / ?c)) = (?a \\<cdot> ?c \\<le> - ?b)\n\ngoal (1 subgoal):\n 1. \\<tau> \\<cdot> c\\<^sub>o \\<le> y\\<^sub>0 - hmin", "by fastforce"], ["proof (state)\nthis:\n  \\<tau> \\<cdot> c\\<^sub>o \\<le> y\\<^sub>0 - hmin\n\ngoal (2 subgoals):\n 1. hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau>\n 2. y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax", "thus \"hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau>\""], ["proof (prove)\nusing this:\n  \\<tau> \\<cdot> c\\<^sub>o \\<le> y\\<^sub>0 - hmin\n\ngoal (1 subgoal):\n 1. hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau>", "by (auto simp: mult.commute)"], ["proof (state)\nthis:\n  hmin \\<le> y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau>\n\ngoal (1 subgoal):\n 1. y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax", "show \"y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax\""], ["proof (prove)\ngoal (1 subgoal):\n 1. y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax", "using b assms(1,2)"], ["proof (prove)\nusing this:\n  y\\<^sub>0 \\<le> hmax\n  0 \\<le> \\<tau>\n  0 < c\\<^sub>o\n\ngoal (1 subgoal):\n 1. y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax", "by (smt mult_nonneg_nonneg)"], ["proof (state)\nthis:\n  y\\<^sub>0 - c\\<^sub>o \\<cdot> \\<tau> \\<le> hmax\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma tank_inv:\n  assumes \"0 \\<le> \\<tau>\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"\\<^bold>{I hmin hmax\\<^bold>}\n  (LOOP \n    \\<comment> \\<open>control\\<close>\n    ((2 ::=(\\<lambda>s.0));(3 ::=(\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> hmin + 1) THEN (4 ::= (\\<lambda>s.1)) ELSE \n    (IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> hmax - 1) THEN (4 ::= (\\<lambda>s.0)) ELSE skip));\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f (c\\<^sub>i-c\\<^sub>o)) & G hmax (c\\<^sub>i-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (c\\<^sub>i-c\\<^sub>o))) \n     ELSE \n      (x\\<acute>= (\\<lambda>t. f (-c\\<^sub>o)) & G hmin (-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (-c\\<^sub>o)))) )\n  INV I hmin hmax)\n  \\<^bold>{I hmin hmax\\<^bold>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}LOOP (2 ::= (\\<lambda>s. 0)) ;\n                                (3 ::= (\\<lambda>s. s $ 1)) ;\n                                (IF (\\<lambda>s.\n  s $ 4 = 0 \\<and>\n  s $ 3\n  \\<le> hmin +\n        1) THEN (4 ::= (\\<lambda>s.\n                           1)) ELSE IF (\\<lambda>s.\n     s $ 4 = 1 \\<and>\n     hmax - 1 \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n                                (IF (\\<lambda>s.\n  s $ 4 =\n  0) THEN x\\<acute>=\\<lambda>t.\n                       f (c\\<^sub>i -\n                          c\\<^sub>o) & G hmax\n  (c\\<^sub>i -\n   c\\<^sub>o) on \\<lambda>s.\n                    {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n         (c\\<^sub>i -\n          c\\<^sub>o)  ELSE x\\<acute>=\\<lambda>t.\n  f (- c\\<^sub>o) & G hmin\n                     (- c\\<^sub>o) on \\<lambda>s.\n   {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                              (- c\\<^sub>o) ) INV I hmin\n             hmax \\<^bold>{I hmin hmax\\<^bold>}", "apply(rule H_loopI)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s. s $ 1)) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 = 0 \\<and>\n                                   s $ 3\n                                   \\<le> hmin +\n   1) THEN (4 ::= (\\<lambda>s.\n                      1)) ELSE IF (\\<lambda>s.\ns $ 4 = 1 \\<and>\nhmax - 1 \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 =\n                                   0) THEN x\\<acute>=\\<lambda>t.\n                  f (c\\<^sub>i -\n                     c\\<^sub>o) & G hmax\n                                   (c\\<^sub>i -\n                                    c\\<^sub>o) on \\<lambda>s.\n               {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n    (c\\<^sub>i -\n     c\\<^sub>o)  ELSE x\\<acute>=\\<lambda>t.\n                                   f (- c\\<^sub>o) & G hmin\n                (- c\\<^sub>o) on \\<lambda>s.\n                                    {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                         (- c\\<^sub>o) )\\<^bold>{I hmin hmax\\<^bold>}\n 2. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I hmin hmax s \\<and> s$2=0 \\<and> s$3 = s$1\" in H_seq)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s. s $ 1)) ;\n                           (IF (\\<lambda>s.\n                                   s $ 4 = 0 \\<and>\n                                   s $ 3\n                                   \\<le> hmin +\n   1) THEN (4 ::= (\\<lambda>s.\n                      1)) ELSE IF (\\<lambda>s.\ns $ 4 = 1 \\<and>\nhmax - 1\n\\<le> s $\n      3) THEN (4 ::= (\\<lambda>s.\n                         0)) ELSE skip)\\<^bold>{\\<lambda>s.\n             I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>=\\<lambda>t.\n                f (c\\<^sub>i -\n                   c\\<^sub>o) & G hmax\n                                 (c\\<^sub>i -\n                                  c\\<^sub>o) on \\<lambda>s.\n             {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n  (c\\<^sub>i -\n   c\\<^sub>o)  ELSE x\\<acute>=\\<lambda>t.\n                                 f (- c\\<^sub>o) & G hmin\n              (- c\\<^sub>o) on \\<lambda>s.\n                                  {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                       (- c\\<^sub>o) \\<^bold>{I hmin hmax\\<^bold>}\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I hmin hmax s \\<and> s$2=0 \\<and> s$3 = s$1\" in H_seq)"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<^bold>{I hmin\n              hmax\\<^bold>}(2 ::= (\\<lambda>s. 0)) ;\n                           (3 ::= (\\<lambda>s.\ns $\n1))\\<^bold>{\\<lambda>s.\n               I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 = 0 \\<and>\n                                 s $ 3\n                                 \\<le> hmin +\n 1) THEN (4 ::= (\\<lambda>s.\n                    1)) ELSE IF (\\<lambda>s.\n                                    s $ 4 = 1 \\<and>\n                                    hmax - 1\n                                    \\<le> s $\n    3) THEN (4 ::= (\\<lambda>s.\n                       0)) ELSE skip\\<^bold>{\\<lambda>s.\n          I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 3. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>=\\<lambda>t.\n                f (c\\<^sub>i -\n                   c\\<^sub>o) & G hmax\n                                 (c\\<^sub>i -\n                                  c\\<^sub>o) on \\<lambda>s.\n             {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n  (c\\<^sub>i -\n   c\\<^sub>o)  ELSE x\\<acute>=\\<lambda>t.\n                                 f (- c\\<^sub>o) & G hmin\n              (- c\\<^sub>o) on \\<lambda>s.\n                                  {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                       (- c\\<^sub>o) \\<^bold>{I hmin hmax\\<^bold>}\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 5. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule_tac R=\"\\<lambda>s. I hmin hmax s \\<and> s$2=0\" in H_seq, simp, simp)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 = 0 \\<and>\n                                 s $ 3\n                                 \\<le> hmin +\n 1) THEN (4 ::= (\\<lambda>s.\n                    1)) ELSE IF (\\<lambda>s.\n                                    s $ 4 = 1 \\<and>\n                                    hmax - 1\n                                    \\<le> s $\n    3) THEN (4 ::= (\\<lambda>s.\n                       0)) ELSE skip\\<^bold>{\\<lambda>s.\n          I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<^bold>}\n 2. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>=\\<lambda>t.\n                f (c\\<^sub>i -\n                   c\\<^sub>o) & G hmax\n                                 (c\\<^sub>i -\n                                  c\\<^sub>o) on \\<lambda>s.\n             {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n  (c\\<^sub>i -\n   c\\<^sub>o)  ELSE x\\<acute>=\\<lambda>t.\n                                 f (- c\\<^sub>o) & G hmin\n              (- c\\<^sub>o) on \\<lambda>s.\n                                  {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                       (- c\\<^sub>o) \\<^bold>{I hmin hmax\\<^bold>}\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule H_cond, simp, simp)+"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<^bold>{\\<lambda>s.\n                I hmin hmax s \\<and>\n                s $ 2 = 0 \\<and>\n                s $ 3 =\n                s $\n                1\\<^bold>}IF (\\<lambda>s.\n                                 s $ 4 =\n                                 0) THEN x\\<acute>=\\<lambda>t.\n                f (c\\<^sub>i -\n                   c\\<^sub>o) & G hmax\n                                 (c\\<^sub>i -\n                                  c\\<^sub>o) on \\<lambda>s.\n             {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n  (c\\<^sub>i -\n   c\\<^sub>o)  ELSE x\\<acute>=\\<lambda>t.\n                                 f (- c\\<^sub>o) & G hmin\n              (- c\\<^sub>o) on \\<lambda>s.\n                                  {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                       (- c\\<^sub>o) \\<^bold>{I hmin hmax\\<^bold>}\n 2. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule H_cond, rule H_g_ode_inv)"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<^bold>{dI hmin hmax\n              (c\\<^sub>i -\n               c\\<^sub>o)\\<^bold>}x\\<acute>= \\<lambda>t.\n          f (c\\<^sub>i -\n             c\\<^sub>o) & G hmax\n                           (c\\<^sub>i -\n                            c\\<^sub>o) on \\<lambda>s.\n       {0..\\<tau>} UNIV @ 0\\<^bold>{dI hmin hmax\n                                     (c\\<^sub>i - c\\<^sub>o)\\<^bold>}\n 2. \\<lceil>\\<lambda>s.\n               (I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1) \\<and>\n               s $ 4 = 0\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (c\\<^sub>i - c\\<^sub>o)\\<rceil>\n 3. \\<lceil>\\<lambda>s.\n               dI hmin hmax (c\\<^sub>i - c\\<^sub>o) s \\<and>\n               G hmax (c\\<^sub>i - c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<^bold>{\\<lambda>s.\n                (I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1) \\<and>\n                s $ 4 \\<noteq>\n                0\\<^bold>}x\\<acute>=\\<lambda>t.\n f (- c\\<^sub>o) & G hmin\n                    (- c\\<^sub>o) on \\<lambda>s.\n  {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                             (- c\\<^sub>o) \\<^bold>{I hmin hmax\\<^bold>}\n 5. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 6. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "using assms tank_inv_arith1"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau>\n  0 < c\\<^sub>o\n  c\\<^sub>o < c\\<^sub>i\n  \\<lbrakk>0 \\<le> ?\\<tau>; ?c\\<^sub>o < ?c\\<^sub>i; ?hmin \\<le> ?y\\<^sub>0;\n   ?\\<tau> \\<le> (?hmax - ?y\\<^sub>0) / (?c\\<^sub>i - ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> ?hmin\n                    \\<le> (?c\\<^sub>i - ?c\\<^sub>o) \\<cdot> ?\\<tau> +\n                          ?y\\<^sub>0\n  \\<lbrakk>0 \\<le> ?\\<tau>; ?c\\<^sub>o < ?c\\<^sub>i; ?hmin \\<le> ?y\\<^sub>0;\n   ?\\<tau> \\<le> (?hmax - ?y\\<^sub>0) / (?c\\<^sub>i - ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> (?c\\<^sub>i - ?c\\<^sub>o) \\<cdot> ?\\<tau> + ?y\\<^sub>0\n                    \\<le> ?hmax\n\ngoal (6 subgoals):\n 1. \\<^bold>{dI hmin hmax\n              (c\\<^sub>i -\n               c\\<^sub>o)\\<^bold>}x\\<acute>= \\<lambda>t.\n          f (c\\<^sub>i -\n             c\\<^sub>o) & G hmax\n                           (c\\<^sub>i -\n                            c\\<^sub>o) on \\<lambda>s.\n       {0..\\<tau>} UNIV @ 0\\<^bold>{dI hmin hmax\n                                     (c\\<^sub>i - c\\<^sub>o)\\<^bold>}\n 2. \\<lceil>\\<lambda>s.\n               (I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1) \\<and>\n               s $ 4 = 0\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (c\\<^sub>i - c\\<^sub>o)\\<rceil>\n 3. \\<lceil>\\<lambda>s.\n               dI hmin hmax (c\\<^sub>i - c\\<^sub>o) s \\<and>\n               G hmax (c\\<^sub>i - c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<^bold>{\\<lambda>s.\n                (I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1) \\<and>\n                s $ 4 \\<noteq>\n                0\\<^bold>}x\\<acute>=\\<lambda>t.\n f (- c\\<^sub>o) & G hmin\n                    (- c\\<^sub>o) on \\<lambda>s.\n  {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                             (- c\\<^sub>o) \\<^bold>{I hmin hmax\\<^bold>}\n 5. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 6. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(force simp: tank_diff_inv, simp, clarsimp)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<^bold>{\\<lambda>s.\n                (I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1) \\<and>\n                s $ 4 \\<noteq>\n                0\\<^bold>}x\\<acute>=\\<lambda>t.\n f (- c\\<^sub>o) & G hmin\n                    (- c\\<^sub>o) on \\<lambda>s.\n  {0..\\<tau>} UNIV @ 0 DINV dI hmin hmax\n                             (- c\\<^sub>o) \\<^bold>{I hmin hmax\\<^bold>}\n 2. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 3. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "apply(rule H_g_ode_inv)"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<^bold>{dI hmin hmax\n              (- c\\<^sub>o)\\<^bold>}x\\<acute>= \\<lambda>t.\n            f (- c\\<^sub>o) & G hmin\n                               (- c\\<^sub>o) on \\<lambda>s.\n             {0..\\<tau>} UNIV @ 0\\<^bold>{dI hmin hmax\n     (- c\\<^sub>o)\\<^bold>}\n 2. \\<lceil>\\<lambda>s.\n               (I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1) \\<and>\n               s $ 4 \\<noteq> 0\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (- c\\<^sub>o)\\<rceil>\n 3. \\<lceil>\\<lambda>s.\n               dI hmin hmax (- c\\<^sub>o) s \\<and>\n               G hmin (- c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 5. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "using assms tank_diff_inv[of _ \"-c\\<^sub>o\" hmin hmax] tank_inv_arith2"], ["proof (prove)\nusing this:\n  0 \\<le> \\<tau>\n  0 < c\\<^sub>o\n  c\\<^sub>o < c\\<^sub>i\n  0 \\<le> ?\\<tau> \\<Longrightarrow>\n  diff_invariant (dI hmin hmax (- c\\<^sub>o)) (\\<lambda>t. f (- c\\<^sub>o))\n   (\\<lambda>s. {0..?\\<tau>}) UNIV 0 ?Guard\n  \\<lbrakk>0 \\<le> ?\\<tau>; 0 < ?c\\<^sub>o; ?y\\<^sub>0 \\<le> ?hmax;\n   ?\\<tau> \\<le> - ((?hmin - ?y\\<^sub>0) / ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> ?hmin \\<le> ?y\\<^sub>0 - ?c\\<^sub>o \\<cdot> ?\\<tau>\n  \\<lbrakk>0 \\<le> ?\\<tau>; 0 < ?c\\<^sub>o; ?y\\<^sub>0 \\<le> ?hmax;\n   ?\\<tau> \\<le> - ((?hmin - ?y\\<^sub>0) / ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> ?y\\<^sub>0 - ?c\\<^sub>o \\<cdot> ?\\<tau> \\<le> ?hmax\n\ngoal (5 subgoals):\n 1. \\<^bold>{dI hmin hmax\n              (- c\\<^sub>o)\\<^bold>}x\\<acute>= \\<lambda>t.\n            f (- c\\<^sub>o) & G hmin\n                               (- c\\<^sub>o) on \\<lambda>s.\n             {0..\\<tau>} UNIV @ 0\\<^bold>{dI hmin hmax\n     (- c\\<^sub>o)\\<^bold>}\n 2. \\<lceil>\\<lambda>s.\n               (I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1) \\<and>\n               s $ 4 \\<noteq> 0\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (- c\\<^sub>o)\\<rceil>\n 3. \\<lceil>\\<lambda>s.\n               dI hmin hmax (- c\\<^sub>o) s \\<and>\n               G hmin (- c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>\n 4. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>\n 5. \\<lceil>I hmin hmax\\<rceil> \\<le> \\<lceil>I hmin hmax\\<rceil>", "by auto\n\n\\<comment> \\<open>Refined with differential invariants \\<close>"], ["", "abbreviation tank_ctrl :: \"real \\<Rightarrow> real \\<Rightarrow> (real^4) nd_fun\" (\"ctrl\")\n  where \"ctrl hmin hmax \\<equiv> ((2 ::=(\\<lambda>s.0));(3 ::=(\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> hmin + 1) THEN (4 ::= (\\<lambda>s.1)) ELSE \n    (IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> hmax - 1) THEN (4 ::= (\\<lambda>s.0)) ELSE skip)))\""], ["", "abbreviation tank_dyn_dinv :: \"real \\<Rightarrow> real \\<Rightarrow> real \\<Rightarrow> real \\<Rightarrow> real \\<Rightarrow> (real^4) nd_fun\" (\"dyn\")\n  where \"dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> \\<equiv> (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f (c\\<^sub>i-c\\<^sub>o)) & G hmax (c\\<^sub>i-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (c\\<^sub>i-c\\<^sub>o))) \n     ELSE \n      (x\\<acute>= (\\<lambda>t. f (-c\\<^sub>o)) & G hmin (-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (-c\\<^sub>o))))\""], ["", "abbreviation \"tank_dinv c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> \\<equiv> LOOP (ctrl hmin hmax ; dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau>) INV (I hmin hmax)\""], ["", "lemma R_tank_inv:\n  assumes \"0 \\<le> \\<tau>\" and \"0 < c\\<^sub>o\" and \"c\\<^sub>o < c\\<^sub>i\"\n  shows \"Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil> \\<ge> \n  (LOOP \n    \\<comment> \\<open>control\\<close>\n    ((2 ::=(\\<lambda>s.0));(3 ::=(\\<lambda>s. s$1));\n    (IF (\\<lambda>s. s$4 = 0 \\<and> s$3 \\<le> hmin + 1) THEN (4 ::= (\\<lambda>s.1)) ELSE \n    (IF (\\<lambda>s. s$4 = 1 \\<and> s$3 \\<ge> hmax - 1) THEN (4 ::= (\\<lambda>s.0)) ELSE skip));\n    \\<comment> \\<open>dynamics\\<close>\n    (IF (\\<lambda>s. s$4 = 0) THEN \n      (x\\<acute>= (\\<lambda>t. f (c\\<^sub>i-c\\<^sub>o)) & G hmax (c\\<^sub>i-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (c\\<^sub>i-c\\<^sub>o))) \n     ELSE \n      (x\\<acute>= (\\<lambda>t. f (-c\\<^sub>o)) & G hmin (-c\\<^sub>o) on (\\<lambda>s. {0..\\<tau>}) UNIV @ 0 DINV (dI hmin hmax (-c\\<^sub>o)))) )\n  INV I hmin hmax)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "have \"Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil> \\<ge> \n    LOOP (\n      (2 ::= (\\<lambda>s. 0)); (Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s$2 = 0\\<rceil> \\<lceil>I hmin hmax\\<rceil>)\n    ) INV I hmin hmax\" (is \"_ \\<ge> ?R\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ;\n         Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n          \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "by (refinement, auto)"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ;\n       Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>\n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "moreover"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ;\n       Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>\n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "have \n    \"?R \\<ge> LOOP (\n      (2 ::= (\\<lambda>s. 0));(3 ::=(\\<lambda>s. s$1));\n      (Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s$2 = 0 \\<and> s$3=s$1\\<rceil> \\<lceil>I hmin hmax\\<rceil>)\n    ) INV I hmin hmax\" (is \"_ \\<ge> ?R\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         Ref \\<lceil>\\<lambda>s.\n                        I hmin hmax s \\<and>\n                        s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n          \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n    \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ;\n               Ref \\<lceil>\\<lambda>s.\n                              I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n                \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax", "by (simp only: mult.assoc, refinement, auto)"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ;\n             Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "moreover"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ;\n             Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "have \n    \"?R \\<ge> LOOP (\n      ctrl hmin hmax;\n      (Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s$2 = 0 \\<and> s$3=s$1\\<rceil> \\<lceil>I hmin hmax\\<rceil>)\n    ) INV I hmin hmax\" (is \"_ \\<ge> ?R\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         Ref \\<lceil>\\<lambda>s.\n                        I hmin hmax s \\<and>\n                        s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n          \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n    \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n               Ref \\<lceil>\\<lambda>s.\n                              I hmin hmax s \\<and>\n                              s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n                \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax", "by (simp only: mult.assoc, refinement; (force)?, (rule R_assign_law)?) auto"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n             Ref \\<lceil>\\<lambda>s.\n                            I hmin hmax s \\<and>\n                            s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "moreover"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n             Ref \\<lceil>\\<lambda>s.\n                            I hmin hmax s \\<and>\n                            s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "have \n    \"?R \\<ge> LOOP (ctrl hmin hmax; dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau>) INV I hmin hmax\""], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n               (IF (\\<lambda>s.\n                       s $ 4 = 0 \\<and>\n                       s $ 3\n                       \\<le> hmin +\n                             1) THEN (4 ::= (\\<lambda>s.\n          1)) ELSE IF (\\<lambda>s.\n                          s $ 4 = 1 \\<and>\n                          hmax - 1\n                          \\<le> s $\n                                3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n               Ref \\<lceil>\\<lambda>s.\n                              I hmin hmax s \\<and>\n                              s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n                \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax", "apply(simp only: mult.assoc, refinement; ((rule tank_diff_inv[OF assms(1)])? | (simp)?))"], ["proof (prove)\ngoal (9 subgoals):\n 1. 2 ::= (\\<lambda>s. 0) \\<le> 2 ::= (\\<lambda>s. 0)\n 2. 3 ::= (\\<lambda>s. s $ 1) \\<le> 3 ::= (\\<lambda>s. s $ 1)\n 3. 4 ::= (\\<lambda>s. 1) \\<le> 4 ::= (\\<lambda>s. 1)\n 4. 4 ::= (\\<lambda>s. 0) \\<le> 4 ::= (\\<lambda>s. 0)\n 5. skip \\<le> skip\n 6. \\<lceil>\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (c\\<^sub>i - c\\<^sub>o)\\<rceil>\n 7. \\<lceil>\\<lambda>s.\n               dI hmin hmax (c\\<^sub>i - c\\<^sub>o) s \\<and>\n               G hmax (c\\<^sub>i - c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>\n 8. \\<lceil>\\<lambda>s.\n               s $ 4 \\<noteq> 0 \\<and>\n               I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (- c\\<^sub>o)\\<rceil>\n 9. \\<lceil>\\<lambda>s.\n               dI hmin hmax (- c\\<^sub>o) s \\<and>\n               G hmin (- c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>", "using tank_inv_arith1 tank_inv_arith2 assms"], ["proof (prove)\nusing this:\n  \\<lbrakk>0 \\<le> ?\\<tau>; ?c\\<^sub>o < ?c\\<^sub>i; ?hmin \\<le> ?y\\<^sub>0;\n   ?\\<tau> \\<le> (?hmax - ?y\\<^sub>0) / (?c\\<^sub>i - ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> ?hmin\n                    \\<le> (?c\\<^sub>i - ?c\\<^sub>o) \\<cdot> ?\\<tau> +\n                          ?y\\<^sub>0\n  \\<lbrakk>0 \\<le> ?\\<tau>; ?c\\<^sub>o < ?c\\<^sub>i; ?hmin \\<le> ?y\\<^sub>0;\n   ?\\<tau> \\<le> (?hmax - ?y\\<^sub>0) / (?c\\<^sub>i - ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> (?c\\<^sub>i - ?c\\<^sub>o) \\<cdot> ?\\<tau> + ?y\\<^sub>0\n                    \\<le> ?hmax\n  \\<lbrakk>0 \\<le> ?\\<tau>; 0 < ?c\\<^sub>o; ?y\\<^sub>0 \\<le> ?hmax;\n   ?\\<tau> \\<le> - ((?hmin - ?y\\<^sub>0) / ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> ?hmin \\<le> ?y\\<^sub>0 - ?c\\<^sub>o \\<cdot> ?\\<tau>\n  \\<lbrakk>0 \\<le> ?\\<tau>; 0 < ?c\\<^sub>o; ?y\\<^sub>0 \\<le> ?hmax;\n   ?\\<tau> \\<le> - ((?hmin - ?y\\<^sub>0) / ?c\\<^sub>o)\\<rbrakk>\n  \\<Longrightarrow> ?y\\<^sub>0 - ?c\\<^sub>o \\<cdot> ?\\<tau> \\<le> ?hmax\n  0 \\<le> \\<tau>\n  0 < c\\<^sub>o\n  c\\<^sub>o < c\\<^sub>i\n\ngoal (9 subgoals):\n 1. 2 ::= (\\<lambda>s. 0) \\<le> 2 ::= (\\<lambda>s. 0)\n 2. 3 ::= (\\<lambda>s. s $ 1) \\<le> 3 ::= (\\<lambda>s. s $ 1)\n 3. 4 ::= (\\<lambda>s. 1) \\<le> 4 ::= (\\<lambda>s. 1)\n 4. 4 ::= (\\<lambda>s. 0) \\<le> 4 ::= (\\<lambda>s. 0)\n 5. skip \\<le> skip\n 6. \\<lceil>\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (c\\<^sub>i - c\\<^sub>o)\\<rceil>\n 7. \\<lceil>\\<lambda>s.\n               dI hmin hmax (c\\<^sub>i - c\\<^sub>o) s \\<and>\n               G hmax (c\\<^sub>i - c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>\n 8. \\<lceil>\\<lambda>s.\n               s $ 4 \\<noteq> 0 \\<and>\n               I hmin hmax s \\<and> s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n    \\<le> \\<lceil>dI hmin hmax (- c\\<^sub>o)\\<rceil>\n 9. \\<lceil>\\<lambda>s.\n               dI hmin hmax (- c\\<^sub>o) s \\<and>\n               G hmin (- c\\<^sub>o) s\\<rceil>\n    \\<le> \\<lceil>I hmin hmax\\<rceil>", "by auto"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n             (IF (\\<lambda>s.\n                     s $ 4 = 0 \\<and>\n                     s $ 3\n                     \\<le> hmin +\n                           1) THEN (4 ::= (\\<lambda>s.\n        1)) ELSE IF (\\<lambda>s.\n                        s $ 4 = 1 \\<and>\n                        hmax - 1\n                        \\<le> s $\n                              3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n             Ref \\<lceil>\\<lambda>s.\n                            I hmin hmax s \\<and>\n                            s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "ultimately"], ["proof (chain)\npicking this:\n  LOOP (2 ::= (\\<lambda>s. 0)) ;\n       Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ;\n             Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n             Ref \\<lceil>\\<lambda>s.\n                            I hmin hmax s \\<and>\n                            s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n             (IF (\\<lambda>s.\n                     s $ 4 = 0 \\<and>\n                     s $ 3\n                     \\<le> hmin +\n                           1) THEN (4 ::= (\\<lambda>s.\n        1)) ELSE IF (\\<lambda>s.\n                        s $ 4 = 1 \\<and>\n                        hmax - 1\n                        \\<le> s $\n                              3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n             Ref \\<lceil>\\<lambda>s.\n                            I hmin hmax s \\<and>\n                            s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax", "show ?thesis"], ["proof (prove)\nusing this:\n  LOOP (2 ::= (\\<lambda>s. 0)) ;\n       Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ;\n             Ref \\<lceil>\\<lambda>s. I hmin hmax s \\<and> s $ 2 = 0\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       Ref \\<lceil>\\<lambda>s.\n                      I hmin hmax s \\<and>\n                      s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n        \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n             Ref \\<lceil>\\<lambda>s.\n                            I hmin hmax s \\<and>\n                            s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n  \\<le> LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n             (IF (\\<lambda>s.\n                     s $ 4 = 0 \\<and>\n                     s $ 3\n                     \\<le> hmin +\n                           1) THEN (4 ::= (\\<lambda>s.\n        1)) ELSE IF (\\<lambda>s.\n                        s $ 4 = 1 \\<and>\n                        hmax - 1\n                        \\<le> s $\n                              3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n             Ref \\<lceil>\\<lambda>s.\n                            I hmin hmax s \\<and>\n                            s $ 2 = 0 \\<and> s $ 3 = s $ 1\\<rceil>\n              \\<lceil>I hmin hmax\\<rceil> INV I hmin hmax \n\ngoal (1 subgoal):\n 1. LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n         (IF (\\<lambda>s.\n                 s $ 4 = 0 \\<and>\n                 s $ 3\n                 \\<le> hmin +\n                       1) THEN (4 ::= (\\<lambda>s.\n    1)) ELSE IF (\\<lambda>s.\n                    s $ 4 = 1 \\<and>\n                    hmax - 1\n                    \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n         dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n    \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>", "by auto"], ["proof (state)\nthis:\n  LOOP (2 ::= (\\<lambda>s. 0)) ; (3 ::= (\\<lambda>s. s $ 1)) ;\n       (IF (\\<lambda>s.\n               s $ 4 = 0 \\<and>\n               s $ 3\n               \\<le> hmin +\n                     1) THEN (4 ::= (\\<lambda>s.\n  1)) ELSE IF (\\<lambda>s.\n                  s $ 4 = 1 \\<and>\n                  hmax - 1\n                  \\<le> s $ 3) THEN (4 ::= (\\<lambda>s. 0)) ELSE skip) ;\n       dyn c\\<^sub>i c\\<^sub>o hmin hmax \\<tau> INV I hmin hmax \n  \\<le> Ref \\<lceil>I hmin hmax\\<rceil> \\<lceil>I hmin hmax\\<rceil>\n\ngoal:\nNo subgoals!", "qed"], ["", "no_notation tank_vec_field (\"f\")\n        and tank_flow (\"\\<phi>\")\n        and tank_guard (\"G\")\n        and tank_loop_inv (\"I\")\n        and tank_diff_inv (\"dI\")"], ["", "end"]]}