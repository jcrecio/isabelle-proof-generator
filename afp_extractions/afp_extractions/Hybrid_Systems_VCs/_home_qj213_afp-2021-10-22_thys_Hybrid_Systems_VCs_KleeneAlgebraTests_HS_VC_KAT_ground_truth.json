{"file_name": "/home/qj213/afp-2021-10-22/thys/Hybrid_Systems_VCs/KleeneAlgebraTests/HS_VC_KAT.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Hybrid_Systems_VCs", "problem_names": ["lemma H_consl: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p' \\<Longrightarrow> H p' x q \\<Longrightarrow> H p x q\"", "lemma H_consr: \"\\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H p x q' \\<Longrightarrow> H p x q\"", "lemma H_cons: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p' \\<Longrightarrow> \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H p' x q' \\<Longrightarrow> H p x q\"", "lemma H_skip:  \"H p 1 p\"", "lemma H_abort: \"H p 0 q\"", "lemma H_seq: \"H p x r \\<Longrightarrow> H r y q \\<Longrightarrow> H p (x \\<cdot> y) q\"", "lemma H_choice: \"H p x q \\<Longrightarrow> H p y q \\<Longrightarrow> H p (x + y) q\"", "lemma H_var: \"H p x q \\<longleftrightarrow> \\<tt>\\<tt> p \\<cdot> x \\<cdot> n q = 0\"", "lemma H_cond_iff: \"H p (if r then x else y) q \\<longleftrightarrow> H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and> H (\\<tt>\\<tt> p \\<cdot> n r) y q\"", "lemma H_cond: \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<Longrightarrow> H (\\<tt>\\<tt> p \\<cdot> n r) y q \\<Longrightarrow> H p (if r then x else y) q\"", "lemma H_exp1: \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<Longrightarrow> H p (\\<tt>\\<tt> r \\<cdot> x) q\"", "lemma H_while: \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p \\<Longrightarrow> H p (while r do x) (\\<tt>\\<tt> p \\<cdot> n r)\"", "lemma H_while_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> \\<tt>\\<tt> i \\<cdot> n r \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H (\\<tt>\\<tt> i \\<cdot> \\<tt>\\<tt> r) x i \\<Longrightarrow> H p (while r inv i do x) q\"", "lemma H_star: \"H i x i \\<Longrightarrow> H i (x\\<^sup>\\<star>) i\"", "lemma H_star_inv: \n  assumes \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i\" and \"H i x i\" and \"(\\<tt>\\<tt> i) \\<le> (\\<tt>\\<tt> q)\"\n  shows \"H p (x\\<^sup>\\<star>) q\"", "lemma H_loop: \"H p x p \\<Longrightarrow> H p (loop x inv i) p\"", "lemma H_loop_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> H i x i \\<Longrightarrow> \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H p (loop x inv i) q\"", "lemma H_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H i x i \\<Longrightarrow> H p x q\"", "lemma H_inv_plus: \"\\<tt>\\<tt> i = i \\<Longrightarrow> \\<tt>\\<tt> j = j \\<Longrightarrow> H i x i \\<Longrightarrow>  H j x j \\<Longrightarrow>  H (i + j) x (i + j)\"", "lemma H_inv_mult: \"\\<tt>\\<tt> i = i \\<Longrightarrow> \\<tt>\\<tt> j = j \\<Longrightarrow> H i x i \\<Longrightarrow>  H j x j \\<Longrightarrow>  H (i \\<cdot> j) x (i \\<cdot> j)\"", "lemma R1: \"H p (Ref p q) q\"", "lemma R2: \"H p x q \\<Longrightarrow> x \\<le> Ref p q\"", "lemma R_cons: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p' \\<Longrightarrow> \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q \\<Longrightarrow> Ref p' q' \\<le> Ref p q\"", "lemma R_skip: \"1 \\<le> Ref p p\"", "lemma R_zero_one: \"x \\<le> Ref 0 1\"", "lemma R_one_zero: \"Ref 1 0 = 0\"", "lemma R_abort: \"0 \\<le> Ref p q\"", "lemma R_seq: \"(Ref p r) \\<cdot> (Ref r q) \\<le> Ref p q\"", "lemma R_choice: \"(Ref p q) + (Ref p q) \\<le> Ref p q\"", "lemma R_cond: \"if v then (Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) q) else (Ref (n v \\<cdot> \\<tt>\\<tt> p) q) \\<le> Ref p q\"", "lemma R_while: \"while q do (Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p) \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> n q)\"", "lemma R_star: \"(Ref i i)\\<^sup>\\<star> \\<le> Ref i i\"", "lemma R_loop: \"loop (Ref p p) inv i \\<le> Ref p p\"", "lemma R_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q \\<Longrightarrow> Ref i i \\<le> Ref p q\""], "translations": [["", "lemma H_consl: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p' \\<Longrightarrow> H p' x q \\<Longrightarrow> H p x q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p'; H p' x q\\<rbrakk>\n    \\<Longrightarrow> H p x q", "using Hoare_def phl_cons1"], ["proof (prove)\nusing this:\n  H ?p ?x ?q =\n  \\<lparr>\\<tt>\\<tt> ?p\\<rparr>?x\\<lparr>?x \\<cdot> \\<tt>\\<tt> ?q\\<rparr>\n  \\<lbrakk>?x \\<le> ?w;\n   \\<lparr>?w\\<rparr>?y\\<lparr>?y \\<cdot> ?z\\<rparr>\\<rbrakk>\n  \\<Longrightarrow> \\<lparr>?x\\<rparr>?y\\<lparr>?y \\<cdot> ?z\\<rparr>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p'; H p' x q\\<rbrakk>\n    \\<Longrightarrow> H p x q", "by blast"], ["", "lemma H_consr: \"\\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H p x q' \\<Longrightarrow> H p x q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q; H p x q'\\<rbrakk>\n    \\<Longrightarrow> H p x q", "using Hoare_def phl_cons2"], ["proof (prove)\nusing this:\n  H ?p ?x ?q =\n  \\<lparr>\\<tt>\\<tt> ?p\\<rparr>?x\\<lparr>?x \\<cdot> \\<tt>\\<tt> ?q\\<rparr>\n  \\<lbrakk>?w \\<le> ?x;\n   \\<lparr>?z\\<rparr>?y\\<lparr>?y \\<cdot> ?w\\<rparr>\\<rbrakk>\n  \\<Longrightarrow> \\<lparr>?z\\<rparr>?y\\<lparr>?y \\<cdot> ?x\\<rparr>\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q; H p x q'\\<rbrakk>\n    \\<Longrightarrow> H p x q", "by blast"], ["", "lemma H_cons: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p' \\<Longrightarrow> \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H p' x q' \\<Longrightarrow> H p x q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p';\n     \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q; H p' x q'\\<rbrakk>\n    \\<Longrightarrow> H p x q", "by (simp add: H_consl H_consr)\n\n\\<comment> \\<open> Skip \\<close>"], ["", "lemma H_skip:  \"H p 1 p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (1::'a) p", "by (simp add: Hoare_def)\n\n\\<comment> \\<open> Abort \\<close>"], ["", "lemma H_abort: \"H p 0 q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (0::'a) q", "by (simp add: Hoare_def)\n\n\\<comment> \\<open> Sequential composition \\<close>"], ["", "lemma H_seq: \"H p x r \\<Longrightarrow> H r y q \\<Longrightarrow> H p (x \\<cdot> y) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>H p x r; H r y q\\<rbrakk> \\<Longrightarrow> H p (x \\<cdot> y) q", "by (simp add: Hoare_def phl_seq)\n\n\\<comment> \\<open> Nondeterministic choice \\<close>"], ["", "lemma H_choice: \"H p x q \\<Longrightarrow> H p y q \\<Longrightarrow> H p (x + y) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>H p x q; H p y q\\<rbrakk> \\<Longrightarrow> H p (x + y) q", "using local.distrib_left local.join.sup.mono"], ["proof (prove)\nusing this:\n  ?a \\<cdot> (?b + ?c) = ?a \\<cdot> ?b + ?a \\<cdot> ?c\n  \\<lbrakk>?c \\<le> ?a; ?d \\<le> ?b\\<rbrakk>\n  \\<Longrightarrow> ?c + ?d \\<le> ?a + ?b\n\ngoal (1 subgoal):\n 1. \\<lbrakk>H p x q; H p y q\\<rbrakk> \\<Longrightarrow> H p (x + y) q", "by (auto simp: Hoare_def)\n\n\\<comment> \\<open> Conditional statement \\<close>"], ["", "definition kat_cond :: \"'a \\<Rightarrow> 'a \\<Rightarrow> 'a \\<Rightarrow> 'a\" (\"if _ then _ else _\" [64,64,64] 63) where\n  \"if p then x else y = (\\<tt>\\<tt> p \\<cdot> x + n p \\<cdot> y)\""], ["", "lemma H_var: \"H p x q \\<longleftrightarrow> \\<tt>\\<tt> p \\<cdot> x \\<cdot> n q = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p x q = (\\<tt>\\<tt> p \\<cdot> x \\<cdot> !q = (0::'a))", "by (metis Hoare_def n_kat_3 t_n_closed)"], ["", "lemma H_cond_iff: \"H p (if r then x else y) q \\<longleftrightarrow> H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and> H (\\<tt>\\<tt> p \\<cdot> n r) y q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "have \"H p (if r then x else y) q \\<longleftrightarrow> \\<tt>\\<tt> p \\<cdot> (\\<tt>\\<tt> r \\<cdot> x + n r \\<cdot> y) \\<cdot> n q = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (\\<tt>\\<tt> p \\<cdot> (\\<tt>\\<tt> r \\<cdot> x + !r \\<cdot> y) \\<cdot>\n     !q =\n     (0::'a))", "by (simp add: H_var kat_cond_def)"], ["proof (state)\nthis:\n  H p (if r then x else y) q =\n  (\\<tt>\\<tt> p \\<cdot> (\\<tt>\\<tt> r \\<cdot> x + !r \\<cdot> y) \\<cdot> !q =\n   (0::'a))\n\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "also"], ["proof (state)\nthis:\n  H p (if r then x else y) q =\n  (\\<tt>\\<tt> p \\<cdot> (\\<tt>\\<tt> r \\<cdot> x + !r \\<cdot> y) \\<cdot> !q =\n   (0::'a))\n\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "have \"... \\<longleftrightarrow> \\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> n q + \\<tt>\\<tt> p \\<cdot> n r \\<cdot> y \\<cdot> n q = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<tt>\\<tt> p \\<cdot> (\\<tt>\\<tt> r \\<cdot> x + !r \\<cdot> y) \\<cdot>\n     !q =\n     (0::'a)) =\n    (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q +\n     \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q =\n     (0::'a))", "by (simp add: distrib_left mult_assoc)"], ["proof (state)\nthis:\n  (\\<tt>\\<tt> p \\<cdot> (\\<tt>\\<tt> r \\<cdot> x + !r \\<cdot> y) \\<cdot> !q =\n   (0::'a)) =\n  (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q +\n   \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q =\n   (0::'a))\n\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "also"], ["proof (state)\nthis:\n  (\\<tt>\\<tt> p \\<cdot> (\\<tt>\\<tt> r \\<cdot> x + !r \\<cdot> y) \\<cdot> !q =\n   (0::'a)) =\n  (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q +\n   \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q =\n   (0::'a))\n\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "have \"... \\<longleftrightarrow> \\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> n q = 0 \\<and> \\<tt>\\<tt> p \\<cdot> n r \\<cdot> y \\<cdot> n q = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q +\n     \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q =\n     (0::'a)) =\n    (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q = (0::'a) \\<and>\n     \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q = (0::'a))", "by (metis add_0_left no_trivial_inverse)"], ["proof (state)\nthis:\n  (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q +\n   \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q =\n   (0::'a)) =\n  (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q = (0::'a) \\<and>\n   \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q = (0::'a))\n\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "finally"], ["proof (chain)\npicking this:\n  H p (if r then x else y) q =\n  (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q = (0::'a) \\<and>\n   \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q = (0::'a))", "show ?thesis"], ["proof (prove)\nusing this:\n  H p (if r then x else y) q =\n  (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r \\<cdot> x \\<cdot> !q = (0::'a) \\<and>\n   \\<tt>\\<tt> p \\<cdot> !r \\<cdot> y \\<cdot> !q = (0::'a))\n\ngoal (1 subgoal):\n 1. H p (if r then x else y) q =\n    (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q)", "by (metis H_var test_mult)"], ["proof (state)\nthis:\n  H p (if r then x else y) q =\n  (H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<and>\n   H (\\<tt>\\<tt> p \\<cdot> !r) y q)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma H_cond: \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<Longrightarrow> H (\\<tt>\\<tt> p \\<cdot> n r) y q \\<Longrightarrow> H p (if r then x else y) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q;\n     H (\\<tt>\\<tt> p \\<cdot> !r) y q\\<rbrakk>\n    \\<Longrightarrow> H p (if r then x else y) q", "by (simp add: H_cond_iff)\n\n\\<comment> \\<open> While loop \\<close>"], ["", "definition kat_while :: \"'a \\<Rightarrow> 'a \\<Rightarrow> 'a\" (\"while _ do _\" [64,64] 63) where\n  \"while b do x = (\\<tt>\\<tt> b \\<cdot> x)\\<^sup>\\<star> \\<cdot> n b\""], ["", "definition kat_while_inv :: \"'a \\<Rightarrow> 'a \\<Rightarrow> 'a \\<Rightarrow> 'a\" (\"while _ inv _ do _\" [64,64,64] 63) where\n  \"while p inv i do x = while p do x\""], ["", "lemma H_exp1: \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<Longrightarrow> H p (\\<tt>\\<tt> r \\<cdot> x) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<Longrightarrow>\n    H p (\\<tt>\\<tt> r \\<cdot> x) q", "using Hoare_def n_de_morgan_var2 phl.ht_at_phl_export1"], ["proof (prove)\nusing this:\n  H ?p ?x ?q =\n  \\<lparr>\\<tt>\\<tt> ?p\\<rparr>?x\\<lparr>?x \\<cdot> \\<tt>\\<tt> ?q\\<rparr>\n  !(!?x + !?y) = \\<tt>\\<tt> ?x \\<cdot> \\<tt>\\<tt> ?y\n  \\<lparr>\\<tt>\\<tt> ?x \\<cdot>\n          \\<tt>\\<tt>\n           ?y\\<rparr>?z\\<lparr>?z \\<cdot> ?w\\<rparr> \\<Longrightarrow>\n  \\<lparr>\\<tt>\\<tt>\n           ?x\\<rparr>\\<tt>\\<tt> ?y \\<cdot>\n                     ?z\\<lparr>\\<tt>\\<tt> ?y \\<cdot> ?z \\<cdot> ?w\\<rparr>\n\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x q \\<Longrightarrow>\n    H p (\\<tt>\\<tt> r \\<cdot> x) q", "by auto"], ["", "lemma H_while: \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p \\<Longrightarrow> H p (while r do x) (\\<tt>\\<tt> p \\<cdot> n r)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p \\<Longrightarrow>\n    H p (while r do x) (\\<tt>\\<tt> p \\<cdot> !r)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p \\<Longrightarrow>\n    H p (while r do x) (\\<tt>\\<tt> p \\<cdot> !r)", "assume a1: \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p\""], ["proof (state)\nthis:\n  H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p\n\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p \\<Longrightarrow>\n    H p (while r do x) (\\<tt>\\<tt> p \\<cdot> !r)", "have \"\\<tt>\\<tt> (\\<tt>\\<tt> p \\<cdot> n r) = n r \\<cdot> \\<tt>\\<tt> p \\<cdot> n r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<tt>\\<tt> (\\<tt>\\<tt> p \\<cdot> !r) =\n    !r \\<cdot> \\<tt>\\<tt> p \\<cdot> !r", "using n_preserve test_mult"], ["proof (prove)\nusing this:\n  !?x \\<cdot> !?y \\<cdot> !?x = !?y \\<cdot> !?x\n  \\<tt>\\<tt> (!?x \\<cdot> !?y) = !?x \\<cdot> !?y\n\ngoal (1 subgoal):\n 1. \\<tt>\\<tt> (\\<tt>\\<tt> p \\<cdot> !r) =\n    !r \\<cdot> \\<tt>\\<tt> p \\<cdot> !r", "by presburger"], ["proof (state)\nthis:\n  \\<tt>\\<tt> (\\<tt>\\<tt> p \\<cdot> !r) = !r \\<cdot> \\<tt>\\<tt> p \\<cdot> !r\n\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p \\<Longrightarrow>\n    H p (while r do x) (\\<tt>\\<tt> p \\<cdot> !r)", "then"], ["proof (chain)\npicking this:\n  \\<tt>\\<tt> (\\<tt>\\<tt> p \\<cdot> !r) = !r \\<cdot> \\<tt>\\<tt> p \\<cdot> !r", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<tt>\\<tt> (\\<tt>\\<tt> p \\<cdot> !r) = !r \\<cdot> \\<tt>\\<tt> p \\<cdot> !r\n\ngoal (1 subgoal):\n 1. H p (while r do x) (\\<tt>\\<tt> p \\<cdot> !r)", "using a1 Hoare_def H_exp1 conway.phl.it_simr phl_export2 kat_while_def"], ["proof (prove)\nusing this:\n  \\<tt>\\<tt> (\\<tt>\\<tt> p \\<cdot> !r) = !r \\<cdot> \\<tt>\\<tt> p \\<cdot> !r\n  H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> r) x p\n  H ?p ?x ?q =\n  \\<lparr>\\<tt>\\<tt> ?p\\<rparr>?x\\<lparr>?x \\<cdot> \\<tt>\\<tt> ?q\\<rparr>\n  H (\\<tt>\\<tt> ?p \\<cdot> \\<tt>\\<tt> ?r) ?x ?q \\<Longrightarrow>\n  H ?p (\\<tt>\\<tt> ?r \\<cdot> ?x) ?q\n  \\<lparr>?y\\<rparr>?x\\<lparr>?x \\<cdot> ?y\\<rparr> \\<Longrightarrow>\n  \\<lparr>?y\\<rparr>?x\\<^sup>\\<star>\\<lparr>?x\\<^sup>\\<star> \\<cdot>\n      ?y\\<rparr>\n  \\<lbrakk>\\<lparr>?z\\<rparr>?w\\<lparr>?w \\<cdot> ?z \\<cdot> ?w\\<rparr>;\n   \\<lparr>?x\\<rparr>?y\\<lparr>?y \\<cdot> ?z\\<rparr>\\<rbrakk>\n  \\<Longrightarrow> \\<lparr>?x\\<rparr>?y \\<cdot>\n?w\\<lparr>?y \\<cdot> ?w \\<cdot> (?z \\<cdot> ?w)\\<rparr>\n  while ?b do ?x = (\\<tt>\\<tt> ?b \\<cdot> ?x)\\<^sup>\\<star> \\<cdot> !?b\n\ngoal (1 subgoal):\n 1. H p (while r do x) (\\<tt>\\<tt> p \\<cdot> !r)", "by auto"], ["proof (state)\nthis:\n  H p (while r do x) (\\<tt>\\<tt> p \\<cdot> !r)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma H_while_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> \\<tt>\\<tt> i \\<cdot> n r \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H (\\<tt>\\<tt> i \\<cdot> \\<tt>\\<tt> r) x i \\<Longrightarrow> H p (while r inv i do x) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i;\n     \\<lparr>\\<tt>\\<tt> i\\<rparr>!r\\<lparr>\\<tt>\\<tt> q\\<rparr>;\n     H (\\<tt>\\<tt> i \\<cdot> \\<tt>\\<tt> r) x i\\<rbrakk>\n    \\<Longrightarrow> H p (while r inv i do x) q", "by (metis H_cons H_while test_mult kat_while_inv_def)\n\n\\<comment> \\<open> Finite iteration \\<close>"], ["", "lemma H_star: \"H i x i \\<Longrightarrow> H i (x\\<^sup>\\<star>) i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H i x i \\<Longrightarrow> H i (x\\<^sup>\\<star>) i", "unfolding Hoare_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lparr>\\<tt>\\<tt>\n             i\\<rparr>x\\<lparr>x \\<cdot>\n                               \\<tt>\\<tt> i\\<rparr> \\<Longrightarrow>\n    \\<lparr>\\<tt>\\<tt>\n             i\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n       \\<tt>\\<tt> i\\<rparr>", "using star_sim2"], ["proof (prove)\nusing this:\n  \\<lparr>?z\\<rparr>?x\\<lparr>?y \\<cdot> ?z\\<rparr> \\<Longrightarrow>\n  \\<lparr>?z\\<rparr>?x\\<^sup>\\<star>\\<lparr>?y\\<^sup>\\<star> \\<cdot>\n      ?z\\<rparr>\n\ngoal (1 subgoal):\n 1. \\<lparr>\\<tt>\\<tt>\n             i\\<rparr>x\\<lparr>x \\<cdot>\n                               \\<tt>\\<tt> i\\<rparr> \\<Longrightarrow>\n    \\<lparr>\\<tt>\\<tt>\n             i\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n       \\<tt>\\<tt> i\\<rparr>", "by blast"], ["", "lemma H_star_inv: \n  assumes \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i\" and \"H i x i\" and \"(\\<tt>\\<tt> i) \\<le> (\\<tt>\\<tt> q)\"\n  shows \"H p (x\\<^sup>\\<star>) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (x\\<^sup>\\<star>) q", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. H p (x\\<^sup>\\<star>) q", "have \"H i (x\\<^sup>\\<star>) i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H i (x\\<^sup>\\<star>) i", "using assms(2) H_star"], ["proof (prove)\nusing this:\n  H i x i\n  H ?i ?x ?i \\<Longrightarrow> H ?i (?x\\<^sup>\\<star>) ?i\n\ngoal (1 subgoal):\n 1. H i (x\\<^sup>\\<star>) i", "by blast"], ["proof (state)\nthis:\n  H i (x\\<^sup>\\<star>) i\n\ngoal (1 subgoal):\n 1. H p (x\\<^sup>\\<star>) q", "hence \"H p (x\\<^sup>\\<star>) i\""], ["proof (prove)\nusing this:\n  H i (x\\<^sup>\\<star>) i\n\ngoal (1 subgoal):\n 1. H p (x\\<^sup>\\<star>) i", "unfolding Hoare_def"], ["proof (prove)\nusing this:\n  \\<lparr>\\<tt>\\<tt>\n           i\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n     \\<tt>\\<tt> i\\<rparr>\n\ngoal (1 subgoal):\n 1. \\<lparr>\\<tt>\\<tt>\n             p\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n       \\<tt>\\<tt> i\\<rparr>", "using assms(1) phl_cons1"], ["proof (prove)\nusing this:\n  \\<lparr>\\<tt>\\<tt>\n           i\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n     \\<tt>\\<tt> i\\<rparr>\n  \\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i\n  \\<lbrakk>?x \\<le> ?w;\n   \\<lparr>?w\\<rparr>?y\\<lparr>?y \\<cdot> ?z\\<rparr>\\<rbrakk>\n  \\<Longrightarrow> \\<lparr>?x\\<rparr>?y\\<lparr>?y \\<cdot> ?z\\<rparr>\n\ngoal (1 subgoal):\n 1. \\<lparr>\\<tt>\\<tt>\n             p\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n       \\<tt>\\<tt> i\\<rparr>", "by blast"], ["proof (state)\nthis:\n  H p (x\\<^sup>\\<star>) i\n\ngoal (1 subgoal):\n 1. H p (x\\<^sup>\\<star>) q", "thus ?thesis"], ["proof (prove)\nusing this:\n  H p (x\\<^sup>\\<star>) i\n\ngoal (1 subgoal):\n 1. H p (x\\<^sup>\\<star>) q", "unfolding Hoare_def"], ["proof (prove)\nusing this:\n  \\<lparr>\\<tt>\\<tt>\n           p\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n     \\<tt>\\<tt> i\\<rparr>\n\ngoal (1 subgoal):\n 1. \\<lparr>\\<tt>\\<tt>\n             p\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n       \\<tt>\\<tt> q\\<rparr>", "using assms(3) phl_cons2"], ["proof (prove)\nusing this:\n  \\<lparr>\\<tt>\\<tt>\n           p\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n     \\<tt>\\<tt> i\\<rparr>\n  \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q\n  \\<lbrakk>?w \\<le> ?x;\n   \\<lparr>?z\\<rparr>?y\\<lparr>?y \\<cdot> ?w\\<rparr>\\<rbrakk>\n  \\<Longrightarrow> \\<lparr>?z\\<rparr>?y\\<lparr>?y \\<cdot> ?x\\<rparr>\n\ngoal (1 subgoal):\n 1. \\<lparr>\\<tt>\\<tt>\n             p\\<rparr>x\\<^sup>\\<star>\\<lparr>x\\<^sup>\\<star> \\<cdot>\n       \\<tt>\\<tt> q\\<rparr>", "by blast"], ["proof (state)\nthis:\n  H p (x\\<^sup>\\<star>) q\n\ngoal:\nNo subgoals!", "qed"], ["", "definition kat_loop_inv :: \"'a \\<Rightarrow> 'a \\<Rightarrow> 'a\" (\"loop _ inv _ \" [64,64] 63)\n  where \"loop x inv i = x\\<^sup>\\<star>\""], ["", "lemma H_loop: \"H p x p \\<Longrightarrow> H p (loop x inv i) p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p x p \\<Longrightarrow> H p (loop x inv i ) p", "unfolding kat_loop_inv_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. H p x p \\<Longrightarrow> H p (x\\<^sup>\\<star>) p", "by (rule H_star)"], ["", "lemma H_loop_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> H i x i \\<Longrightarrow> \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H p (loop x inv i) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i; H i x i;\n     \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> H p (loop x inv i ) q", "unfolding kat_loop_inv_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i; H i x i;\n     \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> H p (x\\<^sup>\\<star>) q", "using H_star_inv"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<tt>\\<tt> ?p \\<le> \\<tt>\\<tt> ?i; H ?i ?x ?i;\n   \\<tt>\\<tt> ?i \\<le> \\<tt>\\<tt> ?q\\<rbrakk>\n  \\<Longrightarrow> H ?p (?x\\<^sup>\\<star>) ?q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i; H i x i;\n     \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> H p (x\\<^sup>\\<star>) q", "by blast\n\n\\<comment> \\<open> Invariants \\<close>"], ["", "lemma H_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q \\<Longrightarrow> H i x i \\<Longrightarrow> H p x q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i;\n     \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q; H i x i\\<rbrakk>\n    \\<Longrightarrow> H p x q", "by (rule_tac p'=i and q'=i in H_cons)"], ["", "lemma H_inv_plus: \"\\<tt>\\<tt> i = i \\<Longrightarrow> \\<tt>\\<tt> j = j \\<Longrightarrow> H i x i \\<Longrightarrow>  H j x j \\<Longrightarrow>  H (i + j) x (i + j)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> i = i; \\<tt>\\<tt> j = j; H i x i; H j x j\\<rbrakk>\n    \\<Longrightarrow> H (i + j) x (i + j)", "unfolding Hoare_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> i = i; \\<tt>\\<tt> j = j;\n     \\<lparr>\\<tt>\\<tt> i\\<rparr>x\\<lparr>x \\<cdot> \\<tt>\\<tt> i\\<rparr>;\n     \\<lparr>\\<tt>\\<tt>\n              j\\<rparr>x\\<lparr>x \\<cdot> \\<tt>\\<tt> j\\<rparr>\\<rbrakk>\n    \\<Longrightarrow> \\<lparr>\\<tt>\\<tt>\n                               (i +\n                                j)\\<rparr>x\\<lparr>x \\<cdot>\n             \\<tt>\\<tt> (i + j)\\<rparr>", "using combine_common_factor"], ["proof (prove)\nusing this:\n  ?a \\<cdot> ?e + (?b \\<cdot> ?e + ?c) = (?a + ?b) \\<cdot> ?e + ?c\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> i = i; \\<tt>\\<tt> j = j;\n     \\<lparr>\\<tt>\\<tt> i\\<rparr>x\\<lparr>x \\<cdot> \\<tt>\\<tt> i\\<rparr>;\n     \\<lparr>\\<tt>\\<tt>\n              j\\<rparr>x\\<lparr>x \\<cdot> \\<tt>\\<tt> j\\<rparr>\\<rbrakk>\n    \\<Longrightarrow> \\<lparr>\\<tt>\\<tt>\n                               (i +\n                                j)\\<rparr>x\\<lparr>x \\<cdot>\n             \\<tt>\\<tt> (i + j)\\<rparr>", "by (smt add_commute add.left_commute distrib_left join.sup.absorb_iff1 t_add_closed)"], ["", "lemma H_inv_mult: \"\\<tt>\\<tt> i = i \\<Longrightarrow> \\<tt>\\<tt> j = j \\<Longrightarrow> H i x i \\<Longrightarrow>  H j x j \\<Longrightarrow>  H (i \\<cdot> j) x (i \\<cdot> j)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> i = i; \\<tt>\\<tt> j = j; H i x i; H j x j\\<rbrakk>\n    \\<Longrightarrow> H (i \\<cdot> j) x (i \\<cdot> j)", "unfolding Hoare_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> i = i; \\<tt>\\<tt> j = j;\n     \\<lparr>\\<tt>\\<tt> i\\<rparr>x\\<lparr>x \\<cdot> \\<tt>\\<tt> i\\<rparr>;\n     \\<lparr>\\<tt>\\<tt>\n              j\\<rparr>x\\<lparr>x \\<cdot> \\<tt>\\<tt> j\\<rparr>\\<rbrakk>\n    \\<Longrightarrow> \\<lparr>\\<tt>\\<tt>\n                               (i \\<cdot>\n                                j)\\<rparr>x\\<lparr>x \\<cdot>\n             \\<tt>\\<tt> (i \\<cdot> j)\\<rparr>", "by (smt n_kat_2 n_mult_comm t_mult_closure mult_assoc)"], ["", "end"], ["", "subsection \\<open> refinement KAT \\<close>"], ["", "text \\<open> Here we derive the laws of the refinement calculus. \\<close>"], ["", "class rkat = kat +\n  fixes Ref :: \"'a \\<Rightarrow> 'a \\<Rightarrow> 'a\"\n  assumes spec_def:  \"x \\<le> Ref p q \\<longleftrightarrow> H p x q\"\n\nbegin"], ["", "(* mostly by Victor Gomes, Georg Struth *)"], ["", "lemma R1: \"H p (Ref p q) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (Ref p q) q", "using spec_def"], ["proof (prove)\nusing this:\n  (?x \\<le> Ref ?p ?q) = H ?p ?x ?q\n\ngoal (1 subgoal):\n 1. H p (Ref p q) q", "by blast"], ["", "lemma R2: \"H p x q \\<Longrightarrow> x \\<le> Ref p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p x q \\<Longrightarrow> x \\<le> Ref p q", "by (simp add: spec_def)"], ["", "lemma R_cons: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p' \\<Longrightarrow> \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q \\<Longrightarrow> Ref p' q' \\<le> Ref p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p';\n     \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> Ref p' q' \\<le> Ref p q", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p';\n     \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> Ref p' q' \\<le> Ref p q", "assume h1: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p'\" and h2: \"\\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\""], ["proof (state)\nthis:\n  \\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p'\n  \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p';\n     \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> Ref p' q' \\<le> Ref p q", "have \"H p' (Ref p' q') q'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p' (Ref p' q') q'", "by (simp add: R1)"], ["proof (state)\nthis:\n  H p' (Ref p' q') q'\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p';\n     \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> Ref p' q' \\<le> Ref p q", "hence \"H p (Ref p' q') q\""], ["proof (prove)\nusing this:\n  H p' (Ref p' q') q'\n\ngoal (1 subgoal):\n 1. H p (Ref p' q') q", "using h1 h2 H_consl H_consr"], ["proof (prove)\nusing this:\n  H p' (Ref p' q') q'\n  \\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p'\n  \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\n  \\<lbrakk>\\<tt>\\<tt> ?p \\<le> \\<tt>\\<tt> ?p'; H ?p' ?x ?q\\<rbrakk>\n  \\<Longrightarrow> H ?p ?x ?q\n  \\<lbrakk>\\<tt>\\<tt> ?q' \\<le> \\<tt>\\<tt> ?q; H ?p ?x ?q'\\<rbrakk>\n  \\<Longrightarrow> H ?p ?x ?q\n\ngoal (1 subgoal):\n 1. H p (Ref p' q') q", "by blast"], ["proof (state)\nthis:\n  H p (Ref p' q') q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> p';\n     \\<tt>\\<tt> q' \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> Ref p' q' \\<le> Ref p q", "thus ?thesis"], ["proof (prove)\nusing this:\n  H p (Ref p' q') q\n\ngoal (1 subgoal):\n 1. Ref p' q' \\<le> Ref p q", "by (rule R2)"], ["proof (state)\nthis:\n  Ref p' q' \\<le> Ref p q\n\ngoal:\nNo subgoals!", "qed\n\n\\<comment> \\<open> Skip \\<close>"], ["", "lemma R_skip: \"1 \\<le> Ref p p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (1::'a) \\<le> Ref p p", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (1::'a) \\<le> Ref p p", "have \"H p 1 p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (1::'a) p", "by (simp add: H_skip)"], ["proof (state)\nthis:\n  H p (1::'a) p\n\ngoal (1 subgoal):\n 1. (1::'a) \\<le> Ref p p", "thus ?thesis"], ["proof (prove)\nusing this:\n  H p (1::'a) p\n\ngoal (1 subgoal):\n 1. (1::'a) \\<le> Ref p p", "by (rule R2)"], ["proof (state)\nthis:\n  (1::'a) \\<le> Ref p p\n\ngoal:\nNo subgoals!", "qed\n\n\\<comment> \\<open> Abort \\<close>"], ["", "lemma R_zero_one: \"x \\<le> Ref 0 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<le> Ref (0::'a) (1::'a)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. x \\<le> Ref (0::'a) (1::'a)", "have \"H 0 x 1\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H (0::'a) x (1::'a)", "by (simp add: Hoare_def)"], ["proof (state)\nthis:\n  H (0::'a) x (1::'a)\n\ngoal (1 subgoal):\n 1. x \\<le> Ref (0::'a) (1::'a)", "thus ?thesis"], ["proof (prove)\nusing this:\n  H (0::'a) x (1::'a)\n\ngoal (1 subgoal):\n 1. x \\<le> Ref (0::'a) (1::'a)", "by (rule R2)"], ["proof (state)\nthis:\n  x \\<le> Ref (0::'a) (1::'a)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma R_one_zero: \"Ref 1 0 = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Ref (1::'a) (0::'a) = (0::'a)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Ref (1::'a) (0::'a) = (0::'a)", "have \"H 1 (Ref 1 0) 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H (1::'a) (Ref (1::'a) (0::'a)) (0::'a)", "by (simp add: R1)"], ["proof (state)\nthis:\n  H (1::'a) (Ref (1::'a) (0::'a)) (0::'a)\n\ngoal (1 subgoal):\n 1. Ref (1::'a) (0::'a) = (0::'a)", "thus ?thesis"], ["proof (prove)\nusing this:\n  H (1::'a) (Ref (1::'a) (0::'a)) (0::'a)\n\ngoal (1 subgoal):\n 1. Ref (1::'a) (0::'a) = (0::'a)", "by (simp add: Hoare_def join.le_bot)"], ["proof (state)\nthis:\n  Ref (1::'a) (0::'a) = (0::'a)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma R_abort: \"0 \\<le> Ref p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (0::'a) \\<le> Ref p q", "using bot_least"], ["proof (prove)\nusing this:\n  bot \\<le> ?a\n\ngoal (1 subgoal):\n 1. (0::'a) \\<le> Ref p q", "by force\n\n\\<comment> \\<open> Sequential composition \\<close>"], ["", "lemma R_seq: \"(Ref p r) \\<cdot> (Ref r q) \\<le> Ref p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lparr>Ref p r\\<rparr>Ref r q\\<lparr>Ref p q\\<rparr>", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<lparr>Ref p r\\<rparr>Ref r q\\<lparr>Ref p q\\<rparr>", "have \"H p (Ref p r) r\" and \"H r (Ref r q) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (Ref p r) r &&& H r (Ref r q) q", "by (simp add: R1)+"], ["proof (state)\nthis:\n  H p (Ref p r) r\n  H r (Ref r q) q\n\ngoal (1 subgoal):\n 1. \\<lparr>Ref p r\\<rparr>Ref r q\\<lparr>Ref p q\\<rparr>", "hence \"H p ((Ref p r) \\<cdot> (Ref r q)) q\""], ["proof (prove)\nusing this:\n  H p (Ref p r) r\n  H r (Ref r q) q\n\ngoal (1 subgoal):\n 1. H p (Ref p r \\<cdot> Ref r q) q", "by (rule H_seq)"], ["proof (state)\nthis:\n  H p (Ref p r \\<cdot> Ref r q) q\n\ngoal (1 subgoal):\n 1. \\<lparr>Ref p r\\<rparr>Ref r q\\<lparr>Ref p q\\<rparr>", "thus ?thesis"], ["proof (prove)\nusing this:\n  H p (Ref p r \\<cdot> Ref r q) q\n\ngoal (1 subgoal):\n 1. \\<lparr>Ref p r\\<rparr>Ref r q\\<lparr>Ref p q\\<rparr>", "by (rule R2)"], ["proof (state)\nthis:\n  \\<lparr>Ref p r\\<rparr>Ref r q\\<lparr>Ref p q\\<rparr>\n\ngoal:\nNo subgoals!", "qed\n\n\\<comment> \\<open> Nondeterministic choice \\<close>"], ["", "lemma R_choice: \"(Ref p q) + (Ref p q) \\<le> Ref p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Ref p q + Ref p q \\<le> Ref p q", "unfolding spec_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. H p (Ref p q + Ref p q) q", "by (rule H_choice) (rule R1)+\n\n\\<comment> \\<open> Conditional statement \\<close>"], ["", "lemma R_cond: \"if v then (Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) q) else (Ref (n v \\<cdot> \\<tt>\\<tt> p) q) \\<le> Ref p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n               q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q\n    \\<le> Ref p q", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n               q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q\n    \\<le> Ref p q", "have \"H (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) (Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) q) q\" and \"H (n v \\<cdot> \\<tt>\\<tt> p) (Ref (n v \\<cdot> \\<tt>\\<tt> p) q) q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n     (Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) q) q &&&\n    H (!v \\<cdot> \\<tt>\\<tt> p) (Ref (!v \\<cdot> \\<tt>\\<tt> p) q) q", "by (simp add: R1)+"], ["proof (state)\nthis:\n  H (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n   (Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) q) q\n  H (!v \\<cdot> \\<tt>\\<tt> p) (Ref (!v \\<cdot> \\<tt>\\<tt> p) q) q\n\ngoal (1 subgoal):\n 1. if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n               q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q\n    \\<le> Ref p q", "hence \"H p (if v then (Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) q) else (Ref (n v \\<cdot> \\<tt>\\<tt> p) q)) q\""], ["proof (prove)\nusing this:\n  H (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n   (Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p) q) q\n  H (!v \\<cdot> \\<tt>\\<tt> p) (Ref (!v \\<cdot> \\<tt>\\<tt> p) q) q\n\ngoal (1 subgoal):\n 1. H p (if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n                    q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q)\n     q", "by (simp add: H_cond n_mult_comm)"], ["proof (state)\nthis:\n  H p (if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n                  q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q)\n   q\n\ngoal (1 subgoal):\n 1. if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n               q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q\n    \\<le> Ref p q", "thus ?thesis"], ["proof (prove)\nusing this:\n  H p (if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n                  q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q)\n   q\n\ngoal (1 subgoal):\n 1. if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n               q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q\n    \\<le> Ref p q", "by (rule R2)"], ["proof (state)\nthis:\n  if v then Ref (\\<tt>\\<tt> v \\<cdot> \\<tt>\\<tt> p)\n             q else Ref (!v \\<cdot> \\<tt>\\<tt> p) q\n  \\<le> Ref p q\n\ngoal:\nNo subgoals!", "qed\n\n\\<comment> \\<open> While loop \\<close>"], ["", "lemma R_while: \"while q do (Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p) \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> n q)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p\n    \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> !q)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p\n    \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> !q)", "have \"H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) (Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p)  p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q)\n     (Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p) p", "by (simp_all add: R1)"], ["proof (state)\nthis:\n  H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q)\n   (Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p) p\n\ngoal (1 subgoal):\n 1. while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p\n    \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> !q)", "hence \"H p (while q do (Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p)) (\\<tt>\\<tt> p \\<cdot> n q)\""], ["proof (prove)\nusing this:\n  H (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q)\n   (Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p) p\n\ngoal (1 subgoal):\n 1. H p (while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p)\n     (\\<tt>\\<tt> p \\<cdot> !q)", "by (simp add: H_while)"], ["proof (state)\nthis:\n  H p (while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p)\n   (\\<tt>\\<tt> p \\<cdot> !q)\n\ngoal (1 subgoal):\n 1. while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p\n    \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> !q)", "thus ?thesis"], ["proof (prove)\nusing this:\n  H p (while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p)\n   (\\<tt>\\<tt> p \\<cdot> !q)\n\ngoal (1 subgoal):\n 1. while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p\n    \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> !q)", "by (rule R2)"], ["proof (state)\nthis:\n  while q do Ref (\\<tt>\\<tt> p \\<cdot> \\<tt>\\<tt> q) p\n  \\<le> Ref p (\\<tt>\\<tt> p \\<cdot> !q)\n\ngoal:\nNo subgoals!", "qed\n\n\\<comment> \\<open> Finite iteration \\<close>"], ["", "lemma R_star: \"(Ref i i)\\<^sup>\\<star> \\<le> Ref i i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Ref i i\\<^sup>\\<star> \\<le> Ref i i", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. Ref i i\\<^sup>\\<star> \\<le> Ref i i", "have \"H i (Ref i i) i\""], ["proof (prove)\ngoal (1 subgoal):\n 1. H i (Ref i i) i", "using R1"], ["proof (prove)\nusing this:\n  H ?p (Ref ?p ?q) ?q\n\ngoal (1 subgoal):\n 1. H i (Ref i i) i", "by blast"], ["proof (state)\nthis:\n  H i (Ref i i) i\n\ngoal (1 subgoal):\n 1. Ref i i\\<^sup>\\<star> \\<le> Ref i i", "hence \"H i ((Ref i i)\\<^sup>\\<star>) i\""], ["proof (prove)\nusing this:\n  H i (Ref i i) i\n\ngoal (1 subgoal):\n 1. H i (Ref i i\\<^sup>\\<star>) i", "using H_star"], ["proof (prove)\nusing this:\n  H i (Ref i i) i\n  H ?i ?x ?i \\<Longrightarrow> H ?i (?x\\<^sup>\\<star>) ?i\n\ngoal (1 subgoal):\n 1. H i (Ref i i\\<^sup>\\<star>) i", "by blast"], ["proof (state)\nthis:\n  H i (Ref i i\\<^sup>\\<star>) i\n\ngoal (1 subgoal):\n 1. Ref i i\\<^sup>\\<star> \\<le> Ref i i", "thus \"Ref i i\\<^sup>\\<star> \\<le> Ref i i\""], ["proof (prove)\nusing this:\n  H i (Ref i i\\<^sup>\\<star>) i\n\ngoal (1 subgoal):\n 1. Ref i i\\<^sup>\\<star> \\<le> Ref i i", "by (rule R2)"], ["proof (state)\nthis:\n  Ref i i\\<^sup>\\<star> \\<le> Ref i i\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma R_loop: \"loop (Ref p p) inv i \\<le> Ref p p\""], ["proof (prove)\ngoal (1 subgoal):\n 1. loop Ref p p inv i  \\<le> Ref p p", "unfolding kat_loop_inv_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. Ref p p\\<^sup>\\<star> \\<le> Ref p p", "by (rule R_star)\n\n\\<comment> \\<open> Invariants \\<close>"], ["", "lemma R_inv: \"\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i \\<Longrightarrow> \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q \\<Longrightarrow> Ref i i \\<le> Ref p q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i;\n     \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> Ref i i \\<le> Ref p q", "using R_cons"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<tt>\\<tt> ?p \\<le> \\<tt>\\<tt> ?p';\n   \\<tt>\\<tt> ?q' \\<le> \\<tt>\\<tt> ?q\\<rbrakk>\n  \\<Longrightarrow> Ref ?p' ?q' \\<le> Ref ?p ?q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<tt>\\<tt> p \\<le> \\<tt>\\<tt> i;\n     \\<tt>\\<tt> i \\<le> \\<tt>\\<tt> q\\<rbrakk>\n    \\<Longrightarrow> Ref i i \\<le> Ref p q", "by force"], ["", "end"], ["", "end"]]}