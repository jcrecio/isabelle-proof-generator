{"file_name": "/home/qj213/afp-2021-10-22/thys/Hybrid_Systems_VCs/HS_VC_Spartan.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Hybrid_Systems_VCs", "problem_names": ["lemma fbox_iso: \"P \\<le> Q \\<Longrightarrow> |F] P \\<le> |F] Q\"", "lemma fbox_anti: \"\\<forall>s. F\\<^sub>1 s \\<subseteq> F\\<^sub>2 s \\<Longrightarrow> |F\\<^sub>2] P \\<le> |F\\<^sub>1] P\"", "lemma fbox_invariants: \n  assumes \"I \\<le> |F] I\" and \"J \\<le> |F] J\"\n  shows \"(\\<lambda>s. I s \\<and> J s) \\<le> |F] (\\<lambda>s. I s \\<and> J s)\"\n    and \"(\\<lambda>s. I s \\<or> J s) \\<le> |F] (\\<lambda>s. I s \\<or> J s)\"", "lemma fbox_eta[simp]: \"fbox skip P = P\"", "lemma fbox_test[simp]: \"(\\<lambda>s. ( |\\<questiondown>P?] Q) s) = (\\<lambda>s. P s \\<longrightarrow> Q s)\"", "lemma vec_upd_eq: \"vec_upd s i a = (\\<chi> j. if j = i then a else s$j)\"", "lemma fbox_assign[simp]: \"|x ::= e] Q = (\\<lambda>s. Q (\\<chi> j. ((($) s)(x := (e s))) j))\"", "lemma fbox_nondet_assign[simp]: \"|x ::= ?] P = (\\<lambda>s. \\<forall>k. P (\\<chi> j. if j = x then k else s$j))\"", "lemma fbox_choice: \"|(\\<lambda>s. F s \\<union> G s)] P = (\\<lambda>s. ( |F] P) s \\<and> ( |G] P) s)\"", "lemma le_fbox_choice_iff: \"P \\<le> |(\\<lambda>s. F s \\<union> G s)] Q \\<longleftrightarrow> P \\<le> |F] Q \\<and> P \\<le> |G] Q\"", "lemma kcomp_eq: \"(f ; g) x = \\<Union> {g y |y. y \\<in> f x}\"", "lemma fbox_kcomp[simp]: \"|G ; F] P = |G] |F] P\"", "lemma hoare_kcomp:\n  assumes \"P \\<le> |G] R\" \"R \\<le> |F] Q\"\n  shows \"P \\<le> |G ; F] Q\"", "lemma fbox_if_then_else[simp]:\n  \"|IF T THEN X ELSE Y] Q = (\\<lambda>s. (T s \\<longrightarrow> ( |X] Q) s) \\<and> (\\<not> T s \\<longrightarrow> ( |Y] Q) s))\"", "lemma hoare_if_then_else:\n  assumes \"(\\<lambda>s. P s \\<and> T s) \\<le> |X] Q\"\n    and \"(\\<lambda>s. P s \\<and> \\<not> T s) \\<le> |Y] Q\"\n  shows \"P \\<le> |IF T THEN X ELSE Y] Q\"", "lemma kpower_base:\n  shows \"kpower f 0 s = {s}\" and \"kpower f (Suc 0) s = f s\"", "lemma kpower_simp: \"kpower f (Suc n) s = (f ; kpower f n) s\"", "lemma kpower_inv: \n  fixes F :: \"'a \\<Rightarrow> 'a set\"\n  assumes \"\\<forall>s. I s \\<longrightarrow> (\\<forall>s'. s' \\<in> F s \\<longrightarrow> I s')\" \n  shows \"\\<forall>s. I s \\<longrightarrow> (\\<forall>s'. s' \\<in> (kpower F n s) \\<longrightarrow> I s')\"", "lemma kstar_inv: \"I \\<le> |F] I \\<Longrightarrow> I \\<le> |F\\<^sup>*] I\"", "lemma fbox_kstarI:\n  assumes \"P \\<le> I\" and \"I \\<le> Q\" and \"I \\<le> |F] I\" \n  shows \"P \\<le> |F\\<^sup>*] Q\"", "lemma change_loopI: \"LOOP X INV G = LOOP X INV I\"", "lemma fbox_loopI: \"P \\<le> I \\<Longrightarrow> I \\<le> Q \\<Longrightarrow> I \\<le> |F] I \\<Longrightarrow> P \\<le> |LOOP F INV I] Q\"", "lemma wp_loopI_break: \n  \"P \\<le> |Y] I \\<Longrightarrow> I \\<le> |X] I \\<Longrightarrow> I \\<le> Q \\<Longrightarrow> P \\<le> |Y ; (LOOP X INV I)] Q\"", "lemma fbox_g_evol[simp]: \n  fixes \\<phi> :: \"('a::preorder) \\<Rightarrow> 'b \\<Rightarrow> 'b\"\n  shows \"|EVOL \\<phi> G U] Q = (\\<lambda>s. (\\<forall>t\\<in>U s. (\\<forall>\\<tau>\\<in>down (U s) t. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\"", "lemma fbox_g_orbital: \"|x\\<acute>=f & G on U S @ t\\<^sub>0] Q = \n  (\\<lambda>s. \\<forall>X\\<in>Sols f U S t\\<^sub>0 s. \\<forall>t\\<in>U s. (\\<forall>\\<tau>\\<in>down (U s) t. G (X \\<tau>)) \\<longrightarrow> Q (X t))\"", "lemma fbox_g_ode_subset:\n  assumes \"\\<And>s. s \\<in> S \\<Longrightarrow> 0 \\<in> U s \\<and> is_interval (U s) \\<and> U s \\<subseteq> T\"\n  shows \"|x\\<acute>= (\\<lambda>t. f) & G on U S @ 0] Q = \n  (\\<lambda> s. s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>(U s). (\\<forall>\\<tau>\\<in>down (U s) t. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\"", "lemma fbox_g_ode: \"|x\\<acute>=(\\<lambda>t. f) & G on (\\<lambda>s. T) S @ 0] Q = \n  (\\<lambda>s. s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>T. (\\<forall>\\<tau>\\<in>down T t. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\"", "lemma fbox_g_ode_ivl: \"t \\<ge> 0 \\<Longrightarrow> t \\<in> T \\<Longrightarrow> |x\\<acute>=(\\<lambda>t. f) & G on (\\<lambda>s. {0..t}) S @ 0] Q = \n  (\\<lambda>s. s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>{0..t}. (\\<forall>\\<tau>\\<in>{0..t}. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\"", "lemma fbox_orbit: \"|\\<gamma>\\<^sup>\\<phi>] Q = (\\<lambda>s. s \\<in> S \\<longrightarrow> (\\<forall> t \\<in> T. Q (\\<phi> t s)))\"", "lemma fbox_g_orbital_guard: \n  assumes \"H = (\\<lambda>s. G s \\<and> Q s)\"\n  shows \"|x\\<acute>=f & G on U S @ t\\<^sub>0] Q = |x\\<acute>=f & G on U S @ t\\<^sub>0] H \"", "lemma fbox_g_orbital_inv:\n  assumes \"P \\<le> I\" and \"I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I\" and \"I \\<le> Q\"\n  shows \"P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q\"", "lemma fbox_diff_inv[simp]: \n  \"(I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I) = diff_invariant I f U S t\\<^sub>0 G\"", "lemma diff_inv_guard_ignore:\n  assumes \"I \\<le> |x\\<acute>= f & (\\<lambda>s. True) on U S @ t\\<^sub>0] I\"\n  shows \"I \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] I\"", "lemma fbox_diff_inv_eq: \n  assumes \"\\<And>s. s \\<in> S \\<Longrightarrow> 0 \\<in> U s \\<and> is_interval (U s) \\<and> U s \\<subseteq> T\"\n  shows \"diff_invariant I (\\<lambda>t. f) U S 0 (\\<lambda>s. True) = \n  ((\\<lambda>s. s \\<in> S \\<longrightarrow> I s) = |x\\<acute>= (\\<lambda>t. f) & (\\<lambda>s. True) on U S @ 0] (\\<lambda>s. s \\<in> S \\<longrightarrow> I s))\"", "lemma diff_inv_eq_inv_set: \n  \"diff_invariant I (\\<lambda>t. f) (\\<lambda>s. T) S 0 (\\<lambda>s. True) = (\\<forall>s. I s \\<longrightarrow> \\<gamma>\\<^sup>\\<phi> s \\<subseteq> {s. I s})\"", "lemma fbox_g_odei: \"P \\<le> I \\<Longrightarrow> I \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] I \\<Longrightarrow> (\\<lambda>s. I s \\<and> G s) \\<le> Q \\<Longrightarrow> \n  P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0 DINV I] Q\"", "lemma diff_solve_axiom1: \n  assumes \"local_flow f UNIV UNIV \\<phi>\"\n  shows \"|x\\<acute>= f & G] Q = \n  (\\<lambda>s. \\<forall>t\\<ge>0. (\\<forall>\\<tau>\\<in>{0..t}. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s))\"", "lemma diff_solve_axiom2: \n  fixes c::\"'a::{heine_borel, banach}\"\n  shows \"|x\\<acute>=(\\<lambda>s. c) & G] Q = \n  (\\<lambda>s. \\<forall>t\\<ge>0. (\\<forall>\\<tau>\\<in>{0..t}. G (s + \\<tau> *\\<^sub>R c)) \\<longrightarrow> Q (s + t *\\<^sub>R c))\"", "lemma diff_solve_rule:\n  assumes \"local_flow f UNIV UNIV \\<phi>\"\n    and \"\\<forall>s. P s \\<longrightarrow> (\\<forall>t\\<ge>0. (\\<forall>\\<tau>\\<in>{0..t}. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s))\"\n  shows \"P \\<le> |x\\<acute>= f & G] Q\"", "lemma diff_weak_axiom1: \"( |x\\<acute>= f & G on U S @ t\\<^sub>0] G) s\"", "lemma diff_weak_axiom2: \"|x\\<acute>= f & G on T S @ t\\<^sub>0] Q = |x\\<acute>= f & G on T S @ t\\<^sub>0] (\\<lambda>s. G s \\<longrightarrow> Q s)\"", "lemma diff_weak_rule: \"G \\<le> Q \\<Longrightarrow> P \\<le> |x\\<acute>= f & G on T S @ t\\<^sub>0] Q\"", "lemma fbox_g_orbital_eq_univD:\n  assumes \"|x\\<acute>= f & G on U S @ t\\<^sub>0] C = (\\<lambda>s. True)\" \n    and \"\\<forall>\\<tau>\\<in>(down (U s) t). x \\<tau> \\<in> (x\\<acute>= f & G on U S @ t\\<^sub>0) s\"\n  shows \"\\<forall>\\<tau>\\<in>(down (U s) t). C (x \\<tau>)\"", "lemma diff_cut_axiom:\n  assumes \"|x\\<acute>= f & G on U S @ t\\<^sub>0] C = (\\<lambda>s. True)\"\n  shows \"|x\\<acute>= f & G on U S @ t\\<^sub>0] Q = |x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0] Q\"", "lemma diff_cut_rule:\n  assumes fbox_C: \"P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] C\"\n    and fbox_Q: \"P \\<le> |x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0] Q\"\n  shows \"P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] Q\"", "lemma diff_inv_axiom1:\n  assumes \"G s \\<longrightarrow> I s\" and \"diff_invariant I (\\<lambda>t. f) (\\<lambda>s. {t. t \\<ge> 0}) UNIV 0 G\"\n  shows \"( |x\\<acute>= f & G] I) s\"", "lemma diff_inv_axiom2:\n  assumes \"picard_lindeloef (\\<lambda>t. f) UNIV UNIV 0\"\n    and \"\\<And>s. {t::real. t \\<ge> 0} \\<subseteq> picard_lindeloef.ex_ivl (\\<lambda>t. f) UNIV UNIV 0 s\"\n    and \"diff_invariant I (\\<lambda>t. f) (\\<lambda>s. {t::real. t \\<ge> 0}) UNIV 0 G\"\n  shows \"|x\\<acute>= f & G] I = |(\\<lambda>s. {x. s = x \\<and> G s})] I\"", "lemma diff_inv_rule:\n  assumes \"P \\<le> I\" and \"diff_invariant I f U S t\\<^sub>0 G\" and \"I \\<le> Q\"\n  shows \"P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] Q\""], "translations": [["", "lemma fbox_iso: \"P \\<le> Q \\<Longrightarrow> |F] P \\<le> |F] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> Q \\<Longrightarrow> |F] P \\<le> |F] Q", "unfolding fbox_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> Q \\<Longrightarrow>\n    (\\<lambda>s. \\<forall>s'. s' \\<in> F s \\<longrightarrow> P s')\n    \\<le> (\\<lambda>s. \\<forall>s'. s' \\<in> F s \\<longrightarrow> Q s')", "by auto"], ["", "lemma fbox_anti: \"\\<forall>s. F\\<^sub>1 s \\<subseteq> F\\<^sub>2 s \\<Longrightarrow> |F\\<^sub>2] P \\<le> |F\\<^sub>1] P\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>s. F\\<^sub>1 s \\<subseteq> F\\<^sub>2 s \\<Longrightarrow>\n    |F\\<^sub>2] P \\<le> |F\\<^sub>1] P", "unfolding fbox_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>s. F\\<^sub>1 s \\<subseteq> F\\<^sub>2 s \\<Longrightarrow>\n    (\\<lambda>s. \\<forall>s'. s' \\<in> F\\<^sub>2 s \\<longrightarrow> P s')\n    \\<le> (\\<lambda>s.\n              \\<forall>s'. s' \\<in> F\\<^sub>1 s \\<longrightarrow> P s')", "by auto"], ["", "lemma fbox_invariants: \n  assumes \"I \\<le> |F] I\" and \"J \\<le> |F] J\"\n  shows \"(\\<lambda>s. I s \\<and> J s) \\<le> |F] (\\<lambda>s. I s \\<and> J s)\"\n    and \"(\\<lambda>s. I s \\<or> J s) \\<le> |F] (\\<lambda>s. I s \\<or> J s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s. I s \\<and> J s) \\<le> |F] (\\<lambda>s. I s \\<and> J s) &&&\n    (\\<lambda>s. I s \\<or> J s) \\<le> |F] (\\<lambda>s. I s \\<or> J s)", "using assms"], ["proof (prove)\nusing this:\n  I \\<le> |F] I\n  J \\<le> |F] J\n\ngoal (1 subgoal):\n 1. (\\<lambda>s. I s \\<and> J s) \\<le> |F] (\\<lambda>s. I s \\<and> J s) &&&\n    (\\<lambda>s. I s \\<or> J s) \\<le> |F] (\\<lambda>s. I s \\<or> J s)", "unfolding fbox_def"], ["proof (prove)\nusing this:\n  I \\<le> (\\<lambda>s. \\<forall>s'. s' \\<in> F s \\<longrightarrow> I s')\n  J \\<le> (\\<lambda>s. \\<forall>s'. s' \\<in> F s \\<longrightarrow> J s')\n\ngoal (1 subgoal):\n 1. (\\<lambda>s. I s \\<and> J s)\n    \\<le> (\\<lambda>s.\n              \\<forall>s'.\n                 s' \\<in> F s \\<longrightarrow> I s' \\<and> J s') &&&\n    (\\<lambda>s. I s \\<or> J s)\n    \\<le> (\\<lambda>s.\n              \\<forall>s'. s' \\<in> F s \\<longrightarrow> I s' \\<or> J s')", "by auto\n\n\\<comment> \\<open> Skip \\<close>"], ["", "abbreviation \"skip \\<equiv> (\\<lambda>s. {s})\""], ["", "lemma fbox_eta[simp]: \"fbox skip P = P\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |skip] P = P", "unfolding fbox_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s. \\<forall>s'. s' \\<in> skip s \\<longrightarrow> P s') = P", "by simp\n\n\\<comment> \\<open> Tests \\<close>"], ["", "definition test :: \"'a pred \\<Rightarrow> 'a \\<Rightarrow> 'a set\" (\"(1\\<questiondown>_?)\")\n  where \"\\<questiondown>P? = (\\<lambda>s. {x. x = s \\<and> P x})\""], ["", "lemma fbox_test[simp]: \"(\\<lambda>s. ( |\\<questiondown>P?] Q) s) = (\\<lambda>s. P s \\<longrightarrow> Q s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |\\<questiondown>P?] Q = (\\<lambda>s. P s \\<longrightarrow> Q s)", "unfolding fbox_def test_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>s'.\n           s' \\<in> {x. x = s \\<and> P x} \\<longrightarrow> Q s') =\n    (\\<lambda>s. P s \\<longrightarrow> Q s)", "by simp\n\n\\<comment> \\<open> Assignments \\<close>"], ["", "definition vec_upd :: \"'a^'n \\<Rightarrow> 'n \\<Rightarrow> 'a \\<Rightarrow> 'a^'n\"\n  where \"vec_upd s i a = (\\<chi> j. ((($) s)(i := a)) j)\""], ["", "lemma vec_upd_eq: \"vec_upd s i a = (\\<chi> j. if j = i then a else s$j)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. HS_VC_Spartan.vec_upd s i a = (\\<chi>j. if j = i then a else s $ j)", "by (simp add: vec_upd_def)"], ["", "definition assign :: \"'n \\<Rightarrow> ('a^'n \\<Rightarrow> 'a) \\<Rightarrow> 'a^'n \\<Rightarrow> ('a^'n) set\" (\"(2_ ::= _)\" [70, 65] 61) \n  where \"(x ::= e) = (\\<lambda>s. {vec_upd s x (e s)})\""], ["", "lemma fbox_assign[simp]: \"|x ::= e] Q = (\\<lambda>s. Q (\\<chi> j. ((($) s)(x := (e s))) j))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x ::= e] Q = (\\<lambda>s. Q (\\<chi>j. ((($) s)(x := e s)) j))", "unfolding vec_upd_def assign_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. |(\\<lambda>s. skip (vec_lambda ((($) s)(x := e s))))] Q =\n    (\\<lambda>s. Q (\\<chi>j. ((($) s)(x := e s)) j))", "by (subst fbox_def) simp\n\n\\<comment> \\<open> Nondeterministic assignments \\<close>"], ["", "definition nondet_assign :: \"'n \\<Rightarrow> 'a^'n \\<Rightarrow> ('a^'n) set\" (\"(2_ ::= ? )\" [70] 61)\n  where \"(x ::= ?) = (\\<lambda>s. {(vec_upd s x k)|k. True})\""], ["", "lemma fbox_nondet_assign[simp]: \"|x ::= ?] P = (\\<lambda>s. \\<forall>k. P (\\<chi> j. if j = x then k else s$j))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x ::= ? ] P =\n    (\\<lambda>s. \\<forall>k. P (\\<chi>j. if j = x then k else s $ j))", "unfolding fbox_def nondet_assign_def vec_upd_eq"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>s'.\n           s' \\<in> {\\<chi>j. if j = x then k else s $ j |k.\n                     True} \\<longrightarrow>\n           P s') =\n    (\\<lambda>s. \\<forall>k. P (\\<chi>j. if j = x then k else s $ j))", "apply(simp add: fun_eq_iff, safe)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>xa k.\n       \\<forall>s'.\n          (\\<exists>k.\n              s' = (\\<chi>j. if j = x then k else xa $ j)) \\<longrightarrow>\n          P s' \\<Longrightarrow>\n       P (\\<chi>j. if j = x then k else xa $ j)\n 2. \\<And>xa s' k.\n       \\<forall>k.\n          P (\\<chi>j. if j = x then k else xa $ j) \\<Longrightarrow>\n       P (\\<chi>j. if j = x then k else xa $ j)", "by (erule_tac x=\"(\\<chi> j. if j = x then k else _ $ j)\" in allE, auto)\n\n\\<comment> \\<open> Nondeterministic choice \\<close>"], ["", "lemma fbox_choice: \"|(\\<lambda>s. F s \\<union> G s)] P = (\\<lambda>s. ( |F] P) s \\<and> ( |G] P) s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |(\\<lambda>s. F s \\<union> G s)] P =\n    (\\<lambda>s. (|F] P) s \\<and> (|G] P) s)", "unfolding fbox_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>s'. s' \\<in> F s \\<union> G s \\<longrightarrow> P s') =\n    (\\<lambda>s.\n        (\\<forall>s'. s' \\<in> F s \\<longrightarrow> P s') \\<and>\n        (\\<forall>s'. s' \\<in> G s \\<longrightarrow> P s'))", "by auto"], ["", "lemma le_fbox_choice_iff: \"P \\<le> |(\\<lambda>s. F s \\<union> G s)] Q \\<longleftrightarrow> P \\<le> |F] Q \\<and> P \\<le> |G] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (P \\<le> |(\\<lambda>s. F s \\<union> G s)] Q) =\n    (P \\<le> |F] Q \\<and> P \\<le> |G] Q)", "unfolding fbox_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (P \\<le> (\\<lambda>s.\n                 \\<forall>s'.\n                    s' \\<in> F s \\<union> G s \\<longrightarrow> Q s')) =\n    (P \\<le> (\\<lambda>s.\n                 \\<forall>s'. s' \\<in> F s \\<longrightarrow> Q s') \\<and>\n     P \\<le> (\\<lambda>s. \\<forall>s'. s' \\<in> G s \\<longrightarrow> Q s'))", "by auto\n\n\\<comment> \\<open> Sequential composition \\<close>"], ["", "definition kcomp :: \"('a \\<Rightarrow> 'b set) \\<Rightarrow> ('b \\<Rightarrow> 'c set) \\<Rightarrow> ('a  \\<Rightarrow> 'c set)\" (infixl \";\" 75) where\n  \"F ; G = \\<mu> \\<circ> \\<P> G \\<circ> F\""], ["", "lemma kcomp_eq: \"(f ; g) x = \\<Union> {g y |y. y \\<in> f x}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (f ; g) x = \\<mu> {g y |y. y \\<in> f x}", "unfolding kcomp_def image_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<mu> \\<circ> (\\<lambda>A. {y. \\<exists>x\\<in>A. y = g x}) \\<circ> f)\n     x =\n    \\<mu> {g y |y. y \\<in> f x}", "by auto"], ["", "lemma fbox_kcomp[simp]: \"|G ; F] P = |G] |F] P\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |G ; F] P = |G] |F] P", "unfolding fbox_def kcomp_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>s'.\n           s' \\<in> (\\<mu> \\<circ> \\<P> F \\<circ> G) s \\<longrightarrow>\n           P s') =\n    (\\<lambda>s.\n        \\<forall>s'.\n           s' \\<in> G s \\<longrightarrow>\n           (\\<forall>s'a. s'a \\<in> F s' \\<longrightarrow> P s'a))", "by auto"], ["", "lemma hoare_kcomp:\n  assumes \"P \\<le> |G] R\" \"R \\<le> |F] Q\"\n  shows \"P \\<le> |G ; F] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |G ; F] Q", "apply(subst fbox_kcomp)"], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |G] |F] Q", "by (rule order.trans[OF assms(1)]) (rule fbox_iso[OF assms(2)])\n\n\\<comment> \\<open> Conditional statement \\<close>"], ["", "definition ifthenelse :: \"'a pred \\<Rightarrow> ('a \\<Rightarrow> 'b set) \\<Rightarrow> ('a \\<Rightarrow> 'b set) \\<Rightarrow> ('a \\<Rightarrow> 'b set)\"\n  (\"IF _ THEN _ ELSE _\" [64,64,64] 63) where \n  \"IF P THEN X ELSE Y \\<equiv> (\\<lambda>s. if P s then X s else Y s)\""], ["", "lemma fbox_if_then_else[simp]:\n  \"|IF T THEN X ELSE Y] Q = (\\<lambda>s. (T s \\<longrightarrow> ( |X] Q) s) \\<and> (\\<not> T s \\<longrightarrow> ( |Y] Q) s))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |IF T THEN X ELSE Y] Q =\n    (\\<lambda>s.\n        (T s \\<longrightarrow> (|X] Q) s) \\<and>\n        (\\<not> T s \\<longrightarrow> (|Y] Q) s))", "unfolding fbox_def ifthenelse_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>s'.\n           s' \\<in> (if T s then X s else Y s) \\<longrightarrow> Q s') =\n    (\\<lambda>s.\n        (T s \\<longrightarrow>\n         (\\<forall>s'. s' \\<in> X s \\<longrightarrow> Q s')) \\<and>\n        (\\<not> T s \\<longrightarrow>\n         (\\<forall>s'. s' \\<in> Y s \\<longrightarrow> Q s')))", "by auto"], ["", "lemma hoare_if_then_else:\n  assumes \"(\\<lambda>s. P s \\<and> T s) \\<le> |X] Q\"\n    and \"(\\<lambda>s. P s \\<and> \\<not> T s) \\<le> |Y] Q\"\n  shows \"P \\<le> |IF T THEN X ELSE Y] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |IF T THEN X ELSE Y] Q", "using assms"], ["proof (prove)\nusing this:\n  (\\<lambda>s. P s \\<and> T s) \\<le> |X] Q\n  (\\<lambda>s. P s \\<and> \\<not> T s) \\<le> |Y] Q\n\ngoal (1 subgoal):\n 1. P \\<le> |IF T THEN X ELSE Y] Q", "unfolding fbox_def ifthenelse_def"], ["proof (prove)\nusing this:\n  (\\<lambda>s. P s \\<and> T s)\n  \\<le> (\\<lambda>s. \\<forall>s'. s' \\<in> X s \\<longrightarrow> Q s')\n  (\\<lambda>s. P s \\<and> \\<not> T s)\n  \\<le> (\\<lambda>s. \\<forall>s'. s' \\<in> Y s \\<longrightarrow> Q s')\n\ngoal (1 subgoal):\n 1. P \\<le> (\\<lambda>s.\n                \\<forall>s'.\n                   s' \\<in> (if T s then X s else Y s) \\<longrightarrow>\n                   Q s')", "by auto\n\n\\<comment> \\<open> Finite iteration \\<close>"], ["", "definition kpower :: \"('a \\<Rightarrow> 'a set) \\<Rightarrow> nat \\<Rightarrow> ('a \\<Rightarrow> 'a set)\" \n  where \"kpower f n = (\\<lambda>s. ((;) f ^^ n) skip s)\""], ["", "lemma kpower_base:\n  shows \"kpower f 0 s = {s}\" and \"kpower f (Suc 0) s = f s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. kpower f 0 s = skip s &&& kpower f (Suc 0) s = f s", "unfolding kpower_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((;) f ^^ 0) skip s = skip s &&& ((;) f ^^ Suc 0) skip s = f s", "by(auto simp: kcomp_eq)"], ["", "lemma kpower_simp: \"kpower f (Suc n) s = (f ; kpower f n) s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. kpower f (Suc n) s = (f ; kpower f n) s", "unfolding kcomp_eq"], ["proof (prove)\ngoal (1 subgoal):\n 1. kpower f (Suc n) s = \\<mu> {kpower f n y |y. y \\<in> f s}", "apply(induct n)"], ["proof (prove)\ngoal (2 subgoals):\n 1. kpower f (Suc 0) s = \\<mu> {kpower f 0 y |y. y \\<in> f s}\n 2. \\<And>n.\n       kpower f (Suc n) s =\n       \\<mu> {kpower f n y |y. y \\<in> f s} \\<Longrightarrow>\n       kpower f (Suc (Suc n)) s = \\<mu> {kpower f (Suc n) y |y. y \\<in> f s}", "unfolding kpower_base"], ["proof (prove)\ngoal (2 subgoals):\n 1. f s = \\<mu> {skip y |y. y \\<in> f s}\n 2. \\<And>n.\n       kpower f (Suc n) s =\n       \\<mu> {kpower f n y |y. y \\<in> f s} \\<Longrightarrow>\n       kpower f (Suc (Suc n)) s = \\<mu> {kpower f (Suc n) y |y. y \\<in> f s}", "apply(force simp: subset_antisym)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>n.\n       kpower f (Suc n) s =\n       \\<mu> {kpower f n y |y. y \\<in> f s} \\<Longrightarrow>\n       kpower f (Suc (Suc n)) s = \\<mu> {kpower f (Suc n) y |y. y \\<in> f s}", "unfolding kpower_def kcomp_eq"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>n.\n       ((\\<lambda>g x. \\<mu> {g y |y. y \\<in> f x}) ^^ Suc n) skip s =\n       \\<mu>\n        {((\\<lambda>g x. \\<mu> {g y |y. y \\<in> f x}) ^^ n) skip y |y.\n         y \\<in> f s} \\<Longrightarrow>\n       ((\\<lambda>g x. \\<mu> {g y |y. y \\<in> f x}) ^^ Suc (Suc n)) skip s =\n       \\<mu>\n        {((\\<lambda>g x. \\<mu> {g y |y. y \\<in> f x}) ^^ Suc n) skip y |y.\n         y \\<in> f s}", "by simp"], ["", "definition kleene_star :: \"('a \\<Rightarrow> 'a set) \\<Rightarrow> ('a \\<Rightarrow> 'a set)\" (\"(_\\<^sup>*)\" [1000] 999)\n  where \"(f\\<^sup>*) s = \\<Union> {kpower f n s |n. n \\<in> UNIV}\""], ["", "lemma kpower_inv: \n  fixes F :: \"'a \\<Rightarrow> 'a set\"\n  assumes \"\\<forall>s. I s \\<longrightarrow> (\\<forall>s'. s' \\<in> F s \\<longrightarrow> I s')\" \n  shows \"\\<forall>s. I s \\<longrightarrow> (\\<forall>s'. s' \\<in> (kpower F n s) \\<longrightarrow> I s')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>s.\n       I s \\<longrightarrow>\n       (\\<forall>s'. s' \\<in> kpower F n s \\<longrightarrow> I s')", "apply(clarsimp, induct n)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s s'.\n       \\<lbrakk>I s; s' \\<in> kpower F 0 s\\<rbrakk> \\<Longrightarrow> I s'\n 2. \\<And>n s s'.\n       \\<lbrakk>\\<And>s s'.\n                   \\<lbrakk>I s; s' \\<in> kpower F n s\\<rbrakk>\n                   \\<Longrightarrow> I s';\n        I s; s' \\<in> kpower F (Suc n) s\\<rbrakk>\n       \\<Longrightarrow> I s'", "unfolding kpower_base kpower_simp"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s s'.\n       \\<lbrakk>I s; s' \\<in> skip s\\<rbrakk> \\<Longrightarrow> I s'\n 2. \\<And>n s s'.\n       \\<lbrakk>\\<And>s s'.\n                   \\<lbrakk>I s; s' \\<in> kpower F n s\\<rbrakk>\n                   \\<Longrightarrow> I s';\n        I s; s' \\<in> (F ; kpower F n) s\\<rbrakk>\n       \\<Longrightarrow> I s'", "apply(simp_all add: kcomp_eq, clarsimp)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>n s s' y.\n       \\<lbrakk>\\<And>s s'.\n                   \\<lbrakk>I s; s' \\<in> kpower F n s\\<rbrakk>\n                   \\<Longrightarrow> I s';\n        I s; s' \\<in> kpower F n y; y \\<in> F s\\<rbrakk>\n       \\<Longrightarrow> I s'", "apply(subgoal_tac \"I y\", simp)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>n s s' y.\n       \\<lbrakk>\\<And>s s'.\n                   \\<lbrakk>I s; s' \\<in> kpower F n s\\<rbrakk>\n                   \\<Longrightarrow> I s';\n        I s; s' \\<in> kpower F n y; y \\<in> F s\\<rbrakk>\n       \\<Longrightarrow> I y", "using assms"], ["proof (prove)\nusing this:\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>s'. s' \\<in> F s \\<longrightarrow> I s')\n\ngoal (1 subgoal):\n 1. \\<And>n s s' y.\n       \\<lbrakk>\\<And>s s'.\n                   \\<lbrakk>I s; s' \\<in> kpower F n s\\<rbrakk>\n                   \\<Longrightarrow> I s';\n        I s; s' \\<in> kpower F n y; y \\<in> F s\\<rbrakk>\n       \\<Longrightarrow> I y", "by blast"], ["", "lemma kstar_inv: \"I \\<le> |F] I \\<Longrightarrow> I \\<le> |F\\<^sup>*] I\""], ["proof (prove)\ngoal (1 subgoal):\n 1. I \\<le> |F] I \\<Longrightarrow> I \\<le> |F\\<^sup>*] I", "unfolding kleene_star_def fbox_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. I \\<le> (\\<lambda>s.\n                \\<forall>s'.\n                   s' \\<in> F s \\<longrightarrow> I s') \\<Longrightarrow>\n    I \\<le> (\\<lambda>s.\n                \\<forall>s'.\n                   s' \\<in> \\<mu>\n                             {kpower F n s |n.\n                              n \\<in> UNIV} \\<longrightarrow>\n                   I s')", "apply clarsimp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x s' n.\n       \\<lbrakk>I \\<le> (\\<lambda>s.\n                            \\<forall>s'.\n                               s' \\<in> F s \\<longrightarrow> I s');\n        I x; s' \\<in> kpower F n x\\<rbrakk>\n       \\<Longrightarrow> I s'", "apply(unfold le_fun_def, subgoal_tac \"\\<forall>x. I x \\<longrightarrow> (\\<forall>s'. s' \\<in> F x \\<longrightarrow> I s')\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x s' n.\n       \\<lbrakk>\\<forall>x.\n                   I x\n                   \\<le> (\\<forall>s'. s' \\<in> F x \\<longrightarrow> I s');\n        I x; s' \\<in> kpower F n x;\n        \\<forall>x.\n           I x \\<longrightarrow>\n           (\\<forall>s'. s' \\<in> F x \\<longrightarrow> I s')\\<rbrakk>\n       \\<Longrightarrow> I s'\n 2. \\<And>x s' n.\n       \\<lbrakk>\\<forall>x.\n                   I x\n                   \\<le> (\\<forall>s'. s' \\<in> F x \\<longrightarrow> I s');\n        I x; s' \\<in> kpower F n x\\<rbrakk>\n       \\<Longrightarrow> \\<forall>x.\n                            I x \\<longrightarrow>\n                            (\\<forall>s'.\n                                s' \\<in> F x \\<longrightarrow> I s')", "using kpower_inv[of I F]"], ["proof (prove)\nusing this:\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>s'. s' \\<in> F s \\<longrightarrow> I s') \\<Longrightarrow>\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>s'. s' \\<in> kpower F ?n s \\<longrightarrow> I s')\n\ngoal (2 subgoals):\n 1. \\<And>x s' n.\n       \\<lbrakk>\\<forall>x.\n                   I x\n                   \\<le> (\\<forall>s'. s' \\<in> F x \\<longrightarrow> I s');\n        I x; s' \\<in> kpower F n x;\n        \\<forall>x.\n           I x \\<longrightarrow>\n           (\\<forall>s'. s' \\<in> F x \\<longrightarrow> I s')\\<rbrakk>\n       \\<Longrightarrow> I s'\n 2. \\<And>x s' n.\n       \\<lbrakk>\\<forall>x.\n                   I x\n                   \\<le> (\\<forall>s'. s' \\<in> F x \\<longrightarrow> I s');\n        I x; s' \\<in> kpower F n x\\<rbrakk>\n       \\<Longrightarrow> \\<forall>x.\n                            I x \\<longrightarrow>\n                            (\\<forall>s'.\n                                s' \\<in> F x \\<longrightarrow> I s')", "by blast simp"], ["", "lemma fbox_kstarI:\n  assumes \"P \\<le> I\" and \"I \\<le> Q\" and \"I \\<le> |F] I\" \n  shows \"P \\<le> |F\\<^sup>*] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] Q", "proof-"], ["proof (state)\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] Q", "have \"I \\<le> |F\\<^sup>*] I\""], ["proof (prove)\ngoal (1 subgoal):\n 1. I \\<le> |F\\<^sup>*] I", "using assms(3) kstar_inv"], ["proof (prove)\nusing this:\n  I \\<le> |F] I\n  ?I \\<le> |?F] ?I \\<Longrightarrow> ?I \\<le> |?F\\<^sup>*] ?I\n\ngoal (1 subgoal):\n 1. I \\<le> |F\\<^sup>*] I", "by blast"], ["proof (state)\nthis:\n  I \\<le> |F\\<^sup>*] I\n\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] Q", "hence \"P \\<le> |F\\<^sup>*] I\""], ["proof (prove)\nusing this:\n  I \\<le> |F\\<^sup>*] I\n\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] I", "using assms(1)"], ["proof (prove)\nusing this:\n  I \\<le> |F\\<^sup>*] I\n  P \\<le> I\n\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] I", "by auto"], ["proof (state)\nthis:\n  P \\<le> |F\\<^sup>*] I\n\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] Q", "also"], ["proof (state)\nthis:\n  P \\<le> |F\\<^sup>*] I\n\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] Q", "have \"|F\\<^sup>*] I \\<le> |F\\<^sup>*] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |F\\<^sup>*] I \\<le> |F\\<^sup>*] Q", "by (rule fbox_iso[OF assms(2)])"], ["proof (state)\nthis:\n  |F\\<^sup>*] I \\<le> |F\\<^sup>*] Q\n\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] Q", "finally"], ["proof (chain)\npicking this:\n  P \\<le> |F\\<^sup>*] Q", "show ?thesis"], ["proof (prove)\nusing this:\n  P \\<le> |F\\<^sup>*] Q\n\ngoal (1 subgoal):\n 1. P \\<le> |F\\<^sup>*] Q", "."], ["proof (state)\nthis:\n  P \\<le> |F\\<^sup>*] Q\n\ngoal:\nNo subgoals!", "qed"], ["", "definition loopi :: \"('a \\<Rightarrow> 'a set) \\<Rightarrow> 'a pred \\<Rightarrow> ('a \\<Rightarrow> 'a set)\" (\"LOOP _ INV _ \" [64,64] 63)\n  where \"LOOP F INV I \\<equiv> (F\\<^sup>*)\""], ["", "lemma change_loopI: \"LOOP X INV G = LOOP X INV I\""], ["proof (prove)\ngoal (1 subgoal):\n 1. LOOP X INV G  = LOOP X INV I", "unfolding loopi_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. X\\<^sup>* = X\\<^sup>*", "by simp"], ["", "lemma fbox_loopI: \"P \\<le> I \\<Longrightarrow> I \\<le> Q \\<Longrightarrow> I \\<le> |F] I \\<Longrightarrow> P \\<le> |LOOP F INV I] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> I; I \\<le> Q; I \\<le> |F] I\\<rbrakk>\n    \\<Longrightarrow> P \\<le> |LOOP F INV I ] Q", "unfolding loopi_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> I; I \\<le> Q; I \\<le> |F] I\\<rbrakk>\n    \\<Longrightarrow> P \\<le> |F\\<^sup>*] Q", "using fbox_kstarI[of \"P\"]"], ["proof (prove)\nusing this:\n  \\<lbrakk>P \\<le> ?I; ?I \\<le> ?Q; ?I \\<le> |?F] ?I\\<rbrakk>\n  \\<Longrightarrow> P \\<le> |?F\\<^sup>*] ?Q\n\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> I; I \\<le> Q; I \\<le> |F] I\\<rbrakk>\n    \\<Longrightarrow> P \\<le> |F\\<^sup>*] Q", "by simp"], ["", "lemma wp_loopI_break: \n  \"P \\<le> |Y] I \\<Longrightarrow> I \\<le> |X] I \\<Longrightarrow> I \\<le> Q \\<Longrightarrow> P \\<le> |Y ; (LOOP X INV I)] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> |Y] I; I \\<le> |X] I; I \\<le> Q\\<rbrakk>\n    \\<Longrightarrow> P \\<le> |Y ; (LOOP X INV I )] Q", "by (rule hoare_kcomp, force) (rule fbox_loopI, auto)"], ["", "subsection \\<open> Verification of hybrid programs \\<close>"], ["", "text \\<open> Verification by providing evolution \\<close>"], ["", "definition g_evol :: \"(('a::ord) \\<Rightarrow> 'b \\<Rightarrow> 'b) \\<Rightarrow> 'b pred \\<Rightarrow> ('b \\<Rightarrow> 'a set) \\<Rightarrow> ('b \\<Rightarrow> 'b set)\" (\"EVOL\")\n  where \"EVOL \\<phi> G U = (\\<lambda>s. g_orbit (\\<lambda>t. \\<phi> t s) G (U s))\""], ["", "lemma fbox_g_evol[simp]: \n  fixes \\<phi> :: \"('a::preorder) \\<Rightarrow> 'b \\<Rightarrow> 'b\"\n  shows \"|EVOL \\<phi> G U] Q = (\\<lambda>s. (\\<forall>t\\<in>U s. (\\<forall>\\<tau>\\<in>down (U s) t. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |EVOL \\<phi> G U] Q =\n    (\\<lambda>s.\n        \\<forall>t\\<in>U s.\n           (\\<forall>\\<tau>\\<in>down (U s) t.\n               G (\\<phi> \\<tau> s)) \\<longrightarrow>\n           Q (\\<phi> t s))", "unfolding g_evol_def g_orbit_eq fbox_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>s'.\n           s' \\<in> {\\<phi> t s |t.\n                     t \\<in> U s \\<and>\n                     (\\<forall>\\<tau>\\<in>down (U s) t.\n                         G (\\<phi> \\<tau> s))} \\<longrightarrow>\n           Q s') =\n    (\\<lambda>s.\n        \\<forall>t\\<in>U s.\n           (\\<forall>\\<tau>\\<in>down (U s) t.\n               G (\\<phi> \\<tau> s)) \\<longrightarrow>\n           Q (\\<phi> t s))", "by auto"], ["", "text \\<open> Verification by providing solutions \\<close>"], ["", "lemma fbox_g_orbital: \"|x\\<acute>=f & G on U S @ t\\<^sub>0] Q = \n  (\\<lambda>s. \\<forall>X\\<in>Sols f U S t\\<^sub>0 s. \\<forall>t\\<in>U s. (\\<forall>\\<tau>\\<in>down (U s) t. G (X \\<tau>)) \\<longrightarrow> Q (X t))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=f & G on U S @ t\\<^sub>0] Q =\n    (\\<lambda>s.\n        \\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n           \\<forall>t\\<in>U s.\n              (\\<forall>\\<tau>\\<in>down (U s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              Q (X t))", "unfolding fbox_def g_orbital_eq"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>s'.\n           s' \\<in> {X t |t X.\n                     t \\<in> U s \\<and>\n                     \\<P> X (down (U s) t) \\<subseteq> Collect G \\<and>\n                     X \\<in> Sols f U S t\\<^sub>0 s} \\<longrightarrow>\n           Q s') =\n    (\\<lambda>s.\n        \\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n           \\<forall>t\\<in>U s.\n              (\\<forall>\\<tau>\\<in>down (U s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              Q (X t))", "by (auto simp: fun_eq_iff)"], ["", "context local_flow\nbegin"], ["", "lemma fbox_g_ode_subset:\n  assumes \"\\<And>s. s \\<in> S \\<Longrightarrow> 0 \\<in> U s \\<and> is_interval (U s) \\<and> U s \\<subseteq> T\"\n  shows \"|x\\<acute>= (\\<lambda>t. f) & G on U S @ 0] Q = \n  (\\<lambda> s. s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>(U s). (\\<forall>\\<tau>\\<in>down (U s) t. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=\\<lambda>t. f & G on U S @ 0] Q =\n    (\\<lambda>s.\n        s \\<in> S \\<longrightarrow>\n        (\\<forall>t\\<in>U s.\n            (\\<forall>\\<tau>\\<in>down (U s) t.\n                G (\\<phi> \\<tau> s)) \\<longrightarrow>\n            Q (\\<phi> t s)))", "apply(unfold fbox_g_orbital fun_eq_iff)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f) U S 0 x.\n           \\<forall>t\\<in>U x.\n              (\\<forall>\\<tau>\\<in>down (U x) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              Q (X t)) =\n       (x \\<in> S \\<longrightarrow>\n        (\\<forall>t\\<in>U x.\n            (\\<forall>\\<tau>\\<in>down (U x) t.\n                G (\\<phi> \\<tau> x)) \\<longrightarrow>\n            Q (\\<phi> t x)))", "apply(clarify, rule iffI; clarify)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x t.\n       \\<lbrakk>\\<forall>X\\<in>Sols (\\<lambda>t. f) U S 0 x.\n                   \\<forall>t\\<in>U x.\n                      (\\<forall>\\<tau>\\<in>down (U x) t.\n                          G (X \\<tau>)) \\<longrightarrow>\n                      Q (X t);\n        x \\<in> S; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (\\<phi> \\<tau> x)\\<rbrakk>\n       \\<Longrightarrow> Q (\\<phi> t x)\n 2. \\<And>x X t.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>)\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "apply(force simp: in_ivp_sols assms)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x X t.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>)\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "apply(frule ivp_solsD(2), frule ivp_solsD(3), frule ivp_solsD(4))"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x X t.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "apply(subgoal_tac \"\\<forall>\\<tau>\\<in>down (U x) t. X \\<tau> = \\<phi> \\<tau> x\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x X t.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t.\n           X \\<tau> = \\<phi> \\<tau> x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)\n 2. \\<And>x X t.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x\\<rbrakk>\n       \\<Longrightarrow> \\<forall>\\<tau>\\<in>down (U x) t.\n                            X \\<tau> = \\<phi> \\<tau> x", "apply(clarsimp, fastforce, rule ballI)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> X \\<tau> = \\<phi> \\<tau> x", "apply(rule ivp_unique_solution[OF _ _ _ _ _ in_ivp_sols])"], ["proof (prove)\ngoal (8 subgoals):\n 1. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> x \\<in> S\n 2. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> is_interval (?U59 x X t \\<tau> x)\n 3. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> ?U59 x X t \\<tau> x \\<subseteq> T\n 4. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> \\<tau> \\<in> ?U59 x X t \\<tau> x\n 5. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> X \\<in> Sols (\\<lambda>t. f) (?U59 x X t \\<tau>) S\n                                  0 x\n 6. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> x \\<in> S\n 7. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> 0 \\<in> ?U59 x X t \\<tau> x\n 8. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> ?U59 x X t \\<tau> x \\<subseteq> T", "using assms"], ["proof (prove)\nusing this:\n  ?s \\<in> S \\<Longrightarrow>\n  0 \\<in> U ?s \\<and> is_interval (U ?s) \\<and> U ?s \\<subseteq> T\n\ngoal (8 subgoals):\n 1. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> x \\<in> S\n 2. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> is_interval (?U59 x X t \\<tau> x)\n 3. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> ?U59 x X t \\<tau> x \\<subseteq> T\n 4. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> \\<tau> \\<in> ?U59 x X t \\<tau> x\n 5. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> X \\<in> Sols (\\<lambda>t. f) (?U59 x X t \\<tau>) S\n                                  0 x\n 6. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> x \\<in> S\n 7. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> 0 \\<in> ?U59 x X t \\<tau> x\n 8. \\<And>x X t \\<tau>.\n       \\<lbrakk>x \\<in> S \\<longrightarrow>\n                (\\<forall>t\\<in>U x.\n                    (\\<forall>\\<tau>\\<in>down (U x) t.\n                        G (\\<phi> \\<tau> x)) \\<longrightarrow>\n                    Q (\\<phi> t x));\n        X \\<in> Sols (\\<lambda>t. f) U S 0 x; t \\<in> U x;\n        \\<forall>\\<tau>\\<in>down (U x) t. G (X \\<tau>); X 0 = x;\n        X \\<in> U x \\<rightarrow> S; 0 \\<in> U x;\n        \\<tau> \\<in> down (U x) t\\<rbrakk>\n       \\<Longrightarrow> ?U59 x X t \\<tau> x \\<subseteq> T", "by auto"], ["", "lemma fbox_g_ode: \"|x\\<acute>=(\\<lambda>t. f) & G on (\\<lambda>s. T) S @ 0] Q = \n  (\\<lambda>s. s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>T. (\\<forall>\\<tau>\\<in>down T t. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=\\<lambda>t. f & G on \\<lambda>s. T S @ 0] Q =\n    (\\<lambda>s.\n        s \\<in> S \\<longrightarrow>\n        (\\<forall>t\\<in>T.\n            (\\<forall>\\<tau>\\<in>down T t.\n                G (\\<phi> \\<tau> s)) \\<longrightarrow>\n            Q (\\<phi> t s)))", "by (subst fbox_g_ode_subset, simp_all add: init_time interval_time)"], ["", "lemma fbox_g_ode_ivl: \"t \\<ge> 0 \\<Longrightarrow> t \\<in> T \\<Longrightarrow> |x\\<acute>=(\\<lambda>t. f) & G on (\\<lambda>s. {0..t}) S @ 0] Q = \n  (\\<lambda>s. s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>{0..t}. (\\<forall>\\<tau>\\<in>{0..t}. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>0 \\<le> t; t \\<in> T\\<rbrakk>\n    \\<Longrightarrow> |x\\<acute>=\\<lambda>t.\n                                    f & G on \\<lambda>s. {0..t} S @ 0] Q =\n                      (\\<lambda>s.\n                          s \\<in> S \\<longrightarrow>\n                          (\\<forall>t\\<in>{0..t}.\n                              (\\<forall>\\<tau>\\<in>{0..t}.\n                                  G (\\<phi> \\<tau> s)) \\<longrightarrow>\n                              Q (\\<phi> t s)))", "apply(subst fbox_g_ode_subset, simp_all add: subintervalI init_time real_Icc_closed_segment)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>0 \\<le> t; t \\<in> T\\<rbrakk>\n    \\<Longrightarrow> (\\<lambda>s.\n                          s \\<in> S \\<longrightarrow>\n                          (\\<forall>ta\\<in>{0--t}.\n                              (\\<forall>\\<tau>.\n                                  \\<tau> \\<in> {0--t} \\<and>\n                                  \\<tau> \\<le> ta \\<longrightarrow>\n                                  G (\\<phi> \\<tau> s)) \\<longrightarrow>\n                              Q (\\<phi> ta s))) =\n                      (\\<lambda>s.\n                          s \\<in> S \\<longrightarrow>\n                          (\\<forall>t\\<in>{0--t}.\n                              (\\<forall>\\<tau>\\<in>{0..t}.\n                                  G (\\<phi> \\<tau> s)) \\<longrightarrow>\n                              Q (\\<phi> t s)))", "by (auto simp: closed_segment_eq_real_ivl)"], ["", "lemma fbox_orbit: \"|\\<gamma>\\<^sup>\\<phi>] Q = (\\<lambda>s. s \\<in> S \\<longrightarrow> (\\<forall> t \\<in> T. Q (\\<phi> t s)))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |\\<gamma>\\<^sup>\\<phi>] Q =\n    (\\<lambda>s.\n        s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>T. Q (\\<phi> t s)))", "unfolding orbit_def fbox_g_ode"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        s \\<in> S \\<longrightarrow>\n        (\\<forall>t\\<in>T.\n            (\\<forall>\\<tau>\\<in>down T t. True) \\<longrightarrow>\n            Q (\\<phi> t s))) =\n    (\\<lambda>s.\n        s \\<in> S \\<longrightarrow> (\\<forall>t\\<in>T. Q (\\<phi> t s)))", "by simp"], ["", "end"], ["", "text \\<open> Verification with differential invariants \\<close>"], ["", "definition g_ode_inv :: \"(real \\<Rightarrow> ('a::banach)\\<Rightarrow>'a) \\<Rightarrow> 'a pred \\<Rightarrow> ('a \\<Rightarrow> real set) \\<Rightarrow> 'a set \\<Rightarrow> \n  real \\<Rightarrow> 'a pred \\<Rightarrow> ('a \\<Rightarrow> 'a set)\" (\"(1x\\<acute>=_ & _ on _ _ @ _ DINV _ )\") \n  where \"(x\\<acute>= f & G on U S @ t\\<^sub>0 DINV I) = (x\\<acute>= f & G on U S @ t\\<^sub>0)\""], ["", "lemma fbox_g_orbital_guard: \n  assumes \"H = (\\<lambda>s. G s \\<and> Q s)\"\n  shows \"|x\\<acute>=f & G on U S @ t\\<^sub>0] Q = |x\\<acute>=f & G on U S @ t\\<^sub>0] H \""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=f & G on U S @ t\\<^sub>0] Q =\n    |x\\<acute>=f & G on U S @ t\\<^sub>0] H", "unfolding fbox_g_orbital"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n           \\<forall>t\\<in>U s.\n              (\\<forall>\\<tau>\\<in>down (U s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              Q (X t)) =\n    (\\<lambda>s.\n        \\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n           \\<forall>t\\<in>U s.\n              (\\<forall>\\<tau>\\<in>down (U s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              H (X t))", "using assms"], ["proof (prove)\nusing this:\n  H = (\\<lambda>s. G s \\<and> Q s)\n\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n           \\<forall>t\\<in>U s.\n              (\\<forall>\\<tau>\\<in>down (U s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              Q (X t)) =\n    (\\<lambda>s.\n        \\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n           \\<forall>t\\<in>U s.\n              (\\<forall>\\<tau>\\<in>down (U s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              H (X t))", "by auto"], ["", "lemma fbox_g_orbital_inv:\n  assumes \"P \\<le> I\" and \"I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I\" and \"I \\<le> Q\"\n  shows \"P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "using assms(1)"], ["proof (prove)\nusing this:\n  P \\<le> I\n\ngoal (1 subgoal):\n 1. P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "apply(rule order.trans)"], ["proof (prove)\ngoal (1 subgoal):\n 1. I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "using assms(2)"], ["proof (prove)\nusing this:\n  I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I\n\ngoal (1 subgoal):\n 1. I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "apply(rule order.trans)"], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=f & G on U S @ t\\<^sub>0] I\n    \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "by (rule fbox_iso[OF assms(3)])"], ["", "lemma fbox_diff_inv[simp]: \n  \"(I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I) = diff_invariant I f U S t\\<^sub>0 G\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I) =\n    diff_invariant I f U S t\\<^sub>0 G", "by (auto simp: diff_invariant_def ivp_sols_def fbox_def g_orbital_eq)"], ["", "lemma diff_inv_guard_ignore:\n  assumes \"I \\<le> |x\\<acute>= f & (\\<lambda>s. True) on U S @ t\\<^sub>0] I\"\n  shows \"I \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] I\""], ["proof (prove)\ngoal (1 subgoal):\n 1. I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I", "using assms"], ["proof (prove)\nusing this:\n  I \\<le> |x\\<acute>=f & \\<lambda>s. True on U S @ t\\<^sub>0] I\n\ngoal (1 subgoal):\n 1. I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I", "unfolding fbox_diff_inv diff_invariant_eq image_le_pred"], ["proof (prove)\nusing this:\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n         \\<forall>t\\<in>U s.\n            (\\<forall>\\<tau>\\<in>down (U s) t. True) \\<longrightarrow>\n            I (X t))\n\ngoal (1 subgoal):\n 1. \\<forall>s.\n       I s \\<longrightarrow>\n       (\\<forall>X\\<in>Sols f U S t\\<^sub>0 s.\n           \\<forall>t\\<in>U s.\n              (\\<forall>\\<tau>\\<in>down (U s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t))", "by auto"], ["", "context local_flow\nbegin"], ["", "lemma fbox_diff_inv_eq: \n  assumes \"\\<And>s. s \\<in> S \\<Longrightarrow> 0 \\<in> U s \\<and> is_interval (U s) \\<and> U s \\<subseteq> T\"\n  shows \"diff_invariant I (\\<lambda>t. f) U S 0 (\\<lambda>s. True) = \n  ((\\<lambda>s. s \\<in> S \\<longrightarrow> I s) = |x\\<acute>= (\\<lambda>t. f) & (\\<lambda>s. True) on U S @ 0] (\\<lambda>s. s \\<in> S \\<longrightarrow> I s))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. diff_invariant I (\\<lambda>t. f) U S 0 (\\<lambda>s. True) =\n    ((\\<lambda>s. s \\<in> S \\<longrightarrow> I s) =\n     |x\\<acute>=\\<lambda>t.\n                   f & \\<lambda>s.\n                          True on U S @ 0] (\\<lambda>s.\n         s \\<in> S \\<longrightarrow> I s))", "unfolding fbox_diff_inv[symmetric]"], ["proof (prove)\ngoal (1 subgoal):\n 1. (I \\<le> |x\\<acute>=\\<lambda>t. f & \\<lambda>s. True on U S @ 0] I) =\n    ((\\<lambda>s. s \\<in> S \\<longrightarrow> I s) =\n     |x\\<acute>=\\<lambda>t.\n                   f & \\<lambda>s.\n                          True on U S @ 0] (\\<lambda>s.\n         s \\<in> S \\<longrightarrow> I s))", "apply(subst fbox_g_ode_subset[OF assms], simp)+"], ["proof (prove)\ngoal (1 subgoal):\n 1. (I \\<le> (\\<lambda>s.\n                 s \\<in> S \\<longrightarrow>\n                 (\\<forall>t\\<in>U s.\n                     (\\<forall>\\<tau>\\<in>down (U s) t.\n                         True) \\<longrightarrow>\n                     I (\\<phi> t s)))) =\n    ((\\<lambda>s. s \\<in> S \\<longrightarrow> I s) =\n     (\\<lambda>s.\n         s \\<in> S \\<longrightarrow>\n         (\\<forall>t\\<in>U s.\n             (\\<forall>\\<tau>\\<in>down (U s) t. True) \\<longrightarrow>\n             \\<phi> t s \\<in> S \\<longrightarrow> I (\\<phi> t s))))", "apply(clarsimp simp: le_fun_def fun_eq_iff, safe, force)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>\\<forall>x.\n                   I x \\<longrightarrow>\n                   x \\<in> S \\<longrightarrow>\n                   (\\<forall>t\\<in>U x. I (\\<phi> t x));\n        x \\<in> S;\n        \\<forall>t\\<in>U x.\n           \\<phi> t x \\<in> S \\<longrightarrow> I (\\<phi> t x)\\<rbrakk>\n       \\<Longrightarrow> I x\n 2. \\<And>x t.\n       \\<lbrakk>\\<forall>x.\n                   (x \\<in> S \\<longrightarrow> I x) =\n                   (x \\<in> S \\<longrightarrow>\n                    (\\<forall>t\\<in>U x.\n                        \\<phi> t x \\<in> S \\<longrightarrow>\n                        I (\\<phi> t x)));\n        I x; x \\<in> S; t \\<in> U x\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)", "apply(erule_tac x=0 in ballE)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>\\<forall>x.\n                   I x \\<longrightarrow>\n                   x \\<in> S \\<longrightarrow>\n                   (\\<forall>t\\<in>U x. I (\\<phi> t x));\n        x \\<in> S;\n        \\<phi> 0 x \\<in> S \\<longrightarrow> I (\\<phi> 0 x)\\<rbrakk>\n       \\<Longrightarrow> I x\n 2. \\<And>x.\n       \\<lbrakk>\\<forall>x.\n                   I x \\<longrightarrow>\n                   x \\<in> S \\<longrightarrow>\n                   (\\<forall>t\\<in>U x. I (\\<phi> t x));\n        x \\<in> S; 0 \\<notin> U x\\<rbrakk>\n       \\<Longrightarrow> I x\n 3. \\<And>x t.\n       \\<lbrakk>\\<forall>x.\n                   (x \\<in> S \\<longrightarrow> I x) =\n                   (x \\<in> S \\<longrightarrow>\n                    (\\<forall>t\\<in>U x.\n                        \\<phi> t x \\<in> S \\<longrightarrow>\n                        I (\\<phi> t x)));\n        I x; x \\<in> S; t \\<in> U x\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)", "using init_time in_domain ivp(2) assms"], ["proof (prove)\nusing this:\n  0 \\<in> T\n  ?s \\<in> S \\<Longrightarrow>\n  (\\<lambda>t. \\<phi> t ?s) \\<in> T \\<rightarrow> S\n  ?s \\<in> S \\<Longrightarrow> \\<phi> 0 ?s = ?s\n  ?s \\<in> S \\<Longrightarrow>\n  0 \\<in> U ?s \\<and> is_interval (U ?s) \\<and> U ?s \\<subseteq> T\n\ngoal (3 subgoals):\n 1. \\<And>x.\n       \\<lbrakk>\\<forall>x.\n                   I x \\<longrightarrow>\n                   x \\<in> S \\<longrightarrow>\n                   (\\<forall>t\\<in>U x. I (\\<phi> t x));\n        x \\<in> S;\n        \\<phi> 0 x \\<in> S \\<longrightarrow> I (\\<phi> 0 x)\\<rbrakk>\n       \\<Longrightarrow> I x\n 2. \\<And>x.\n       \\<lbrakk>\\<forall>x.\n                   I x \\<longrightarrow>\n                   x \\<in> S \\<longrightarrow>\n                   (\\<forall>t\\<in>U x. I (\\<phi> t x));\n        x \\<in> S; 0 \\<notin> U x\\<rbrakk>\n       \\<Longrightarrow> I x\n 3. \\<And>x t.\n       \\<lbrakk>\\<forall>x.\n                   (x \\<in> S \\<longrightarrow> I x) =\n                   (x \\<in> S \\<longrightarrow>\n                    (\\<forall>t\\<in>U x.\n                        \\<phi> t x \\<in> S \\<longrightarrow>\n                        I (\\<phi> t x)));\n        I x; x \\<in> S; t \\<in> U x\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)", "apply(force, force)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x t.\n       \\<lbrakk>\\<forall>x.\n                   (x \\<in> S \\<longrightarrow> I x) =\n                   (x \\<in> S \\<longrightarrow>\n                    (\\<forall>t\\<in>U x.\n                        \\<phi> t x \\<in> S \\<longrightarrow>\n                        I (\\<phi> t x)));\n        I x; x \\<in> S; t \\<in> U x\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)", "apply(erule_tac x=x in allE, clarsimp, erule_tac x=t in ballE)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x t.\n       \\<lbrakk>I x; x \\<in> S; t \\<in> U x;\n        \\<phi> t x \\<in> S \\<longrightarrow> I (\\<phi> t x)\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)\n 2. \\<And>x t.\n       \\<lbrakk>I x; x \\<in> S; t \\<in> U x; t \\<notin> U x\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)", "using in_domain ivp(2) assms"], ["proof (prove)\nusing this:\n  ?s \\<in> S \\<Longrightarrow>\n  (\\<lambda>t. \\<phi> t ?s) \\<in> T \\<rightarrow> S\n  ?s \\<in> S \\<Longrightarrow> \\<phi> 0 ?s = ?s\n  ?s \\<in> S \\<Longrightarrow>\n  0 \\<in> U ?s \\<and> is_interval (U ?s) \\<and> U ?s \\<subseteq> T\n\ngoal (2 subgoals):\n 1. \\<And>x t.\n       \\<lbrakk>I x; x \\<in> S; t \\<in> U x;\n        \\<phi> t x \\<in> S \\<longrightarrow> I (\\<phi> t x)\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)\n 2. \\<And>x t.\n       \\<lbrakk>I x; x \\<in> S; t \\<in> U x; t \\<notin> U x\\<rbrakk>\n       \\<Longrightarrow> I (\\<phi> t x)", "by force+"], ["", "lemma diff_inv_eq_inv_set: \n  \"diff_invariant I (\\<lambda>t. f) (\\<lambda>s. T) S 0 (\\<lambda>s. True) = (\\<forall>s. I s \\<longrightarrow> \\<gamma>\\<^sup>\\<phi> s \\<subseteq> {s. I s})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. diff_invariant I (\\<lambda>t. f) (\\<lambda>s. T) S 0\n     (\\<lambda>s. True) =\n    (\\<forall>s.\n        I s \\<longrightarrow> \\<gamma>\\<^sup>\\<phi> s \\<subseteq> {s. I s})", "unfolding diff_inv_eq_inv_set orbit_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<forall>s.\n        I s \\<longrightarrow>\n        x\\<acute>=\\<lambda>t. f & \\<lambda>s. True on \\<lambda>s. T S @ 0 s\n        \\<subseteq> Collect I) =\n    (\\<forall>s.\n        I s \\<longrightarrow>\n        x\\<acute>=\\<lambda>t. f & \\<lambda>s. True on \\<lambda>s. T S @ 0 s\n        \\<subseteq> {s. I s})", "by simp"], ["", "end"], ["", "lemma fbox_g_odei: \"P \\<le> I \\<Longrightarrow> I \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] I \\<Longrightarrow> (\\<lambda>s. I s \\<and> G s) \\<le> Q \\<Longrightarrow> \n  P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0 DINV I] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> I; I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I;\n     (\\<lambda>s. I s \\<and> G s) \\<le> Q\\<rbrakk>\n    \\<Longrightarrow> P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0 DINV I ] Q", "unfolding g_ode_inv_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> I; I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I;\n     (\\<lambda>s. I s \\<and> G s) \\<le> Q\\<rbrakk>\n    \\<Longrightarrow> P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "apply(rule_tac b=\"|x\\<acute>= f & G on U S @ t\\<^sub>0] I\" in order.trans)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<lbrakk>P \\<le> I; I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I;\n     (\\<lambda>s. I s \\<and> G s) \\<le> Q\\<rbrakk>\n    \\<Longrightarrow> P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I\n 2. \\<lbrakk>P \\<le> I; I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I;\n     (\\<lambda>s. I s \\<and> G s) \\<le> Q\\<rbrakk>\n    \\<Longrightarrow> |x\\<acute>=f & G on U S @ t\\<^sub>0] I\n                      \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "apply(rule_tac I=\"I\" in fbox_g_orbital_inv, simp_all)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> I; diff_invariant I f U S t\\<^sub>0 G;\n     (\\<lambda>s. I s \\<and> G s) \\<le> Q\\<rbrakk>\n    \\<Longrightarrow> |x\\<acute>=f & G on U S @ t\\<^sub>0] I\n                      \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "apply(subst fbox_g_orbital_guard, simp)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P \\<le> I; diff_invariant I f U S t\\<^sub>0 G;\n     (\\<lambda>s. I s \\<and> G s) \\<le> Q\\<rbrakk>\n    \\<Longrightarrow> |x\\<acute>=f & G on U S @ t\\<^sub>0] (\\<lambda>s.\n                         G s \\<and> I s)\n                      \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "by (rule fbox_iso, force)"], ["", "subsection \\<open> Derivation of the rules of dL \\<close>"], ["", "text \\<open> We derive rules of differential dynamic logic (dL). This allows the components to reason \nin the style of that logic. \\<close>"], ["", "abbreviation g_dl_ode ::\"(('a::banach)\\<Rightarrow>'a) \\<Rightarrow> 'a pred \\<Rightarrow> 'a \\<Rightarrow> 'a set\" \n  (\"(1x\\<acute>=_ & _)\") where \"(x\\<acute>=f & G) \\<equiv> (x\\<acute>=(\\<lambda>t. f) & G on (\\<lambda>s. {t. t \\<ge> 0}) UNIV @ 0)\""], ["", "abbreviation g_dl_ode_inv ::\"(('a::banach)\\<Rightarrow>'a) \\<Rightarrow> 'a pred \\<Rightarrow> 'a pred \\<Rightarrow> 'a \\<Rightarrow> 'a set\" (\"(1x\\<acute>=_ & _ DINV _)\") \n  where \"(x\\<acute>=f & G DINV I) \\<equiv> (x\\<acute>=(\\<lambda>t. f) & G on (\\<lambda>s. {t. t \\<ge> 0}) UNIV @ 0 DINV I)\""], ["", "lemma diff_solve_axiom1: \n  assumes \"local_flow f UNIV UNIV \\<phi>\"\n  shows \"|x\\<acute>= f & G] Q = \n  (\\<lambda>s. \\<forall>t\\<ge>0. (\\<forall>\\<tau>\\<in>{0..t}. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=\\<lambda>t. f & G on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0] Q =\n    (\\<lambda>s.\n        \\<forall>t\\<ge>0.\n           (\\<forall>\\<tau>\\<in>{0..t}.\n               G (\\<phi> \\<tau> s)) \\<longrightarrow>\n           Q (\\<phi> t s))", "by (subst local_flow.fbox_g_ode_subset[OF assms], auto)"], ["", "lemma diff_solve_axiom2: \n  fixes c::\"'a::{heine_borel, banach}\"\n  shows \"|x\\<acute>=(\\<lambda>s. c) & G] Q = \n  (\\<lambda>s. \\<forall>t\\<ge>0. (\\<forall>\\<tau>\\<in>{0..t}. G (s + \\<tau> *\\<^sub>R c)) \\<longrightarrow> Q (s + t *\\<^sub>R c))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=\\<lambda>t s.\n                  c & G on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0] Q =\n    (\\<lambda>s.\n        \\<forall>t\\<ge>0.\n           (\\<forall>\\<tau>\\<in>{0..t}.\n               G (s + \\<tau> *\\<^sub>R c)) \\<longrightarrow>\n           Q (s + t *\\<^sub>R c))", "by (subst local_flow.fbox_g_ode_subset[OF line_is_local_flow, of UNIV], auto)"], ["", "lemma diff_solve_rule:\n  assumes \"local_flow f UNIV UNIV \\<phi>\"\n    and \"\\<forall>s. P s \\<longrightarrow> (\\<forall>t\\<ge>0. (\\<forall>\\<tau>\\<in>{0..t}. G (\\<phi> \\<tau> s)) \\<longrightarrow> Q (\\<phi> t s))\"\n  shows \"P \\<le> |x\\<acute>= f & G] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |x\\<acute>=\\<lambda>t.\n                          f & G on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0] Q", "using assms"], ["proof (prove)\nusing this:\n  local_flow f UNIV UNIV \\<phi>\n  \\<forall>s.\n     P s \\<longrightarrow>\n     (\\<forall>t\\<ge>0.\n         (\\<forall>\\<tau>\\<in>{0..t}. G (\\<phi> \\<tau> s)) \\<longrightarrow>\n         Q (\\<phi> t s))\n\ngoal (1 subgoal):\n 1. P \\<le> |x\\<acute>=\\<lambda>t.\n                          f & G on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0] Q", "by(subst local_flow.fbox_g_ode_subset[OF assms(1)]) auto"], ["", "lemma diff_weak_axiom1: \"( |x\\<acute>= f & G on U S @ t\\<^sub>0] G) s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (|x\\<acute>=f & G on U S @ t\\<^sub>0] G) s", "unfolding fbox_def g_orbital_eq"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>s'.\n       s' \\<in> {X t |t X.\n                 t \\<in> U s \\<and>\n                 \\<P> X (down (U s) t) \\<subseteq> Collect G \\<and>\n                 X \\<in> Sols f U S t\\<^sub>0 s} \\<longrightarrow>\n       G s'", "by auto"], ["", "lemma diff_weak_axiom2: \"|x\\<acute>= f & G on T S @ t\\<^sub>0] Q = |x\\<acute>= f & G on T S @ t\\<^sub>0] (\\<lambda>s. G s \\<longrightarrow> Q s)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=f & G on T S @ t\\<^sub>0] Q =\n    |x\\<acute>=f & G on T S @ t\\<^sub>0] (\\<lambda>s.\n       G s \\<longrightarrow> Q s)", "unfolding fbox_g_orbital image_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>s.\n        \\<forall>X\\<in>Sols f T S t\\<^sub>0 s.\n           \\<forall>t\\<in>T s.\n              (\\<forall>\\<tau>\\<in>down (T s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              Q (X t)) =\n    (\\<lambda>s.\n        \\<forall>X\\<in>Sols f T S t\\<^sub>0 s.\n           \\<forall>t\\<in>T s.\n              (\\<forall>\\<tau>\\<in>down (T s) t.\n                  G (X \\<tau>)) \\<longrightarrow>\n              G (X t) \\<longrightarrow> Q (X t))", "by force"], ["", "lemma diff_weak_rule: \"G \\<le> Q \\<Longrightarrow> P \\<le> |x\\<acute>= f & G on T S @ t\\<^sub>0] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. G \\<le> Q \\<Longrightarrow>\n    P \\<le> |x\\<acute>=f & G on T S @ t\\<^sub>0] Q", "by(auto intro: g_orbitalD simp: le_fun_def g_orbital_eq fbox_def)"], ["", "lemma fbox_g_orbital_eq_univD:\n  assumes \"|x\\<acute>= f & G on U S @ t\\<^sub>0] C = (\\<lambda>s. True)\" \n    and \"\\<forall>\\<tau>\\<in>(down (U s) t). x \\<tau> \\<in> (x\\<acute>= f & G on U S @ t\\<^sub>0) s\"\n  shows \"\\<forall>\\<tau>\\<in>(down (U s) t). C (x \\<tau>)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>\\<tau>\\<in>down (U s) t. C (x \\<tau>)", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<tau>. \\<tau> \\<in> down (U s) t \\<Longrightarrow> C (x \\<tau>)", "fix \\<tau>"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>\\<tau>. \\<tau> \\<in> down (U s) t \\<Longrightarrow> C (x \\<tau>)", "assume \"\\<tau> \\<in> (down (U s) t)\""], ["proof (state)\nthis:\n  \\<tau> \\<in> down (U s) t\n\ngoal (1 subgoal):\n 1. \\<And>\\<tau>. \\<tau> \\<in> down (U s) t \\<Longrightarrow> C (x \\<tau>)", "hence \"x \\<tau> \\<in> (x\\<acute>= f & G on U S @ t\\<^sub>0) s\""], ["proof (prove)\nusing this:\n  \\<tau> \\<in> down (U s) t\n\ngoal (1 subgoal):\n 1. x \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "using assms(2)"], ["proof (prove)\nusing this:\n  \\<tau> \\<in> down (U s) t\n  \\<forall>\\<tau>\\<in>down (U s) t.\n     x \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. x \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "by blast"], ["proof (state)\nthis:\n  x \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<And>\\<tau>. \\<tau> \\<in> down (U s) t \\<Longrightarrow> C (x \\<tau>)", "also"], ["proof (state)\nthis:\n  x \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<And>\\<tau>. \\<tau> \\<in> down (U s) t \\<Longrightarrow> C (x \\<tau>)", "have \"\\<forall>s'. s' \\<in> (x\\<acute>= f & G on U S @ t\\<^sub>0) s \\<longrightarrow> C s'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>s'.\n       s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow> C s'", "using assms(1)"], ["proof (prove)\nusing this:\n  |x\\<acute>=f & G on U S @ t\\<^sub>0] C = (\\<lambda>s. True)\n\ngoal (1 subgoal):\n 1. \\<forall>s'.\n       s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow> C s'", "unfolding fbox_def"], ["proof (prove)\nusing this:\n  (\\<lambda>s.\n      \\<forall>s'.\n         s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow>\n         C s') =\n  (\\<lambda>s. True)\n\ngoal (1 subgoal):\n 1. \\<forall>s'.\n       s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow> C s'", "by meson"], ["proof (state)\nthis:\n  \\<forall>s'.\n     s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow> C s'\n\ngoal (1 subgoal):\n 1. \\<And>\\<tau>. \\<tau> \\<in> down (U s) t \\<Longrightarrow> C (x \\<tau>)", "ultimately"], ["proof (chain)\npicking this:\n  x \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n  \\<forall>s'.\n     s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow> C s'", "show \"C (x \\<tau>)\""], ["proof (prove)\nusing this:\n  x \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n  \\<forall>s'.\n     s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow> C s'\n\ngoal (1 subgoal):\n 1. C (x \\<tau>)", "by blast"], ["proof (state)\nthis:\n  C (x \\<tau>)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma diff_cut_axiom:\n  assumes \"|x\\<acute>= f & G on U S @ t\\<^sub>0] C = (\\<lambda>s. True)\"\n  shows \"|x\\<acute>= f & G on U S @ t\\<^sub>0] Q = |x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=f & G on U S @ t\\<^sub>0] Q =\n    |x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0] Q", "proof(rule_tac f=\"\\<lambda> x. |x] Q\" in HOL.arg_cong, rule ext, rule subset_antisym)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "fix s"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "{"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "fix s'"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "assume \"s' \\<in> (x\\<acute>= f & G on U S @ t\\<^sub>0) s\""], ["proof (state)\nthis:\n  s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "then"], ["proof (chain)\npicking this:\n  s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "obtain \\<tau>::real and X where x_ivp: \"X \\<in> Sols f U S t\\<^sub>0 s\" \n      and \"X \\<tau> = s'\" and \"\\<tau> \\<in> U s\" and guard_x:\"\\<P> X (down (U s) \\<tau>) \\<subseteq> {s. G s}\""], ["proof (prove)\nusing this:\n  s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. (\\<And>X \\<tau>.\n        \\<lbrakk>X \\<in> Sols f U S t\\<^sub>0 s; X \\<tau> = s';\n         \\<tau> \\<in> U s;\n         \\<P> X (down (U s) \\<tau>) \\<subseteq> {s. G s}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "using g_orbitalD[of s' \"f\" G U S t\\<^sub>0 s]"], ["proof (prove)\nusing this:\n  s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n  \\<lbrakk>s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s;\n   \\<And>X t.\n      \\<lbrakk>X \\<in> Sols f U S t\\<^sub>0 s; X t = s'; t \\<in> U s;\n       \\<P> X (down (U s) t) \\<subseteq> {s. G s}\\<rbrakk>\n      \\<Longrightarrow> ?thesis\\<rbrakk>\n  \\<Longrightarrow> ?thesis\n\ngoal (1 subgoal):\n 1. (\\<And>X \\<tau>.\n        \\<lbrakk>X \\<in> Sols f U S t\\<^sub>0 s; X \\<tau> = s';\n         \\<tau> \\<in> U s;\n         \\<P> X (down (U s) \\<tau>) \\<subseteq> {s. G s}\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  X \\<in> Sols f U S t\\<^sub>0 s\n  X \\<tau> = s'\n  \\<tau> \\<in> U s\n  \\<P> X (down (U s) \\<tau>) \\<subseteq> {s. G s}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "have \"\\<forall>t\\<in>(down (U s) \\<tau>). \\<P> X (down (U s) t) \\<subseteq> {s. G s}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>.\n       \\<P> X (down (U s) t) \\<subseteq> {s. G s}", "using guard_x"], ["proof (prove)\nusing this:\n  \\<P> X (down (U s) \\<tau>) \\<subseteq> {s. G s}\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>.\n       \\<P> X (down (U s) t) \\<subseteq> {s. G s}", "by (force simp: image_def)"], ["proof (state)\nthis:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     \\<P> X (down (U s) t) \\<subseteq> {s. G s}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "also"], ["proof (state)\nthis:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     \\<P> X (down (U s) t) \\<subseteq> {s. G s}\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "have \"\\<forall>t\\<in>(down (U s) \\<tau>). t \\<in> U s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>. t \\<in> U s", "using \\<open>\\<tau> \\<in> U s\\<close> closed_segment_subset_interval"], ["proof (prove)\nusing this:\n  \\<tau> \\<in> U s\n  \\<lbrakk>is_interval ?T; ?a \\<in> ?T; ?b \\<in> ?T\\<rbrakk>\n  \\<Longrightarrow> {?a--?b} \\<subseteq> ?T\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>. t \\<in> U s", "by auto"], ["proof (state)\nthis:\n  \\<forall>t\\<in>down (U s) \\<tau>. t \\<in> U s\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "ultimately"], ["proof (chain)\npicking this:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     \\<P> X (down (U s) t) \\<subseteq> {s. G s}\n  \\<forall>t\\<in>down (U s) \\<tau>. t \\<in> U s", "have \"\\<forall>t\\<in>(down (U s) \\<tau>). X t \\<in> (x\\<acute>= f & G on U S @ t\\<^sub>0) s\""], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     \\<P> X (down (U s) t) \\<subseteq> {s. G s}\n  \\<forall>t\\<in>down (U s) \\<tau>. t \\<in> U s\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>.\n       X t \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "using g_orbitalI[OF x_ivp]"], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     \\<P> X (down (U s) t) \\<subseteq> {s. G s}\n  \\<forall>t\\<in>down (U s) \\<tau>. t \\<in> U s\n  \\<lbrakk>?t \\<in> U s;\n   \\<P> X (down (U s) ?t) \\<subseteq> {s. ?G s}\\<rbrakk>\n  \\<Longrightarrow> X ?t \\<in> x\\<acute>=f & ?G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>.\n       X t \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "by (metis (mono_tags, lifting))"], ["proof (state)\nthis:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     X t \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "hence \"\\<forall>t\\<in>(down (U s) \\<tau>). C (X t)\""], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     X t \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>. C (X t)", "using assms"], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     X t \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n  |x\\<acute>=f & G on U S @ t\\<^sub>0] C = (\\<lambda>s. True)\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>. C (X t)", "unfolding fbox_def"], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>down (U s) \\<tau>.\n     X t \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n  (\\<lambda>s.\n      \\<forall>s'.\n         s' \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<longrightarrow>\n         C s') =\n  (\\<lambda>s. True)\n\ngoal (1 subgoal):\n 1. \\<forall>t\\<in>down (U s) \\<tau>. C (X t)", "by meson"], ["proof (state)\nthis:\n  \\<forall>t\\<in>down (U s) \\<tau>. C (X t)\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "hence \"s' \\<in> (x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0) s\""], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>down (U s) \\<tau>. C (X t)\n\ngoal (1 subgoal):\n 1. s' \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s", "using g_orbitalI[OF x_ivp \\<open>\\<tau> \\<in> U s\\<close>] guard_x \\<open>X \\<tau> = s'\\<close>"], ["proof (prove)\nusing this:\n  \\<forall>t\\<in>down (U s) \\<tau>. C (X t)\n  \\<P> X (down (U s) \\<tau>) \\<subseteq> {s. ?G s} \\<Longrightarrow>\n  X \\<tau> \\<in> x\\<acute>=f & ?G on U S @ t\\<^sub>0 s\n  \\<P> X (down (U s) \\<tau>) \\<subseteq> {s. G s}\n  X \\<tau> = s'\n\ngoal (1 subgoal):\n 1. s' \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s", "by fastforce"], ["proof (state)\nthis:\n  s' \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "}"], ["proof (state)\nthis:\n  ?s'2 \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<Longrightarrow>\n  ?s'2 \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n\ngoal (2 subgoals):\n 1. \\<And>x.\n       x\\<acute>=f & G on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & \\<lambda>s.\n                                    G s \\<and> C s on U S @ t\\<^sub>0\n                    x\n 2. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "thus \"(x\\<acute>= f & G on U S @ t\\<^sub>0) s \\<subseteq> (x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0) s\""], ["proof (prove)\nusing this:\n  ?s'2 \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s \\<Longrightarrow>\n  ?s'2 \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. x\\<acute>=f & G on U S @ t\\<^sub>0 s\n    \\<subseteq> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0\n                 s", "by blast"], ["proof (state)\nthis:\n  x\\<acute>=f & G on U S @ t\\<^sub>0 s\n  \\<subseteq> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 x\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 x", "show \"\\<And>s. (x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0) s \\<subseteq> (x\\<acute>= f & G on U S @ t\\<^sub>0) s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s.\n       x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n       \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "by (auto simp: g_orbital_eq)"], ["proof (state)\nthis:\n  x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 ?s\n  \\<subseteq> x\\<acute>=f & G on U S @ t\\<^sub>0 ?s\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma diff_cut_rule:\n  assumes fbox_C: \"P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] C\"\n    and fbox_Q: \"P \\<le> |x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0] Q\"\n  shows \"P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "proof(subst fbox_def, subst g_orbital_eq, clarsimp)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x t X.\n       \\<lbrakk>P x; t \\<in> U x;\n        \\<forall>xa.\n           xa \\<in> U x \\<and> xa \\<le> t \\<longrightarrow> G (X xa);\n        X \\<in> Sols f U S t\\<^sub>0 x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "fix t::real and X::\"real \\<Rightarrow> 'a\" and s"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x t X.\n       \\<lbrakk>P x; t \\<in> U x;\n        \\<forall>xa.\n           xa \\<in> U x \\<and> xa \\<le> t \\<longrightarrow> G (X xa);\n        X \\<in> Sols f U S t\\<^sub>0 x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "assume \"P s\" and \"t \\<in> U s\"\n    and x_ivp:\"X \\<in> Sols f U S t\\<^sub>0 s\" \n    and guard_x:\"\\<forall>\\<tau>. \\<tau> \\<in> U s \\<and> \\<tau> \\<le> t \\<longrightarrow> G (X \\<tau>)\""], ["proof (state)\nthis:\n  P s\n  t \\<in> U s\n  X \\<in> Sols f U S t\\<^sub>0 s\n  \\<forall>\\<tau>.\n     \\<tau> \\<in> U s \\<and> \\<tau> \\<le> t \\<longrightarrow> G (X \\<tau>)\n\ngoal (1 subgoal):\n 1. \\<And>x t X.\n       \\<lbrakk>P x; t \\<in> U x;\n        \\<forall>xa.\n           xa \\<in> U x \\<and> xa \\<le> t \\<longrightarrow> G (X xa);\n        X \\<in> Sols f U S t\\<^sub>0 x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "have \"\\<forall>\\<tau>\\<in>(down (U s) t). X \\<tau> \\<in> (x\\<acute>= f & G on U S @ t\\<^sub>0) s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>\\<tau>\\<in>down (U s) t.\n       X \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "using g_orbitalI[OF x_ivp] guard_x"], ["proof (prove)\nusing this:\n  \\<lbrakk>?t \\<in> U s;\n   \\<P> X (down (U s) ?t) \\<subseteq> {s. ?G s}\\<rbrakk>\n  \\<Longrightarrow> X ?t \\<in> x\\<acute>=f & ?G on U S @ t\\<^sub>0 s\n  \\<forall>\\<tau>.\n     \\<tau> \\<in> U s \\<and> \\<tau> \\<le> t \\<longrightarrow> G (X \\<tau>)\n\ngoal (1 subgoal):\n 1. \\<forall>\\<tau>\\<in>down (U s) t.\n       X \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "unfolding image_le_pred"], ["proof (prove)\nusing this:\n  \\<lbrakk>?t \\<in> U s; \\<forall>x\\<in>down (U s) ?t. ?G (X x)\\<rbrakk>\n  \\<Longrightarrow> X ?t \\<in> x\\<acute>=f & ?G on U S @ t\\<^sub>0 s\n  \\<forall>\\<tau>.\n     \\<tau> \\<in> U s \\<and> \\<tau> \\<le> t \\<longrightarrow> G (X \\<tau>)\n\ngoal (1 subgoal):\n 1. \\<forall>\\<tau>\\<in>down (U s) t.\n       X \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s", "by auto"], ["proof (state)\nthis:\n  \\<forall>\\<tau>\\<in>down (U s) t.\n     X \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<And>x t X.\n       \\<lbrakk>P x; t \\<in> U x;\n        \\<forall>xa.\n           xa \\<in> U x \\<and> xa \\<le> t \\<longrightarrow> G (X xa);\n        X \\<in> Sols f U S t\\<^sub>0 x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "hence \"\\<forall>\\<tau>\\<in>(down (U s) t). C (X \\<tau>)\""], ["proof (prove)\nusing this:\n  \\<forall>\\<tau>\\<in>down (U s) t.\n     X \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<forall>\\<tau>\\<in>down (U s) t. C (X \\<tau>)", "using fbox_C \\<open>P s\\<close>"], ["proof (prove)\nusing this:\n  \\<forall>\\<tau>\\<in>down (U s) t.\n     X \\<tau> \\<in> x\\<acute>=f & G on U S @ t\\<^sub>0 s\n  P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] C\n  P s\n\ngoal (1 subgoal):\n 1. \\<forall>\\<tau>\\<in>down (U s) t. C (X \\<tau>)", "by (subst (asm) fbox_def, auto)"], ["proof (state)\nthis:\n  \\<forall>\\<tau>\\<in>down (U s) t. C (X \\<tau>)\n\ngoal (1 subgoal):\n 1. \\<And>x t X.\n       \\<lbrakk>P x; t \\<in> U x;\n        \\<forall>xa.\n           xa \\<in> U x \\<and> xa \\<le> t \\<longrightarrow> G (X xa);\n        X \\<in> Sols f U S t\\<^sub>0 x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "hence \"X t \\<in> (x\\<acute>= f & (\\<lambda>s. G s \\<and> C s) on U S @ t\\<^sub>0) s\""], ["proof (prove)\nusing this:\n  \\<forall>\\<tau>\\<in>down (U s) t. C (X \\<tau>)\n\ngoal (1 subgoal):\n 1. X t \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s", "using guard_x \\<open>t \\<in> U s\\<close>"], ["proof (prove)\nusing this:\n  \\<forall>\\<tau>\\<in>down (U s) t. C (X \\<tau>)\n  \\<forall>\\<tau>.\n     \\<tau> \\<in> U s \\<and> \\<tau> \\<le> t \\<longrightarrow> G (X \\<tau>)\n  t \\<in> U s\n\ngoal (1 subgoal):\n 1. X t \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s", "by (auto intro!: g_orbitalI x_ivp)"], ["proof (state)\nthis:\n  X t \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. \\<And>x t X.\n       \\<lbrakk>P x; t \\<in> U x;\n        \\<forall>xa.\n           xa \\<in> U x \\<and> xa \\<le> t \\<longrightarrow> G (X xa);\n        X \\<in> Sols f U S t\\<^sub>0 x\\<rbrakk>\n       \\<Longrightarrow> Q (X t)", "thus \"Q (X t)\""], ["proof (prove)\nusing this:\n  X t \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n\ngoal (1 subgoal):\n 1. Q (X t)", "using \\<open>P s\\<close> fbox_Q"], ["proof (prove)\nusing this:\n  X t \\<in> x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0 s\n  P s\n  P \\<le> |x\\<acute>=f & \\<lambda>s. G s \\<and> C s on U S @ t\\<^sub>0] Q\n\ngoal (1 subgoal):\n 1. Q (X t)", "by (subst (asm) fbox_def) auto"], ["proof (state)\nthis:\n  Q (X t)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma diff_inv_axiom1:\n  assumes \"G s \\<longrightarrow> I s\" and \"diff_invariant I (\\<lambda>t. f) (\\<lambda>s. {t. t \\<ge> 0}) UNIV 0 G\"\n  shows \"( |x\\<acute>= f & G] I) s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (|x\\<acute>=\\<lambda>t. f & G on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0] I)\n     s", "using assms"], ["proof (prove)\nusing this:\n  G s \\<longrightarrow> I s\n  diff_invariant I (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 G\n\ngoal (1 subgoal):\n 1. (|x\\<acute>=\\<lambda>t. f & G on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0] I)\n     s", "unfolding fbox_g_orbital diff_invariant_eq"], ["proof (prove)\nusing this:\n  G s \\<longrightarrow> I s\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0))\n                      UNIV 0 s.\n         \\<forall>t\\<in>Collect ((\\<le>) 0).\n            (\\<forall>\\<tau>\\<in>down (Collect ((\\<le>) 0)) t.\n                G (X \\<tau>)) \\<longrightarrow>\n            I (X t))\n\ngoal (1 subgoal):\n 1. \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0))\n                    UNIV 0 s.\n       \\<forall>t\\<in>Collect ((\\<le>) 0).\n          (\\<forall>\\<tau>\\<in>down (Collect ((\\<le>) 0)) t.\n              G (X \\<tau>)) \\<longrightarrow>\n          I (X t)", "apply clarsimp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>X t.\n       \\<lbrakk>G s \\<longrightarrow> I s;\n        \\<forall>s.\n           I s \\<longrightarrow>\n           (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                            (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s.\n               \\<forall>t\\<ge>0.\n                  (\\<forall>\\<tau>.\n                      0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                      G (X \\<tau>)) \\<longrightarrow>\n                  I (X t));\n        X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0)) UNIV\n                 0 s;\n        0 \\<le> t;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>)\\<rbrakk>\n       \\<Longrightarrow> I (X t)", "by (erule_tac x=s in allE, frule ivp_solsD(2), clarsimp)"], ["", "lemma diff_inv_axiom2:\n  assumes \"picard_lindeloef (\\<lambda>t. f) UNIV UNIV 0\"\n    and \"\\<And>s. {t::real. t \\<ge> 0} \\<subseteq> picard_lindeloef.ex_ivl (\\<lambda>t. f) UNIV UNIV 0 s\"\n    and \"diff_invariant I (\\<lambda>t. f) (\\<lambda>s. {t::real. t \\<ge> 0}) UNIV 0 G\"\n  shows \"|x\\<acute>= f & G] I = |(\\<lambda>s. {x. s = x \\<and> G s})] I\""], ["proof (prove)\ngoal (1 subgoal):\n 1. |x\\<acute>=\\<lambda>t. f & G on \\<lambda>s. {t. 0 \\<le> t} UNIV @ 0] I =\n    |(\\<lambda>s. {x. s = x \\<and> G s})] I", "proof(unfold fbox_g_orbital, subst fbox_def, clarsimp simp: fun_eq_iff)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "fix s"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "let \"?ex_ivl s\" = \"picard_lindeloef.ex_ivl (\\<lambda>t. f) UNIV UNIV 0 s\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "let \"?lhs s\" = \n    \"\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. t \\<ge> 0}) UNIV 0 s. \\<forall>t\\<ge>0. (\\<forall>\\<tau>. 0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow> G (X \\<tau>)) \\<longrightarrow> I (X t)\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "obtain X where xivp1: \"X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. ?ex_ivl s) UNIV 0 s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>X.\n        X \\<in> Sols (\\<lambda>t. f)\n                 (ll_on_open.existence_ivl UNIV (\\<lambda>t. f) UNIV 0) UNIV\n                 0 s \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "using picard_lindeloef.flow_in_ivp_sols_ex_ivl[OF assms(1)]"], ["proof (prove)\nusing this:\n  ?s \\<in> UNIV \\<Longrightarrow>\n  ll_on_open.flow UNIV (\\<lambda>t. f) UNIV 0 ?s\n  \\<in> Sols (\\<lambda>t. f)\n         (ll_on_open.existence_ivl UNIV (\\<lambda>t. f) UNIV 0) UNIV 0 ?s\n\ngoal (1 subgoal):\n 1. (\\<And>X.\n        X \\<in> Sols (\\<lambda>t. f)\n                 (ll_on_open.existence_ivl UNIV (\\<lambda>t. f) UNIV 0) UNIV\n                 0 s \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  X \\<in> Sols (\\<lambda>t. f)\n           (ll_on_open.existence_ivl UNIV (\\<lambda>t. f) UNIV 0) UNIV 0 s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "have xivp2: \"X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s", "by (rule in_ivp_sols_subset[OF _ _ xivp1], simp_all add: assms(2))"], ["proof (state)\nthis:\n  X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "hence shyp: \"X 0 = s\""], ["proof (prove)\nusing this:\n  X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s\n\ngoal (1 subgoal):\n 1. X 0 = s", "using ivp_solsD"], ["proof (prove)\nusing this:\n  X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s\n  ?X \\<in> Sols ?f ?U ?S ?t\\<^sub>0 ?s \\<Longrightarrow>\n   D ?X = (\\<lambda>t. ?f t (?X t)) on ?U ?s\n  ?X \\<in> Sols ?f ?U ?S ?t\\<^sub>0 ?s \\<Longrightarrow> ?X ?t\\<^sub>0 = ?s\n  ?X \\<in> Sols ?f ?U ?S ?t\\<^sub>0 ?s \\<Longrightarrow>\n  ?X \\<in> ?U ?s \\<rightarrow> ?S\n  ?X \\<in> Sols ?f ?U ?S ?t\\<^sub>0 ?s \\<Longrightarrow>\n  ?t\\<^sub>0 \\<in> ?U ?s\n\ngoal (1 subgoal):\n 1. X 0 = s", "by auto"], ["proof (state)\nthis:\n  X 0 = s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "have dinv: \"\\<forall>s. I s \\<longrightarrow> ?lhs s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>s.\n       I s \\<longrightarrow>\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t})\n                        UNIV 0 s.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t))", "using assms(3)"], ["proof (prove)\nusing this:\n  diff_invariant I (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 G\n\ngoal (1 subgoal):\n 1. \\<forall>s.\n       I s \\<longrightarrow>\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t})\n                        UNIV 0 s.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t))", "unfolding diff_invariant_eq"], ["proof (prove)\nusing this:\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. Collect ((\\<le>) 0))\n                      UNIV 0 s.\n         \\<forall>t\\<in>Collect ((\\<le>) 0).\n            (\\<forall>\\<tau>\\<in>down (Collect ((\\<le>) 0)) t.\n                G (X \\<tau>)) \\<longrightarrow>\n            I (X t))\n\ngoal (1 subgoal):\n 1. \\<forall>s.\n       I s \\<longrightarrow>\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t})\n                        UNIV 0 s.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t))", "by auto"], ["proof (state)\nthis:\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV\n                      0 s.\n         \\<forall>t\\<ge>0.\n            (\\<forall>\\<tau>.\n                0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                G (X \\<tau>)) \\<longrightarrow>\n            I (X t))\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "{"], ["proof (state)\nthis:\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV\n                      0 s.\n         \\<forall>t\\<ge>0.\n            (\\<forall>\\<tau>.\n                0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                G (X \\<tau>)) \\<longrightarrow>\n            I (X t))\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "assume \"?lhs s\" and \"G s\""], ["proof (state)\nthis:\n  \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s.\n     \\<forall>t\\<ge>0.\n        (\\<forall>\\<tau>.\n            0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n            G (X \\<tau>)) \\<longrightarrow>\n        I (X t)\n  G s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "hence \"I s\""], ["proof (prove)\nusing this:\n  \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s.\n     \\<forall>t\\<ge>0.\n        (\\<forall>\\<tau>.\n            0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n            G (X \\<tau>)) \\<longrightarrow>\n        I (X t)\n  G s\n\ngoal (1 subgoal):\n 1. I s", "by (erule_tac x=X in ballE, erule_tac x=0 in allE, auto simp: shyp xivp2)"], ["proof (state)\nthis:\n  I s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "}"], ["proof (state)\nthis:\n  \\<lbrakk>\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t})\n                           UNIV 0 s.\n              \\<forall>t\\<ge>0.\n                 (\\<forall>\\<tau>.\n                     0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                     G (X \\<tau>)) \\<longrightarrow>\n                 I (X t);\n   G s\\<rbrakk>\n  \\<Longrightarrow> I s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "hence \"?lhs s \\<longrightarrow> (G s \\<longrightarrow> I s)\""], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t})\n                           UNIV 0 s.\n              \\<forall>t\\<ge>0.\n                 (\\<forall>\\<tau>.\n                     0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                     G (X \\<tau>)) \\<longrightarrow>\n                 I (X t);\n   G s\\<rbrakk>\n  \\<Longrightarrow> I s\n\ngoal (1 subgoal):\n 1. (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                     s.\n        \\<forall>t\\<ge>0.\n           (\\<forall>\\<tau>.\n               0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n               G (X \\<tau>)) \\<longrightarrow>\n           I (X t)) \\<longrightarrow>\n    G s \\<longrightarrow> I s", "by blast"], ["proof (state)\nthis:\n  (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                   s.\n      \\<forall>t\\<ge>0.\n         (\\<forall>\\<tau>.\n             0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n             G (X \\<tau>)) \\<longrightarrow>\n         I (X t)) \\<longrightarrow>\n  G s \\<longrightarrow> I s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "moreover"], ["proof (state)\nthis:\n  (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                   s.\n      \\<forall>t\\<ge>0.\n         (\\<forall>\\<tau>.\n             0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n             G (X \\<tau>)) \\<longrightarrow>\n         I (X t)) \\<longrightarrow>\n  G s \\<longrightarrow> I s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "{"], ["proof (state)\nthis:\n  (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                   s.\n      \\<forall>t\\<ge>0.\n         (\\<forall>\\<tau>.\n             0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n             G (X \\<tau>)) \\<longrightarrow>\n         I (X t)) \\<longrightarrow>\n  G s \\<longrightarrow> I s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "assume \"G s \\<longrightarrow> I s\""], ["proof (state)\nthis:\n  G s \\<longrightarrow> I s\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "hence \"?lhs s\""], ["proof (prove)\nusing this:\n  G s \\<longrightarrow> I s\n\ngoal (1 subgoal):\n 1. \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                    s.\n       \\<forall>t\\<ge>0.\n          (\\<forall>\\<tau>.\n              0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n              G (X \\<tau>)) \\<longrightarrow>\n          I (X t)", "apply(clarify, subgoal_tac \"\\<forall>\\<tau>. 0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow> G (X \\<tau>)\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>X t.\n       \\<lbrakk>G s \\<longrightarrow> I s;\n        X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s;\n        0 \\<le> t;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>);\n        G s \\<longrightarrow> I s;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>)\\<rbrakk>\n       \\<Longrightarrow> I (X t)\n 2. \\<And>X t.\n       \\<lbrakk>G s \\<longrightarrow> I s;\n        X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s;\n        0 \\<le> t;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>);\n        G s \\<longrightarrow> I s\\<rbrakk>\n       \\<Longrightarrow> \\<forall>\\<tau>.\n                            0 \\<le> \\<tau> \\<and>\n                            \\<tau> \\<le> t \\<longrightarrow>\n                            G (X \\<tau>)", "apply(erule_tac x=0 in allE, frule ivp_solsD(2), simp)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>X t.\n       \\<lbrakk>X \\<in> Sols (\\<lambda>t. f)\n                         (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s;\n        0 \\<le> t; I s;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>);\n        G s; X 0 = s\\<rbrakk>\n       \\<Longrightarrow> I (X t)\n 2. \\<And>X t.\n       \\<lbrakk>G s \\<longrightarrow> I s;\n        X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s;\n        0 \\<le> t;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>);\n        G s \\<longrightarrow> I s\\<rbrakk>\n       \\<Longrightarrow> \\<forall>\\<tau>.\n                            0 \\<le> \\<tau> \\<and>\n                            \\<tau> \\<le> t \\<longrightarrow>\n                            G (X \\<tau>)", "using dinv"], ["proof (prove)\nusing this:\n  \\<forall>s.\n     I s \\<longrightarrow>\n     (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV\n                      0 s.\n         \\<forall>t\\<ge>0.\n            (\\<forall>\\<tau>.\n                0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                G (X \\<tau>)) \\<longrightarrow>\n            I (X t))\n\ngoal (2 subgoals):\n 1. \\<And>X t.\n       \\<lbrakk>X \\<in> Sols (\\<lambda>t. f)\n                         (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 s;\n        0 \\<le> t; I s;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>);\n        G s; X 0 = s\\<rbrakk>\n       \\<Longrightarrow> I (X t)\n 2. \\<And>X t.\n       \\<lbrakk>G s \\<longrightarrow> I s;\n        X \\<in> Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s;\n        0 \\<le> t;\n        \\<forall>\\<tau>.\n           0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n           G (X \\<tau>);\n        G s \\<longrightarrow> I s\\<rbrakk>\n       \\<Longrightarrow> \\<forall>\\<tau>.\n                            0 \\<le> \\<tau> \\<and>\n                            \\<tau> \\<le> t \\<longrightarrow>\n                            G (X \\<tau>)", "by blast+"], ["proof (state)\nthis:\n  \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s.\n     \\<forall>t\\<ge>0.\n        (\\<forall>\\<tau>.\n            0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n            G (X \\<tau>)) \\<longrightarrow>\n        I (X t)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "}"], ["proof (state)\nthis:\n  G s \\<longrightarrow> I s \\<Longrightarrow>\n  \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s.\n     \\<forall>t\\<ge>0.\n        (\\<forall>\\<tau>.\n            0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n            G (X \\<tau>)) \\<longrightarrow>\n        I (X t)\n\ngoal (1 subgoal):\n 1. \\<And>x.\n       (\\<forall>X\\<in>Sols (\\<lambda>t. f)\n                        (\\<lambda>s. Collect ((\\<le>) 0)) UNIV 0 x.\n           \\<forall>t\\<ge>0.\n              (\\<forall>\\<tau>.\n                  0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n                  G (X \\<tau>)) \\<longrightarrow>\n              I (X t)) =\n       (G x \\<longrightarrow> I x)", "ultimately"], ["proof (chain)\npicking this:\n  (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                   s.\n      \\<forall>t\\<ge>0.\n         (\\<forall>\\<tau>.\n             0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n             G (X \\<tau>)) \\<longrightarrow>\n         I (X t)) \\<longrightarrow>\n  G s \\<longrightarrow> I s\n  G s \\<longrightarrow> I s \\<Longrightarrow>\n  \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s.\n     \\<forall>t\\<ge>0.\n        (\\<forall>\\<tau>.\n            0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n            G (X \\<tau>)) \\<longrightarrow>\n        I (X t)", "show \"?lhs s = (G s \\<longrightarrow> I s)\""], ["proof (prove)\nusing this:\n  (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                   s.\n      \\<forall>t\\<ge>0.\n         (\\<forall>\\<tau>.\n             0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n             G (X \\<tau>)) \\<longrightarrow>\n         I (X t)) \\<longrightarrow>\n  G s \\<longrightarrow> I s\n  G s \\<longrightarrow> I s \\<Longrightarrow>\n  \\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0 s.\n     \\<forall>t\\<ge>0.\n        (\\<forall>\\<tau>.\n            0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n            G (X \\<tau>)) \\<longrightarrow>\n        I (X t)\n\ngoal (1 subgoal):\n 1. (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                     s.\n        \\<forall>t\\<ge>0.\n           (\\<forall>\\<tau>.\n               0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n               G (X \\<tau>)) \\<longrightarrow>\n           I (X t)) =\n    (G s \\<longrightarrow> I s)", "by blast"], ["proof (state)\nthis:\n  (\\<forall>X\\<in>Sols (\\<lambda>t. f) (\\<lambda>s. {t. 0 \\<le> t}) UNIV 0\n                   s.\n      \\<forall>t\\<ge>0.\n         (\\<forall>\\<tau>.\n             0 \\<le> \\<tau> \\<and> \\<tau> \\<le> t \\<longrightarrow>\n             G (X \\<tau>)) \\<longrightarrow>\n         I (X t)) =\n  (G s \\<longrightarrow> I s)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma diff_inv_rule:\n  assumes \"P \\<le> I\" and \"diff_invariant I f U S t\\<^sub>0 G\" and \"I \\<le> Q\"\n  shows \"P \\<le> |x\\<acute>= f & G on U S @ t\\<^sub>0] Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] Q", "apply(rule fbox_g_orbital_inv[OF assms(1) _ assms(3)])"], ["proof (prove)\ngoal (1 subgoal):\n 1. I \\<le> |x\\<acute>=f & G on U S @ t\\<^sub>0] I", "unfolding fbox_diff_inv"], ["proof (prove)\ngoal (1 subgoal):\n 1. diff_invariant I f U S t\\<^sub>0 G", "using assms(2)"], ["proof (prove)\nusing this:\n  diff_invariant I f U S t\\<^sub>0 G\n\ngoal (1 subgoal):\n 1. diff_invariant I f U S t\\<^sub>0 G", "."], ["", "end"]]}