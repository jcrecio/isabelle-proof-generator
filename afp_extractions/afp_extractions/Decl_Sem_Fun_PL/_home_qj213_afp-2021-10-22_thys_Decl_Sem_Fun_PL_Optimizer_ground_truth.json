{"file_name": "/home/qj213/afp-2021-10-22/thys/Decl_Sem_Fun_PL/Optimizer.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Decl_Sem_Fun_PL", "problem_names": ["lemma is_value_is_val[simp]: \"is_value e \\<Longrightarrow> isval e \\<and> FV e = {}\"", "lemma opt_correct_aux: \"E e = E (opt e k)\"", "theorem opt_correct: \"e \\<simeq> opt e k\""], "translations": [["", "lemma is_value_is_val[simp]: \"is_value e \\<Longrightarrow> isval e \\<and> FV e = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. is_value e \\<Longrightarrow> isval e \\<and> FV e = {}", "by (case_tac e) auto"], ["", "fun opt :: \"exp \\<Rightarrow> nat \\<Rightarrow> exp\" where\n  \"opt (EVar x) k = EVar x\" |\n  \"opt (ENat n) k = ENat n\" |\n  \"opt (ELam x e) k = ELam x (opt e k)\" |\n  \"opt (EApp e1 e2) 0 = EApp (opt e1 0) (opt e2 0)\" | \n  \"opt (EApp e1 e2) (Suc k) = \n    (let e1' = opt e1 (Suc k) in let e2' = opt e2 (Suc k) in\n     (case e1' of\n        ELam x e \\<Rightarrow> if is_value e2' then opt (subst x e2' e) k\n                   else EApp e1' e2'\n     | _ \\<Rightarrow> EApp e1' e2'))\" |\n  \"opt (EPrim f e1 e2) k = \n    (let e1' = opt e1 k in let e2' = opt e2 k in\n    (case (e1', e2') of\n       (ENat n1, ENat n2) \\<Rightarrow> ENat (f n1 n2)\n    | _ \\<Rightarrow> EPrim f e1' e2'))\" |\n  \"opt (EIf e1 e2 e3) k = \n    (let e1' = opt e1 k in let e2' = opt e2 k in let e3' = opt e3 k in\n    (case e1' of\n      ENat n \\<Rightarrow> if n = 0 then e3' else e2'\n    | _ \\<Rightarrow> EIf e1' e2' e3'))\""], ["", "lemma opt_correct_aux: \"E e = E (opt e k)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. E e = E (opt e k)", "proof (induction e k rule: opt.induct)"], ["proof (state)\ngoal (7 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>e1 e2 k.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 6. \\<And>f e1 e2 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\\<rbrakk>\n       \\<Longrightarrow> E (EPrim f e1 e2) = E (opt (EPrim f e1 e2) k)\n 7. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "case (5 e1 e2 k)"], ["proof (state)\nthis:\n  E e1 = E (opt e1 (Suc k))\n  ?x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k))\n  \\<lbrakk>?x = opt e1 (Suc k); ?xa = opt e2 (Suc k);\n   ?x = ELam ?x31.0 ?x32.0; is_value ?xa\\<rbrakk>\n  \\<Longrightarrow> E (subst ?x31.0 ?xa ?x32.0) =\n                    E (opt (subst ?x31.0 ?xa ?x32.0) k)\n\ngoal (7 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>e1 e2 k.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 6. \\<And>f e1 e2 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\\<rbrakk>\n       \\<Longrightarrow> E (EPrim f e1 e2) = E (opt (EPrim f e1 e2) k)\n 7. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "then"], ["proof (chain)\npicking this:\n  E e1 = E (opt e1 (Suc k))\n  ?x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k))\n  \\<lbrakk>?x = opt e1 (Suc k); ?xa = opt e2 (Suc k);\n   ?x = ELam ?x31.0 ?x32.0; is_value ?xa\\<rbrakk>\n  \\<Longrightarrow> E (subst ?x31.0 ?xa ?x32.0) =\n                    E (opt (subst ?x31.0 ?xa ?x32.0) k)", "show ?case"], ["proof (prove)\nusing this:\n  E e1 = E (opt e1 (Suc k))\n  ?x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k))\n  \\<lbrakk>?x = opt e1 (Suc k); ?xa = opt e2 (Suc k);\n   ?x = ELam ?x31.0 ?x32.0; is_value ?xa\\<rbrakk>\n  \\<Longrightarrow> E (subst ?x31.0 ?xa ?x32.0) =\n                    E (opt (subst ?x31.0 ?xa ?x32.0) k)\n\ngoal (1 subgoal):\n 1. E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (cases \"opt e1 (Suc k)\")"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<And>x1.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EVar x1\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x2.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ENat x2\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 4. \\<And>x41 x42.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EApp x41 x42\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 5. \\<And>x51 x52 x53.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 6. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply force"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<And>x2.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ENat x2\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x41 x42.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EApp x41 x42\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 4. \\<And>x51 x52 x53.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 5. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply force"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x41 x42.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EApp x41 x42\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x51 x52 x53.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 4. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "prefer 2"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<And>x41 x42.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EApp x41 x42\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x51 x52 x53.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 4. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply force"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x51 x52 x53.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "prefer 2"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x51 x52 x53.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply force"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "prefer 2"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply force"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (rename_tac x e)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (cases \"is_value (opt e2 (Suc k))\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (subgoal_tac \"E (EApp (ELam x e) (opt e2 (Suc k))) \n                       = E (subst x (opt e2 (Suc k)) e)\")"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp (ELam x e) (opt e2 (Suc k))) =\n                         E (subst x (opt e2 (Suc k)) e)\n 3. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "prefer 2"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp (ELam x e) (opt e2 (Suc k))) =\n                         E (subst x (opt e2 (Suc k)) e)\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (rule eval_app_lam)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> is_val (opt e2 (Suc k))\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (simp del: E.simps)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (subgoal_tac \"E(EApp e1 e2) = E(EApp (ELam x e) (opt e2 (Suc k)))\")"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e);\n        E (EApp e1 e2) = E (EApp (ELam x e) (opt e2 (Suc k)))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) =\n                         E (EApp (ELam x e) (opt e2 (Suc k)))\n 3. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "prefer 2"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) =\n                         E (EApp (ELam x e) (opt e2 (Suc k)))\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e);\n        E (EApp e1 e2) = E (EApp (ELam x e) (opt e2 (Suc k)))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 3. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply (rule e_app_cong)"], ["proof (prove)\ngoal (4 subgoals):\n 1. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E e1 = E (ELam x e)\n 2. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e)\\<rbrakk>\n       \\<Longrightarrow> E e2 = E (opt e2 (Suc k))\n 3. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; is_value (opt e2 (Suc k));\n        E (EApp (ELam x e) (opt e2 (Suc k))) =\n        E (subst x (opt e2 (Suc k)) e);\n        E (EApp e1 e2) = E (EApp (ELam x e) (opt e2 (Suc k)))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n 4. \\<And>x e.\n       \\<lbrakk>E e1 = E (opt e1 (Suc k));\n        \\<And>x.\n           x = opt e1 (Suc k) \\<Longrightarrow> E e2 = E (opt e2 (Suc k));\n        \\<And>x xa x31 x32.\n           \\<lbrakk>x = opt e1 (Suc k); xa = opt e2 (Suc k);\n            x = ELam x31 x32; is_value xa\\<rbrakk>\n           \\<Longrightarrow> E (subst x31 xa x32) =\n                             E (opt (subst x31 xa x32) k);\n        opt e1 (Suc k) = ELam x e; \\<not> is_value (opt e2 (Suc k))\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))", "apply force+"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  E (EApp e1 e2) = E (opt (EApp e1 e2) (Suc k))\n\ngoal (6 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>f e1 e2 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\\<rbrakk>\n       \\<Longrightarrow> E (EPrim f e1 e2) = E (opt (EPrim f e1 e2) k)\n 6. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "next"], ["proof (state)\ngoal (6 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>f e1 e2 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\\<rbrakk>\n       \\<Longrightarrow> E (EPrim f e1 e2) = E (opt (EPrim f e1 e2) k)\n 6. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "case (6 f e1 e2 k)"], ["proof (state)\nthis:\n  E e1 = E (opt e1 k)\n  ?x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\n\ngoal (6 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>f e1 e2 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\\<rbrakk>\n       \\<Longrightarrow> E (EPrim f e1 e2) = E (opt (EPrim f e1 e2) k)\n 6. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "then"], ["proof (chain)\npicking this:\n  E e1 = E (opt e1 k)\n  ?x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)", "show ?case"], ["proof (prove)\nusing this:\n  E e1 = E (opt e1 k)\n  ?x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\n\ngoal (1 subgoal):\n 1. E (EPrim f e1 e2) = E (opt (EPrim f e1 e2) k)", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>E e1 = E (opt e1 k); E e2 = E (opt e2 k)\\<rbrakk>\n    \\<Longrightarrow> (\\<lambda>a.\n                          {v. \\<exists>n1.\n                                 VNat n1 \\<in> E (opt e1 k) a \\<and>\n                                 (\\<exists>n2.\n                                     VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                     v = VNat (f n1 n2))}) =\n                      E (let e1' = opt e1 k; e2' = opt e2 k\n                         in case e1' of\n                            ENat n1 \\<Rightarrow>\n                              case e2' of\n                              ENat n2 \\<Rightarrow> ENat (f n1 n2)\n                              | _ \\<Rightarrow> EPrim f e1' e2'\n                            | _ \\<Rightarrow> EPrim f e1' e2')", "apply (cases \"opt e1 k\")"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<And>x1.\n       \\<lbrakk>E e1 = E (opt e1 k); E e2 = E (opt e2 k);\n        opt e1 k = EVar x1\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n1.\n                                    VNat n1 \\<in> E (opt e1 k) a \\<and>\n                                    (\\<exists>n2.\n  VNat n2 \\<in> E (opt e2 k) a \\<and> v = VNat (f n1 n2))}) =\n                         E (let e1' = opt e1 k; e2' = opt e2 k\n                            in case e1' of\n                               ENat n1 \\<Rightarrow>\n                                 case e2' of\n                                 ENat n2 \\<Rightarrow> ENat (f n1 n2)\n                                 | _ \\<Rightarrow> EPrim f e1' e2'\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 2. \\<And>x2.\n       \\<lbrakk>E e1 = E (opt e1 k); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n1.\n                                    VNat n1 \\<in> E (opt e1 k) a \\<and>\n                                    (\\<exists>n2.\n  VNat n2 \\<in> E (opt e2 k) a \\<and> v = VNat (f n1 n2))}) =\n                         E (let e1' = opt e1 k; e2' = opt e2 k\n                            in case e1' of\n                               ENat n1 \\<Rightarrow>\n                                 case e2' of\n                                 ENat n2 \\<Rightarrow> ENat (f n1 n2)\n                                 | _ \\<Rightarrow> EPrim f e1' e2'\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 3. \\<And>x31 x32.\n       \\<lbrakk>E e1 = E (opt e1 k); E e2 = E (opt e2 k);\n        opt e1 k = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n1.\n                                    VNat n1 \\<in> E (opt e1 k) a \\<and>\n                                    (\\<exists>n2.\n  VNat n2 \\<in> E (opt e2 k) a \\<and> v = VNat (f n1 n2))}) =\n                         E (let e1' = opt e1 k; e2' = opt e2 k\n                            in case e1' of\n                               ENat n1 \\<Rightarrow>\n                                 case e2' of\n                                 ENat n2 \\<Rightarrow> ENat (f n1 n2)\n                                 | _ \\<Rightarrow> EPrim f e1' e2'\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 4. \\<And>x41 x42.\n       \\<lbrakk>E e1 = E (opt e1 k); E e2 = E (opt e2 k);\n        opt e1 k = EApp x41 x42\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n1.\n                                    VNat n1 \\<in> E (opt e1 k) a \\<and>\n                                    (\\<exists>n2.\n  VNat n2 \\<in> E (opt e2 k) a \\<and> v = VNat (f n1 n2))}) =\n                         E (let e1' = opt e1 k; e2' = opt e2 k\n                            in case e1' of\n                               ENat n1 \\<Rightarrow>\n                                 case e2' of\n                                 ENat n2 \\<Rightarrow> ENat (f n1 n2)\n                                 | _ \\<Rightarrow> EPrim f e1' e2'\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 5. \\<And>x51 x52 x53.\n       \\<lbrakk>E e1 = E (opt e1 k); E e2 = E (opt e2 k);\n        opt e1 k = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n1.\n                                    VNat n1 \\<in> E (opt e1 k) a \\<and>\n                                    (\\<exists>n2.\n  VNat n2 \\<in> E (opt e2 k) a \\<and> v = VNat (f n1 n2))}) =\n                         E (let e1' = opt e1 k; e2' = opt e2 k\n                            in case e1' of\n                               ENat n1 \\<Rightarrow>\n                                 case e2' of\n                                 ENat n2 \\<Rightarrow> ENat (f n1 n2)\n                                 | _ \\<Rightarrow> EPrim f e1' e2'\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 6. \\<And>x61 x62 x63.\n       \\<lbrakk>E e1 = E (opt e1 k); E e2 = E (opt e2 k);\n        opt e1 k = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n1.\n                                    VNat n1 \\<in> E (opt e1 k) a \\<and>\n                                    (\\<exists>n2.\n  VNat n2 \\<in> E (opt e2 k) a \\<and> v = VNat (f n1 n2))}) =\n                         E (let e1' = opt e1 k; e2' = opt e2 k\n                            in case e1' of\n                               ENat n1 \\<Rightarrow>\n                                 case e2' of\n                                 ENat n2 \\<Rightarrow> ENat (f n1 n2)\n                                 | _ \\<Rightarrow> EPrim f e1' e2'\n                               | _ \\<Rightarrow> EPrim f e1' e2')", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x2.\n       \\<lbrakk>E e1 = (\\<lambda>a. {VNat x2}); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n2.\n                                    VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                    v = VNat (f x2 n2)}) =\n                         E (let e1' = ENat x2; e2' = opt e2 k\n                            in case e2' of\n                               ENat n2 \\<Rightarrow> ENat (f x2 n2)\n                               | _ \\<Rightarrow> EPrim f e1' e2')", "apply (cases \"opt e2 k\")"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<And>x2 x1.\n       \\<lbrakk>E e1 = (\\<lambda>a. {VNat x2}); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2; opt e2 k = EVar x1\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n2.\n                                    VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                    v = VNat (f x2 n2)}) =\n                         E (let e1' = ENat x2; e2' = opt e2 k\n                            in case e2' of\n                               ENat n2 \\<Rightarrow> ENat (f x2 n2)\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 2. \\<And>x2 x2a.\n       \\<lbrakk>E e1 = (\\<lambda>a. {VNat x2}); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2; opt e2 k = ENat x2a\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n2.\n                                    VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                    v = VNat (f x2 n2)}) =\n                         E (let e1' = ENat x2; e2' = opt e2 k\n                            in case e2' of\n                               ENat n2 \\<Rightarrow> ENat (f x2 n2)\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 3. \\<And>x2 x31 x32.\n       \\<lbrakk>E e1 = (\\<lambda>a. {VNat x2}); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2; opt e2 k = ELam x31 x32\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n2.\n                                    VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                    v = VNat (f x2 n2)}) =\n                         E (let e1' = ENat x2; e2' = opt e2 k\n                            in case e2' of\n                               ENat n2 \\<Rightarrow> ENat (f x2 n2)\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 4. \\<And>x2 x41 x42.\n       \\<lbrakk>E e1 = (\\<lambda>a. {VNat x2}); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2; opt e2 k = EApp x41 x42\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n2.\n                                    VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                    v = VNat (f x2 n2)}) =\n                         E (let e1' = ENat x2; e2' = opt e2 k\n                            in case e2' of\n                               ENat n2 \\<Rightarrow> ENat (f x2 n2)\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 5. \\<And>x2 x51 x52 x53.\n       \\<lbrakk>E e1 = (\\<lambda>a. {VNat x2}); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2; opt e2 k = EPrim x51 x52 x53\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n2.\n                                    VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                    v = VNat (f x2 n2)}) =\n                         E (let e1' = ENat x2; e2' = opt e2 k\n                            in case e2' of\n                               ENat n2 \\<Rightarrow> ENat (f x2 n2)\n                               | _ \\<Rightarrow> EPrim f e1' e2')\n 6. \\<And>x2 x61 x62 x63.\n       \\<lbrakk>E e1 = (\\<lambda>a. {VNat x2}); E e2 = E (opt e2 k);\n        opt e1 k = ENat x2; opt e2 k = EIf x61 x62 x63\\<rbrakk>\n       \\<Longrightarrow> (\\<lambda>a.\n                             {v. \\<exists>n2.\n                                    VNat n2 \\<in> E (opt e2 k) a \\<and>\n                                    v = VNat (f x2 n2)}) =\n                         E (let e1' = ENat x2; e2' = opt e2 k\n                            in case e2' of\n                               ENat n2 \\<Rightarrow> ENat (f x2 n2)\n                               | _ \\<Rightarrow> EPrim f e1' e2')", "apply auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  E (EPrim f e1 e2) = E (opt (EPrim f e1 e2) k)\n\ngoal (5 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "next"], ["proof (state)\ngoal (5 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "case (7 e1 e2 e3 k)"], ["proof (state)\nthis:\n  E e1 = E (opt e1 k)\n  ?x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\n  \\<lbrakk>?x = opt e1 k; ?xa = opt e2 k\\<rbrakk>\n  \\<Longrightarrow> E e3 = E (opt e3 k)\n\ngoal (5 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)\n 5. \\<And>e1 e2 e3 k.\n       \\<lbrakk>E e1 = E (opt e1 k);\n        \\<And>x. x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k);\n        \\<And>x xa.\n           \\<lbrakk>x = opt e1 k; xa = opt e2 k\\<rbrakk>\n           \\<Longrightarrow> E e3 = E (opt e3 k)\\<rbrakk>\n       \\<Longrightarrow> E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "then"], ["proof (chain)\npicking this:\n  E e1 = E (opt e1 k)\n  ?x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\n  \\<lbrakk>?x = opt e1 k; ?xa = opt e2 k\\<rbrakk>\n  \\<Longrightarrow> E e3 = E (opt e3 k)", "show ?case"], ["proof (prove)\nusing this:\n  E e1 = E (opt e1 k)\n  ?x = opt e1 k \\<Longrightarrow> E e2 = E (opt e2 k)\n  \\<lbrakk>?x = opt e1 k; ?xa = opt e2 k\\<rbrakk>\n  \\<Longrightarrow> E e3 = E (opt e3 k)\n\ngoal (1 subgoal):\n 1. E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)", "by (cases \"opt e1 k\") auto"], ["proof (state)\nthis:\n  E (EIf e1 e2 e3) = E (opt (EIf e1 e2 e3) k)\n\ngoal (4 subgoals):\n 1. \\<And>x k. E (EVar x) = E (opt (EVar x) k)\n 2. \\<And>n k. E (ENat n) = E (opt (ENat n) k)\n 3. \\<And>x e k.\n       E e = E (opt e k) \\<Longrightarrow>\n       E (ELam x e) = E (opt (ELam x e) k)\n 4. \\<And>e1 e2.\n       \\<lbrakk>E e1 = E (opt e1 0); E e2 = E (opt e2 0)\\<rbrakk>\n       \\<Longrightarrow> E (EApp e1 e2) = E (opt (EApp e1 e2) 0)", "qed auto"], ["", "theorem opt_correct: \"e \\<simeq> opt e k\""], ["proof (prove)\ngoal (1 subgoal):\n 1. e \\<simeq> opt e k", "using opt_correct_aux denot_sound_wrt_ctx_equiv"], ["proof (prove)\nusing this:\n  E ?e = E (opt ?e ?k)\n  E ?e1.0 = E ?e2.0 \\<Longrightarrow> ?e1.0 \\<simeq> ?e2.0\n\ngoal (1 subgoal):\n 1. e \\<simeq> opt e k", "by blast"], ["", "end"]]}