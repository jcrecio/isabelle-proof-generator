{"file_name": "/home/qj213/afp-2021-10-22/thys/Well_Quasi_Orders/Multiset_Extension.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Well_Quasi_Orders", "problem_names": ["lemma in_multisets_iff:\n  \"M \\<in> multisets A \\<longleftrightarrow> set_mset M \\<subseteq> A\"", "lemma empty_multisets [simp]:\n  \"{#} \\<in> multisets F\"", "lemma multisets_union [simp]:\n  \"M \\<in> multisets A \\<Longrightarrow> N \\<in> multisets A \\<Longrightarrow> M + N \\<in> multisets A\"", "lemma mulex1_empty [iff]:\n  \"mulex1 P M {#} \\<longleftrightarrow> False\"", "lemma mulex1_add: \"mulex1 P N (M0 + {#a#}) \\<Longrightarrow>\n  (\\<exists>M. mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n  (\\<exists>K. (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)\"", "lemma mulex1_self_add_right [simp]:\n  \"mulex1 P A (add_mset a A)\"", "lemma empty_mult1 [simp]:\n  \"({#}, {#a#}) \\<in> mult1 R\"", "lemma empty_mulex1 [simp]:\n  \"mulex1 P {#} {#a#}\"", "lemma mulex_on_induct [consumes 1, case_names base step, induct pred: mulex_on]:\n  assumes \"mulex_on P A M N\"\n    and \"\\<And>M N. \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N\\<rbrakk> \\<Longrightarrow> Q M N\"\n    and \"\\<And>L M N. \\<lbrakk>mulex_on P A L M; Q L M; N \\<in> multisets A; mulex1 P M N\\<rbrakk> \\<Longrightarrow> Q L N\"\n  shows \"Q M N\"", "lemma mulex_on_self_add_singleton_right [simp]:\n  assumes \"a \\<in> A\" and \"M \\<in> multisets A\"\n  shows \"mulex_on P A M (add_mset a M)\"", "lemma singleton_multisets [iff]:\n  \"{#x#} \\<in> multisets A \\<longleftrightarrow> x \\<in> A\"", "lemma union_multisetsD:\n  assumes \"M + N \\<in> multisets A\"\n  shows \"M \\<in> multisets A \\<and> N \\<in> multisets A\"", "lemma mulex_on_multisetsD [dest]:\n  assumes \"mulex_on P F M N\"\n  shows \"M \\<in> multisets F\" and \"N \\<in> multisets F\"", "lemma union_multisets_iff [iff]:\n  \"M + N \\<in> multisets A \\<longleftrightarrow> M \\<in> multisets A \\<and> N \\<in> multisets A\"", "lemma add_mset_multisets_iff [iff]:\n  \"add_mset a M \\<in> multisets A \\<longleftrightarrow> a \\<in> A \\<and> M \\<in> multisets A\"", "lemma mulex_on_trans:\n  \"mulex_on P A L M \\<Longrightarrow> mulex_on P A M N \\<Longrightarrow> mulex_on P A L N\"", "lemma transp_on_mulex_on:\n  \"transp_on (mulex_on P A) B\"", "lemma mulex_on_add_right [simp]:\n  assumes \"mulex_on P A M N\" and \"a \\<in> A\"\n  shows \"mulex_on P A M (add_mset a N)\"", "lemma empty_mulex_on [simp]:\n  assumes \"M \\<noteq> {#}\" and \"M \\<in> multisets A\"\n  shows \"mulex_on P A {#} M\"", "lemma mulex_on_self_add_right [simp]:\n  assumes \"M \\<in> multisets A\" and \"K \\<in> multisets A\" and \"K \\<noteq> {#}\"\n  shows \"mulex_on P A M (M + K)\"", "lemma mult1_singleton [iff]:\n  \"({#x#}, {#y#}) \\<in> mult1 R \\<longleftrightarrow> (x, y) \\<in> R\"", "lemma mulex1_singleton [iff]:\n  \"mulex1 P {#x#} {#y#} \\<longleftrightarrow> P x y\"", "lemma singleton_mulex_onI:\n  \"P x y \\<Longrightarrow> x \\<in> A \\<Longrightarrow> y \\<in> A \\<Longrightarrow> mulex_on P A {#x#} {#y#}\"", "lemma reflclp_mulex_on_add_right [simp]:\n  assumes \"(mulex_on P A)\\<^sup>=\\<^sup>= M N\" and \"M \\<in> multisets A\" and \"a \\<in> A\"\n  shows \"mulex_on P A M (N + {#a#})\"", "lemma reflclp_mulex_on_add_right' [simp]:\n  assumes \"(mulex_on P A)\\<^sup>=\\<^sup>= M N\" and \"M \\<in> multisets A\" and \"a \\<in> A\"\n  shows \"mulex_on P A M ({#a#} + N)\"", "lemma mulex_on_union_right [simp]:\n  assumes \"mulex_on P F A B\" and \"K \\<in> multisets F\"\n  shows \"mulex_on P F A (K + B)\"", "lemma mulex_on_union_right' [simp]:\n  assumes \"mulex_on P F A B\" and \"K \\<in> multisets F\"\n  shows \"mulex_on P F A (B + K)\"", "lemma accessible_on_mulex1_multisets:\n  assumes wf: \"wfp_on P A\"\n  shows \"\\<forall>M\\<in>multisets A. accessible_on (mulex1 P) (multisets A) M\"", "lemmas wfp_on_mulex1_multisets =\n  accessible_on_mulex1_multisets [THEN accessible_on_imp_wfp_on]", "lemmas irreflp_on_mulex1 =\n  wfp_on_mulex1_multisets [THEN wfp_on_imp_irreflp_on]", "lemma wfp_on_mulex_on_multisets:\n  assumes \"wfp_on P A\"\n  shows \"wfp_on (mulex_on P A) (multisets A)\"", "lemmas irreflp_on_mulex_on =\n  wfp_on_mulex_on_multisets [THEN wfp_on_imp_irreflp_on]", "lemma mulex1_union:\n  \"mulex1 P M N \\<Longrightarrow> mulex1 P (K + M) (K + N)\"", "lemma mulex_on_union:\n  assumes \"mulex_on P A M N\" and \"K \\<in> multisets A\"\n  shows \"mulex_on P A (K + M) (K + N)\"", "lemma mulex_on_union':\n  assumes \"mulex_on P A M N\" and \"K \\<in> multisets A\"\n  shows \"mulex_on P A (M + K) (N + K)\"", "lemma mulex_on_add_mset:\n  assumes \"mulex_on P A M N\" and \"m \\<in> A\"\n  shows \"mulex_on P A (add_mset m M) (add_mset m N)\"", "lemma union_mulex_on_mono:\n  \"mulex_on P F A C \\<Longrightarrow> mulex_on P F B D \\<Longrightarrow> mulex_on P F (A + B) (C + D)\"", "lemma mulex_on_add_mset':\n  assumes \"P m n\" and \"m \\<in> A\" and \"n \\<in> A\" and \"M \\<in> multisets A\"\n  shows \"mulex_on P A (add_mset m M) (add_mset n M)\"", "lemma mulex_on_add_mset_mono:\n  assumes \"P m n\" and \"m \\<in> A\" and \"n \\<in> A\" and \"mulex_on P A M N\"\n  shows \"mulex_on P A (add_mset m M) (add_mset n N)\"", "lemma union_mulex_on_mono1:\n  \"A \\<in> multisets F \\<Longrightarrow> (mulex_on P F)\\<^sup>=\\<^sup>= A C \\<Longrightarrow> mulex_on P F B D \\<Longrightarrow>\n    mulex_on P F (A + B) (C + D)\"", "lemma union_mulex_on_mono2:\n  \"B \\<in> multisets F \\<Longrightarrow> mulex_on P F A C \\<Longrightarrow> (mulex_on P F)\\<^sup>=\\<^sup>= B D \\<Longrightarrow>\n    mulex_on P F (A + B) (C + D)\"", "lemma mult1_mono:\n  assumes \"\\<And>x y. \\<lbrakk>x \\<in> A; y \\<in> A; (x, y) \\<in> R\\<rbrakk> \\<Longrightarrow> (x, y) \\<in> S\"\n    and \"M \\<in> multisets A\"\n    and \"N \\<in> multisets A\"\n    and \"(M, N) \\<in> mult1 R\"\n  shows \"(M, N) \\<in> mult1 S\"", "lemma mulex1_mono:\n  assumes \"\\<And>x y. \\<lbrakk>x \\<in> A; y \\<in> A; P x y\\<rbrakk> \\<Longrightarrow> Q x y\"\n    and \"M \\<in> multisets A\"\n    and \"N \\<in> multisets A\"\n    and \"mulex1 P M N\"\n  shows \"mulex1 Q M N\"", "lemma mulex_on_mono:\n  assumes *: \"\\<And>x y. \\<lbrakk>x \\<in> A; y \\<in> A; P x y\\<rbrakk> \\<Longrightarrow> Q x y\"\n    and \"mulex_on P A M N\"\n  shows \"mulex_on Q A M N\"", "lemma mult1_reflcl:\n  assumes \"(M, N) \\<in> mult1 R\"\n  shows \"(M, N) \\<in> mult1 (R\\<^sup>=)\"", "lemma mulex1_reflclp:\n  assumes \"mulex1 P M N\"\n  shows \"mulex1 (P\\<^sup>=\\<^sup>=) M N\"", "lemma mulex_on_reflclp:\n  assumes \"mulex_on P A M N\"\n  shows \"mulex_on (P\\<^sup>=\\<^sup>=) A M N\"", "lemma surj_on_multisets_mset:\n  \"\\<forall>M\\<in>multisets A. \\<exists>xs\\<in>lists A. M = mset xs\"", "lemma image_mset_lists [simp]:\n  \"mset ` lists A = multisets A\"", "lemma multisets_UNIV [simp]: \"multisets UNIV = UNIV\"", "lemma non_empty_multiset_induct [consumes 1, case_names singleton add]:\n  assumes \"M \\<noteq> {#}\"\n    and \"\\<And>x. P {#x#}\"\n    and \"\\<And>x M. P M \\<Longrightarrow> P (add_mset x M)\"\n  shows \"P M\"", "lemma mulex_on_all_strict:\n  assumes \"X \\<noteq> {#}\"\n  assumes \"X \\<in> multisets A\" and \"Y \\<in> multisets A\"\n    and *: \"\\<forall>y. y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\"\n  shows \"mulex_on P A Y X\"", "lemma diff_set_Ex_iff:\n  \"X \\<noteq> {#} \\<and> X \\<subseteq># M \\<and> N = (M - X) + Y \\<longleftrightarrow> X \\<noteq> {#} \\<and> (\\<exists>Z. M = Z + X \\<and> N = Z + Y)\"", "lemma mulex_on_alt_def:\n  assumes trans: \"transp_on P A\"\n  shows \"mulex_on P A M N \\<longleftrightarrow> M \\<in> multisets A \\<and> N \\<in> multisets A \\<and> (\\<exists>X Y Z.\n    X \\<noteq> {#} \\<and> N = Z + X \\<and> M = Z + Y \\<and> (\\<forall>y. y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)))\"\n  (is \"?P M N \\<longleftrightarrow> ?Q M N\")"], "translations": [["", "lemma in_multisets_iff:\n  \"M \\<in> multisets A \\<longleftrightarrow> set_mset M \\<subseteq> A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (M \\<in> multisets A) = (set_mset M \\<subseteq> A)", "by (simp add: multisets_def)"], ["", "lemma empty_multisets [simp]:\n  \"{#} \\<in> multisets F\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {#} \\<in> multisets F", "by (simp add: in_multisets_iff)"], ["", "lemma multisets_union [simp]:\n  \"M \\<in> multisets A \\<Longrightarrow> N \\<in> multisets A \\<Longrightarrow> M + N \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A\\<rbrakk>\n    \\<Longrightarrow> M + N \\<in> multisets A", "by (auto simp add: in_multisets_iff)"], ["", "definition mulex1 :: \"('a \\<Rightarrow> 'a \\<Rightarrow> bool) \\<Rightarrow> 'a multiset \\<Rightarrow> 'a multiset \\<Rightarrow> bool\" where\n  \"mulex1 P = (\\<lambda>M N. (M, N) \\<in> mult1 {(x, y). P x y})\""], ["", "lemma mulex1_empty [iff]:\n  \"mulex1 P M {#} \\<longleftrightarrow> False\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P M {#} = False", "using not_less_empty [of M \"{(x, y). P x y}\"]"], ["proof (prove)\nusing this:\n  (M, {#}) \\<notin> mult1 {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. mulex1 P M {#} = False", "by (auto simp: mulex1_def)"], ["", "lemma mulex1_add: \"mulex1 P N (M0 + {#a#}) \\<Longrightarrow>\n  (\\<exists>M. mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n  (\\<exists>K. (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P N (M0 + {#a#}) \\<Longrightarrow>\n    (\\<exists>M. mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n    (\\<exists>K.\n        (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)", "using less_add [of N a M0 \"{(x, y). P x y}\"]"], ["proof (prove)\nusing this:\n  (N, add_mset a M0) \\<in> mult1 {(x, y). P x y} \\<Longrightarrow>\n  (\\<exists>M.\n      (M, M0) \\<in> mult1 {(x, y). P x y} \\<and> N = add_mset a M) \\<or>\n  (\\<exists>K.\n      (\\<forall>b.\n          b \\<in># K \\<longrightarrow> (b, a) \\<in> {(x, y). P x y}) \\<and>\n      N = M0 + K)\n\ngoal (1 subgoal):\n 1. mulex1 P N (M0 + {#a#}) \\<Longrightarrow>\n    (\\<exists>M. mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n    (\\<exists>K.\n        (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)", "by (auto simp: mulex1_def)"], ["", "lemma mulex1_self_add_right [simp]:\n  \"mulex1 P A (add_mset a A)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "let ?R = \"{(x, y). P x y}\""], ["proof (state)\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "thm mult1_def"], ["proof (state)\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "have \"A + {#a#} = A + {#a#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. A + {#a#} = A + {#a#}", "by simp"], ["proof (state)\nthis:\n  A + {#a#} = A + {#a#}\n\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "moreover"], ["proof (state)\nthis:\n  A + {#a#} = A + {#a#}\n\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "have \"A = A + {#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. A = A + {#}", "by simp"], ["proof (state)\nthis:\n  A = A + {#}\n\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "moreover"], ["proof (state)\nthis:\n  A = A + {#}\n\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "have \"\\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> ?R\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> {(x, y). P x y}", "by simp"], ["proof (state)\nthis:\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "ultimately"], ["proof (chain)\npicking this:\n  A + {#a#} = A + {#a#}\n  A = A + {#}\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> {(x, y). P x y}", "have \"(A, add_mset a A) \\<in> mult1 ?R\""], ["proof (prove)\nusing this:\n  A + {#a#} = A + {#a#}\n  A = A + {#}\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. (A, add_mset a A) \\<in> mult1 {(x, y). P x y}", "unfolding mult1_def"], ["proof (prove)\nusing this:\n  A + {#a#} = A + {#a#}\n  A = A + {#}\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. (A, add_mset a A)\n    \\<in> {(N, M).\n           \\<exists>a M0 K.\n              M = add_mset a M0 \\<and>\n              N = M0 + K \\<and>\n              (\\<forall>b.\n                  b \\<in># K \\<longrightarrow>\n                  (b, a) \\<in> {(x, y). P x y})}", "by blast"], ["proof (state)\nthis:\n  (A, add_mset a A) \\<in> mult1 {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "then"], ["proof (chain)\npicking this:\n  (A, add_mset a A) \\<in> mult1 {(x, y). P x y}", "show ?thesis"], ["proof (prove)\nusing this:\n  (A, add_mset a A) \\<in> mult1 {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. mulex1 P A (add_mset a A)", "by (simp add: mulex1_def)"], ["proof (state)\nthis:\n  mulex1 P A (add_mset a A)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma empty_mult1 [simp]:\n  \"({#}, {#a#}) \\<in> mult1 R\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "have \"{#a#} = {#} + {#a#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {#a#} = {#} + {#a#}", "by simp"], ["proof (state)\nthis:\n  {#a#} = {#} + {#a#}\n\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "moreover"], ["proof (state)\nthis:\n  {#a#} = {#} + {#a#}\n\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "have \"{#} = {#} + {#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {#} = {#} + {#}", "by simp"], ["proof (state)\nthis:\n  {#} = {#} + {#}\n\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "moreover"], ["proof (state)\nthis:\n  {#} = {#} + {#}\n\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "have \"\\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> R\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> R", "by simp"], ["proof (state)\nthis:\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> R\n\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "ultimately"], ["proof (chain)\npicking this:\n  {#a#} = {#} + {#a#}\n  {#} = {#} + {#}\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> R", "show ?thesis"], ["proof (prove)\nusing this:\n  {#a#} = {#} + {#a#}\n  {#} = {#} + {#}\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> R\n\ngoal (1 subgoal):\n 1. ({#}, {#a#}) \\<in> mult1 R", "unfolding mult1_def"], ["proof (prove)\nusing this:\n  {#a#} = {#} + {#a#}\n  {#} = {#} + {#}\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> (b, a) \\<in> R\n\ngoal (1 subgoal):\n 1. ({#}, {#a#})\n    \\<in> {(N, M).\n           \\<exists>a M0 K.\n              M = add_mset a M0 \\<and>\n              N = M0 + K \\<and>\n              (\\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R)}", "by force"], ["proof (state)\nthis:\n  ({#}, {#a#}) \\<in> mult1 R\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma empty_mulex1 [simp]:\n  \"mulex1 P {#} {#a#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P {#} {#a#}", "using empty_mult1 [of a \"{(x, y). P x y}\"]"], ["proof (prove)\nusing this:\n  ({#}, {#a#}) \\<in> mult1 {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. mulex1 P {#} {#a#}", "by (simp add: mulex1_def)"], ["", "definition mulex_on :: \"('a \\<Rightarrow> 'a \\<Rightarrow> bool) \\<Rightarrow> 'a set \\<Rightarrow> 'a multiset \\<Rightarrow> 'a multiset \\<Rightarrow> bool\" where\n  \"mulex_on P A = (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+\""], ["", "abbreviation mulex :: \"('a \\<Rightarrow> 'a \\<Rightarrow> bool) \\<Rightarrow> 'a multiset \\<Rightarrow> 'a multiset \\<Rightarrow> bool\" where\n  \"mulex P \\<equiv> mulex_on P UNIV\""], ["", "lemma mulex_on_induct [consumes 1, case_names base step, induct pred: mulex_on]:\n  assumes \"mulex_on P A M N\"\n    and \"\\<And>M N. \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N\\<rbrakk> \\<Longrightarrow> Q M N\"\n    and \"\\<And>L M N. \\<lbrakk>mulex_on P A L M; Q L M; N \\<in> multisets A; mulex1 P M N\\<rbrakk> \\<Longrightarrow> Q L N\"\n  shows \"Q M N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Q M N", "using assms"], ["proof (prove)\nusing this:\n  mulex_on P A M N\n  \\<lbrakk>?M \\<in> multisets A; ?N \\<in> multisets A;\n   mulex1 P ?M ?N\\<rbrakk>\n  \\<Longrightarrow> Q ?M ?N\n  \\<lbrakk>mulex_on P A ?L ?M; Q ?L ?M; ?N \\<in> multisets A;\n   mulex1 P ?M ?N\\<rbrakk>\n  \\<Longrightarrow> Q ?L ?N\n\ngoal (1 subgoal):\n 1. Q M N", "unfolding mulex_on_def"], ["proof (prove)\nusing this:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ M N\n  \\<lbrakk>?M \\<in> multisets A; ?N \\<in> multisets A;\n   mulex1 P ?M ?N\\<rbrakk>\n  \\<Longrightarrow> Q ?M ?N\n  \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ ?L ?M;\n   Q ?L ?M; ?N \\<in> multisets A; mulex1 P ?M ?N\\<rbrakk>\n  \\<Longrightarrow> Q ?L ?N\n\ngoal (1 subgoal):\n 1. Q M N", "by (induct) blast+"], ["", "lemma mulex_on_self_add_singleton_right [simp]:\n  assumes \"a \\<in> A\" and \"M \\<in> multisets A\"\n  shows \"mulex_on P A M (add_mset a M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a M)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a M)", "have \"mulex1 P M (M + {#a#})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P M (M + {#a#})", "by simp"], ["proof (state)\nthis:\n  mulex1 P M (M + {#a#})\n\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a M)", "with assms"], ["proof (chain)\npicking this:\n  a \\<in> A\n  M \\<in> multisets A\n  mulex1 P M (M + {#a#})", "have \"restrict_to (mulex1 P) (multisets A) M (add_mset a M)\""], ["proof (prove)\nusing this:\n  a \\<in> A\n  M \\<in> multisets A\n  mulex1 P M (M + {#a#})\n\ngoal (1 subgoal):\n 1. restrict_to (mulex1 P) (multisets A) M (add_mset a M)", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  restrict_to (mulex1 P) (multisets A) M (add_mset a M)\n\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a M)", "then"], ["proof (chain)\npicking this:\n  restrict_to (mulex1 P) (multisets A) M (add_mset a M)", "show ?thesis"], ["proof (prove)\nusing this:\n  restrict_to (mulex1 P) (multisets A) M (add_mset a M)\n\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a M)", "unfolding mulex_on_def"], ["proof (prove)\nusing this:\n  restrict_to (mulex1 P) (multisets A) M (add_mset a M)\n\ngoal (1 subgoal):\n 1. (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ M (add_mset a M)", "by blast"], ["proof (state)\nthis:\n  mulex_on P A M (add_mset a M)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma singleton_multisets [iff]:\n  \"{#x#} \\<in> multisets A \\<longleftrightarrow> x \\<in> A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. ({#x#} \\<in> multisets A) = (x \\<in> A)", "by (auto simp: multisets_def)"], ["", "lemma union_multisetsD:\n  assumes \"M + N \\<in> multisets A\"\n  shows \"M \\<in> multisets A \\<and> N \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and> N \\<in> multisets A", "using assms"], ["proof (prove)\nusing this:\n  M + N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and> N \\<in> multisets A", "by (auto simp: multisets_def)"], ["", "lemma mulex_on_multisetsD [dest]:\n  assumes \"mulex_on P F M N\"\n  shows \"M \\<in> multisets F\" and \"N \\<in> multisets F\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<in> multisets F &&& N \\<in> multisets F", "using assms"], ["proof (prove)\nusing this:\n  mulex_on P F M N\n\ngoal (1 subgoal):\n 1. M \\<in> multisets F &&& N \\<in> multisets F", "by (induct) auto"], ["", "lemma union_multisets_iff [iff]:\n  \"M + N \\<in> multisets A \\<longleftrightarrow> M \\<in> multisets A \\<and> N \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (M + N \\<in> multisets A) =\n    (M \\<in> multisets A \\<and> N \\<in> multisets A)", "by (auto dest: union_multisetsD)"], ["", "lemma add_mset_multisets_iff [iff]:\n  \"add_mset a M \\<in> multisets A \\<longleftrightarrow> a \\<in> A \\<and> M \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (add_mset a M \\<in> multisets A) =\n    (a \\<in> A \\<and> M \\<in> multisets A)", "unfolding add_mset_add_single[of a M] union_multisets_iff"], ["proof (prove)\ngoal (1 subgoal):\n 1. (M \\<in> multisets A \\<and> {#a#} \\<in> multisets A) =\n    (a \\<in> A \\<and> M \\<in> multisets A)", "by auto"], ["", "lemma mulex_on_trans:\n  \"mulex_on P A L M \\<Longrightarrow> mulex_on P A M N \\<Longrightarrow> mulex_on P A L N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>mulex_on P A L M; mulex_on P A M N\\<rbrakk>\n    \\<Longrightarrow> mulex_on P A L N", "by (auto simp: mulex_on_def)"], ["", "lemma transp_on_mulex_on:\n  \"transp_on (mulex_on P A) B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. transp_on (mulex_on P A) B", "using mulex_on_trans [of P A]"], ["proof (prove)\nusing this:\n  \\<lbrakk>mulex_on P A ?L ?M; mulex_on P A ?M ?N\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A ?L ?N\n\ngoal (1 subgoal):\n 1. transp_on (mulex_on P A) B", "by (auto simp: transp_on_def)"], ["", "lemma mulex_on_add_right [simp]:\n  assumes \"mulex_on P A M N\" and \"a \\<in> A\"\n  shows \"mulex_on P A M (add_mset a N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a N)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a N)", "from assms"], ["proof (chain)\npicking this:\n  mulex_on P A M N\n  a \\<in> A", "have \"a \\<in> A\" and \"N \\<in> multisets A\""], ["proof (prove)\nusing this:\n  mulex_on P A M N\n  a \\<in> A\n\ngoal (1 subgoal):\n 1. a \\<in> A &&& N \\<in> multisets A", "by auto"], ["proof (state)\nthis:\n  a \\<in> A\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a N)", "then"], ["proof (chain)\npicking this:\n  a \\<in> A\n  N \\<in> multisets A", "have \"mulex_on P A N (add_mset a N)\""], ["proof (prove)\nusing this:\n  a \\<in> A\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A N (add_mset a N)", "by simp"], ["proof (state)\nthis:\n  mulex_on P A N (add_mset a N)\n\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a N)", "with \\<open>mulex_on P A M N\\<close>"], ["proof (chain)\npicking this:\n  mulex_on P A M N\n  mulex_on P A N (add_mset a N)", "show ?thesis"], ["proof (prove)\nusing this:\n  mulex_on P A M N\n  mulex_on P A N (add_mset a N)\n\ngoal (1 subgoal):\n 1. mulex_on P A M (add_mset a N)", "by (rule mulex_on_trans)"], ["proof (state)\nthis:\n  mulex_on P A M (add_mset a N)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma empty_mulex_on [simp]:\n  assumes \"M \\<noteq> {#}\" and \"M \\<in> multisets A\"\n  shows \"mulex_on P A {#} M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A {#} M", "using assms"], ["proof (prove)\nusing this:\n  M \\<noteq> {#}\n  M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A {#} M", "proof (induct M)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>{#} \\<noteq> {#}; {#} \\<in> multisets A\\<rbrakk>\n    \\<Longrightarrow> mulex_on P A {#} {#}\n 2. \\<And>x M.\n       \\<lbrakk>\\<lbrakk>M \\<noteq> {#}; M \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> mulex_on P A {#} M;\n        add_mset x M \\<noteq> {#}; add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A {#} (add_mset x M)", "case (add a M)"], ["proof (state)\nthis:\n  \\<lbrakk>M \\<noteq> {#}; M \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A {#} M\n  add_mset a M \\<noteq> {#}\n  add_mset a M \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<lbrakk>{#} \\<noteq> {#}; {#} \\<in> multisets A\\<rbrakk>\n    \\<Longrightarrow> mulex_on P A {#} {#}\n 2. \\<And>x M.\n       \\<lbrakk>\\<lbrakk>M \\<noteq> {#}; M \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> mulex_on P A {#} M;\n        add_mset x M \\<noteq> {#}; add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A {#} (add_mset x M)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A {#} (add_mset a M)", "proof (cases \"M = {#}\")"], ["proof (state)\ngoal (2 subgoals):\n 1. M = {#} \\<Longrightarrow> mulex_on P A {#} (add_mset a M)\n 2. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A {#} (add_mset a M)", "assume \"M = {#}\""], ["proof (state)\nthis:\n  M = {#}\n\ngoal (2 subgoals):\n 1. M = {#} \\<Longrightarrow> mulex_on P A {#} (add_mset a M)\n 2. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A {#} (add_mset a M)", "with add"], ["proof (chain)\npicking this:\n  \\<lbrakk>M \\<noteq> {#}; M \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A {#} M\n  add_mset a M \\<noteq> {#}\n  add_mset a M \\<in> multisets A\n  M = {#}", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<lbrakk>M \\<noteq> {#}; M \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A {#} M\n  add_mset a M \\<noteq> {#}\n  add_mset a M \\<in> multisets A\n  M = {#}\n\ngoal (1 subgoal):\n 1. mulex_on P A {#} (add_mset a M)", "by (auto simp: mulex_on_def)"], ["proof (state)\nthis:\n  mulex_on P A {#} (add_mset a M)\n\ngoal (1 subgoal):\n 1. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A {#} (add_mset a M)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A {#} (add_mset a M)", "assume \"M \\<noteq> {#}\""], ["proof (state)\nthis:\n  M \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A {#} (add_mset a M)", "with add"], ["proof (chain)\npicking this:\n  \\<lbrakk>M \\<noteq> {#}; M \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A {#} M\n  add_mset a M \\<noteq> {#}\n  add_mset a M \\<in> multisets A\n  M \\<noteq> {#}", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<lbrakk>M \\<noteq> {#}; M \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A {#} M\n  add_mset a M \\<noteq> {#}\n  add_mset a M \\<in> multisets A\n  M \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. mulex_on P A {#} (add_mset a M)", "by (auto intro: mulex_on_trans)"], ["proof (state)\nthis:\n  mulex_on P A {#} (add_mset a M)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  mulex_on P A {#} (add_mset a M)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>{#} \\<noteq> {#}; {#} \\<in> multisets A\\<rbrakk>\n    \\<Longrightarrow> mulex_on P A {#} {#}", "qed simp"], ["", "lemma mulex_on_self_add_right [simp]:\n  assumes \"M \\<in> multisets A\" and \"K \\<in> multisets A\" and \"K \\<noteq> {#}\"\n  shows \"mulex_on P A M (M + K)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A M (M + K)", "using assms"], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n  K \\<in> multisets A\n  K \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. mulex_on P A M (M + K)", "proof (induct K)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>M \\<in> multisets A; {#} \\<in> multisets A;\n     {#} \\<noteq> {#}\\<rbrakk>\n    \\<Longrightarrow> mulex_on P A M (M + {#})\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>M \\<in> multisets A; K \\<in> multisets A;\n                 K \\<noteq> {#}\\<rbrakk>\n                \\<Longrightarrow> mulex_on P A M (M + K);\n        M \\<in> multisets A; add_mset x K \\<in> multisets A;\n        add_mset x K \\<noteq> {#}\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A M (M + add_mset x K)", "case empty"], ["proof (state)\nthis:\n  M \\<in> multisets A\n  {#} \\<in> multisets A\n  {#} \\<noteq> {#}\n\ngoal (2 subgoals):\n 1. \\<lbrakk>M \\<in> multisets A; {#} \\<in> multisets A;\n     {#} \\<noteq> {#}\\<rbrakk>\n    \\<Longrightarrow> mulex_on P A M (M + {#})\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>M \\<in> multisets A; K \\<in> multisets A;\n                 K \\<noteq> {#}\\<rbrakk>\n                \\<Longrightarrow> mulex_on P A M (M + K);\n        M \\<in> multisets A; add_mset x K \\<in> multisets A;\n        add_mset x K \\<noteq> {#}\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A M (M + add_mset x K)", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A\n  {#} \\<in> multisets A\n  {#} \\<noteq> {#}", "show ?case"], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n  {#} \\<in> multisets A\n  {#} \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. mulex_on P A M (M + {#})", "by (cases \"K = {#}\") auto"], ["proof (state)\nthis:\n  mulex_on P A M (M + {#})\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>M \\<in> multisets A; K \\<in> multisets A;\n                 K \\<noteq> {#}\\<rbrakk>\n                \\<Longrightarrow> mulex_on P A M (M + K);\n        M \\<in> multisets A; add_mset x K \\<in> multisets A;\n        add_mset x K \\<noteq> {#}\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A M (M + add_mset x K)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>M \\<in> multisets A; K \\<in> multisets A;\n                 K \\<noteq> {#}\\<rbrakk>\n                \\<Longrightarrow> mulex_on P A M (M + K);\n        M \\<in> multisets A; add_mset x K \\<in> multisets A;\n        add_mset x K \\<noteq> {#}\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A M (M + add_mset x K)", "case (add a M)"], ["proof (state)\nthis:\n  \\<lbrakk>M \\<in> multisets A; M \\<in> multisets A; M \\<noteq> {#}\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A M (M + M)\n  M \\<in> multisets A\n  add_mset a M \\<in> multisets A\n  add_mset a M \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>M \\<in> multisets A; K \\<in> multisets A;\n                 K \\<noteq> {#}\\<rbrakk>\n                \\<Longrightarrow> mulex_on P A M (M + K);\n        M \\<in> multisets A; add_mset x K \\<in> multisets A;\n        add_mset x K \\<noteq> {#}\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A M (M + add_mset x K)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A M (M + add_mset a M)", "proof (cases \"M = {#}\")"], ["proof (state)\ngoal (2 subgoals):\n 1. M = {#} \\<Longrightarrow> mulex_on P A M (M + add_mset a M)\n 2. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A M (M + add_mset a M)", "assume \"M = {#}\""], ["proof (state)\nthis:\n  M = {#}\n\ngoal (2 subgoals):\n 1. M = {#} \\<Longrightarrow> mulex_on P A M (M + add_mset a M)\n 2. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A M (M + add_mset a M)", "with add"], ["proof (chain)\npicking this:\n  \\<lbrakk>M \\<in> multisets A; M \\<in> multisets A; M \\<noteq> {#}\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A M (M + M)\n  M \\<in> multisets A\n  add_mset a M \\<in> multisets A\n  add_mset a M \\<noteq> {#}\n  M = {#}", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<lbrakk>M \\<in> multisets A; M \\<in> multisets A; M \\<noteq> {#}\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A M (M + M)\n  M \\<in> multisets A\n  add_mset a M \\<in> multisets A\n  add_mset a M \\<noteq> {#}\n  M = {#}\n\ngoal (1 subgoal):\n 1. mulex_on P A M (M + add_mset a M)", "by auto"], ["proof (state)\nthis:\n  mulex_on P A M (M + add_mset a M)\n\ngoal (1 subgoal):\n 1. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A M (M + add_mset a M)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A M (M + add_mset a M)", "assume \"M \\<noteq> {#}\""], ["proof (state)\nthis:\n  M \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. M \\<noteq> {#} \\<Longrightarrow> mulex_on P A M (M + add_mset a M)", "with add"], ["proof (chain)\npicking this:\n  \\<lbrakk>M \\<in> multisets A; M \\<in> multisets A; M \\<noteq> {#}\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A M (M + M)\n  M \\<in> multisets A\n  add_mset a M \\<in> multisets A\n  add_mset a M \\<noteq> {#}\n  M \\<noteq> {#}", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<lbrakk>M \\<in> multisets A; M \\<in> multisets A; M \\<noteq> {#}\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A M (M + M)\n  M \\<in> multisets A\n  add_mset a M \\<in> multisets A\n  add_mset a M \\<noteq> {#}\n  M \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. mulex_on P A M (M + add_mset a M)", "by (auto dest: mulex_on_add_right simp add: ac_simps)"], ["proof (state)\nthis:\n  mulex_on P A M (M + add_mset a M)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  mulex_on P A M (M + add_mset a M)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mult1_singleton [iff]:\n  \"({#x#}, {#y#}) \\<in> mult1 R \\<longleftrightarrow> (x, y) \\<in> R\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (({#x#}, {#y#}) \\<in> mult1 R) = ((x, y) \\<in> R)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. ({#x#}, {#y#}) \\<in> mult1 R \\<Longrightarrow> (x, y) \\<in> R\n 2. (x, y) \\<in> R \\<Longrightarrow> ({#x#}, {#y#}) \\<in> mult1 R", "assume \"(x, y) \\<in> R\""], ["proof (state)\nthis:\n  (x, y) \\<in> R\n\ngoal (2 subgoals):\n 1. ({#x#}, {#y#}) \\<in> mult1 R \\<Longrightarrow> (x, y) \\<in> R\n 2. (x, y) \\<in> R \\<Longrightarrow> ({#x#}, {#y#}) \\<in> mult1 R", "then"], ["proof (chain)\npicking this:\n  (x, y) \\<in> R", "have \"{#y#} = {#} + {#y#}\"\n    and \"{#x#} = {#} + {#x#}\"\n    and \"\\<forall>b. b \\<in># {#x#} \\<longrightarrow> (b, y) \\<in> R\""], ["proof (prove)\nusing this:\n  (x, y) \\<in> R\n\ngoal (1 subgoal):\n 1. {#y#} = {#} + {#y#} &&&\n    {#x#} = {#} + {#x#} &&&\n    \\<forall>b. b \\<in># {#x#} \\<longrightarrow> (b, y) \\<in> R", "by auto"], ["proof (state)\nthis:\n  {#y#} = {#} + {#y#}\n  {#x#} = {#} + {#x#}\n  \\<forall>b. b \\<in># {#x#} \\<longrightarrow> (b, y) \\<in> R\n\ngoal (2 subgoals):\n 1. ({#x#}, {#y#}) \\<in> mult1 R \\<Longrightarrow> (x, y) \\<in> R\n 2. (x, y) \\<in> R \\<Longrightarrow> ({#x#}, {#y#}) \\<in> mult1 R", "then"], ["proof (chain)\npicking this:\n  {#y#} = {#} + {#y#}\n  {#x#} = {#} + {#x#}\n  \\<forall>b. b \\<in># {#x#} \\<longrightarrow> (b, y) \\<in> R", "show \"({#x#}, {#y#}) \\<in> mult1 R\""], ["proof (prove)\nusing this:\n  {#y#} = {#} + {#y#}\n  {#x#} = {#} + {#x#}\n  \\<forall>b. b \\<in># {#x#} \\<longrightarrow> (b, y) \\<in> R\n\ngoal (1 subgoal):\n 1. ({#x#}, {#y#}) \\<in> mult1 R", "unfolding mult1_def"], ["proof (prove)\nusing this:\n  {#y#} = {#} + {#y#}\n  {#x#} = {#} + {#x#}\n  \\<forall>b. b \\<in># {#x#} \\<longrightarrow> (b, y) \\<in> R\n\ngoal (1 subgoal):\n 1. ({#x#}, {#y#})\n    \\<in> {(N, M).\n           \\<exists>a M0 K.\n              M = add_mset a M0 \\<and>\n              N = M0 + K \\<and>\n              (\\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R)}", "by blast"], ["proof (state)\nthis:\n  ({#x#}, {#y#}) \\<in> mult1 R\n\ngoal (1 subgoal):\n 1. ({#x#}, {#y#}) \\<in> mult1 R \\<Longrightarrow> (x, y) \\<in> R", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. ({#x#}, {#y#}) \\<in> mult1 R \\<Longrightarrow> (x, y) \\<in> R", "assume \"({#x#}, {#y#}) \\<in> mult1 R\""], ["proof (state)\nthis:\n  ({#x#}, {#y#}) \\<in> mult1 R\n\ngoal (1 subgoal):\n 1. ({#x#}, {#y#}) \\<in> mult1 R \\<Longrightarrow> (x, y) \\<in> R", "then"], ["proof (chain)\npicking this:\n  ({#x#}, {#y#}) \\<in> mult1 R", "obtain M0 K a\n    where \"{#y#} = add_mset a M0\"\n    and \"{#x#} = M0 + K\"\n    and \"\\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R\""], ["proof (prove)\nusing this:\n  ({#x#}, {#y#}) \\<in> mult1 R\n\ngoal (1 subgoal):\n 1. (\\<And>a M0 K.\n        \\<lbrakk>{#y#} = add_mset a M0; {#x#} = M0 + K;\n         \\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding mult1_def"], ["proof (prove)\nusing this:\n  ({#x#}, {#y#})\n  \\<in> {(N, M).\n         \\<exists>a M0 K.\n            M = add_mset a M0 \\<and>\n            N = M0 + K \\<and>\n            (\\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R)}\n\ngoal (1 subgoal):\n 1. (\\<And>a M0 K.\n        \\<lbrakk>{#y#} = add_mset a M0; {#x#} = M0 + K;\n         \\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  {#y#} = add_mset a M0\n  {#x#} = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R\n\ngoal (1 subgoal):\n 1. ({#x#}, {#y#}) \\<in> mult1 R \\<Longrightarrow> (x, y) \\<in> R", "then"], ["proof (chain)\npicking this:\n  {#y#} = add_mset a M0\n  {#x#} = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R", "show \"(x, y) \\<in> R\""], ["proof (prove)\nusing this:\n  {#y#} = add_mset a M0\n  {#x#} = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R\n\ngoal (1 subgoal):\n 1. (x, y) \\<in> R", "by (auto simp: add_eq_conv_diff)"], ["proof (state)\nthis:\n  (x, y) \\<in> R\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mulex1_singleton [iff]:\n  \"mulex1 P {#x#} {#y#} \\<longleftrightarrow> P x y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P {#x#} {#y#} = P x y", "using mult1_singleton [of x y \"{(x, y). P x y}\"]"], ["proof (prove)\nusing this:\n  (({#x#}, {#y#}) \\<in> mult1 {(x, y). P x y}) =\n  ((x, y) \\<in> {(x, y). P x y})\n\ngoal (1 subgoal):\n 1. mulex1 P {#x#} {#y#} = P x y", "by (simp add: mulex1_def)"], ["", "lemma singleton_mulex_onI:\n  \"P x y \\<Longrightarrow> x \\<in> A \\<Longrightarrow> y \\<in> A \\<Longrightarrow> mulex_on P A {#x#} {#y#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>P x y; x \\<in> A; y \\<in> A\\<rbrakk>\n    \\<Longrightarrow> mulex_on P A {#x#} {#y#}", "by (auto simp: mulex_on_def)"], ["", "lemma reflclp_mulex_on_add_right [simp]:\n  assumes \"(mulex_on P A)\\<^sup>=\\<^sup>= M N\" and \"M \\<in> multisets A\" and \"a \\<in> A\"\n  shows \"mulex_on P A M (N + {#a#})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A M (N + {#a#})", "using assms"], ["proof (prove)\nusing this:\n  (mulex_on P A)\\<^sup>=\\<^sup>= M N\n  M \\<in> multisets A\n  a \\<in> A\n\ngoal (1 subgoal):\n 1. mulex_on P A M (N + {#a#})", "by (cases \"M = N\") simp_all"], ["", "lemma reflclp_mulex_on_add_right' [simp]:\n  assumes \"(mulex_on P A)\\<^sup>=\\<^sup>= M N\" and \"M \\<in> multisets A\" and \"a \\<in> A\"\n  shows \"mulex_on P A M ({#a#} + N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A M ({#a#} + N)", "using reflclp_mulex_on_add_right [OF assms]"], ["proof (prove)\nusing this:\n  mulex_on P A M (N + {#a#})\n\ngoal (1 subgoal):\n 1. mulex_on P A M ({#a#} + N)", "by (simp add: ac_simps)"], ["", "lemma mulex_on_union_right [simp]:\n  assumes \"mulex_on P F A B\" and \"K \\<in> multisets F\"\n  shows \"mulex_on P F A (K + B)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P F A (K + B)", "using assms"], ["proof (prove)\nusing this:\n  mulex_on P F A B\n  K \\<in> multisets F\n\ngoal (1 subgoal):\n 1. mulex_on P F A (K + B)", "proof (induct K)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>mulex_on P F A B; {#} \\<in> multisets F\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F A ({#} + B)\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>mulex_on P F A B; K \\<in> multisets F\\<rbrakk>\n                \\<Longrightarrow> mulex_on P F A (K + B);\n        mulex_on P F A B; add_mset x K \\<in> multisets F\\<rbrakk>\n       \\<Longrightarrow> mulex_on P F A (add_mset x K + B)", "case (add a K)"], ["proof (state)\nthis:\n  \\<lbrakk>mulex_on P F A B; K \\<in> multisets F\\<rbrakk>\n  \\<Longrightarrow> mulex_on P F A (K + B)\n  mulex_on P F A B\n  add_mset a K \\<in> multisets F\n\ngoal (2 subgoals):\n 1. \\<lbrakk>mulex_on P F A B; {#} \\<in> multisets F\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F A ({#} + B)\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>mulex_on P F A B; K \\<in> multisets F\\<rbrakk>\n                \\<Longrightarrow> mulex_on P F A (K + B);\n        mulex_on P F A B; add_mset x K \\<in> multisets F\\<rbrakk>\n       \\<Longrightarrow> mulex_on P F A (add_mset x K + B)", "then"], ["proof (chain)\npicking this:\n  \\<lbrakk>mulex_on P F A B; K \\<in> multisets F\\<rbrakk>\n  \\<Longrightarrow> mulex_on P F A (K + B)\n  mulex_on P F A B\n  add_mset a K \\<in> multisets F", "have \"a \\<in> F\" and \"mulex_on P F A (B + K)\""], ["proof (prove)\nusing this:\n  \\<lbrakk>mulex_on P F A B; K \\<in> multisets F\\<rbrakk>\n  \\<Longrightarrow> mulex_on P F A (K + B)\n  mulex_on P F A B\n  add_mset a K \\<in> multisets F\n\ngoal (1 subgoal):\n 1. a \\<in> F &&& mulex_on P F A (B + K)", "by (auto simp: multisets_def ac_simps)"], ["proof (state)\nthis:\n  a \\<in> F\n  mulex_on P F A (B + K)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>mulex_on P F A B; {#} \\<in> multisets F\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F A ({#} + B)\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>mulex_on P F A B; K \\<in> multisets F\\<rbrakk>\n                \\<Longrightarrow> mulex_on P F A (K + B);\n        mulex_on P F A B; add_mset x K \\<in> multisets F\\<rbrakk>\n       \\<Longrightarrow> mulex_on P F A (add_mset x K + B)", "then"], ["proof (chain)\npicking this:\n  a \\<in> F\n  mulex_on P F A (B + K)", "have \"mulex_on P F A ((B + K) + {#a#})\""], ["proof (prove)\nusing this:\n  a \\<in> F\n  mulex_on P F A (B + K)\n\ngoal (1 subgoal):\n 1. mulex_on P F A (B + K + {#a#})", "by simp"], ["proof (state)\nthis:\n  mulex_on P F A (B + K + {#a#})\n\ngoal (2 subgoals):\n 1. \\<lbrakk>mulex_on P F A B; {#} \\<in> multisets F\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F A ({#} + B)\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>mulex_on P F A B; K \\<in> multisets F\\<rbrakk>\n                \\<Longrightarrow> mulex_on P F A (K + B);\n        mulex_on P F A B; add_mset x K \\<in> multisets F\\<rbrakk>\n       \\<Longrightarrow> mulex_on P F A (add_mset x K + B)", "then"], ["proof (chain)\npicking this:\n  mulex_on P F A (B + K + {#a#})", "show ?case"], ["proof (prove)\nusing this:\n  mulex_on P F A (B + K + {#a#})\n\ngoal (1 subgoal):\n 1. mulex_on P F A (add_mset a K + B)", "by (simp add: ac_simps)"], ["proof (state)\nthis:\n  mulex_on P F A (add_mset a K + B)\n\ngoal (1 subgoal):\n 1. \\<lbrakk>mulex_on P F A B; {#} \\<in> multisets F\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F A ({#} + B)", "qed simp"], ["", "lemma mulex_on_union_right' [simp]:\n  assumes \"mulex_on P F A B\" and \"K \\<in> multisets F\"\n  shows \"mulex_on P F A (B + K)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P F A (B + K)", "using mulex_on_union_right [OF assms]"], ["proof (prove)\nusing this:\n  mulex_on P F A (K + B)\n\ngoal (1 subgoal):\n 1. mulex_on P F A (B + K)", "by (simp add: ac_simps)"], ["", "text \\<open>Adapted from @{thm all_accessible} in @{theory \"HOL-Library.Multiset\"}.\\<close>"], ["", "lemma accessible_on_mulex1_multisets:\n  assumes wf: \"wfp_on P A\"\n  shows \"\\<forall>M\\<in>multisets A. accessible_on (mulex1 P) (multisets A) M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>M\\<in>multisets A. accessible_on (mulex1 P) (multisets A) M", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "let ?P = \"mulex1 P\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "let ?A = \"multisets A\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "let ?acc = \"accessible_on ?P ?A\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "fix M M0 a"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "assume M0: \"?acc M0\"\n      and \"a \\<in> A\"\n      and \"M0 \\<in> ?A\"\n      and wf_hyp: \"\\<And>b. \\<lbrakk>b \\<in> A; P b a\\<rbrakk> \\<Longrightarrow> (\\<forall>M. ?acc (M) \\<longrightarrow> ?acc (M + {#b#}))\"\n      and acc_hyp: \"\\<forall>M. M \\<in> ?A \\<and> ?P M M0 \\<longrightarrow> ?acc (M + {#a#})\""], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) M0\n  a \\<in> A\n  M0 \\<in> multisets A\n  \\<lbrakk>?b \\<in> A; P ?b a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A) (M + {#?b#})\n  \\<forall>M.\n     M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#a#})\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "then"], ["proof (chain)\npicking this:\n  accessible_on (mulex1 P) (multisets A) M0\n  a \\<in> A\n  M0 \\<in> multisets A\n  \\<lbrakk>?b \\<in> A; P ?b a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A) (M + {#?b#})\n  \\<forall>M.\n     M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#a#})", "have \"add_mset a M0 \\<in> ?A\""], ["proof (prove)\nusing this:\n  accessible_on (mulex1 P) (multisets A) M0\n  a \\<in> A\n  M0 \\<in> multisets A\n  \\<lbrakk>?b \\<in> A; P ?b a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A) (M + {#?b#})\n  \\<forall>M.\n     M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#a#})\n\ngoal (1 subgoal):\n 1. add_mset a M0 \\<in> multisets A", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  add_mset a M0 \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "then"], ["proof (chain)\npicking this:\n  add_mset a M0 \\<in> multisets A", "have \"?acc (add_mset a M0)\""], ["proof (prove)\nusing this:\n  add_mset a M0 \\<in> multisets A\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (add_mset a M0)", "proof (rule accessible_onI [of \"add_mset a M0\"])"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y (add_mset a M0)\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "fix N"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y (add_mset a M0)\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "assume \"N \\<in> ?A\"\n        and \"?P N (add_mset a M0)\""], ["proof (state)\nthis:\n  N \\<in> multisets A\n  mulex1 P N (add_mset a M0)\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y (add_mset a M0)\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "then"], ["proof (chain)\npicking this:\n  N \\<in> multisets A\n  mulex1 P N (add_mset a M0)", "have \"((\\<exists>M. M \\<in> ?A \\<and> ?P M M0 \\<and> N = M + {#a#}) \\<or>\n          (\\<exists>K. (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K))\""], ["proof (prove)\nusing this:\n  N \\<in> multisets A\n  mulex1 P N (add_mset a M0)\n\ngoal (1 subgoal):\n 1. (\\<exists>M.\n        M \\<in> multisets A \\<and> mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n    (\\<exists>K.\n        (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)", "using mulex1_add [of P N M0 a]"], ["proof (prove)\nusing this:\n  N \\<in> multisets A\n  mulex1 P N (add_mset a M0)\n  mulex1 P N (M0 + {#a#}) \\<Longrightarrow>\n  (\\<exists>M. mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n  (\\<exists>K.\n      (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)\n\ngoal (1 subgoal):\n 1. (\\<exists>M.\n        M \\<in> multisets A \\<and> mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n    (\\<exists>K.\n        (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  (\\<exists>M.\n      M \\<in> multisets A \\<and> mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n  (\\<exists>K.\n      (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y (add_mset a M0)\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "then"], ["proof (chain)\npicking this:\n  (\\<exists>M.\n      M \\<in> multisets A \\<and> mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n  (\\<exists>K.\n      (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)", "show \"?acc (N)\""], ["proof (prove)\nusing this:\n  (\\<exists>M.\n      M \\<in> multisets A \\<and> mulex1 P M M0 \\<and> N = M + {#a#}) \\<or>\n  (\\<exists>K.\n      (\\<forall>b. b \\<in># K \\<longrightarrow> P b a) \\<and> N = M0 + K)\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) N", "proof (elim exE disjE conjE)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>M.\n       \\<lbrakk>M \\<in> multisets A; mulex1 P M M0; N = M + {#a#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N\n 2. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "fix M"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>M.\n       \\<lbrakk>M \\<in> multisets A; mulex1 P M M0; N = M + {#a#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N\n 2. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "assume \"M \\<in> ?A\" and \"?P M M0\" and N: \"N = M + {#a#}\""], ["proof (state)\nthis:\n  M \\<in> multisets A\n  mulex1 P M M0\n  N = M + {#a#}\n\ngoal (2 subgoals):\n 1. \\<And>M.\n       \\<lbrakk>M \\<in> multisets A; mulex1 P M M0; N = M + {#a#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N\n 2. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "from acc_hyp"], ["proof (chain)\npicking this:\n  \\<forall>M.\n     M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#a#})", "have \"M \\<in> ?A \\<and> ?P M M0 \\<longrightarrow> ?acc (M + {#a#})\""], ["proof (prove)\nusing this:\n  \\<forall>M.\n     M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#a#})\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n    accessible_on (mulex1 P) (multisets A) (M + {#a#})", ".."], ["proof (state)\nthis:\n  M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n  accessible_on (mulex1 P) (multisets A) (M + {#a#})\n\ngoal (2 subgoals):\n 1. \\<And>M.\n       \\<lbrakk>M \\<in> multisets A; mulex1 P M M0; N = M + {#a#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N\n 2. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "with \\<open>M \\<in> ?A\\<close> and \\<open>?P M M0\\<close>"], ["proof (chain)\npicking this:\n  M \\<in> multisets A\n  mulex1 P M M0\n  M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n  accessible_on (mulex1 P) (multisets A) (M + {#a#})", "have \"?acc (M + {#a#})\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n  mulex1 P M M0\n  M \\<in> multisets A \\<and> mulex1 P M M0 \\<longrightarrow>\n  accessible_on (mulex1 P) (multisets A) (M + {#a#})\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (M + {#a#})", "by blast"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (M + {#a#})\n\ngoal (2 subgoals):\n 1. \\<And>M.\n       \\<lbrakk>M \\<in> multisets A; mulex1 P M M0; N = M + {#a#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N\n 2. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "then"], ["proof (chain)\npicking this:\n  accessible_on (mulex1 P) (multisets A) (M + {#a#})", "show \"?acc (N)\""], ["proof (prove)\nusing this:\n  accessible_on (mulex1 P) (multisets A) (M + {#a#})\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) N", "by (simp only: N)"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) N\n\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "fix K"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "assume N: \"N = M0 + K\""], ["proof (state)\nthis:\n  N = M0 + K\n\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "assume \"\\<forall>b. b \\<in># K \\<longrightarrow> P b a\""], ["proof (state)\nthis:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "moreover"], ["proof (state)\nthis:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "from N and \\<open>N \\<in> ?A\\<close>"], ["proof (chain)\npicking this:\n  N = M0 + K\n  N \\<in> multisets A", "have \"K \\<in> ?A\""], ["proof (prove)\nusing this:\n  N = M0 + K\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. K \\<in> multisets A", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "ultimately"], ["proof (chain)\npicking this:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  K \\<in> multisets A", "have \"?acc (M0 + K)\""], ["proof (prove)\nusing this:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (M0 + K)", "proof (induct K)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<forall>b. b \\<in># {#} \\<longrightarrow> P b a;\n     {#} \\<in> multisets A\\<rbrakk>\n    \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) (M0 + {#})\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "case empty"], ["proof (state)\nthis:\n  \\<forall>b. b \\<in># {#} \\<longrightarrow> P b a\n  {#} \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<forall>b. b \\<in># {#} \\<longrightarrow> P b a;\n     {#} \\<in> multisets A\\<rbrakk>\n    \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) (M0 + {#})\n 2. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "from M0"], ["proof (chain)\npicking this:\n  accessible_on (mulex1 P) (multisets A) M0", "show \"?acc (M0 + {#})\""], ["proof (prove)\nusing this:\n  accessible_on (mulex1 P) (multisets A) M0\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (M0 + {#})", "by simp"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (M0 + {#})\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "case (add x K)"], ["proof (state)\nthis:\n  \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n   K \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) (M0 + K)\n  \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a\n  add_mset x K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "from add.prems"], ["proof (chain)\npicking this:\n  \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a\n  add_mset x K \\<in> multisets A", "have \"x \\<in> A\" and \"P x a\""], ["proof (prove)\nusing this:\n  \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a\n  add_mset x K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. x \\<in> A &&& P x a", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  x \\<in> A\n  P x a\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "with wf_hyp"], ["proof (chain)\npicking this:\n  \\<lbrakk>?b \\<in> A; P ?b a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A) (M + {#?b#})\n  x \\<in> A\n  P x a", "have \"\\<forall>M. ?acc M \\<longrightarrow> ?acc (M + {#x#})\""], ["proof (prove)\nusing this:\n  \\<lbrakk>?b \\<in> A; P ?b a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A) (M + {#?b#})\n  x \\<in> A\n  P x a\n\ngoal (1 subgoal):\n 1. \\<forall>M.\n       accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (M + {#x#})", "by blast"], ["proof (state)\nthis:\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#x#})\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "moreover"], ["proof (state)\nthis:\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#x#})\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "from add"], ["proof (chain)\npicking this:\n  \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n   K \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) (M0 + K)\n  \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a\n  add_mset x K \\<in> multisets A", "have \"?acc (M0 + K)\""], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n   K \\<in> multisets A\\<rbrakk>\n  \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) (M0 + K)\n  \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a\n  add_mset x K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (M0 + K)", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (M0 + K)\n\ngoal (1 subgoal):\n 1. \\<And>x K.\n       \\<lbrakk>\\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n                 K \\<in> multisets A\\<rbrakk>\n                \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                                   (M0 + K);\n        \\<forall>b. b \\<in># add_mset x K \\<longrightarrow> P b a;\n        add_mset x K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (M0 + add_mset x K)", "ultimately"], ["proof (chain)\npicking this:\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#x#})\n  accessible_on (mulex1 P) (multisets A) (M0 + K)", "show \"?acc (M0 + (add_mset x K))\""], ["proof (prove)\nusing this:\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (M + {#x#})\n  accessible_on (mulex1 P) (multisets A) (M0 + K)\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (M0 + add_mset x K)", "by simp"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (M0 + add_mset x K)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (M0 + K)\n\ngoal (1 subgoal):\n 1. \\<And>K.\n       \\<lbrakk>\\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n        N = M0 + K\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) N", "then"], ["proof (chain)\npicking this:\n  accessible_on (mulex1 P) (multisets A) (M0 + K)", "show \"?acc N\""], ["proof (prove)\nusing this:\n  accessible_on (mulex1 P) (multisets A) (M0 + K)\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) N", "by (simp only: N)"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) N\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) N\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (add_mset a M0)\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "}"], ["proof (state)\nthis:\n  \\<lbrakk>accessible_on (mulex1 P) (multisets A) ?M0.2; ?a2 \\<in> A;\n   ?M0.2 \\<in> multisets A;\n   \\<And>b.\n      \\<lbrakk>b \\<in> A; P b ?a2\\<rbrakk>\n      \\<Longrightarrow> \\<forall>M.\n                           accessible_on (mulex1 P) (multisets A)\n                            M \\<longrightarrow>\n                           accessible_on (mulex1 P) (multisets A)\n                            (M + {#b#});\n   \\<forall>M.\n      M \\<in> multisets A \\<and> mulex1 P M ?M0.2 \\<longrightarrow>\n      accessible_on (mulex1 P) (multisets A) (M + {#?a2#})\\<rbrakk>\n  \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                     (add_mset ?a2 ?M0.2)\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "note tedious_reasoning = this"], ["proof (state)\nthis:\n  \\<lbrakk>accessible_on (mulex1 P) (multisets A) ?M0.2; ?a2 \\<in> A;\n   ?M0.2 \\<in> multisets A;\n   \\<And>b.\n      \\<lbrakk>b \\<in> A; P b ?a2\\<rbrakk>\n      \\<Longrightarrow> \\<forall>M.\n                           accessible_on (mulex1 P) (multisets A)\n                            M \\<longrightarrow>\n                           accessible_on (mulex1 P) (multisets A)\n                            (M + {#b#});\n   \\<forall>M.\n      M \\<in> multisets A \\<and> mulex1 P M ?M0.2 \\<longrightarrow>\n      accessible_on (mulex1 P) (multisets A) (M + {#?a2#})\\<rbrakk>\n  \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                     (add_mset ?a2 ?M0.2)\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "fix M"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "assume \"M \\<in> ?A\""], ["proof (state)\nthis:\n  M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) M", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A", "show \"?acc M\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) M", "proof (induct M)"], ["proof (state)\ngoal (2 subgoals):\n 1. {#} \\<in> multisets A \\<Longrightarrow>\n    accessible_on (mulex1 P) (multisets A) {#}\n 2. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                accessible_on (mulex1 P) (multisets A) M;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (add_mset x M)", "show \"?acc {#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) {#}", "proof (rule accessible_onI)"], ["proof (state)\ngoal (2 subgoals):\n 1. {#} \\<in> multisets A\n 2. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y {#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "show \"{#} \\<in> ?A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {#} \\<in> multisets A", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  {#} \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y {#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y {#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "fix b"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y {#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "assume \"?P b {#}\""], ["proof (state)\nthis:\n  mulex1 P b {#}\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> multisets A; mulex1 P y {#}\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A) y", "then"], ["proof (chain)\npicking this:\n  mulex1 P b {#}", "show \"?acc b\""], ["proof (prove)\nusing this:\n  mulex1 P b {#}\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) b", "by simp"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) b\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) {#}\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                accessible_on (mulex1 P) (multisets A) M;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (add_mset x M)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                accessible_on (mulex1 P) (multisets A) M;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (add_mset x M)", "case (add a M)"], ["proof (state)\nthis:\n  M \\<in> multisets A \\<Longrightarrow>\n  accessible_on (mulex1 P) (multisets A) M\n  add_mset a M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                accessible_on (mulex1 P) (multisets A) M;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (add_mset x M)", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A \\<Longrightarrow>\n  accessible_on (mulex1 P) (multisets A) M\n  add_mset a M \\<in> multisets A", "have \"?acc M\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A \\<Longrightarrow>\n  accessible_on (mulex1 P) (multisets A) M\n  add_mset a M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) M", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) M\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                accessible_on (mulex1 P) (multisets A) M;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (add_mset x M)", "from add"], ["proof (chain)\npicking this:\n  M \\<in> multisets A \\<Longrightarrow>\n  accessible_on (mulex1 P) (multisets A) M\n  add_mset a M \\<in> multisets A", "have \"a \\<in> A\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A \\<Longrightarrow>\n  accessible_on (mulex1 P) (multisets A) M\n  add_mset a M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. a \\<in> A", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  a \\<in> A\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                accessible_on (mulex1 P) (multisets A) M;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (add_mset x M)", "with wf"], ["proof (chain)\npicking this:\n  wfp_on P A\n  a \\<in> A", "have \"\\<forall>M. ?acc M \\<longrightarrow> ?acc (add_mset a M)\""], ["proof (prove)\nusing this:\n  wfp_on P A\n  a \\<in> A\n\ngoal (1 subgoal):\n 1. \\<forall>M.\n       accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (add_mset a M)", "proof (induct)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> A;\n        \\<And>x.\n           \\<lbrakk>x \\<in> A; P x y\\<rbrakk>\n           \\<Longrightarrow> \\<forall>M.\n                                accessible_on (mulex1 P) (multisets A)\n                                 M \\<longrightarrow>\n                                accessible_on (mulex1 P) (multisets A)\n                                 (add_mset x M)\\<rbrakk>\n       \\<Longrightarrow> \\<forall>M.\n                            accessible_on (mulex1 P) (multisets A)\n                             M \\<longrightarrow>\n                            accessible_on (mulex1 P) (multisets A)\n                             (add_mset y M)", "case (less a)"], ["proof (state)\nthis:\n  a \\<in> A\n  \\<lbrakk>?x \\<in> A; P ?x a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A)\n                        (add_mset ?x M)\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> A;\n        \\<And>x.\n           \\<lbrakk>x \\<in> A; P x y\\<rbrakk>\n           \\<Longrightarrow> \\<forall>M.\n                                accessible_on (mulex1 P) (multisets A)\n                                 M \\<longrightarrow>\n                                accessible_on (mulex1 P) (multisets A)\n                                 (add_mset x M)\\<rbrakk>\n       \\<Longrightarrow> \\<forall>M.\n                            accessible_on (mulex1 P) (multisets A)\n                             M \\<longrightarrow>\n                            accessible_on (mulex1 P) (multisets A)\n                             (add_mset y M)", "then"], ["proof (chain)\npicking this:\n  a \\<in> A\n  \\<lbrakk>?x \\<in> A; P ?x a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A)\n                        (add_mset ?x M)", "have r: \"\\<And>b. \\<lbrakk>b \\<in> A; P b a\\<rbrakk> \\<Longrightarrow> (\\<forall>M. ?acc M \\<longrightarrow> ?acc (M + {#b#}))\""], ["proof (prove)\nusing this:\n  a \\<in> A\n  \\<lbrakk>?x \\<in> A; P ?x a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A)\n                        (add_mset ?x M)\n\ngoal (1 subgoal):\n 1. \\<And>b.\n       \\<lbrakk>b \\<in> A; P b a\\<rbrakk>\n       \\<Longrightarrow> \\<forall>M.\n                            accessible_on (mulex1 P) (multisets A)\n                             M \\<longrightarrow>\n                            accessible_on (mulex1 P) (multisets A)\n                             (M + {#b#})", "by auto"], ["proof (state)\nthis:\n  \\<lbrakk>?b \\<in> A; P ?b a\\<rbrakk>\n  \\<Longrightarrow> \\<forall>M.\n                       accessible_on (mulex1 P) (multisets A)\n                        M \\<longrightarrow>\n                       accessible_on (mulex1 P) (multisets A) (M + {#?b#})\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       \\<lbrakk>y \\<in> A;\n        \\<And>x.\n           \\<lbrakk>x \\<in> A; P x y\\<rbrakk>\n           \\<Longrightarrow> \\<forall>M.\n                                accessible_on (mulex1 P) (multisets A)\n                                 M \\<longrightarrow>\n                                accessible_on (mulex1 P) (multisets A)\n                                 (add_mset x M)\\<rbrakk>\n       \\<Longrightarrow> \\<forall>M.\n                            accessible_on (mulex1 P) (multisets A)\n                             M \\<longrightarrow>\n                            accessible_on (mulex1 P) (multisets A)\n                             (add_mset y M)", "show \"\\<forall>M. ?acc M \\<longrightarrow> ?acc (add_mset a M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>M.\n       accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (add_mset a M)", "proof (intro allI impI)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       accessible_on (mulex1 P) (multisets A) M \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (add_mset a M)", "fix M'"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       accessible_on (mulex1 P) (multisets A) M \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (add_mset a M)", "assume \"?acc M'\""], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) M'\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       accessible_on (mulex1 P) (multisets A) M \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (add_mset a M)", "moreover"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) M'\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       accessible_on (mulex1 P) (multisets A) M \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (add_mset a M)", "then"], ["proof (chain)\npicking this:\n  accessible_on (mulex1 P) (multisets A) M'", "have \"M' \\<in> ?A\""], ["proof (prove)\nusing this:\n  accessible_on (mulex1 P) (multisets A) M'\n\ngoal (1 subgoal):\n 1. M' \\<in> multisets A", "by (blast dest: accessible_on_imp_mem)"], ["proof (state)\nthis:\n  M' \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       accessible_on (mulex1 P) (multisets A) M \\<Longrightarrow>\n       accessible_on (mulex1 P) (multisets A) (add_mset a M)", "ultimately"], ["proof (chain)\npicking this:\n  accessible_on (mulex1 P) (multisets A) M'\n  M' \\<in> multisets A", "show \"?acc (add_mset a M')\""], ["proof (prove)\nusing this:\n  accessible_on (mulex1 P) (multisets A) M'\n  M' \\<in> multisets A\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (add_mset a M')", "by (induct) (rule tedious_reasoning [OF _ \\<open>a \\<in> A\\<close> _ r], auto)"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (add_mset a M')\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (add_mset a M)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (add_mset a M)\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                accessible_on (mulex1 P) (multisets A) M;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> accessible_on (mulex1 P) (multisets A)\n                          (add_mset x M)", "with \\<open>?acc (M)\\<close>"], ["proof (chain)\npicking this:\n  accessible_on (mulex1 P) (multisets A) M\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (add_mset a M)", "show \"?acc (add_mset a M)\""], ["proof (prove)\nusing this:\n  accessible_on (mulex1 P) (multisets A) M\n  \\<forall>M.\n     accessible_on (mulex1 P) (multisets A) M \\<longrightarrow>\n     accessible_on (mulex1 P) (multisets A) (add_mset a M)\n\ngoal (1 subgoal):\n 1. accessible_on (mulex1 P) (multisets A) (add_mset a M)", "by blast"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) (add_mset a M)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  accessible_on (mulex1 P) (multisets A) M\n\ngoal:\nNo subgoals!", "qed"], ["", "lemmas wfp_on_mulex1_multisets =\n  accessible_on_mulex1_multisets [THEN accessible_on_imp_wfp_on]"], ["", "lemmas irreflp_on_mulex1 =\n  wfp_on_mulex1_multisets [THEN wfp_on_imp_irreflp_on]"], ["", "lemma wfp_on_mulex_on_multisets:\n  assumes \"wfp_on P A\"\n  shows \"wfp_on (mulex_on P A) (multisets A)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wfp_on (mulex_on P A) (multisets A)", "using wfp_on_mulex1_multisets [OF assms]"], ["proof (prove)\nusing this:\n  wfp_on (mulex1 P) (multisets A)\n\ngoal (1 subgoal):\n 1. wfp_on (mulex_on P A) (multisets A)", "by (simp only: mulex_on_def wfp_on_restrict_to_tranclp_wfp_on_conv)"], ["", "lemmas irreflp_on_mulex_on =\n  wfp_on_mulex_on_multisets [THEN wfp_on_imp_irreflp_on]"], ["", "lemma mulex1_union:\n  \"mulex1 P M N \\<Longrightarrow> mulex1 P (K + M) (K + N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P M N \\<Longrightarrow> mulex1 P (K + M) (K + N)", "by (auto simp: mulex1_def mult1_union)"], ["", "lemma mulex_on_union:\n  assumes \"mulex_on P A M N\" and \"K \\<in> multisets A\"\n  shows \"mulex_on P A (K + M) (K + N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (K + M) (K + N)", "using assms"], ["proof (prove)\nusing this:\n  mulex_on P A M N\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A (K + M) (K + N)", "proof (induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N;\n        K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + M) (K + N)\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "case (base M N)"], ["proof (state)\nthis:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N;\n        K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + M) (K + N)\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A", "have \"mulex1 P (K + M) (K + N)\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex1 P (K + M) (K + N)", "by (blast dest: mulex1_union)"], ["proof (state)\nthis:\n  mulex1 P (K + M) (K + N)\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N;\n        K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + M) (K + N)\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "moreover"], ["proof (state)\nthis:\n  mulex1 P (K + M) (K + N)\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N;\n        K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + M) (K + N)\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "from base"], ["proof (chain)\npicking this:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A", "have \"(K + M) \\<in> multisets A\"\n    and \"(K + N) \\<in> multisets A\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. K + M \\<in> multisets A &&& K + N \\<in> multisets A", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  K + M \\<in> multisets A\n  K + N \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N;\n        K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + M) (K + N)\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "ultimately"], ["proof (chain)\npicking this:\n  mulex1 P (K + M) (K + N)\n  K + M \\<in> multisets A\n  K + N \\<in> multisets A", "have \"restrict_to (mulex1 P) (multisets A) (K + M) (K + N)\""], ["proof (prove)\nusing this:\n  mulex1 P (K + M) (K + N)\n  K + M \\<in> multisets A\n  K + N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. restrict_to (mulex1 P) (multisets A) (K + M) (K + N)", "by auto"], ["proof (state)\nthis:\n  restrict_to (mulex1 P) (multisets A) (K + M) (K + N)\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; mulex1 P M N;\n        K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + M) (K + N)\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "then"], ["proof (chain)\npicking this:\n  restrict_to (mulex1 P) (multisets A) (K + M) (K + N)", "show ?case"], ["proof (prove)\nusing this:\n  restrict_to (mulex1 P) (multisets A) (K + M) (K + N)\n\ngoal (1 subgoal):\n 1. mulex_on P A (K + M) (K + N)", "by (auto simp: mulex_on_def)"], ["proof (state)\nthis:\n  mulex_on P A (K + M) (K + N)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "case (step L M N)"], ["proof (state)\nthis:\n  mulex_on P A L M\n  K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M)\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "then"], ["proof (chain)\npicking this:\n  mulex_on P A L M\n  K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M)\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A", "have \"mulex1 P (K + M) (K + N)\""], ["proof (prove)\nusing this:\n  mulex_on P A L M\n  K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M)\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex1 P (K + M) (K + N)", "by (blast dest: mulex1_union)"], ["proof (state)\nthis:\n  mulex1 P (K + M) (K + N)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "moreover"], ["proof (state)\nthis:\n  mulex1 P (K + M) (K + N)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "from step"], ["proof (chain)\npicking this:\n  mulex_on P A L M\n  K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M)\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A", "have \"(K + M) \\<in> multisets A\" and \"(K + N) \\<in> multisets A\""], ["proof (prove)\nusing this:\n  mulex_on P A L M\n  K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M)\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. K + M \\<in> multisets A &&& K + N \\<in> multisets A", "by blast+"], ["proof (state)\nthis:\n  K + M \\<in> multisets A\n  K + N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "ultimately"], ["proof (chain)\npicking this:\n  mulex1 P (K + M) (K + N)\n  K + M \\<in> multisets A\n  K + N \\<in> multisets A", "have \"(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ (K + M) (K + N)\""], ["proof (prove)\nusing this:\n  mulex1 P (K + M) (K + N)\n  K + M \\<in> multisets A\n  K + N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ (K + M) (K + N)", "by auto"], ["proof (state)\nthis:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ (K + M) (K + N)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "moreover"], ["proof (state)\nthis:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ (K + M) (K + N)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "have \"mulex_on P A (K + L) (K + M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (K + L) (K + M)", "using step"], ["proof (prove)\nusing this:\n  mulex_on P A L M\n  K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M)\n  N \\<in> multisets A\n  mulex1 P M N\n  K \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A (K + L) (K + M)", "by blast"], ["proof (state)\nthis:\n  mulex_on P A (K + L) (K + M)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        K \\<in> multisets A \\<Longrightarrow> mulex_on P A (K + L) (K + M);\n        N \\<in> multisets A; mulex1 P M N; K \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A (K + L) (K + N)", "ultimately"], ["proof (chain)\npicking this:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ (K + M) (K + N)\n  mulex_on P A (K + L) (K + M)", "show ?case"], ["proof (prove)\nusing this:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ (K + M) (K + N)\n  mulex_on P A (K + L) (K + M)\n\ngoal (1 subgoal):\n 1. mulex_on P A (K + L) (K + N)", "by (auto simp: mulex_on_def)"], ["proof (state)\nthis:\n  mulex_on P A (K + L) (K + N)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mulex_on_union':\n  assumes \"mulex_on P A M N\" and \"K \\<in> multisets A\"\n  shows \"mulex_on P A (M + K) (N + K)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (M + K) (N + K)", "using mulex_on_union [OF assms]"], ["proof (prove)\nusing this:\n  mulex_on P A (K + M) (K + N)\n\ngoal (1 subgoal):\n 1. mulex_on P A (M + K) (N + K)", "by (simp add: ac_simps)"], ["", "lemma mulex_on_add_mset:\n  assumes \"mulex_on P A M N\" and \"m \\<in> A\"\n  shows \"mulex_on P A (add_mset m M) (add_mset m N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (add_mset m M) (add_mset m N)", "unfolding add_mset_add_single[of m M] add_mset_add_single[of m N]"], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (M + {#m#}) (N + {#m#})", "apply (rule mulex_on_union')"], ["proof (prove)\ngoal (2 subgoals):\n 1. mulex_on P A M N\n 2. {#m#} \\<in> multisets A", "using assms"], ["proof (prove)\nusing this:\n  mulex_on P A M N\n  m \\<in> A\n\ngoal (2 subgoals):\n 1. mulex_on P A M N\n 2. {#m#} \\<in> multisets A", "by auto"], ["", "lemma union_mulex_on_mono:\n  \"mulex_on P F A C \\<Longrightarrow> mulex_on P F B D \\<Longrightarrow> mulex_on P F (A + B) (C + D)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>mulex_on P F A C; mulex_on P F B D\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F (A + B) (C + D)", "by (metis mulex_on_multisetsD mulex_on_trans mulex_on_union mulex_on_union')"], ["", "lemma mulex_on_add_mset':\n  assumes \"P m n\" and \"m \\<in> A\" and \"n \\<in> A\" and \"M \\<in> multisets A\"\n  shows \"mulex_on P A (add_mset m M) (add_mset n M)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (add_mset m M) (add_mset n M)", "unfolding add_mset_add_single[of m M] add_mset_add_single[of n M]"], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (M + {#m#}) (M + {#n#})", "apply (rule mulex_on_union)"], ["proof (prove)\ngoal (2 subgoals):\n 1. mulex_on P A {#m#} {#n#}\n 2. M \\<in> multisets A", "using assms"], ["proof (prove)\nusing this:\n  P m n\n  m \\<in> A\n  n \\<in> A\n  M \\<in> multisets A\n\ngoal (2 subgoals):\n 1. mulex_on P A {#m#} {#n#}\n 2. M \\<in> multisets A", "by (auto simp: mulex_on_def)"], ["", "lemma mulex_on_add_mset_mono:\n  assumes \"P m n\" and \"m \\<in> A\" and \"n \\<in> A\" and \"mulex_on P A M N\"\n  shows \"mulex_on P A (add_mset m M) (add_mset n N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (add_mset m M) (add_mset n N)", "unfolding add_mset_add_single[of m M] add_mset_add_single[of n N]"], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (M + {#m#}) (N + {#n#})", "apply (rule union_mulex_on_mono)"], ["proof (prove)\ngoal (2 subgoals):\n 1. mulex_on P A M N\n 2. mulex_on P A {#m#} {#n#}", "using assms"], ["proof (prove)\nusing this:\n  P m n\n  m \\<in> A\n  n \\<in> A\n  mulex_on P A M N\n\ngoal (2 subgoals):\n 1. mulex_on P A M N\n 2. mulex_on P A {#m#} {#n#}", "by (auto simp: mulex_on_def)"], ["", "lemma union_mulex_on_mono1:\n  \"A \\<in> multisets F \\<Longrightarrow> (mulex_on P F)\\<^sup>=\\<^sup>= A C \\<Longrightarrow> mulex_on P F B D \\<Longrightarrow>\n    mulex_on P F (A + B) (C + D)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>A \\<in> multisets F; (mulex_on P F)\\<^sup>=\\<^sup>= A C;\n     mulex_on P F B D\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F (A + B) (C + D)", "by (auto intro: union_mulex_on_mono mulex_on_union)"], ["", "lemma union_mulex_on_mono2:\n  \"B \\<in> multisets F \\<Longrightarrow> mulex_on P F A C \\<Longrightarrow> (mulex_on P F)\\<^sup>=\\<^sup>= B D \\<Longrightarrow>\n    mulex_on P F (A + B) (C + D)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>B \\<in> multisets F; mulex_on P F A C;\n     (mulex_on P F)\\<^sup>=\\<^sup>= B D\\<rbrakk>\n    \\<Longrightarrow> mulex_on P F (A + B) (C + D)", "by (auto intro: union_mulex_on_mono mulex_on_union')"], ["", "lemma mult1_mono:\n  assumes \"\\<And>x y. \\<lbrakk>x \\<in> A; y \\<in> A; (x, y) \\<in> R\\<rbrakk> \\<Longrightarrow> (x, y) \\<in> S\"\n    and \"M \\<in> multisets A\"\n    and \"N \\<in> multisets A\"\n    and \"(M, N) \\<in> mult1 R\"\n  shows \"(M, N) \\<in> mult1 S\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (M, N) \\<in> mult1 S", "using assms"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x \\<in> A; ?y \\<in> A; (?x, ?y) \\<in> R\\<rbrakk>\n  \\<Longrightarrow> (?x, ?y) \\<in> S\n  M \\<in> multisets A\n  N \\<in> multisets A\n  (M, N) \\<in> mult1 R\n\ngoal (1 subgoal):\n 1. (M, N) \\<in> mult1 S", "unfolding mult1_def multisets_def"], ["proof (prove)\nusing this:\n  \\<lbrakk>?x \\<in> A; ?y \\<in> A; (?x, ?y) \\<in> R\\<rbrakk>\n  \\<Longrightarrow> (?x, ?y) \\<in> S\n  M \\<in> {M. set_mset M \\<subseteq> A}\n  N \\<in> {M. set_mset M \\<subseteq> A}\n  (M, N)\n  \\<in> {(N, M).\n         \\<exists>a M0 K.\n            M = add_mset a M0 \\<and>\n            N = M0 + K \\<and>\n            (\\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> R)}\n\ngoal (1 subgoal):\n 1. (M, N)\n    \\<in> {(N, M).\n           \\<exists>a M0 K.\n              M = add_mset a M0 \\<and>\n              N = M0 + K \\<and>\n              (\\<forall>b. b \\<in># K \\<longrightarrow> (b, a) \\<in> S)}", "by auto (metis (full_types) subsetD)"], ["", "lemma mulex1_mono:\n  assumes \"\\<And>x y. \\<lbrakk>x \\<in> A; y \\<in> A; P x y\\<rbrakk> \\<Longrightarrow> Q x y\"\n    and \"M \\<in> multisets A\"\n    and \"N \\<in> multisets A\"\n    and \"mulex1 P M N\"\n  shows \"mulex1 Q M N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 Q M N", "using mult1_mono [of A \"{(x, y). P x y}\" \"{(x, y). Q x y}\" M N]\n    and assms"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>x y.\n              \\<lbrakk>x \\<in> A; y \\<in> A;\n               (x, y) \\<in> {(x, y). P x y}\\<rbrakk>\n              \\<Longrightarrow> (x, y) \\<in> {(x, y). Q x y};\n   M \\<in> multisets A; N \\<in> multisets A;\n   (M, N) \\<in> mult1 {(x, y). P x y}\\<rbrakk>\n  \\<Longrightarrow> (M, N) \\<in> mult1 {(x, y). Q x y}\n  \\<lbrakk>?x \\<in> A; ?y \\<in> A; P ?x ?y\\<rbrakk>\n  \\<Longrightarrow> Q ?x ?y\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n\ngoal (1 subgoal):\n 1. mulex1 Q M N", "unfolding mulex1_def"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>x y.\n              \\<lbrakk>x \\<in> A; y \\<in> A;\n               (x, y) \\<in> {(x, y). P x y}\\<rbrakk>\n              \\<Longrightarrow> (x, y) \\<in> {(x, y). Q x y};\n   M \\<in> multisets A; N \\<in> multisets A;\n   (M, N) \\<in> mult1 {(x, y). P x y}\\<rbrakk>\n  \\<Longrightarrow> (M, N) \\<in> mult1 {(x, y). Q x y}\n  \\<lbrakk>?x \\<in> A; ?y \\<in> A; P ?x ?y\\<rbrakk>\n  \\<Longrightarrow> Q ?x ?y\n  M \\<in> multisets A\n  N \\<in> multisets A\n  (M, N) \\<in> mult1 {(x, y). P x y}\n\ngoal (1 subgoal):\n 1. (M, N) \\<in> mult1 {(x, y). Q x y}", "by blast"], ["", "lemma mulex_on_mono:\n  assumes *: \"\\<And>x y. \\<lbrakk>x \\<in> A; y \\<in> A; P x y\\<rbrakk> \\<Longrightarrow> Q x y\"\n    and \"mulex_on P A M N\"\n  shows \"mulex_on Q A M N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on Q A M N", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. mulex_on Q A M N", "let ?rel = \"\\<lambda>P. (restrict_to (mulex1 P) (multisets A))\""], ["proof (state)\ngoal (1 subgoal):\n 1. mulex_on Q A M N", "from \\<open>mulex_on P A M N\\<close>"], ["proof (chain)\npicking this:\n  mulex_on P A M N", "have \"(?rel P)\\<^sup>+\\<^sup>+ M N\""], ["proof (prove)\nusing this:\n  mulex_on P A M N\n\ngoal (1 subgoal):\n 1. (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ M N", "by (simp add: mulex_on_def)"], ["proof (state)\nthis:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ M N\n\ngoal (1 subgoal):\n 1. mulex_on Q A M N", "then"], ["proof (chain)\npicking this:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ M N", "have \"(?rel Q)\\<^sup>+\\<^sup>+ M N\""], ["proof (prove)\nusing this:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ M N\n\ngoal (1 subgoal):\n 1. (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ M N", "proof (induct rule: tranclp.induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>a b.\n       restrict_to (mulex1 P) (multisets A) a b \\<Longrightarrow>\n       (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b\n 2. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "case (r_into_trancl M N)"], ["proof (state)\nthis:\n  restrict_to (mulex1 P) (multisets A) M N\n\ngoal (2 subgoals):\n 1. \\<And>a b.\n       restrict_to (mulex1 P) (multisets A) a b \\<Longrightarrow>\n       (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b\n 2. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "then"], ["proof (chain)\npicking this:\n  restrict_to (mulex1 P) (multisets A) M N", "have \"M \\<in> multisets A\" and \"N \\<in> multisets A\""], ["proof (prove)\nusing this:\n  restrict_to (mulex1 P) (multisets A) M N\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A &&& N \\<in> multisets A", "by auto"], ["proof (state)\nthis:\n  M \\<in> multisets A\n  N \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<And>a b.\n       restrict_to (mulex1 P) (multisets A) a b \\<Longrightarrow>\n       (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b\n 2. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "from mulex1_mono [OF * this] and r_into_trancl"], ["proof (chain)\npicking this:\n  \\<lbrakk>\\<And>x y.\n              \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n              \\<Longrightarrow> ?x1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> ?y1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> P (?x1 x y) (?y1 x y);\n   mulex1 ?P M N\\<rbrakk>\n  \\<Longrightarrow> mulex1 (\\<lambda>x y. Q (?x1 x y) (?y1 x y)) M N\n  restrict_to (mulex1 P) (multisets A) M N", "show ?case"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>x y.\n              \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n              \\<Longrightarrow> ?x1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> ?y1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> P (?x1 x y) (?y1 x y);\n   mulex1 ?P M N\\<rbrakk>\n  \\<Longrightarrow> mulex1 (\\<lambda>x y. Q (?x1 x y) (?y1 x y)) M N\n  restrict_to (mulex1 P) (multisets A) M N\n\ngoal (1 subgoal):\n 1. (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ M N", "by auto"], ["proof (state)\nthis:\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ M N\n\ngoal (1 subgoal):\n 1. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "case (trancl_into_trancl L M N)"], ["proof (state)\nthis:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ L M\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L M\n  restrict_to (mulex1 P) (multisets A) M N\n\ngoal (1 subgoal):\n 1. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "then"], ["proof (chain)\npicking this:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ L M\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L M\n  restrict_to (mulex1 P) (multisets A) M N", "have \"M \\<in> multisets A\" and \"N \\<in> multisets A\""], ["proof (prove)\nusing this:\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ L M\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L M\n  restrict_to (mulex1 P) (multisets A) M N\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A &&& N \\<in> multisets A", "by auto"], ["proof (state)\nthis:\n  M \\<in> multisets A\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "from mulex1_mono [OF * this] and trancl_into_trancl"], ["proof (chain)\npicking this:\n  \\<lbrakk>\\<And>x y.\n              \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n              \\<Longrightarrow> ?x1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> ?y1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> P (?x1 x y) (?y1 x y);\n   mulex1 ?P M N\\<rbrakk>\n  \\<Longrightarrow> mulex1 (\\<lambda>x y. Q (?x1 x y) (?y1 x y)) M N\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ L M\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L M\n  restrict_to (mulex1 P) (multisets A) M N", "have \"?rel Q M N\""], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>x y.\n              \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n              \\<Longrightarrow> ?x1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> ?y1 x y \\<in> A;\n   \\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; ?P x y\\<rbrakk>\n      \\<Longrightarrow> P (?x1 x y) (?y1 x y);\n   mulex1 ?P M N\\<rbrakk>\n  \\<Longrightarrow> mulex1 (\\<lambda>x y. Q (?x1 x y) (?y1 x y)) M N\n  (restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ L M\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L M\n  restrict_to (mulex1 P) (multisets A) M N\n\ngoal (1 subgoal):\n 1. restrict_to (mulex1 Q) (multisets A) M N", "by auto"], ["proof (state)\nthis:\n  restrict_to (mulex1 Q) (multisets A) M N\n\ngoal (1 subgoal):\n 1. \\<And>a b c.\n       \\<lbrakk>(restrict_to (mulex1 P) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ a b;\n        restrict_to (mulex1 P) (multisets A) b c\\<rbrakk>\n       \\<Longrightarrow> (restrict_to (mulex1 Q)\n                           (multisets A))\\<^sup>+\\<^sup>+\n                          a c", "with \\<open>(?rel Q)\\<^sup>+\\<^sup>+ L M\\<close>"], ["proof (chain)\npicking this:\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L M\n  restrict_to (mulex1 Q) (multisets A) M N", "show ?case"], ["proof (prove)\nusing this:\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L M\n  restrict_to (mulex1 Q) (multisets A) M N\n\ngoal (1 subgoal):\n 1. (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L N", "by (rule tranclp.trancl_into_trancl)"], ["proof (state)\nthis:\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ L N\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ M N\n\ngoal (1 subgoal):\n 1. mulex_on Q A M N", "then"], ["proof (chain)\npicking this:\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ M N", "show ?thesis"], ["proof (prove)\nusing this:\n  (restrict_to (mulex1 Q) (multisets A))\\<^sup>+\\<^sup>+ M N\n\ngoal (1 subgoal):\n 1. mulex_on Q A M N", "by (simp add: mulex_on_def)"], ["proof (state)\nthis:\n  mulex_on Q A M N\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma mult1_reflcl:\n  assumes \"(M, N) \\<in> mult1 R\"\n  shows \"(M, N) \\<in> mult1 (R\\<^sup>=)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (M, N) \\<in> mult1 (R\\<^sup>=)", "using assms"], ["proof (prove)\nusing this:\n  (M, N) \\<in> mult1 R\n\ngoal (1 subgoal):\n 1. (M, N) \\<in> mult1 (R\\<^sup>=)", "by (auto simp: mult1_def)"], ["", "lemma mulex1_reflclp:\n  assumes \"mulex1 P M N\"\n  shows \"mulex1 (P\\<^sup>=\\<^sup>=) M N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex1 P\\<^sup>=\\<^sup>= M N", "using mulex1_mono [of UNIV P \"P\\<^sup>=\\<^sup>=\" M N, OF _ _ _ assms]"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<And>x y.\n              \\<lbrakk>x \\<in> UNIV; y \\<in> UNIV; P x y\\<rbrakk>\n              \\<Longrightarrow> P\\<^sup>=\\<^sup>= x y;\n   M \\<in> multisets UNIV; N \\<in> multisets UNIV\\<rbrakk>\n  \\<Longrightarrow> mulex1 P\\<^sup>=\\<^sup>= M N\n\ngoal (1 subgoal):\n 1. mulex1 P\\<^sup>=\\<^sup>= M N", "by (auto simp: multisets_def)"], ["", "lemma mulex_on_reflclp:\n  assumes \"mulex_on P A M N\"\n  shows \"mulex_on (P\\<^sup>=\\<^sup>=) A M N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P\\<^sup>=\\<^sup>= A M N", "using mulex_on_mono [OF _ assms, of \"P\\<^sup>=\\<^sup>=\"]"], ["proof (prove)\nusing this:\n  (\\<And>x y.\n      \\<lbrakk>x \\<in> A; y \\<in> A; P x y\\<rbrakk>\n      \\<Longrightarrow> P\\<^sup>=\\<^sup>= x y) \\<Longrightarrow>\n  mulex_on P\\<^sup>=\\<^sup>= A M N\n\ngoal (1 subgoal):\n 1. mulex_on P\\<^sup>=\\<^sup>= A M N", "by auto"], ["", "lemma surj_on_multisets_mset:\n  \"\\<forall>M\\<in>multisets A. \\<exists>xs\\<in>lists A. M = mset xs\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>M\\<in>multisets A. \\<exists>xs\\<in>lists A. M = mset xs", "proof"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       \\<exists>xs\\<in>lists A. M = mset xs", "fix M"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       \\<exists>xs\\<in>lists A. M = mset xs", "assume \"M \\<in> multisets A\""], ["proof (state)\nthis:\n  M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>M.\n       M \\<in> multisets A \\<Longrightarrow>\n       \\<exists>xs\\<in>lists A. M = mset xs", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A", "show \"\\<exists>xs\\<in>lists A. M = mset xs\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<exists>xs\\<in>lists A. M = mset xs", "proof (induct M)"], ["proof (state)\ngoal (2 subgoals):\n 1. {#} \\<in> multisets A \\<Longrightarrow>\n    \\<exists>xs\\<in>lists A. {#} = mset xs\n 2. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "case empty"], ["proof (state)\nthis:\n  {#} \\<in> multisets A\n\ngoal (2 subgoals):\n 1. {#} \\<in> multisets A \\<Longrightarrow>\n    \\<exists>xs\\<in>lists A. {#} = mset xs\n 2. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>xs\\<in>lists A. {#} = mset xs", "by simp"], ["proof (state)\nthis:\n  \\<exists>xs\\<in>lists A. {#} = mset xs\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "case (add a M)"], ["proof (state)\nthis:\n  M \\<in> multisets A \\<Longrightarrow> \\<exists>xs\\<in>lists A. M = mset xs\n  add_mset a M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A \\<Longrightarrow> \\<exists>xs\\<in>lists A. M = mset xs\n  add_mset a M \\<in> multisets A", "obtain xs where \"xs \\<in> lists A\" and \"M = mset xs\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A \\<Longrightarrow> \\<exists>xs\\<in>lists A. M = mset xs\n  add_mset a M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. (\\<And>xs.\n        \\<lbrakk>xs \\<in> lists A; M = mset xs\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  xs \\<in> lists A\n  M = mset xs\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "then"], ["proof (chain)\npicking this:\n  xs \\<in> lists A\n  M = mset xs", "have \"add_mset a M = mset (a # xs)\""], ["proof (prove)\nusing this:\n  xs \\<in> lists A\n  M = mset xs\n\ngoal (1 subgoal):\n 1. add_mset a M = mset (a # xs)", "by simp"], ["proof (state)\nthis:\n  add_mset a M = mset (a # xs)\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "moreover"], ["proof (state)\nthis:\n  add_mset a M = mset (a # xs)\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "have \"a # xs \\<in> lists A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. a # xs \\<in> lists A", "using \\<open>xs \\<in> lists A\\<close> and add"], ["proof (prove)\nusing this:\n  xs \\<in> lists A\n  M \\<in> multisets A \\<Longrightarrow> \\<exists>xs\\<in>lists A. M = mset xs\n  add_mset a M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. a # xs \\<in> lists A", "by auto"], ["proof (state)\nthis:\n  a # xs \\<in> lists A\n\ngoal (1 subgoal):\n 1. \\<And>x M.\n       \\<lbrakk>M \\<in> multisets A \\<Longrightarrow>\n                \\<exists>xs\\<in>lists A. M = mset xs;\n        add_mset x M \\<in> multisets A\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xs\\<in>lists A. add_mset x M = mset xs", "ultimately"], ["proof (chain)\npicking this:\n  add_mset a M = mset (a # xs)\n  a # xs \\<in> lists A", "show ?case"], ["proof (prove)\nusing this:\n  add_mset a M = mset (a # xs)\n  a # xs \\<in> lists A\n\ngoal (1 subgoal):\n 1. \\<exists>xs\\<in>lists A. add_mset a M = mset xs", "by blast"], ["proof (state)\nthis:\n  \\<exists>xs\\<in>lists A. add_mset a M = mset xs\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<exists>xs\\<in>lists A. M = mset xs\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma image_mset_lists [simp]:\n  \"mset ` lists A = multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mset ` lists A = multisets A", "using surj_on_multisets_mset [of A]"], ["proof (prove)\nusing this:\n  \\<forall>M\\<in>multisets A. \\<exists>xs\\<in>lists A. M = mset xs\n\ngoal (1 subgoal):\n 1. mset ` lists A = multisets A", "by auto (metis mem_Collect_eq multisets_def set_mset_mset subsetI)"], ["", "lemma multisets_UNIV [simp]: \"multisets UNIV = UNIV\""], ["proof (prove)\ngoal (1 subgoal):\n 1. multisets UNIV = UNIV", "by (metis image_mset_lists lists_UNIV surj_mset)"], ["", "lemma non_empty_multiset_induct [consumes 1, case_names singleton add]:\n  assumes \"M \\<noteq> {#}\"\n    and \"\\<And>x. P {#x#}\"\n    and \"\\<And>x M. P M \\<Longrightarrow> P (add_mset x M)\"\n  shows \"P M\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P M", "using assms"], ["proof (prove)\nusing this:\n  M \\<noteq> {#}\n  P {#?x#}\n  P ?M \\<Longrightarrow> P (add_mset ?x ?M)\n\ngoal (1 subgoal):\n 1. P M", "by (induct M) auto"], ["", "lemma mulex_on_all_strict:\n  assumes \"X \\<noteq> {#}\"\n  assumes \"X \\<in> multisets A\" and \"Y \\<in> multisets A\"\n    and *: \"\\<forall>y. y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\"\n  shows \"mulex_on P A Y X\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A Y X", "using assms"], ["proof (prove)\nusing this:\n  X \\<noteq> {#}\n  X \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\n\ngoal (1 subgoal):\n 1. mulex_on P A Y X", "proof (induction X arbitrary: Y rule: non_empty_multiset_induct)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x Y.\n       \\<lbrakk>{#x#} \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y {#x#}\n 2. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "case (singleton x)"], ["proof (state)\nthis:\n  {#x#} \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\n\ngoal (2 subgoals):\n 1. \\<And>x Y.\n       \\<lbrakk>{#x#} \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y {#x#}\n 2. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "then"], ["proof (chain)\npicking this:\n  {#x#} \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)", "have \"mulex1 P Y {#x#}\""], ["proof (prove)\nusing this:\n  {#x#} \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\n\ngoal (1 subgoal):\n 1. mulex1 P Y {#x#}", "unfolding mulex1_def mult1_def"], ["proof (prove)\nusing this:\n  {#x#} \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\n\ngoal (1 subgoal):\n 1. (Y, {#x#})\n    \\<in> {(N, M).\n           \\<exists>a M0 K.\n              M = add_mset a M0 \\<and>\n              N = M0 + K \\<and>\n              (\\<forall>b.\n                  b \\<in># K \\<longrightarrow>\n                  (b, a) \\<in> {(x, y). P x y})}", "by auto"], ["proof (state)\nthis:\n  mulex1 P Y {#x#}\n\ngoal (2 subgoals):\n 1. \\<And>x Y.\n       \\<lbrakk>{#x#} \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y {#x#}\n 2. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "with singleton"], ["proof (chain)\npicking this:\n  {#x#} \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\n  mulex1 P Y {#x#}", "show ?case"], ["proof (prove)\nusing this:\n  {#x#} \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># {#x#} \\<and> P y xa)\n  mulex1 P Y {#x#}\n\ngoal (1 subgoal):\n 1. mulex_on P A Y {#x#}", "by (auto simp: mulex_on_def)"], ["proof (state)\nthis:\n  mulex_on P A Y {#x#}\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "case (add x M)"], ["proof (state)\nthis:\n  \\<lbrakk>M \\<in> multisets A; ?Y \\<in> multisets A;\n   \\<forall>y.\n      y \\<in># ?Y \\<longrightarrow>\n      (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A ?Y M\n  add_mset x M \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "let ?Y = \"{# y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x #}\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "let ?Z = \"Y - ?Y\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "have Y: \"Y = ?Z + ?Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Y =\n    Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n    {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}", "by (subst multiset_eq_iff) auto"], ["proof (state)\nthis:\n  Y =\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n  {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "from \\<open>Y \\<in> multisets A\\<close>"], ["proof (chain)\npicking this:\n  Y \\<in> multisets A", "have \"?Y \\<in> multisets A\""], ["proof (prove)\nusing this:\n  Y \\<in> multisets A\n\ngoal (1 subgoal):\n 1. {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A", "by (metis multiset_partition union_multisets_iff)"], ["proof (state)\nthis:\n  {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "moreover"], ["proof (state)\nthis:\n  {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "have \"\\<forall>y. y \\<in># ?Y \\<longrightarrow> (\\<exists>x. x \\<in># M \\<and> P y x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># {#y \\<in># Y.\n                 \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n       (\\<exists>x. x \\<in># M \\<and> P y x)", "by auto"], ["proof (state)\nthis:\n  \\<forall>y.\n     y \\<in># {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     (\\<exists>x. x \\<in># M \\<and> P y x)\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "moreover"], ["proof (state)\nthis:\n  \\<forall>y.\n     y \\<in># {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     (\\<exists>x. x \\<in># M \\<and> P y x)\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "have \"M \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M \\<in> multisets A", "using add"], ["proof (prove)\nusing this:\n  \\<lbrakk>M \\<in> multisets A; ?Y \\<in> multisets A;\n   \\<forall>y.\n      y \\<in># ?Y \\<longrightarrow>\n      (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A ?Y M\n  add_mset x M \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A", "by auto"], ["proof (state)\nthis:\n  M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "ultimately"], ["proof (chain)\npicking this:\n  {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A\n  \\<forall>y.\n     y \\<in># {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     (\\<exists>x. x \\<in># M \\<and> P y x)\n  M \\<in> multisets A", "have \"mulex_on P A ?Y M\""], ["proof (prove)\nusing this:\n  {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A\n  \\<forall>y.\n     y \\<in># {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     (\\<exists>x. x \\<in># M \\<and> P y x)\n  M \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} M", "using add"], ["proof (prove)\nusing this:\n  {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A\n  \\<forall>y.\n     y \\<in># {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     (\\<exists>x. x \\<in># M \\<and> P y x)\n  M \\<in> multisets A\n  \\<lbrakk>M \\<in> multisets A; ?Y \\<in> multisets A;\n   \\<forall>y.\n      y \\<in># ?Y \\<longrightarrow>\n      (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n  \\<Longrightarrow> mulex_on P A ?Y M\n  add_mset x M \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\n\ngoal (1 subgoal):\n 1. mulex_on P A {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} M", "by blast"], ["proof (state)\nthis:\n  mulex_on P A {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} M\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "moreover"], ["proof (state)\nthis:\n  mulex_on P A {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} M\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "have \"mulex_on P A ?Z {#x#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "have \"{#x#} = {#} + {#x#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {#x#} = {#} + {#x#}", "by simp"], ["proof (state)\nthis:\n  {#x#} = {#} + {#x#}\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "moreover"], ["proof (state)\nthis:\n  {#x#} = {#} + {#x#}\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "have \"?Z = {#} + ?Z\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} =\n    {#} + (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})", "by simp"], ["proof (state)\nthis:\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} =\n  {#} + (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "moreover"], ["proof (state)\nthis:\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} =\n  {#} + (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "have \"\\<forall>y. y \\<in># ?Z \\<longrightarrow> P y x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># Y -\n                {#y \\<in># Y.\n                 \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n       P y x", "using add.prems"], ["proof (prove)\nusing this:\n  add_mset x M \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\n\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># Y -\n                {#y \\<in># Y.\n                 \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n       P y x", "by (auto simp add: in_diff_count split: if_splits)"], ["proof (state)\nthis:\n  \\<forall>y.\n     y \\<in># Y -\n              {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     P y x\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "ultimately"], ["proof (chain)\npicking this:\n  {#x#} = {#} + {#x#}\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} =\n  {#} + (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n  \\<forall>y.\n     y \\<in># Y -\n              {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     P y x", "have \"mulex1 P ?Z {#x#}\""], ["proof (prove)\nusing this:\n  {#x#} = {#} + {#x#}\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} =\n  {#} + (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n  \\<forall>y.\n     y \\<in># Y -\n              {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     P y x\n\ngoal (1 subgoal):\n 1. mulex1 P (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}) {#x#}", "unfolding mulex1_def mult1_def"], ["proof (prove)\nusing this:\n  {#x#} = {#} + {#x#}\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} =\n  {#} + (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n  \\<forall>y.\n     y \\<in># Y -\n              {#y \\<in># Y.\n               \\<exists>x. x \\<in># M \\<and> P y x#} \\<longrightarrow>\n     P y x\n\ngoal (1 subgoal):\n 1. (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}, {#x#})\n    \\<in> {(N, M).\n           \\<exists>a M0 K.\n              M = add_mset a M0 \\<and>\n              N = M0 + K \\<and>\n              (\\<forall>b.\n                  b \\<in># K \\<longrightarrow>\n                  (b, a) \\<in> {(x, y). P x y})}", "by blast"], ["proof (state)\nthis:\n  mulex1 P (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}) {#x#}\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "moreover"], ["proof (state)\nthis:\n  mulex1 P (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}) {#x#}\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "have \"{#x#} \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {#x#} \\<in> multisets A", "using add.prems"], ["proof (prove)\nusing this:\n  add_mset x M \\<in> multisets A\n  Y \\<in> multisets A\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow>\n     (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\n\ngoal (1 subgoal):\n 1. {#x#} \\<in> multisets A", "by auto"], ["proof (state)\nthis:\n  {#x#} \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "moreover"], ["proof (state)\nthis:\n  {#x#} \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "have \"?Z \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}\n    \\<in> multisets A", "using \\<open>Y \\<in> multisets A\\<close>"], ["proof (prove)\nusing this:\n  Y \\<in> multisets A\n\ngoal (1 subgoal):\n 1. Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}\n    \\<in> multisets A", "by (metis diff_union_cancelL multiset_partition union_multisetsD)"], ["proof (state)\nthis:\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "ultimately"], ["proof (chain)\npicking this:\n  mulex1 P (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}) {#x#}\n  {#x#} \\<in> multisets A\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A", "show ?thesis"], ["proof (prove)\nusing this:\n  mulex1 P (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}) {#x#}\n  {#x#} \\<in> multisets A\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n     {#x#}", "by (auto simp: mulex_on_def)"], ["proof (state)\nthis:\n  mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n   {#x#}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n   {#x#}\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "ultimately"], ["proof (chain)\npicking this:\n  mulex_on P A {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} M\n  mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n   {#x#}", "have \"mulex_on P A (?Y + ?Z) (M + {#x#})\""], ["proof (prove)\nusing this:\n  mulex_on P A {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} M\n  mulex_on P A (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#})\n   {#x#}\n\ngoal (1 subgoal):\n 1. mulex_on P A\n     ({#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n      (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}))\n     (M + {#x#})", "by (rule union_mulex_on_mono)"], ["proof (state)\nthis:\n  mulex_on P A\n   ({#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n    (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}))\n   (M + {#x#})\n\ngoal (1 subgoal):\n 1. \\<And>x M Y.\n       \\<lbrakk>\\<And>Y.\n                   \\<lbrakk>M \\<in> multisets A; Y \\<in> multisets A;\n                    \\<forall>y.\n                       y \\<in># Y \\<longrightarrow>\n                       (\\<exists>x. x \\<in># M \\<and> P y x)\\<rbrakk>\n                   \\<Longrightarrow> mulex_on P A Y M;\n        add_mset x M \\<in> multisets A; Y \\<in> multisets A;\n        \\<forall>y.\n           y \\<in># Y \\<longrightarrow>\n           (\\<exists>xa. xa \\<in># add_mset x M \\<and> P y xa)\\<rbrakk>\n       \\<Longrightarrow> mulex_on P A Y (add_mset x M)", "then"], ["proof (chain)\npicking this:\n  mulex_on P A\n   ({#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n    (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}))\n   (M + {#x#})", "show ?case"], ["proof (prove)\nusing this:\n  mulex_on P A\n   ({#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n    (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}))\n   (M + {#x#})\n\ngoal (1 subgoal):\n 1. mulex_on P A Y (add_mset x M)", "using Y"], ["proof (prove)\nusing this:\n  mulex_on P A\n   ({#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n    (Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}))\n   (M + {#x#})\n  Y =\n  Y - {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#} +\n  {#y \\<in># Y. \\<exists>x. x \\<in># M \\<and> P y x#}\n\ngoal (1 subgoal):\n 1. mulex_on P A Y (add_mset x M)", "by (simp add: ac_simps)"], ["proof (state)\nthis:\n  mulex_on P A Y (add_mset x M)\n\ngoal:\nNo subgoals!", "qed"], ["", "text \\<open>The following lemma shows that the textbook definition (e.g.,\n``Term Rewriting and All That'') is the same as the one used below.\\<close>"], ["", "lemma diff_set_Ex_iff:\n  \"X \\<noteq> {#} \\<and> X \\<subseteq># M \\<and> N = (M - X) + Y \\<longleftrightarrow> X \\<noteq> {#} \\<and> (\\<exists>Z. M = Z + X \\<and> N = Z + Y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (X \\<noteq> {#} \\<and> X \\<subseteq># M \\<and> N = M - X + Y) =\n    (X \\<noteq> {#} \\<and> (\\<exists>Z. M = Z + X \\<and> N = Z + Y))", "by (auto) (metis add_diff_cancel_left' multiset_diff_union_assoc union_commute)"], ["", "text \\<open>Show that @{const mulex_on} is equivalent to the textbook definition\nof multiset-extension for transitive base orders.\\<close>"], ["", "lemma mulex_on_alt_def:\n  assumes trans: \"transp_on P A\"\n  shows \"mulex_on P A M N \\<longleftrightarrow> M \\<in> multisets A \\<and> N \\<in> multisets A \\<and> (\\<exists>X Y Z.\n    X \\<noteq> {#} \\<and> N = Z + X \\<and> M = Z + Y \\<and> (\\<forall>y. y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)))\"\n  (is \"?P M N \\<longleftrightarrow> ?Q M N\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. mulex_on P A M N =\n    (M \\<in> multisets A \\<and>\n     N \\<in> multisets A \\<and>\n     (\\<exists>X Y Z.\n         X \\<noteq> {#} \\<and>\n         N = Z + X \\<and>\n         M = Z + Y \\<and>\n         (\\<forall>y.\n             y \\<in># Y \\<longrightarrow>\n             (\\<exists>x. x \\<in># X \\<and> P y x))))", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. mulex_on P A M N \\<Longrightarrow>\n    M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "assume \"?P M N\""], ["proof (state)\nthis:\n  mulex_on P A M N\n\ngoal (2 subgoals):\n 1. mulex_on P A M N \\<Longrightarrow>\n    M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "then"], ["proof (chain)\npicking this:\n  mulex_on P A M N", "show \"?Q M N\""], ["proof (prove)\nusing this:\n  mulex_on P A M N\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x)))", "proof (induct M N)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "case (base M N)"], ["proof (state)\nthis:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N", "obtain a M0 K where N: \"N = M0 + {#a#}\"\n      and M: \"M = M0 + K\"\n      and *: \"\\<forall>b. b \\<in># K \\<longrightarrow> P b a\"\n      and \"M \\<in> multisets A\" and \"N \\<in> multisets A\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  mulex1 P M N\n\ngoal (1 subgoal):\n 1. (\\<And>M0 a K.\n        \\<lbrakk>N = M0 + {#a#}; M = M0 + K;\n         \\<forall>b. b \\<in># K \\<longrightarrow> P b a;\n         M \\<in> multisets A; N \\<in> multisets A\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by (auto simp: mulex1_def mult1_def)"], ["proof (state)\nthis:\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  M \\<in> multisets A\n  N \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "moreover"], ["proof (state)\nthis:\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  M \\<in> multisets A\n  N \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "then"], ["proof (chain)\npicking this:\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  M \\<in> multisets A\n  N \\<in> multisets A", "have \"{#a#} \\<in> multisets A\" and \"K \\<in> multisets A\""], ["proof (prove)\nusing this:\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  M \\<in> multisets A\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. {#a#} \\<in> multisets A &&& K \\<in> multisets A", "by auto"], ["proof (state)\nthis:\n  {#a#} \\<in> multisets A\n  K \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "moreover"], ["proof (state)\nthis:\n  {#a#} \\<in> multisets A\n  K \\<in> multisets A\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have \"{#a#} \\<noteq> {#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {#a#} \\<noteq> {#}", "by auto"], ["proof (state)\nthis:\n  {#a#} \\<noteq> {#}\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "moreover"], ["proof (state)\nthis:\n  {#a#} \\<noteq> {#}\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have \"N = M0 + {#a#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. N = M0 + {#a#}", "by fact"], ["proof (state)\nthis:\n  N = M0 + {#a#}\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "moreover"], ["proof (state)\nthis:\n  N = M0 + {#a#}\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have \"M = M0 + K\""], ["proof (prove)\ngoal (1 subgoal):\n 1. M = M0 + K", "by fact"], ["proof (state)\nthis:\n  M = M0 + K\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "moreover"], ["proof (state)\nthis:\n  M = M0 + K\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have \"\\<forall>y. y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># K \\<longrightarrow>\n       (\\<exists>x. x \\<in># {#a#} \\<and> P y x)", "using *"], ["proof (prove)\nusing this:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># K \\<longrightarrow>\n       (\\<exists>x. x \\<in># {#a#} \\<and> P y x)", "by auto"], ["proof (state)\nthis:\n  \\<forall>y.\n     y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\n\ngoal (2 subgoals):\n 1. \\<And>M N.\n       \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A;\n        mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> M \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             M = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))\n 2. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "ultimately"], ["proof (chain)\npicking this:\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  M \\<in> multisets A\n  N \\<in> multisets A\n  {#a#} \\<in> multisets A\n  K \\<in> multisets A\n  {#a#} \\<noteq> {#}\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>y.\n     y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)", "show ?case"], ["proof (prove)\nusing this:\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  M \\<in> multisets A\n  N \\<in> multisets A\n  {#a#} \\<in> multisets A\n  K \\<in> multisets A\n  {#a#} \\<noteq> {#}\n  N = M0 + {#a#}\n  M = M0 + K\n  \\<forall>y.\n     y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x)))", "by blast"], ["proof (state)\nthis:\n  M \\<in> multisets A \\<and>\n  N \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      N = Z + X \\<and>\n      M = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "case (step L M N)"], ["proof (state)\nthis:\n  mulex_on P A L M\n  L \\<in> multisets A \\<and>\n  M \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      M = Z + X \\<and>\n      L = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n  N \\<in> multisets A\n  mulex1 P M N\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "then"], ["proof (chain)\npicking this:\n  mulex_on P A L M\n  L \\<in> multisets A \\<and>\n  M \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      M = Z + X \\<and>\n      L = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n  N \\<in> multisets A\n  mulex1 P M N", "obtain X Y Z\n      where \"L \\<in> multisets A\" and \"M \\<in> multisets A\" and \"N \\<in> multisets A\"\n      and \"X \\<in> multisets A\" and \"Y \\<in> multisets A\"\n      and M: \"M = Z + X\"\n      and L: \"L = Z + Y\" and \"X \\<noteq> {#}\"\n      and Y: \"\\<forall>y. y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\"\n      and \"mulex1 P M N\""], ["proof (prove)\nusing this:\n  mulex_on P A L M\n  L \\<in> multisets A \\<and>\n  M \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      M = Z + X \\<and>\n      L = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n  N \\<in> multisets A\n  mulex1 P M N\n\ngoal (1 subgoal):\n 1. (\\<And>X Y Z.\n        \\<lbrakk>L \\<in> multisets A; M \\<in> multisets A;\n         N \\<in> multisets A; X \\<in> multisets A; Y \\<in> multisets A;\n         M = Z + X; L = Z + Y; X \\<noteq> {#};\n         \\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x);\n         mulex1 P M N\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  L \\<in> multisets A\n  M \\<in> multisets A\n  N \\<in> multisets A\n  X \\<in> multisets A\n  Y \\<in> multisets A\n  M = Z + X\n  L = Z + Y\n  X \\<noteq> {#}\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\n  mulex1 P M N\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "from \\<open>mulex1 P M N\\<close>"], ["proof (chain)\npicking this:\n  mulex1 P M N", "obtain a M0 K\n      where N: \"N = add_mset a M0\" and M': \"M = M0 + K\"\n      and *: \"\\<forall>b. b \\<in># K \\<longrightarrow> P b a\""], ["proof (prove)\nusing this:\n  mulex1 P M N\n\ngoal (1 subgoal):\n 1. (\\<And>a M0 K.\n        \\<lbrakk>N = add_mset a M0; M = M0 + K;\n         \\<forall>b. b \\<in># K \\<longrightarrow> P b a\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding mulex1_def mult1_def"], ["proof (prove)\nusing this:\n  (M, N)\n  \\<in> {(N, M).\n         \\<exists>a M0 K.\n            M = add_mset a M0 \\<and>\n            N = M0 + K \\<and>\n            (\\<forall>b.\n                b \\<in># K \\<longrightarrow> (b, a) \\<in> {(x, y). P x y})}\n\ngoal (1 subgoal):\n 1. (\\<And>a M0 K.\n        \\<lbrakk>N = add_mset a M0; M = M0 + K;\n         \\<forall>b. b \\<in># K \\<longrightarrow> P b a\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  N = add_mset a M0\n  M = M0 + K\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have L': \"L = (M - X) + Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. L = M - X + Y", "by (simp add: L M)"], ["proof (state)\nthis:\n  L = M - X + Y\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have K: \"\\<forall>y. y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># K \\<longrightarrow>\n       (\\<exists>x. x \\<in># {#a#} \\<and> P y x)", "using *"], ["proof (prove)\nusing this:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># K \\<longrightarrow>\n       (\\<exists>x. x \\<in># {#a#} \\<and> P y x)", "by auto"], ["proof (state)\nthis:\n  \\<forall>y.\n     y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "txt \\<open>The remainder of the proof is adapted from the proof of Lemma 2.5.4. of\n    the book ``Term Rewriting and All That.''\\<close>"], ["proof (state)\nthis:\n  \\<forall>y.\n     y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "let ?X = \"add_mset a (X - K)\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "let ?Y = \"(K - X) + Y\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have \"L \\<in> multisets A\" and \"N \\<in> multisets A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. L \\<in> multisets A &&& N \\<in> multisets A", "by fact+"], ["proof (state)\nthis:\n  L \\<in> multisets A\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "moreover"], ["proof (state)\nthis:\n  L \\<in> multisets A\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have \"?X \\<noteq> {#} \\<and> (\\<exists>Z. N = Z + ?X \\<and> L = Z + ?Y)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "have \"?X \\<noteq> {#}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#}", "by auto"], ["proof (state)\nthis:\n  add_mset a (X - K) \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "moreover"], ["proof (state)\nthis:\n  add_mset a (X - K) \\<noteq> {#}\n\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "have \"?X \\<subseteq># N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<subseteq># N", "using M N M'"], ["proof (prove)\nusing this:\n  M = Z + X\n  N = add_mset a M0\n  M = M0 + K\n\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<subseteq># N", "by (simp add: add.commute [of \"{#a#}\"])\n          (metis Multiset.diff_subset_eq_self add.commute add_diff_cancel_right)"], ["proof (state)\nthis:\n  add_mset a (X - K) \\<subseteq># N\n\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "moreover"], ["proof (state)\nthis:\n  add_mset a (X - K) \\<subseteq># N\n\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "have \"L = (N - ?X) + ?Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. L = N - add_mset a (X - K) + (K - X + Y)", "proof (rule multiset_eqI)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "fix x :: 'a"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "let ?c = \"\\<lambda>M. count M x\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "let ?ic = \"\\<lambda>x. int (?c x)\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "from \\<open>?X \\<subseteq># N\\<close>"], ["proof (chain)\npicking this:\n  add_mset a (X - K) \\<subseteq># N", "have *: \"?c {#a#} + ?c (X - K) \\<le> ?c N\""], ["proof (prove)\nusing this:\n  add_mset a (X - K) \\<subseteq># N\n\ngoal (1 subgoal):\n 1. count {#a#} x + count (X - K) x \\<le> count N x", "by (auto simp add: subseteq_mset_def split: if_splits)"], ["proof (state)\nthis:\n  count {#a#} x + count (X - K) x \\<le> count N x\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "from *"], ["proof (chain)\npicking this:\n  count {#a#} x + count (X - K) x \\<le> count N x", "have **: \"?c (X - K) \\<le> ?c M0\""], ["proof (prove)\nusing this:\n  count {#a#} x + count (X - K) x \\<le> count N x\n\ngoal (1 subgoal):\n 1. count (X - K) x \\<le> count M0 x", "unfolding N"], ["proof (prove)\nusing this:\n  count {#a#} x + count (X - K) x \\<le> count (add_mset a M0) x\n\ngoal (1 subgoal):\n 1. count (X - K) x \\<le> count M0 x", "by (auto split: if_splits)"], ["proof (state)\nthis:\n  count (X - K) x \\<le> count M0 x\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"?ic (N - ?X + ?Y) = int (?c N - ?c ?X) + ?ic ?Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count (N - add_mset a (X - K) + (K - X + Y)) x) =\n    int (count N x - count (add_mset a (X - K)) x) +\n    int (count (K - X + Y) x)", "by simp"], ["proof (state)\nthis:\n  int (count (N - add_mset a (X - K) + (K - X + Y)) x) =\n  int (count N x - count (add_mset a (X - K)) x) + int (count (K - X + Y) x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "also"], ["proof (state)\nthis:\n  int (count (N - add_mset a (X - K) + (K - X + Y)) x) =\n  int (count N x - count (add_mset a (X - K)) x) + int (count (K - X + Y) x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"\\<dots> = int (?c N - (?c {#a#} + ?c (X - K))) + ?ic (K - X) + ?ic Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count N x - count (add_mset a (X - K)) x) +\n    int (count (K - X + Y) x) =\n    int (count N x - (count {#a#} x + count (X - K) x)) +\n    int (count (K - X) x) +\n    int (count Y x)", "by simp"], ["proof (state)\nthis:\n  int (count N x - count (add_mset a (X - K)) x) +\n  int (count (K - X + Y) x) =\n  int (count N x - (count {#a#} x + count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "also"], ["proof (state)\nthis:\n  int (count N x - count (add_mset a (X - K)) x) +\n  int (count (K - X + Y) x) =\n  int (count N x - (count {#a#} x + count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"\\<dots> = ?ic N - (?ic {#a#} + ?ic (X - K)) + ?ic (K - X) + ?ic Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count N x - (count {#a#} x + count (X - K) x)) +\n    int (count (K - X) x) +\n    int (count Y x) =\n    int (count N x) - (int (count {#a#} x) + int (count (X - K) x)) +\n    int (count (K - X) x) +\n    int (count Y x)", "using of_nat_diff [OF *]"], ["proof (prove)\nusing this:\n  of_nat (count N x - (count {#a#} x + count (X - K) x)) =\n  of_nat (count N x) - of_nat (count {#a#} x + count (X - K) x)\n\ngoal (1 subgoal):\n 1. int (count N x - (count {#a#} x + count (X - K) x)) +\n    int (count (K - X) x) +\n    int (count Y x) =\n    int (count N x) - (int (count {#a#} x) + int (count (X - K) x)) +\n    int (count (K - X) x) +\n    int (count Y x)", "by simp"], ["proof (state)\nthis:\n  int (count N x - (count {#a#} x + count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x) =\n  int (count N x) - (int (count {#a#} x) + int (count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "also"], ["proof (state)\nthis:\n  int (count N x - (count {#a#} x + count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x) =\n  int (count N x) - (int (count {#a#} x) + int (count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"\\<dots> = (?ic N - ?ic {#a#}) - ?ic (X - K) + ?ic (K - X) + ?ic Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count N x) - (int (count {#a#} x) + int (count (X - K) x)) +\n    int (count (K - X) x) +\n    int (count Y x) =\n    int (count N x) - int (count {#a#} x) - int (count (X - K) x) +\n    int (count (K - X) x) +\n    int (count Y x)", "by simp"], ["proof (state)\nthis:\n  int (count N x) - (int (count {#a#} x) + int (count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x) =\n  int (count N x) - int (count {#a#} x) - int (count (X - K) x) +\n  int (count (K - X) x) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "also"], ["proof (state)\nthis:\n  int (count N x) - (int (count {#a#} x) + int (count (X - K) x)) +\n  int (count (K - X) x) +\n  int (count Y x) =\n  int (count N x) - int (count {#a#} x) - int (count (X - K) x) +\n  int (count (K - X) x) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"\\<dots> = (?ic N - ?ic {#a#}) + (?ic (K - X) - ?ic (X - K)) + ?ic Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count N x) - int (count {#a#} x) - int (count (X - K) x) +\n    int (count (K - X) x) +\n    int (count Y x) =\n    int (count N x) - int (count {#a#} x) +\n    (int (count (K - X) x) - int (count (X - K) x)) +\n    int (count Y x)", "by simp"], ["proof (state)\nthis:\n  int (count N x) - int (count {#a#} x) - int (count (X - K) x) +\n  int (count (K - X) x) +\n  int (count Y x) =\n  int (count N x) - int (count {#a#} x) +\n  (int (count (K - X) x) - int (count (X - K) x)) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "also"], ["proof (state)\nthis:\n  int (count N x) - int (count {#a#} x) - int (count (X - K) x) +\n  int (count (K - X) x) +\n  int (count Y x) =\n  int (count N x) - int (count {#a#} x) +\n  (int (count (K - X) x) - int (count (X - K) x)) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"\\<dots> = (?ic N - ?ic {#a#}) + (?ic K - ?ic X) + ?ic Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count N x) - int (count {#a#} x) +\n    (int (count (K - X) x) - int (count (X - K) x)) +\n    int (count Y x) =\n    int (count N x) - int (count {#a#} x) +\n    (int (count K x) - int (count X x)) +\n    int (count Y x)", "by simp"], ["proof (state)\nthis:\n  int (count N x) - int (count {#a#} x) +\n  (int (count (K - X) x) - int (count (X - K) x)) +\n  int (count Y x) =\n  int (count N x) - int (count {#a#} x) +\n  (int (count K x) - int (count X x)) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "also"], ["proof (state)\nthis:\n  int (count N x) - int (count {#a#} x) +\n  (int (count (K - X) x) - int (count (X - K) x)) +\n  int (count Y x) =\n  int (count N x) - int (count {#a#} x) +\n  (int (count K x) - int (count X x)) +\n  int (count Y x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"\\<dots> = (?ic N - ?ic ?X) + ?ic ?Y\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count N x) - int (count {#a#} x) +\n    (int (count K x) - int (count X x)) +\n    int (count Y x) =\n    int (count N x) - int (count (add_mset a (X - K)) x) +\n    int (count (K - X + Y) x)", "by (simp add: N)"], ["proof (state)\nthis:\n  int (count N x) - int (count {#a#} x) +\n  (int (count K x) - int (count X x)) +\n  int (count Y x) =\n  int (count N x) - int (count (add_mset a (X - K)) x) +\n  int (count (K - X + Y) x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "also"], ["proof (state)\nthis:\n  int (count N x) - int (count {#a#} x) +\n  (int (count K x) - int (count X x)) +\n  int (count Y x) =\n  int (count N x) - int (count (add_mset a (X - K)) x) +\n  int (count (K - X + Y) x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "have \"\\<dots> = ?ic L\""], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count N x) - int (count (add_mset a (X - K)) x) +\n    int (count (K - X + Y) x) =\n    int (count L x)", "unfolding L' M' N"], ["proof (prove)\ngoal (1 subgoal):\n 1. int (count (add_mset a M0) x) - int (count (add_mset a (X - K)) x) +\n    int (count (K - X + Y) x) =\n    int (count (M0 + K - X + Y) x)", "using **"], ["proof (prove)\nusing this:\n  count (X - K) x \\<le> count M0 x\n\ngoal (1 subgoal):\n 1. int (count (add_mset a M0) x) - int (count (add_mset a (X - K)) x) +\n    int (count (K - X + Y) x) =\n    int (count (M0 + K - X + Y) x)", "by (simp add: algebra_simps)"], ["proof (state)\nthis:\n  int (count N x) - int (count (add_mset a (X - K)) x) +\n  int (count (K - X + Y) x) =\n  int (count L x)\n\ngoal (1 subgoal):\n 1. \\<And>x. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "finally"], ["proof (chain)\npicking this:\n  int (count (N - add_mset a (X - K) + (K - X + Y)) x) = int (count L x)", "show \"?c L = ?c (N - ?X + ?Y)\""], ["proof (prove)\nusing this:\n  int (count (N - add_mset a (X - K) + (K - X + Y)) x) = int (count L x)\n\ngoal (1 subgoal):\n 1. count L x = count (N - add_mset a (X - K) + (K - X + Y)) x", "by simp"], ["proof (state)\nthis:\n  count L x = count (N - add_mset a (X - K) + (K - X + Y)) x\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  L = N - add_mset a (X - K) + (K - X + Y)\n\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "ultimately"], ["proof (chain)\npicking this:\n  add_mset a (X - K) \\<noteq> {#}\n  add_mset a (X - K) \\<subseteq># N\n  L = N - add_mset a (X - K) + (K - X + Y)", "show ?thesis"], ["proof (prove)\nusing this:\n  add_mset a (X - K) \\<noteq> {#}\n  add_mset a (X - K) \\<subseteq># N\n  L = N - add_mset a (X - K) + (K - X + Y)\n\ngoal (1 subgoal):\n 1. add_mset a (X - K) \\<noteq> {#} \\<and>\n    (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))", "by (metis diff_set_Ex_iff)"], ["proof (state)\nthis:\n  add_mset a (X - K) \\<noteq> {#} \\<and>\n  (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  add_mset a (X - K) \\<noteq> {#} \\<and>\n  (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "moreover"], ["proof (state)\nthis:\n  add_mset a (X - K) \\<noteq> {#} \\<and>\n  (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "have \"\\<forall>y. y \\<in># ?Y \\<longrightarrow> (\\<exists>x. x \\<in># ?X \\<and> P y x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>y.\n       y \\<in># K - X + Y \\<longrightarrow>\n       (\\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x)", "proof (intro allI impI)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y.\n       y \\<in># K - X + Y \\<Longrightarrow>\n       \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "fix y"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>y.\n       y \\<in># K - X + Y \\<Longrightarrow>\n       \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "assume \"y \\<in># ?Y\""], ["proof (state)\nthis:\n  y \\<in># K - X + Y\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       y \\<in># K - X + Y \\<Longrightarrow>\n       \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "then"], ["proof (chain)\npicking this:\n  y \\<in># K - X + Y", "have \"y \\<in># K - X \\<or> y \\<in># Y\""], ["proof (prove)\nusing this:\n  y \\<in># K - X + Y\n\ngoal (1 subgoal):\n 1. y \\<in># K - X \\<or> y \\<in># Y", "by auto"], ["proof (state)\nthis:\n  y \\<in># K - X \\<or> y \\<in># Y\n\ngoal (1 subgoal):\n 1. \\<And>y.\n       y \\<in># K - X + Y \\<Longrightarrow>\n       \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "then"], ["proof (chain)\npicking this:\n  y \\<in># K - X \\<or> y \\<in># Y", "show \"\\<exists>x. x \\<in># ?X \\<and> P y x\""], ["proof (prove)\nusing this:\n  y \\<in># K - X \\<or> y \\<in># Y\n\ngoal (1 subgoal):\n 1. \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. y \\<in># K - X \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n 2. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "assume \"y \\<in># K - X\""], ["proof (state)\nthis:\n  y \\<in># K - X\n\ngoal (2 subgoals):\n 1. y \\<in># K - X \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n 2. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "then"], ["proof (chain)\npicking this:\n  y \\<in># K - X", "have \"y \\<in># K\""], ["proof (prove)\nusing this:\n  y \\<in># K - X\n\ngoal (1 subgoal):\n 1. y \\<in># K", "by (rule in_diffD)"], ["proof (state)\nthis:\n  y \\<in># K\n\ngoal (2 subgoals):\n 1. y \\<in># K - X \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n 2. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "with K"], ["proof (chain)\npicking this:\n  \\<forall>y.\n     y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\n  y \\<in># K", "show ?thesis"], ["proof (prove)\nusing this:\n  \\<forall>y.\n     y \\<in># K \\<longrightarrow> (\\<exists>x. x \\<in># {#a#} \\<and> P y x)\n  y \\<in># K\n\ngoal (1 subgoal):\n 1. \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "by auto"], ["proof (state)\nthis:\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "assume \"y \\<in># Y\""], ["proof (state)\nthis:\n  y \\<in># Y\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "with Y"], ["proof (chain)\npicking this:\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\n  y \\<in># Y", "obtain x where \"x \\<in># X\" and \"P y x\""], ["proof (prove)\nusing this:\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\n  y \\<in># Y\n\ngoal (1 subgoal):\n 1. (\\<And>x.\n        \\<lbrakk>x \\<in># X; P y x\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  x \\<in># X\n  P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "{"], ["proof (state)\nthis:\n  x \\<in># X\n  P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "assume \"x \\<in># X - K\""], ["proof (state)\nthis:\n  x \\<in># X - K\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "with \\<open>P y x\\<close>"], ["proof (chain)\npicking this:\n  P y x\n  x \\<in># X - K", "have ?thesis"], ["proof (prove)\nusing this:\n  P y x\n  x \\<in># X - K\n\ngoal (1 subgoal):\n 1. \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "by auto"], ["proof (state)\nthis:\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "}"], ["proof (state)\nthis:\n  x \\<in># X - K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "moreover"], ["proof (state)\nthis:\n  x \\<in># X - K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "{"], ["proof (state)\nthis:\n  x \\<in># X - K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "assume \"x \\<in># K\""], ["proof (state)\nthis:\n  x \\<in># K\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "with *"], ["proof (chain)\npicking this:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  x \\<in># K", "have \"P x a\""], ["proof (prove)\nusing this:\n  \\<forall>b. b \\<in># K \\<longrightarrow> P b a\n  x \\<in># K\n\ngoal (1 subgoal):\n 1. P x a", "by auto"], ["proof (state)\nthis:\n  P x a\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "moreover"], ["proof (state)\nthis:\n  P x a\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "have \"y \\<in> A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. y \\<in> A", "using \\<open>Y \\<in> multisets A\\<close> and \\<open>y \\<in># Y\\<close>"], ["proof (prove)\nusing this:\n  Y \\<in> multisets A\n  y \\<in># Y\n\ngoal (1 subgoal):\n 1. y \\<in> A", "by (auto simp: multisets_def)"], ["proof (state)\nthis:\n  y \\<in> A\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "moreover"], ["proof (state)\nthis:\n  y \\<in> A\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "have \"a \\<in> A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. a \\<in> A", "using \\<open>N \\<in> multisets A\\<close>"], ["proof (prove)\nusing this:\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. a \\<in> A", "by (auto simp: N)"], ["proof (state)\nthis:\n  a \\<in> A\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "moreover"], ["proof (state)\nthis:\n  a \\<in> A\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "have \"x \\<in> A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. x \\<in> A", "using \\<open>M \\<in> multisets A\\<close> and \\<open>x \\<in># K\\<close>"], ["proof (prove)\nusing this:\n  M \\<in> multisets A\n  x \\<in># K\n\ngoal (1 subgoal):\n 1. x \\<in> A", "by (auto simp: M' multisets_def)"], ["proof (state)\nthis:\n  x \\<in> A\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "ultimately"], ["proof (chain)\npicking this:\n  P x a\n  y \\<in> A\n  a \\<in> A\n  x \\<in> A", "have \"P y a\""], ["proof (prove)\nusing this:\n  P x a\n  y \\<in> A\n  a \\<in> A\n  x \\<in> A\n\ngoal (1 subgoal):\n 1. P y a", "using \\<open>P y x\\<close> and trans"], ["proof (prove)\nusing this:\n  P x a\n  y \\<in> A\n  a \\<in> A\n  x \\<in> A\n  P y x\n  transp_on P A\n\ngoal (1 subgoal):\n 1. P y a", "unfolding transp_on_def"], ["proof (prove)\nusing this:\n  P x a\n  y \\<in> A\n  a \\<in> A\n  x \\<in> A\n  P y x\n  \\<forall>x\\<in>A.\n     \\<forall>y\\<in>A.\n        \\<forall>z\\<in>A. P x y \\<and> P y z \\<longrightarrow> P x z\n\ngoal (1 subgoal):\n 1. P y a", "by blast"], ["proof (state)\nthis:\n  P y a\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "then"], ["proof (chain)\npicking this:\n  P y a", "have ?thesis"], ["proof (prove)\nusing this:\n  P y a\n\ngoal (1 subgoal):\n 1. \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "by force"], ["proof (state)\nthis:\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "}"], ["proof (state)\nthis:\n  x \\<in># K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "moreover"], ["proof (state)\nthis:\n  x \\<in># K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "from \\<open>x \\<in># X\\<close>"], ["proof (chain)\npicking this:\n  x \\<in># X", "have \"x \\<in># X - K \\<or> x \\<in># K\""], ["proof (prove)\nusing this:\n  x \\<in># X\n\ngoal (1 subgoal):\n 1. x \\<in># X - K \\<or> x \\<in># K", "by (auto simp add: in_diff_count not_in_iff)"], ["proof (state)\nthis:\n  x \\<in># X - K \\<or> x \\<in># K\n\ngoal (1 subgoal):\n 1. y \\<in># Y \\<Longrightarrow>\n    \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "ultimately"], ["proof (chain)\npicking this:\n  x \\<in># X - K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n  x \\<in># K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n  x \\<in># X - K \\<or> x \\<in># K", "show ?thesis"], ["proof (prove)\nusing this:\n  x \\<in># X - K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n  x \\<in># K \\<Longrightarrow>\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n  x \\<in># X - K \\<or> x \\<in># K\n\ngoal (1 subgoal):\n 1. \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x", "by auto"], ["proof (state)\nthis:\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>y.\n     y \\<in># K - X + Y \\<longrightarrow>\n     (\\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x)\n\ngoal (1 subgoal):\n 1. \\<And>L M N.\n       \\<lbrakk>mulex_on P A L M;\n        L \\<in> multisets A \\<and>\n        M \\<in> multisets A \\<and>\n        (\\<exists>X Y Z.\n            X \\<noteq> {#} \\<and>\n            M = Z + X \\<and>\n            L = Z + Y \\<and>\n            (\\<forall>y.\n                y \\<in># Y \\<longrightarrow>\n                (\\<exists>x. x \\<in># X \\<and> P y x)));\n        N \\<in> multisets A; mulex1 P M N\\<rbrakk>\n       \\<Longrightarrow> L \\<in> multisets A \\<and>\n                         N \\<in> multisets A \\<and>\n                         (\\<exists>X Y Z.\n                             X \\<noteq> {#} \\<and>\n                             N = Z + X \\<and>\n                             L = Z + Y \\<and>\n                             (\\<forall>y.\n                                 y \\<in># Y \\<longrightarrow>\n                                 (\\<exists>x. x \\<in># X \\<and> P y x)))", "ultimately"], ["proof (chain)\npicking this:\n  L \\<in> multisets A\n  N \\<in> multisets A\n  add_mset a (X - K) \\<noteq> {#} \\<and>\n  (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))\n  \\<forall>y.\n     y \\<in># K - X + Y \\<longrightarrow>\n     (\\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x)", "show ?case"], ["proof (prove)\nusing this:\n  L \\<in> multisets A\n  N \\<in> multisets A\n  add_mset a (X - K) \\<noteq> {#} \\<and>\n  (\\<exists>Z. N = Z + add_mset a (X - K) \\<and> L = Z + (K - X + Y))\n  \\<forall>y.\n     y \\<in># K - X + Y \\<longrightarrow>\n     (\\<exists>x. x \\<in># add_mset a (X - K) \\<and> P y x)\n\ngoal (1 subgoal):\n 1. L \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        L = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x)))", "by blast"], ["proof (state)\nthis:\n  L \\<in> multisets A \\<and>\n  N \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      N = Z + X \\<and>\n      L = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  M \\<in> multisets A \\<and>\n  N \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      N = Z + X \\<and>\n      M = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "assume \"?Q M N\""], ["proof (state)\nthis:\n  M \\<in> multisets A \\<and>\n  N \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      N = Z + X \\<and>\n      M = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "then"], ["proof (chain)\npicking this:\n  M \\<in> multisets A \\<and>\n  N \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      N = Z + X \\<and>\n      M = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))", "obtain X Y Z where \"M \\<in> multisets A\" and \"N \\<in> multisets A\"\n    and \"X \\<noteq> {#}\" and N: \"N = Z + X\" and M: \"M = Z + Y\"\n    and *: \"\\<forall>y. y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\""], ["proof (prove)\nusing this:\n  M \\<in> multisets A \\<and>\n  N \\<in> multisets A \\<and>\n  (\\<exists>X Y Z.\n      X \\<noteq> {#} \\<and>\n      N = Z + X \\<and>\n      M = Z + Y \\<and>\n      (\\<forall>y.\n          y \\<in># Y \\<longrightarrow>\n          (\\<exists>x. x \\<in># X \\<and> P y x)))\n\ngoal (1 subgoal):\n 1. (\\<And>X Z Y.\n        \\<lbrakk>M \\<in> multisets A; N \\<in> multisets A; X \\<noteq> {#};\n         N = Z + X; M = Z + Y;\n         \\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  M \\<in> multisets A\n  N \\<in> multisets A\n  X \\<noteq> {#}\n  N = Z + X\n  M = Z + Y\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "with mulex_on_all_strict [of X A Y]"], ["proof (chain)\npicking this:\n  \\<lbrakk>X \\<noteq> {#}; X \\<in> multisets A; Y \\<in> multisets A;\n   \\<forall>y.\n      y \\<in># Y \\<longrightarrow>\n      (\\<exists>x. x \\<in># X \\<and> ?P y x)\\<rbrakk>\n  \\<Longrightarrow> mulex_on ?P A Y X\n  M \\<in> multisets A\n  N \\<in> multisets A\n  X \\<noteq> {#}\n  N = Z + X\n  M = Z + Y\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)", "have \"mulex_on P A Y X\""], ["proof (prove)\nusing this:\n  \\<lbrakk>X \\<noteq> {#}; X \\<in> multisets A; Y \\<in> multisets A;\n   \\<forall>y.\n      y \\<in># Y \\<longrightarrow>\n      (\\<exists>x. x \\<in># X \\<and> ?P y x)\\<rbrakk>\n  \\<Longrightarrow> mulex_on ?P A Y X\n  M \\<in> multisets A\n  N \\<in> multisets A\n  X \\<noteq> {#}\n  N = Z + X\n  M = Z + Y\n  \\<forall>y.\n     y \\<in># Y \\<longrightarrow> (\\<exists>x. x \\<in># X \\<and> P y x)\n\ngoal (1 subgoal):\n 1. mulex_on P A Y X", "by auto"], ["proof (state)\nthis:\n  mulex_on P A Y X\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "moreover"], ["proof (state)\nthis:\n  mulex_on P A Y X\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "from \\<open>N \\<in> multisets A\\<close>"], ["proof (chain)\npicking this:\n  N \\<in> multisets A", "have \"Z \\<in> multisets A\""], ["proof (prove)\nusing this:\n  N \\<in> multisets A\n\ngoal (1 subgoal):\n 1. Z \\<in> multisets A", "by (auto simp: N)"], ["proof (state)\nthis:\n  Z \\<in> multisets A\n\ngoal (1 subgoal):\n 1. M \\<in> multisets A \\<and>\n    N \\<in> multisets A \\<and>\n    (\\<exists>X Y Z.\n        X \\<noteq> {#} \\<and>\n        N = Z + X \\<and>\n        M = Z + Y \\<and>\n        (\\<forall>y.\n            y \\<in># Y \\<longrightarrow>\n            (\\<exists>x. x \\<in># X \\<and> P y x))) \\<Longrightarrow>\n    mulex_on P A M N", "ultimately"], ["proof (chain)\npicking this:\n  mulex_on P A Y X\n  Z \\<in> multisets A", "show \"?P M N\""], ["proof (prove)\nusing this:\n  mulex_on P A Y X\n  Z \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A M N", "unfolding M N"], ["proof (prove)\nusing this:\n  mulex_on P A Y X\n  Z \\<in> multisets A\n\ngoal (1 subgoal):\n 1. mulex_on P A (Z + Y) (Z + X)", "by (metis mulex_on_union)"], ["proof (state)\nthis:\n  mulex_on P A M N\n\ngoal:\nNo subgoals!", "qed"], ["", "end"]]}