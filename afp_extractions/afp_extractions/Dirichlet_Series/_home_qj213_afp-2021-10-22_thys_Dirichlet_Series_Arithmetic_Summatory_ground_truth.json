{"file_name": "/home/qj213/afp-2021-10-22/thys/Dirichlet_Series/Arithmetic_Summatory.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Dirichlet_Series", "problem_names": ["lemma sum_upto_altdef: \"sum_upto f x = (\\<Sum>i\\<in>{0<..nat \\<lfloor>x\\<rfloor>}. f i)\"", "lemma sum_upto_0 [simp]: \"sum_upto f 0 = 0\"", "lemma sum_upto_cong [cong]:\n  \"(\\<And>n. n > 0 \\<Longrightarrow> f n = f' n) \\<Longrightarrow> n = n' \\<Longrightarrow> sum_upto f n = sum_upto f' n'\"", "lemma finite_Nats_le_real [simp,intro]: \"finite {n. 0 < n \\<and> real n \\<le> x}\"", "lemma sum_upto_ind: \"sum_upto (ind P) x = of_nat (card {n. n > 0 \\<and> real n \\<le> x \\<and> P n})\"", "lemma sum_upto_sum_divisors:\n  \"sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x = sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / k)) x\"", "lemma sum_upto_dirichlet_prod:\n  \"sum_upto (dirichlet_prod f g) x = sum_upto (\\<lambda>d. f d * sum_upto g (x / real d)) x\"", "lemma sum_upto_real: \n  assumes \"x \\<ge> 0\"\n  shows   \"sum_upto real x = of_int (floor x) * (of_int (floor x) + 1) / 2\"", "lemma summable_imp_convergent_sum_upto:\n  assumes \"summable (f :: nat \\<Rightarrow> 'a :: real_normed_vector)\"\n  obtains c where \"(sum_upto f \\<longlongrightarrow> c) at_top\"", "lemma hyperbola_method_semiring:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_semiring_0\"\n  assumes \"A \\<ge> 0\" and \"B \\<ge> 0\" and \"A * B = x\"\n  shows   \"sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B\"", "lemma hyperbola_method_semiring_sqrt:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_semiring_0\"\n  assumes \"x \\<ge> 0\"\n  shows   \"sum_upto (dirichlet_prod f g) x + sum_upto f (sqrt x) * sum_upto g (sqrt x) = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x)\"", "lemma hyperbola_method:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_ring\"\n  assumes \"A \\<ge> 0\" \"B \\<ge> 0\" \"A * B = x\"\n  shows   \"sum_upto (dirichlet_prod f g) x = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B -\n             sum_upto f A * sum_upto g B\"", "lemma hyperbola_method_sqrt:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_ring\"\n  assumes \"x \\<ge> 0\"\n  shows   \"sum_upto (dirichlet_prod f g) x = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x) -\n             sum_upto f (sqrt x) * sum_upto g (sqrt x)\""], "translations": [["", "lemma sum_upto_altdef: \"sum_upto f x = (\\<Sum>i\\<in>{0<..nat \\<lfloor>x\\<rfloor>}. f i)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto f x = sum f {0<..nat \\<lfloor>x\\<rfloor>}", "unfolding sum_upto_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. sum f {i. 0 < i \\<and> real i \\<le> x} =\n    sum f {0<..nat \\<lfloor>x\\<rfloor>}", "by (cases \"x \\<ge> 0\"; intro sum.cong refl) (auto simp: le_nat_iff le_floor_iff)"], ["", "lemma sum_upto_0 [simp]: \"sum_upto f 0 = 0\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto f 0 = (0::'a)", "by (simp add: sum_upto_altdef)"], ["", "lemma sum_upto_cong [cong]:\n  \"(\\<And>n. n > 0 \\<Longrightarrow> f n = f' n) \\<Longrightarrow> n = n' \\<Longrightarrow> sum_upto f n = sum_upto f' n'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>n. 0 < n \\<Longrightarrow> f n = f' n; n = n'\\<rbrakk>\n    \\<Longrightarrow> sum_upto f n = sum_upto f' n'", "by (simp add: sum_upto_def)"], ["", "lemma finite_Nats_le_real [simp,intro]: \"finite {n. 0 < n \\<and> real n \\<le> x}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite {n. 0 < n \\<and> real n \\<le> x}", "proof (rule finite_subset)"], ["proof (state)\ngoal (2 subgoals):\n 1. {n. 0 < n \\<and> real n \\<le> x} \\<subseteq> ?B\n 2. finite ?B", "show \"finite {n. n \\<le> nat \\<lfloor>x\\<rfloor>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite {n. n \\<le> nat \\<lfloor>x\\<rfloor>}", "by auto"], ["proof (state)\nthis:\n  finite {n. n \\<le> nat \\<lfloor>x\\<rfloor>}\n\ngoal (1 subgoal):\n 1. {n. 0 < n \\<and> real n \\<le> x}\n    \\<subseteq> {n. n \\<le> nat \\<lfloor>x\\<rfloor>}", "show \"{n. 0 < n \\<and> real n \\<le> x} \\<subseteq> {n. n \\<le> nat \\<lfloor>x\\<rfloor>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {n. 0 < n \\<and> real n \\<le> x}\n    \\<subseteq> {n. n \\<le> nat \\<lfloor>x\\<rfloor>}", "by safe linarith"], ["proof (state)\nthis:\n  {n. 0 < n \\<and> real n \\<le> x}\n  \\<subseteq> {n. n \\<le> nat \\<lfloor>x\\<rfloor>}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sum_upto_ind: \"sum_upto (ind P) x = of_nat (card {n. n > 0 \\<and> real n \\<le> x \\<and> P n})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (ind P) x =\n    of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (ind P) x =\n    of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "have \"sum_upto (ind P :: nat \\<Rightarrow> 'a) x = (\\<Sum>n | 0 < n \\<and> real n \\<le> x \\<and> P n. 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (ind P) x =\n    (\\<Sum>n | 0 < n \\<and> real n \\<le> x \\<and> P n. (1::'a))", "unfolding sum_upto_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. sum (ind P) {i. 0 < i \\<and> real i \\<le> x} =\n    (\\<Sum>n | 0 < n \\<and> real n \\<le> x \\<and> P n. (1::'a))", "by (intro sum.mono_neutral_cong_right) (auto simp: ind_def)"], ["proof (state)\nthis:\n  sum_upto (ind P) x =\n  (\\<Sum>n | 0 < n \\<and> real n \\<le> x \\<and> P n. (1::'a))\n\ngoal (1 subgoal):\n 1. sum_upto (ind P) x =\n    of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "also"], ["proof (state)\nthis:\n  sum_upto (ind P) x =\n  (\\<Sum>n | 0 < n \\<and> real n \\<le> x \\<and> P n. (1::'a))\n\ngoal (1 subgoal):\n 1. sum_upto (ind P) x =\n    of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "have \"\\<dots> = of_nat (card {n. n > 0 \\<and> real n \\<le> x \\<and> P n})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>n | 0 < n \\<and> real n \\<le> x \\<and> P n. (1::'a)) =\n    of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>n | 0 < n \\<and> real n \\<le> x \\<and> P n. (1::'a)) =\n  of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})\n\ngoal (1 subgoal):\n 1. sum_upto (ind P) x =\n    of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "finally"], ["proof (chain)\npicking this:\n  sum_upto (ind P) x =\n  of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "show ?thesis"], ["proof (prove)\nusing this:\n  sum_upto (ind P) x =\n  of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})\n\ngoal (1 subgoal):\n 1. sum_upto (ind P) x =\n    of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})", "."], ["proof (state)\nthis:\n  sum_upto (ind P) x =\n  of_nat (card {n. 0 < n \\<and> real n \\<le> x \\<and> P n})\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sum_upto_sum_divisors:\n  \"sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x = sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / k)) x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "let ?B = \"(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. 0 < d \\<and> real d \\<le> x / real k})\""], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "let ?A = \"(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k})\""], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "have *: \"real a \\<le> x\" if \"real (a * b) \\<le> x\" \"b > 0\" for a b"], ["proof (prove)\ngoal (1 subgoal):\n 1. real a \\<le> x", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. real a \\<le> x", "have \"real a * 1 \\<le> real (a * b)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real a * 1 \\<le> real (a * b)", "unfolding of_nat_mult"], ["proof (prove)\ngoal (1 subgoal):\n 1. real a * 1 \\<le> real a * real b", "using that"], ["proof (prove)\nusing this:\n  real (a * b) \\<le> x\n  0 < b\n\ngoal (1 subgoal):\n 1. real a * 1 \\<le> real a * real b", "by (intro mult_left_mono) auto"], ["proof (state)\nthis:\n  real a * 1 \\<le> real (a * b)\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "also"], ["proof (state)\nthis:\n  real a * 1 \\<le> real (a * b)\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "have \"\\<dots> \\<le> x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real (a * b) \\<le> x", "by fact"], ["proof (state)\nthis:\n  real (a * b) \\<le> x\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "finally"], ["proof (chain)\npicking this:\n  real a * 1 \\<le> x", "show ?thesis"], ["proof (prove)\nusing this:\n  real a * 1 \\<le> x\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "by simp"], ["proof (state)\nthis:\n  real a \\<le> x\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<lbrakk>real (?a * ?b) \\<le> x; 0 < ?b\\<rbrakk>\n  \\<Longrightarrow> real ?a \\<le> x\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "have bij: \"bij_betw (\\<lambda>(k,d). (d * k, k)) ?B ?A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. bij_betw (\\<lambda>(k, d). (d * k, k))\n     (SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n         {d. 0 < d \\<and> real d \\<le> x / real k})\n     (SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k})", "by (rule bij_betwI[where g = \"\\<lambda>(k,d). (d, k div d)\"])\n       (auto simp: * divide_simps mult.commute elim!: dvdE)"], ["proof (state)\nthis:\n  bij_betw (\\<lambda>(k, d). (d * k, k))\n   (SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n       {d. 0 < d \\<and> real d \\<le> x / real k})\n   (SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k})\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "have \"sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x = (\\<Sum>(k,d)\\<in>?A. f k d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    (\\<Sum>(k, d)\n           \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k}).\n       f k d)", "unfolding sum_upto_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>n\\<in>{i. 0 < i \\<and> real i \\<le> x}. sum (f n) {d. d dvd n}) =\n    (\\<Sum>(k, d)\n           \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k}).\n       f k d)", "by (rule sum.Sigma) auto"], ["proof (state)\nthis:\n  sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n  (\\<Sum>(k, d)\n         \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k}).\n     f k d)\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "also"], ["proof (state)\nthis:\n  sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n  (\\<Sum>(k, d)\n         \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k}).\n     f k d)\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "have \"\\<dots> = (\\<Sum>(k,d)\\<in>?B. f (d * k) k)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, d)\n           \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k}).\n       f k d) =\n    (\\<Sum>(k, d)\n           \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n                    {d. 0 < d \\<and> real d \\<le> x / real k}).\n       f (d * k) k)", "by (subst sum.reindex_bij_betw[OF bij, symmetric]) (auto simp: case_prod_unfold)"], ["proof (state)\nthis:\n  (\\<Sum>(k, d)\n         \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k}).\n     f k d) =\n  (\\<Sum>(k, d)\n         \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n                  {d. 0 < d \\<and> real d \\<le> x / real k}).\n     f (d * k) k)\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, d)\n         \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}. {d. d dvd k}).\n     f k d) =\n  (\\<Sum>(k, d)\n         \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n                  {d. 0 < d \\<and> real d \\<le> x / real k}).\n     f (d * k) k)\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "have \"\\<dots> = sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / k)) x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, d)\n           \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n                    {d. 0 < d \\<and> real d \\<le> x / real k}).\n       f (d * k) k) =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "unfolding sum_upto_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, d)\n           \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n                    {d. 0 < d \\<and> real d \\<le> x / real k}).\n       f (d * k) k) =\n    (\\<Sum>k\\<in>{i. 0 < i \\<and> real i \\<le> x}.\n       \\<Sum>d\\<in>{i. 0 < i \\<and> real i \\<le> x / real k}. f (d * k) k)", "by (rule sum.Sigma [symmetric]) auto"], ["proof (state)\nthis:\n  (\\<Sum>(k, d)\n         \\<in>(SIGMA k:{k. 0 < k \\<and> real k \\<le> x}.\n                  {d. 0 < d \\<and> real d \\<le> x / real k}).\n     f (d * k) k) =\n  sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "finally"], ["proof (chain)\npicking this:\n  sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n  sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "show ?thesis"], ["proof (prove)\nusing this:\n  sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n  sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x\n\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n    sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x", "."], ["proof (state)\nthis:\n  sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f n d) x =\n  sum_upto (\\<lambda>k. sum_upto (\\<lambda>d. f (d * k) k) (x / real k)) x\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sum_upto_dirichlet_prod:\n  \"sum_upto (dirichlet_prod f g) x = sum_upto (\\<lambda>d. f d * sum_upto g (x / real d)) x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x =\n    sum_upto (\\<lambda>d. f d * sum_upto g (x / real d)) x", "unfolding dirichlet_prod_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (\\<lambda>n. \\<Sum>d | d dvd n. f d * g (n div d)) x =\n    sum_upto (\\<lambda>d. f d * sum_upto g (x / real d)) x", "by (subst sum_upto_sum_divisors) (simp add: sum_upto_def sum_distrib_left)"], ["", "lemma sum_upto_real: \n  assumes \"x \\<ge> 0\"\n  shows   \"sum_upto real x = of_int (floor x) * (of_int (floor x) + 1) / 2\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "have A: \"2 * \\<Sum>{1..n} = n * Suc n\" for n"], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 * \\<Sum> {1..n} = n * Suc n", "by (induction n) simp_all"], ["proof (state)\nthis:\n  2 * \\<Sum> {1..?n} = ?n * Suc ?n\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "have \"2 * sum_upto real x = real (2 * \\<Sum>{0<..nat \\<lfloor>x\\<rfloor>})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 2 * sum_upto real x = real (2 * \\<Sum> {0<..nat \\<lfloor>x\\<rfloor>})", "by (simp add: sum_upto_altdef)"], ["proof (state)\nthis:\n  2 * sum_upto real x = real (2 * \\<Sum> {0<..nat \\<lfloor>x\\<rfloor>})\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "also"], ["proof (state)\nthis:\n  2 * sum_upto real x = real (2 * \\<Sum> {0<..nat \\<lfloor>x\\<rfloor>})\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "have \"{0<..nat \\<lfloor>x\\<rfloor>} = {1..nat \\<lfloor>x\\<rfloor>}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {0<..nat \\<lfloor>x\\<rfloor>} = {1..nat \\<lfloor>x\\<rfloor>}", "by auto"], ["proof (state)\nthis:\n  {0<..nat \\<lfloor>x\\<rfloor>} = {1..nat \\<lfloor>x\\<rfloor>}\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "also"], ["proof (state)\nthis:\n  {0<..nat \\<lfloor>x\\<rfloor>} = {1..nat \\<lfloor>x\\<rfloor>}\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "note A"], ["proof (state)\nthis:\n  2 * \\<Sum> {1..?n} = ?n * Suc ?n\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "also"], ["proof (state)\nthis:\n  2 * \\<Sum> {1..?n} = ?n * Suc ?n\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "have \"real (nat \\<lfloor>x\\<rfloor> * Suc (nat \\<lfloor>x\\<rfloor>)) = of_int (floor x) * (of_int (floor x) + 1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real (nat \\<lfloor>x\\<rfloor> * Suc (nat \\<lfloor>x\\<rfloor>)) =\n    real_of_int \\<lfloor>x\\<rfloor> * (real_of_int \\<lfloor>x\\<rfloor> + 1)", "using assms"], ["proof (prove)\nusing this:\n  0 \\<le> x\n\ngoal (1 subgoal):\n 1. real (nat \\<lfloor>x\\<rfloor> * Suc (nat \\<lfloor>x\\<rfloor>)) =\n    real_of_int \\<lfloor>x\\<rfloor> * (real_of_int \\<lfloor>x\\<rfloor> + 1)", "by (simp add: algebra_simps)"], ["proof (state)\nthis:\n  real (nat \\<lfloor>x\\<rfloor> * Suc (nat \\<lfloor>x\\<rfloor>)) =\n  real_of_int \\<lfloor>x\\<rfloor> * (real_of_int \\<lfloor>x\\<rfloor> + 1)\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "finally"], ["proof (chain)\npicking this:\n  2 * sum_upto real x =\n  real_of_int \\<lfloor>x\\<rfloor> * (real_of_int \\<lfloor>x\\<rfloor> + 1)", "show ?thesis"], ["proof (prove)\nusing this:\n  2 * sum_upto real x =\n  real_of_int \\<lfloor>x\\<rfloor> * (real_of_int \\<lfloor>x\\<rfloor> + 1)\n\ngoal (1 subgoal):\n 1. sum_upto real x =\n    real_of_int \\<lfloor>x\\<rfloor> *\n    (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n    2", "by simp"], ["proof (state)\nthis:\n  sum_upto real x =\n  real_of_int \\<lfloor>x\\<rfloor> * (real_of_int \\<lfloor>x\\<rfloor> + 1) /\n  2\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma summable_imp_convergent_sum_upto:\n  assumes \"summable (f :: nat \\<Rightarrow> 'a :: real_normed_vector)\"\n  obtains c where \"(sum_upto f \\<longlongrightarrow> c) at_top\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "from assms"], ["proof (chain)\npicking this:\n  summable f", "have \"summable (\\<lambda>n. f (Suc n))\""], ["proof (prove)\nusing this:\n  summable f\n\ngoal (1 subgoal):\n 1. summable (\\<lambda>n. f (Suc n))", "by (subst summable_Suc_iff)"], ["proof (state)\nthis:\n  summable (\\<lambda>n. f (Suc n))\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "then"], ["proof (chain)\npicking this:\n  summable (\\<lambda>n. f (Suc n))", "obtain c where \"(\\<lambda>n. f (Suc n)) sums c\""], ["proof (prove)\nusing this:\n  summable (\\<lambda>n. f (Suc n))\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (\\<lambda>n. f (Suc n)) sums c \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "by (auto simp: summable_def)"], ["proof (state)\nthis:\n  (\\<lambda>n. f (Suc n)) sums c\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "hence \"(\\<lambda>n. \\<Sum>k<n. f (Suc k)) \\<longlonglongrightarrow> c\""], ["proof (prove)\nusing this:\n  (\\<lambda>n. f (Suc n)) sums c\n\ngoal (1 subgoal):\n 1. (\\<lambda>n. \\<Sum>k<n. f (Suc k)) \\<longlonglongrightarrow> c", "by (auto simp: sums_def)"], ["proof (state)\nthis:\n  (\\<lambda>n. \\<Sum>k<n. f (Suc k)) \\<longlonglongrightarrow> c\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "also"], ["proof (state)\nthis:\n  (\\<lambda>n. \\<Sum>k<n. f (Suc k)) \\<longlonglongrightarrow> c\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "have \"(\\<lambda>n. \\<Sum>k<n. f (Suc k)) = (\\<lambda>n. \\<Sum>k\\<in>{0<..n}. f k)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>n. \\<Sum>k<n. f (Suc k)) = (\\<lambda>n. sum f {0<..n})", "by (subst sum.atLeast1_atMost_eq [symmetric]) (auto simp: atLeastSucAtMost_greaterThanAtMost)"], ["proof (state)\nthis:\n  (\\<lambda>n. \\<Sum>k<n. f (Suc k)) = (\\<lambda>n. sum f {0<..n})\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "finally"], ["proof (chain)\npicking this:\n  (\\<lambda>n. sum f {0<..n}) \\<longlonglongrightarrow> c", "have \"((\\<lambda>x. sum f {0<..nat \\<lfloor>x\\<rfloor>}) \\<longlongrightarrow> c) at_top\""], ["proof (prove)\nusing this:\n  (\\<lambda>n. sum f {0<..n}) \\<longlonglongrightarrow> c\n\ngoal (1 subgoal):\n 1. ((\\<lambda>x. sum f {0<..nat \\<lfloor>x\\<rfloor>}) \\<longlongrightarrow>\n     c)\n     at_top", "by (rule filterlim_compose)\n       (auto intro!: filterlim_compose[OF filterlim_nat_sequentially] filterlim_floor_sequentially)"], ["proof (state)\nthis:\n  ((\\<lambda>x. sum f {0<..nat \\<lfloor>x\\<rfloor>}) \\<longlongrightarrow>\n   c)\n   at_top\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "also"], ["proof (state)\nthis:\n  ((\\<lambda>x. sum f {0<..nat \\<lfloor>x\\<rfloor>}) \\<longlongrightarrow>\n   c)\n   at_top\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "have \"(\\<lambda>x. sum f {0<..nat \\<lfloor>x\\<rfloor>}) = sum_upto f\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<lambda>x. sum f {0<..nat \\<lfloor>x\\<rfloor>}) = sum_upto f", "by (intro ext) (simp_all add: sum_upto_altdef)"], ["proof (state)\nthis:\n  (\\<lambda>x. sum f {0<..nat \\<lfloor>x\\<rfloor>}) = sum_upto f\n\ngoal (1 subgoal):\n 1. (\\<And>c.\n        (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow>\n        thesis) \\<Longrightarrow>\n    thesis", "finally"], ["proof (chain)\npicking this:\n  (sum_upto f \\<longlongrightarrow> c) at_top", "show ?thesis"], ["proof (prove)\nusing this:\n  (sum_upto f \\<longlongrightarrow> c) at_top\n\ngoal (1 subgoal):\n 1. thesis", "using that[of c]"], ["proof (prove)\nusing this:\n  (sum_upto f \\<longlongrightarrow> c) at_top\n  (sum_upto f \\<longlongrightarrow> c) at_top \\<Longrightarrow> thesis\n\ngoal (1 subgoal):\n 1. thesis", "by blast"], ["proof (state)\nthis:\n  thesis\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \\<open>The Hyperbola method\\<close>"], ["", "lemma hyperbola_method_semiring:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_semiring_0\"\n  assumes \"A \\<ge> 0\" and \"B \\<ge> 0\" and \"A * B = x\"\n  shows   \"sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "from assms"], ["proof (chain)\npicking this:\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x", "have [simp]: \"x \\<ge> 0\""], ["proof (prove)\nusing this:\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x\n\ngoal (1 subgoal):\n 1. 0 \\<le> x", "by auto"], ["proof (state)\nthis:\n  0 \\<le> x\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "{"], ["proof (state)\nthis:\n  0 \\<le> x\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "fix a b :: real"], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "assume ab: \"a > 0\" \"b > 0\" \"x \\<ge> 0\" \"a * b \\<le> x\" \"a > A\" \"b > B\""], ["proof (state)\nthis:\n  0 < a\n  0 < b\n  0 \\<le> x\n  a * b \\<le> x\n  A < a\n  B < b\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "hence \"a * b > A * B\""], ["proof (prove)\nusing this:\n  0 < a\n  0 < b\n  0 \\<le> x\n  a * b \\<le> x\n  A < a\n  B < b\n\ngoal (1 subgoal):\n 1. A * B < a * b", "using assms"], ["proof (prove)\nusing this:\n  0 < a\n  0 < b\n  0 \\<le> x\n  a * b \\<le> x\n  A < a\n  B < b\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x\n\ngoal (1 subgoal):\n 1. A * B < a * b", "by (intro mult_strict_mono) auto"], ["proof (state)\nthis:\n  A * B < a * b\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  A * B < a * b\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "from assms"], ["proof (chain)\npicking this:\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x", "have \"A * B = x\""], ["proof (prove)\nusing this:\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x\n\ngoal (1 subgoal):\n 1. A * B = x", "by simp"], ["proof (state)\nthis:\n  A * B = x\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "finally"], ["proof (chain)\npicking this:\n  x < a * b", "have False"], ["proof (prove)\nusing this:\n  x < a * b\n\ngoal (1 subgoal):\n 1. False", "using \\<open>a * b \\<le> x\\<close>"], ["proof (prove)\nusing this:\n  x < a * b\n  a * b \\<le> x\n\ngoal (1 subgoal):\n 1. False", "by simp"], ["proof (state)\nthis:\n  False\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "}"], ["proof (state)\nthis:\n  \\<lbrakk>0 < ?a2; 0 < ?b2; 0 \\<le> x; ?a2 * ?b2 \\<le> x; A < ?a2;\n   B < ?b2\\<rbrakk>\n  \\<Longrightarrow> False\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "note * = this"], ["proof (state)\nthis:\n  \\<lbrakk>0 < ?a2; 0 < ?b2; 0 \\<le> x; ?a2 * ?b2 \\<le> x; A < ?a2;\n   B < ?b2\\<rbrakk>\n  \\<Longrightarrow> False\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have *: \"a \\<le> A \\<or> b \\<le> B\" if \"a * b \\<le> x\" \"a > 0\" \"b > 0\" \"x \\<ge> 0\" for a b"], ["proof (prove)\ngoal (1 subgoal):\n 1. a \\<le> A \\<or> b \\<le> B", "by (rule ccontr) (insert *[of a b] that, auto)"], ["proof (state)\nthis:\n  \\<lbrakk>?a * ?b \\<le> x; 0 < ?a; 0 < ?b; 0 \\<le> x\\<rbrakk>\n  \\<Longrightarrow> ?a \\<le> A \\<or> ?b \\<le> B\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have nat_mult_leD1: \"real a \\<le> x\" if \"real a * real b \\<le> x\" \"b > 0\" for a b"], ["proof (prove)\ngoal (1 subgoal):\n 1. real a \\<le> x", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. real a \\<le> x", "from that"], ["proof (chain)\npicking this:\n  real a * real b \\<le> x\n  0 < b", "have \"real a * 1 \\<le> real a * real b\""], ["proof (prove)\nusing this:\n  real a * real b \\<le> x\n  0 < b\n\ngoal (1 subgoal):\n 1. real a * 1 \\<le> real a * real b", "by (intro mult_left_mono) simp_all"], ["proof (state)\nthis:\n  real a * 1 \\<le> real a * real b\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "also"], ["proof (state)\nthis:\n  real a * 1 \\<le> real a * real b\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "have \"\\<dots> \\<le> x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. real a * real b \\<le> x", "by fact"], ["proof (state)\nthis:\n  real a * real b \\<le> x\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "finally"], ["proof (chain)\npicking this:\n  real a * 1 \\<le> x", "show ?thesis"], ["proof (prove)\nusing this:\n  real a * 1 \\<le> x\n\ngoal (1 subgoal):\n 1. real a \\<le> x", "by simp"], ["proof (state)\nthis:\n  real a \\<le> x\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<lbrakk>real ?a * real ?b \\<le> x; 0 < ?b\\<rbrakk>\n  \\<Longrightarrow> real ?a \\<le> x\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have nat_mult_leD2: \"real b \\<le> x\" if \"real a * real b \\<le> x\" \"a > 0\" for a b"], ["proof (prove)\ngoal (1 subgoal):\n 1. real b \\<le> x", "using nat_mult_leD1[of b a] that"], ["proof (prove)\nusing this:\n  \\<lbrakk>real b * real a \\<le> x; 0 < a\\<rbrakk>\n  \\<Longrightarrow> real b \\<le> x\n  real a * real b \\<le> x\n  0 < a\n\ngoal (1 subgoal):\n 1. real b \\<le> x", "by (simp add: mult_ac)"], ["proof (state)\nthis:\n  \\<lbrakk>real ?a * real ?b \\<le> x; 0 < ?a\\<rbrakk>\n  \\<Longrightarrow> real ?b \\<le> x\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have le_sqrt_mult_imp_le: \"a * b \\<le> x\" \n    if \"a \\<ge> 0\" \"b \\<ge> 0\" \"a \\<le> A\" \"b \\<le> B\" for a b :: real"], ["proof (prove)\ngoal (1 subgoal):\n 1. a * b \\<le> x", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. a * b \\<le> x", "from that and assms"], ["proof (chain)\npicking this:\n  0 \\<le> a\n  0 \\<le> b\n  a \\<le> A\n  b \\<le> B\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x", "have \"a * b \\<le> A * B\""], ["proof (prove)\nusing this:\n  0 \\<le> a\n  0 \\<le> b\n  a \\<le> A\n  b \\<le> B\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x\n\ngoal (1 subgoal):\n 1. a * b \\<le> A * B", "by (intro mult_mono) auto"], ["proof (state)\nthis:\n  a * b \\<le> A * B\n\ngoal (1 subgoal):\n 1. a * b \\<le> x", "with assms"], ["proof (chain)\npicking this:\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x\n  a * b \\<le> A * B", "show \"a * b \\<le> x\""], ["proof (prove)\nusing this:\n  0 \\<le> A\n  0 \\<le> B\n  A * B = x\n  a * b \\<le> A * B\n\ngoal (1 subgoal):\n 1. a * b \\<le> x", "by simp"], ["proof (state)\nthis:\n  a * b \\<le> x\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<lbrakk>0 \\<le> ?a; 0 \\<le> ?b; ?a \\<le> A; ?b \\<le> B\\<rbrakk>\n  \\<Longrightarrow> ?a * ?b \\<le> x\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "define F G where \"F = sum_upto f\" and \"G = sum_upto g\""], ["proof (state)\nthis:\n  F = sum_upto f\n  G = sum_upto g\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "let ?Bound = \"{0<..nat \\<lfloor>x\\<rfloor>} \\<times> {0<..nat \\<lfloor>x\\<rfloor>}\""], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "let ?B = \"{(r,d). 0 < r \\<and> real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r}\""], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "let ?C = \"{(r,d). 0 < d \\<and> real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}\""], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "let ?B' = \"SIGMA r:{r. 0 < r \\<and> real r \\<le> A}. {d. 0 < d \\<and> real d \\<le> x / real r}\""], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "let ?C' = \"SIGMA d:{d. 0 < d \\<and> real d \\<le> B}. {r. 0 < r \\<and> real r \\<le> x / real d}\""], ["proof (state)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"sum_upto (dirichlet_prod f g) x + F A * G B = \n          (\\<Sum>(i,(r,d)) \\<in> (SIGMA i:{i. 0 < i \\<and> real i \\<le> x}. {(r,d). r * d = i}). f r * g d) + \n          sum_upto f A * sum_upto g B\" (is \"_ = ?S + _\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + F A * G B =\n    (\\<Sum>(i, r, d)\n           \\<in>(SIGMA i:{i. 0 < i \\<and> real i \\<le> x}.\n                    {(r, d). r * d = i}).\n       f r * g d) +\n    sum_upto f A * sum_upto g B", "unfolding sum_upto_def dirichlet_prod_altdef2 F_def G_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>n\\<in>{i. 0 < i \\<and> real i \\<le> x}.\n       \\<Sum>(r, d)\\<in>{(r, d). r * d = n}. f r * g d) +\n    sum f {i. 0 < i \\<and> real i \\<le> A} *\n    sum g {i. 0 < i \\<and> real i \\<le> B} =\n    (\\<Sum>(i, r, d)\n           \\<in>(SIGMA i:{i. 0 < i \\<and> real i \\<le> x}.\n                    {(r, d). r * d = i}).\n       f r * g d) +\n    sum f {i. 0 < i \\<and> real i \\<le> A} *\n    sum g {i. 0 < i \\<and> real i \\<le> B}", "by (subst sum.Sigma) (auto intro: finite_divisors_nat')"], ["proof (state)\nthis:\n  sum_upto (dirichlet_prod f g) x + F A * G B =\n  (\\<Sum>(i, r, d)\n         \\<in>(SIGMA i:{i. 0 < i \\<and> real i \\<le> x}.\n                  {(r, d). r * d = i}).\n     f r * g d) +\n  sum_upto f A * sum_upto g B\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  sum_upto (dirichlet_prod f g) x + F A * G B =\n  (\\<Sum>(i, r, d)\n         \\<in>(SIGMA i:{i. 0 < i \\<and> real i \\<le> x}.\n                  {(r, d). r * d = i}).\n     f r * g d) +\n  sum_upto f A * sum_upto g B\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"?S = (\\<Sum>(r,d) | 0 < r \\<and> 0 < d \\<and> real (r * d) \\<le> x. f r * g d)\"\n    (is \"_ = sum _ ?A\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(i, r, d)\n           \\<in>(SIGMA i:{i. 0 < i \\<and> real i \\<le> x}.\n                    {(r, d). r * d = i}).\n       f r * g d) =\n    (\\<Sum>(r, d)\n           \\<in>{(r, d). 0 < r \\<and> 0 < d \\<and> real (r * d) \\<le> x}.\n       f r * g d)", "by (intro sum.reindex_bij_witness[of _ \"\\<lambda>(r,d). (r*d,(r,d))\" snd]) auto"], ["proof (state)\nthis:\n  (\\<Sum>(i, r, d)\n         \\<in>(SIGMA i:{i. 0 < i \\<and> real i \\<le> x}.\n                  {(r, d). r * d = i}).\n     f r * g d) =\n  (\\<Sum>(r, d)\n         \\<in>{(r, d). 0 < r \\<and> 0 < d \\<and> real (r * d) \\<le> x}.\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  (\\<Sum>(i, r, d)\n         \\<in>(SIGMA i:{i. 0 < i \\<and> real i \\<le> x}.\n                  {(r, d). r * d = i}).\n     f r * g d) =\n  (\\<Sum>(r, d)\n         \\<in>{(r, d). 0 < r \\<and> 0 < d \\<and> real (r * d) \\<le> x}.\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"?A = ?B \\<union> ?C\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {(r, d). 0 < r \\<and> 0 < d \\<and> real (r * d) \\<le> x} =\n    {(r, d).\n     0 < r \\<and>\n     real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} \\<union>\n    {(r, d).\n     0 < d \\<and>\n     real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}", "by (auto simp: field_simps dest: *)"], ["proof (state)\nthis:\n  {(r, d). 0 < r \\<and> 0 < d \\<and> real (r * d) \\<le> x} =\n  {(r, d).\n   0 < r \\<and>\n   real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} \\<union>\n  {(r, d).\n   0 < d \\<and> real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  {(r, d). 0 < r \\<and> 0 < d \\<and> real (r * d) \\<le> x} =\n  {(r, d).\n   0 < r \\<and>\n   real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} \\<union>\n  {(r, d).\n   0 < d \\<and> real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"sum_upto f A * sum_upto g B = \n               (\\<Sum>r | 0 < r \\<and> real r \\<le> A. \\<Sum>d | 0 < d \\<and> real d \\<le> B. f r * g d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto f A * sum_upto g B =\n    (\\<Sum>r | 0 < r \\<and> real r \\<le> A.\n       \\<Sum>d | 0 < d \\<and> real d \\<le> B. f r * g d)", "by (simp add: sum_upto_def sum_product)"], ["proof (state)\nthis:\n  sum_upto f A * sum_upto g B =\n  (\\<Sum>r | 0 < r \\<and> real r \\<le> A.\n     \\<Sum>d | 0 < d \\<and> real d \\<le> B. f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  sum_upto f A * sum_upto g B =\n  (\\<Sum>r | 0 < r \\<and> real r \\<le> A.\n     \\<Sum>d | 0 < d \\<and> real d \\<le> B. f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"\\<dots> = (\\<Sum>(r,d)\\<in>{r. 0 < r \\<and> real r \\<le> A} \\<times> {d. 0 < d \\<and> real d \\<le> B}. f r * g d)\"\n    (is \"_ = sum _ ?X\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>r | 0 < r \\<and> real r \\<le> A.\n       \\<Sum>d | 0 < d \\<and> real d \\<le> B. f r * g d) =\n    (\\<Sum>(r, d)\n           \\<in>{r. 0 < r \\<and> real r \\<le> A} \\<times>\n                {d. 0 < d \\<and> real d \\<le> B}.\n       f r * g d)", "by (rule sum.cartesian_product)"], ["proof (state)\nthis:\n  (\\<Sum>r | 0 < r \\<and> real r \\<le> A.\n     \\<Sum>d | 0 < d \\<and> real d \\<le> B. f r * g d) =\n  (\\<Sum>(r, d)\n         \\<in>{r. 0 < r \\<and> real r \\<le> A} \\<times>\n              {d. 0 < d \\<and> real d \\<le> B}.\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  (\\<Sum>r | 0 < r \\<and> real r \\<le> A.\n     \\<Sum>d | 0 < d \\<and> real d \\<le> B. f r * g d) =\n  (\\<Sum>(r, d)\n         \\<in>{r. 0 < r \\<and> real r \\<le> A} \\<times>\n              {d. 0 < d \\<and> real d \\<le> B}.\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"?X = ?B \\<inter> ?C\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {r. 0 < r \\<and> real r \\<le> A} \\<times>\n    {d. 0 < d \\<and> real d \\<le> B} =\n    {(r, d).\n     0 < r \\<and>\n     real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} \\<inter>\n    {(r, d).\n     0 < d \\<and>\n     real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}", "by (auto simp: field_simps le_sqrt_mult_imp_le)"], ["proof (state)\nthis:\n  {r. 0 < r \\<and> real r \\<le> A} \\<times>\n  {d. 0 < d \\<and> real d \\<le> B} =\n  {(r, d).\n   0 < r \\<and>\n   real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} \\<inter>\n  {(r, d).\n   0 < d \\<and> real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  {r. 0 < r \\<and> real r \\<le> A} \\<times>\n  {d. 0 < d \\<and> real d \\<le> B} =\n  {(r, d).\n   0 < r \\<and>\n   real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} \\<inter>\n  {(r, d).\n   0 < d \\<and> real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"(\\<Sum>(r,d)\\<in>?B \\<union> ?C. f r * g d) + (\\<Sum>(r,d)\\<in>?B \\<inter> ?C. f r * g d) = \n               (\\<Sum>(r,d)\\<in>?B. f r * g d) + (\\<Sum>(r,d)\\<in>?C. f r * g d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(r, d)\n           \\<in>{(r, d).\n                 0 < r \\<and>\n                 real r \\<le> A \\<and>\n                 0 < d \\<and> real d \\<le> x / real r} \\<union>\n                {(r, d).\n                 0 < d \\<and>\n                 real d \\<le> B \\<and>\n                 0 < r \\<and> real r \\<le> x / real d}.\n       f r * g d) +\n    (\\<Sum>(r, d)\n           \\<in>{(r, d).\n                 0 < r \\<and>\n                 real r \\<le> A \\<and>\n                 0 < d \\<and> real d \\<le> x / real r} \\<inter>\n                {(r, d).\n                 0 < d \\<and>\n                 real d \\<le> B \\<and>\n                 0 < r \\<and> real r \\<le> x / real d}.\n       f r * g d) =\n    (\\<Sum>(r, d)\n           \\<in>{(r, d).\n                 0 < r \\<and>\n                 real r \\<le> A \\<and>\n                 0 < d \\<and> real d \\<le> x / real r}.\n       f r * g d) +\n    (\\<Sum>(r, d)\n           \\<in>{(r, d).\n                 0 < d \\<and>\n                 real d \\<le> B \\<and>\n                 0 < r \\<and> real r \\<le> x / real d}.\n       f r * g d)", "by (intro sum.union_inter finite_subset[of ?B ?Bound] finite_subset[of ?C ?Bound])\n       (auto simp: field_simps le_nat_iff le_floor_iff dest: nat_mult_leD1 nat_mult_leD2)"], ["proof (state)\nthis:\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < r \\<and>\n               real r \\<le> A \\<and>\n               0 < d \\<and> real d \\<le> x / real r} \\<union>\n              {(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d) +\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < r \\<and>\n               real r \\<le> A \\<and>\n               0 < d \\<and> real d \\<le> x / real r} \\<inter>\n              {(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d) =\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < r \\<and>\n               real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r}.\n     f r * g d) +\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < r \\<and>\n               real r \\<le> A \\<and>\n               0 < d \\<and> real d \\<le> x / real r} \\<union>\n              {(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d) +\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < r \\<and>\n               real r \\<le> A \\<and>\n               0 < d \\<and> real d \\<le> x / real r} \\<inter>\n              {(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d) =\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < r \\<and>\n               real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r}.\n     f r * g d) +\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"?B = ?B'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {(r, d).\n     0 < r \\<and>\n     real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} =\n    (SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n        {d. 0 < d \\<and> real d \\<le> x / real r})", "by auto"], ["proof (state)\nthis:\n  {(r, d).\n   0 < r \\<and>\n   real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} =\n  (SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n      {d. 0 < d \\<and> real d \\<le> x / real r})\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "hence \"(\\<lambda>f. sum f ?B) = (\\<lambda>f. sum f ?B')\""], ["proof (prove)\nusing this:\n  {(r, d).\n   0 < r \\<and>\n   real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r} =\n  (SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n      {d. 0 < d \\<and> real d \\<le> x / real r})\n\ngoal (1 subgoal):\n 1. (\\<lambda>f.\n        sum f\n         {(r, d).\n          0 < r \\<and>\n          real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r}) =\n    (\\<lambda>f.\n        sum f\n         (SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n             {d. 0 < d \\<and> real d \\<le> x / real r}))", "by simp"], ["proof (state)\nthis:\n  (\\<lambda>f.\n      sum f\n       {(r, d).\n        0 < r \\<and>\n        real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r}) =\n  (\\<lambda>f.\n      sum f\n       (SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n           {d. 0 < d \\<and> real d \\<le> x / real r}))\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  (\\<lambda>f.\n      sum f\n       {(r, d).\n        0 < r \\<and>\n        real r \\<le> A \\<and> 0 < d \\<and> real d \\<le> x / real r}) =\n  (\\<lambda>f.\n      sum f\n       (SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n           {d. 0 < d \\<and> real d \\<le> x / real r}))\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"(\\<Sum>(r,d)\\<in>?B'. f r * g d) = sum_upto (\\<lambda>n. f n * G (x / real n)) A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(r, d)\n           \\<in>(SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n                    {d. 0 < d \\<and> real d \\<le> x / real r}).\n       f r * g d) =\n    sum_upto (\\<lambda>n. f n * G (x / real n)) A", "by (subst sum.Sigma [symmetric]) (simp_all add: sum_upto_def sum_distrib_left G_def)"], ["proof (state)\nthis:\n  (\\<Sum>(r, d)\n         \\<in>(SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n                  {d. 0 < d \\<and> real d \\<le> x / real r}).\n     f r * g d) =\n  sum_upto (\\<lambda>n. f n * G (x / real n)) A\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  (\\<Sum>(r, d)\n         \\<in>(SIGMA r:{r. 0 < r \\<and> real r \\<le> A}.\n                  {d. 0 < d \\<and> real d \\<le> x / real r}).\n     f r * g d) =\n  sum_upto (\\<lambda>n. f n * G (x / real n)) A\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"(\\<Sum>(r,d)\\<in>?C. f r * g d) = (\\<Sum>(d,r)\\<in>?C'. f r * g d)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(r, d)\n           \\<in>{(r, d).\n                 0 < d \\<and>\n                 real d \\<le> B \\<and>\n                 0 < r \\<and> real r \\<le> x / real d}.\n       f r * g d) =\n    (\\<Sum>(d, r)\n           \\<in>(SIGMA d:{d. 0 < d \\<and> real d \\<le> B}.\n                    {r. 0 < r \\<and> real r \\<le> x / real d}).\n       f r * g d)", "by (intro sum.reindex_bij_witness[of _ \"\\<lambda>(x,y). (y,x)\" \"\\<lambda>(x,y). (y,x)\"]) auto"], ["proof (state)\nthis:\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d) =\n  (\\<Sum>(d, r)\n         \\<in>(SIGMA d:{d. 0 < d \\<and> real d \\<le> B}.\n                  {r. 0 < r \\<and> real r \\<le> x / real d}).\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "also"], ["proof (state)\nthis:\n  (\\<Sum>(r, d)\n         \\<in>{(r, d).\n               0 < d \\<and>\n               real d \\<le> B \\<and> 0 < r \\<and> real r \\<le> x / real d}.\n     f r * g d) =\n  (\\<Sum>(d, r)\n         \\<in>(SIGMA d:{d. 0 < d \\<and> real d \\<le> B}.\n                  {r. 0 < r \\<and> real r \\<le> x / real d}).\n     f r * g d)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "have \"\\<dots> = sum_upto (\\<lambda>n. F (x / real n) * g n) B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(d, r)\n           \\<in>(SIGMA d:{d. 0 < d \\<and> real d \\<le> B}.\n                    {r. 0 < r \\<and> real r \\<le> x / real d}).\n       f r * g d) =\n    sum_upto (\\<lambda>n. F (x / real n) * g n) B", "by (subst sum.Sigma [symmetric]) (simp_all add: sum_upto_def sum_distrib_right F_def)"], ["proof (state)\nthis:\n  (\\<Sum>(d, r)\n         \\<in>(SIGMA d:{d. 0 < d \\<and> real d \\<le> B}.\n                  {r. 0 < r \\<and> real r \\<le> x / real d}).\n     f r * g d) =\n  sum_upto (\\<lambda>n. F (x / real n) * g n) B\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "finally"], ["proof (chain)\npicking this:\n  sum_upto (dirichlet_prod f g) x + F A * G B =\n  sum_upto (\\<lambda>n. f n * G (x / real n)) A +\n  sum_upto (\\<lambda>n. F (x / real n) * g n) B", "show ?thesis"], ["proof (prove)\nusing this:\n  sum_upto (dirichlet_prod f g) x + F A * G B =\n  sum_upto (\\<lambda>n. f n * G (x / real n)) A +\n  sum_upto (\\<lambda>n. F (x / real n) * g n) B\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B", "by (simp only: F_def G_def)"], ["proof (state)\nthis:\n  sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n  sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n  sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma hyperbola_method_semiring_sqrt:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_semiring_0\"\n  assumes \"x \\<ge> 0\"\n  shows   \"sum_upto (dirichlet_prod f g) x + sum_upto f (sqrt x) * sum_upto g (sqrt x) = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x +\n    sum_upto f (sqrt x) * sum_upto g (sqrt x) =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x)", "using assms hyperbola_method_semiring[of \"sqrt x\" \"sqrt x\" x]"], ["proof (prove)\nusing this:\n  0 \\<le> x\n  \\<lbrakk>0 \\<le> sqrt x; 0 \\<le> sqrt x; sqrt x * sqrt x = x\\<rbrakk>\n  \\<Longrightarrow> sum_upto (dirichlet_prod ?f ?g) x +\n                    sum_upto ?f (sqrt x) * sum_upto ?g (sqrt x) =\n                    sum_upto (\\<lambda>n. ?f n * sum_upto ?g (x / real n))\n                     (sqrt x) +\n                    sum_upto (\\<lambda>n. sum_upto ?f (x / real n) * ?g n)\n                     (sqrt x)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x +\n    sum_upto f (sqrt x) * sum_upto g (sqrt x) =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x)", "by simp"], ["", "lemma hyperbola_method:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_ring\"\n  assumes \"A \\<ge> 0\" \"B \\<ge> 0\" \"A * B = x\"\n  shows   \"sum_upto (dirichlet_prod f g) x = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B -\n             sum_upto f A * sum_upto g B\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B -\n    sum_upto f A * sum_upto g B", "using hyperbola_method_semiring[OF assms, of f g]"], ["proof (prove)\nusing this:\n  sum_upto (dirichlet_prod f g) x + sum_upto f A * sum_upto g B =\n  sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n  sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) A +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) B -\n    sum_upto f A * sum_upto g B", "by (simp add: algebra_simps)"], ["", "lemma hyperbola_method_sqrt:\n  fixes f g :: \"nat \\<Rightarrow> 'a :: comm_ring\"\n  assumes \"x \\<ge> 0\"\n  shows   \"sum_upto (dirichlet_prod f g) x = \n             sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n             sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x) -\n             sum_upto f (sqrt x) * sum_upto g (sqrt x)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x) -\n    sum_upto f (sqrt x) * sum_upto g (sqrt x)", "using assms hyperbola_method[of \"sqrt x\" \"sqrt x\" x]"], ["proof (prove)\nusing this:\n  0 \\<le> x\n  \\<lbrakk>0 \\<le> sqrt x; 0 \\<le> sqrt x; sqrt x * sqrt x = x\\<rbrakk>\n  \\<Longrightarrow> sum_upto (dirichlet_prod ?f ?g) x =\n                    sum_upto (\\<lambda>n. ?f n * sum_upto ?g (x / real n))\n                     (sqrt x) +\n                    sum_upto (\\<lambda>n. sum_upto ?f (x / real n) * ?g n)\n                     (sqrt x) -\n                    sum_upto ?f (sqrt x) * sum_upto ?g (sqrt x)\n\ngoal (1 subgoal):\n 1. sum_upto (dirichlet_prod f g) x =\n    sum_upto (\\<lambda>n. f n * sum_upto g (x / real n)) (sqrt x) +\n    sum_upto (\\<lambda>n. sum_upto f (x / real n) * g n) (sqrt x) -\n    sum_upto f (sqrt x) * sum_upto g (sqrt x)", "by simp"], ["", "end"]]}