{"file_name": "/home/qj213/afp-2021-10-22/thys/Hoare_Time/SepLog_Hoare.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Hoare_Time", "problem_names": ["lemma alternative: \"\\<Turnstile>\\<^sub>3 { P } c { Q }  \\<longleftrightarrow>  \n     (\\<forall>ps n. P (ps,n)\n     \\<longrightarrow> (\\<exists>ps' t n'. ((c,ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps')\n             \\<and> n=n'+t \\<and> Q (ps', n'))  )\"", "lemma Frame_R:  assumes \"\\<turnstile>\\<^sub>3 { P } C { Q  }\" \"Frame P' P F\"\n             shows \"\\<turnstile>\\<^sub>3 { P' } C { Q ** F } \"", "lemma strengthen_post: assumes \"\\<turnstile>\\<^sub>3 {P}c{Q}\" \"\\<And>s. Q s \\<Longrightarrow> Q' s\"\n  shows \"\\<turnstile>\\<^sub>3 {P}c{ Q'}\"", "lemma weakenpre:  \"\\<lbrakk> \\<turnstile>\\<^sub>3 {P}c{Q} ; \\<And>s. P' s \\<Longrightarrow> P s  \\<rbrakk> \\<Longrightarrow>\n           \\<turnstile>\\<^sub>3 {P'}c{ Q}\"", "lemma exec_preserves_disj: \"(c,ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<Longrightarrow> ps'' ## ps \\<Longrightarrow> ps'' ## ps'\"", "lemma FrameRuleSound: assumes \"\\<Turnstile>\\<^sub>3 { P  } C { Q  }\"\n  shows \"\\<Turnstile>\\<^sub>3 { P ** F } C { Q ** F }\"", "theorem hoare3_sound: assumes \"\\<turnstile>\\<^sub>3 { P }c{ Q  }\"\n  shows \"\\<Turnstile>\\<^sub>3 { P } c { Q }\"", "lemma wp3_SKIP[simp]: \"wp\\<^sub>3 SKIP Q = (Q ** $1)\"", "lemma wp3_Assign[simp]: \"wp\\<^sub>3 (x ::= e) Q = ((\\<lambda>(ps,t). vars e \\<union> {x} \\<subseteq> dom ps \\<and> Q (ps(x \\<mapsto> paval e ps),t)) ** $1)\"", "lemma wpt_Seq[simp]: \"wp\\<^sub>3 (c\\<^sub>1;;c\\<^sub>2) Q = wp\\<^sub>3 c\\<^sub>1 (wp\\<^sub>3 c\\<^sub>2 Q)\"", "lemma wp3_If[simp]:\n \"wp\\<^sub>3 (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2) Q = ((\\<lambda>(ps,t). vars b \\<subseteq> dom ps \\<and> wp\\<^sub>3 (if pbval b ps then c\\<^sub>1 else c\\<^sub>2) Q (ps,t)) ** $1)\"", "lemma sFTrue: assumes \"pbval b ps\" \"vars b \\<subseteq> dom ps\"\n  shows \"wp\\<^sub>3 (WHILE b DO c) Q (ps, n) = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) (ps, n)\"\n    (is \"?wp = (?I \\<and>* $ 1) _\")", "lemma sFFalse: assumes \"~ pbval b ps\" \"vars b \\<subseteq> dom ps\"\n  shows \"wp\\<^sub>3 (WHILE b DO c) Q (ps, n) = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) (ps, n)\"\n    (is \"?wp = (?I \\<and>* $ 1) _\")", "lemma sF': \"wp\\<^sub>3 (WHILE b DO c) Q (ps,n) = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) (ps,n)\"", "lemma sF: \"wp\\<^sub>3 (WHILE b DO c) Q s = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) s\"", "lemma assumes \"\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c {Q}\"\n  shows WhileWpisPre: \"\\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}\"", "lemma wp3_is_pre: \"\\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}\"", "theorem hoare3_complete: \"\\<Turnstile>\\<^sub>3 {P}c{Q} \\<Longrightarrow> \\<turnstile>\\<^sub>3 {P}c{Q}\"", "theorem hoare3_sound_complete: \"\\<Turnstile>\\<^sub>3 {P}c{Q} \\<longleftrightarrow> \\<turnstile>\\<^sub>3 {P}c{Q}\"", "lemma \"wp\\<^sub>3 C (Q**(%_.True)) = F C Q\""], "translations": [["", "lemma alternative: \"\\<Turnstile>\\<^sub>3 { P } c { Q }  \\<longleftrightarrow>  \n     (\\<forall>ps n. P (ps,n)\n     \\<longrightarrow> (\\<exists>ps' t n'. ((c,ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps')\n             \\<and> n=n'+t \\<and> Q (ps', n'))  )\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Turnstile>\\<^sub>3 {P} c { Q}) =\n    (\\<forall>ps n.\n        P (ps, n) \\<longrightarrow>\n        (\\<exists>ps' t n'.\n            (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n            n = n' + t \\<and> Q (ps', n')))", "proof rule"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {P} c { Q} \\<Longrightarrow>\n    \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n'))\n 2. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n')) \\<Longrightarrow>\n    \\<Turnstile>\\<^sub>3 {P} c { Q}", "assume \"\\<Turnstile>\\<^sub>3 {P} c { Q}\""], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P} c { Q}\n\ngoal (2 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {P} c { Q} \\<Longrightarrow>\n    \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n'))\n 2. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n')) \\<Longrightarrow>\n    \\<Turnstile>\\<^sub>3 {P} c { Q}", "then"], ["proof (chain)\npicking this:\n  \\<Turnstile>\\<^sub>3 {P} c { Q}", "have P: \"(\\<forall>ps n. P (ps,n) \\<longrightarrow> (\\<exists>ps' m. ((c,ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps') \\<and> n\\<ge>m \\<and> Q (ps', n-m))  )\""], ["proof (prove)\nusing this:\n  \\<Turnstile>\\<^sub>3 {P} c { Q}\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> Q (ps', n - m))", "unfolding hoare3_valid_def"], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> Q (ps', n - m))", "."], ["proof (state)\nthis:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n\ngoal (2 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {P} c { Q} \\<Longrightarrow>\n    \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n'))\n 2. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n')) \\<Longrightarrow>\n    \\<Turnstile>\\<^sub>3 {P} c { Q}", "show \"\\<forall>ps n. P (ps, n) \\<longrightarrow> (\\<exists>ps' m e. (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and> n = e + m \\<and> Q (ps', e))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m e.\n           (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           n = e + m \\<and> Q (ps', e))", "proof (safe)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m e.\n          (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          n = e + m \\<and> Q (ps', e)", "fix ps n"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m e.\n          (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          n = e + m \\<and> Q (ps', e)", "assume \"P (ps, n)\""], ["proof (state)\nthis:\n  P (ps, n)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m e.\n          (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          n = e + m \\<and> Q (ps', e)", "with P"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (ps, n)", "obtain ps' m where Z: \"((c,ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps')\" \"n\\<ge>m\" \"Q (ps', n-m)\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (ps, n)\n\ngoal (1 subgoal):\n 1. (\\<And>m ps'.\n        \\<lbrakk>(c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'; m \\<le> n;\n         Q (ps', n - m)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n\n  Q (ps', n - m)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m e.\n          (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          n = e + m \\<and> Q (ps', e)", "show \"\\<exists>ps' m e. (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and> n = e + m \\<and> Q (ps', e)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m e.\n       (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       n = e + m \\<and> Q (ps', e)", "apply(rule exI[where x=ps'])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m e.\n       (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       n = e + m \\<and> Q (ps', e)", "apply(rule exI[where x=m])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>e.\n       (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       n = e + m \\<and> Q (ps', e)", "apply(rule exI[where x=\"n-m\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n    n = n - m + m \\<and> Q (ps', n - m)", "using Z"], ["proof (prove)\nusing this:\n  (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n\n  Q (ps', n - m)\n\ngoal (1 subgoal):\n 1. (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n    n = n - m + m \\<and> Q (ps', n - m)", "by auto"], ["proof (state)\nthis:\n  \\<exists>ps' m e.\n     (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     n = e + m \\<and> Q (ps', e)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m e.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         n = e + m \\<and> Q (ps', e))\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n')) \\<Longrightarrow>\n    \\<Turnstile>\\<^sub>3 {P} c { Q}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n')) \\<Longrightarrow>\n    \\<Turnstile>\\<^sub>3 {P} c { Q}", "assume \"\\<forall>ps n. P (ps, n) \\<longrightarrow> (\\<exists>ps' m e. (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and> n = e + m \\<and> Q (ps', e))\""], ["proof (state)\nthis:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m e.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         n = e + m \\<and> Q (ps', e))\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' t n'.\n           (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n           n = n' + t \\<and> Q (ps', n')) \\<Longrightarrow>\n    \\<Turnstile>\\<^sub>3 {P} c { Q}", "then"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m e.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         n = e + m \\<and> Q (ps', e))", "show \"\\<Turnstile>\\<^sub>3 { P } c { Q } \""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m e.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         n = e + m \\<and> Q (ps', e))\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P} c { Q}", "unfolding hoare3_valid_def"], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m e.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         n = e + m \\<and> Q (ps', e))\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> Q (ps', n - m))", "by fastforce"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P} c { Q}\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \"Hoare Rules\""], ["", "inductive\n  hoareT3 :: \"assn2 \\<Rightarrow> com \\<Rightarrow> assn2 \\<Rightarrow> bool\" (\"\\<turnstile>\\<^sub>3 ({(1_)}/ (_)/ { (1_)})\" 50)\nwhere\n\nSkip:  \"\\<turnstile>\\<^sub>3 {$1} SKIP { $0}\"  |\n\nAssign:  \"\\<turnstile>\\<^sub>3 {lmaps_to_expr_x x a v ** $1} x::=a { (%(s,c). dom s = vars a - {x} \\<and> c = 0) ** x \\<hookrightarrow> v }\"  |\n\nIf: \"\\<lbrakk> \\<turnstile>\\<^sub>3 { \\<lambda>(s,n). P (s,n) \\<and> lmaps_to_axpr b True s } c\\<^sub>1 { Q };\n       \\<turnstile>\\<^sub>3 {  \\<lambda>(s,n). P (s,n) \\<and> lmaps_to_axpr b False s } c\\<^sub>2 { Q } \\<rbrakk>\n  \\<Longrightarrow> \\<turnstile>\\<^sub>3 { (\\<lambda>(s,n). P (s,n) \\<and> vars b \\<subseteq> dom s) ** $1} IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\"   |\n\nFrame:  \"\\<lbrakk>    \\<turnstile>\\<^sub>3 { P } C { Q  } \\<rbrakk>\n             \\<Longrightarrow> \\<turnstile>\\<^sub>3 { P ** F } C { Q ** F } \"  |\n\nSeq:  \"\\<lbrakk> \\<turnstile>\\<^sub>3 { P } C\\<^sub>1 { Q } ;  \\<turnstile>\\<^sub>3 { Q } C\\<^sub>2 { R  } \\<rbrakk>\n             \\<Longrightarrow> \\<turnstile>\\<^sub>3 { P } C\\<^sub>1 ;; C\\<^sub>2 { R } \"  |\n\nWhile:  \"\\<lbrakk> \\<turnstile>\\<^sub>3 { (\\<lambda>(s,n). P (s,n) \\<and> lmaps_to_axpr b True s) } C { P  ** $1 }  \\<rbrakk>\n             \\<Longrightarrow> \\<turnstile>\\<^sub>3 { (\\<lambda>(s,n). P (s,n) \\<and>  vars b \\<subseteq> dom s) ** $1 } WHILE b DO C {  \\<lambda>(s,n). P (s,n) \\<and> lmaps_to_axpr b False s } \"  |\n  \nconseq: \"\\<lbrakk> \\<turnstile>\\<^sub>3 {P}c{Q} ; \\<And>s. P' s \\<Longrightarrow> P s ; \\<And>s. Q s \\<Longrightarrow> Q' s \\<rbrakk> \\<Longrightarrow>\n           \\<turnstile>\\<^sub>3 {P'}c{ Q'}\"   |\n\nnormalize:  \"\\<lbrakk>    \\<turnstile>\\<^sub>3 { P ** $m } C { Q  ** $n }; n\\<le>m \\<rbrakk>\n             \\<Longrightarrow> \\<turnstile>\\<^sub>3 { P ** $(m-n) } C { Q } \"   |\n\nconstancy:  \"\\<lbrakk>    \\<turnstile>\\<^sub>3 { P } C { Q }; \\<And>ps ps'. ps = ps' on UNIV - lvars C \\<Longrightarrow> R ps = R ps'  \\<rbrakk>\n             \\<Longrightarrow> \\<turnstile>\\<^sub>3 { %(ps,n). P (ps,n) \\<and> R ps } C { %(ps,n). Q (ps,n) \\<and> R ps } \" |\n\nAssign''': \"\\<turnstile>\\<^sub>3 {  $1 ** (x \\<hookrightarrow> ds) } x ::= (N v) {  (x \\<hookrightarrow> v) }\" |\n\nAssign'''': \"\\<lbrakk>  symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= (N v) {Q'}  \\<rbrakk> \\<Longrightarrow> \\<turnstile>\\<^sub>3 {P} x ::= a {Q'}\" |\n\nAssign4:  \"\\<turnstile>\\<^sub>3 { (\\<lambda>(ps,t). x\\<in>dom ps \\<and> vars a \\<subseteq> dom ps \\<and> Q (ps(x\\<mapsto>(paval a ps)),t) ) ** $1} x::=a { Q }\" |\n\nFalse: \"\\<turnstile>\\<^sub>3 {  \\<lambda>(ps,n). False } c {  Q }\" |\n\npureI: \"( P \\<Longrightarrow>  \\<turnstile>\\<^sub>3 { Q} c { R}) \\<Longrightarrow>  \\<turnstile>\\<^sub>3 {\\<up>P ** Q} c { R}\""], ["", "text \\<open>Derived Rules\\<close>"], ["", "lemma Frame_R:  assumes \"\\<turnstile>\\<^sub>3 { P } C { Q  }\" \"Frame P' P F\"\n             shows \"\\<turnstile>\\<^sub>3 { P' } C { Q ** F } \""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {P'} C { Q \\<and>* F}", "apply(rule conseq)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<turnstile>\\<^sub>3 {?P} C { ?Q}\n 2. \\<And>s. P' s \\<Longrightarrow> ?P s\n 3. \\<And>s. ?Q s \\<Longrightarrow> (Q \\<and>* F) s", "apply(rule Frame)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<turnstile>\\<^sub>3 {?P4} C { ?Q4}\n 2. \\<And>s. P' s \\<Longrightarrow> (?P4 \\<and>* ?F4) s\n 3. \\<And>s. (?Q4 \\<and>* ?F4) s \\<Longrightarrow> (Q \\<and>* F) s", "apply(rule assms(1))"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s. P' s \\<Longrightarrow> (P \\<and>* ?F4) s\n 2. \\<And>s. (Q \\<and>* ?F4) s \\<Longrightarrow> (Q \\<and>* F) s", "using assms(2)"], ["proof (prove)\nusing this:\n  Frame P' P F\n\ngoal (2 subgoals):\n 1. \\<And>s. P' s \\<Longrightarrow> (P \\<and>* ?F4) s\n 2. \\<And>s. (Q \\<and>* ?F4) s \\<Longrightarrow> (Q \\<and>* F) s", "unfolding Frame_def"], ["proof (prove)\nusing this:\n  \\<forall>s. P' s \\<longrightarrow> (P \\<and>* F) s\n\ngoal (2 subgoals):\n 1. \\<And>s. P' s \\<Longrightarrow> (P \\<and>* ?F4) s\n 2. \\<And>s. (Q \\<and>* ?F4) s \\<Longrightarrow> (Q \\<and>* F) s", "by auto"], ["", "lemma strengthen_post: assumes \"\\<turnstile>\\<^sub>3 {P}c{Q}\" \"\\<And>s. Q s \\<Longrightarrow> Q' s\"\n  shows \"\\<turnstile>\\<^sub>3 {P}c{ Q'}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {P} c { Q'}", "apply(rule conseq)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<turnstile>\\<^sub>3 {?P} c { ?Q}\n 2. \\<And>s. P s \\<Longrightarrow> ?P s\n 3. \\<And>s. ?Q s \\<Longrightarrow> Q' s", "apply (rule assms(1))"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s. P s \\<Longrightarrow> P s\n 2. \\<And>s. Q s \\<Longrightarrow> Q' s", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s. Q s \\<Longrightarrow> Q' s", "apply fact"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma weakenpre:  \"\\<lbrakk> \\<turnstile>\\<^sub>3 {P}c{Q} ; \\<And>s. P' s \\<Longrightarrow> P s  \\<rbrakk> \\<Longrightarrow>\n           \\<turnstile>\\<^sub>3 {P'}c{ Q}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n     \\<And>s. P' s \\<Longrightarrow> P s\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {P'} c { Q}", "using conseq"], ["proof (prove)\nusing this:\n  \\<lbrakk>\\<turnstile>\\<^sub>3 {?P} ?c { ?Q};\n   \\<And>s. ?P' s \\<Longrightarrow> ?P s;\n   \\<And>s. ?Q s \\<Longrightarrow> ?Q' s\\<rbrakk>\n  \\<Longrightarrow> \\<turnstile>\\<^sub>3 {?P'} ?c { ?Q'}\n\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n     \\<And>s. P' s \\<Longrightarrow> P s\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {P'} c { Q}", "by auto"], ["", "subsection \\<open>Soundness Proof\\<close>"], ["", "lemma exec_preserves_disj: \"(c,ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<Longrightarrow> ps'' ## ps \\<Longrightarrow> ps'' ## ps'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>(c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps';\n     ps'' ## ps\\<rbrakk>\n    \\<Longrightarrow> ps'' ## ps'", "apply(drule big_step_t3_post_dom_conv)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>ps'' ## ps; dom ps' = dom ps\\<rbrakk>\n    \\<Longrightarrow> ps'' ## ps'", "unfolding sep_disj_fun_def domain_conv"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>dom ps'' \\<inter> dom ps = {}; dom ps' = dom ps\\<rbrakk>\n    \\<Longrightarrow> dom ps'' \\<inter> dom ps' = {}", "by auto"], ["", "lemma FrameRuleSound: assumes \"\\<Turnstile>\\<^sub>3 { P  } C { Q  }\"\n  shows \"\\<Turnstile>\\<^sub>3 { P ** F } C { Q ** F }\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "{"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "fix ps n"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "assume \"(P \\<and>* F) (ps, n)\""], ["proof (state)\nthis:\n  (P \\<and>* F) (ps, n)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "then"], ["proof (chain)\npicking this:\n  (P \\<and>* F) (ps, n)", "obtain pP nP pF nF where orth: \"(pP, nP) ## (pF, nF)\" and add: \"(ps, n) = (pP, nP) + (pF, nF)\"\n              and P: \"P (pP, nP)\" and F: \"F (pF, nF)\""], ["proof (prove)\nusing this:\n  (P \\<and>* F) (ps, n)\n\ngoal (1 subgoal):\n 1. (\\<And>pP nP pF nF.\n        \\<lbrakk>(pP, nP) ## (pF, nF); (ps, n) = (pP, nP) + (pF, nF);\n         P (pP, nP); F (pF, nF)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding sep_conj_def"], ["proof (prove)\nusing this:\n  \\<exists>x y. x ## y \\<and> (ps, n) = x + y \\<and> P x \\<and> F y\n\ngoal (1 subgoal):\n 1. (\\<And>pP nP pF nF.\n        \\<lbrakk>(pP, nP) ## (pF, nF); (ps, n) = (pP, nP) + (pF, nF);\n         P (pP, nP); F (pF, nF)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  (pP, nP) ## (pF, nF)\n  (ps, n) = (pP, nP) + (pF, nF)\n  P (pP, nP)\n  F (pF, nF)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "from assms[unfolded hoare3_valid_def] P"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (pP, nP)", "obtain pP' m where ex: \"(C, pP) \\<Rightarrow>\\<^sub>A m \\<Down> pP'\" and m: \"m \\<le> nP\" and Q: \"Q (pP', nP - m)\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (pP, nP)\n\ngoal (1 subgoal):\n 1. (\\<And>m pP'.\n        \\<lbrakk>(C, pP) \\<Rightarrow>\\<^sub>A m \\<Down> pP'; m \\<le> nP;\n         Q (pP', nP - m)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (C, pP) \\<Rightarrow>\\<^sub>A m \\<Down> pP'\n  m \\<le> nP\n  Q (pP', nP - m)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "have exF: \"(C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF", "using Framer2 ex orth add"], ["proof (prove)\nusing this:\n  \\<lbrakk>(?C, ?ps1.0) \\<Rightarrow>\\<^sub>A ?m \\<Down> ?ps1';\n   ?ps1.0 ## ?ps2.0; ?ps = ?ps1.0 + ?ps2.0; ?ps' = ?ps1' + ?ps2.0\\<rbrakk>\n  \\<Longrightarrow> (?C, ?ps) \\<Rightarrow>\\<^sub>A ?m \\<Down> ?ps'\n  (C, pP) \\<Rightarrow>\\<^sub>A m \\<Down> pP'\n  (pP, nP) ## (pF, nF)\n  (ps, n) = (pP, nP) + (pF, nF)\n\ngoal (1 subgoal):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF", "by auto"], ["proof (state)\nthis:\n  (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "have QF: \"(Q \\<and>* F) (pP' + pF, n - m)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (Q \\<and>* F) (pP' + pF, n - m)", "unfolding sep_conj_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>x y.\n       x ## y \\<and> (pP' + pF, n - m) = x + y \\<and> Q x \\<and> F y", "apply(rule exI[where x=\"(pP',nP-m)\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>y.\n       (pP', nP - m) ## y \\<and>\n       (pP' + pF, n - m) = (pP', nP - m) + y \\<and>\n       Q (pP', nP - m) \\<and> F y", "apply(rule exI[where x=\"(pF,nF)\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (pP', nP - m) ## (pF, nF) \\<and>\n    (pP' + pF, n - m) = (pP', nP - m) + (pF, nF) \\<and>\n    Q (pP', nP - m) \\<and> F (pF, nF)", "using orth exec_preserves_disj[OF ex] add m F Q"], ["proof (prove)\nusing this:\n  (pP, nP) ## (pF, nF)\n  ?ps'' ## pP \\<Longrightarrow> ?ps'' ## pP'\n  (ps, n) = (pP, nP) + (pF, nF)\n  m \\<le> nP\n  F (pF, nF)\n  Q (pP', nP - m)\n\ngoal (1 subgoal):\n 1. (pP', nP - m) ## (pF, nF) \\<and>\n    (pP' + pF, n - m) = (pP', nP - m) + (pF, nF) \\<and>\n    Q (pP', nP - m) \\<and> F (pF, nF)", "by (auto simp add: sep_add_ac)"], ["proof (state)\nthis:\n  (Q \\<and>* F) (pP' + pF, n - m)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "have \"(C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP'+pF \\<and> m \\<le> n \\<and> (Q \\<and>* F) (pP'+pF, n - m)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF \\<and>\n    m \\<le> n \\<and> (Q \\<and>* F) (pP' + pF, n - m)", "using QF exF add m"], ["proof (prove)\nusing this:\n  (Q \\<and>* F) (pP' + pF, n - m)\n  (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF\n  (ps, n) = (pP, nP) + (pF, nF)\n  m \\<le> nP\n\ngoal (1 subgoal):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF \\<and>\n    m \\<le> n \\<and> (Q \\<and>* F) (pP' + pF, n - m)", "by auto"], ["proof (state)\nthis:\n  (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF \\<and>\n  m \\<le> n \\<and> (Q \\<and>* F) (pP' + pF, n - m)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "hence \"\\<exists>ps' m. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and> m \\<le> n \\<and> (Q \\<and>* F) (ps', n - m)\""], ["proof (prove)\nusing this:\n  (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> pP' + pF \\<and>\n  m \\<le> n \\<and> (Q \\<and>* F) (pP' + pF, n - m)\n\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> (Q \\<and>* F) (ps', n - m)", "by auto"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and> (Q \\<and>* F) (ps', n - m)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "}"], ["proof (state)\nthis:\n  (P \\<and>* F) (?ps2, ?n2) \\<Longrightarrow>\n  \\<exists>ps' m.\n     (C, ?ps2) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> ?n2 \\<and> (Q \\<and>* F) (ps', ?n2 - m)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "thus ?thesis"], ["proof (prove)\nusing this:\n  (P \\<and>* F) (?ps2, ?n2) \\<Longrightarrow>\n  \\<exists>ps' m.\n     (C, ?ps2) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> ?n2 \\<and> (Q \\<and>* F) (ps', ?n2 - m)\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "unfolding hoare3_valid_def"], ["proof (prove)\nusing this:\n  (P \\<and>* F) (?ps2, ?n2) \\<Longrightarrow>\n  \\<exists>ps' m.\n     (C, ?ps2) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> ?n2 \\<and> (Q \\<and>* F) (ps', ?n2 - m)\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       (P \\<and>* F) (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> (Q \\<and>* F) (ps', n - m))", "by auto"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n\ngoal:\nNo subgoals!", "qed"], ["", "theorem hoare3_sound: assumes \"\\<turnstile>\\<^sub>3 { P }c{ Q  }\"\n  shows \"\\<Turnstile>\\<^sub>3 { P } c { Q }\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P} c { Q}", "using assms"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {P} c { Q}\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P} c { Q}", "proof(induction  rule: hoareT3.induct)"], ["proof (state)\ngoal (14 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {$ 1} SKIP { $ 0}\n 2. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 3. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 4. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 5. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 6. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 7. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 8. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 9. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 10. \\<And>x ds v.\n        \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n        { x \\<hookrightarrow> v}\nA total of 14 subgoals...", "case (False c Q)"], ["proof (state)\nthis:\n  \n\ngoal (14 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {$ 1} SKIP { $ 0}\n 2. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 3. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 4. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 5. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 6. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 7. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 8. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 9. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 10. \\<And>x ds v.\n        \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n        { x \\<hookrightarrow> v}\nA total of 14 subgoals...", "then"], ["proof (chain)\npicking this:", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {\\<lambda>a. case a of (ps, n) \\<Rightarrow> False}\n    c { Q}", "by (auto simp: hoare3_valid_def)"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {\\<lambda>a. case a of (ps, n) \\<Rightarrow> False} c\n  { Q}\n\ngoal (13 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {$ 1} SKIP { $ 0}\n 2. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 3. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 4. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 5. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 6. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 7. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 8. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 9. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 10. \\<And>x ds v.\n        \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n        { x \\<hookrightarrow> v}\nA total of 13 subgoals...", "next"], ["proof (state)\ngoal (13 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {$ 1} SKIP { $ 0}\n 2. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 3. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 4. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 5. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 6. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 7. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 8. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 9. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 10. \\<And>x ds v.\n        \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n        { x \\<hookrightarrow> v}\nA total of 13 subgoals...", "case Skip"], ["proof (state)\nthis:\n  \n\ngoal (13 subgoals):\n 1. \\<Turnstile>\\<^sub>3 {$ 1} SKIP { $ 0}\n 2. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 3. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 4. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 5. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 6. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 7. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 8. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 9. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 10. \\<And>x ds v.\n        \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n        { x \\<hookrightarrow> v}\nA total of 13 subgoals...", "then"], ["proof (chain)\npicking this:", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {$ 1} SKIP { $ 0}", "by (auto simp: hoare3_valid_def dollar_def)"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {$ 1} SKIP { $ 0}\n\ngoal (12 subgoals):\n 1. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 2. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 3. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 4. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 5. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 6. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 7. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 8. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 9. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 10. \\<And>P a v x Q'.\n        \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n         \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\nA total of 12 subgoals...", "next"], ["proof (state)\ngoal (12 subgoals):\n 1. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 2. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 3. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 4. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 5. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 6. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 7. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 8. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 9. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 10. \\<And>P a v x Q'.\n        \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n         \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\nA total of 12 subgoals...", "case (Assign4 x a Q)"], ["proof (state)\nthis:\n  \n\ngoal (12 subgoals):\n 1. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 2. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 3. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 4. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 5. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 6. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 7. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 8. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 9. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 10. \\<And>P a v x Q'.\n        \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n         \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\nA total of 12 subgoals...", "then"], ["proof (chain)\npicking this:", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {(\\<lambda>(ps, t).\n                              x \\<in> dom ps \\<and>\n                              vars a \\<subseteq> dom ps \\<and>\n                              Q (ps(x \\<mapsto> paval a ps), t)) \\<and>*\n                          $ 1}\n    x ::= a { Q}", "apply (auto simp: dollar_def sep_conj_def hoare3_valid_def )"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps b y.\n       \\<lbrakk>ps x = Some y; vars a \\<subseteq> dom ps;\n        Q (ps(x \\<mapsto> paval a ps), b)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (x ::= a,\n                             ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> Suc b \\<and> Q (ps', Suc b - m)", "subgoal for ps b y"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>ps x = Some y; vars a \\<subseteq> dom ps;\n     Q (ps(x \\<mapsto> paval a ps), b)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ps' m.\n                         (x ::= a,\n                          ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                         m \\<le> Suc b \\<and> Q (ps', Suc b - m)", "apply(rule exI[where x=\"ps(x \\<mapsto> paval a ps)\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>ps x = Some y; vars a \\<subseteq> dom ps;\n     Q (ps(x \\<mapsto> paval a ps), b)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m.\n                         (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps(x \n                         \\<mapsto> paval a ps) \\<and>\n                         m \\<le> Suc b \\<and>\n                         Q (ps(x \\<mapsto> paval a ps), Suc b - m)", "apply(rule exI[where x=\"Suc 0\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>ps x = Some y; vars a \\<subseteq> dom ps;\n     Q (ps(x \\<mapsto> paval a ps), b)\\<rbrakk>\n    \\<Longrightarrow> (x ::= a, ps) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> ps\n                      (x \\<mapsto> paval a ps) \\<and>\n                      Suc 0 \\<le> Suc b \\<and>\n                      Q (ps(x \\<mapsto> paval a ps), Suc b - Suc 0)", "by auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {(\\<lambda>(ps, t).\n                            x \\<in> dom ps \\<and>\n                            vars a \\<subseteq> dom ps \\<and>\n                            Q (ps(x \\<mapsto> paval a ps), t)) \\<and>*\n                        $ 1}\n  x ::= a { Q}\n\ngoal (11 subgoals):\n 1. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 2. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 3. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 4. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 5. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 6. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 7. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 8. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 9. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 10. \\<And>P a v x Q'.\n        \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n         \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\nA total of 11 subgoals...", "next"], ["proof (state)\ngoal (11 subgoals):\n 1. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 2. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 3. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 4. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 5. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 6. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 7. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 8. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 9. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 10. \\<And>P a v x Q'.\n        \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n         \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\nA total of 11 subgoals...", "case (Assign x a v)"], ["proof (state)\nthis:\n  \n\ngoal (11 subgoals):\n 1. \\<And>x a v.\n       \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n       { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n         x \\<hookrightarrow> v}\n 2. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 3. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 4. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 5. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 6. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 7. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 8. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 9. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 10. \\<And>P a v x Q'.\n        \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n         \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\nA total of 11 subgoals...", "then"], ["proof (chain)\npicking this:", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n    { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n      x \\<hookrightarrow> v}", "unfolding hoare3_valid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       (lmaps_to_expr_x x a v \\<and>* $ 1) (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and>\n           ((\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n            x \\<hookrightarrow> v)\n            (ps', n - m))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, c).\n            dom s = insert x (vars a) \\<and>\n            paval a s = v \\<and> c = 0) \\<and>*\n        $ (Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and>\n          ((\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n           x \\<hookrightarrow> v)\n           (ps', n - m)", "apply (auto simp: dollar_def )"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, c).\n            dom s = insert x (vars a) \\<and>\n            paval a s = v \\<and> c = 0) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and>\n          ((\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n           x \\<hookrightarrow> v)\n           (ps', n - m)", "apply (subst (asm) separate_othogonal)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>ps n psa na.\n       case (psa, na) of\n       (s, c) \\<Rightarrow>\n         dom s = insert x (vars a) \\<and>\n         paval a s = v \\<and> c = 0 \\<Longrightarrow>\n       na = 0\n 2. \\<And>ps n psa na.\n       case (psa, na) of\n       (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0 \\<Longrightarrow>\n       psa = 0\n 3. \\<And>ps n.\n       (case (ps, 0) of\n        (s, c) \\<Rightarrow>\n          dom s = insert x (vars a) \\<and>\n          paval a s = v \\<and> c = 0) \\<and>\n       (case (0, n) of\n        (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and>\n          ((\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n           x \\<hookrightarrow> v)\n           (ps', n - m)", "apply simp_all"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> Suc 0 \\<and>\n          ((\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n           x \\<hookrightarrow> v)\n           (ps', Suc 0 - m)", "apply(intro exI conjI)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       (x ::= a, ps) \\<Rightarrow>\\<^sub>A ?m8 ps \\<Down> ?ps'7 ps\n 2. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       ?m8 ps \\<le> Suc 0\n 3. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       ((\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n        x \\<hookrightarrow> v)\n        (?ps'7 ps, Suc 0 - ?m8 ps)", "apply(rule big_step_t_part.Assign)"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       vars a \\<union> {x} \\<subseteq> dom ps\n 2. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       paval a ps = ?v11 ps\n 3. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       ?ps'7 ps = ps(x \\<mapsto> ?v11 ps)\n 4. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       Suc 0 \\<le> Suc 0\n 5. \\<And>ps.\n       dom ps = insert x (vars a) \\<and> paval a ps = v \\<Longrightarrow>\n       ((\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n        x \\<hookrightarrow> v)\n        (?ps'7 ps, Suc 0 - Suc 0)", "apply (auto simp: pointsto_def)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, c).\n                              dom s = vars a - {x} \\<and> c = 0) \\<and>*\n                          (\\<lambda>(s, c).\n                              s = [x \\<mapsto> paval a ps] \\<and> c = 0))\n                          (ps(x \\<mapsto> paval a ps), 0)", "unfolding  sep_conj_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xa y.\n                            xa ## y \\<and>\n                            (ps(x \\<mapsto> paval a ps), 0) = xa + y \\<and>\n                            (case xa of\n                             (s, c) \\<Rightarrow>\n                               dom s = vars a - {x} \\<and> c = 0) \\<and>\n                            (case y of\n                             (s, c) \\<Rightarrow>\n                               s = [x \\<mapsto> paval a ps] \\<and> c = 0)", "subgoal for ps"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>dom ps = insert x (vars a); v = paval a ps\\<rbrakk>\n    \\<Longrightarrow> \\<exists>xa y.\n                         xa ## y \\<and>\n                         (ps(x \\<mapsto> paval a ps), 0) = xa + y \\<and>\n                         (case xa of\n                          (s, c) \\<Rightarrow>\n                            dom s = vars a - {x} \\<and> c = 0) \\<and>\n                         (case y of\n                          (s, c) \\<Rightarrow>\n                            s = [x \\<mapsto> paval a ps] \\<and> c = 0)", "apply(rule exI[where x=\"((%y. if y=x then None else ps y) , 0)\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>dom ps = insert x (vars a); v = paval a ps\\<rbrakk>\n    \\<Longrightarrow> \\<exists>y.\n                         (\\<lambda>y. if y = x then None else ps y, 0) ##\n                         y \\<and>\n                         (ps(x \\<mapsto> paval a ps), 0) =\n                         (\\<lambda>y. if y = x then None else ps y, 0) +\n                         y \\<and>\n                         (case (\\<lambda>y. if y = x then None else ps y,\n                                0) of\n                          (s, c) \\<Rightarrow>\n                            dom s = vars a - {x} \\<and> c = 0) \\<and>\n                         (case y of\n                          (s, c) \\<Rightarrow>\n                            s = [x \\<mapsto> paval a ps] \\<and> c = 0)", "apply(rule exI[where x=\"((%y. if y = x then Some (paval a ps) else None),0)\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>dom ps = insert x (vars a); v = paval a ps\\<rbrakk>\n    \\<Longrightarrow> (\\<lambda>y. if y = x then None else ps y, 0) ##\n                      (\\<lambda>y.\n                          if y = x then Some (paval a ps) else None,\n                       0) \\<and>\n                      (ps(x \\<mapsto> paval a ps), 0) =\n                      (\\<lambda>y. if y = x then None else ps y, 0) +\n                      (\\<lambda>y.\n                          if y = x then Some (paval a ps) else None,\n                       0) \\<and>\n                      (case (\\<lambda>y. if y = x then None else ps y, 0) of\n                       (s, c) \\<Rightarrow>\n                         dom s = vars a - {x} \\<and> c = 0) \\<and>\n                      (case (\\<lambda>y.\n                                if y = x then Some (paval a ps) else None,\n                             0) of\n                       (s, c) \\<Rightarrow>\n                         s = [x \\<mapsto> paval a ps] \\<and> c = 0)", "apply (auto simp: sep_disj_prod_def sep_disj_fun_def plus_fun_def)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>xa.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps;\n        xa \\<in> domain (\\<lambda>y. if y = x then None else ps y);\n        xa \\<in> domain\n                  (\\<lambda>y.\n                      if y = x then Some (paval a ps) else None)\\<rbrakk>\n       \\<Longrightarrow> False\n 2. \\<And>xa y.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps;\n        (if xa = x then None else ps xa) = Some y\\<rbrakk>\n       \\<Longrightarrow> xa \\<in> vars a\n 3. \\<And>xa.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps; xa \\<in> vars a;\n        (if xa = x then None else ps xa) = None\\<rbrakk>\n       \\<Longrightarrow> xa = x", "apply (smt domIff domain_conv)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>xa y.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps;\n        (if xa = x then None else ps xa) = Some y\\<rbrakk>\n       \\<Longrightarrow> xa \\<in> vars a\n 2. \\<And>xa.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps; xa \\<in> vars a;\n        (if xa = x then None else ps xa) = None\\<rbrakk>\n       \\<Longrightarrow> xa = x", "apply (metis domI insertE option.simps(3))"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>xa.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps; xa \\<in> vars a;\n        (if xa = x then None else ps xa) = None\\<rbrakk>\n       \\<Longrightarrow> xa = x", "using domIff"], ["proof (prove)\nusing this:\n  (?a \\<in> dom ?m) = (?m ?a \\<noteq> None)\n\ngoal (1 subgoal):\n 1. \\<And>xa.\n       \\<lbrakk>dom ps = insert x (vars a); v = paval a ps; xa \\<in> vars a;\n        (if xa = x then None else ps xa) = None\\<rbrakk>\n       \\<Longrightarrow> xa = x", "by fastforce"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {lmaps_to_expr_x x a v \\<and>* $ 1} x ::= a\n  { (\\<lambda>(s, c). dom s = vars a - {x} \\<and> c = 0) \\<and>*\n    x \\<hookrightarrow> v}\n\ngoal (10 subgoals):\n 1. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 2. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 3. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 4. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 5. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 6. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 7. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 8. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 9. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 10. \\<And>P Q c R.\n        \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n         P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (10 subgoals):\n 1. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 2. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 3. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 4. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 5. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 6. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 7. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 8. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 9. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 10. \\<And>P Q c R.\n        \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n         P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (If P b c\\<^sub>1 Q c\\<^sub>2)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           P (s, n) \\<and> lmaps_to_axpr b True s}\n                       c\\<^sub>1 { Q}\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           P (s, n) \\<and> lmaps_to_axpr b False s}\n                       c\\<^sub>2 { Q}\n  \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                           case a of\n                           (s, n) \\<Rightarrow>\n                             P (s, n) \\<and> lmaps_to_axpr b True s}\n  c\\<^sub>1 { Q}\n  \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                           case a of\n                           (s, n) \\<Rightarrow>\n                             P (s, n) \\<and> lmaps_to_axpr b False s}\n  c\\<^sub>2 { Q}\n\ngoal (10 subgoals):\n 1. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 2. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 3. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 4. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 5. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 6. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 7. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 8. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 9. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 10. \\<And>P Q c R.\n        \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n         P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "from If(3)[unfolded hoare3_valid_def]"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     (case (ps, n) of\n      (s, n) \\<Rightarrow>\n        P (s, n) \\<and> lmaps_to_axpr b True s) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))", "have T: \"\\<And>ps n. P (ps, n) \\<Longrightarrow> vars b \\<subseteq> dom ps \\<Longrightarrow> pbval b ps\n     \\<Longrightarrow> (\\<exists>ps' m. (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and> m \\<le> n \\<and> Q (ps', n-m))\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     (case (ps, n) of\n      (s, n) \\<Rightarrow>\n        P (s, n) \\<and> lmaps_to_axpr b True s) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>P (ps, n); vars b \\<subseteq> dom ps; pbval b ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (c\\<^sub>1,\n                             ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m)", "by auto"], ["proof (state)\nthis:\n  \\<lbrakk>P (?ps, ?n); vars b \\<subseteq> dom ?ps; pbval b ?ps\\<rbrakk>\n  \\<Longrightarrow> \\<exists>ps' m.\n                       (c\\<^sub>1,\n                        ?ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> ?n \\<and> Q (ps', ?n - m)\n\ngoal (10 subgoals):\n 1. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 2. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 3. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 4. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 5. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 6. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 7. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 8. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 9. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 10. \\<And>P Q c R.\n        \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n         P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "from If(4)[unfolded hoare3_valid_def]"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     (case (ps, n) of\n      (s, n) \\<Rightarrow>\n        P (s, n) \\<and> lmaps_to_axpr b False s) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))", "have F: \"\\<And>ps n. P (ps, n) \\<Longrightarrow> vars b \\<subseteq> dom ps \\<Longrightarrow> \\<not> pbval b ps\n     \\<Longrightarrow> (\\<exists>ps' m. (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and> m \\<le> n \\<and> Q (ps', n-m))\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     (case (ps, n) of\n      (s, n) \\<Rightarrow>\n        P (s, n) \\<and> lmaps_to_axpr b False s) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>P (ps, n); vars b \\<subseteq> dom ps;\n        \\<not> pbval b ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (c\\<^sub>2,\n                             ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m)", "by auto"], ["proof (state)\nthis:\n  \\<lbrakk>P (?ps, ?n); vars b \\<subseteq> dom ?ps;\n   \\<not> pbval b ?ps\\<rbrakk>\n  \\<Longrightarrow> \\<exists>ps' m.\n                       (c\\<^sub>2,\n                        ?ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> ?n \\<and> Q (ps', ?n - m)\n\ngoal (10 subgoals):\n 1. \\<And>P b c\\<^sub>1 Q c\\<^sub>2.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     c\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        c\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                                 P (s, n) \\<and> lmaps_to_axpr b False s}\n                             c\\<^sub>2 { Q};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b False s}\n        c\\<^sub>2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n 2. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 3. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 4. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 5. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 6. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 7. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 8. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 9. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 10. \\<And>P Q c R.\n        \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n         P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n        \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                              P (s, n) \\<and>\n                              vars b \\<subseteq> dom s) \\<and>*\n                          $ 1}\n    IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}", "unfolding hoare3_valid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        $ 1)\n        (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n            ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> Q (ps', n - m))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        $ (Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q (ps', n - m)", "apply (auto simp: dollar_def)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q (ps', n - m)", "proof (goal_cases)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q (ps', n - m)", "case (1 ps n)"], ["proof (state)\nthis:\n  ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n   (ps, n)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q (ps', n - m)", "then"], ["proof (chain)\npicking this:\n  ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n   (ps, n)", "obtain n' where P: \"P (ps, n')\" and dom: \"vars b \\<subseteq> dom ps\" and Suc: \"n = Suc n'\""], ["proof (prove)\nusing this:\n  ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n   (ps, n)\n\ngoal (1 subgoal):\n 1. (\\<And>n'.\n        \\<lbrakk>P (ps, n'); vars b \\<subseteq> dom ps; n = Suc n'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding sep_conj_def"], ["proof (prove)\nusing this:\n  \\<exists>x y.\n     x ## y \\<and>\n     (ps, n) = x + y \\<and>\n     (case x of\n      (s, n) \\<Rightarrow> P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>\n     (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0)\n\ngoal (1 subgoal):\n 1. (\\<And>n'.\n        \\<lbrakk>P (ps, n'); vars b \\<subseteq> dom ps; n = Suc n'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by force"], ["proof (state)\nthis:\n  P (ps, n')\n  vars b \\<subseteq> dom ps\n  n = Suc n'\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q (ps', n - m)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "proof(cases \"pbval b ps\")"], ["proof (state)\ngoal (2 subgoals):\n 1. pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)\n 2. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "case True"], ["proof (state)\nthis:\n  pbval b ps\n\ngoal (2 subgoals):\n 1. pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)\n 2. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "with T[OF P dom]"], ["proof (chain)\npicking this:\n  pbval b ps \\<Longrightarrow>\n  \\<exists>ps' m.\n     (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n' \\<and> Q (ps', n' - m)\n  pbval b ps", "obtain ps' m where d: \"(c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\" \n            and m1: \"m \\<le> n'\" and Q: \"Q (ps', n'-m)\""], ["proof (prove)\nusing this:\n  pbval b ps \\<Longrightarrow>\n  \\<exists>ps' m.\n     (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n' \\<and> Q (ps', n' - m)\n  pbval b ps\n\ngoal (1 subgoal):\n 1. (\\<And>m ps'.\n        \\<lbrakk>(c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps';\n         m \\<le> n'; Q (ps', n' - m)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n'\n  Q (ps', n' - m)\n\ngoal (2 subgoals):\n 1. pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)\n 2. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "from big_step_t3_post_dom_conv[OF d]"], ["proof (chain)\npicking this:\n  dom ps' = dom ps", "have klong: \"dom ps' = dom ps\""], ["proof (prove)\nusing this:\n  dom ps' = dom ps\n\ngoal (1 subgoal):\n 1. dom ps' = dom ps", "."], ["proof (state)\nthis:\n  dom ps' = dom ps\n\ngoal (2 subgoals):\n 1. pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)\n 2. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "apply(rule exI[where x=ps'])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "apply(rule exI[where x=\"m+1\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n     ps) \\<Rightarrow>\\<^sub>A m + 1 \\<Down> ps' \\<and>\n    m + 1 \\<le> n \\<and> Q (ps', n - (m + 1))", "apply safe"], ["proof (prove)\ngoal (3 subgoals):\n 1. (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n     ps) \\<Rightarrow>\\<^sub>A m + 1 \\<Down> ps'\n 2. m + 1 \\<le> n\n 3. Q (ps', n - (m + 1))", "apply(rule big_step_t_part.IfTrue)"], ["proof (prove)\ngoal (7 subgoals):\n 1. vars b \\<subseteq> dom ps\n 2. dom ps' = dom ps\n 3. pbval b ps\n 4. (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 5. m + 1 = ?x6 + 1\n 6. m + 1 \\<le> n\n 7. Q (ps', n - (m + 1))", "apply (rule dom)"], ["proof (prove)\ngoal (6 subgoals):\n 1. dom ps' = dom ps\n 2. pbval b ps\n 3. (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 4. m + 1 = ?x6 + 1\n 5. m + 1 \\<le> n\n 6. Q (ps', n - (m + 1))", "apply fact"], ["proof (prove)\ngoal (5 subgoals):\n 1. pbval b ps\n 2. (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 3. m + 1 = ?x6 + 1\n 4. m + 1 \\<le> n\n 5. Q (ps', n - (m + 1))", "apply (rule True)"], ["proof (prove)\ngoal (4 subgoals):\n 1. (c\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 2. m + 1 = ?x6 + 1\n 3. m + 1 \\<le> n\n 4. Q (ps', n - (m + 1))", "apply (rule d)"], ["proof (prove)\ngoal (3 subgoals):\n 1. m + 1 = m + 1\n 2. m + 1 \\<le> n\n 3. Q (ps', n - (m + 1))", "apply simp"], ["proof (prove)\ngoal (2 subgoals):\n 1. m + 1 \\<le> n\n 2. Q (ps', n - (m + 1))", "using m1 Suc"], ["proof (prove)\nusing this:\n  m \\<le> n'\n  n = Suc n'\n\ngoal (2 subgoals):\n 1. m + 1 \\<le> n\n 2. Q (ps', n - (m + 1))", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (ps', n - (m + 1))", "using Q Suc"], ["proof (prove)\nusing this:\n  Q (ps', n' - m)\n  n = Suc n'\n\ngoal (1 subgoal):\n 1. Q (ps', n - (m + 1))", "by force"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n      ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and> Q (ps', n - m)\n\ngoal (1 subgoal):\n 1. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "case False"], ["proof (state)\nthis:\n  \\<not> pbval b ps\n\ngoal (1 subgoal):\n 1. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "with F[OF P dom]"], ["proof (chain)\npicking this:\n  \\<not> pbval b ps \\<Longrightarrow>\n  \\<exists>ps' m.\n     (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n' \\<and> Q (ps', n' - m)\n  \\<not> pbval b ps", "obtain ps' m where d: \"(c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\" \n            and m1: \"m \\<le> n'\" and Q: \"Q (ps', n'-m)\""], ["proof (prove)\nusing this:\n  \\<not> pbval b ps \\<Longrightarrow>\n  \\<exists>ps' m.\n     (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n' \\<and> Q (ps', n' - m)\n  \\<not> pbval b ps\n\ngoal (1 subgoal):\n 1. (\\<And>m ps'.\n        \\<lbrakk>(c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps';\n         m \\<le> n'; Q (ps', n' - m)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n'\n  Q (ps', n' - m)\n\ngoal (1 subgoal):\n 1. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "from big_step_t3_post_dom_conv[OF d]"], ["proof (chain)\npicking this:\n  dom ps' = dom ps", "have \"dom ps' = dom ps\""], ["proof (prove)\nusing this:\n  dom ps' = dom ps\n\ngoal (1 subgoal):\n 1. dom ps' = dom ps", "."], ["proof (state)\nthis:\n  dom ps' = dom ps\n\ngoal (1 subgoal):\n 1. \\<not> pbval b ps \\<Longrightarrow>\n    \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "apply(rule exI[where x=ps'])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m)", "apply(rule exI[where x=\"m+1\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n     ps) \\<Rightarrow>\\<^sub>A m + 1 \\<Down> ps' \\<and>\n    m + 1 \\<le> n \\<and> Q (ps', n - (m + 1))", "apply safe"], ["proof (prove)\ngoal (3 subgoals):\n 1. (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n     ps) \\<Rightarrow>\\<^sub>A m + 1 \\<Down> ps'\n 2. m + 1 \\<le> n\n 3. Q (ps', n - (m + 1))", "apply(rule big_step_t_part.IfFalse)"], ["proof (prove)\ngoal (7 subgoals):\n 1. vars b \\<subseteq> dom ps\n 2. dom ps' = dom ps\n 3. \\<not> pbval b ps\n 4. (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 5. m + 1 = ?x6 + 1\n 6. m + 1 \\<le> n\n 7. Q (ps', n - (m + 1))", "apply fact"], ["proof (prove)\ngoal (6 subgoals):\n 1. dom ps' = dom ps\n 2. \\<not> pbval b ps\n 3. (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 4. m + 1 = ?x6 + 1\n 5. m + 1 \\<le> n\n 6. Q (ps', n - (m + 1))", "apply fact"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<not> pbval b ps\n 2. (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 3. m + 1 = ?x6 + 1\n 4. m + 1 \\<le> n\n 5. Q (ps', n - (m + 1))", "apply (rule False)"], ["proof (prove)\ngoal (4 subgoals):\n 1. (c\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A ?x6 \\<Down> ps'\n 2. m + 1 = ?x6 + 1\n 3. m + 1 \\<le> n\n 4. Q (ps', n - (m + 1))", "apply (rule d)"], ["proof (prove)\ngoal (3 subgoals):\n 1. m + 1 = m + 1\n 2. m + 1 \\<le> n\n 3. Q (ps', n - (m + 1))", "apply simp"], ["proof (prove)\ngoal (2 subgoals):\n 1. m + 1 \\<le> n\n 2. Q (ps', n - (m + 1))", "using m1 Suc"], ["proof (prove)\nusing this:\n  m \\<le> n'\n  n = Suc n'\n\ngoal (2 subgoals):\n 1. m + 1 \\<le> n\n 2. Q (ps', n - (m + 1))", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (ps', n - (m + 1))", "using Q Suc"], ["proof (prove)\nusing this:\n  Q (ps', n' - m)\n  n = Suc n'\n\ngoal (1 subgoal):\n 1. Q (ps', n - (m + 1))", "by force"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n      ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and> Q (ps', n - m)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n      ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and> Q (ps', n - m)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                            P (s, n) \\<and>\n                            vars b \\<subseteq> dom s) \\<and>*\n                        $ 1}\n  IF b THEN c\\<^sub>1 ELSE c\\<^sub>2 { Q}\n\ngoal (9 subgoals):\n 1. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 2. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 3. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 4. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 5. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 6. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 7. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 8. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 9. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (9 subgoals):\n 1. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 2. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 3. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 4. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 5. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 6. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 7. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 8. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 9. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (Frame P C Q F)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {P} C { Q}\n  \\<Turnstile>\\<^sub>3 {P} C { Q}\n\ngoal (9 subgoals):\n 1. \\<And>P C Q F.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n 2. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 3. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 4. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 5. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 6. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 7. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 8. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 9. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "then"], ["proof (chain)\npicking this:\n  \\<turnstile>\\<^sub>3 {P} C { Q}\n  \\<Turnstile>\\<^sub>3 {P} C { Q}", "show ?case"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {P} C { Q}\n  \\<Turnstile>\\<^sub>3 {P} C { Q}\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "using FrameRuleSound"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {P} C { Q}\n  \\<Turnstile>\\<^sub>3 {P} C { Q}\n  \\<Turnstile>\\<^sub>3 {?P} ?C { ?Q} \\<Longrightarrow>\n  \\<Turnstile>\\<^sub>3 {?P \\<and>* ?F} ?C { ?Q \\<and>* ?F}\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}", "by auto"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P \\<and>* F} C { Q \\<and>* F}\n\ngoal (8 subgoals):\n 1. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 2. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 3. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 4. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 5. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 6. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 7. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 8. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (8 subgoals):\n 1. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 2. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 3. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 4. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 5. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 6. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 7. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 8. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (Seq P C\\<^sub>1 Q C\\<^sub>2 R)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q}\n  \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\n  \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q}\n  \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\n\ngoal (8 subgoals):\n 1. \\<And>P C\\<^sub>1 Q C\\<^sub>2 R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1 { Q};\n        \\<turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R};\n        \\<Turnstile>\\<^sub>3 {Q} C\\<^sub>2 { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n 2. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 3. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 4. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 5. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 6. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 7. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 8. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}", "unfolding hoare3_valid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (C\\<^sub>1;; C\\<^sub>2,\n            ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> R (ps', n - m))", "proof (safe, goal_cases)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (C\\<^sub>1;; C\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> R (ps', n - m)", "case (1 ps n)"], ["proof (state)\nthis:\n  P (ps, n)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (C\\<^sub>1;; C\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> R (ps', n - m)", "with Seq(3)[unfolded hoare3_valid_def]"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (ps, n)", "obtain ps' m where C1: \"(C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\"\n          and m: \"m \\<le> n\" and Q: \"Q (ps', n - m)\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (ps, n)\n\ngoal (1 subgoal):\n 1. (\\<And>m ps'.\n        \\<lbrakk>(C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps';\n         m \\<le> n; Q (ps', n - m)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n\n  Q (ps', n - m)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (C\\<^sub>1;; C\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> R (ps', n - m)", "with Seq(4)[unfolded hoare3_valid_def]"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     Q (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> R (ps', n - m))\n  (C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n\n  Q (ps', n - m)", "obtain ps'' m' where C2: \"(C\\<^sub>2, ps') \\<Rightarrow>\\<^sub>A m' \\<Down> ps''\" \n          and m': \"m' \\<le> n - m\" and R: \"R (ps'', n - m - m')\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     Q (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> R (ps', n - m))\n  (C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n\n  Q (ps', n - m)\n\ngoal (1 subgoal):\n 1. (\\<And>m' ps''.\n        \\<lbrakk>(C\\<^sub>2, ps') \\<Rightarrow>\\<^sub>A m' \\<Down> ps'';\n         m' \\<le> n - m; R (ps'', n - m - m')\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (C\\<^sub>2, ps') \\<Rightarrow>\\<^sub>A m' \\<Down> ps''\n  m' \\<le> n - m\n  R (ps'', n - m - m')\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (C\\<^sub>1;; C\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> R (ps', n - m)", "have a: \"(C\\<^sub>1;; C\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m + m' \\<Down> ps''\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (C\\<^sub>1;; C\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m + m' \\<Down> ps''", "apply(rule big_step_t_part.Seq)"], ["proof (prove)\ngoal (3 subgoals):\n 1. (C\\<^sub>1, ps) \\<Rightarrow>\\<^sub>A ?x \\<Down> ?s2.0\n 2. (C\\<^sub>2, ?s2.0) \\<Rightarrow>\\<^sub>A ?y \\<Down> ps''\n 3. m + m' = ?x + ?y", "apply fact+"], ["proof (prove)\ngoal (1 subgoal):\n 1. m + m' = m + m'", "by simp"], ["proof (state)\nthis:\n  (C\\<^sub>1;; C\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m + m' \\<Down> ps''\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (C\\<^sub>1;; C\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> R (ps', n - m)", "have b: \"m + m' \\<le> n\""], ["proof (prove)\ngoal (1 subgoal):\n 1. m + m' \\<le> n", "using m' m"], ["proof (prove)\nusing this:\n  m' \\<le> n - m\n  m \\<le> n\n\ngoal (1 subgoal):\n 1. m + m' \\<le> n", "by auto"], ["proof (state)\nthis:\n  m + m' \\<le> n\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (C\\<^sub>1;; C\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> R (ps', n - m)", "have c: \"R (ps'', n - (m + m'))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. R (ps'', n - (m + m'))", "using R"], ["proof (prove)\nusing this:\n  R (ps'', n - m - m')\n\ngoal (1 subgoal):\n 1. R (ps'', n - (m + m'))", "by simp"], ["proof (state)\nthis:\n  R (ps'', n - (m + m'))\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (C\\<^sub>1;; C\\<^sub>2,\n           ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> R (ps', n - m)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (C\\<^sub>1;; C\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> R (ps', n - m)", "apply(rule exI[where x=ps''])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (C\\<^sub>1;; C\\<^sub>2,\n        ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'' \\<and>\n       m \\<le> n \\<and> R (ps'', n - m)", "apply(rule exI[where x=\"m+m'\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (C\\<^sub>1;; C\\<^sub>2,\n     ps) \\<Rightarrow>\\<^sub>A m + m' \\<Down> ps'' \\<and>\n    m + m' \\<le> n \\<and> R (ps'', n - (m + m'))", "using a b c"], ["proof (prove)\nusing this:\n  (C\\<^sub>1;; C\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m + m' \\<Down> ps''\n  m + m' \\<le> n\n  R (ps'', n - (m + m'))\n\ngoal (1 subgoal):\n 1. (C\\<^sub>1;; C\\<^sub>2,\n     ps) \\<Rightarrow>\\<^sub>A m + m' \\<Down> ps'' \\<and>\n    m + m' \\<le> n \\<and> R (ps'', n - (m + m'))", "by auto"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (C\\<^sub>1;; C\\<^sub>2, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and> R (ps', n - m)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P} C\\<^sub>1;; C\\<^sub>2 { R}\n\ngoal (7 subgoals):\n 1. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 2. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 3. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 4. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 5. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 6. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 7. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (7 subgoals):\n 1. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 2. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 3. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 4. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 5. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 6. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 7. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (While P b C)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           P (s, n) \\<and> lmaps_to_axpr b True s}\n                       C { P \\<and>* $ 1}\n  \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                           case a of\n                           (s, n) \\<Rightarrow>\n                             P (s, n) \\<and> lmaps_to_axpr b True s}\n  C { P \\<and>* $ 1}\n\ngoal (7 subgoals):\n 1. \\<And>P b C.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n   P (s, n) \\<and> lmaps_to_axpr b True s}\n                                     C { P \\<and>* $ 1};\n        \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                                 case a of\n                                 (s, n) \\<Rightarrow>\n                                   P (s, n) \\<and> lmaps_to_axpr b True s}\n        C { P \\<and>* $ 1}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n             P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         $ 1}\n                         WHILE b DO C\n                         { \\<lambda>a.\n                              case a of\n                              (s, n) \\<Rightarrow>\n                                P (s, n) \\<and> lmaps_to_axpr b False s}\n 2. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 3. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 4. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 5. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 6. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 7. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                              P (s, n) \\<and>\n                              vars b \\<subseteq> dom s) \\<and>*\n                          $ 1}\n    WHILE b DO C\n    { \\<lambda>a.\n         case a of\n         (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b False s}", "unfolding hoare3_valid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        $ 1)\n        (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and>\n           (case (ps', n - m) of\n            (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b False s))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        $ (Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and>\n          P (ps', n - m) \\<and>\n          vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "apply (auto simp: dollar_def)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and>\n          P (ps', n - m) \\<and>\n          vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "proof (goal_cases)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and>\n          P (ps', n - m) \\<and>\n          vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "case (1 ps n)"], ["proof (state)\nthis:\n  ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n   (ps, n)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n        (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and>\n          P (ps', n - m) \\<and>\n          vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "from 1"], ["proof (chain)\npicking this:\n  ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n   (ps, n)", "show ?case"], ["proof (prove)\nusing this:\n  ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n   (ps, n)\n\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and>\n       P (ps', n - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "proof(induct n arbitrary: ps rule: less_induct)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x ps.\n       \\<lbrakk>\\<And>y ps.\n                   \\<lbrakk>y < x;\n                    ((\\<lambda>(s, n).\n                         P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n                     (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n                     (ps, y)\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>ps' m.\n  (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n  m \\<le> y \\<and>\n  P (ps', y - m) \\<and>\n  vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps';\n        ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n         (ps, x)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (WHILE b DO C,\n                             ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> x \\<and>\n                            P (ps', x - m) \\<and>\n                            vars b \\<subseteq> dom ps' \\<and>\n                            \\<not> pbval b ps'", "case (less x ps3)"], ["proof (state)\nthis:\n  \\<lbrakk>?y < x;\n   ((\\<lambda>a.\n        case a of\n        (s, n) \\<Rightarrow>\n          P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n    (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n    (?ps, ?y)\\<rbrakk>\n  \\<Longrightarrow> \\<exists>ps' m.\n                       (WHILE b DO C,\n                        ?ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> ?y \\<and>\n                       P (ps', ?y - m) \\<and>\n                       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n  ((\\<lambda>a.\n       case a of\n       (s, n) \\<Rightarrow>\n         P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n   (ps3, x)\n\ngoal (1 subgoal):\n 1. \\<And>x ps.\n       \\<lbrakk>\\<And>y ps.\n                   \\<lbrakk>y < x;\n                    ((\\<lambda>(s, n).\n                         P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n                     (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n                     (ps, y)\\<rbrakk>\n                   \\<Longrightarrow> \\<exists>ps' m.\n  (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n  m \\<le> y \\<and>\n  P (ps', y - m) \\<and>\n  vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps';\n        ((\\<lambda>(s, n). P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n         (\\<lambda>(s, c). s = 0 \\<and> c = Suc 0))\n         (ps, x)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (WHILE b DO C,\n                             ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> x \\<and>\n                            P (ps', x - m) \\<and>\n                            vars b \\<subseteq> dom ps' \\<and>\n                            \\<not> pbval b ps'", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "proof(cases \"pbval b ps3\")"], ["proof (state)\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "case True\n        \\<comment> \\<open>prepare premise to obtain ...\\<close>"], ["proof (state)\nthis:\n  pbval b ps3\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "from less(2)"], ["proof (chain)\npicking this:\n  ((\\<lambda>a.\n       case a of\n       (s, n) \\<Rightarrow>\n         P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n   (ps3, x)", "obtain x' where P: \"P (ps3, x')\" and dom: \"vars b \\<subseteq> dom ps3\"  and Suc: \"x = Suc x'\""], ["proof (prove)\nusing this:\n  ((\\<lambda>a.\n       case a of\n       (s, n) \\<Rightarrow>\n         P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n   (ps3, x)\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>P (ps3, x'); vars b \\<subseteq> dom ps3;\n         x = Suc x'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding sep_conj_def dollar_def"], ["proof (prove)\nusing this:\n  \\<exists>xa y.\n     xa ## y \\<and>\n     (ps3, x) = xa + y \\<and>\n     (case xa of\n      (s, n) \\<Rightarrow> P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>\n     (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0)\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>P (ps3, x'); vars b \\<subseteq> dom ps3;\n         x = Suc x'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  P (ps3, x')\n  vars b \\<subseteq> dom ps3\n  x = Suc x'\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "from P dom True"], ["proof (chain)\npicking this:\n  P (ps3, x')\n  vars b \\<subseteq> dom ps3\n  pbval b ps3", "have \n           g: \"((\\<lambda>(s, n). P (s, n) \\<and> lmaps_to_axpr b True s)) (ps3, x')\""], ["proof (prove)\nusing this:\n  P (ps3, x')\n  vars b \\<subseteq> dom ps3\n  pbval b ps3\n\ngoal (1 subgoal):\n 1. case (ps3, x') of\n    (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b True s", "unfolding dollar_def"], ["proof (prove)\nusing this:\n  P (ps3, x')\n  vars b \\<subseteq> dom ps3\n  pbval b ps3\n\ngoal (1 subgoal):\n 1. case (ps3, x') of\n    (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b True s", "by auto  \n        \\<comment> \\<open>... the loop body from the outer IH\\<close>"], ["proof (state)\nthis:\n  case (ps3, x') of\n  (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b True s\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "from While(2)[unfolded hoare3_valid_def] g"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     (case (ps, n) of\n      (s, n) \\<Rightarrow>\n        P (s, n) \\<and> lmaps_to_axpr b True s) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> (P \\<and>* $ 1) (ps', n - m))\n  case (ps3, x') of\n  (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b True s", "obtain ps3' x'' where C: \"(C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\" and x: \"x'' \\<le> x'\" and P': \"(P \\<and>* $ 1) (ps3', x' - x'')\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     (case (ps, n) of\n      (s, n) \\<Rightarrow>\n        P (s, n) \\<and> lmaps_to_axpr b True s) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> (P \\<and>* $ 1) (ps', n - m))\n  case (ps3, x') of\n  (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b True s\n\ngoal (1 subgoal):\n 1. (\\<And>x'' ps3'.\n        \\<lbrakk>(C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3';\n         x'' \\<le> x'; (P \\<and>* $ 1) (ps3', x' - x'')\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  x'' \\<le> x'\n  (P \\<and>* $ 1) (ps3', x' - x'')\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "then"], ["proof (chain)\npicking this:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  x'' \\<le> x'\n  (P \\<and>* $ 1) (ps3', x' - x'')", "obtain x''' where P'': \"P (ps3', x''')\"  and Suc'': \"x' - x'' = Suc x'''\""], ["proof (prove)\nusing this:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  x'' \\<le> x'\n  (P \\<and>* $ 1) (ps3', x' - x'')\n\ngoal (1 subgoal):\n 1. (\\<And>x'''.\n        \\<lbrakk>P (ps3', x'''); x' - x'' = Suc x'''\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding sep_conj_def dollar_def"], ["proof (prove)\nusing this:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  x'' \\<le> x'\n  \\<exists>x y.\n     x ## y \\<and>\n     (ps3', x' - x'') = x + y \\<and>\n     P x \\<and> (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = 1)\n\ngoal (1 subgoal):\n 1. (\\<And>x'''.\n        \\<lbrakk>P (ps3', x'''); x' - x'' = Suc x'''\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  P (ps3', x''')\n  x' - x'' = Suc x'''\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "from C big_step_t3_post_dom_conv"], ["proof (chain)\npicking this:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  (?c, ?ps) \\<Rightarrow>\\<^sub>A ?t \\<Down> ?ps' \\<Longrightarrow>\n  dom ?ps' = dom ?ps", "have \"dom ps3 = dom ps3'\""], ["proof (prove)\nusing this:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  (?c, ?ps) \\<Rightarrow>\\<^sub>A ?t \\<Down> ?ps' \\<Longrightarrow>\n  dom ?ps' = dom ?ps\n\ngoal (1 subgoal):\n 1. dom ps3 = dom ps3'", "by simp"], ["proof (state)\nthis:\n  dom ps3 = dom ps3'\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "with dom"], ["proof (chain)\npicking this:\n  vars b \\<subseteq> dom ps3\n  dom ps3 = dom ps3'", "have dom': \"vars b \\<subseteq> dom ps3'\""], ["proof (prove)\nusing this:\n  vars b \\<subseteq> dom ps3\n  dom ps3 = dom ps3'\n\ngoal (1 subgoal):\n 1. vars b \\<subseteq> dom ps3'", "by auto\n              \n        \\<comment> \\<open>prepare premises to ...\\<close>"], ["proof (state)\nthis:\n  vars b \\<subseteq> dom ps3'\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "from C big_step_t3_gt0"], ["proof (chain)\npicking this:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  (?C, ?ps) \\<Rightarrow>\\<^sub>A ?x \\<Down> ?ps' \\<Longrightarrow> 0 < ?x", "have gt0: \"x'' > 0\""], ["proof (prove)\nusing this:\n  (C, ps3) \\<Rightarrow>\\<^sub>A x'' \\<Down> ps3'\n  (?C, ?ps) \\<Rightarrow>\\<^sub>A ?x \\<Down> ?ps' \\<Longrightarrow> 0 < ?x\n\ngoal (1 subgoal):\n 1. 0 < x''", "by auto"], ["proof (state)\nthis:\n  0 < x''\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "have \"\\<exists>ps' m. (WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and> m \\<le> (x - (1 + x'')) \\<and> P (ps', (x - (1 + x'')) - m) \\<and> vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x - (1 + x'') \\<and>\n       P (ps', x - (1 + x'') - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "apply(rule less(1))"], ["proof (prove)\ngoal (2 subgoals):\n 1. x - (1 + x'') < x\n 2. ((\\<lambda>a.\n         case a of\n         (s, n) \\<Rightarrow>\n           P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n     (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n     (ps3', x - (1 + x''))", "using gt0 x Suc"], ["proof (prove)\nusing this:\n  0 < x''\n  x'' \\<le> x'\n  x = Suc x'\n\ngoal (2 subgoals):\n 1. x - (1 + x'') < x\n 2. ((\\<lambda>a.\n         case a of\n         (s, n) \\<Rightarrow>\n           P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n     (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n     (ps3', x - (1 + x''))", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. ((\\<lambda>a.\n         case a of\n         (s, n) \\<Rightarrow>\n           P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n     (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n     (ps3', x - (1 + x''))", "using dom' Suc P'"], ["proof (prove)\nusing this:\n  vars b \\<subseteq> dom ps3'\n  x = Suc x'\n  (P \\<and>* $ 1) (ps3', x' - x'')\n\ngoal (1 subgoal):\n 1. ((\\<lambda>a.\n         case a of\n         (s, n) \\<Rightarrow>\n           P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n     (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n     (ps3', x - (1 + x''))", "unfolding dollar_def sep_conj_def"], ["proof (prove)\nusing this:\n  vars b \\<subseteq> dom ps3'\n  x = Suc x'\n  \\<exists>x y.\n     x ## y \\<and>\n     (ps3', x' - x'') = x + y \\<and>\n     P x \\<and> (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = 1)\n\ngoal (1 subgoal):\n 1. \\<exists>xa y.\n       xa ## y \\<and>\n       (ps3', x - (1 + x'')) = xa + y \\<and>\n       (case xa of\n        (s, n) \\<Rightarrow>\n          P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>\n       (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0)", "by force \n        \\<comment> \\<open>... obtain the tail of the While loop from the inner IH\\<close>"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> x - (1 + x'') \\<and>\n     P (ps', x - (1 + x'') - m) \\<and>\n     vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "then"], ["proof (chain)\npicking this:\n  \\<exists>ps' m.\n     (WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> x - (1 + x'') \\<and>\n     P (ps', x - (1 + x'') - m) \\<and>\n     vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "obtain ps3'' m where w: \"((WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps3'')\"\n                    and m'': \"m \\<le> (x - (1 + x''))\" and P'': \"P (ps3'', (x - (1 + x'')) - m)\"\n                    and dom'': \"vars b \\<subseteq> dom ps3''\" and b'': \"\\<not> pbval b ps3''\""], ["proof (prove)\nusing this:\n  \\<exists>ps' m.\n     (WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> x - (1 + x'') \\<and>\n     P (ps', x - (1 + x'') - m) \\<and>\n     vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n\ngoal (1 subgoal):\n 1. (\\<And>m ps3''.\n        \\<lbrakk>(WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps3'';\n         m \\<le> x - (1 + x''); P (ps3'', x - (1 + x'') - m);\n         vars b \\<subseteq> dom ps3''; \\<not> pbval b ps3''\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto\n        \n        \\<comment> \\<open>combine body and tail to one loop unrolling:\\<close>\n        \\<comment> \\<open>- the Bigstep Semantic\\<close>"], ["proof (state)\nthis:\n  (WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A m \\<Down> ps3''\n  m \\<le> x - (1 + x'')\n  P (ps3'', x - (1 + x'') - m)\n  vars b \\<subseteq> dom ps3''\n  \\<not> pbval b ps3''\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "have BigStep: \"(WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A 1 + x'' + m \\<Down> ps3''\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A 1 + x'' + m \\<Down> ps3''", "apply(rule big_step_t_part.WhileTrue)"], ["proof (prove)\ngoal (5 subgoals):\n 1. pbval b ps3\n 2. vars b \\<subseteq> dom ps3\n 3. (C, ps3) \\<Rightarrow>\\<^sub>A ?x \\<Down> ?s2.0\n 4. (WHILE b DO C, ?s2.0) \\<Rightarrow>\\<^sub>A ?y \\<Down> ps3''\n 5. 1 + ?x + ?y = 1 + x'' + m", "apply (fact True)"], ["proof (prove)\ngoal (4 subgoals):\n 1. vars b \\<subseteq> dom ps3\n 2. (C, ps3) \\<Rightarrow>\\<^sub>A ?x \\<Down> ?s2.0\n 3. (WHILE b DO C, ?s2.0) \\<Rightarrow>\\<^sub>A ?y \\<Down> ps3''\n 4. 1 + ?x + ?y = 1 + x'' + m", "apply (fact dom)"], ["proof (prove)\ngoal (3 subgoals):\n 1. (C, ps3) \\<Rightarrow>\\<^sub>A ?x \\<Down> ?s2.0\n 2. (WHILE b DO C, ?s2.0) \\<Rightarrow>\\<^sub>A ?y \\<Down> ps3''\n 3. 1 + ?x + ?y = 1 + x'' + m", "apply (fact C)"], ["proof (prove)\ngoal (2 subgoals):\n 1. (WHILE b DO C, ps3') \\<Rightarrow>\\<^sub>A ?y \\<Down> ps3''\n 2. 1 + x'' + ?y = 1 + x'' + m", "apply (fact w)"], ["proof (prove)\ngoal (1 subgoal):\n 1. 1 + x'' + m = 1 + x'' + m", "by simp            \n        \\<comment> \\<open>- the TimeBound\\<close>"], ["proof (state)\nthis:\n  (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A 1 + x'' + m \\<Down> ps3''\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "have TimeBound: \"1 + x'' + m \\<le> x\""], ["proof (prove)\ngoal (1 subgoal):\n 1. 1 + x'' + m \\<le> x", "using m'' Suc'' Suc"], ["proof (prove)\nusing this:\n  m \\<le> x - (1 + x'')\n  x' - x'' = Suc x'''\n  x = Suc x'\n\ngoal (1 subgoal):\n 1. 1 + x'' + m \\<le> x", "by simp            \n        \\<comment> \\<open>- the invariantPreservation\\<close>"], ["proof (state)\nthis:\n  1 + x'' + m \\<le> x\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "have invariantPreservation: \"P (ps3'', x - (1 + x'' + m))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P (ps3'', x - (1 + x'' + m))", "using P'' m''"], ["proof (prove)\nusing this:\n  P (ps3'', x - (1 + x'') - m)\n  m \\<le> x - (1 + x'')\n\ngoal (1 subgoal):\n 1. P (ps3'', x - (1 + x'' + m))", "by auto \n            \n            \n        \\<comment> \\<open>finally combine BigStep Semantic, TimeBound, invariantPreservation\\<close>"], ["proof (state)\nthis:\n  P (ps3'', x - (1 + x'' + m))\n\ngoal (2 subgoals):\n 1. pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n 2. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "apply(rule exI[where x=\"ps3''\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps3'' \\<and>\n       m \\<le> x \\<and>\n       P (ps3'', x - m) \\<and>\n       vars b \\<subseteq> dom ps3'' \\<and> \\<not> pbval b ps3''", "apply(rule exI[where x=\"1 + x'' + m\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (WHILE b DO C,\n     ps3) \\<Rightarrow>\\<^sub>A 1 + x'' + m \\<Down> ps3'' \\<and>\n    1 + x'' + m \\<le> x \\<and>\n    P (ps3'', x - (1 + x'' + m)) \\<and>\n    vars b \\<subseteq> dom ps3'' \\<and> \\<not> pbval b ps3''", "using BigStep TimeBound invariantPreservation dom'' b''"], ["proof (prove)\nusing this:\n  (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A 1 + x'' + m \\<Down> ps3''\n  1 + x'' + m \\<le> x\n  P (ps3'', x - (1 + x'' + m))\n  vars b \\<subseteq> dom ps3''\n  \\<not> pbval b ps3''\n\ngoal (1 subgoal):\n 1. (WHILE b DO C,\n     ps3) \\<Rightarrow>\\<^sub>A 1 + x'' + m \\<Down> ps3'' \\<and>\n    1 + x'' + m \\<le> x \\<and>\n    P (ps3'', x - (1 + x'' + m)) \\<and>\n    vars b \\<subseteq> dom ps3'' \\<and> \\<not> pbval b ps3''", "by blast"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> x \\<and>\n     P (ps', x - m) \\<and>\n     vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n\ngoal (1 subgoal):\n 1. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "case False"], ["proof (state)\nthis:\n  \\<not> pbval b ps3\n\ngoal (1 subgoal):\n 1. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "from less(2)"], ["proof (chain)\npicking this:\n  ((\\<lambda>a.\n       case a of\n       (s, n) \\<Rightarrow>\n         P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n   (ps3, x)", "obtain x' where P: \"P (ps3, x')\" and dom: \"vars b \\<subseteq> dom ps3\" and Suc: \"x = Suc x'\""], ["proof (prove)\nusing this:\n  ((\\<lambda>a.\n       case a of\n       (s, n) \\<Rightarrow>\n         P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n   (\\<lambda>a. case a of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0))\n   (ps3, x)\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>P (ps3, x'); vars b \\<subseteq> dom ps3;\n         x = Suc x'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding sep_conj_def"], ["proof (prove)\nusing this:\n  \\<exists>xa y.\n     xa ## y \\<and>\n     (ps3, x) = xa + y \\<and>\n     (case xa of\n      (s, n) \\<Rightarrow> P (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>\n     (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0)\n\ngoal (1 subgoal):\n 1. (\\<And>x'.\n        \\<lbrakk>P (ps3, x'); vars b \\<subseteq> dom ps3;\n         x = Suc x'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by force"], ["proof (state)\nthis:\n  P (ps3, x')\n  vars b \\<subseteq> dom ps3\n  x = Suc x'\n\ngoal (1 subgoal):\n 1. \\<not> pbval b ps3 \\<Longrightarrow>\n    \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "show ?thesis"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> x \\<and>\n       P (ps', x - m) \\<and>\n       vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'", "apply(rule exI[where x=ps3])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps3 \\<and>\n       m \\<le> x \\<and>\n       P (ps3, x - m) \\<and>\n       vars b \\<subseteq> dom ps3 \\<and> \\<not> pbval b ps3", "apply(rule exI[where x=\"Suc 0\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> ps3 \\<and>\n    Suc 0 \\<le> x \\<and>\n    P (ps3, x - Suc 0) \\<and>\n    vars b \\<subseteq> dom ps3 \\<and> \\<not> pbval b ps3", "apply safe"], ["proof (prove)\ngoal (5 subgoals):\n 1. (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> ps3\n 2. Suc 0 \\<le> x\n 3. P (ps3, x - Suc 0)\n 4. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 5. pbval b ps3 \\<Longrightarrow> False", "apply (rule big_step_t_part.WhileFalse)"], ["proof (prove)\ngoal (6 subgoals):\n 1. vars b \\<subseteq> dom ps3\n 2. \\<not> pbval b ps3\n 3. Suc 0 \\<le> x\n 4. P (ps3, x - Suc 0)\n 5. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 6. pbval b ps3 \\<Longrightarrow> False", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. vars b \\<subseteq> dom ps3", "using dom"], ["proof (prove)\nusing this:\n  vars b \\<subseteq> dom ps3\n\ngoal (1 subgoal):\n 1. vars b \\<subseteq> dom ps3", "by simp"], ["proof (prove)\ngoal (5 subgoals):\n 1. \\<not> pbval b ps3\n 2. Suc 0 \\<le> x\n 3. P (ps3, x - Suc 0)\n 4. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 5. pbval b ps3 \\<Longrightarrow> False", "apply fact"], ["proof (prove)\ngoal (4 subgoals):\n 1. Suc 0 \\<le> x\n 2. P (ps3, x - Suc 0)\n 3. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 4. pbval b ps3 \\<Longrightarrow> False", "using Suc"], ["proof (prove)\nusing this:\n  x = Suc x'\n\ngoal (4 subgoals):\n 1. Suc 0 \\<le> x\n 2. P (ps3, x - Suc 0)\n 3. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 4. pbval b ps3 \\<Longrightarrow> False", "apply simp"], ["proof (prove)\ngoal (3 subgoals):\n 1. P (ps3, x - Suc 0)\n 2. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 3. pbval b ps3 \\<Longrightarrow> False", "using P Suc"], ["proof (prove)\nusing this:\n  P (ps3, x')\n  x = Suc x'\n\ngoal (3 subgoals):\n 1. P (ps3, x - Suc 0)\n 2. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 3. pbval b ps3 \\<Longrightarrow> False", "apply simp"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 2. pbval b ps3 \\<Longrightarrow> False", "using dom"], ["proof (prove)\nusing this:\n  vars b \\<subseteq> dom ps3\n\ngoal (2 subgoals):\n 1. \\<And>x. x \\<in> vars b \\<Longrightarrow> \\<exists>y. ps3 x = Some y\n 2. pbval b ps3 \\<Longrightarrow> False", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps3; vars b \\<subseteq> dom ps3\\<rbrakk>\n    \\<Longrightarrow> False", "using False"], ["proof (prove)\nusing this:\n  \\<not> pbval b ps3\n\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps3; vars b \\<subseteq> dom ps3\\<rbrakk>\n    \\<Longrightarrow> False", "apply auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> x \\<and>\n     P (ps', x - m) \\<and>\n     vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (WHILE b DO C, ps3) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> x \\<and>\n     P (ps', x - m) \\<and>\n     vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (WHILE b DO C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and>\n     P (ps', n - m) \\<and>\n     vars b \\<subseteq> dom ps' \\<and> \\<not> pbval b ps'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                            P (s, n) \\<and>\n                            vars b \\<subseteq> dom s) \\<and>*\n                        $ 1}\n  WHILE b DO C\n  { \\<lambda>a.\n       case a of\n       (s, n) \\<Rightarrow> P (s, n) \\<and> lmaps_to_axpr b False s}\n\ngoal (6 subgoals):\n 1. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 2. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 3. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 4. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 5. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 6. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (6 subgoals):\n 1. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 2. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 3. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 4. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 5. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 6. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (conseq P c Q P' Q')"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {P} c { Q}\n  P' ?s \\<Longrightarrow> P ?s\n  Q ?s \\<Longrightarrow> Q' ?s\n  \\<Turnstile>\\<^sub>3 {P} c { Q}\n\ngoal (6 subgoals):\n 1. \\<And>P c Q P' Q'.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} c { Q};\n        \\<Turnstile>\\<^sub>3 {P} c { Q};\n        \\<And>s. P' s \\<Longrightarrow> P s;\n        \\<And>s. Q s \\<Longrightarrow> Q' s\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n 2. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 3. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 4. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 5. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 6. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "then"], ["proof (chain)\npicking this:\n  \\<turnstile>\\<^sub>3 {P} c { Q}\n  P' ?s \\<Longrightarrow> P ?s\n  Q ?s \\<Longrightarrow> Q' ?s\n  \\<Turnstile>\\<^sub>3 {P} c { Q}", "show ?case"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {P} c { Q}\n  P' ?s \\<Longrightarrow> P ?s\n  Q ?s \\<Longrightarrow> Q' ?s\n  \\<Turnstile>\\<^sub>3 {P} c { Q}\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P'} c { Q'}", "unfolding hoare3_valid_def"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {P} c { Q}\n  P' ?s \\<Longrightarrow> P ?s\n  Q ?s \\<Longrightarrow> Q' ?s\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P' (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> Q' (ps', n - m))", "by metis"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P'} c { Q'}\n\ngoal (5 subgoals):\n 1. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 2. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 3. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 4. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 5. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (5 subgoals):\n 1. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 2. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 3. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 4. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 5. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (normalize P m C Q n)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}\n  n \\<le> m\n  \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}\n\ngoal (5 subgoals):\n 1. \\<And>P m C Q n.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n 2. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 3. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 4. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 5. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "then"], ["proof (chain)\npicking this:\n  \\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}\n  n \\<le> m\n  \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}", "show ?case"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}\n  n \\<le> m\n  \\<Turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}", "unfolding hoare3_valid_def"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}\n  n \\<le> m\n  \\<forall>ps na.\n     (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m))\n\ngoal (1 subgoal):\n 1. \\<forall>ps na.\n       (P \\<and>* $ (m - n)) (ps, na) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> na \\<and> Q (ps', na - m))", "apply(safe)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "proof (goal_cases)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "case (1 ps N)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n}\n  n \\<le> m\n  \\<forall>ps na.\n     (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m))\n  (P \\<and>* $ (m - n)) (ps, N)\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "have Q2: \"P (ps, N - (m - n))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. P (ps, N - (m - n))", "apply(rule stardiff)"], ["proof (prove)\ngoal (1 subgoal):\n 1. (P \\<and>* $ (m - n)) (ps, N)", "by fact"], ["proof (state)\nthis:\n  P (ps, N - (m - n))\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "have mn: \"m - n \\<le> N\""], ["proof (prove)\ngoal (1 subgoal):\n 1. m - n \\<le> N", "apply(rule stardiff(2))"], ["proof (prove)\ngoal (1 subgoal):\n 1. (?P \\<and>* $ (m - n)) (?ps, N)", "by fact"], ["proof (state)\nthis:\n  m - n \\<le> N\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "have P: \"(P \\<and>* $ m) (ps, N - (m - n) + m)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (P \\<and>* $ m) (ps, N - (m - n) + m)", "unfolding sep_conj_def dollar_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>x y.\n       x ## y \\<and>\n       (ps, N - (m - n) + m) = x + y \\<and>\n       P x \\<and> (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = m)", "apply(rule exI[where x=\"(ps,N - (m - n))\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>y.\n       (ps, N - (m - n)) ## y \\<and>\n       (ps, N - (m - n) + m) = (ps, N - (m - n)) + y \\<and>\n       P (ps, N - (m - n)) \\<and>\n       (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = m)", "apply(rule exI[where x=\"(0,m)\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (ps, N - (m - n)) ## (0, m) \\<and>\n    (ps, N - (m - n) + m) = (ps, N - (m - n)) + (0, m) \\<and>\n    P (ps, N - (m - n)) \\<and>\n    (case (0, m) of (s, c) \\<Rightarrow> s = 0 \\<and> c = m)", "apply(auto simp: sep_disj_prod_def sep_disj_nat_def)"], ["proof (prove)\ngoal (1 subgoal):\n 1. P (ps, N - (m - n))", "by fact"], ["proof (state)\nthis:\n  (P \\<and>* $ m) (ps, N - (m - n) + m)\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "have \" N - (m - n) + m =  N +n\""], ["proof (prove)\ngoal (1 subgoal):\n 1. N - (m - n) + m = N + n", "using normalize(2)"], ["proof (prove)\nusing this:\n  n \\<le> m\n\ngoal (1 subgoal):\n 1. N - (m - n) + m = N + n", "using mn"], ["proof (prove)\nusing this:\n  n \\<le> m\n  m - n \\<le> N\n\ngoal (1 subgoal):\n 1. N - (m - n) + m = N + n", "by auto"], ["proof (state)\nthis:\n  N - (m - n) + m = N + n\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "from P 1(3)"], ["proof (chain)\npicking this:\n  (P \\<and>* $ m) (ps, N - (m - n) + m)\n  \\<forall>ps na.\n     (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m))", "obtain ps' m' where \"(C, ps) \\<Rightarrow>\\<^sub>A m' \\<Down> ps'\" and m': \"m' \\<le> N - (m - n) + m\" and Q: \"(Q \\<and>* $ n) (ps', N - (m - n) + m - m')\""], ["proof (prove)\nusing this:\n  (P \\<and>* $ m) (ps, N - (m - n) + m)\n  \\<forall>ps na.\n     (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m))\n\ngoal (1 subgoal):\n 1. (\\<And>m' ps'.\n        \\<lbrakk>(C, ps) \\<Rightarrow>\\<^sub>A m' \\<Down> ps';\n         m' \\<le> N - (m - n) + m;\n         (Q \\<and>* $ n) (ps', N - (m - n) + m - m')\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (C, ps) \\<Rightarrow>\\<^sub>A m' \\<Down> ps'\n  m' \\<le> N - (m - n) + m\n  (Q \\<and>* $ n) (ps', N - (m - n) + m - m')\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "have Q2: \"Q (ps', (N - (m - n) + m - m') - n)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (ps', N - (m - n) + m - m' - n)", "apply(rule stardiff)"], ["proof (prove)\ngoal (1 subgoal):\n 1. (Q \\<and>* $ n) (ps', N - (m - n) + m - m')", "by fact"], ["proof (state)\nthis:\n  Q (ps', N - (m - n) + m - m' - n)\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "have nm2: \"n \\<le> (N - (m - n) + m - m')\""], ["proof (prove)\ngoal (1 subgoal):\n 1. n \\<le> N - (m - n) + m - m'", "apply(rule stardiff(2))"], ["proof (prove)\ngoal (1 subgoal):\n 1. (?P \\<and>* $ n) (?ps, N - (m - n) + m - m')", "by fact"], ["proof (state)\nthis:\n  n \\<le> N - (m - n) + m - m'\n\ngoal (1 subgoal):\n 1. \\<And>ps na.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P \\<and>* $ m} C { Q \\<and>* $ n};\n        n \\<le> m;\n        \\<forall>ps na.\n           (P \\<and>* $ m) (ps, na) \\<longrightarrow>\n           (\\<exists>ps' m.\n               (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n               m \\<le> na \\<and> (Q \\<and>* $ n) (ps', na - m));\n        (P \\<and>* $ (m - n)) (ps, na)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> na \\<and> Q (ps', na - m)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> N \\<and> Q (ps', N - m)", "apply(rule exI[where x=\"ps'\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> N \\<and> Q (ps', N - m)", "apply(rule exI[where x=\"m'\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m' \\<Down> ps' \\<and>\n    m' \\<le> N \\<and> Q (ps', N - m')", "apply(safe)"], ["proof (prove)\ngoal (3 subgoals):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m' \\<Down> ps'\n 2. m' \\<le> N\n 3. Q (ps', N - m')", "apply fact"], ["proof (prove)\ngoal (2 subgoals):\n 1. m' \\<le> N\n 2. Q (ps', N - m')", "using Q2"], ["proof (prove)\nusing this:\n  Q (ps', N - (m - n) + m - m' - n)\n\ngoal (2 subgoals):\n 1. m' \\<le> N\n 2. Q (ps', N - m')", "using \\<open>N - (m - n) + m = N + n\\<close> m' nm2"], ["proof (prove)\nusing this:\n  Q (ps', N - (m - n) + m - m' - n)\n  N - (m - n) + m = N + n\n  m' \\<le> N - (m - n) + m\n  n \\<le> N - (m - n) + m - m'\n\ngoal (2 subgoals):\n 1. m' \\<le> N\n 2. Q (ps', N - m')", "apply linarith"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (ps', N - m')", "using Q2 \\<open>N - (m - n) + m = N + n\\<close>"], ["proof (prove)\nusing this:\n  Q (ps', N - (m - n) + m - m' - n)\n  N - (m - n) + m = N + n\n\ngoal (1 subgoal):\n 1. Q (ps', N - m')", "by auto"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> N \\<and> Q (ps', N - m)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P \\<and>* $ (m - n)} C { Q}\n\ngoal (4 subgoals):\n 1. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 2. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 3. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 4. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (4 subgoals):\n 1. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 2. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 3. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 4. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (constancy P C Q R)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {P} C { Q}\n  ?ps = ?ps' on UNIV - lvars C \\<Longrightarrow> R ?ps = R ?ps'\n  \\<Turnstile>\\<^sub>3 {P} C { Q}\n\ngoal (4 subgoals):\n 1. \\<And>P C Q R.\n       \\<lbrakk>\\<turnstile>\\<^sub>3 {P} C { Q};\n        \\<Turnstile>\\<^sub>3 {P} C { Q};\n        \\<And>ps ps'.\n           ps = ps' on UNIV - lvars C \\<Longrightarrow>\n           R ps = R ps'\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n            case a of (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n                         C { \\<lambda>a.\n                                case a of\n                                (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n 2. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 3. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 4. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "from constancy(3)"], ["proof (chain)\npicking this:\n  \\<Turnstile>\\<^sub>3 {P} C { Q}", "show ?case"], ["proof (prove)\nusing this:\n  \\<Turnstile>\\<^sub>3 {P} C { Q}\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                             case a of\n                             (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n    C { \\<lambda>a. case a of (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}", "unfolding hoare3_valid_def"], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       (case (ps, n) of\n        (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and>\n           (case (ps', n - m) of\n            (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps))", "apply safe"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>\\<forall>ps n.\n                   P (ps, n) \\<longrightarrow>\n                   (\\<exists>ps' m.\n                       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> n \\<and> Q (ps', n - m));\n        P (ps, n); R ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "proof (goal_cases)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>\\<forall>ps n.\n                   P (ps, n) \\<longrightarrow>\n                   (\\<exists>ps' m.\n                       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> n \\<and> Q (ps', n - m));\n        P (ps, n); R ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "case (1 ps n)"], ["proof (state)\nthis:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (ps, n)\n  R ps\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>\\<forall>ps n.\n                   P (ps, n) \\<longrightarrow>\n                   (\\<exists>ps' m.\n                       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> n \\<and> Q (ps', n - m));\n        P (ps, n); R ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "then"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (ps, n)\n  R ps", "obtain ps' m where C: \"(C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\" and m: \"m \\<le> n\" and Q: \"Q (ps', n - m)\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q (ps', n - m))\n  P (ps, n)\n  R ps\n\ngoal (1 subgoal):\n 1. (\\<And>m ps'.\n        \\<lbrakk>(C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'; m \\<le> n;\n         Q (ps', n - m)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n\n  Q (ps', n - m)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>\\<forall>ps n.\n                   P (ps, n) \\<longrightarrow>\n                   (\\<exists>ps' m.\n                       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> n \\<and> Q (ps', n - m));\n        P (ps, n); R ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "from C big_step_t3_same"], ["proof (chain)\npicking this:\n  (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  (?C, ?ps) \\<Rightarrow>\\<^sub>A ?m \\<Down> ?ps' \\<Longrightarrow>\n  ?ps = ?ps' on UNIV - lvars ?C", "have \"ps = ps' on UNIV - lvars C\""], ["proof (prove)\nusing this:\n  (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  (?C, ?ps) \\<Rightarrow>\\<^sub>A ?m \\<Down> ?ps' \\<Longrightarrow>\n  ?ps = ?ps' on UNIV - lvars ?C\n\ngoal (1 subgoal):\n 1. ps = ps' on UNIV - lvars C", "by auto"], ["proof (state)\nthis:\n  ps = ps' on UNIV - lvars C\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>\\<forall>ps n.\n                   P (ps, n) \\<longrightarrow>\n                   (\\<exists>ps' m.\n                       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> n \\<and> Q (ps', n - m));\n        P (ps, n); R ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "with constancy(2) 1(3)"], ["proof (chain)\npicking this:\n  ?ps = ?ps' on UNIV - lvars C \\<Longrightarrow> R ?ps = R ?ps'\n  R ps\n  ps = ps' on UNIV - lvars C", "have \"R ps'\""], ["proof (prove)\nusing this:\n  ?ps = ?ps' on UNIV - lvars C \\<Longrightarrow> R ?ps = R ?ps'\n  R ps\n  ps = ps' on UNIV - lvars C\n\ngoal (1 subgoal):\n 1. R ps'", "by auto"], ["proof (state)\nthis:\n  R ps'\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       \\<lbrakk>\\<forall>ps n.\n                   P (ps, n) \\<longrightarrow>\n                   (\\<exists>ps' m.\n                       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> n \\<and> Q (ps', n - m));\n        P (ps, n); R ps\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps' m.\n                            (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                            m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "apply(rule exI[where x=ps'])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "apply(rule exI[where x=m])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n    m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'", "apply(safe)"], ["proof (prove)\ngoal (4 subgoals):\n 1. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n 2. m \\<le> n\n 3. Q (ps', n - m)\n 4. R ps'", "apply fact+"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and> Q (ps', n - m) \\<and> R ps'\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {\\<lambda>a.\n                           case a of\n                           (ps, n) \\<Rightarrow> P (ps, n) \\<and> R ps}\n  C { \\<lambda>a. case a of (ps, n) \\<Rightarrow> Q (ps, n) \\<and> R ps}\n\ngoal (3 subgoals):\n 1. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 2. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 3. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 2. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 3. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (Assign''' x ds v)"], ["proof (state)\nthis:\n  \n\ngoal (3 subgoals):\n 1. \\<And>x ds v.\n       \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n       { x \\<hookrightarrow> v}\n 2. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 3. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "then"], ["proof (chain)\npicking this:", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n    { x \\<hookrightarrow> v}", "unfolding hoare3_valid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       ($ 1 \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> (x \\<hookrightarrow> v) (ps', n - m))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> (x \\<hookrightarrow> v) (ps', n - m)", "subgoal for ps n"], ["proof (prove)\ngoal (1 subgoal):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    \\<exists>ps' m.\n       (x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> (x \\<hookrightarrow> v) (ps', n - m)", "apply(rule exI[where x=\"ps(x\\<mapsto>v)\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    \\<exists>m.\n       (x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps(x \\<mapsto>\n       v) \\<and>\n       m \\<le> n \\<and> (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - m)", "apply(rule exI[where x=\"Suc 0\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x ::= N v, ps) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> ps(x \\<mapsto>\n    v) \\<and>\n    Suc 0 \\<le> n \\<and>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "apply safe"], ["proof (prove)\ngoal (3 subgoals):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x ::= N v, ps) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> ps(x \\<mapsto> v)\n 2. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    Suc 0 \\<le> n\n 3. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "apply(rule big_step_t_part.Assign)"], ["proof (prove)\ngoal (5 subgoals):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    vars (N v) \\<union> {x} \\<subseteq> dom ps\n 2. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    paval (N v) ps = ?v6\n 3. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    ps(x \\<mapsto> v) = ps(x \\<mapsto> ?v6)\n 4. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    Suc 0 \\<le> n\n 5. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "apply (auto)"], ["proof (prove)\ngoal (3 subgoals):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    \\<exists>y. ps x = Some y\n 2. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    Suc 0 \\<le> n\n 3. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    \\<exists>y. ps x = Some y", "apply(subst (asm) separate_othogonal_commuted')"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>ps n. $ (Suc 0) (ps, n) \\<Longrightarrow> ps = 0\n 2. \\<And>ps n. (x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow> n = 0\n 3. $ (Suc 0) (0, snd (ps, n)) \\<and>\n    (x \\<hookrightarrow> ds) (fst (ps, n), 0) \\<Longrightarrow>\n    \\<exists>y. ps x = Some y", "by(auto simp: dollar_def pointsto_def)"], ["proof (prove)\ngoal (2 subgoals):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    Suc 0 \\<le> n\n 2. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    Suc 0 \\<le> n", "apply(subst (asm) separate_othogonal_commuted')"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>ps n. $ (Suc 0) (ps, n) \\<Longrightarrow> ps = 0\n 2. \\<And>ps n. (x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow> n = 0\n 3. $ (Suc 0) (0, snd (ps, n)) \\<and>\n    (x \\<hookrightarrow> ds) (fst (ps, n), 0) \\<Longrightarrow>\n    Suc 0 \\<le> n", "by(auto simp: dollar_def pointsto_def)"], ["proof (prove)\ngoal (1 subgoal):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. ($ (Suc 0) \\<and>* x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "apply(subst (asm) separate_othogonal_commuted')"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>ps n. $ (Suc 0) (ps, n) \\<Longrightarrow> ps = 0\n 2. \\<And>ps n. (x \\<hookrightarrow> ds) (ps, n) \\<Longrightarrow> n = 0\n 3. $ (Suc 0) (0, snd (ps, n)) \\<and>\n    (x \\<hookrightarrow> ds) (fst (ps, n), 0) \\<Longrightarrow>\n    (x \\<hookrightarrow> v) (ps(x \\<mapsto> v), n - Suc 0)", "by(auto simp: dollar_def pointsto_def)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {$ 1 \\<and>* x \\<hookrightarrow> ds} x ::= N v\n  { x \\<hookrightarrow> v}\n\ngoal (2 subgoals):\n 1. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 2. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 2. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (Assign'''' P a v x Q')"], ["proof (state)\nthis:\n  symeval P a v\n  \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'}\n  \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\n\ngoal (2 subgoals):\n 1. \\<And>P a v x Q'.\n       \\<lbrakk>symeval P a v; \\<turnstile>\\<^sub>3 {P} x ::= N v { Q'};\n        \\<Turnstile>\\<^sub>3 {P} x ::= N v { Q'}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n 2. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}", "unfolding hoare3_valid_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       P (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> Q' (ps', n - m))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q' (ps', n - m)", "proof (goal_cases)"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q' (ps', n - m)", "case (1 ps n)"], ["proof (state)\nthis:\n  P (ps, n)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q' (ps', n - m)", "with Assign''''(3)[unfolded hoare3_valid_def]"], ["proof (chain)\npicking this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q' (ps', n - m))\n  P (ps, n)", "obtain ps' m\n        where \"(x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\" \"m \\<le> n\" \"Q' (ps', n - m)\""], ["proof (prove)\nusing this:\n  \\<forall>ps n.\n     P (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> Q' (ps', n - m))\n  P (ps, n)\n\ngoal (1 subgoal):\n 1. (\\<And>m ps'.\n        \\<lbrakk>(x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps';\n         m \\<le> n; Q' (ps', n - m)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by metis"], ["proof (state)\nthis:\n  (x ::= N v, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n  m \\<le> n\n  Q' (ps', n - m)\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q' (ps', n - m)", "from 1(1) Assign''''(1)[unfolded symeval_def]"], ["proof (chain)\npicking this:\n  P (ps, n)\n  \\<forall>s n. P (s, n) \\<longrightarrow> paval' a s = Some v", "have \"paval' a ps = Some v\""], ["proof (prove)\nusing this:\n  P (ps, n)\n  \\<forall>s n. P (s, n) \\<longrightarrow> paval' a s = Some v\n\ngoal (1 subgoal):\n 1. paval' a ps = Some v", "by auto"], ["proof (state)\nthis:\n  paval' a ps = Some v\n\ngoal (1 subgoal):\n 1. \\<And>ps n.\n       P (ps, n) \\<Longrightarrow>\n       \\<exists>ps' m.\n          (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n          m \\<le> n \\<and> Q' (ps', n - m)", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>ps' m.\n       (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q' (ps', n - m)", "apply(rule exI[where x=ps'])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m.\n       (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n       m \\<le> n \\<and> Q' (ps', n - m)", "apply(rule exI[where x=m])"], ["proof (prove)\ngoal (1 subgoal):\n 1. (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n    m \\<le> n \\<and> Q' (ps', n - m)", "apply safe"], ["proof (prove)\ngoal (3 subgoals):\n 1. (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n 2. m \\<le> n\n 3. Q' (ps', n - m)", "apply(rule avalDirekt3_correct)"], ["proof (prove)\ngoal (4 subgoals):\n 1. (x ::= N ?v6, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'\n 2. paval' a ps = Some ?v6\n 3. m \\<le> n\n 4. Q' (ps', n - m)", "apply fact+"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<exists>ps' m.\n     (x ::= a, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n     m \\<le> n \\<and> Q' (ps', n - m)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {P} x ::= a { Q'}\n\ngoal (1 subgoal):\n 1. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "case (pureI P Q c R)"], ["proof (state)\nthis:\n  P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R}\n  P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\n\ngoal (1 subgoal):\n 1. \\<And>P Q c R.\n       \\<lbrakk>P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R};\n        P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\\<rbrakk>\n       \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "then"], ["proof (chain)\npicking this:\n  P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R}\n  P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}", "show ?case"], ["proof (prove)\nusing this:\n  P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R}\n  P \\<Longrightarrow> \\<Turnstile>\\<^sub>3 {Q} c { R}\n\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}", "unfolding hoare3_valid_def"], ["proof (prove)\nusing this:\n  P \\<Longrightarrow> \\<turnstile>\\<^sub>3 {Q} c { R}\n  P \\<Longrightarrow>\n  \\<forall>ps n.\n     Q (ps, n) \\<longrightarrow>\n     (\\<exists>ps' m.\n         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n         m \\<le> n \\<and> R (ps', n - m))\n\ngoal (1 subgoal):\n 1. \\<forall>ps n.\n       (\\<up> P \\<and>* Q) (ps, n) \\<longrightarrow>\n       (\\<exists>ps' m.\n           (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n           m \\<le> n \\<and> R (ps', n - m))", "by auto"], ["proof (state)\nthis:\n  \\<Turnstile>\\<^sub>3 {\\<up> P \\<and>* Q} c { R}\n\ngoal:\nNo subgoals!", "qed"], ["", "subsection \\<open>Completeness\\<close>"], ["", "definition wp3 :: \"com \\<Rightarrow> assn2 \\<Rightarrow> assn2\" (\"wp\\<^sub>3\") where \n\"wp\\<^sub>3 c Q  =  (\\<lambda>(s,n). \\<exists>t m. n\\<ge>m \\<and> (c,s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and> Q (t,n-m))\""], ["", "lemma wp3_SKIP[simp]: \"wp\\<^sub>3 SKIP Q = (Q ** $1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 SKIP Q = (Q \\<and>* $ 1)", "apply (auto intro!: ext simp: wp3_def)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b.\n       \\<lbrakk>Suc 0 \\<le> b; Q (a, b - Suc 0)\\<rbrakk>\n       \\<Longrightarrow> (Q \\<and>* $ (Suc 0)) (a, b)\n 2. \\<And>a b.\n       (Q \\<and>* $ (Suc 0)) (a, b) \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> b \\<and>\n          (SKIP, a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and> Q (t, b - m)", "unfolding sep_conj_def dollar_def sep_disj_prod_def sep_disj_nat_def"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b.\n       \\<lbrakk>Suc 0 \\<le> b; Q (a, b - Suc 0)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>x y.\n                            (fst x ## fst y \\<and> True) \\<and>\n                            (a, b) = x + y \\<and>\n                            Q x \\<and>\n                            (case y of\n                             (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0)\n 2. \\<And>a b.\n       \\<exists>x y.\n          (fst x ## fst y \\<and> True) \\<and>\n          (a, b) = x + y \\<and>\n          Q x \\<and>\n          (case y of\n           (s, c) \\<Rightarrow> s = 0 \\<and> c = Suc 0) \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> b \\<and>\n          (SKIP, a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and> Q (t, b - m)", "apply auto"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b.\n       \\<lbrakk>Suc 0 \\<le> b; Q (a, b - Suc 0)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ba. b = Suc ba \\<and> Q (a, ba)\n 2. \\<And>a ba.\n       Q (a, ba) \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> Suc ba \\<and>\n          (SKIP, a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n          Q (t, Suc ba - m)", "apply force"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a ba.\n       Q (a, ba) \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> Suc ba \\<and>\n          (SKIP, a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n          Q (t, Suc ba - m)", "subgoal for t n"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (t, n) \\<Longrightarrow>\n    \\<exists>ta m.\n       m \\<le> Suc n \\<and>\n       (SKIP, t) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and> Q (ta, Suc n - m)", "apply(rule exI[where x=t])"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (t, n) \\<Longrightarrow>\n    \\<exists>m\\<le>Suc n.\n       (SKIP, t) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and> Q (t, Suc n - m)", "apply(rule exI[where x=\"Suc 0\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (t, n) \\<Longrightarrow>\n    Suc 0 \\<le> Suc n \\<and>\n    (SKIP, t) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> t \\<and>\n    Q (t, Suc n - Suc 0)", "using big_step_t_part.Skip"], ["proof (prove)\nusing this:\n  (SKIP, ?s) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> ?s\n\ngoal (1 subgoal):\n 1. Q (t, n) \\<Longrightarrow>\n    Suc 0 \\<le> Suc n \\<and>\n    (SKIP, t) \\<Rightarrow>\\<^sub>A Suc 0 \\<Down> t \\<and>\n    Q (t, Suc n - Suc 0)", "by auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma wp3_Assign[simp]: \"wp\\<^sub>3 (x ::= e) Q = ((\\<lambda>(ps,t). vars e \\<union> {x} \\<subseteq> dom ps \\<and> Q (ps(x \\<mapsto> paval e ps),t)) ** $1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (x ::= e) Q =\n    ((\\<lambda>(ps, t).\n         vars e \\<union> {x} \\<subseteq> dom ps \\<and>\n         Q (ps(x \\<mapsto> paval e ps), t)) \\<and>*\n     $ 1)", "apply (auto intro!: ext simp: wp3_def )"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b y.\n       \\<lbrakk>Suc 0 \\<le> b; Q (a(x \\<mapsto> paval e a), b - Suc 0);\n        vars e \\<subseteq> dom a; a x = Some y\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(ps, t).\n                              x \\<in> dom ps \\<and>\n                              vars e \\<subseteq> dom ps \\<and>\n                              Q (ps(x \\<mapsto> paval e ps), t)) \\<and>*\n                          $ (Suc 0))\n                          (a, b)\n 2. \\<And>a b.\n       ((\\<lambda>(ps, t).\n            x \\<in> dom ps \\<and>\n            vars e \\<subseteq> dom ps \\<and>\n            Q (ps(x \\<mapsto> paval e ps), t)) \\<and>*\n        $ (Suc 0))\n        (a, b) \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> b \\<and>\n          (x ::= e, a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and> Q (t, b - m)", "unfolding sep_conj_def"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b y.\n       \\<lbrakk>Suc 0 \\<le> b; Q (a(x \\<mapsto> paval e a), b - Suc 0);\n        vars e \\<subseteq> dom a; a x = Some y\\<rbrakk>\n       \\<Longrightarrow> \\<exists>xa y.\n                            xa ## y \\<and>\n                            (a, b) = xa + y \\<and>\n                            (case xa of\n                             (ps, t) \\<Rightarrow>\n                               x \\<in> dom ps \\<and>\n                               vars e \\<subseteq> dom ps \\<and>\n                               Q (ps(x \\<mapsto> paval e ps), t)) \\<and>\n                            $ (Suc 0) y\n 2. \\<And>a b.\n       \\<exists>xa y.\n          xa ## y \\<and>\n          (a, b) = xa + y \\<and>\n          (case xa of\n           (ps, t) \\<Rightarrow>\n             x \\<in> dom ps \\<and>\n             vars e \\<subseteq> dom ps \\<and>\n             Q (ps(x \\<mapsto> paval e ps), t)) \\<and>\n          $ (Suc 0) y \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> b \\<and>\n          (x ::= e, a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and> Q (t, b - m)", "apply (auto simp: sep_disj_prod_def sep_disj_nat_def dollar_def)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b y.\n       \\<lbrakk>Suc 0 \\<le> b; Q (a(x \\<mapsto> paval e a), b - Suc 0);\n        vars e \\<subseteq> dom a; a x = Some y\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ba.\n                            b = Suc ba \\<and>\n                            x \\<in> dom a \\<and>\n                            Q (a(x \\<mapsto> paval e a), ba)\n 2. \\<And>a ba y.\n       \\<lbrakk>a x = Some y; vars e \\<subseteq> dom a;\n        Q (a(x \\<mapsto> paval e a), ba)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> Suc ba \\<and>\n                            (x ::= e,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, Suc ba - m)", "apply force"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a ba y.\n       \\<lbrakk>a x = Some y; vars e \\<subseteq> dom a;\n        Q (a(x \\<mapsto> paval e a), ba)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> Suc ba \\<and>\n                            (x ::= e,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, Suc ba - m)", "by fastforce"], ["", "lemma wpt_Seq[simp]: \"wp\\<^sub>3 (c\\<^sub>1;;c\\<^sub>2) Q = wp\\<^sub>3 c\\<^sub>1 (wp\\<^sub>3 c\\<^sub>2 Q)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (c\\<^sub>1;; c\\<^sub>2) Q =\n    wp\\<^sub>3 c\\<^sub>1 (wp\\<^sub>3 c\\<^sub>2 Q)", "apply (auto simp: wp3_def fun_eq_iff )"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b t x s2 y.\n       \\<lbrakk>x + y \\<le> b; Q (t, b - (x + y));\n        (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> s2;\n        (c\\<^sub>2, s2) \\<Rightarrow>\\<^sub>A y \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> b \\<and>\n                            (c\\<^sub>1,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            (\\<exists>ta ma.\n                                ma \\<le> b - m \\<and>\n                                (c\\<^sub>2,\n                                 t) \\<Rightarrow>\\<^sub>A ma \\<Down> ta \\<and>\n                                Q (ta, b - (m + ma)))\n 2. \\<And>a b t m ta ma.\n       \\<lbrakk>m \\<le> b; (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n        ma \\<le> b - m; (c\\<^sub>2, t) \\<Rightarrow>\\<^sub>A ma \\<Down> ta;\n        Q (ta, b - (m + ma))\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> b \\<and>\n                            (c\\<^sub>1;; c\\<^sub>2,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, b - m)", "subgoal for a b t m1 s2 m2"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 + m2 \\<le> b; Q (t, b - (m1 + m2));\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m1 \\<Down> s2;\n     (c\\<^sub>2, s2) \\<Rightarrow>\\<^sub>A m2 \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t m.\n                         m \\<le> b \\<and>\n                         (c\\<^sub>1,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         (\\<exists>ta ma.\n                             ma \\<le> b - m \\<and>\n                             (c\\<^sub>2,\n                              t) \\<Rightarrow>\\<^sub>A ma \\<Down> ta \\<and>\n                             Q (ta, b - (m + ma)))", "apply(rule exI[where x=\"s2\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 + m2 \\<le> b; Q (t, b - (m1 + m2));\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m1 \\<Down> s2;\n     (c\\<^sub>2, s2) \\<Rightarrow>\\<^sub>A m2 \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m\\<le>b.\n                         (c\\<^sub>1,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> s2 \\<and>\n                         (\\<exists>t ma.\n                             ma \\<le> b - m \\<and>\n                             (c\\<^sub>2,\n                              s2) \\<Rightarrow>\\<^sub>A ma \\<Down> t \\<and>\n                             Q (t, b - (m + ma)))", "apply(rule exI[where x=\"m1\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 + m2 \\<le> b; Q (t, b - (m1 + m2));\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m1 \\<Down> s2;\n     (c\\<^sub>2, s2) \\<Rightarrow>\\<^sub>A m2 \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> m1 \\<le> b \\<and>\n                      (c\\<^sub>1,\n                       a) \\<Rightarrow>\\<^sub>A m1 \\<Down> s2 \\<and>\n                      (\\<exists>t m.\n                          m \\<le> b - m1 \\<and>\n                          (c\\<^sub>2,\n                           s2) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                          Q (t, b - (m1 + m)))", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 + m2 \\<le> b; Q (t, b - (m1 + m2));\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m1 \\<Down> s2;\n     (c\\<^sub>2, s2) \\<Rightarrow>\\<^sub>A m2 \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t m.\n                         m \\<le> b - m1 \\<and>\n                         (c\\<^sub>2,\n                          s2) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, b - (m1 + m))", "apply(rule exI[where x=\"t\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 + m2 \\<le> b; Q (t, b - (m1 + m2));\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m1 \\<Down> s2;\n     (c\\<^sub>2, s2) \\<Rightarrow>\\<^sub>A m2 \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m\\<le>b - m1.\n                         (c\\<^sub>2,\n                          s2) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, b - (m1 + m))", "apply(rule exI[where x=\"m2\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 + m2 \\<le> b; Q (t, b - (m1 + m2));\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m1 \\<Down> s2;\n     (c\\<^sub>2, s2) \\<Rightarrow>\\<^sub>A m2 \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> m2 \\<le> b - m1 \\<and>\n                      (c\\<^sub>2,\n                       s2) \\<Rightarrow>\\<^sub>A m2 \\<Down> t \\<and>\n                      Q (t, b - (m1 + m2))", "apply simp"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a b t m ta ma.\n       \\<lbrakk>m \\<le> b; (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n        ma \\<le> b - m; (c\\<^sub>2, t) \\<Rightarrow>\\<^sub>A ma \\<Down> ta;\n        Q (ta, b - (m + ma))\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> b \\<and>\n                            (c\\<^sub>1;; c\\<^sub>2,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, b - m)", "subgoal for s m t' m1 t m2"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 \\<le> m; (c\\<^sub>1, s) \\<Rightarrow>\\<^sub>A m1 \\<Down> t';\n     m2 \\<le> m - m1; (c\\<^sub>2, t') \\<Rightarrow>\\<^sub>A m2 \\<Down> t;\n     Q (t, m - (m1 + m2))\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t ma.\n                         ma \\<le> m \\<and>\n                         (c\\<^sub>1;; c\\<^sub>2,\n                          s) \\<Rightarrow>\\<^sub>A ma \\<Down> t \\<and>\n                         Q (t, m - ma)", "apply(rule exI[where x=\"t\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 \\<le> m; (c\\<^sub>1, s) \\<Rightarrow>\\<^sub>A m1 \\<Down> t';\n     m2 \\<le> m - m1; (c\\<^sub>2, t') \\<Rightarrow>\\<^sub>A m2 \\<Down> t;\n     Q (t, m - (m1 + m2))\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ma\\<le>m.\n                         (c\\<^sub>1;; c\\<^sub>2,\n                          s) \\<Rightarrow>\\<^sub>A ma \\<Down> t \\<and>\n                         Q (t, m - ma)", "apply(rule exI[where x=\"m1+m2\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m1 \\<le> m; (c\\<^sub>1, s) \\<Rightarrow>\\<^sub>A m1 \\<Down> t';\n     m2 \\<le> m - m1; (c\\<^sub>2, t') \\<Rightarrow>\\<^sub>A m2 \\<Down> t;\n     Q (t, m - (m1 + m2))\\<rbrakk>\n    \\<Longrightarrow> m1 + m2 \\<le> m \\<and>\n                      (c\\<^sub>1;; c\\<^sub>2,\n                       s) \\<Rightarrow>\\<^sub>A m1 + m2 \\<Down> t \\<and>\n                      Q (t, m - (m1 + m2))", "apply (auto simp: big_step_t_part.Seq)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma wp3_If[simp]:\n \"wp\\<^sub>3 (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2) Q = ((\\<lambda>(ps,t). vars b \\<subseteq> dom ps \\<and> wp\\<^sub>3 (if pbval b ps then c\\<^sub>1 else c\\<^sub>2) Q (ps,t)) ** $1)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2) Q =\n    ((\\<lambda>(ps, t).\n         vars b \\<subseteq> dom ps \\<and>\n         wp\\<^sub>3 (if pbval b ps then c\\<^sub>1 else c\\<^sub>2) Q\n          (ps, t)) \\<and>*\n     $ 1)", "apply (auto simp: wp3_def fun_eq_iff)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>a ba t x.\n       \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n        dom t = dom a; pbval b a;\n        (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(ps, t).\n                              vars b \\<subseteq> dom ps \\<and>\n                              (\\<exists>ta m.\n                                  m \\<le> t \\<and>\n                                  (if pbval b ps then c\\<^sub>1\n                                   else c\\<^sub>2,\n                                   ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                                  Q (ta, t - m))) \\<and>*\n                          $ (Suc 0))\n                          (a, ba)\n 2. \\<And>a ba t x.\n       \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n        dom t = dom a; \\<not> pbval b a;\n        (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(ps, t).\n                              vars b \\<subseteq> dom ps \\<and>\n                              (\\<exists>ta m.\n                                  m \\<le> t \\<and>\n                                  (if pbval b ps then c\\<^sub>1\n                                   else c\\<^sub>2,\n                                   ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                                  Q (ta, t - m))) \\<and>*\n                          $ (Suc 0))\n                          (a, ba)\n 3. \\<And>a ba.\n       ((\\<lambda>(ps, t).\n            vars b \\<subseteq> dom ps \\<and>\n            (\\<exists>ta m.\n                m \\<le> t \\<and>\n                (if pbval b ps then c\\<^sub>1 else c\\<^sub>2,\n                 ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                Q (ta, t - m))) \\<and>*\n        $ (Suc 0))\n        (a, ba) \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> ba \\<and>\n          (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n           a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n          Q (t, ba - m)", "unfolding sep_conj_def"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>a ba t x.\n       \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n        dom t = dom a; pbval b a;\n        (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> \\<exists>x y.\n                            x ## y \\<and>\n                            (a, ba) = x + y \\<and>\n                            (case x of\n                             (ps, t) \\<Rightarrow>\n                               vars b \\<subseteq> dom ps \\<and>\n                               (\\<exists>ta m.\n                                   m \\<le> t \\<and>\n                                   (if pbval b ps then c\\<^sub>1\n                                    else c\\<^sub>2,\n                                    ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                                   Q (ta, t - m))) \\<and>\n                            $ (Suc 0) y\n 2. \\<And>a ba t x.\n       \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n        dom t = dom a; \\<not> pbval b a;\n        (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> \\<exists>x y.\n                            x ## y \\<and>\n                            (a, ba) = x + y \\<and>\n                            (case x of\n                             (ps, t) \\<Rightarrow>\n                               vars b \\<subseteq> dom ps \\<and>\n                               (\\<exists>ta m.\n                                   m \\<le> t \\<and>\n                                   (if pbval b ps then c\\<^sub>1\n                                    else c\\<^sub>2,\n                                    ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                                   Q (ta, t - m))) \\<and>\n                            $ (Suc 0) y\n 3. \\<And>a ba.\n       \\<exists>x y.\n          x ## y \\<and>\n          (a, ba) = x + y \\<and>\n          (case x of\n           (ps, t) \\<Rightarrow>\n             vars b \\<subseteq> dom ps \\<and>\n             (\\<exists>ta m.\n                 m \\<le> t \\<and>\n                 (if pbval b ps then c\\<^sub>1 else c\\<^sub>2,\n                  ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                 Q (ta, t - m))) \\<and>\n          $ (Suc 0) y \\<Longrightarrow>\n       \\<exists>t m.\n          m \\<le> ba \\<and>\n          (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n           a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n          Q (t, ba - m)", "apply (auto simp: sep_disj_prod_def sep_disj_nat_def dollar_def)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<And>a ba t x.\n       \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n        dom t = dom a; pbval b a;\n        (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> \\<exists>b.\n                            ba = Suc b \\<and>\n                            (\\<exists>t m.\n                                m \\<le> b \\<and>\n                                (c\\<^sub>1,\n                                 a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                                Q (t, b - m))\n 2. \\<And>a ba t x.\n       \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n        dom t = dom a; \\<not> pbval b a;\n        (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> \\<exists>b.\n                            ba = Suc b \\<and>\n                            (\\<exists>t m.\n                                m \\<le> b \\<and>\n                                (c\\<^sub>2,\n                                 a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                                Q (t, b - m))\n 3. \\<And>a ba t m.\n       \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n        (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n         a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n        Q (t, ba - m)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> Suc ba \\<and>\n                            (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, Suc ba - m)", "subgoal for a ba t x"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; pbval b a;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>b.\n                         ba = Suc b \\<and>\n                         (\\<exists>t m.\n                             m \\<le> b \\<and>\n                             (c\\<^sub>1,\n                              a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                             Q (t, b - m))", "apply(rule exI[where x=\"ba - 1\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; pbval b a;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> ba = Suc (ba - 1) \\<and>\n                      (\\<exists>t m.\n                          m \\<le> ba - 1 \\<and>\n                          (c\\<^sub>1,\n                           a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                          Q (t, ba - 1 - m))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; pbval b a;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t m.\n                         m \\<le> ba - Suc 0 \\<and>\n                         (c\\<^sub>1,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, ba - Suc m)", "apply(rule exI[where x=t])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; pbval b a;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m\\<le>ba - Suc 0.\n                         (c\\<^sub>1,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, ba - Suc m)", "apply(rule exI[where x=x])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; pbval b a;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> x \\<le> ba - Suc 0 \\<and>\n                      (c\\<^sub>1,\n                       a) \\<Rightarrow>\\<^sub>A x \\<Down> t \\<and>\n                      Q (t, ba - Suc x)", "apply auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a ba t x.\n       \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n        dom t = dom a; \\<not> pbval b a;\n        (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n       \\<Longrightarrow> \\<exists>b.\n                            ba = Suc b \\<and>\n                            (\\<exists>t m.\n                                m \\<le> b \\<and>\n                                (c\\<^sub>2,\n                                 a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                                Q (t, b - m))\n 2. \\<And>a ba t m.\n       \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n        (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n         a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n        Q (t, ba - m)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> Suc ba \\<and>\n                            (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, Suc ba - m)", "subgoal for a ba t x"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; \\<not> pbval b a;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>b.\n                         ba = Suc b \\<and>\n                         (\\<exists>t m.\n                             m \\<le> b \\<and>\n                             (c\\<^sub>2,\n                              a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                             Q (t, b - m))", "apply(rule exI[where x=\"ba - 1\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; \\<not> pbval b a;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> ba = Suc (ba - 1) \\<and>\n                      (\\<exists>t m.\n                          m \\<le> ba - 1 \\<and>\n                          (c\\<^sub>2,\n                           a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                          Q (t, ba - 1 - m))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; \\<not> pbval b a;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t m.\n                         m \\<le> ba - Suc 0 \\<and>\n                         (c\\<^sub>2,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, ba - Suc m)", "apply(rule exI[where x=t])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; \\<not> pbval b a;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m\\<le>ba - Suc 0.\n                         (c\\<^sub>2,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, ba - Suc m)", "apply(rule exI[where x=x])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>Suc x \\<le> ba; Q (t, ba - Suc x); vars b \\<subseteq> dom a;\n     dom t = dom a; \\<not> pbval b a;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A x \\<Down> t\\<rbrakk>\n    \\<Longrightarrow> x \\<le> ba - Suc 0 \\<and>\n                      (c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A x \\<Down> t \\<and>\n                      Q (t, ba - Suc x)", "apply auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a ba t m.\n       \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n        (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n         a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n        Q (t, ba - m)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> Suc ba \\<and>\n                            (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                             a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, Suc ba - m)", "subgoal for a ba t m"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t m.\n                         m \\<le> Suc ba \\<and>\n                         (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, Suc ba - m)", "apply(rule exI[where x=t])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m\\<le>Suc ba.\n                         (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                          a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, Suc ba - m)", "apply(rule exI[where x=\"Suc m\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m)\\<rbrakk>\n    \\<Longrightarrow> Suc m \\<le> Suc ba \\<and>\n                      (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t \\<and>\n                      Q (t, Suc ba - Suc m)", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m)\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t", "apply(cases \"pbval b a\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m); pbval b a\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t\n 2. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m); \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m); pbval b a\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t", "apply(subst big_step_t_part.IfTrue)"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> vars b \\<subseteq> dom a\n 2. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> dom t = dom a\n 3. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> pbval b a\n 4. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A ?x2 \\<Down> t\n 5. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> Suc m = ?x2 + 1\n 6. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> True", "using big_step_t3_post_dom_conv"], ["proof (prove)\nusing this:\n  (?c, ?ps) \\<Rightarrow>\\<^sub>A ?t \\<Down> ?ps' \\<Longrightarrow>\n  dom ?ps' = dom ?ps\n\ngoal (6 subgoals):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> vars b \\<subseteq> dom a\n 2. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> dom t = dom a\n 3. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> pbval b a\n 4. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A ?x2 \\<Down> t\n 5. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> Suc m = ?x2 + 1\n 6. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>1, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     pbval b a\\<rbrakk>\n    \\<Longrightarrow> True", "by auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m); \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (if pbval b a then c\\<^sub>1 else c\\<^sub>2,\n      a) \\<Rightarrow>\\<^sub>A m \\<Down> t;\n     Q (t, ba - m); \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> (IF b THEN c\\<^sub>1 ELSE c\\<^sub>2,\n                       a) \\<Rightarrow>\\<^sub>A Suc m \\<Down> t", "apply(subst big_step_t_part.IfFalse)"], ["proof (prove)\ngoal (6 subgoals):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> vars b \\<subseteq> dom a\n 2. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> dom t = dom a\n 3. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> \\<not> pbval b a\n 4. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A ?x2 \\<Down> t\n 5. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> Suc m = ?x2 + 1\n 6. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> True", "using big_step_t3_post_dom_conv"], ["proof (prove)\nusing this:\n  (?c, ?ps) \\<Rightarrow>\\<^sub>A ?t \\<Down> ?ps' \\<Longrightarrow>\n  dom ?ps' = dom ?ps\n\ngoal (6 subgoals):\n 1. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> vars b \\<subseteq> dom a\n 2. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> dom t = dom a\n 3. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> \\<not> pbval b a\n 4. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A ?x2 \\<Down> t\n 5. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> Suc m = ?x2 + 1\n 6. \\<lbrakk>vars b \\<subseteq> dom a; m \\<le> ba;\n     (c\\<^sub>2, a) \\<Rightarrow>\\<^sub>A m \\<Down> t; Q (t, ba - m);\n     \\<not> pbval b a\\<rbrakk>\n    \\<Longrightarrow> True", "by auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma sFTrue: assumes \"pbval b ps\" \"vars b \\<subseteq> dom ps\"\n  shows \"wp\\<^sub>3 (WHILE b DO c) Q (ps, n) = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) (ps, n)\"\n    (is \"?wp = (?I \\<and>* $ 1) _\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "assume \"wp\\<^sub>3 (WHILE b DO c) Q (ps, n)\""], ["proof (state)\nthis:\n  wp\\<^sub>3 (WHILE b DO c) Q (ps, n)\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from this[unfolded wp3_def]"], ["proof (chain)\npicking this:\n  case (ps, n) of\n  (s, n) \\<Rightarrow>\n    \\<exists>t m.\n       m \\<le> n \\<and>\n       (WHILE b DO c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n       Q (t, n - m)", "obtain ps'' tt where tn: \"tt \\<le> n\" and w1: \"(WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A tt \\<Down> ps''\" and Q: \"Q (ps'', n - tt) \""], ["proof (prove)\nusing this:\n  case (ps, n) of\n  (s, n) \\<Rightarrow>\n    \\<exists>t m.\n       m \\<le> n \\<and>\n       (WHILE b DO c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n       Q (t, n - m)\n\ngoal (1 subgoal):\n 1. (\\<And>tt ps''.\n        \\<lbrakk>tt \\<le> n;\n         (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A tt \\<Down> ps'';\n         Q (ps'', n - tt)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  tt \\<le> n\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A tt \\<Down> ps''\n  Q (ps'', n - tt)\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "with assms"], ["proof (chain)\npicking this:\n  pbval b ps\n  vars b \\<subseteq> dom ps\n  tt \\<le> n\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A tt \\<Down> ps''\n  Q (ps'', n - tt)", "obtain t t' ps' where w2: \"(WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps''\" and c: \"(c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\" and tt: \"tt=1+t+t'\""], ["proof (prove)\nusing this:\n  pbval b ps\n  vars b \\<subseteq> dom ps\n  tt \\<le> n\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A tt \\<Down> ps''\n  Q (ps'', n - tt)\n\ngoal (1 subgoal):\n 1. (\\<And>ps' t' t.\n        \\<lbrakk>(WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps'';\n         (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps';\n         tt = 1 + t + t'\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  (WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps''\n  (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\n  tt = 1 + t + t'\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from tn"], ["proof (chain)\npicking this:\n  tt \\<le> n", "obtain k where n: \"n=tt+k\""], ["proof (prove)\nusing this:\n  tt \\<le> n\n\ngoal (1 subgoal):\n 1. (\\<And>k. n = tt + k \\<Longrightarrow> thesis) \\<Longrightarrow> thesis", "using le_Suc_ex"], ["proof (prove)\nusing this:\n  tt \\<le> n\n  ?k \\<le> ?l \\<Longrightarrow> \\<exists>n. ?l = ?k + n\n\ngoal (1 subgoal):\n 1. (\\<And>k. n = tt + k \\<Longrightarrow> thesis) \\<Longrightarrow> thesis", "by blast"], ["proof (state)\nthis:\n  n = tt + k\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from assms"], ["proof (chain)\npicking this:\n  pbval b ps\n  vars b \\<subseteq> dom ps", "show \"(?I \\<and>* $ 1) (ps,n)\""], ["proof (prove)\nusing this:\n  pbval b ps\n  vars b \\<subseteq> dom ps\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "unfolding sep_conj_def dollar_def  wp3_def"], ["proof (prove)\nusing this:\n  pbval b ps\n  vars b \\<subseteq> dom ps\n\ngoal (1 subgoal):\n 1. \\<exists>x y.\n       x ## y \\<and>\n       (ps, n) = x + y \\<and>\n       (case x of\n        (ps, n) \\<Rightarrow>\n          vars b \\<subseteq> dom ps \\<and>\n          (if pbval b ps\n           then case (ps, n) of\n                (s, n) \\<Rightarrow>\n                  \\<exists>t m.\n                     m \\<le> n \\<and>\n                     (c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                     (case (t, n - m) of\n                      (s, n) \\<Rightarrow>\n                        \\<exists>t m.\n                           m \\<le> n \\<and>\n                           (WHILE b DO c,\n                            s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                           Q (t, n - m))\n           else Q (ps, n))) \\<and>\n       (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = 1)", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ba.\n                         n = Suc ba \\<and>\n                         (\\<exists>t m.\n                             m \\<le> ba \\<and>\n                             (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                             (\\<exists>ta ma.\n                                 ma \\<le> ba - m \\<and>\n                                 (WHILE b DO c,\n                                  t) \\<Rightarrow>\\<^sub>A ma \\<Down> ta \\<and>\n                                 Q (ta, ba - (m + ma))))", "apply(rule exI[where x=\"t+t'+k\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> n = Suc (t + t' + k) \\<and>\n                      (\\<exists>ta m.\n                          m \\<le> t + t' + k \\<and>\n                          (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                          (\\<exists>tb ma.\n                              ma \\<le> t + t' + k - m \\<and>\n                              (WHILE b DO c,\n                               ta) \\<Rightarrow>\\<^sub>A ma \\<Down> tb \\<and>\n                              Q (tb, t + t' + k - (m + ma))))", "apply safe"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> n = Suc (t + t' + k)\n 2. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ta m.\n                         m \\<le> t + t' + k \\<and>\n                         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                         (\\<exists>tb ma.\n                             ma \\<le> t + t' + k - m \\<and>\n                             (WHILE b DO c,\n                              ta) \\<Rightarrow>\\<^sub>A ma \\<Down> tb \\<and>\n                             Q (tb, t + t' + k - (m + ma)))", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> n = Suc (t + t' + k)", "using n tt"], ["proof (prove)\nusing this:\n  n = tt + k\n  tt = 1 + t + t'\n\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> n = Suc (t + t' + k)", "by auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ta m.\n                         m \\<le> t + t' + k \\<and>\n                         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                         (\\<exists>tb ma.\n                             ma \\<le> t + t' + k - m \\<and>\n                             (WHILE b DO c,\n                              ta) \\<Rightarrow>\\<^sub>A ma \\<Down> tb \\<and>\n                             Q (tb, t + t' + k - (m + ma)))", "apply(rule exI[where x=\"ps'\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m\\<le>t + t' + k.\n                         (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                         (\\<exists>ta ma.\n                             ma \\<le> t + t' + k - m \\<and>\n                             (WHILE b DO c,\n                              ps') \\<Rightarrow>\\<^sub>A ma \\<Down> ta \\<and>\n                             Q (ta, t + t' + k - (m + ma)))", "apply(rule exI[where x=\"t\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> t \\<le> t + t' + k \\<and>\n                      (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n                      (\\<exists>ta m.\n                          m \\<le> t + t' + k - t \\<and>\n                          (WHILE b DO c,\n                           ps') \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                          Q (ta, t + t' + k - (t + m)))", "using c"], ["proof (prove)\nusing this:\n  (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\n\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps\\<rbrakk>\n    \\<Longrightarrow> t \\<le> t + t' + k \\<and>\n                      (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps' \\<and>\n                      (\\<exists>ta m.\n                          m \\<le> t + t' + k - t \\<and>\n                          (WHILE b DO c,\n                           ps') \\<Rightarrow>\\<^sub>A m \\<Down> ta \\<and>\n                          Q (ta, t + t' + k - (t + m)))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps;\n     (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t m.\n                         m \\<le> t' + k \\<and>\n                         (WHILE b DO c,\n                          ps') \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                         Q (t, t' + k - m)", "apply(rule exI[where x=\"ps''\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps;\n     (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m\\<le>t' + k.\n                         (WHILE b DO c,\n                          ps') \\<Rightarrow>\\<^sub>A m \\<Down> ps'' \\<and>\n                         Q (ps'', t' + k - m)", "apply(rule exI[where x=\"t'\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps;\n     (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\\<rbrakk>\n    \\<Longrightarrow> t' \\<le> t' + k \\<and>\n                      (WHILE b DO c,\n                       ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps'' \\<and>\n                      Q (ps'', t' + k - t')", "using w2 Q n"], ["proof (prove)\nusing this:\n  (WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps''\n  Q (ps'', n - tt)\n  n = tt + k\n\ngoal (1 subgoal):\n 1. \\<lbrakk>pbval b ps; vars b \\<subseteq> dom ps;\n     (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\\<rbrakk>\n    \\<Longrightarrow> t' \\<le> t' + k \\<and>\n                      (WHILE b DO c,\n                       ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps'' \\<and>\n                      Q (ps'', t' + k - t')", "by auto"], ["proof (state)\nthis:\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "assume \"(?I \\<and>* $ 1) (ps,n)\""], ["proof (state)\nthis:\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "with assms"], ["proof (chain)\npicking this:\n  pbval b ps\n  vars b \\<subseteq> dom ps\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)", "have Q: \"wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n-1)\" and n: \"n\\<ge>1\""], ["proof (prove)\nusing this:\n  pbval b ps\n  vars b \\<subseteq> dom ps\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)\n\ngoal (1 subgoal):\n 1. wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n - 1) &&& 1 \\<le> n", "unfolding dollar_def sep_conj_def"], ["proof (prove)\nusing this:\n  pbval b ps\n  vars b \\<subseteq> dom ps\n  \\<exists>x y.\n     x ## y \\<and>\n     (ps, n) = x + y \\<and>\n     (case x of\n      (ps, n) \\<Rightarrow>\n        vars b \\<subseteq> dom ps \\<and>\n        (if pbval b ps\n         then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n         else Q (ps, n))) \\<and>\n     (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = 1)\n\ngoal (1 subgoal):\n 1. wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n - 1) &&& 1 \\<le> n", "by auto"], ["proof (state)\nthis:\n  wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n - 1)\n  1 \\<le> n\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "then"], ["proof (chain)\npicking this:\n  wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n - 1)\n  1 \\<le> n", "obtain t ps' t' ps'' where t: \"t \\<le> n - 1\"  \n        and c: \"(c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\" and  t': \"t' \\<le> (n-1) - t\" and w: \"(WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps''\" \n        and Q: \"Q (ps'', ((n-1) - t) - t')\""], ["proof (prove)\nusing this:\n  wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n - 1)\n  1 \\<le> n\n\ngoal (1 subgoal):\n 1. (\\<And>t ps' t' ps''.\n        \\<lbrakk>t \\<le> n - 1; (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps';\n         t' \\<le> n - 1 - t;\n         (WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps'';\n         Q (ps'', n - 1 - t - t')\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "unfolding wp3_def"], ["proof (prove)\nusing this:\n  case (ps, n - 1) of\n  (s, n) \\<Rightarrow>\n    \\<exists>t m.\n       m \\<le> n \\<and>\n       (c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n       (case (t, n - m) of\n        (s, n) \\<Rightarrow>\n          \\<exists>t m.\n             m \\<le> n \\<and>\n             (WHILE b DO c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n             Q (t, n - m))\n  1 \\<le> n\n\ngoal (1 subgoal):\n 1. (\\<And>t ps' t' ps''.\n        \\<lbrakk>t \\<le> n - 1; (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps';\n         t' \\<le> n - 1 - t;\n         (WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps'';\n         Q (ps'', n - 1 - t - t')\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by auto"], ["proof (state)\nthis:\n  t \\<le> n - 1\n  (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\n  t' \\<le> n - 1 - t\n  (WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps''\n  Q (ps'', n - 1 - t - t')\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "show \"?wp\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "unfolding wp3_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. case (ps, n) of\n    (s, n) \\<Rightarrow>\n      \\<exists>t m.\n         m \\<le> n \\<and>\n         (WHILE b DO c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n         Q (t, n - m)", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>t m.\n       m \\<le> n \\<and>\n       (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n       Q (t, n - m)", "apply(rule exI[where x=\"ps''\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m\\<le>n.\n       (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps'' \\<and>\n       Q (ps'', n - m)", "apply(rule exI[where x=\"1+t+t'\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. 1 + t + t' \\<le> n \\<and>\n    (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 + t + t' \\<Down> ps'' \\<and>\n    Q (ps'', n - (1 + t + t'))", "apply safe"], ["proof (prove)\ngoal (3 subgoals):\n 1. 1 + t + t' \\<le> n\n 2. (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 + t + t' \\<Down> ps''\n 3. Q (ps'', n - (1 + t + t'))", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. 1 + t + t' \\<le> n", "using t t' n"], ["proof (prove)\nusing this:\n  t \\<le> n - 1\n  t' \\<le> n - 1 - t\n  1 \\<le> n\n\ngoal (1 subgoal):\n 1. 1 + t + t' \\<le> n", "by simp"], ["proof (prove)\ngoal (2 subgoals):\n 1. (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 + t + t' \\<Down> ps''\n 2. Q (ps'', n - (1 + t + t'))", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 + t + t' \\<Down> ps''", "using c w assms"], ["proof (prove)\nusing this:\n  (c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\n  (WHILE b DO c, ps') \\<Rightarrow>\\<^sub>A t' \\<Down> ps''\n  pbval b ps\n  vars b \\<subseteq> dom ps\n\ngoal (1 subgoal):\n 1. (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 + t + t' \\<Down> ps''", "by auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (ps'', n - (1 + t + t'))", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. Q (ps'', n - (1 + t + t'))", "using Q t t' n"], ["proof (prove)\nusing this:\n  Q (ps'', n - 1 - t - t')\n  t \\<le> n - 1\n  t' \\<le> n - 1 - t\n  1 \\<le> n\n\ngoal (1 subgoal):\n 1. Q (ps'', n - (1 + t + t'))", "by simp"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  wp\\<^sub>3 (WHILE b DO c) Q (ps, n)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sFFalse: assumes \"~ pbval b ps\" \"vars b \\<subseteq> dom ps\"\n  shows \"wp\\<^sub>3 (WHILE b DO c) Q (ps, n) = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) (ps, n)\"\n    (is \"?wp = (?I \\<and>* $ 1) _\")"], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "proof"], ["proof (state)\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "assume \"wp\\<^sub>3 (WHILE b DO c) Q (ps, n)\""], ["proof (state)\nthis:\n  wp\\<^sub>3 (WHILE b DO c) Q (ps, n)\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from this[unfolded wp3_def]"], ["proof (chain)\npicking this:\n  case (ps, n) of\n  (s, n) \\<Rightarrow>\n    \\<exists>t m.\n       m \\<le> n \\<and>\n       (WHILE b DO c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n       Q (t, n - m)", "obtain ps' t where tn: \"t \\<le> n\" and w1: \"(WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\" and Q: \"Q (ps', n - t) \""], ["proof (prove)\nusing this:\n  case (ps, n) of\n  (s, n) \\<Rightarrow>\n    \\<exists>t m.\n       m \\<le> n \\<and>\n       (WHILE b DO c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n       Q (t, n - m)\n\ngoal (1 subgoal):\n 1. (\\<And>t ps'.\n        \\<lbrakk>t \\<le> n;\n         (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps';\n         Q (ps', n - t)\\<rbrakk>\n        \\<Longrightarrow> thesis) \\<Longrightarrow>\n    thesis", "by blast"], ["proof (state)\nthis:\n  t \\<le> n\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\n  Q (ps', n - t)\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from assms"], ["proof (chain)\npicking this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps", "have w2: \"(WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps\""], ["proof (prove)\nusing this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n\ngoal (1 subgoal):\n 1. (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps", "by auto"], ["proof (state)\nthis:\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from w1 w2 big_step_t_determ2"], ["proof (chain)\npicking this:\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps\n  \\<lbrakk>(?c, ?s) \\<Rightarrow> ?p \\<Down> ?t;\n   (?c, ?s) \\<Rightarrow> ?q \\<Down> ?u\\<rbrakk>\n  \\<Longrightarrow> ?u = ?t \\<and> ?p = ?q", "have t1: \"t=1\" and pps: \"ps=ps'\""], ["proof (prove)\nusing this:\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A t \\<Down> ps'\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps\n  \\<lbrakk>(?c, ?s) \\<Rightarrow> ?p \\<Down> ?t;\n   (?c, ?s) \\<Rightarrow> ?q \\<Down> ?u\\<rbrakk>\n  \\<Longrightarrow> ?u = ?t \\<and> ?p = ?q\n\ngoal (1 subgoal):\n 1. t = 1 &&& ps = ps'", "by auto"], ["proof (state)\nthis:\n  t = 1\n  ps = ps'\n\ngoal (2 subgoals):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from assms"], ["proof (chain)\npicking this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps", "show \"(?I \\<and>* $ 1) (ps,n)\""], ["proof (prove)\nusing this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "unfolding sep_conj_def dollar_def"], ["proof (prove)\nusing this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n\ngoal (1 subgoal):\n 1. \\<exists>x y.\n       x ## y \\<and>\n       (ps, n) = x + y \\<and>\n       (case x of\n        (ps, n) \\<Rightarrow>\n          vars b \\<subseteq> dom ps \\<and>\n          (if pbval b ps\n           then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n           else Q (ps, n))) \\<and>\n       (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = 1)", "using t1 tn Q pps"], ["proof (prove)\nusing this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n  t = 1\n  t \\<le> n\n  Q (ps', n - t)\n  ps = ps'\n\ngoal (1 subgoal):\n 1. \\<exists>x y.\n       x ## y \\<and>\n       (ps, n) = x + y \\<and>\n       (case x of\n        (ps, n) \\<Rightarrow>\n          vars b \\<subseteq> dom ps \\<and>\n          (if pbval b ps\n           then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n           else Q (ps, n))) \\<and>\n       (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = 1)", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<not> pbval b ps'; vars b \\<subseteq> dom ps'; t = Suc 0;\n     Suc 0 \\<le> n; Q (ps', n - Suc 0); ps = ps'\\<rbrakk>\n    \\<Longrightarrow> \\<exists>b. n = Suc b \\<and> Q (ps', b)", "apply(rule exI[where x=\"n-1\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<not> pbval b ps'; vars b \\<subseteq> dom ps'; t = Suc 0;\n     Suc 0 \\<le> n; Q (ps', n - Suc 0); ps = ps'\\<rbrakk>\n    \\<Longrightarrow> n = Suc (n - 1) \\<and> Q (ps', n - 1)", "by auto"], ["proof (state)\nthis:\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "assume \"(?I \\<and>* $ 1) (ps,n)\""], ["proof (state)\nthis:\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "with assms"], ["proof (chain)\npicking this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)", "have Q: \"Q(ps,n-1)\" \"n\\<ge>1\""], ["proof (prove)\nusing this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n  ((\\<lambda>(ps, n).\n       vars b \\<subseteq> dom ps \\<and>\n       (if pbval b ps\n        then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n        else Q (ps, n))) \\<and>*\n   $ 1)\n   (ps, n)\n\ngoal (1 subgoal):\n 1. Q (ps, n - 1) &&& 1 \\<le> n", "unfolding dollar_def sep_conj_def"], ["proof (prove)\nusing this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n  \\<exists>x y.\n     x ## y \\<and>\n     (ps, n) = x + y \\<and>\n     (case x of\n      (ps, n) \\<Rightarrow>\n        vars b \\<subseteq> dom ps \\<and>\n        (if pbval b ps\n         then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n         else Q (ps, n))) \\<and>\n     (case y of (s, c) \\<Rightarrow> s = 0 \\<and> c = 1)\n\ngoal (1 subgoal):\n 1. Q (ps, n - 1) &&& 1 \\<le> n", "by auto"], ["proof (state)\nthis:\n  Q (ps, n - 1)\n  1 \\<le> n\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "from assms"], ["proof (chain)\npicking this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps", "have w2: \"(WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps\""], ["proof (prove)\nusing this:\n  \\<not> pbval b ps\n  vars b \\<subseteq> dom ps\n\ngoal (1 subgoal):\n 1. (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps", "by auto"], ["proof (state)\nthis:\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n) \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "show \"?wp\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n)", "unfolding wp3_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. case (ps, n) of\n    (s, n) \\<Rightarrow>\n      \\<exists>t m.\n         m \\<le> n \\<and>\n         (WHILE b DO c, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n         Q (t, n - m)", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>t m.\n       m \\<le> n \\<and>\n       (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n       Q (t, n - m)", "apply(rule exI[where x=ps])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<exists>m\\<le>n.\n       (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps \\<and>\n       Q (ps, n - m)", "apply(rule exI[where x=1])"], ["proof (prove)\ngoal (1 subgoal):\n 1. 1 \\<le> n \\<and>\n    (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps \\<and>\n    Q (ps, n - 1)", "using Q w2"], ["proof (prove)\nusing this:\n  Q (ps, n - 1)\n  1 \\<le> n\n  (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps\n\ngoal (1 subgoal):\n 1. 1 \\<le> n \\<and>\n    (WHILE b DO c, ps) \\<Rightarrow>\\<^sub>A 1 \\<Down> ps \\<and>\n    Q (ps, n - 1)", "by auto"], ["proof (state)\nthis:\n  wp\\<^sub>3 (WHILE b DO c) Q (ps, n)\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sF': \"wp\\<^sub>3 (WHILE b DO c) Q (ps,n) = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) (ps,n)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "apply(cases \"vars b \\<subseteq> dom ps\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. vars b \\<subseteq> dom ps \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)\n 2. \\<not> vars b \\<subseteq> dom ps \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. vars b \\<subseteq> dom ps \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "apply(cases \"pbval b ps\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<lbrakk>vars b \\<subseteq> dom ps; pbval b ps\\<rbrakk>\n    \\<Longrightarrow> wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n                      ((\\<lambda>(ps, n).\n                           vars b \\<subseteq> dom ps \\<and>\n                           (if pbval b ps\n                            then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)\n                                  (ps, n)\n                            else Q (ps, n))) \\<and>*\n                       $ 1)\n                       (ps, n)\n 2. \\<lbrakk>vars b \\<subseteq> dom ps; \\<not> pbval b ps\\<rbrakk>\n    \\<Longrightarrow> wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n                      ((\\<lambda>(ps, n).\n                           vars b \\<subseteq> dom ps \\<and>\n                           (if pbval b ps\n                            then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)\n                                  (ps, n)\n                            else Q (ps, n))) \\<and>*\n                       $ 1)\n                       (ps, n)", "using sFTrue sFFalse"], ["proof (prove)\nusing this:\n  \\<lbrakk>pbval ?b ?ps; vars ?b \\<subseteq> dom ?ps\\<rbrakk>\n  \\<Longrightarrow> wp\\<^sub>3 (WHILE ?b DO ?c) ?Q (?ps, ?n) =\n                    ((\\<lambda>(ps, n).\n                         vars ?b \\<subseteq> dom ps \\<and>\n                         (if pbval ?b ps\n                          then wp\\<^sub>3 ?c\n                                (wp\\<^sub>3 (WHILE ?b DO ?c) ?Q) (ps, n)\n                          else ?Q (ps, n))) \\<and>*\n                     $ 1)\n                     (?ps, ?n)\n  \\<lbrakk>\\<not> pbval ?b ?ps; vars ?b \\<subseteq> dom ?ps\\<rbrakk>\n  \\<Longrightarrow> wp\\<^sub>3 (WHILE ?b DO ?c) ?Q (?ps, ?n) =\n                    ((\\<lambda>(ps, n).\n                         vars ?b \\<subseteq> dom ps \\<and>\n                         (if pbval ?b ps\n                          then wp\\<^sub>3 ?c\n                                (wp\\<^sub>3 (WHILE ?b DO ?c) ?Q) (ps, n)\n                          else ?Q (ps, n))) \\<and>*\n                     $ 1)\n                     (?ps, ?n)\n\ngoal (2 subgoals):\n 1. \\<lbrakk>vars b \\<subseteq> dom ps; pbval b ps\\<rbrakk>\n    \\<Longrightarrow> wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n                      ((\\<lambda>(ps, n).\n                           vars b \\<subseteq> dom ps \\<and>\n                           (if pbval b ps\n                            then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)\n                                  (ps, n)\n                            else Q (ps, n))) \\<and>*\n                       $ 1)\n                       (ps, n)\n 2. \\<lbrakk>vars b \\<subseteq> dom ps; \\<not> pbval b ps\\<rbrakk>\n    \\<Longrightarrow> wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n                      ((\\<lambda>(ps, n).\n                           vars b \\<subseteq> dom ps \\<and>\n                           (if pbval b ps\n                            then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)\n                                  (ps, n)\n                            else Q (ps, n))) \\<and>*\n                       $ 1)\n                       (ps, n)", "by auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> vars b \\<subseteq> dom ps \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<not> vars b \\<subseteq> dom ps \\<Longrightarrow>\n    wp\\<^sub>3 (WHILE b DO c) Q (ps, n) =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     (ps, n)", "by (auto simp add: dollar_def wp3_def sep_conj_def)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma sF: \"wp\\<^sub>3 (WHILE b DO c) Q s = ((\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n))) \\<and>* $ 1) s\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q s =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     s", "using sF'"], ["proof (prove)\nusing this:\n  wp\\<^sub>3 (WHILE ?b DO ?c) ?Q (?ps, ?n) =\n  ((\\<lambda>(ps, n).\n       vars ?b \\<subseteq> dom ps \\<and>\n       (if pbval ?b ps\n        then wp\\<^sub>3 ?c (wp\\<^sub>3 (WHILE ?b DO ?c) ?Q) (ps, n)\n        else ?Q (ps, n))) \\<and>*\n   $ 1)\n   (?ps, ?n)\n\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q s =\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     s", "by (metis (mono_tags, lifting) prod.case_eq_if prod.collapse sep_conj_impl1)"], ["", "lemma assumes \"\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c {Q}\"\n  shows WhileWpisPre: \"\\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "define I where  \"I \\<equiv> (\\<lambda>(ps, n). vars b \\<subseteq> dom ps \\<and> (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n) else Q (ps, n)))\""], ["proof (state)\nthis:\n  I \\<equiv>\n  \\<lambda>(ps, n).\n     vars b \\<subseteq> dom ps \\<and>\n     (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n      else Q (ps, n))\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "from assms[where Q=\"(wp\\<^sub>3 (WHILE b DO c) Q)\"]"], ["proof (chain)\npicking this:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)} c\n                       { wp\\<^sub>3 (WHILE b DO c) Q}", "have \n    c: \"\\<turnstile>\\<^sub>3 {wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)} c {(wp\\<^sub>3 (WHILE b DO c) Q)}\""], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)} c\n                       { wp\\<^sub>3 (WHILE b DO c) Q}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)} c\n                         { wp\\<^sub>3 (WHILE b DO c) Q}", "."], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q)} c\n                       { wp\\<^sub>3 (WHILE b DO c) Q}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "have c': \"\\<turnstile>\\<^sub>3 { (\\<lambda>(s,n). I (s,n) \\<and> lmaps_to_axpr b True s) } c { I  ** $1 }\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                             I (s, n) \\<and> lmaps_to_axpr b True s}\n                         c { I \\<and>* $ 1}", "apply(rule conseq)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<turnstile>\\<^sub>3 {?P} c { ?Q}\n 2. \\<And>s.\n       case s of\n       (s, n) \\<Rightarrow>\n         I (s, n) \\<and> lmaps_to_axpr b True s \\<Longrightarrow>\n       ?P s\n 3. \\<And>s. ?Q s \\<Longrightarrow> (I \\<and>* $ 1) s", "apply(rule c)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s.\n       case s of\n       (s, n) \\<Rightarrow>\n         I (s, n) \\<and> lmaps_to_axpr b True s \\<Longrightarrow>\n       wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) s\n 2. \\<And>s.\n       wp\\<^sub>3 (WHILE b DO c) Q s \\<Longrightarrow> (I \\<and>* $ 1) s", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. case s_ of\n    (s, n) \\<Rightarrow>\n      I (s, n) \\<and> lmaps_to_axpr b True s \\<Longrightarrow>\n    wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) s_", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>s_ = (x, y); I (x, y); vars b \\<subseteq> dom x;\n        pbval b x\\<rbrakk>\n       \\<Longrightarrow> wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (x, y)", "unfolding I_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x y.\n       \\<lbrakk>s_ = (x, y);\n        case (x, y) of\n        (ps, n) \\<Rightarrow>\n          vars b \\<subseteq> dom ps \\<and>\n          (if pbval b ps\n           then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n           else Q (ps, n));\n        vars b \\<subseteq> dom x; pbval b x\\<rbrakk>\n       \\<Longrightarrow> wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (x, y)", "by auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s.\n       wp\\<^sub>3 (WHILE b DO c) Q s \\<Longrightarrow> (I \\<and>* $ 1) s", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q s_ \\<Longrightarrow> (I \\<and>* $ 1) s_", "unfolding I_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q s_ \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     s_", "using sF"], ["proof (prove)\nusing this:\n  wp\\<^sub>3 (WHILE ?b DO ?c) ?Q ?s =\n  ((\\<lambda>(ps, n).\n       vars ?b \\<subseteq> dom ps \\<and>\n       (if pbval ?b ps\n        then wp\\<^sub>3 ?c (wp\\<^sub>3 (WHILE ?b DO ?c) ?Q) (ps, n)\n        else ?Q (ps, n))) \\<and>*\n   $ 1)\n   ?s\n\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q s_ \\<Longrightarrow>\n    ((\\<lambda>(ps, n).\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>*\n     $ 1)\n     s_", "by auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           I (s, n) \\<and> lmaps_to_axpr b True s}\n                       c { I \\<and>* $ 1}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "from hoareT3.While[where P=\"I\"] c'"], ["proof (chain)\npicking this:\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           I (s, n) \\<and> lmaps_to_axpr ?b True s}\n                       ?C { I \\<and>* $ 1} \\<Longrightarrow>\n  \\<turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                            I (s, n) \\<and>\n                            vars ?b \\<subseteq> dom s) \\<and>*\n                        $ 1}\n                       WHILE ?b DO ?C\n                       { \\<lambda>(s, n).\n                            I (s, n) \\<and> lmaps_to_axpr ?b False s}\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           I (s, n) \\<and> lmaps_to_axpr b True s}\n                       c { I \\<and>* $ 1}", "have\n    w: \"\\<turnstile>\\<^sub>3 { (\\<lambda>(s,n). I (s,n) \\<and>  vars b \\<subseteq> dom s) ** $1 } WHILE b DO c {  \\<lambda>(s,n). I (s,n) \\<and> lmaps_to_axpr b False s }\""], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           I (s, n) \\<and> lmaps_to_axpr ?b True s}\n                       ?C { I \\<and>* $ 1} \\<Longrightarrow>\n  \\<turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                            I (s, n) \\<and>\n                            vars ?b \\<subseteq> dom s) \\<and>*\n                        $ 1}\n                       WHILE ?b DO ?C\n                       { \\<lambda>(s, n).\n                            I (s, n) \\<and> lmaps_to_axpr ?b False s}\n  \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n                           I (s, n) \\<and> lmaps_to_axpr b True s}\n                       c { I \\<and>* $ 1}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                              I (s, n) \\<and>\n                              vars b \\<subseteq> dom s) \\<and>*\n                          $ 1}\n                         WHILE b DO c\n                         { \\<lambda>(s, n).\n                              I (s, n) \\<and> lmaps_to_axpr b False s}", "."], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {(\\<lambda>(s, n).\n                            I (s, n) \\<and>\n                            vars b \\<subseteq> dom s) \\<and>*\n                        $ 1}\n                       WHILE b DO c\n                       { \\<lambda>(s, n).\n                            I (s, n) \\<and> lmaps_to_axpr b False s}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "show \"\\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "apply(rule conseq)"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<turnstile>\\<^sub>3 {?P} WHILE b DO c { ?Q}\n 2. \\<And>s. wp\\<^sub>3 (WHILE b DO c) Q s \\<Longrightarrow> ?P s\n 3. \\<And>s. ?Q s \\<Longrightarrow> Q s", "apply(rule w)"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>s.\n       wp\\<^sub>3 (WHILE b DO c) Q s \\<Longrightarrow>\n       ((\\<lambda>(s, n). I (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n        $ 1)\n        s\n 2. \\<And>s.\n       case s of\n       (s, n) \\<Rightarrow>\n         I (s, n) \\<and> lmaps_to_axpr b False s \\<Longrightarrow>\n       Q s", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q s_ \\<Longrightarrow>\n    ((\\<lambda>(s, n). I (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n     $ 1)\n     s_", "using sF I_def"], ["proof (prove)\nusing this:\n  wp\\<^sub>3 (WHILE ?b DO ?c) ?Q ?s =\n  ((\\<lambda>(ps, n).\n       vars ?b \\<subseteq> dom ps \\<and>\n       (if pbval ?b ps\n        then wp\\<^sub>3 ?c (wp\\<^sub>3 (WHILE ?b DO ?c) ?Q) (ps, n)\n        else ?Q (ps, n))) \\<and>*\n   $ 1)\n   ?s\n  I \\<equiv>\n  \\<lambda>(ps, n).\n     vars b \\<subseteq> dom ps \\<and>\n     (if pbval b ps then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n      else Q (ps, n))\n\ngoal (1 subgoal):\n 1. wp\\<^sub>3 (WHILE b DO c) Q s_ \\<Longrightarrow>\n    ((\\<lambda>(s, n). I (s, n) \\<and> vars b \\<subseteq> dom s) \\<and>*\n     $ 1)\n     s_", "by (smt Pair_inject R case_prodE case_prodI2)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s.\n       case s of\n       (s, n) \\<Rightarrow>\n         I (s, n) \\<and> lmaps_to_axpr b False s \\<Longrightarrow>\n       Q s", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. case s_ of\n    (s, n) \\<Rightarrow>\n      I (s, n) \\<and> lmaps_to_axpr b False s \\<Longrightarrow>\n    Q s_", "unfolding I_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. case s_ of\n    (s, n) \\<Rightarrow>\n      (case (s, n) of\n       (ps, n) \\<Rightarrow>\n         vars b \\<subseteq> dom ps \\<and>\n         (if pbval b ps\n          then wp\\<^sub>3 c (wp\\<^sub>3 (WHILE b DO c) Q) (ps, n)\n          else Q (ps, n))) \\<and>\n      lmaps_to_axpr b False s \\<Longrightarrow>\n    Q s_", "by auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma wp3_is_pre: \"\\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}", "proof (induction c arbitrary: Q)"], ["proof (state)\ngoal (5 subgoals):\n 1. \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 SKIP Q} SKIP { Q}\n 2. \\<And>x1 x2 Q.\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}\n 3. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 4. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 5. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "case SKIP"], ["proof (state)\nthis:\n  \n\ngoal (5 subgoals):\n 1. \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 SKIP Q} SKIP { Q}\n 2. \\<And>x1 x2 Q.\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}\n 3. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 4. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 5. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "then"], ["proof (chain)\npicking this:", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 SKIP Q} SKIP { Q}", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {Q \\<and>* $ (Suc 0)} SKIP { Q}", "using Frame[where F=Q and Q=\"$0\" and P=\"$1\", OF Skip]"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {$ 1 \\<and>* Q} SKIP { $ 0 \\<and>* Q}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {Q \\<and>* $ (Suc 0)} SKIP { Q}", "by (auto simp: sep.add_ac)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 SKIP Q} SKIP { Q}\n\ngoal (4 subgoals):\n 1. \\<And>x1 x2 Q.\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}\n 2. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 3. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 4. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "next"], ["proof (state)\ngoal (4 subgoals):\n 1. \\<And>x1 x2 Q.\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}\n 2. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 3. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 4. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "case (Assign x1 x2)"], ["proof (state)\nthis:\n  \n\ngoal (4 subgoals):\n 1. \\<And>x1 x2 Q.\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}\n 2. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 3. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 4. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "then"], ["proof (chain)\npicking this:", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}", "using Assign4"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {(\\<lambda>(ps, t).\n                            ?x \\<in> dom ps \\<and>\n                            vars ?a \\<subseteq> dom ps \\<and>\n                            ?Q (ps(?x \\<mapsto> paval ?a ps), t)) \\<and>*\n                        $ 1}\n                       ?x ::= ?a { ?Q}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}", "by simp"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (x1 ::= x2) Q} x1 ::= x2 { Q}\n\ngoal (3 subgoals):\n 1. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 2. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 3. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "next"], ["proof (state)\ngoal (3 subgoals):\n 1. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 2. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 3. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "case (Seq c1 c2)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 ?Q} c1 { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 ?Q} c2 { ?Q}\n\ngoal (3 subgoals):\n 1. \\<And>c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q}\n        c1;; c2 { Q}\n 2. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 3. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "then"], ["proof (chain)\npicking this:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 ?Q} c1 { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 ?Q} c2 { ?Q}", "show ?case"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 ?Q} c1 { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 ?Q} c2 { ?Q}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q} c1;; c2 { Q}", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 (wp\\<^sub>3 c2 Q)}\n     c1;; c2 { Q}", "apply(subst hoareT3.Seq[rotated])"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {?Q4} c2 { Q}\n 2. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 (wp\\<^sub>3 c2 Q)}\n     c1 { ?Q4}\n 3. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> True", "by auto"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (c1;; c2) Q} c1;; c2 { Q}\n\ngoal (2 subgoals):\n 1. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 2. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "next"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 2. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "case (If x1 c1 c2)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 ?Q} c1 { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 ?Q} c2 { ?Q}\n\ngoal (2 subgoals):\n 1. \\<And>x1 c1 c2 Q.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n       \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3\n          (IF x1 THEN c1 ELSE c2) Q}\n        IF x1 THEN c1 ELSE c2 { Q}\n 2. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "then"], ["proof (chain)\npicking this:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 ?Q} c1 { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 ?Q} c2 { ?Q}", "show ?case"], ["proof (prove)\nusing this:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 ?Q} c1 { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 ?Q} c2 { ?Q}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (IF x1 THEN c1 ELSE c2) Q}\n                         IF x1 THEN c1 ELSE c2 { Q}", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {(\\<lambda>(ps, t).\n          vars x1 \\<subseteq> dom ps \\<and>\n          wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n      $ (Suc 0)}\n     IF x1 THEN c1 ELSE c2 { Q}", "apply(rule weakenpre[OF hoareT3.If, where P1=\"%(ps,n). wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps,n)\"])"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n         (case (s, n) of\n          (ps, n) \\<Rightarrow>\n            wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, n)) \\<and>\n         lmaps_to_axpr x1 True s}\n     c1 { Q}\n 2. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n         (case (s, n) of\n          (ps, n) \\<Rightarrow>\n            wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, n)) \\<and>\n         lmaps_to_axpr x1 False s}\n     c2 { Q}\n 3. \\<And>s.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        ((\\<lambda>(ps, t).\n             vars x1 \\<subseteq> dom ps \\<and>\n             wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n         $ (Suc 0))\n         s\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, n).\n                              (case (s, n) of\n                               (ps, n) \\<Rightarrow>\n                                 wp\\<^sub>3 (if pbval x1 ps then c1 else c2)\n                                  Q (ps, n)) \\<and>\n                              vars x1 \\<subseteq> dom s) \\<and>*\n                          $ 1)\n                          s", "apply auto"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n         wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q (s, n) \\<and>\n         vars x1 \\<subseteq> dom s \\<and> pbval x1 s}\n     c1 { Q}\n 2. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n         wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q (s, n) \\<and>\n         vars x1 \\<subseteq> dom s \\<and> \\<not> pbval x1 s}\n     c2 { Q}\n 3. \\<And>a b.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        ((\\<lambda>(ps, t).\n             vars x1 \\<subseteq> dom ps \\<and>\n             wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n         $ (Suc 0))\n         (a, b)\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, n).\n                              wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q\n                               (s, n) \\<and>\n                              vars x1 \\<subseteq> dom s) \\<and>*\n                          $ (Suc 0))\n                          (a, b)", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n         wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q (s, n) \\<and>\n         vars x1 \\<subseteq> dom s \\<and> pbval x1 s}\n     c1 { Q}", "apply(rule conseq[where P=\"wp\\<^sub>3 c1 Q\" and Q=Q])"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q}\n 2. \\<And>s.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        case s of\n        (s, n) \\<Rightarrow>\n          wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q (s, n) \\<and>\n          vars x1 \\<subseteq> dom s \\<and> pbval x1 s\\<rbrakk>\n       \\<Longrightarrow> wp\\<^sub>3 c1 Q s\n 3. \\<And>s.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        Q s\\<rbrakk>\n       \\<Longrightarrow> Q s", "by auto"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n         wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q (s, n) \\<and>\n         vars x1 \\<subseteq> dom s \\<and> \\<not> pbval x1 s}\n     c2 { Q}\n 2. \\<And>a b.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        ((\\<lambda>(ps, t).\n             vars x1 \\<subseteq> dom ps \\<and>\n             wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n         $ (Suc 0))\n         (a, b)\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, n).\n                              wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q\n                               (s, n) \\<and>\n                              vars x1 \\<subseteq> dom s) \\<and>*\n                          $ (Suc 0))\n                          (a, b)", "subgoal"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {\\<lambda>(s, n).\n         wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q (s, n) \\<and>\n         vars x1 \\<subseteq> dom s \\<and> \\<not> pbval x1 s}\n     c2 { Q}", "apply(rule conseq[where P=\"wp\\<^sub>3 c2 Q\" and Q=Q])"], ["proof (prove)\ngoal (3 subgoals):\n 1. \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n     \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\\<rbrakk>\n    \\<Longrightarrow> \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q}\n 2. \\<And>s.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        case s of\n        (s, n) \\<Rightarrow>\n          wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q (s, n) \\<and>\n          vars x1 \\<subseteq> dom s \\<and> \\<not> pbval x1 s\\<rbrakk>\n       \\<Longrightarrow> wp\\<^sub>3 c2 Q s\n 3. \\<And>s.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        Q s\\<rbrakk>\n       \\<Longrightarrow> Q s", "by auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a b.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        ((\\<lambda>(ps, t).\n             vars x1 \\<subseteq> dom ps \\<and>\n             wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n         $ (Suc 0))\n         (a, b)\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, n).\n                              wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q\n                               (s, n) \\<and>\n                              vars x1 \\<subseteq> dom s) \\<and>*\n                          $ (Suc 0))\n                          (a, b)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>a b.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        ((\\<lambda>(ps, t).\n             vars x1 \\<subseteq> dom ps \\<and>\n             wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n         $ (Suc 0))\n         (a, b)\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, n).\n                              wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q\n                               (s, n) \\<and>\n                              vars x1 \\<subseteq> dom s) \\<and>*\n                          $ (Suc 0))\n                          (a, b)", "fix a b"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>a b.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        ((\\<lambda>(ps, t).\n             vars x1 \\<subseteq> dom ps \\<and>\n             wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n         $ (Suc 0))\n         (a, b)\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, n).\n                              wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q\n                               (s, n) \\<and>\n                              vars x1 \\<subseteq> dom s) \\<and>*\n                          $ (Suc 0))\n                          (a, b)", "assume \"((\\<lambda>(ps, t). vars x1 \\<subseteq> dom ps \\<and> wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>* $ (Suc 0)) (a, b)\""], ["proof (state)\nthis:\n  ((\\<lambda>(ps, t).\n       vars x1 \\<subseteq> dom ps \\<and>\n       wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n   $ (Suc 0))\n   (a, b)\n\ngoal (1 subgoal):\n 1. \\<And>a b.\n       \\<lbrakk>\\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c1 Q} c1 { Q};\n        \\<And>Q. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c2 Q} c2 { Q};\n        ((\\<lambda>(ps, t).\n             vars x1 \\<subseteq> dom ps \\<and>\n             wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n         $ (Suc 0))\n         (a, b)\\<rbrakk>\n       \\<Longrightarrow> ((\\<lambda>(s, n).\n                              wp\\<^sub>3 (if pbval x1 s then c1 else c2) Q\n                               (s, n) \\<and>\n                              vars x1 \\<subseteq> dom s) \\<and>*\n                          $ (Suc 0))\n                          (a, b)", "then"], ["proof (chain)\npicking this:\n  ((\\<lambda>(ps, t).\n       vars x1 \\<subseteq> dom ps \\<and>\n       wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n   $ (Suc 0))\n   (a, b)", "show \"((\\<lambda>(ps, t). wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t) \\<and> vars x1 \\<subseteq> dom ps) \\<and>* $ (Suc 0)) (a, b)\""], ["proof (prove)\nusing this:\n  ((\\<lambda>(ps, t).\n       vars x1 \\<subseteq> dom ps \\<and>\n       wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>*\n   $ (Suc 0))\n   (a, b)\n\ngoal (1 subgoal):\n 1. ((\\<lambda>(ps, t).\n         wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t) \\<and>\n         vars x1 \\<subseteq> dom ps) \\<and>*\n     $ (Suc 0))\n     (a, b)", "unfolding sep_conj_def"], ["proof (prove)\nusing this:\n  \\<exists>x y.\n     x ## y \\<and>\n     (a, b) = x + y \\<and>\n     (case x of\n      (ps, t) \\<Rightarrow>\n        vars x1 \\<subseteq> dom ps \\<and>\n        wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t)) \\<and>\n     $ (Suc 0) y\n\ngoal (1 subgoal):\n 1. \\<exists>x y.\n       x ## y \\<and>\n       (a, b) = x + y \\<and>\n       (case x of\n        (ps, t) \\<Rightarrow>\n          wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t) \\<and>\n          vars x1 \\<subseteq> dom ps) \\<and>\n       $ (Suc 0) y", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>aa ba aaa baa.\n       \\<lbrakk>aa ## aaa; a = aa + aaa; b = ba + baa;\n        vars x1 \\<subseteq> dom aa;\n        wp\\<^sub>3 (if pbval x1 aa then c1 else c2) Q (aa, ba);\n        $ (Suc 0) (aaa, baa)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>a.\n                            (pbval x1 a \\<longrightarrow>\n                             (\\<exists>b ab.\n                                 a ## ab \\<and>\n                                 aa + aaa = a + ab \\<and>\n                                 (\\<exists>bb.\n                                     ba + baa = b + bb \\<and>\n                                     wp\\<^sub>3 c1 Q (a, b) \\<and>\n                                     vars x1 \\<subseteq> dom a \\<and>\n                                     $ (Suc 0) (ab, bb)))) \\<and>\n                            (\\<not> pbval x1 a \\<longrightarrow>\n                             (\\<exists>b ab.\n                                 a ## ab \\<and>\n                                 aa + aaa = a + ab \\<and>\n                                 (\\<exists>bb.\n                                     ba + baa = b + bb \\<and>\n                                     wp\\<^sub>3 c2 Q (a, b) \\<and>\n                                     vars x1 \\<subseteq> dom a \\<and>\n                                     $ (Suc 0) (ab, bb))))", "apply(case_tac \"pbval x1 aa\")"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>aa ba aaa baa.\n       \\<lbrakk>aa ## aaa; a = aa + aaa; b = ba + baa;\n        vars x1 \\<subseteq> dom aa;\n        wp\\<^sub>3 (if pbval x1 aa then c1 else c2) Q (aa, ba);\n        $ (Suc 0) (aaa, baa); pbval x1 aa\\<rbrakk>\n       \\<Longrightarrow> \\<exists>a.\n                            (pbval x1 a \\<longrightarrow>\n                             (\\<exists>b ab.\n                                 a ## ab \\<and>\n                                 aa + aaa = a + ab \\<and>\n                                 (\\<exists>bb.\n                                     ba + baa = b + bb \\<and>\n                                     wp\\<^sub>3 c1 Q (a, b) \\<and>\n                                     vars x1 \\<subseteq> dom a \\<and>\n                                     $ (Suc 0) (ab, bb)))) \\<and>\n                            (\\<not> pbval x1 a \\<longrightarrow>\n                             (\\<exists>b ab.\n                                 a ## ab \\<and>\n                                 aa + aaa = a + ab \\<and>\n                                 (\\<exists>bb.\n                                     ba + baa = b + bb \\<and>\n                                     wp\\<^sub>3 c2 Q (a, b) \\<and>\n                                     vars x1 \\<subseteq> dom a \\<and>\n                                     $ (Suc 0) (ab, bb))))\n 2. \\<And>aa ba aaa baa.\n       \\<lbrakk>aa ## aaa; a = aa + aaa; b = ba + baa;\n        vars x1 \\<subseteq> dom aa;\n        wp\\<^sub>3 (if pbval x1 aa then c1 else c2) Q (aa, ba);\n        $ (Suc 0) (aaa, baa); \\<not> pbval x1 aa\\<rbrakk>\n       \\<Longrightarrow> \\<exists>a.\n                            (pbval x1 a \\<longrightarrow>\n                             (\\<exists>b ab.\n                                 a ## ab \\<and>\n                                 aa + aaa = a + ab \\<and>\n                                 (\\<exists>bb.\n                                     ba + baa = b + bb \\<and>\n                                     wp\\<^sub>3 c1 Q (a, b) \\<and>\n                                     vars x1 \\<subseteq> dom a \\<and>\n                                     $ (Suc 0) (ab, bb)))) \\<and>\n                            (\\<not> pbval x1 a \\<longrightarrow>\n                             (\\<exists>b ab.\n                                 a ## ab \\<and>\n                                 aa + aaa = a + ab \\<and>\n                                 (\\<exists>bb.\n                                     ba + baa = b + bb \\<and>\n                                     wp\\<^sub>3 c2 Q (a, b) \\<and>\n                                     vars x1 \\<subseteq> dom a \\<and>\n                                     $ (Suc 0) (ab, bb))))", "apply auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (state)\nthis:\n  ((\\<lambda>(ps, t).\n       wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t) \\<and>\n       vars x1 \\<subseteq> dom ps) \\<and>*\n   $ (Suc 0))\n   (a, b)\n\ngoal:\nNo subgoals!", "(* strange! *)"], ["proof (state)\nthis:\n  ((\\<lambda>(ps, t).\n       wp\\<^sub>3 (if pbval x1 ps then c1 else c2) Q (ps, t) \\<and>\n       vars x1 \\<subseteq> dom ps) \\<and>*\n   $ (Suc 0))\n   (a, b)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (IF x1 THEN c1 ELSE c2) Q}\n                       IF x1 THEN c1 ELSE c2 { Q}\n\ngoal (1 subgoal):\n 1. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "case (While b c)"], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c ?Q} c { ?Q}\n\ngoal (1 subgoal):\n 1. \\<And>x1 c Q.\n       (\\<And>Q.\n           \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c Q} c { Q}) \\<Longrightarrow>\n       \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE x1 DO c) Q} WHILE x1 DO c\n                            { Q}", "with WhileWpisPre"], ["proof (chain)\npicking this:\n  (\\<And>Q.\n      \\<turnstile>\\<^sub>3 {wp\\<^sub>3 ?c Q} ?c { Q}) \\<Longrightarrow>\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE ?b DO ?c) ?Q} WHILE ?b DO ?c { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c ?Q} c { ?Q}", "show ?case"], ["proof (prove)\nusing this:\n  (\\<And>Q.\n      \\<turnstile>\\<^sub>3 {wp\\<^sub>3 ?c Q} ?c { Q}) \\<Longrightarrow>\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE ?b DO ?c) ?Q} WHILE ?b DO ?c { ?Q}\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 c ?Q} c { ?Q}\n\ngoal (1 subgoal):\n 1. \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}", "."], ["proof (state)\nthis:\n  \\<turnstile>\\<^sub>3 {wp\\<^sub>3 (WHILE b DO c) Q} WHILE b DO c { Q}\n\ngoal:\nNo subgoals!", "qed"], ["", "theorem hoare3_complete: \"\\<Turnstile>\\<^sub>3 {P}c{Q} \\<Longrightarrow> \\<turnstile>\\<^sub>3 {P}c{Q}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<Turnstile>\\<^sub>3 {P} c { Q} \\<Longrightarrow>\n    \\<turnstile>\\<^sub>3 {P} c { Q}", "apply(rule conseq[OF wp3_is_pre, where Q'=Q and Q=Q, simplified])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>s.\n       \\<lbrakk>\\<Turnstile>\\<^sub>3 {P} c { Q}; P s\\<rbrakk>\n       \\<Longrightarrow> wp\\<^sub>3 c Q s", "apply(auto simp: hoare3_valid_def wp3_def)"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a b.\n       \\<lbrakk>\\<forall>ps n.\n                   P (ps, n) \\<longrightarrow>\n                   (\\<exists>ps' m.\n                       (c, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps' \\<and>\n                       m \\<le> n \\<and> Q (ps', n - m));\n        P (a, b)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t m.\n                            m \\<le> b \\<and>\n                            (c, a) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n                            Q (t, b - m)", "by fast"], ["", "theorem hoare3_sound_complete: \"\\<Turnstile>\\<^sub>3 {P}c{Q} \\<longleftrightarrow> \\<turnstile>\\<^sub>3 {P}c{Q}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Turnstile>\\<^sub>3 {P} c { Q}) = (\\<turnstile>\\<^sub>3 {P} c { Q})", "using hoare3_complete hoare3_sound"], ["proof (prove)\nusing this:\n  \\<Turnstile>\\<^sub>3 {?P} ?c { ?Q} \\<Longrightarrow>\n  \\<turnstile>\\<^sub>3 {?P} ?c { ?Q}\n  \\<turnstile>\\<^sub>3 {?P} ?c { ?Q} \\<Longrightarrow>\n  \\<Turnstile>\\<^sub>3 {?P} ?c { ?Q}\n\ngoal (1 subgoal):\n 1. (\\<Turnstile>\\<^sub>3 {P} c { Q}) = (\\<turnstile>\\<^sub>3 {P} c { Q})", "by metis"], ["", "subsubsection \"What about garbage collection?\""], ["", "definition F where \"F C Q = (%(ps,n). \\<exists>ps1' ps2' m e1 e2. (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' + ps2' \\<and>  ps1' ## ps2' \\<and> n = e1 + e2 + m \\<and> Q (ps1',e1) )\""], ["", "lemma \"wp\\<^sub>3 C (Q**(%_.True)) = F C Q\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wp\\<^sub>3 C (Q \\<and>* (\\<lambda>_. True)) = F C Q", "apply rule"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x. wp\\<^sub>3 C (Q \\<and>* (\\<lambda>_. True)) x = F C Q x", "unfolding wp3_def sep_conj_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x.\n       (case x of\n        (s, n) \\<Rightarrow>\n          \\<exists>t m.\n             m \\<le> n \\<and>\n             (C, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n             (\\<exists>x y.\n                 x ## y \\<and> (t, n - m) = x + y \\<and> Q x \\<and> True)) =\n       F C Q x", "unfolding F_def"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>x.\n       (case x of\n        (s, n) \\<Rightarrow>\n          \\<exists>t m.\n             m \\<le> n \\<and>\n             (C, s) \\<Rightarrow>\\<^sub>A m \\<Down> t \\<and>\n             (\\<exists>x y.\n                 x ## y \\<and> (t, n - m) = x + y \\<and> Q x \\<and> True)) =\n       (case x of\n        (ps, n) \\<Rightarrow>\n          \\<exists>ps1' ps2' m e1 e2.\n             (C, ps) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' + ps2' \\<and>\n             ps1' ## ps2' \\<and> n = e1 + e2 + m \\<and> Q (ps1', e1))", "apply auto"], ["proof (prove)\ngoal (2 subgoals):\n 1. \\<And>a b m aa ba ab bb.\n       \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aa + ab;\n        aa ## ab; Q (aa, ba); b - m = ba + bb\\<rbrakk>\n       \\<Longrightarrow> \\<exists>ps1' ps2' m.\n                            (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' +\n                             ps2' \\<and>\n                            ps1' ## ps2' \\<and>\n                            (\\<exists>e1.\n                                (\\<exists>e2. b = e1 + e2 + m) \\<and>\n                                Q (ps1', e1))\n 2. \\<And>a ps1' ps2' m e1 e2.\n       \\<lbrakk>(C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' + ps2';\n        ps1' ## ps2'; Q (ps1', e1)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t ma.\n                            ma \\<le> e1 + e2 + m \\<and>\n                            (C, a) \\<Rightarrow>\\<^sub>A ma \\<Down> t \\<and>\n                            (\\<exists>a b aa.\n                                a ## aa \\<and>\n                                t = a + aa \\<and>\n                                (\\<exists>ba.\n                                    e1 + e2 + m - ma = b + ba) \\<and>\n                                Q (a, b))", "subgoal for a b m aaa ba ab bb"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ps1' ps2' m.\n                         (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' +\n                          ps2' \\<and>\n                         ps1' ## ps2' \\<and>\n                         (\\<exists>e1.\n                             (\\<exists>e2. b = e1 + e2 + m) \\<and>\n                             Q (ps1', e1))", "apply(rule exI[where x=aaa])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ps2' m.\n                         (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa +\n                          ps2' \\<and>\n                         aaa ## ps2' \\<and>\n                         (\\<exists>e1.\n                             (\\<exists>e2. b = e1 + e2 + m) \\<and>\n                             Q (aaa, e1))", "apply(rule exI[where x=ab])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> \\<exists>m.\n                         (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa +\n                          ab \\<and>\n                         aaa ## ab \\<and>\n                         (\\<exists>e1.\n                             (\\<exists>e2. b = e1 + e2 + m) \\<and>\n                             Q (aaa, e1))", "apply(rule exI[where x=m])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab \\<and>\n                      aaa ## ab \\<and>\n                      (\\<exists>e1.\n                          (\\<exists>e2. b = e1 + e2 + m) \\<and> Q (aaa, e1))", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> \\<exists>e1.\n                         (\\<exists>e2. b = e1 + e2 + m) \\<and> Q (aaa, e1)", "apply(rule exI[where x=ba])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> (\\<exists>e2. b = ba + e2 + m) \\<and> Q (aaa, ba)", "apply auto"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> \\<exists>e2. b = ba + e2 + m", "apply(rule exI[where x=bb])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>m \\<le> b; (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> aaa + ab;\n     aaa ## ab; Q (aaa, ba); b - m = ba + bb\\<rbrakk>\n    \\<Longrightarrow> b = ba + bb + m", "apply auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>a ps1' ps2' m e1 e2.\n       \\<lbrakk>(C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' + ps2';\n        ps1' ## ps2'; Q (ps1', e1)\\<rbrakk>\n       \\<Longrightarrow> \\<exists>t ma.\n                            ma \\<le> e1 + e2 + m \\<and>\n                            (C, a) \\<Rightarrow>\\<^sub>A ma \\<Down> t \\<and>\n                            (\\<exists>a b aa.\n                                a ## aa \\<and>\n                                t = a + aa \\<and>\n                                (\\<exists>ba.\n                                    e1 + e2 + m - ma = b + ba) \\<and>\n                                Q (a, b))", "subgoal for a ps1' ps2' m e1 e2"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>(C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' + ps2';\n     ps1' ## ps2'; Q (ps1', e1)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>t ma.\n                         ma \\<le> e1 + e2 + m \\<and>\n                         (C, a) \\<Rightarrow>\\<^sub>A ma \\<Down> t \\<and>\n                         (\\<exists>a b aa.\n                             a ## aa \\<and>\n                             t = a + aa \\<and>\n                             (\\<exists>ba. e1 + e2 + m - ma = b + ba) \\<and>\n                             Q (a, b))", "apply(rule exI[where x=\"ps1'+ps2'\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>(C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' + ps2';\n     ps1' ## ps2'; Q (ps1', e1)\\<rbrakk>\n    \\<Longrightarrow> \\<exists>ma\\<le>e1 + e2 + m.\n                         (C, a) \\<Rightarrow>\\<^sub>A ma \\<Down> ps1' +\n                           ps2' \\<and>\n                         (\\<exists>a b aa.\n                             a ## aa \\<and>\n                             ps1' + ps2' = a + aa \\<and>\n                             (\\<exists>ba. e1 + e2 + m - ma = b + ba) \\<and>\n                             Q (a, b))", "apply(rule exI[where x=\"m\"])"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>(C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' + ps2';\n     ps1' ## ps2'; Q (ps1', e1)\\<rbrakk>\n    \\<Longrightarrow> m \\<le> e1 + e2 + m \\<and>\n                      (C, a) \\<Rightarrow>\\<^sub>A m \\<Down> ps1' +\n                       ps2' \\<and>\n                      (\\<exists>a b aa.\n                          a ## aa \\<and>\n                          ps1' + ps2' = a + aa \\<and>\n                          (\\<exists>ba. e1 + e2 + m - m = b + ba) \\<and>\n                          Q (a, b))", "by auto"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "definition hoareT3_validGC :: \"assn2 \\<Rightarrow> com \\<Rightarrow> assn2 \\<Rightarrow> bool\"\n  (\"\\<Turnstile>\\<^sub>G {(1_)}/ (_)/ { (1_)}\" 50) where\n\"\\<Turnstile>\\<^sub>G { P } c { Q }  \\<longleftrightarrow> \\<Turnstile>\\<^sub>3 { P } c { Q ** (%_.True) }\""], ["", "end"]]}