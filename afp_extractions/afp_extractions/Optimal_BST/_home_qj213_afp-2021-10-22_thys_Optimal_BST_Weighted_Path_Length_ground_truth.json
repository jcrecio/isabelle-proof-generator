{"file_name": "/home/qj213/afp-2021-10-22/thys/Optimal_BST/Weighted_Path_Length.thy", "working_directory": "/home/qj213/afp-2021-10-22/thys/Optimal_BST", "problem_names": ["lemma inorder_upto_split:\n  assumes \"inorder \\<langle>l,k,r\\<rangle> = [i..j]\"\n  shows \"inorder l = [i..k-1]\" \"inorder r = [k+1..j]\" \"i \\<le> k\" \"k \\<le> j\"", "lemma finite_nodes: \"finite (nodes t)\"", "lemma finite_leaves: \"finite (leaves i t)\"", "lemma notin_nodes0: \"(k, 0) \\<notin> nodes t\"", "lemma sum_incr2: \"sum f (incr2 ` A) = sum (\\<lambda>xy. f(fst xy,snd xy+1)) A\"", "lemma fst_nodes: \"fst ` nodes t = set_tree t\"", "lemma fst_leaves: \"\\<lbrakk> inorder t = [i..j]; i \\<le> j+1\\<rbrakk> \\<Longrightarrow> fst ` leaves i t = {i..j+1}\"", "lemma sum_leaves: \"\\<lbrakk> inorder t = [i..j];  i \\<le> j+1 \\<rbrakk> \\<Longrightarrow>\n  (\\<Sum>x\\<in>leaves i t. (f(fst x) :: nat)) = sum f {i..j+1}\"", "lemma sum_nodes: \"inorder t = [i..j] \\<Longrightarrow>\n  (\\<Sum>xy\\<in>nodes t. (f(fst xy) :: nat)) = sum f {i..j}\"", "lemma \"inorder t = [i..j] \\<Longrightarrow> wpl i j t = Wpl i t\""], "translations": [["", "lemma inorder_upto_split:\n  assumes \"inorder \\<langle>l,k,r\\<rangle> = [i..j]\"\n  shows \"inorder l = [i..k-1]\" \"inorder r = [k+1..j]\" \"i \\<le> k\" \"k \\<le> j\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (inorder l = [i..k - 1] &&& inorder r = [k + 1..j]) &&&\n    i \\<le> k &&& k \\<le> j", "proof -"], ["proof (state)\ngoal (4 subgoals):\n 1. inorder l = [i..k - 1]\n 2. inorder r = [k + 1..j]\n 3. i \\<le> k\n 4. k \\<le> j", "have k: \"k\\<in>set[i..j]\""], ["proof (prove)\ngoal (1 subgoal):\n 1. k \\<in> set [i..j]", "using assms"], ["proof (prove)\nusing this:\n  inorder \\<langle>l, k, r\\<rangle> = [i..j]\n\ngoal (1 subgoal):\n 1. k \\<in> set [i..j]", "by (metis set_inorder tree.set_intros(2))"], ["proof (state)\nthis:\n  k \\<in> set [i..j]\n\ngoal (4 subgoals):\n 1. inorder l = [i..k - 1]\n 2. inorder r = [k + 1..j]\n 3. i \\<le> k\n 4. k \\<le> j", "have \"[i..k-1] @ k # [k+1..j] = [i..j]\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [i..k - 1] @ k # [k + 1..j] = [i..j]", "using k upto_rec1 upto_split1"], ["proof (prove)\nusing this:\n  k \\<in> set [i..j]\n  ?i \\<le> ?j \\<Longrightarrow> [?i..?j] = ?i # [?i + 1..?j]\n  \\<lbrakk>?i \\<le> ?j; ?j \\<le> ?k\\<rbrakk>\n  \\<Longrightarrow> [?i..?k] = [?i..?j - 1] @ [?j..?k]\n\ngoal (1 subgoal):\n 1. [i..k - 1] @ k # [k + 1..j] = [i..j]", "by (metis atLeastAtMost_iff set_upto)"], ["proof (state)\nthis:\n  [i..k - 1] @ k # [k + 1..j] = [i..j]\n\ngoal (4 subgoals):\n 1. inorder l = [i..k - 1]\n 2. inorder r = [k + 1..j]\n 3. i \\<le> k\n 4. k \\<le> j", "also"], ["proof (state)\nthis:\n  [i..k - 1] @ k # [k + 1..j] = [i..j]\n\ngoal (4 subgoals):\n 1. inorder l = [i..k - 1]\n 2. inorder r = [k + 1..j]\n 3. i \\<le> k\n 4. k \\<le> j", "have \"\\<dots> = inorder l @ k # inorder r\""], ["proof (prove)\ngoal (1 subgoal):\n 1. [i..j] = inorder l @ k # inorder r", "using assms"], ["proof (prove)\nusing this:\n  inorder \\<langle>l, k, r\\<rangle> = [i..j]\n\ngoal (1 subgoal):\n 1. [i..j] = inorder l @ k # inorder r", "by auto"], ["proof (state)\nthis:\n  [i..j] = inorder l @ k # inorder r\n\ngoal (4 subgoals):\n 1. inorder l = [i..k - 1]\n 2. inorder r = [k + 1..j]\n 3. i \\<le> k\n 4. k \\<le> j", "finally"], ["proof (chain)\npicking this:\n  [i..k - 1] @ k # [k + 1..j] = inorder l @ k # inorder r", "have \"inorder l = [i..k-1] \\<and> inorder r = [k+1..j]\" (is \"?A \\<and> ?B\")"], ["proof (prove)\nusing this:\n  [i..k - 1] @ k # [k + 1..j] = inorder l @ k # inorder r\n\ngoal (1 subgoal):\n 1. inorder l = [i..k - 1] \\<and> inorder r = [k + 1..j]", "by(auto simp: append_Cons_eq_iff)"], ["proof (state)\nthis:\n  inorder l = [i..k - 1] \\<and> inorder r = [k + 1..j]\n\ngoal (4 subgoals):\n 1. inorder l = [i..k - 1]\n 2. inorder r = [k + 1..j]\n 3. i \\<le> k\n 4. k \\<le> j", "thus ?A ?B"], ["proof (prove)\nusing this:\n  inorder l = [i..k - 1] \\<and> inorder r = [k + 1..j]\n\ngoal (1 subgoal):\n 1. inorder l = [i..k - 1] &&& inorder r = [k + 1..j]", "by auto"], ["proof (state)\nthis:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n\ngoal (2 subgoals):\n 1. i \\<le> k\n 2. k \\<le> j", "show \"i \\<le> k\" \"k \\<le> j\""], ["proof (prove)\ngoal (1 subgoal):\n 1. i \\<le> k &&& k \\<le> j", "using k"], ["proof (prove)\nusing this:\n  k \\<in> set [i..j]\n\ngoal (1 subgoal):\n 1. i \\<le> k &&& k \\<le> j", "by auto"], ["proof (state)\nthis:\n  i \\<le> k\n  k \\<le> j\n\ngoal:\nNo subgoals!", "qed"], ["", "fun incr2 :: \"int \\<times> nat \\<Rightarrow> int \\<times> nat\" where\n\"incr2 (x,n) = (x, n + 1)\""], ["", "fun leaves :: \"int \\<Rightarrow> int tree \\<Rightarrow> (int * nat) set\" where\n\"leaves i Leaf = {(i,0)}\" |\n\"leaves i (Node l k r) = incr2 ` (leaves i l \\<union> leaves (k+1) r)\""], ["", "fun nodes :: \"int tree \\<Rightarrow> (int * nat) set\" where\n\"nodes Leaf = {}\" |\n\"nodes (Node l k r) = {(k,1)} \\<union> incr2 ` (nodes l \\<union> nodes r)\""], ["", "lemma finite_nodes: \"finite (nodes t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (nodes t)", "by(induction t) auto"], ["", "lemma finite_leaves: \"finite (leaves i t)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. finite (leaves i t)", "by(induction i t rule: leaves.induct) auto"], ["", "lemma notin_nodes0: \"(k, 0) \\<notin> nodes t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (k, 0) \\<notin> nodes t", "by(induction t) auto"], ["", "lemma sum_incr2: \"sum f (incr2 ` A) = sum (\\<lambda>xy. f(fst xy,snd xy+1)) A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum f (incr2 ` A) = (\\<Sum>xy\\<in>A. f (fst xy, snd xy + 1))", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. sum f (incr2 ` A) = (\\<Sum>xy\\<in>A. f (fst xy, snd xy + 1))", "have \"sum f (incr2 ` A) = sum (f o incr2) A\""], ["proof (prove)\ngoal (1 subgoal):\n 1. sum f (incr2 ` A) = sum (f \\<circ> incr2) A", "by(subst sum.reindex)(auto simp: inj_on_def)"], ["proof (state)\nthis:\n  sum f (incr2 ` A) = sum (f \\<circ> incr2) A\n\ngoal (1 subgoal):\n 1. sum f (incr2 ` A) = (\\<Sum>xy\\<in>A. f (fst xy, snd xy + 1))", "also"], ["proof (state)\nthis:\n  sum f (incr2 ` A) = sum (f \\<circ> incr2) A\n\ngoal (1 subgoal):\n 1. sum f (incr2 ` A) = (\\<Sum>xy\\<in>A. f (fst xy, snd xy + 1))", "have \"f o incr2 = (\\<lambda>xy. f(fst xy,snd xy+1))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f \\<circ> incr2 = (\\<lambda>xy. f (fst xy, snd xy + 1))", "by(auto simp: fun_eq_iff)"], ["proof (state)\nthis:\n  f \\<circ> incr2 = (\\<lambda>xy. f (fst xy, snd xy + 1))\n\ngoal (1 subgoal):\n 1. sum f (incr2 ` A) = (\\<Sum>xy\\<in>A. f (fst xy, snd xy + 1))", "finally"], ["proof (chain)\npicking this:\n  sum f (incr2 ` A) = (\\<Sum>a\\<in>A. f (fst a, snd a + 1))", "show ?thesis"], ["proof (prove)\nusing this:\n  sum f (incr2 ` A) = (\\<Sum>a\\<in>A. f (fst a, snd a + 1))\n\ngoal (1 subgoal):\n 1. sum f (incr2 ` A) = (\\<Sum>xy\\<in>A. f (fst xy, snd xy + 1))", "by simp"], ["proof (state)\nthis:\n  sum f (incr2 ` A) = (\\<Sum>xy\\<in>A. f (fst xy, snd xy + 1))\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma fst_nodes: \"fst ` nodes t = set_tree t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fst ` nodes t = set_tree t", "apply(induction t)"], ["proof (prove)\ngoal (2 subgoals):\n 1. fst ` nodes \\<langle>\\<rangle> = set_tree \\<langle>\\<rangle>\n 2. \\<And>t1 x2 t2.\n       \\<lbrakk>fst ` nodes t1 = set_tree t1;\n        fst ` nodes t2 = set_tree t2\\<rbrakk>\n       \\<Longrightarrow> fst ` nodes \\<langle>t1, x2, t2\\<rangle> =\n                         set_tree \\<langle>t1, x2, t2\\<rangle>", "apply simp"], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2.\n       \\<lbrakk>fst ` nodes t1 = set_tree t1;\n        fst ` nodes t2 = set_tree t2\\<rbrakk>\n       \\<Longrightarrow> fst ` nodes \\<langle>t1, x2, t2\\<rangle> =\n                         set_tree \\<langle>t1, x2, t2\\<rangle>", "apply (fastforce simp: image_def set_eq_iff ball_Un)"], ["proof (prove)\ngoal:\nNo subgoals!", "done"], ["", "lemma fst_leaves: \"\\<lbrakk> inorder t = [i..j]; i \\<le> j+1\\<rbrakk> \\<Longrightarrow> fst ` leaves i t = {i..j+1}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>inorder t = [i..j]; i \\<le> j + 1\\<rbrakk>\n    \\<Longrightarrow> fst ` leaves i t = {i..j + 1}", "proof(induction t arbitrary: i j)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>i j.\n       \\<lbrakk>inorder \\<langle>\\<rangle> = [i..j]; i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>\\<rangle> = {i..j + 1}\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> fst ` leaves i t1 = {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> fst ` leaves i t2 = {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>t1, x2, t2\\<rangle> =\n                         {i..j + 1}", "case Leaf"], ["proof (state)\nthis:\n  inorder \\<langle>\\<rangle> = [i..j]\n  i \\<le> j + 1\n\ngoal (2 subgoals):\n 1. \\<And>i j.\n       \\<lbrakk>inorder \\<langle>\\<rangle> = [i..j]; i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>\\<rangle> = {i..j + 1}\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> fst ` leaves i t1 = {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> fst ` leaves i t2 = {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>t1, x2, t2\\<rangle> =\n                         {i..j + 1}", "then"], ["proof (chain)\npicking this:\n  inorder \\<langle>\\<rangle> = [i..j]\n  i \\<le> j + 1", "show ?case"], ["proof (prove)\nusing this:\n  inorder \\<langle>\\<rangle> = [i..j]\n  i \\<le> j + 1\n\ngoal (1 subgoal):\n 1. fst ` leaves i \\<langle>\\<rangle> = {i..j + 1}", "by auto"], ["proof (state)\nthis:\n  fst ` leaves i \\<langle>\\<rangle> = {i..j + 1}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> fst ` leaves i t1 = {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> fst ` leaves i t2 = {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>t1, x2, t2\\<rangle> =\n                         {i..j + 1}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> fst ` leaves i t1 = {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> fst ` leaves i t2 = {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>t1, x2, t2\\<rangle> =\n                         {i..j + 1}", "case (Node t1 k t2)"], ["proof (state)\nthis:\n  \\<lbrakk>inorder t1 = [?i..?j]; ?i \\<le> ?j + 1\\<rbrakk>\n  \\<Longrightarrow> fst ` leaves ?i t1 = {?i..?j + 1}\n  \\<lbrakk>inorder t2 = [?i..?j]; ?i \\<le> ?j + 1\\<rbrakk>\n  \\<Longrightarrow> fst ` leaves ?i t2 = {?i..?j + 1}\n  inorder \\<langle>t1, k, t2\\<rangle> = [i..j]\n  i \\<le> j + 1\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> fst ` leaves i t1 = {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> fst ` leaves i t2 = {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>t1, x2, t2\\<rangle> =\n                         {i..j + 1}", "note inorder = inorder_upto_split[OF Node.prems(1)]"], ["proof (state)\nthis:\n  inorder t1 = [i..k - 1]\n  inorder t2 = [k + 1..j]\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> fst ` leaves i t1 = {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> fst ` leaves i t2 = {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> fst ` leaves i \\<langle>t1, x2, t2\\<rangle> =\n                         {i..j + 1}", "show ?case"], ["proof (prove)\ngoal (1 subgoal):\n 1. fst ` leaves i \\<langle>t1, k, t2\\<rangle> = {i..j + 1}", "using  Node.IH(1)[OF inorder(1)] Node.IH(2)[OF inorder(2)] inorder(3,4) Node.prems(2)"], ["proof (prove)\nusing this:\n  i \\<le> k - 1 + 1 \\<Longrightarrow> fst ` leaves i t1 = {i..k - 1 + 1}\n  k + 1 \\<le> j + 1 \\<Longrightarrow>\n  fst ` leaves (k + 1) t2 = {k + 1..j + 1}\n  i \\<le> k\n  k \\<le> j\n  i \\<le> j + 1\n\ngoal (1 subgoal):\n 1. fst ` leaves i \\<langle>t1, k, t2\\<rangle> = {i..j + 1}", "by (fastforce simp: image_def set_eq_iff bex_Un)"], ["proof (state)\nthis:\n  fst ` leaves i \\<langle>t1, k, t2\\<rangle> = {i..j + 1}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sum_leaves: \"\\<lbrakk> inorder t = [i..j];  i \\<le> j+1 \\<rbrakk> \\<Longrightarrow>\n  (\\<Sum>x\\<in>leaves i t. (f(fst x) :: nat)) = sum f {i..j+1}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. \\<lbrakk>inorder t = [i..j]; i \\<le> j + 1\\<rbrakk>\n    \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t. f (fst x)) = sum f {i..j + 1}", "proof(induction t arbitrary: i j)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>i j.\n       \\<lbrakk>inorder \\<langle>\\<rangle> = [i..j]; i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "case Leaf"], ["proof (state)\nthis:\n  inorder \\<langle>\\<rangle> = [i..j]\n  i \\<le> j + 1\n\ngoal (2 subgoals):\n 1. \\<And>i j.\n       \\<lbrakk>inorder \\<langle>\\<rangle> = [i..j]; i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "hence \"i = j+1\""], ["proof (prove)\nusing this:\n  inorder \\<langle>\\<rangle> = [i..j]\n  i \\<le> j + 1\n\ngoal (1 subgoal):\n 1. i = j + 1", "by simp"], ["proof (state)\nthis:\n  i = j + 1\n\ngoal (2 subgoals):\n 1. \\<And>i j.\n       \\<lbrakk>inorder \\<langle>\\<rangle> = [i..j]; i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "thus ?case"], ["proof (prove)\nusing this:\n  i = j + 1\n\ngoal (1 subgoal):\n 1. (\\<Sum>x\\<in>leaves i \\<langle>\\<rangle>. f (fst x)) = sum f {i..j + 1}", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>x\\<in>leaves i \\<langle>\\<rangle>. f (fst x)) = sum f {i..j + 1}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "case (Node l k r)"], ["proof (state)\nthis:\n  \\<lbrakk>inorder l = [?i..?j]; ?i \\<le> ?j + 1\\<rbrakk>\n  \\<Longrightarrow> (\\<Sum>x\\<in>leaves ?i l. f (fst x)) =\n                    sum f {?i..?j + 1}\n  \\<lbrakk>inorder r = [?i..?j]; ?i \\<le> ?j + 1\\<rbrakk>\n  \\<Longrightarrow> (\\<Sum>x\\<in>leaves ?i r. f (fst x)) =\n                    sum f {?i..?j + 1}\n  inorder \\<langle>l, k, r\\<rangle> = [i..j]\n  i \\<le> j + 1\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "note inorder = inorder_upto_split[OF Node.prems(1)]"], ["proof (state)\nthis:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "let ?Ll = \"leaves i l\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "let ?Lr = \"leaves (k+1) r\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "let ?L = \"?Ll \\<union> ?Lr\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "have \"fst ` ?Ll \\<inter> fst ` ?Lr = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}", "using inorder"], ["proof (prove)\nusing this:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}", "by(simp add: fst_leaves del: set_inorder add: set_inorder[symmetric])"], ["proof (state)\nthis:\n  fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "hence l0: \"?Ll \\<inter> ?Lr = {}\""], ["proof (prove)\nusing this:\n  fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}\n\ngoal (1 subgoal):\n 1. leaves i l \\<inter> leaves (k + 1) r = {}", "by auto"], ["proof (state)\nthis:\n  leaves i l \\<inter> leaves (k + 1) r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "have \"{i..j+1} = {i..k} \\<union> {k+1..j+1}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}", "using inorder(3,4)"], ["proof (prove)\nusing this:\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}", "by auto"], ["proof (state)\nthis:\n  {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   \\<lbrakk>inorder t1 = [i..j]; i \\<le> j + 1\\<rbrakk>\n                   \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t1. f (fst x)) =\n                                     sum f {i..j + 1};\n        \\<And>i j.\n           \\<lbrakk>inorder t2 = [i..j]; i \\<le> j + 1\\<rbrakk>\n           \\<Longrightarrow> (\\<Sum>x\\<in>leaves i t2. f (fst x)) =\n                             sum f {i..j + 1};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j];\n        i \\<le> j + 1\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>x\\<in>leaves i \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst x)) =\n                         sum f {i..j + 1}", "thus ?case"], ["proof (prove)\nusing this:\n  {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}\n\ngoal (1 subgoal):\n 1. (\\<Sum>x\\<in>leaves i \\<langle>l, k, r\\<rangle>. f (fst x)) =\n    sum f {i..j + 1}", "using Node.IH(1)[OF inorder(1)] Node.IH(2)[OF inorder(2)] inorder(3,4) Node.prems(2)"], ["proof (prove)\nusing this:\n  {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}\n  i \\<le> k - 1 + 1 \\<Longrightarrow>\n  (\\<Sum>x\\<in>leaves i l. f (fst x)) = sum f {i..k - 1 + 1}\n  k + 1 \\<le> j + 1 \\<Longrightarrow>\n  (\\<Sum>x\\<in>leaves (k + 1) r. f (fst x)) = sum f {k + 1..j + 1}\n  i \\<le> k\n  k \\<le> j\n  i \\<le> j + 1\n\ngoal (1 subgoal):\n 1. (\\<Sum>x\\<in>leaves i \\<langle>l, k, r\\<rangle>. f (fst x)) =\n    sum f {i..j + 1}", "by(simp add: sum_incr2 sum_Un_nat finite_leaves l0)"], ["proof (state)\nthis:\n  (\\<Sum>x\\<in>leaves i \\<langle>l, k, r\\<rangle>. f (fst x)) =\n  sum f {i..j + 1}\n\ngoal:\nNo subgoals!", "qed"], ["", "lemma sum_nodes: \"inorder t = [i..j] \\<Longrightarrow>\n  (\\<Sum>xy\\<in>nodes t. (f(fst xy) :: nat)) = sum f {i..j}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inorder t = [i..j] \\<Longrightarrow>\n    (\\<Sum>xy\\<in>nodes t. f (fst xy)) = sum f {i..j}", "proof(induction t arbitrary: i j)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>i j.\n       inorder \\<langle>\\<rangle> = [i..j] \\<Longrightarrow>\n       (\\<Sum>xy\\<in>nodes \\<langle>\\<rangle>. f (fst xy)) = sum f {i..j}\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "case Leaf"], ["proof (state)\nthis:\n  inorder \\<langle>\\<rangle> = [i..j]\n\ngoal (2 subgoals):\n 1. \\<And>i j.\n       inorder \\<langle>\\<rangle> = [i..j] \\<Longrightarrow>\n       (\\<Sum>xy\\<in>nodes \\<langle>\\<rangle>. f (fst xy)) = sum f {i..j}\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "thus ?case"], ["proof (prove)\nusing this:\n  inorder \\<langle>\\<rangle> = [i..j]\n\ngoal (1 subgoal):\n 1. (\\<Sum>xy\\<in>nodes \\<langle>\\<rangle>. f (fst xy)) = sum f {i..j}", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>xy\\<in>nodes \\<langle>\\<rangle>. f (fst xy)) = sum f {i..j}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "case (Node l k r)"], ["proof (state)\nthis:\n  inorder l = [?i..?j] \\<Longrightarrow>\n  (\\<Sum>xy\\<in>nodes l. f (fst xy)) = sum f {?i..?j}\n  inorder r = [?i..?j] \\<Longrightarrow>\n  (\\<Sum>xy\\<in>nodes r. f (fst xy)) = sum f {?i..?j}\n  inorder \\<langle>l, k, r\\<rangle> = [i..j]\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "note inorder = inorder_upto_split[OF Node.prems(1)]"], ["proof (state)\nthis:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "let ?Nl = \"nodes l\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "let ?Nr = \"nodes r\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "let ?N = \"?Nl \\<union> ?Nr\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "have \"(fst ` ?Nl) \\<inter> (fst ` ?Nr) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fst ` nodes l \\<inter> fst ` nodes r = {}", "using inorder(1,2)"], ["proof (prove)\nusing this:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n\ngoal (1 subgoal):\n 1. fst ` nodes l \\<inter> fst ` nodes r = {}", "by(simp add: fst_nodes del: set_inorder add: set_inorder[symmetric])"], ["proof (state)\nthis:\n  fst ` nodes l \\<inter> fst ` nodes r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "hence n0: \"?Nl \\<inter> ?Nr = {}\""], ["proof (prove)\nusing this:\n  fst ` nodes l \\<inter> fst ` nodes r = {}\n\ngoal (1 subgoal):\n 1. nodes l \\<inter> nodes r = {}", "by auto"], ["proof (state)\nthis:\n  nodes l \\<inter> nodes r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "have \"(\\<Sum>xy\\<in>nodes(Node l k r). (f (fst xy) :: nat))\n    = (\\<Sum>xy\\<in>insert (k, Suc 0) (incr2 ` (nodes l \\<union> nodes r)). f(fst xy))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>xy\\<in>nodes \\<langle>l, k, r\\<rangle>. f (fst xy)) =\n    (\\<Sum>xy\\<in>insert (k, Suc 0) (incr2 ` (nodes l \\<union> nodes r)).\n       f (fst xy))", "by(simp)"], ["proof (state)\nthis:\n  (\\<Sum>xy\\<in>nodes \\<langle>l, k, r\\<rangle>. f (fst xy)) =\n  (\\<Sum>xy\\<in>insert (k, Suc 0) (incr2 ` (nodes l \\<union> nodes r)).\n     f (fst xy))\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "also"], ["proof (state)\nthis:\n  (\\<Sum>xy\\<in>nodes \\<langle>l, k, r\\<rangle>. f (fst xy)) =\n  (\\<Sum>xy\\<in>insert (k, Suc 0) (incr2 ` (nodes l \\<union> nodes r)).\n     f (fst xy))\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "have \"\\<dots> = f k + (\\<Sum>xy\\<in>(incr2 ` (nodes l \\<union> nodes r)). f(fst xy))\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>xy\\<in>insert (k, Suc 0) (incr2 ` (nodes l \\<union> nodes r)).\n       f (fst xy)) =\n    f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy))", "by(subst sum.insert, auto simp: finite_nodes notin_nodes0)"], ["proof (state)\nthis:\n  (\\<Sum>xy\\<in>insert (k, Suc 0) (incr2 ` (nodes l \\<union> nodes r)).\n     f (fst xy)) =\n  f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy))\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "also"], ["proof (state)\nthis:\n  (\\<Sum>xy\\<in>insert (k, Suc 0) (incr2 ` (nodes l \\<union> nodes r)).\n     f (fst xy)) =\n  f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy))\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "have \"\\<dots> = sum f {i..j}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy)) =\n    sum f {i..j}", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy)) =\n    sum f {i..j}", "have \"{i..j} = {i..k-1} \\<union> {k} \\<union> {k+1..j}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {i..j} = {i..k - 1} \\<union> {k} \\<union> {k + 1..j}", "using inorder(3,4)"], ["proof (prove)\nusing this:\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. {i..j} = {i..k - 1} \\<union> {k} \\<union> {k + 1..j}", "by auto"], ["proof (state)\nthis:\n  {i..j} = {i..k - 1} \\<union> {k} \\<union> {k + 1..j}\n\ngoal (1 subgoal):\n 1. f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy)) =\n    sum f {i..j}", "thus ?thesis"], ["proof (prove)\nusing this:\n  {i..j} = {i..k - 1} \\<union> {k} \\<union> {k + 1..j}\n\ngoal (1 subgoal):\n 1. f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy)) =\n    sum f {i..j}", "using Node.IH(1)[OF inorder(1)] Node.IH(2)[OF inorder(2)] inorder(3,4)"], ["proof (prove)\nusing this:\n  {i..j} = {i..k - 1} \\<union> {k} \\<union> {k + 1..j}\n  (\\<Sum>xy\\<in>nodes l. f (fst xy)) = sum f {i..k - 1}\n  (\\<Sum>xy\\<in>nodes r. f (fst xy)) = sum f {k + 1..j}\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy)) =\n    sum f {i..j}", "by(simp add: sum_incr2 sum_Un_nat finite_nodes n0)"], ["proof (state)\nthis:\n  f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy)) =\n  sum f {i..j}\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  f k + (\\<Sum>xy\\<in>incr2 ` (nodes l \\<union> nodes r). f (fst xy)) =\n  sum f {i..j}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   (\\<Sum>xy\\<in>nodes t1. f (fst xy)) = sum f {i..j};\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow>\n           (\\<Sum>xy\\<in>nodes t2. f (fst xy)) = sum f {i..j};\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> (\\<Sum>xy\\<in>nodes \\<langle>t1, x2, t2\\<rangle>.\n                            f (fst xy)) =\n                         sum f {i..j}", "finally"], ["proof (chain)\npicking this:\n  (\\<Sum>xy\\<in>nodes \\<langle>l, k, r\\<rangle>. f (fst xy)) = sum f {i..j}", "show ?case"], ["proof (prove)\nusing this:\n  (\\<Sum>xy\\<in>nodes \\<langle>l, k, r\\<rangle>. f (fst xy)) = sum f {i..j}\n\ngoal (1 subgoal):\n 1. (\\<Sum>xy\\<in>nodes \\<langle>l, k, r\\<rangle>. f (fst xy)) =\n    sum f {i..j}", "."], ["proof (state)\nthis:\n  (\\<Sum>xy\\<in>nodes \\<langle>l, k, r\\<rangle>. f (fst xy)) = sum f {i..j}\n\ngoal:\nNo subgoals!", "qed"], ["", "locale wpl =\nfixes w :: \"int \\<Rightarrow> int \\<Rightarrow> nat\"\nbegin"], ["", "fun wpl :: \"int \\<Rightarrow> int \\<Rightarrow> int tree \\<Rightarrow> nat\" where\n\"wpl i j Leaf = 0\" |\n\"wpl i j (Node l k r) = wpl i (k-1) l + wpl (k+1) j r + w i j\""], ["", "end"], ["", "locale Wpl =\nfixes a b :: \"int \\<Rightarrow> nat\"\nbegin"], ["", "definition Wpl :: \"int \\<Rightarrow> int tree \\<Rightarrow> nat\" where\n\"Wpl i t = sum (\\<lambda>(k,c). c * b k) (nodes t) + sum (\\<lambda>(k,c). c * a k) (leaves i t)\""], ["", "definition w :: \"int \\<Rightarrow> int \\<Rightarrow> nat\" where\n\"w i j = sum a {i..j+1} + sum b {i..j}\""], ["", "sublocale wpl where w = w"], ["proof (prove)\ngoal:\nNo subgoals!", "."], ["", "lemma \"inorder t = [i..j] \\<Longrightarrow> wpl i j t = Wpl i t\""], ["proof (prove)\ngoal (1 subgoal):\n 1. inorder t = [i..j] \\<Longrightarrow> wpl i j t = Wpl i t", "proof(induction t arbitrary: i j)"], ["proof (state)\ngoal (2 subgoals):\n 1. \\<And>i j.\n       inorder \\<langle>\\<rangle> = [i..j] \\<Longrightarrow>\n       wpl i j \\<langle>\\<rangle> = Wpl i \\<langle>\\<rangle>\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "case Leaf"], ["proof (state)\nthis:\n  inorder \\<langle>\\<rangle> = [i..j]\n\ngoal (2 subgoals):\n 1. \\<And>i j.\n       inorder \\<langle>\\<rangle> = [i..j] \\<Longrightarrow>\n       wpl i j \\<langle>\\<rangle> = Wpl i \\<langle>\\<rangle>\n 2. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "thus ?case"], ["proof (prove)\nusing this:\n  inorder \\<langle>\\<rangle> = [i..j]\n\ngoal (1 subgoal):\n 1. wpl i j \\<langle>\\<rangle> = Wpl i \\<langle>\\<rangle>", "by(simp add: Wpl_def)"], ["proof (state)\nthis:\n  wpl i j \\<langle>\\<rangle> = Wpl i \\<langle>\\<rangle>\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "next"], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "case (Node l k r)"], ["proof (state)\nthis:\n  inorder l = [?i..?j] \\<Longrightarrow> wpl ?i ?j l = Wpl ?i l\n  inorder r = [?i..?j] \\<Longrightarrow> wpl ?i ?j r = Wpl ?i r\n  inorder \\<langle>l, k, r\\<rangle> = [i..j]\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?b = \"\\<lambda>(k,c). c * b k\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?a = \"\\<lambda>(k,c). c * a k\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "note inorder = inorder_upto_split[OF Node.prems]"], ["proof (state)\nthis:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?Nl = \"nodes l\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?Nr = \"nodes r\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?N = \"?Nl \\<union> ?Nr\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?Ll = \"leaves i l\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?Lr = \"leaves (k+1) r\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "let ?L = \"?Ll \\<union> ?Lr\""], ["proof (state)\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"(fst ` ?Nl) \\<inter> (fst ` ?Nr) = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fst ` nodes l \\<inter> fst ` nodes r = {}", "using inorder(1,2)"], ["proof (prove)\nusing this:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n\ngoal (1 subgoal):\n 1. fst ` nodes l \\<inter> fst ` nodes r = {}", "by(simp add: fst_nodes del: set_inorder add: set_inorder[symmetric])"], ["proof (state)\nthis:\n  fst ` nodes l \\<inter> fst ` nodes r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "hence n0: \"?Nl \\<inter> ?Nr = {}\""], ["proof (prove)\nusing this:\n  fst ` nodes l \\<inter> fst ` nodes r = {}\n\ngoal (1 subgoal):\n 1. nodes l \\<inter> nodes r = {}", "by auto"], ["proof (state)\nthis:\n  nodes l \\<inter> nodes r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"fst ` ?Ll \\<inter> fst ` ?Lr = {}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}", "using inorder"], ["proof (prove)\nusing this:\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}", "by(simp add: fst_leaves del: set_inorder add: set_inorder[symmetric])"], ["proof (state)\nthis:\n  fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "hence l0: \"?Ll \\<inter> ?Lr = {}\""], ["proof (prove)\nusing this:\n  fst ` leaves i l \\<inter> fst ` leaves (k + 1) r = {}\n\ngoal (1 subgoal):\n 1. leaves i l \\<inter> leaves (k + 1) r = {}", "by auto"], ["proof (state)\nthis:\n  leaves i l \\<inter> leaves (k + 1) r = {}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"wpl i j (Node l k r) =  Wpl i l + Wpl (k + 1) r + w i j\""], ["proof (prove)\ngoal (1 subgoal):\n 1. wpl i j \\<langle>l, k, r\\<rangle> = Wpl i l + Wpl (k + 1) r + w i j", "using Node.IH inorder"], ["proof (prove)\nusing this:\n  inorder l = [?i..?j] \\<Longrightarrow> wpl ?i ?j l = Wpl ?i l\n  inorder r = [?i..?j] \\<Longrightarrow> wpl ?i ?j r = Wpl ?i r\n  inorder l = [i..k - 1]\n  inorder r = [k + 1..j]\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. wpl i j \\<langle>l, k, r\\<rangle> = Wpl i l + Wpl (k + 1) r + w i j", "by(simp)"], ["proof (state)\nthis:\n  wpl i j \\<langle>l, k, r\\<rangle> = Wpl i l + Wpl (k + 1) r + w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  wpl i j \\<langle>l, k, r\\<rangle> = Wpl i l + Wpl (k + 1) r + w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"\\<dots> = sum ?b (nodes l) + sum ?a (leaves i l) +\n    sum ?b (nodes r) + sum ?a (leaves (k+1) r) + w i j\""], ["proof (prove)\ngoal (1 subgoal):\n 1. Wpl i l + Wpl (k + 1) r + w i j =\n    (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n    (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k) +\n    w i j", "by (simp add: Wpl_def)"], ["proof (state)\nthis:\n  Wpl i l + Wpl (k + 1) r + w i j =\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k) +\n  w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  Wpl i l + Wpl (k + 1) r + w i j =\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k) +\n  w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"\\<dots> = (sum ?b (nodes l) + sum ?b (nodes r))\n    + (sum ?a (leaves i l) + sum ?a (leaves (k+1) r)) + w i j\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n    (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k) +\n    w i j =\n    (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n    (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n    ((\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n     (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k)) +\n    w i j", "by(simp add: algebra_simps)"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k) +\n  w i j =\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  ((\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n   (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k)) +\n  w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k) +\n  w i j =\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  ((\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n   (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k)) +\n  w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"\\<dots> = sum ?b ?N + sum ?a ?L + w i j\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n    (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n    ((\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n     (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k)) +\n    w i j =\n    (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    w i j", "by(simp add: sum_Un_nat finite_nodes finite_leaves l0 n0)"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  ((\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n   (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k)) +\n  w i j =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l. c * b k) +\n  (\\<Sum>(k, c)\\<in>nodes r. c * b k) +\n  ((\\<Sum>(k, c)\\<in>leaves i l. c * a k) +\n   (\\<Sum>(k, c)\\<in>leaves (k + 1) r. c * a k)) +\n  w i j =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  w i j\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"\\<dots> = sum ?b ?N + sum ?a ?L + sum a {i..j+1} + sum b {i..j}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    w i j =\n    (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    sum a {i..j + 1} +\n    sum b {i..j}", "by (simp add: w_def)"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  w i j =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  sum a {i..j + 1} +\n  sum b {i..j}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  w i j =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  sum a {i..j + 1} +\n  sum b {i..j}\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"\\<dots> = sum ?b ?N + sum b {i..j} + (sum ?a ?L + sum a {i..j+1})\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    sum a {i..j + 1} +\n    sum b {i..j} =\n    (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} +\n    ((\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n     sum a {i..j + 1})", "by(simp add: algebra_simps)"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  sum a {i..j + 1} +\n  sum b {i..j} =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} +\n  ((\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n   sum a {i..j + 1})\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  sum a {i..j + 1} +\n  sum b {i..j} =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} +\n  ((\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n   sum a {i..j + 1})\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"sum ?a ?L + sum a {i..j+1} = sum ?a (incr2 ` ?L)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    sum a {i..j + 1} =\n    (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r).\n       c * a k)", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    sum a {i..j + 1} =\n    (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r).\n       c * a k)", "have \"{i..j+1} = {i..k} \\<union> {k+1..j+1}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}", "using inorder(3,4)"], ["proof (prove)\nusing this:\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}", "by auto"], ["proof (state)\nthis:\n  {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}\n\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    sum a {i..j + 1} =\n    (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r).\n       c * a k)", "thus ?thesis"], ["proof (prove)\nusing this:\n  {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}\n\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    sum a {i..j + 1} =\n    (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r).\n       c * a k)", "using inorder(3,4)"], ["proof (prove)\nusing this:\n  {i..j + 1} = {i..k} \\<union> {k + 1..j + 1}\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n    sum a {i..j + 1} =\n    (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r).\n       c * a k)", "by (simp add: sum_incr2 split_def sum.distrib sum_Un_nat finite_leaves l0\n        sum_leaves[OF inorder(1)] sum_leaves[OF inorder(2)])"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  sum a {i..j + 1} =\n  (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r). c * a k)\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  sum a {i..j + 1} =\n  (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r). c * a k)\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>leaves i l \\<union> leaves (k + 1) r. c * a k) +\n  sum a {i..j + 1} =\n  (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r). c * a k)\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"sum ?b ?N + sum b {i..j}\n     = sum ?b ?N + sum b ({i..k-1} \\<union> {k+1..j}) + b k\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} =\n    (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    sum b ({i..k - 1} \\<union> {k + 1..j}) +\n    b k", "proof -"], ["proof (state)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} =\n    (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    sum b ({i..k - 1} \\<union> {k + 1..j}) +\n    b k", "have \"{i..j} = {k} \\<union> {i..k-1} \\<union> {k+1..j}\""], ["proof (prove)\ngoal (1 subgoal):\n 1. {i..j} = {k} \\<union> {i..k - 1} \\<union> {k + 1..j}", "using inorder(3,4)"], ["proof (prove)\nusing this:\n  i \\<le> k\n  k \\<le> j\n\ngoal (1 subgoal):\n 1. {i..j} = {k} \\<union> {i..k - 1} \\<union> {k + 1..j}", "by auto"], ["proof (state)\nthis:\n  {i..j} = {k} \\<union> {i..k - 1} \\<union> {k + 1..j}\n\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} =\n    (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    sum b ({i..k - 1} \\<union> {k + 1..j}) +\n    b k", "thus ?thesis"], ["proof (prove)\nusing this:\n  {i..j} = {k} \\<union> {i..k - 1} \\<union> {k + 1..j}\n\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} =\n    (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    sum b ({i..k - 1} \\<union> {k + 1..j}) +\n    b k", "by simp"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  sum b ({i..k - 1} \\<union> {k + 1..j}) +\n  b k\n\ngoal:\nNo subgoals!", "qed"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  sum b ({i..k - 1} \\<union> {k + 1..j}) +\n  b k\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) + sum b {i..j} =\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  sum b ({i..k - 1} \\<union> {k + 1..j}) +\n  b k\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"sum ?b ?N + sum b ({i..k-1} \\<union> {k+1..j}) = sum ?b (incr2 ` ?N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n    sum b ({i..k - 1} \\<union> {k + 1..j}) =\n    (\\<Sum>(k, c)\\<in>incr2 ` (nodes l \\<union> nodes r). c * b k)", "by (simp add: sum_incr2 split_def sum.distrib sum_Un_nat finite_nodes n0\n        sum_nodes[OF inorder(1)] sum_nodes[OF inorder(2)])"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  sum b ({i..k - 1} \\<union> {k + 1..j}) =\n  (\\<Sum>(k, c)\\<in>incr2 ` (nodes l \\<union> nodes r). c * b k)\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>nodes l \\<union> nodes r. c * b k) +\n  sum b ({i..k - 1} \\<union> {k + 1..j}) =\n  (\\<Sum>(k, c)\\<in>incr2 ` (nodes l \\<union> nodes r). c * b k)\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"sum ?b (incr2 ` ?N) + b k = sum ?b ({(k,1)} \\<union> incr2 ` ?N)\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>incr2 ` (nodes l \\<union> nodes r). c * b k) + b k =\n    (\\<Sum>(k, c)\\<in>{(k, 1)} \\<union> incr2 ` (nodes l \\<union> nodes r).\n       c * b k)", "by(simp, subst sum.insert, auto simp add: finite_nodes notin_nodes0)"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>incr2 ` (nodes l \\<union> nodes r). c * b k) + b k =\n  (\\<Sum>(k, c)\\<in>{(k, 1)} \\<union> incr2 ` (nodes l \\<union> nodes r).\n     c * b k)\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "also"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>incr2 ` (nodes l \\<union> nodes r). c * b k) + b k =\n  (\\<Sum>(k, c)\\<in>{(k, 1)} \\<union> incr2 ` (nodes l \\<union> nodes r).\n     c * b k)\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "have \"sum ?b ({(k,1)} \\<union> incr2 ` ?N) + sum ?a (incr2 ` ?L) = Wpl i \\<langle>l,k,r\\<rangle>\""], ["proof (prove)\ngoal (1 subgoal):\n 1. (\\<Sum>(k, c)\\<in>{(k, 1)} \\<union> incr2 ` (nodes l \\<union> nodes r).\n       c * b k) +\n    (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r).\n       c * a k) =\n    Wpl i \\<langle>l, k, r\\<rangle>", "by(simp add: Wpl_def)"], ["proof (state)\nthis:\n  (\\<Sum>(k, c)\\<in>{(k, 1)} \\<union> incr2 ` (nodes l \\<union> nodes r).\n     c * b k) +\n  (\\<Sum>(k, c)\\<in>incr2 ` (leaves i l \\<union> leaves (k + 1) r).\n     c * a k) =\n  Wpl i \\<langle>l, k, r\\<rangle>\n\ngoal (1 subgoal):\n 1. \\<And>t1 x2 t2 i j.\n       \\<lbrakk>\\<And>i j.\n                   inorder t1 = [i..j] \\<Longrightarrow>\n                   wpl i j t1 = Wpl i t1;\n        \\<And>i j.\n           inorder t2 = [i..j] \\<Longrightarrow> wpl i j t2 = Wpl i t2;\n        inorder \\<langle>t1, x2, t2\\<rangle> = [i..j]\\<rbrakk>\n       \\<Longrightarrow> wpl i j \\<langle>t1, x2, t2\\<rangle> =\n                         Wpl i \\<langle>t1, x2, t2\\<rangle>", "finally"], ["proof (chain)\npicking this:\n  wpl i j \\<langle>l, k, r\\<rangle> = Wpl i \\<langle>l, k, r\\<rangle>", "show ?case"], ["proof (prove)\nusing this:\n  wpl i j \\<langle>l, k, r\\<rangle> = Wpl i \\<langle>l, k, r\\<rangle>\n\ngoal (1 subgoal):\n 1. wpl i j \\<langle>l, k, r\\<rangle> = Wpl i \\<langle>l, k, r\\<rangle>", "."], ["proof (state)\nthis:\n  wpl i j \\<langle>l, k, r\\<rangle> = Wpl i \\<langle>l, k, r\\<rangle>\n\ngoal:\nNo subgoals!", "qed"], ["", "end"], ["", "end"]]}